<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>从零开始搭建你的免费图床系统 | 严千屹博客</title><meta name="author" content="严千屹"><meta name="copyright" content="严千屹"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="（Cloudflare R2 + WebP Cloud + 图床工具）">
<meta property="og:type" content="article">
<meta property="og:title" content="从零开始搭建你的免费图床系统">
<meta property="og:url" content="https://blog.qianyios.top/posts/aaddb3d/index.html">
<meta property="og:site_name" content="严千屹博客">
<meta property="og:description" content="（Cloudflare R2 + WebP Cloud + 图床工具）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.qianyios.top/img/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F%EF%BC%88Cloudflare%20R2%20+%20WebP%20Cloud%20+%20%E5%9B%BE%E5%BA%8A%E5%B7%A5%E5%85%B7%EF%BC%89/23.png">
<meta property="article:published_time" content="2025-02-12T10:47:40.000Z">
<meta property="article:modified_time" content="2025-07-12T11:05:14.289Z">
<meta property="article:author" content="严千屹">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.qianyios.top/img/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F%EF%BC%88Cloudflare%20R2%20+%20WebP%20Cloud%20+%20%E5%9B%BE%E5%BA%8A%E5%B7%A5%E5%85%B7%EF%BC%89/23.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "从零开始搭建你的免费图床系统",
  "url": "https://blog.qianyios.top/posts/aaddb3d/",
  "image": "https://blog.qianyios.top/img/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F%EF%BC%88Cloudflare%20R2%20+%20WebP%20Cloud%20+%20%E5%9B%BE%E5%BA%8A%E5%B7%A5%E5%85%B7%EF%BC%89/23.png",
  "datePublished": "2025-02-12T10:47:40.000Z",
  "dateModified": "2025-07-12T11:05:14.289Z",
  "author": [
    {
      "@type": "Person",
      "name": "严千屹",
      "url": "https://blog.qianyios.top"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.qianyios.top/posts/aaddb3d/index.html"><link rel="preconnect"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/pluginsSrc/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: 严千屹","link":"链接: ","source":"来源: 严千屹博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '从零开始搭建你的免费图床系统',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1232762_lfyb6ri0kug.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/><link rel="stylesheet" type="text/css" href="/css/my.css"><meta name="referrer" content="no-referrer"/><meta name="baidu-site-verification" content="codeva-zscxkbTWf7" /><meta name="google-site-verification" content="1zGJFCeeGb41mMQ8kA5KXdLo4_mLIecUtqm5MCX61ZM" /><script defer src="https://cloud.umami.is/script.js" data-website-id="83039d8f-bd3d-4637-bcfa-22c3a2fc0ac1"></script><link rel="stylesheet" href="https://portb.kbai.cc/hexo&amp;kbai/mousezhizhen.css"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/bg.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/fluid.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://yw.qianyios.top"><i class="fa-fw fas fa-cloud"></i><span> 运维笔记</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="https://blog.qianyios.top/posts/22484/"><i class="fa-fw iconfont icon-liuyan"></i><span> 公共留言板</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">严千屹博客</span></a><a class="nav-page-title" href="/"><span class="site-name">从零开始搭建你的免费图床系统</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://yw.qianyios.top"><i class="fa-fw fas fa-cloud"></i><span> 运维笔记</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="https://blog.qianyios.top/posts/22484/"><i class="fa-fw iconfont icon-liuyan"></i><span> 公共留言板</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">从零开始搭建你的免费图床系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-12T10:47:40.000Z" title="发表于 2025-02-12 18:47:40">2025-02-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-12T11:05:14.289Z" title="更新于 2025-07-12 19:05:14">2025-07-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9D%82%E9%A1%B9/">杂项</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;已经过了&quot;,&quot;messageNext&quot;:&quot;天自上次更新，文章内容可能已过时。&quot;,&quot;postUpdate&quot;:&quot;2025-07-12 19:05:14&quot;}" hidden></div><meta name="referrer" content="no-referrer"/>
<h1 id="从零开始搭建你的免费图床系统（Cloudflare-R2-WebP-Cloud-图床工具）">从零开始搭建你的免费图床系统（Cloudflare R2 + WebP Cloud + 图床工具）</h1>
<p>文章来源自：<a target="_blank" rel="noopener" href="https://www.pseudoyu.com/zh/2024/06/30/free_image_hosting_system_using_r2_webp_cloud_and_picgo/">从零开始搭建你的免费图床系统（Cloudflare R2 + WebP Cloud + PicGo） · Pseudoyu</a></p>
<h2 id="背景">背景</h2>
<p>陆陆续续两三年了，建立博客至今也有诸多文章了，有一个问题就是图片如果放在本地显示会很慢，特别是放在服务器，如果没有cdn的话，就没有如今的效果，我现在的模式就是hexo（github page+公益cdn），后话了，先回到这这里，由于图片一多，造成发送图片源位置移动的话，还要重新找，特别是我在hexo里static下的img文件夹，本身markdown显示的都是相对路径，管理起来很麻烦，如今我了解到图床的概念，不但可以统一进行管理，还能减少博客仓库的体积，提升网站速度，（虽然我现在依然保持着，源图和文档在一起，源图片直接上传到github，毕竟上传到别人服务器的数据，就怕突然有一天倒闭了，就没了，所以我依然有着备份原图片在本地的习惯），所以我接下来讲的，只是适用于，不那么重要的项目</p>
<h3 id="阿里云OSS-Picgo">阿里云OSS+Picgo</h3>
<p>阿里云oss，我个人使用来说，很方便，速度很快，结合图床来使用也是很方便的，就是唯一的缺点就是大多都是按量付费，如果内容一多，对于本身就是非盈利性的我来说，就很不妥当，通过picgo或兰空图床进行上传图片到阿里云oss，访问速度也很快，针对国内用户的访问速度明显提升（<code>费用：存储加公网访问流量费用</code>）</p>
<p>还有一个办法就是设置反向代理，你需要购买一台同区域的esc，保持和你存储桶是一个区域的，这样经过的流量就是内网流量，不会计费，但是会计算存储费用</p>
<h2 id="图床搭建说明">图床搭建说明</h2>
<p>Cloudflare R2 + WebP Cloud + 图床工具 的方案尽管牵扯到了多个组件和平台，但所有操作都在 Free Plan 中，也是我最终选定的方案，下面将从零开始介绍如何搭建这个免费图床系统。</p>
<h3 id="Cloudflare-R2">Cloudflare R2</h3>
<p>R2 是 Cloudflare 推出的免费对象存储服务，需要免费注册一个 <a target="_blank" rel="noopener" href="https://www.cloudflare.com/zh-cn/">Cloudflare 账号</a>才能使用，注册登录后，点击左侧边栏的 R2 访问服务，但需要注意的是开通 R2 服务需要绑定信用卡（国内外主流信用卡皆可），但并不会扣费，主要是为了验证用户身份使用。<code>但是我最近发现他有了paypal验证方式，有了paypal，可以直接绑定国内储蓄卡，就可以通过R2验证的银行卡验证了</code></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252131.png" alt="image-20250212151333273"></p>
<h3 id="创建存储桶">创建存储桶</h3>
<p>开通 R2 服务后，点击右上角「创建存储桶」按钮进行创建。</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252132.png" alt="image-20250212151607908"></p>
<p>进入创建配置界面后，需要填写存储桶（Bucket）名称，建议有一些辨识度，后续在配置上传时会用到。</p>
<p>位置则选择「自动」，但可以额外多配置一个位置提示，由于我后续还将使用「<a target="_blank" rel="noopener" href="https://webp.se/">WebP Cloud</a>」服务的美西机房进行图片代理优化，所以在此处选择的是「北美洲西部（WNAM）」，根据需求选其他区域也可以，但 Cloudflare 并不保证一定会分配到所指定的区域。</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252133.png" alt="image-20250212151725856"></p>
<p>进入设置</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252134.png" alt="image-20250212152030774"></p>
<p>首先我们需要打开「R2.dev 子域」，这是为了后续访问图片时需要的公网地址，点击「允许访问」，并按照提示输入「allow」即可开启。</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252135.png" alt="image-20250212152203901"></p>
<p>完成后会显示一个以 <code>r2.dev</code> 结尾的公网网址，即我们后续访问图片的网址。</p>
<p><code>自定义图床域名（可选）</code></p>
<p>但是分配的网址比较长，不易于记忆，我们可以通过「自定义域」来绑定我们的专属域名，点击「连接域」按钮，填入想要访问的域名</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252136.png" alt="image-20250212152355336"></p>
<p>然后在你域名服务商那添加dns解析，由于我是将域名托管到了cloudflare，直接自动添加解析了</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252137.png" alt="image-20250212152448801"></p>
<p>效果就是这样了</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252138.png" alt="image-20250212152555125"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252139.png" alt="image-20250212152616008"></p>
<h3 id="配置存储桶访问api">配置存储桶访问api</h3>
<p>当我们回到对象页面，上传一张测试图片</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252140.png" alt="image-20250212155704337"></p>
<p>就有链接可以进行访问了</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252141.png" alt="image-20250212155745302"></p>
<p>但是如果每次都打开cloudflare手动上传图片的话都会很麻烦。R2 提供了 S3 兼容的 API，可以方便地使用一些客户端/命令行工具进行上传、删除等操作。</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252142.png" alt="image-20250212160118209"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252143.png" alt="image-20250212160150594"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252144.png" alt="image-20250212160306528"></p>
<p>这时候就会有api令牌信息，这里的内容只会出现一次，可以记下来，但是不要给别人哦</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252145.png" alt="image-20250212160435719"></p>
<p>至此，我们需要在 Cloudflare R2 上配置的部分就完成了，接下来我们需要配置图床工具吧。</p>
<h3 id="PicGo（可选，无需服务器）">PicGo（可选，无需服务器）</h3>
<p>PicGo 是一个用于快速上传并获取图片 URL 的工具软件，有着较为丰富的插件生态，支持多种图床服务，其 GitHub 仓库为「<a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/PicGo">GitHub - Molunerfinn/PicGo</a>」，可以下载对应平台客户端使用。</p>
<h4 id="配置-R2-图床">配置 R2 图床</h4>
<p>PicGo 本体并不包括 S3 图床，但可以通过「<a target="_blank" rel="noopener" href="https://github.com/wayjam/picgo-plugin-s3">GitHub - wayjam/picgo-plugin-s3</a>」插件来支持。</p>
<p>windows下的稳定版2.3.1会出现搜索不到插件的情况,下载里面的beta版本就行了</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/PicGo/issues/1297">Bug: 插件设置页无法搜索到插件 · Issue #1297 · Molunerfinn/PicGo</a></p>
<p>我只能安装1.0.2的，第一个安装不了，无关紧要</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252146.png" alt="image-20250212160806906"></p>
<p>然后填写信息</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252147.png" alt="image-20250212161619415"></p>
<p>这里有几项配置需要尤其注意。</p>
<ul>
<li><strong>应用密钥 ID</strong>，填写 R2 API 中的 Access Key ID（访问密钥 ID）</li>
<li><strong>应用密钥</strong>，填写 R2 API 中的 Secret Access Key（机密访问密钥）</li>
<li><strong>桶名</strong>，填写 R2 中创建的 Bucket 名称，如我上文的 <code>blog-r2</code></li>
<li><strong>文件路径</strong>，上传到 R2 中的文件路径，我选择使用 <code>&#123;fileName&#125;.&#123;extName&#125;</code> 来保留原文件的文件名和扩展名。</li>
<li><strong>自定义节点</strong>，填写 R2 API 中的「为 S3 客户端使用管辖权地特定的终结点」，即 <code>xxx.r2.cloudflarestorage.com</code> 格式的 S3 Endpoint</li>
<li><strong>自定义域名</strong>，填写上文生成的 <code>xxx.r2.dev</code> 格式的域名或自定义域名，如我配置的 <code>image.qianyisky.cn</code></li>
</ul>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252148.png" alt="image-20250212162350766"></p>
<p>其他配置保持默认即可，确认参数无误后点击「确定」与「设置为默认图床」即可。</p>
<h4 id="图片上传">图片上传</h4>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252149.png" alt="image-20250212162515699"></p>
<p>完成上述配置后，我们就可以在「上传区」直接拖入文件进行图片上传了，如上传后显示无误则为配置成功，生成的链接会自动在系统剪贴板中，直接在需要的地方粘贴即可。</p>
<p>根据你想要的链接格式，我这里是markdown，就选择markdown格式，然后在相册里复制链接，在markdown文档看看</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252150.png" alt="image-20250212162638990"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252151.png" alt="image-20250212162708601"></p>
<h3 id="Lsky-Pro图床（可选，需要服务器）">Lsky Pro图床（可选，需要服务器）</h3>
<p>官网：<a target="_blank" rel="noopener" href="https://www.lsky.pro/">Lsky Pro+ - 属于您自己的云上相册。</a></p>
<p>部署教程：<a href="https://blog.qianyios.top/posts/6726/?highlight=%E5%85%B0">Lsky Pro图床 | 严千屹博客</a></p>
<p>我这里就展示自己搭建好lsky pro图床进行演示了</p>
<h4 id="创建存储策略">创建存储策略</h4>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252152.png" alt="image-20250212163327404"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252153.png" alt="image-20250212163547700"></p>
<p>确认即可</p>
<h4 id="图片上传-2">图片上传</h4>
<p>设置上传图片的限制大小为10M</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252155.png" alt="image-20250212164032388"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252156.png" alt="image-20250212164200929"></p>
<p>点击保存即可</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252157.png" alt="image-20250212164344718"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252158.png" alt="image-20250212164600963"></p>
<h3 id="两者路径修改位置">两者路径修改位置</h3>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252159.png" alt="image-20250212164651932"></p>
<p>这就是统一管理的方便性</p>
<p><code>这是lsky pro设置上传路径的位置</code></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252160.png" alt="image-20250212164754562"></p>
<p><code>这是PicGo设置上传路径的位置</code></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252161.png" alt="image-20250212165842910"></p>
<p>再去测试上传看看</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252162.png" alt="image-20250212165247121"></p>
<p>效果</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252163.png" alt="image-20250212170129233"></p>
<p>当然你可以在设置里选择这两个</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252164.png" alt="image-20250212170221106"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252165.png" alt="image-20250212170422951"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252166.png" alt="image-20250212170625037"></p>
<h2 id="WebP-Cloud-图片优化">WebP Cloud 图片优化</h2>
<p>至此我们已经完成了整个图床的搭建、配置和上传，但通常我们本地截图或是相机拍摄的图片体积较大，对于访客来说加载时间会较长，并不直接适合互联网发布。</p>
<p>根据<a target="_blank" rel="noopener" href="https://www.pseudoyu.com/zh/2024/06/30/free_image_hosting_system_using_r2_webp_cloud_and_picgo/">从零开始搭建你的免费图床系统（Cloudflare R2 + WebP Cloud + PicGo） · Pseudoyu</a>写到<a target="_blank" rel="noopener" href="https://webp.se/">WebP Cloud</a>的方法</p>
<p>它可以实现图片的压缩，加快页面显示的速度</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252167.png" alt="image-20250212171017681"></p>
<p>简单来说这是一个类 CDN 的图片代理 SaaS 服务，可以在几乎不改变画质的情况下大幅缩小图片体积，加快整体站点加载速度。发展到现在除了图片体积减少外，还提供了缓存、添加水印、图片滤镜等更多实用的功能，并提供了自定义 Header 等配置选项。</p>
<h3 id="配置webp-cloud">配置webp cloud</h3>
<p>首先通过 GitHub 授权登录 <a target="_blank" rel="noopener" href="https://dashboard.webp.se/">WebP Cloud</a> 平台。</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252168.png" alt="image-20250212171123527"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252169.png" alt="image-20250212171355857"></p>
<p>回到主页，点击创建代理</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252170.png" alt="image-20250212171450450"></p>
<ul>
<li>为了优化国内访问，我「Proxy Region」选择的是美西「Hillsboro, OR」区域</li>
<li>「Proxy Name」填写一个自定义名称即可</li>
<li>「Proxy Origin URL」，比较重要，需要填写上文我们配置好的 R2 自定义域名，如我填写的是 <code>image.qianyisky.cn</code>，如果没配置自定义域名则填写 R2 提供的 <code>xxx.r2.dev</code> 格式的域名</li>
</ul>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252171.png" alt="image-20250212171624454"></p>
<p>之后点击你创建的代理，将代理地址更新到存储策略的配置里</p>
<p><code>PicGo配置</code></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252172.png" alt="image-20250212171949706"></p>
<p><code>Lsky Pro配置</code></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252173.png" alt="image-20250212172255953"></p>
<p>再进行上传图片的测试</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252174.png" alt="image-20250212172515404"></p>
<p>就是我们通过图床工具上传的图片上传了之后，就可以通过这个<a target="_blank" rel="noopener" href="https://webp.se/"><strong>WebP Cloud Services</strong></a>提供的代理节点进行访问</p>
<p>如果觉得默认代理地址不好看，可以进行设置自定义域名</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252175.png" alt="image-20250212172818032"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252176.png" alt="image-20250212172832000"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252177.png" alt="image-20250212173135188"></p>
<p>最后确认，等待十分钟这样子，点击刷新按钮，就会更新代理地址了，然后点击启用</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252178.png" alt="image-20250212173324239"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252179.png" alt="image-20250212173345988"></p>
<p>这时候你就可以去修改之前的图床工具的代理地址了</p>
<p><a target="_blank" rel="noopener" href="https://images.qianyisky.cn/PicGo/test.png">https://images.qianyisky.cn/PicGo/test.png</a></p>
<h3 id="WebP-Cloud-用量">WebP Cloud 用量</h3>
<p>免费用户每天有 3000 Free Quota，即能够代理 3000 次图片访问请求，并提供 200M 的图片缓存，对于一般用户来说完全够用，如有一些流量较大的特定时期也可以购买额外 Quota，价格很便宜。</p>
<p>如超过了 Quota，访问则会被 301 转发到源站图片地址，不经 WebP Cloud 服务压缩，但依然可用；超过 200M 的缓存则会按照 LRU 算法清理，所以依然能够保障一些高频请求的图片能够有较好的访问体验。</p>
<h2 id="总结">总结</h2>
<p>以上就是<a target="_blank" rel="noopener" href="https://www.pseudoyu.com/zh/">Pseudoyu</a>的图床系统搭建方案，如果你的项目是在国内的服务器上，用这个方法勉强够用哦，基本都是免费订阅的</p>
<p>那么接下来就要讲到安全这几块了</p>
<p>以下内容来自<a target="_blank" rel="noopener" href="https://www.pseudoyu.com/zh/2024/07/02/protect_your_image_using_webp_and_cloudflare_waf/">使用 WebP Cloud 与 Cloudflare WAF 为你的图床添加隐私和版权保护 · Pseudoyu</a></p>
<p>可以看看作者的一个图片被盗用的经历，就可以知道隐私保护的重要性</p>
<h1 id="使用-WebP-Cloud-与-Cloudflare-WAF-为你的图床添加隐私和版权保护">使用 WebP Cloud 与 Cloudflare WAF 为你的图床添加隐私和版权保护</h1>
<p>在使用 WebP Cloud 的过程中，Pseudoyu发现它还提供了自定义 Proxy User Agent、水印等功能，于是萌生了一个想法，是不是可以通过 WebP Cloud 对Pseudoyu的图床源站链接进行保护，使 WebP Cloud 的代理链接成为访问我所有图片的唯一入口，并统一添加Pseudoyu的专属版权水印。</p>
<p>本文是对这一实践的记录，也算是图床搭建番外篇了。</p>
<h2 id="需求分析">需求分析</h2>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252180.png" alt="image-20250212175038678"></p>
<p>理论上两个地址都可以进行访问到我图床里的图片，但是前者是代理后经过处理的图，后者是直接访问cloudflare R2的原图</p>
<h3 id="隐私保护">隐私保护</h3>
<p>事实上我们通过手机、数码相机等设备拍摄的照片都会携带 EXIF(EXchangeable Image File Format) 信息，通常会包含拍摄设备、时间和地点等敏感信息，我们可以通过一些技术方式手动去除这些元数据，但操作十分繁琐且容易遗漏。</p>
<p>Pseudoyu查阅了一下 WebP Cloud 的文档，发现它果然提供自动擦除 EXIF 信息的功能，无须额外配置操作，但其实访客依然可以可以通过 Cloudflare R2 暴露出的源站信息访问到原图，为了避免这一点，我们需要限制用户只能通过 WebP Cloud 代理链接进行请求，访问 Cloudflare R2 源站链接时获取不到任何有用信息。</p>
<h3 id="版权保护">版权保护</h3>
<p>这是作者图片被盗用的经历</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252181.png" alt="image-20250212180156079"></p>
<h2 id="实现方案">实现方案</h2>
<p>需求清晰了，其实主要分为两部分：</p>
<ol>
<li>让用户只能通过 WebP Cloud 代理链接访问到我的图片，禁止直接访问原图链接</li>
<li>在 WebP Cloud 代理层面为所有的图片统一自动添加自己的版权水印，无须手动操作</li>
</ol>
<p>以下是我的实现方案与详细步骤。</p>
<h3 id="WebP-自定义-User-Agent-Cloudflare-WAF">WebP 自定义 User Agent + Cloudflare WAF</h3>
<h4 id="WebP-Cloud-配置">WebP Cloud 配置</h4>
<p>当我们访问互联网上的网页或图片链接时，请求通常会包含一个 User Agent 字段，一般包含浏览器版本等信息，网站可针对不同的 User Agent 进行一些特定逻辑处理。</p>
<p>WebP Cloud 默认会使用 <code>WebP Cloud Services/1.0</code> 作为值，也就是不论用户访问图片时使用的是什么终端设备和浏览器，请求到 Cloudflare R2 时都会被统一为 WebP Cloud 定义的 User Agent 值，而这个值又是用户可以自定义的。</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252182.png" alt="image-20250212180323061"></p>
<p>因此，我们登录 WebP Cloud 的控制台，将「Proxy User Agent」字段设置为一个自定义值，如 <code>ABC.com/1.0</code>。</p>
<p>随后更新代理</p>
<h4 id="Cloudflare-WAF-配置">Cloudflare WAF 配置</h4>
<p><a target="_blank" rel="noopener" href="https://developers.cloudflare.com/waf">WAF（Web Application Firewall）</a> 是 Cloudflare 提供的一个防火墙服务，可以自定义规则来限制特定请求以保护网站安全，登录 Cloudflare 后在左侧边栏点击「网站」，点击进入需要保护的域名，选择侧边栏「安全性」 - 「WAF」即可免费使用（注：不是最外层的账户级 WAF），免费账户可设定五个自定义规则。</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252183.png" alt="image-20250212180818002"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252184.png" alt="image-20250212180925777"></p>
<p>点击右侧的「编辑表达式」，填入以下规则：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(http.user_agent ne &quot;ABC.com/1.0&quot;) and (http.host eq &quot;image.qianyisky.cn&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252185.png" alt="image-20250212181107490"></p>
<p>其他默认，然后点击保存</p>
<blockquote>
<p>方便理解：</p>
<p>1.代理链接的User Agent会包含在网络请求里，也就是设置了<code>ABC.com/1.0</code>（<code>A钥匙</code>）</p>
<p>2.cloudflare WAF：设置了只有<code>A钥匙</code>才可以访问</p>
<p>3.一般用户浏览网页的User Agent是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36</span><br></pre></td></tr></table></figure>
<p>也就是说没有A钥匙，是访问不了的</p>
<p>4.所以在代理链接设置了A钥匙，那么他会把访问原地址的流量请求加入A钥匙，达到访问的目的，如果没有A钥匙直接访问原地址就会出现如下图</p>
</blockquote>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252186.png" alt="image-20250212181942387"></p>
<p>所以完成配置后，当我们再次访问原地址image.qianyisky.cn的时候就会被拦截，例如：</p>
<p>原地址：<a target="_blank" rel="noopener" href="https://image.qianyisky.cn/PicGo/test.png">https://image.qianyisky.cn/PicGo/test.png</a></p>
<p>代理地址：<a target="_blank" rel="noopener" href="https://images.qianyisky.cn/PicGo/test.png">https://images.qianyisky.cn/PicGo/test.png</a></p>
<p>完美实现了我们的需求。</p>
<h3 id="设置水印">设置水印</h3>
<p>我这里就设置了一个灰色的水印</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252187.png" alt="image-20250212182258376"></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252188.png" alt="image-20250212182308863"></p>
<p>设置好后保存</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252189.png" alt="image-20250212182443427"></p>
<p>由于，刚设置，只会对新上传的图片添加水印，如果你要之前上传的图片都要打上水印，你就要清除缓存，最后重新访问图片就会有水印了</p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252190.png" alt="image-20250212182549468"></p>
<p>缓存的规则：<code>目前所有代理都会有 200.00 MiB 缓存，如果超出这个限制，我们将使用“最近最少使用”（LRU）算法进行驱逐，也就是说，最少请求的内容将从缓存中驱逐。</code></p>
<p>代理地址：<a target="_blank" rel="noopener" href="https://images.qianyisky.cn/PicGo/test.png">https://images.qianyisky.cn/PicGo/test.png</a></p>
<p><img src="https://images.qianyisky.cn/boke/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F/20250212184252191.png" alt="image-20250212182812682"></p>
<div class="tbsm" style="margin-top:54px;">
<div class="tbsm-top"><span><svg t="1674654360507" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="987" data-spm-anchor-id="a313x.7781069.0.i0" width="35" height="35"><path d="M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z" fill="#66EEFF" p-id="988"></path><path d="M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z" fill="#C2F8FF" p-id="989"></path></svg></span><span style="font-size:30px;"> 特别声明</span></div>
<div class="tbsm-wz">千屹博客旗下的所有文章，是通过本人课堂学习和课外自学所精心整理的知识巨著<br/>难免会有出错的地方<br/>如果细心的你发现了小失误，可以在下方评论区告诉我，或者私信我！<br />非常感谢大家的热烈支持！</div>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.qianyios.top">严千屹</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.qianyios.top/posts/aaddb3d/">https://blog.qianyios.top/posts/aaddb3d/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.qianyios.top" target="_blank">严千屹博客</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/../img/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F%EF%BC%88Cloudflare%20R2%20+%20WebP%20Cloud%20+%20%E5%9B%BE%E5%BA%8A%E5%B7%A5%E5%85%B7%EF%BC%89/23.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxzf.png" target="_blank"><img class="post-qr-code-img" src="/img/wxzf.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zfb.png" target="_blank"><img class="post-qr-code-img" src="/img/zfb.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/14363/" title="Ubuntu 24.04.02 LTS 初始化安装"><img class="cover" src="https://i0.hdslb.com/bfs/article/64c57b77f26368cdbc45619b7d3f525655933597.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Ubuntu 24.04.02 LTS 初始化安装</div></div><div class="info-2"><div class="info-item-1">Ubuntu 24.04.02 LTS 初始化安装</div></div></div></a><a class="pagination-related" href="/posts/8c5be7b9/" title="OpenStack Antelope"><img class="cover" src="/../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">OpenStack Antelope</div></div><div class="info-2"><div class="info-item-1">OpenEuler部署2023.1（Antelope）</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%BD%A0%E7%9A%84%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%B3%BB%E7%BB%9F%EF%BC%88Cloudflare-R2-WebP-Cloud-%E5%9B%BE%E5%BA%8A%E5%B7%A5%E5%85%B7%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">从零开始搭建你的免费图床系统（Cloudflare R2 + WebP Cloud + 图床工具）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">背景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91OSS-Picgo"><span class="toc-number">1.1.1.</span> <span class="toc-text">阿里云OSS+Picgo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.</span> <span class="toc-text">图床搭建说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cloudflare-R2"><span class="toc-number">1.2.1.</span> <span class="toc-text">Cloudflare R2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E6%A1%B6"><span class="toc-number">1.2.2.</span> <span class="toc-text">创建存储桶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AD%98%E5%82%A8%E6%A1%B6%E8%AE%BF%E9%97%AEapi"><span class="toc-number">1.2.3.</span> <span class="toc-text">配置存储桶访问api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PicGo%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E6%97%A0%E9%9C%80%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89"><span class="toc-number">1.2.4.</span> <span class="toc-text">PicGo（可选，无需服务器）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-R2-%E5%9B%BE%E5%BA%8A"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">配置 R2 图床</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">图片上传</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lsky-Pro%E5%9B%BE%E5%BA%8A%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E9%9C%80%E8%A6%81%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89"><span class="toc-number">1.2.5.</span> <span class="toc-text">Lsky Pro图床（可选，需要服务器）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E7%AD%96%E7%95%A5"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">创建存储策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0-2"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">图片上传</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E8%80%85%E8%B7%AF%E5%BE%84%E4%BF%AE%E6%94%B9%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.2.6.</span> <span class="toc-text">两者路径修改位置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebP-Cloud-%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">WebP Cloud 图片优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEwebp-cloud"><span class="toc-number">1.3.1.</span> <span class="toc-text">配置webp cloud</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebP-Cloud-%E7%94%A8%E9%87%8F"><span class="toc-number">1.3.2.</span> <span class="toc-text">WebP Cloud 用量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-WebP-Cloud-%E4%B8%8E-Cloudflare-WAF-%E4%B8%BA%E4%BD%A0%E7%9A%84%E5%9B%BE%E5%BA%8A%E6%B7%BB%E5%8A%A0%E9%9A%90%E7%A7%81%E5%92%8C%E7%89%88%E6%9D%83%E4%BF%9D%E6%8A%A4"><span class="toc-number">2.</span> <span class="toc-text">使用 WebP Cloud 与 Cloudflare WAF 为你的图床添加隐私和版权保护</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E7%A7%81%E4%BF%9D%E6%8A%A4"><span class="toc-number">2.1.1.</span> <span class="toc-text">隐私保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9D%83%E4%BF%9D%E6%8A%A4"><span class="toc-number">2.1.2.</span> <span class="toc-text">版权保护</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-number">2.2.</span> <span class="toc-text">实现方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebP-%E8%87%AA%E5%AE%9A%E4%B9%89-User-Agent-Cloudflare-WAF"><span class="toc-number">2.2.1.</span> <span class="toc-text">WebP 自定义 User Agent + Cloudflare WAF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WebP-Cloud-%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">WebP Cloud 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cloudflare-WAF-%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">Cloudflare WAF 配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%B0%B4%E5%8D%B0"><span class="toc-number">2.2.2.</span> <span class="toc-text">设置水印</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"></div><div class="footer_custom_text"><span style="display: block; text-align: center; color: white;">严千屹博客</span>
<a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener" style="display: block; text-align: center; color: white; text-decoration: none; ">
  ICP备案号:粤ICP备2024250479号
</a>
<span style="display: block; text-align: center; color: white;white-space: nowrap;">本站已加入：十年之约👇
    <a href="https://www.foreverblog.cn/" target="_blank" style="display: block; text-align: center; text-decoration: none; "> <img src="https://img.foreverblog.cn/logo_en_default.png" alt="" style="width:auto;height:16px;"> </a>
</span>
<div class="post-reward" style="margin-top:11px;margin-bottom:20px"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxzf.png" target="_blank"><img class="post-qr-code-img" src="/img/wxzf.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zfb.png" target="_blank"><img class="post-qr-code-img" src="/img/zfb.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="/pluginsSrc/instant.page/instantpage.js" type="module"></script><script src="/pluginsSrc/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.qianyios.top',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.qianyios.top',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://s4.zstatic.net/ajax/libs/twikoo/1.6.39/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="/pluginsSrc/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/pluginsSrc/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>