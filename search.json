[{"title":"Mysqlé«˜å¯ç”¨æ–¹æ¡ˆ","url":"/posts/ab706382/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Mysqlé«˜å¯ç”¨æ–¹æ¡ˆ\n\n## MHA\n\n### ä»‹ç»\n\n> æŠ€æœ¯æœ‰ç‚¹è€äº†ï¼Œä»–åªèƒ½å®‰è£…åœ¨centos7ç±»ä¼¼äºel7ä¸Šï¼Œä½†æ˜¯æˆ‘å‘ç°ä»–èƒ½å®‰è£…åœ¨`openeuler24.03`ä¸Šï¼Œæ‰€ä»¥æœ¬æ¬¡å®éªŒå°±ç”¨openeulerå»åšmhaçš„ç®¡ç†èŠ‚ç‚¹ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨centos7\n\nå®˜æ–¹æ–‡æ¡£:[github](https://github.com/yoshinorim/mha4mysql-manager/wiki)\n\n**MHAé›†ç¾¤æ¶æ„**\n\n![81](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/b82f607926a055056ed66f7993a231dd697559838.png)\n\n**MHAå·¥ä½œåŸç†**\n\n![82](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/b095b30db8cdebb58e5328557397b0e3697559838.png)\n\nä¸€ã€MHA æ¦‚è¿°\n\nMySQL MHA æ˜¯ä¸€å¥—ç”± **Percona å¼€æºç»´æŠ¤**çš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦ç”¨äºè‡ªåŠ¨ç›‘æ§å’Œæ•…éšœåˆ‡æ¢ä¸»ä»æ¶æ„ä¸­çš„ä¸»èŠ‚ç‚¹ï¼ˆMasterï¼‰ã€‚å½“ä¸»åº“å‡ºç°æ•…éšœæ—¶ï¼ŒMHA èƒ½å®ç°ï¼š\n\n- **è‡ªåŠ¨æ£€æµ‹æ•…éšœ**\n- **é€‰å‡ºæœ€åˆé€‚çš„ Slave æå‡ä¸ºæ–° Master**\n- **å°†å…¶å®ƒä»åº“æŒ‡å‘æ–° Master**\n- **æœ€å°åŒ–æ•°æ®ä¸¢å¤±ï¼ˆç§’çº§åˆ‡æ¢ + Binlog æ¢å¤ï¼‰**\n- **æ”¯æŒ VIP æ¼‚ç§»ï¼Œä¿éšœä¸šåŠ¡è¿ç»­æ€§**\n\näºŒã€MHA æ•…éšœåˆ‡æ¢æµç¨‹å›¾\n\n```bash\n[ä¸»åº“å®•æœº]\n      â†“\n[Manager è§¦å‘ failover è„šæœ¬]\n      â†“\n[å°è¯•æ‹‰å–ä¸»åº“ binlog (mysqlbinlog)]\n      â†“\n[æ¯”è¾ƒå„ slave çš„ relay log å·®å¼‚]\n      â†“\n[é€‰å‡ºæœ€æ–°ã€æœ€å®Œæ•´çš„ slave]\n      â†“\n[æå‡ä¸ºæ–°çš„ master]\n      â†“\n[å…¶ä»– slave åˆ‡æ¢å¤åˆ¶å¯¹è±¡æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹]\n      â†“\n[VIP æ¼‚ç§»åˆ°æ–° master]\n```\n\nä¸‰ã€æ•…éšœåˆ‡æ¢è¯¦ç»†æ­¥éª¤\n\n1. **ä¸»åº“å¥åº·æ£€æŸ¥**\n    Manager é€šè¿‡å®šæœŸæ‰§è¡Œ `SELECT 1 AS Value` ç›‘æµ‹ Master å¥åº·çŠ¶å†µã€‚\n2. **ä¸»åº“å®•æœºè¯†åˆ«**\n    ä¸€æ—¦æ£€æµ‹å¤±è´¥ï¼ŒMHA Manager è‡ªåŠ¨è§¦å‘æ•…éšœè½¬ç§»ï¼ˆfailoverï¼‰æµç¨‹ã€‚\n3. **å°è¯•æ‹‰å– Master çš„ binlog**\n    è‹¥ä¸»åº“ SSH å¯è¿æ¥ï¼Œä½¿ç”¨ `mysqlbinlog` ä¿å­˜æœ€æ–°çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinlog Eventsï¼‰ä»¥å‡å°‘æ•°æ®ä¸¢å¤±ã€‚\n4. **è¯†åˆ«æœ€æ¥è¿‘æœ€æ–°çŠ¶æ€çš„ Slave**\n    æ¯”è¾ƒå„ä¸ª Slave çš„ relay log ä¸­ç»§æ—¥å¿—è¿›åº¦ï¼Œç¡®å®šå“ªä¸ªä»åº“æ•°æ®æœ€å®Œæ•´ã€‚\n5. **åº”ç”¨å·®å¼‚æ—¥å¿—**\n   - å¦‚æœä¸»åº“å¯è®¿é—®ï¼šåº”ç”¨ binlog åˆ°å…¶ä»–ä»åº“\n   - å¦‚æœä¸»åº“ä¸å¯è®¿é—®ï¼šé€šè¿‡å¯¹æ¯” relay log æ‰§è¡Œ `apply_diff_relay_logs`\n6. **é€‰å‡ºæ–°ä¸»åº“**\n    æå‡æœ€å®Œæ•´çš„ slave ä¸ºæ–°çš„ Masterã€‚\n7. **å…¶ä½™ä»åº“åˆ‡æ¢å¤åˆ¶å¯¹è±¡**\n    æ‰€æœ‰å…¶ä»–ä»åº“è‡ªåŠ¨æŒ‡å‘æ–°çš„ Master å¼€å¯å¤åˆ¶ã€‚\n8. **é…ç½®æ¼‚ç§»**\n   - VIP æ¼‚ç§»åˆ°æ–°çš„ä¸»åº“\n   - åº”ç”¨å±‚æ— æ„Ÿåˆ‡æ¢ï¼Œç»§ç»­å†™å…¥æ•°æ®\n9. **æ—§ Master å‰”é™¤é›†ç¾¤**\n    MHA è‡ªåŠ¨åœ¨ `app1.cnf` ä¸­ç§»é™¤æ•…éšœä¸»åº“é…ç½®ï¼ˆå¦‚ `masterha_conf_host`ï¼‰\n10. **MHA è‡ªè¡Œé€€å‡º**\n     æ•´ä¸ªæ•…éšœåˆ‡æ¢æ˜¯â€œä¸€æ¬¡æ€§â€çš„ï¼Œåˆ‡æ¢å `masterha_manager` è‡ªåŠ¨é€€å‡ºï¼Œéœ€æ‰‹åŠ¨ä¿®å¤ç¯å¢ƒåå†å¯åŠ¨ã€‚\n\n\n\nå››ã€æ–°ä¸»åº“é€‰ä¸¾é€»è¾‘\n\n- è‹¥è®¾ç½®äº† `candidate_master=1`ï¼Œä¼˜å…ˆè€ƒè™‘è¯¥ä»åº“ã€‚\n- è‹¥æŸä¸ªä»åº“è½åä¸»åº“è¶…è¿‡ `100MB` relay logï¼Œå³ä½¿æ˜¯å€™é€‰ï¼Œä¹Ÿä¼šè¢«è·³è¿‡ï¼ˆé™¤éè®¾ç½® `check_repl_delay=0`ï¼‰ã€‚\n- è‹¥å¤šä¸ªä»åº“æ•°æ®ä¸€è‡´ï¼Œåˆ™é€‰æ‹©é…ç½®æ–‡ä»¶ä¸­æ’åœ¨æœ€å‰çš„ã€‚\n- è‹¥æœ‰å·®å¼‚ï¼Œé€‰å‡º**æ•°æ®æœ€æ¥è¿‘ Master**çš„é‚£ä¸ªã€‚\n\n\n\näº”ã€æ•°æ®æ¢å¤æœºåˆ¶\n\n| æƒ…å†µ            | æ“ä½œ                                   | è„šæœ¬                    |\n| --------------- | -------------------------------------- | ----------------------- |\n| ä¸»åº“ SSH å¯ç”¨   | ä¿å­˜å¹¶åˆ†å‘ä¸»åº“ binlog åˆ°ä»åº“           | `save_binary_logs`      |\n| ä¸»åº“ SSH ä¸å¯ç”¨ | æ¯”è¾ƒå„ä¸ªä»åº“ relay logï¼Œæå–å·®å¼‚å¹¶åˆ†å‘ | `apply_diff_relay_logs` |\n\n\n\nå…­ã€MHA çš„å±€é™ä¸æ³¨æ„äº‹é¡¹\n\n1. **ä¸€æ¬¡æ€§æœºåˆ¶**\n    ä¸€æ¬¡åˆ‡æ¢å MHA Manager è‡ªåŠ¨é€€å‡ºï¼Œéœ€è¦äººå·¥ä¿®å¤ç¯å¢ƒ+é‡æ–°å¯åŠ¨ Managerã€‚\n2. **å»ºè®®å¼€å¯åŠåŒæ­¥å¤åˆ¶**\n    æ­é… MySQL åŠåŒæ­¥å¤åˆ¶å¯å¤§å¤§å‡å°‘ä¸»åº“å®•æœºæ—¶çš„æ•°æ®ä¸¢å¤±é£é™©ã€‚\n3. **å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜**\n    è‹¥ä»åº“å­˜åœ¨å»¶è¿Ÿæˆ–é”™è¯¯ï¼ŒMHA ä¼šä¸­æ­¢è‡ªåŠ¨åˆ‡æ¢ï¼Œé¿å…æå‡å‡ºé”™èŠ‚ç‚¹ä¸ºæ–°ä¸»ã€‚\n\n\n\n**MHAè½¯ä»¶**\n\nMHAè½¯ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒManagerå·¥å…·åŒ…å’ŒNodeå·¥å…·åŒ…\n\nManagerå·¥å…·åŒ…ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š\n\n```bash\nmasterha_check_ssh    æ£€æŸ¥MHAçš„SSHé…ç½®çŠ¶å†µ\nmasterha_check_repl   æ£€æŸ¥MySQLå¤åˆ¶çŠ¶å†µ\nmasterha_manger     å¯åŠ¨MHA\nmasterha_check_status  æ£€æµ‹å½“å‰MHAè¿è¡ŒçŠ¶æ€\nmasterha_master_monitor æ£€æµ‹masteræ˜¯å¦å®•æœº\nmasterha_master_switch æ•…éšœè½¬ç§»ï¼ˆè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼‰\nmasterha_conf_host   æ·»åŠ æˆ–åˆ é™¤é…ç½®çš„serverä¿¡æ¯\nmasterha_stop --conf=app1.cnf åœæ­¢MHA\nmasterha_secondary_check ä¸¤ä¸ªæˆ–å¤šä¸ªç½‘ç»œçº¿è·¯æ£€æŸ¥MySQLä¸»æœåŠ¡å™¨çš„å¯ç”¨\n```\n\nNodeå·¥å…·åŒ…ï¼š è¿™äº›å·¥å…·é€šå¸¸ç”±MHA Managerçš„è„šæœ¬è§¦å‘ï¼Œæ— éœ€äººä¸ºæ“ä½œï¼‰ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š\n\n```bash\nsave_binary_logs   #ä¿å­˜å’Œå¤åˆ¶masterçš„äºŒè¿›åˆ¶æ—¥å¿—\napply_diff_relay_logs  #è¯†åˆ«å·®å¼‚çš„ä¸­ç»§æ—¥å¿—äº‹ä»¶å¹¶å°†å…¶å·®å¼‚çš„äº‹ä»¶åº”ç”¨äºå…¶ä»–çš„slave\nfilter_mysqlbinlog  #å»é™¤ä¸å¿…è¦çš„ROLLBACKäº‹ä»¶ï¼ˆMHAå·²ä¸å†ä½¿ç”¨æ­¤å·¥å…·ï¼‰\npurge_relay_logs #æ¸…é™¤ä¸­ç»§æ—¥å¿—ï¼ˆä¸ä¼šé˜»å¡SQLçº¿ç¨‹ï¼‰\n```\n\nMHAè‡ªå®šä¹‰æ‰©å±•ï¼š\n\n```bash\nsecondary_check_script #é€šè¿‡å¤šæ¡ç½‘ç»œè·¯ç”±æ£€æµ‹masterçš„å¯ç”¨æ€§\nmaster_ip_ailover_script #æ›´æ–°Applicationä½¿ç”¨çš„masterip\nshutdown_script #å¼ºåˆ¶å…³é—­masterèŠ‚ç‚¹\nreport_script #å‘é€æŠ¥å‘Š\ninit_conf_load_script #åŠ è½½åˆå§‹é…ç½®å‚æ•°\nmaster_ip_online_change_script #æ›´æ–°masterèŠ‚ç‚¹ipåœ°å€\n```\n\nMHAé…ç½®æ–‡ä»¶ï¼š\n\n```bash\nglobalé…ç½®ï¼Œä¸ºå„applicationæä¾›é»˜è®¤é…ç½®ï¼Œé»˜è®¤æ–‡ä»¶è·¯å¾„ /etc/masterha_default.cnf\napplicationé…ç½®ï¼šä¸ºæ¯ä¸ªä¸»ä»å¤åˆ¶é›†ç¾¤\n```\n\n### å®æˆ˜æ¡ˆä¾‹\n\n#### æ¶æ„å›¾\n\n![image-20250802182710290](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/5ca081cbdb89732bbfb71b6f799bca68697559838.png) \n\n| ä¸»æœºå | ip             | å†…å­˜ | ç¡¬ç›˜ |\n| ------ | -------------- | ---- | ---- |\n| MHA    | 192.168.48.101 | 3G   | 100G |\n| master | 192.168.48.10  | 3G   | 100G |\n| slave1 | 192.168.48.11  | 3G   | 100G |\n| slave2 | 192.168.48.128 | 3G   | 100G |\n\n#### å®‰è£…mhaè½¯ä»¶\n\n`æ“ä½œèŠ‚ç‚¹:[mha]`\n\n\n\n<font color='red'>å†æ¬¡æé†’</font>ï¼Œç”±äºmhaçš„è½¯ä»¶æ²¡æœ‰æ›´æ–°ï¼Œåªæ”¯æŒel7ï¼Œä¹Ÿå°±æ˜¯centos7æˆ–è€…çº¢å¸½7çš„ç³»ç»Ÿï¼Œæ‰€ä»¥ä½ è‡ªè¡Œæ–Ÿé…Œï¼Œå…¶æ¬¡æˆ‘å‘ä»–æ˜¯å¯ä»¥å®‰è£…åœ¨openeuler24.03çš„ï¼Œæˆ‘æ‰“ç®—è¯•ä¸€ä¸‹\n\n[githubä¸»é¡µ](https://github.com/yoshinorim/)\n\n[mha4mysql-manager-0.58-0.el7.centos.noarch.rpm](https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm)\n\n[mha4mysql-node-0.58-0.el7.centos.noarch.rpm](https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm)\n\nè‡ªè¡Œä¸‹è½½è¿™ä¸¤ä¸ªè½¯ä»¶ï¼Œä¸Šä¼ åˆ°/rootä¸‹\n\n```bash\n#ç¡®å®æ˜¯æ¯”è¾ƒæ–°çš„åä¸ºæ¬§æ‹‰æ“ä½œç³»ç»Ÿå“ˆ\n[root@MHA ~]# cat /etc/os-release\nNAME=\"openEuler\"\nVERSION=\"24.03 (LTS)\"\nID=\"openEuler\"\nVERSION_ID=\"24.03\"\nPRETTY_NAME=\"openEuler 24.03 (LTS)\"\nANSI_COLOR=\"0;31\"\n#å¼€å§‹å®‰è£…\nyum install -y mha4mysql-node-0.58-0.el7.centos.noarch.rpm mha4mysql-manager-0.58-0.el7.centos.noarch.rpm\n```\n\n![image-20250802183952882](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/2a860290c2d21d1ba2ec82ca20275838697559838.png)\n\n\n\n\n\n`æ“ä½œèŠ‚ç‚¹:[å‰©ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸»ä»èŠ‚ç‚¹]`\n\né™¤MHAç®¡ç†èŠ‚ç‚¹ä¹‹å¤–ï¼Œéƒ½å®‰è£…nodeåŒ…\n\n[mha4mysql-node-0.58-0.el7.centos.noarch.rpm](https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm)\n\nè‡ªè¡Œä¸‹è½½è¿™ä¸¤ä¸ªè½¯ä»¶ï¼Œä¸Šä¼ åˆ°/rootä¸‹\n\n```bash\nyum install -y mha4mysql-node-0.58-0.el7.centos.noarch.rpm\n```\n\nokï¼Œå…¶ä»–èŠ‚ç‚¹å®‰è£…æˆåŠŸ\n\n\n\n#### æ‰€æœ‰èŠ‚ç‚¹å…å¯†\n\næ“ä½œèŠ‚ç‚¹ï¼š[MHA]\n\n##### è„šæœ¬æ–¹å¼\n\n```bash\nwget https://blog.qianyios.top/file/qy-yunwei.sh\nbash qy-yunwei.sh\n```\n\n![image-20250802185354058](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/d8d2fb794904216b07a6ac04c87eac5b697559838.png)\n\néªŒè¯ï¼Œäº’ç›¸ç™»å…¥\n\n![image-20250802185512254](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/fb2a7a1584c879131c890cdc3a98242f697559838.png)\n\néƒ½ä¸ç”¨å¯†ç \n\n##### å‘½ä»¤æ–¹å¼\n\n```bash\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\nssh-copy-id 127.0.0.1\nyum install -y rsync\nrsync -av .ssh 192.168.48.10:/root/\nrsync -av .ssh 192.168.48.11:/root/\nrsync -av .ssh 192.168.48.128:/root/\n```\n\n#### åœ¨ç®¡ç†èŠ‚ç‚¹å»ºç«‹é…ç½®æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š[MHA]\n\næŒ‰è‡ªèº«éœ€æ±‚è¿›è¡Œä¿®æ”¹\n\n```bash\nmkdir -p /etc/mastermha/ \ncat > /etc/mastermha/app1.cnf <<\"EOF\"\n[server default]\nuser=mhauser\npassword=123456\nmanager_workdir=/data/mastermha/app1/\nmanager_log=/data/mastermha/app1/manager.log\nremote_workdir=/data/mastermha/app1/\nssh_user=root\nrepl_user=repluser\nrepl_password=123456\nping_interval=1\nmaster_ip_failover_script=/usr/local/bin/master_ip_failover\nreport_script=/usr/local/bin/sendmail.sh\ncheck_repl_delay=0\nmaster_binlog_dir=/data/logbin\n[server1]\nhostname=192.168.48.10\ncandidate_master=1\nport=3306\n[server2]\nhostname=192.168.48.11\ncandidate_master=1\nport=3306\n[server3]\nhostname=192.168.48.128\nno_master=1\nport=3306\nEOF\n```\n\né…ç½®è§£æ\n\n```bash\n[server default]  # å®šä¹‰é»˜è®¤æœåŠ¡å™¨é…ç½®\nuser=mhauser  # MHAç®¡ç†ç”¨æˆ·\npassword=123456  # MHAç®¡ç†ç”¨æˆ·å¯†ç \nmanager_workdir=/data/mastermha/app1/  # MHAç®¡ç†ç›®å½•  #ç›®å½•ä¼šè‡ªåŠ¨ç”Ÿæˆ,æ— éœ€æ‰‹åŠ¨åˆ›å»º\nmanager_log=/data/mastermha/app1/manager.log  # MHAç®¡ç†æ—¥å¿—æ–‡ä»¶è·¯å¾„\nremote_workdir=/data/mastermha/app1/  # è¿œç¨‹å·¥ä½œç›®å½•\nssh_user=root  # SSHç™»å½•ç”¨æˆ·\nrepl_user=repluser  # æ•°æ®åº“ä¸»ä»å¤åˆ¶ç”¨æˆ·\nrepl_password=123456  # æ•°æ®åº“ä¸»ä»å¤åˆ¶ç”¨æˆ·å¯†ç \nping_interval=1  # å®šæœŸæ£€æµ‹ä¸»ä»å»¶è¿Ÿçš„é—´éš”ï¼ˆç§’ï¼‰\nmaster_ip_failover_script=/usr/local/bin/master_ip_failover  # ä¸»èŠ‚ç‚¹æ•…éšœåˆ‡æ¢è„šæœ¬è·¯å¾„\nreport_script=/usr/local/bin/sendmail.sh  # æ•…éšœé€šçŸ¥è„šæœ¬è·¯å¾„\ncheck_repl_delay=0  #é»˜è®¤å€¼ä¸º1,è¡¨ç¤ºå¦‚æœslaveä¸­ä»åº“è½åä¸»åº“relay logè¶…è¿‡100Mï¼Œä¸»åº“ä¸ä¼šé€‰æ‹©è¿™ä¸ªä»åº“ä¸ºæ–°çš„masterï¼Œå› ä¸ºè¿™ä¸ªä»åº“è¿›è¡Œæ¢å¤éœ€è¦å¾ˆé•¿çš„æ—¶é—´.é€šè¿‡è®¾ç½®å‚æ•°check_repl_delay=0ï¼Œmhaè§¦å‘ä¸»ä»åˆ‡æ¢æ—¶ä¼šå¿½ç•¥å¤åˆ¶çš„å»¶æ—¶ï¼Œå¯¹äºè®¾ç½®candidate_master=1çš„ä»åº“éå¸¸æœ‰ç”¨ï¼Œè¿™æ ·ç¡®ä¿è¿™ä¸ªä»åº“ä¸€å®šèƒ½æˆä¸ºæœ€æ–°çš„master\nmaster_binlog_dir=/data/logbin/  # ä¸»èŠ‚ç‚¹binlogæ–‡ä»¶ç›®å½•\n[server1]  # å®šä¹‰ç¬¬ä¸€ä¸ªæœåŠ¡å™¨é…ç½®\nhostname=192.168.48.10  # æœåŠ¡å™¨IPåœ°å€\ncandidate_master=1  # æ˜¯å¦å¯ä»¥æˆä¸ºå€™é€‰ä¸»èŠ‚ç‚¹ï¼ˆ1è¡¨ç¤ºå¯ä»¥ï¼‰\nport=3306\n[server2]  # å®šä¹‰ç¬¬äºŒä¸ªæœåŠ¡å™¨é…ç½®\nhostname=192.168.48.11  # æœåŠ¡å™¨IPåœ°å€\ncandidate_master=1  # æ˜¯å¦å¯ä»¥æˆä¸ºå€™é€‰ä¸»èŠ‚ç‚¹ï¼ˆ1è¡¨ç¤ºå¯ä»¥ï¼‰\nport=3306\n[server3]  # å®šä¹‰ç¬¬ä¸‰ä¸ªæœåŠ¡å™¨é…ç½®\nhostname=192.168.48.128  # æœåŠ¡å™¨IPåœ°å€\nport=3306\n```\n\nè¯´æ˜: ä¸»åº“å®•æœºè°æ¥æ¥ç®¡æ–°çš„master\n\n#### ç›¸å…³è„šæœ¬\n\n##### å‘Šè­¦é‚®ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š[MHA]\n\n```bash\nyum install -y mailx\n#è®¾ç½®å‘ä¿¡é‚®ç®±\ncat <<EOT >> /etc/mail.rc\nset from=xiaoohxxxxx.com\nset smtp=smtp.163.com\nset smtp-auth-user=xiaooxxxxx3.com\nset smtp-auth-password=WXxxxxxBJUYX\nEOT\n#å‘é€é‚®ä»¶\necho \"This is a test email\" | mail -s \"Test Subject\" 148xxxx067@qq.com\n```\n\n`smtp-auth-password`æ˜¯å„ä¸ªå³é”®æœåŠ¡çš„ç¬¬ä¸‰æ–¹æˆæƒç ï¼Œä¸æ˜¯ä½ çš„é‚®ç®±å¯†ç ï¼Œè¿™ä¸ªä½ å°±è‡ªå·±å»ç ”ç©¶ç ”ç©¶\n\n![image-20250802193313199](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/ef1dd5491c04396b4f706eccab4f1dbb697559838.png)\n\nå‘Šè­¦è„šæœ¬\n\n```bash\ncat > /usr/local/bin/sendmail.sh << \"EOF\"\n#!/bin/bash\necho \"MHA is failover!\" | mail -s \"MHA Warning\" 1489xxxxx.com\nEOF\nchmod +x /usr/local/bin/sendmail.sh\n```\n\n##### vipæ¼‚ç§»è„šæœ¬\n\n```bash\ncat > /usr/local/bin/master_ip_failover <<\"EOF\"\n#!/usr/bin/perl\nuse strict;\nuse warnings FATAL => 'all';\nuse Getopt::Long;\nuse MHA::DBHelper;\nmy (\n $command,    $ssh_user,     $orig_master_host,\n $orig_master_ip, $orig_master_port, $new_master_host,\n $new_master_ip, $new_master_port, $new_master_user,\n $new_master_password\n);\n#æ‰§è¡Œæ—¶å¿…é¡»åˆ é™¤ä¸‹é¢ä¸‰è¡Œæ³¨é‡Š\nmy $vip = '192.168.48.200/24'; #è®¾ç½®Virtual IP\nmy $key = \"qynet\";        #æŒ‡å®šVIPæ‰€åœ¨ç½‘å¡çš„åˆ«å\nmy $ssh_start_vip = \"/sbin/ifconfig ens160:$key $vip\";  #æŒ‡å®šVIPæ‰€åœ¨ç½‘å¡\nmy $ssh_stop_vip = \"/sbin/ifconfig ens160:$key down\";\nGetOptions(\n 'command=s'       => \\$command,\n 'ssh_user=s'      => \\$ssh_user,\n 'orig_master_host=s'  => \\$orig_master_host,\n 'orig_master_ip=s'   => \\$orig_master_ip,\n 'orig_master_port=i'  => \\$orig_master_port,\n 'new_master_host=s'   => \\$new_master_host,\n 'new_master_ip=s'    => \\$new_master_ip,\n 'new_master_port=i'   => \\$new_master_port,\n 'new_master_user=s'   => \\$new_master_user,\n 'new_master_password=s' => \\$new_master_password,\n);\nexit &main();\nsub main {\n if ( $command eq \"stop\" || $command eq \"stopssh\" ) {\n  # $orig_master_host, $orig_master_ip, $orig_master_port are passed.\n  # If you manage master ip address at global catalog database,\n  # invalidate orig_master_ip here.\n  my $exit_code = 1;\n  eval {\n   # updating global catalog, etc\n   $exit_code = 0;\n  };\n  if ($@) {\n  \twarn \"Got Error: $@\\n\";\n   exit $exit_code;\n  }\n  exit $exit_code;\n }\n  elsif ( $command eq \"start\" ) {\n    # all arguments are passed.\n    # If you manage master ip address at global catalog database,\n    # activate new_master_ip here.\n    # You can also grant write access (create user, set read_only=0, etc) here.\n    my $exit_code = 10;\n    eval {\n      print \"Enabling the VIP - $vip on the new master - $new_master_host\\n\";\n      &start_vip();\n      &stop_vip();\n      $exit_code = 0;\n    };\n    if ($@) {\n      warn $@;\n      exit $exit_code;\n    }\n    exit $exit_code;\n  }\n  elsif ( $command eq \"status\" ) {\n    print \"Checking the Status of the script.. OK \\n\";\n    `ssh $ssh_user\\@$orig_master_host \\\" $ssh_start_vip \\\"`;\n    exit 0;\n  }\n  else {\n    &usage();\n    exit 1;\n  }\n}\nsub start_vip() {\n  `ssh $ssh_user\\@$new_master_host \\\" $ssh_start_vip \\\"`;\n}\n# A simple system call that disable the VIP on the old_master \nsub stop_vip() {\n  `ssh $ssh_user\\@$orig_master_host \\\" $ssh_stop_vip \\\"`;\n}\nsub usage {\n print\n\"Usage: master_ip_failover --command=start|stop|stopssh|status --\norig_master_host=host --orig_master_ip=ip --orig_master_port=port --\nnew_master_host=host --new_master_ip=ip --new_master_port=port\\n\";\n}\nEOF\nchmod +x /usr/local/bin/master_ip_failover\n```\n\n#### å®ç°ä¸€ä¸»äºŒä»å¤åˆ¶\n\nå­¦åˆ°è¿™é‡Œï¼Œä¸»ä»å¤åˆ¶æˆ‘å°±ä¸è¯´è¿‡ç¨‹äº†ï¼Œå…·ä½“å¯ä»¥çœ‹æˆ‘çš„æ•™ç¨‹\n\n[ä¸€ä¸»å¤šä» | ä¸¥åƒå±¹åšå®¢](https://blog.qianyios.top/posts/8acdcc65/#%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E)\n\nç„¶ååˆ›å»ºå‰é¢é…ç½®æ–‡ä»¶å†™åˆ°çš„\n\nuser=mhauser  # MHAç®¡ç†ç”¨æˆ·\npassword=123456  # MHAç®¡ç†ç”¨æˆ·å¯†ç \n\næ“ä½œèŠ‚ç‚¹:[master]\n\n```bash\nmysql -uroot -p123456 -e\"create user mhauser@'192.168.48.%' identified by '123456';\"\nmysql -uroot -p123456 -e\"grant all on *.* to mhauser@'192.168.48.%';\"\n#é…ç½®vipï¼Œè¿™é‡Œå’Œå‰é¢æ¼‚ç§»è„šæœ¬ä¸­çš„è¦å¯¹åº”å“¦ï¼Œqynetæ˜¯åˆ«å\nifconfig ens160:qynet 192.168.48.200/24\n\n#ä»¥ä¸‹æ˜¯mysqlå„ä¸ªèŠ‚ç‚¹é…ç½®\nvim /etc/my.cnf\n#master\nserver-id=10\nlog-bin=/data/logbin/qylog\nskip_name_resolve=1 Â #ç¦æ­¢åå‘è§£æ\ngeneral_log #è§‚å¯Ÿç»“æœ,éå¿…é¡»é¡¹,ç”Ÿäº§æ— éœ€å¯ç”¨\n\n#slave1\nserver-id=11\nlog-bin=/data/logbin/qylog\nskip_name_resolve=1 Â #ç¦æ­¢åå‘è§£æ\nrelay_log_purge=0#ç¦ç”¨è‡ªåŠ¨æ¸…ç†ä¸­ç»§æ—¥å¿—æ–‡ä»¶\nread_only=ON #è®¾ç½®æ•°æ®åº“åªè¯»ï¼Œé’ˆå¯¹supper useræ— æ•ˆ\n#å¯åŠ¨ä¸­ç»§æ—¥å¿—\nrelay_log=/data/relaylog/relay-log #relay logçš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼hostname-relay-bin\nrelay_log_index=/data/relaylog/relay-log.index  #é»˜è®¤å€¼hostname-relay-bin.index\ngeneral_log #è§‚å¯Ÿç»“æœ,éå¿…é¡»é¡¹,ç”Ÿäº§æ— éœ€å¯ç”¨\n\n#slave2\nserver-id=128\nlog-bin=/data/logbin/qylog\nskip_name_resolve=1 Â #ç¦æ­¢åå‘è§£æ\nrelay_log_purge=0#ç¦ç”¨è‡ªåŠ¨æ¸…ç†ä¸­ç»§æ—¥å¿—æ–‡ä»¶\nread_only=ON #è®¾ç½®æ•°æ®åº“åªè¯»ï¼Œé’ˆå¯¹supper useræ— æ•ˆ\n#å¯åŠ¨ä¸­ç»§æ—¥å¿—\nrelay_log=/data/relaylog/relay-log #relay logçš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼hostname-relay-bin\nrelay_log_index=/data/relaylog/relay-log.index  #é»˜è®¤å€¼hostname-relay-bin.index\ngeneral_log #è§‚å¯Ÿç»“æœ,éå¿…é¡»é¡¹,ç”Ÿäº§æ— éœ€å¯ç”¨\n```\n\nåœ¨æ‰€æœ‰çš„ä»èŠ‚ç‚¹æ‰§è¡Œï¼Œä¸ç„¶åé¢æ£€æŸ¥mhaçš„ç¯å¢ƒä¼šæŠ¥é”™\n\n```bash\necho '[ -f /etc/profile ] && source /etc/profile' >> ~/.bashrc\n```\n\n\n\n#### æ£€æŸ¥MHAçš„ç¯å¢ƒ\n\næ“ä½œèŠ‚ç‚¹:[mha]\n\n```bash\n#è¿™ä¸ªé…ç½®æ–‡ä»¶å†™çš„ä»£ç æœ‰ç‚¹é—®é¢˜è¦æ”¹ä¸€ä¸‹ï¼Œä¸€é”®è¿è¡Œå°±è¡Œ\nsed -i '201s/.*/  my ($major, $minor) = ($str =~ m\\/(\\\\d+)\\/g); $major ||= 0; $minor ||= 0; my $result = sprintf(\"%03d%03d\", $major, $minor);/' /usr/share/perl5/vendor_perl/MHA/NodeUtil.pm\n```\n\n```bash\n#æ£€æŸ¥ç¯å¢ƒ\nmasterha_check_ssh --conf=/etc/mastermha/app1.cnf\nmasterha_check_repl --conf=/etc/mastermha/app1.cnf\n```\n\nç¬¬ä¸€æ¡ç›®å½•çš„ç»“æœ\n\n![image-20250802201203447](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/83e96dc57e1e155e644b03f91f95f2e5697559838.png)\n\nç¬¬äºŒæ¡çš„ç»“æœ\n\n![image-20250802203825254](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/b52640fc2f5cc1664a61e9e5b347a94a697559838.png)\n\n\n\n```bash\n#æŸ¥çœ‹çŠ¶æ€ï¼ˆæ²¡è¿è¡Œçš„ï¼‰\n[root@MHA ~]# masterha_check_status --conf=/etc/mastermha/app1.cnf\napp1 is stopped(2:NOT_RUNNING).\n```\n\n#### è¿è¡ŒMHA\n\n**æ‰‹åŠ¨å¯åŠ¨ MHA çš„æ•…éšœè½¬ç§»ï¼ˆFailoverï¼‰ç®¡ç†å™¨** çš„ï¼Œç”¨äºé«˜å¯ç”¨åœºæ™¯ä¸‹çš„ä¸»ä»æ•°æ®åº“åˆ‡æ¢ã€‚è¿è¡Œåå®ƒä¼šåšè¿™äº›äº‹ï¼š\n\n- æ£€æŸ¥ä¸»åº“æ˜¯å¦å­˜æ´»ï¼›\n- å¦‚æœä¸»åº“æŒ‚äº†ï¼Œè‡ªåŠ¨é€‰ä¸¾æ–°ä¸»åº“ï¼›\n- é‡æ–°é…ç½®å¤åˆ¶ç»“æ„ï¼›\n- å¤„ç† VIP ç­‰é™„å±é€»è¾‘ï¼›\n- ä»»åŠ¡å®Œæˆåå°±é€€å‡ºäº†ï¼ˆè¿™å°±æ˜¯â€œä¸€æ¬¡æ€§â€çš„æ„æ€ï¼‰âœ…ã€‚\n\n```bash\n#å¼€å¯MHA,é»˜è®¤æ˜¯å‰å°è¿è¡Œ,ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬ä¸ºåå°æ‰§è¡Œ\n#åå°è¿è¡Œï¼ˆä¸€ç›´ç›‘æµ‹ï¼‰\nnohup masterha_manager --conf=/etc/mastermha/app1.cnf --remove_dead_master_conf --ignore_last_failover &> /dev/null \n\n#æµ‹è¯•ç¯å¢ƒï¼šï¼ˆæ‰‹åŠ¨å¯åŠ¨ä¸”å‰å°è¿è¡Œï¼‰\nmasterha_manager --conf=/etc/mastermha/app1.cnf --remove_dead_master_conf --ignore_last_failover\n#è¿™æ¡å‘½ä»¤å°±æ˜¯â€œæ£€æµ‹å¹¶å¤„ç†ä¸€æ¬¡â€ï¼Œä¸€æ¬¡æ€§ï¼Œä»–ä¼šåœ¨å‰å°è¿è¡Œï¼Œå½“å‘ç°ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå¤„ç†äº†ä¸€æ¬¡æ•…éšœä¸“ä¸šå°±é€€å‡ºä»»åŠ¡äº†\n\n\n#å¦‚æœæƒ³åœæ­¢åå°æ‰§è¡Œçš„MHA,å¯ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤\n[root@mha-master ~]# masterha_stop --conf=/etc/mastermha/app1.cnf \nStopped app1 successfully.\n#æŸ¥çœ‹çŠ¶æ€\nmasterha_check_status --conf=/etc/mastermha/app1.cnf\n```\n\nåœ¨æ‰‹åŠ¨å¯åŠ¨ä¹‹åï¼Œå› ä¸ºä»–æ˜¯å‰å°è¿è¡Œçš„ï¼Œä»–å°±ä¼šæ˜¯è¿™æ ·ï¼Œæ²¡äº‹çš„\n\n![image-20250802215051798](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/c17092fc392e4a59b74fb89c331a6fbe697559838.png)\n\nå»masteræŸ¥çœ‹å¥åº·æ€§\n\n```bash\n#è¿™ä¸ªæ˜¯æ­£å¸¸å®‰è£…mysql\ntail -f /var/lib/mysql/[ä¸»æœºå].log\n#è¿™ä¸ªæ˜¯äºŒè¿›åˆ¶å®‰è£…çš„\ntail -f [mysqlçš„æ•°æ®ç›®å½•,ä¸æ˜¯å®‰è£…ç›®å½•å“ˆ]/[ä¸»æœºå].log\n#æˆ‘çš„æ˜¯äºŒè¿›åˆ¶å®‰è£…çš„\n```\n\n![image-20250802215538922](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/62287c669603db541f4c6bc9a1962a6e697559838.png)\n\n#### æ¨¡æ‹Ÿé«˜å¯ç”¨å®éªŒ\n\nåœ¨å‰é¢çš„mhaé…ç½®æ–‡ä»¶é‡Œä¸æ˜¯é…ç½®äº†\n\n![image-20250802220446987](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/ae7cc4e48b106313176ee48937f4e1bc697559838.png)\n\nmaster1å’Œslave1è¿™ä¸¤ä¸ªå¯ä»¥æˆä¸ºå€™é€‰ä¸»èŠ‚ç‚¹å—ï¼Œç°åœ¨æˆ‘æ¨¡æ‹Ÿè®©masterå…³é—­mysqldæ¨¡æ‹Ÿå®•æœºçš„æ“ä½œï¼Œ`æ³¨æ„MHAå‰å°è¦å¯åŠ¨å“¦ï¼Œä¸ç„¶æ²¡åŠæ³•çœ‹åˆ°ä¿¡æ¯ï¼Œæµ‹è¯•ç¯å¢ƒæˆ‘å°±ç”¨äº†æ‰‹åŠ¨å¯åŠ¨çš„`\n\n```bash\n#master\nsystemctl stop mysqld\n```\n\n`å¥½å§æœ¬æ¥è¯´å¯ä»¥åœ¨å‰å°çœ‹åˆ°MHAå˜åŒ–çš„ä¿¡æ¯ï¼Œçœ‹ä¸åˆ°`\n\n![image-20250802221212009](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/db55284fe14c72ec5af98b0dc4b6c01a697559838.png)\n\n`ä½†æ˜¯å®éªŒè¿˜æ˜¯æˆåŠŸçš„`\n\nmasterçš„vipå·²ç»æ¼‚ç§»è¿‡æ¥äº†äº†\n![image-20250802220927467](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/4da32e64ec988e8f8d3349b1d0ae8d07697559838.png)\n\nslave1å·²ç»å˜æˆä¸»èŠ‚ç‚¹\n\n![image-20250802220901926](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/f88b957eb54fc2e6665cab269f34e6ba697559838.png)\n\nè™½ç„¶my.cnfé…ç½®äº†åªè¯»å±æ€§ï¼Œä½†æ˜¯slave1å˜æˆä¸»èŠ‚ç‚¹ä¹‹åï¼Œåªè¯»å±æ€§ä¼šå…³é—­ï¼Œä¸ç®¡é…ç½®æ–‡ä»¶æ˜¯å¦å¼€å¯ï¼Œä»–çš„åªè¯»å±æ€§å°±ä¼šå…³é—­\n\n\n\nå¹¶ä¸”æ”¶åˆ°é‚®ä»¶äº†\n\n![image-20250802221002587](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/646134470b59fd02a384f7b91e4bdb8d697559838.png)\n\næŸ¥çœ‹slave2çš„çŠ¶æ€\n\n![image-20250802221055830](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/1b06f43408127c1765ac2c08aab17893697559838.png)\n\n\n\n\n\næœ€æœ€æœ€é‡è¦çš„æ˜¯\n\n/etc/mastermha/app1.cnf `MHAçš„é…ç½®æ–‡ä»¶é‡Œçš„masterçš„ä¿¡æ¯è¢«åˆ æ‰äº†`\n\n![image-20250802225855620](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/4b3bd4347cc7e8c803b764d5e362f4a7697559838.png)\n\n\n\n`æ¥ç€æŠŠmasterçš„mysqlå¼€èµ·æ¥`\n\nå°±æœ‰é—®é¢˜äº†\n\nvipæ²¡æœ‰æ¼‚ç§»å›æ¥ï¼Œä¸”master1æ²¡æœ‰å˜æˆä»èŠ‚ç‚¹ï¼ˆæ²¡æœ‰å¤åˆ¶ä¿¡æ¯ï¼‰ï¼Œä¹Ÿä¸æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå½“æˆ‘å°è¯•æŠŠslave1ï¼ˆä¹‹å‰å˜æˆä¸»èŠ‚ç‚¹çš„æœºå­ï¼‰,ç»™ä»–æ¨¡æ‹Ÿå®•æœºä¹‹åï¼Œipä¹Ÿæ²¡æ¼‚å›åˆ°masterï¼Œä¸”slave1çš„ä¸»ä»å¤åˆ¶ä¿¡æ¯ä¹Ÿæ²¡æœ‰å›æ¥\n\n> æ‰€ä»¥ä»–å°±æœ‰ä¸€ä¸ªçŸ­å¤„\n>\n> `MHAæ˜¯ä¸€æ¬¡æ€§çš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆ,Managerä¼šè‡ªåŠ¨é€€å‡º`\n\n\n\nå› ä¸ºæ˜¯ä¸»èŠ‚ç‚¹å®•æœºåï¼ŒMHA è‡ªåŠ¨å°† slave1 æå‡ä¸ºäº†æ–°çš„ä¸»åº“ã€‚ä¸ºä»€ä¹ˆä¼šé€‰å®ƒï¼Ÿå¯ä»¥å›çœ‹æ–‡ç« å¼€å¤´çš„æµç¨‹ã€‚\n\n> è§‚ä¼—ï¼šåšä¸»å¤§å‚»é€¼ï¼Œè¿˜ä¸ºå•¥ä¼šé€‰ä»–ï¼Œä½ é…ç½®æ–‡ä»¶å°±ä¸¤ä¸ªæœºå­æˆä¸ºäº†å€™é€‰èŠ‚ç‚¹ï¼Œä¸æ˜¯ä»–æ˜¯è°\n>\n> ![image-20250802223744304](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/ecd632545eeeca52c320abd99176e77e697559838.png)\n\nç¡®å®å“ˆå“ˆå“ˆï¼ä¸è¿‡è¦æé†’ä¸€ç‚¹ï¼šå¦‚æœå¤šä¸ªä»åº“éƒ½é…ç½®ä¸ºäº†å€™é€‰ä¸»èŠ‚ç‚¹ï¼ˆcandidate_master=1ï¼‰ï¼ŒMHA å°±ä¼šè¿›å…¥å®Œæ•´çš„å¯¹æ¯”æµç¨‹ï¼Œæ¯”è¾ƒ`å„ä¸ªå€™é€‰ slave çš„ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰`å’Œ `ä¸»èŠ‚ç‚¹binlog`åº”ç”¨ä½ç½®ï¼Œè°çš„æ•°æ®æœ€å…¨å°±é€‰è°ä½œä¸ºæ–°çš„ä¸»åº“ã€‚\n\nè€Œæˆ‘è¿™ä¸ªå®éªŒä¸­ï¼Œåªæœ‰ä¸€ä¸ª slave è¢«è®¾å®šä¸ºå€™é€‰ä¸»åº“ï¼Œæ‰€ä»¥æ²¡ä½“ç°å‡ºå¯¹æ¯”å’Œé€‰ä¸¾çš„è¿‡ç¨‹ã€‚ä½†ä½ å¾—çŸ¥é“åŸç†æ˜¯é‚£æ ·çš„å“ˆï¼\n\n\n\nè¨€å½’æ­£ä¼ ï¼Œæ€ä¹ˆæ¢å¤ä¹‹å‰çš„çŠ¶æ€å‘¢\n\næŠŠslave1çš„vipåˆ é™¤\n\n```bash\nip a del 192.168.48.200/24 dev ens160:qynet\n```\n\nåœ¨masteré‡æ–°è¿è¡Œ\n\n```bash\nip a a 192.168.48.200/24 dev ens160:qynet\n```\n\nåœ¨slave1æ¢å¤ä¸»ä»å¤åˆ¶è¿æ¥\n\n1.åœ¨masteræŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®\n\n```bash\nshow master logs;\n(root@localhost) [(none)]> show master logs;\n+--------------+-----------+-----------+\n| Log_name     | File_size | Encrypted |\n+--------------+-----------+-----------+\n| qylog.000001 |      1627 | No        |\n| qylog.000002 |       157 | No        |\n+--------------+-----------+-----------+\n2 rows in set (0.01 sec)\n```\n\n2.slave1æ‰§è¡Œå¤åˆ¶é“¾æ¥ï¼ˆè¦æ”¹ä¸ºqylog.000002 èµ·å§‹ä½ç½®157ï¼‰\n\n```bash\n#æŒ‰ç†æ¥è¯´ï¼Œå› ä¸ºæ˜¯å®•æœºï¼Œä½ éœ€è¦æŠŠä¸»èŠ‚ç‚¹çš„å…¨éƒ¨æ•°æ®æ‹·è´ä¸€ä»½åœ¨slave1è¿˜åŸæ‰è¡Œ\n#å†è¿›è¡Œä¸»ä»å¤åˆ¶ï¼Œè¿™é‡Œæˆ‘å°±çœç•¥äº†ï¼Œæˆ‘ç›´æ¥å¤åˆ¶ï¼Œå› ä¸ºæœ¬èº«æ²¡æœ‰ä»€ä¹ˆæ•°æ®è¾“å…¥\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.10', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000002', \nMASTER_LOG_POS=157,\nget_master_public_key=1;\nstart slave;\nshow slave status\\G;\n```\n\n![image-20250802224407906](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/d1a8363d9878a72ad6ea23a5fde81320697559838.png)\n\nslave2çš„ä¸»ä»å¤åˆ¶è¿æ¥ä¹Ÿè¦é‡æ–°è®¾ç½®\n\nè¿™é‡Œæ˜¯ï¼Œä¹Ÿè¦è¿›è¡Œä¸€æ¬¡ï¼Œä¸»èŠ‚ç‚¹çš„å…¨éƒ¨å¤‡ä»½åˆ°slave2è¿›è¡Œè¿˜åŸä¸€æ¬¡ï¼Œä¸ºä»€ä¹ˆå› ä¸ºä»–é™¤äº†å°‘äº†ä¸»èŠ‚ç‚¹çš„å¤‡ä»½ï¼Œä¹Ÿå°‘äº†slave1çš„ä¸€äº›å¤‡ä»½ï¼Œä½ å¯ä»¥çœ‹æ–‡ç« æœ€å¼€å¤´çš„æ¶æ„å›¾ï¼Œé˜¶æ¢¯çŠ¶çš„ï¼Œå‡è®¾slave2ä¹Ÿæ˜¯å€™é€‰èŠ‚ç‚¹ï¼Œé‚£é€‰äº†slave1æ²¡é€‰slave2,é‚£ä¸å°±æ˜¯è¯´æ˜ï¼Œslave2çš„åŒæ­¥çš„ä¿¡æ¯ä¸å¤Ÿå…¨å˜›ï¼Œæ‰€ä»¥ä¹Ÿè¦è¿›è¡Œä¸€æ¬¡é‡æ–°å¤‡ä»½ï¼Œè¿™é‡Œæˆ‘ä¹Ÿçœç•¥äº†ã€‚ä½ çŸ¥é“è¦å¤‡ä»½å°±è¡Œ\n\n```bash\nstop slave;\nreset slave all;\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.10', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000002', \nMASTER_LOG_POS=157,\nget_master_public_key=1;\nstart slave;\nshow slave status\\G;\n```\n\n\n\nåœ¨MHAèŠ‚ç‚¹é‡æ–°é…ç½®/etc/mastermha/app1.cnf\n\n```bash\nmkdir -p /etc/mastermha/ \ncat > /etc/mastermha/app1.cnf <<\"EOF\"\n[server default]\nuser=mhauser\npassword=123456\nmanager_workdir=/data/mastermha/app1/\nmanager_log=/data/mastermha/app1/manager.log\nremote_workdir=/data/mastermha/app1/\nssh_user=root\nrepl_user=repluser\nrepl_password=123456\nping_interval=1\nmaster_ip_failover_script=/usr/local/bin/master_ip_failover\nreport_script=/usr/local/bin/sendmail.sh\ncheck_repl_delay=0\nmaster_binlog_dir=/data/logbin\n[server1]\nhostname=192.168.48.10\ncandidate_master=1\nport=3306\n[server2]\nhostname=192.168.48.11\ncandidate_master=1\nport=3306\n[server3]\nhostname=192.168.48.128\nno_master=1\nport=3306\nEOF\n```\n\n```bash\n#å¯ä»¥é€‰æ‹©é‡æ–°æ£€æŸ¥ä¸€ä¸‹ç¯å¢ƒ\nmasterha_check_ssh --conf=/etc/mastermha/app1.cnf\nmasterha_check_repl --conf=/etc/mastermha/app1.cnf\n#å¹¶ä¸”ä½ å¯ä»¥é€‰æ‹©åå°æ‰§è¡Œï¼Œä¸€æ—¦åå°æ‰§è¡Œäº†å‡ºç°å®•æœºäº†ï¼Œä½ è¿˜æ˜¯è¦é‡æ–°æŒ‰è¿™ä¸ªæ¢å¤æ­¥éª¤æ¥\nmasterha_manager --conf=/etc/mastermha/app1.cnf --remove_dead_master_conf --ignore_last_failover\n```\n\n## Percona XtraDB Cluster\n\n### ä»‹ç»\n\n**âœ…Galera Cluster ç®€ä»‹**\n\n- **å¤šä¸»æ¶æ„ï¼ˆMulti-Masterï¼‰**ï¼šä»»æ„èŠ‚ç‚¹éƒ½`å¯è¯»å†™`ï¼Œæ•°æ®ä¸€è‡´ã€‚\n- **åŒæ­¥å¤åˆ¶**ï¼šäº‹åŠ¡éœ€å…¨èŠ‚ç‚¹ç¡®è®¤ï¼Œè§£å†³ä¸»ä»å»¶è¿Ÿã€‚\n- **å¹¶å‘å¤åˆ¶**ï¼šèŠ‚ç‚¹ apply é˜¶æ®µå¯å¹¶è¡Œå¤„ç†äº‹åŠ¡ã€‚\n- **è‡ªåŠ¨èŠ‚ç‚¹å…‹éš†**ï¼šæ–°èŠ‚ç‚¹å¯è‡ªåŠ¨æ‹‰å–æ•°æ®åŒæ­¥ã€‚\n- **é«˜å¯ç”¨æ€§**ï¼šæ”¯æŒçƒ­æ’æ‹”ä¸æ•…éšœå¿«é€Ÿåˆ‡æ¢ã€‚\n- **å¯¹åº”ç”¨é€æ˜**ï¼šæ— éœ€å¯¹åº”ç”¨å±‚åšé€‚é…ã€‚\n\n> é€‚ç”¨åœºæ™¯ï¼šé«˜ä¸€è‡´æ€§è¦æ±‚ã€é«˜å¯ç”¨ã€è¯»å†™æ··åˆè´Ÿè½½ã€‚\n\n**âš ï¸Galera Cluster å±€é™**\n\n- æ€§èƒ½å—æœ€æ…¢èŠ‚ç‚¹å½±å“ï¼ˆå…¨å±€éªŒè¯æœºåˆ¶ï¼‰ã€‚\n- æ–°èŠ‚ç‚¹åŠ å…¥æˆ–æ•°æ®è½åæ—¶éœ€å…¨é‡åŒæ­¥ï¼ˆSSTï¼‰ã€‚\n- **ä»…æ”¯æŒ InnoDB** å­˜å‚¨å¼•æ“ã€‚\n\n\n\nğŸ”§**æ ¸å¿ƒç»„ä»¶**\n\n- `galera-3`ï¼šå¤åˆ¶åº“\n- `WSREP`ï¼šWrite Set Replicationï¼ŒMySQL æ‰©å±•\n\n\n\nğŸ“¦ **ä¸»æµå®ç°**\n\n- **Percona XtraDB Cluster (PXC)**\n- **MariaDB Galera Cluster**\n\n> æœ€å°‘éƒ¨ç½²**3ä¸ªèŠ‚ç‚¹**ï¼Œä¸å¯å®‰è£…ç‹¬ç«‹ `mysql-server` æˆ– `mariadb-server`\n\n\n\nğŸ”Œ **PXC å·¥ä½œåŸç† & æ¶æ„**\n\n- **å¸¸ç”¨ç«¯å£**ï¼š\n  - `3306`ï¼šMySQLæœåŠ¡\n  - `4444`ï¼šSSTä¼ è¾“\n  - `4567`ï¼šç»„é€šä¿¡\n  - `4568`ï¼šISTä¼ è¾“\n- **èŠ‚ç‚¹çŠ¶æ€æµè½¬**ï¼š\n   `open â†’ primary â†’ joiner â†’ joined â†’ synced`\n- **æ•°æ®åŒæ­¥æ–¹å¼**ï¼š\n  - **SST**ï¼ˆå…¨é‡ï¼‰ï¼šxtrabackupã€rsyncã€mysqldump\n  - **IST**ï¼ˆå¢é‡ï¼‰ï¼šxtrabackupï¼ˆéœ€ GCache æ”¯æŒï¼‰\n\n\n\n1. `open`\n\n- **å«ä¹‰**ï¼šèŠ‚ç‚¹è¿›ç¨‹å·²å¯åŠ¨ï¼Œä½†å°šæœªåŠ å…¥ Galera é›†ç¾¤ã€‚\n- **çŠ¶æ€ç‰¹ç‚¹**ï¼š\n  - MySQL æœåŠ¡å·²å¯åŠ¨ï¼›\n  - èŠ‚ç‚¹è¿˜æ²¡å»ºç«‹ä¸é›†ç¾¤å…¶ä»–æˆå‘˜çš„é€šä¿¡è¿æ¥ï¼›\n  - Galera è¿˜æœªåˆå§‹åŒ–ï¼ˆå¦‚ wsrep_ready=OFFï¼‰ã€‚\n\n------\n\nğŸ‘‘ 2. `primary`\n\n- **å«ä¹‰**ï¼šèŠ‚ç‚¹æˆä¸ºä¸»åˆ†åŒºï¼ˆPrimary Componentï¼‰çš„ä¸€éƒ¨åˆ†ã€‚\n- **çŠ¶æ€ç‰¹ç‚¹**ï¼š\n  - å¤„äºå¥åº·çš„é›†ç¾¤åˆ†åŒºä¸­ï¼›\n  - å¯ä»¥å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼›\n  - å¤šæ•°èŠ‚ç‚¹ï¼ˆquorumï¼‰åœ¨çº¿æ‰èƒ½å½¢æˆ primaryï¼›\n  - è‹¥å¤±å»å¤šæ•°èŠ‚ç‚¹ï¼Œå°†è½¬ä¸º non-primaryï¼Œåœæ­¢æœåŠ¡ã€‚\n\n------\n\nğŸš€ 3. `joiner`\n\n- **å«ä¹‰**ï¼šæ–°èŠ‚ç‚¹å¼€å§‹åŠ å…¥é›†ç¾¤ï¼Œç­‰å¾…æ¥æ”¶åˆå§‹æ•°æ®ã€‚\n- **çŠ¶æ€ç‰¹ç‚¹**ï¼š\n  - é€šä¿¡é€šé“å·²å»ºç«‹ï¼›\n  - æ­£åœ¨å‡†å¤‡ SST æˆ– ISTï¼›\n  - æ­¤é˜¶æ®µèŠ‚ç‚¹ä¸èƒ½æä¾›æœåŠ¡ï¼›\n  - è¡¨ç¤ºâ€œæˆ‘è¦åŠ å…¥ï¼Œè¯·ç»™æˆ‘æ•°æ®â€ã€‚\n\n------\n\nğŸ”— 4. `joined`\n\n- **å«ä¹‰**ï¼šåˆå§‹æ•°æ®ä¼ è¾“å®Œæˆï¼Œä½†å°šæœªå®ŒæˆçŠ¶æ€ä¸€è‡´åŒæ­¥ã€‚\n- **çŠ¶æ€ç‰¹ç‚¹**ï¼š\n  - æ•°æ®å·²ç»æ‹‰å–å®Œæ¯•ï¼›\n  - æ­£åœ¨è¿›è¡Œæ•°æ®ä¸€è‡´æ€§æ ¡éªŒï¼›\n  - å‡†å¤‡è¿›å…¥åŒæ­¥é˜¶æ®µã€‚\n\n------\n\nâœ… 5. `synced`\n\n- **å«ä¹‰**ï¼šèŠ‚ç‚¹å®Œæˆæ‰€æœ‰åŒæ­¥æ“ä½œï¼Œæ­£å¼åŠ å…¥é›†ç¾¤ã€‚\n- **çŠ¶æ€ç‰¹ç‚¹**ï¼š\n  - æ•°æ®ä¸å…¶ä»–èŠ‚ç‚¹ä¸€è‡´ï¼›\n  - å¯ä»¥æ­£å¸¸è¯»å†™ï¼›\n  - Galera å¤åˆ¶æœºåˆ¶ fully readyï¼›\n  - `wsrep_local_state_comment = Synced`ã€‚\n\n\n\nğŸ§  **å…³é”®æ¨¡å—ï¼šGCache**\n\nç¼“å­˜æœ€è¿‘çš„å†™é›†ç”¨äº IST å¢é‡åŒæ­¥\n **å»ºè®®é…ç½®**ï¼š\n\n- `gcache.size = 2G~4G`\n- `gcache.mem_size`ï¼šé€‚å½“åŠ å¤§æå‡æ€§èƒ½\n- `gcache.page_size`ï¼šç£ç›˜å†™é›†é¡µå¤§å°\n\n\n\nğŸ“š å‚è€ƒæ–‡æ¡£\n\n- [Galera å®˜ç½‘](http://galeracluster.com/documentation-webpages/index.html)\n- [Percona XtraDB æ–‡æ¡£](https://www.percona.com/doc/percona-xtradb-cluster/LATEST/index.html)\n- [MariaDB Galera å…¥é—¨](https://mariadb.com/kb/en/library/getting-started-with-mariadb-galera-cluster/)\n\n\n\n### centos7äºŒè¿›åˆ¶éƒ¨ç½²pxc5.7\n\n#### æ¶æ„å›¾\n\næ‰€æœ‰ç³»ç»Ÿéƒ½æ˜¯centos7\n\n| ä¸»æœºå | ip            | å†…å­˜ | ç¡¬ç›˜ |\n| ------ | ------------- | ---- | ---- |\n| pxc1   | 192.168.48.10 | 3G   | 100G |\n| pxc2   | 192.168.48.11 | 3G   | 100G |\n| pxc3   | 192.168.48.12 | 3G   | 100G |\n| pxc4   | 192.168.48.13 | 3G   | 100G |\n\nå…³é—­é˜²ç«å¢™å’ŒSELinuxï¼Œä¿è¯æ—¶é—´åŒæ­¥ï¼Œ`è‡ªå·±æ”¹ä¸»æœºå`\n\næ³¨æ„ï¼šå¦‚æœå·²ç»å®‰è£…MySQLï¼Œå¿…é¡»å¸è½½\n\n#### å¿…å¤‡èµ„æº\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\nè¿™æ˜¯æœ¬æ¬¡å®éªŒä¼šç”¨åˆ°çš„èµ„æºï¼Œè¯·ä½ æå‰ä¸‹è½½å¥½ï¼Œä¸Šä¼ åˆ°`æ¯ä¸ªèŠ‚ç‚¹`çš„/rootä¸‹ï¼Œå› ä¸ºæˆ‘ç°åœ¨æ˜¯ç”¨çš„æ˜¯rootç”¨æˆ·\n\n`1.Percona XtraDB Cluster`ï¼š\n\nå®˜ç½‘ä¸‹è½½ï¼š[Percona-XtraDB-Cluster-5.7.31-rel34-45.3.Linux.x86_64.glibc2.12.tar.gz](https://downloads.percona.com/downloads/Percona-XtraDB-Cluster-57/Percona-XtraDB-Cluster-5.7.31-31.45-3/binary/tarball/Percona-XtraDB-Cluster-5.7.31-rel34-45.3.Linux.x86_64.glibc2.12.tar.gz)\n\n![image-20250803233325432](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/f3a31946e585430277f4c8ee95d3f5f8697559838.png)\n\næœ¬ç«™ä¸‹è½½ï¼š[Percona-XtraDB-Cluster-5.7.31-rel34-45.3.Linux.x86_64.glibc2.12.tar.gz](https://alist.qianyios.top/d/æ¸¸å®¢/è±†åŒ…haha/è¿ç»´/mysql/å®‰è£…åŒ…/Percona-XtraDB-Cluster-5.7.31-rel34-45.3.Linux.x86_64.glibc2.12.tar.gz?sign=-83k45SIlmDiJ_hMQpDjW7kZLGP6kzgEUZsHVPtYjG0=:0)\n\n> `æœ¬ç«™ä¸‹è½½çš„åŒ…ï¼Œé‚£ä¸ªåå­—å¯èƒ½ä¼šä¹±ç ï¼Œä½ è‡ªå·±æ”¹ä¸€ä¸‹å’Œæ–‡ä»¶åä¸€æ¨¡ä¸€æ ·`\n\n\n\n`2.xtrabackup`\n\nå®˜ç½‘ä¸‹è½½ï¼š[percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz](https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.27/binary/tarball/percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz)\n\n![image-20250803233918733](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/b8286c36d37f5d8faf88637baa9cdde5697559838.png)\n\næœ¬ç«™ä¸‹è½½ï¼š[percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz](https://alist.qianyios.top/d/æ¸¸å®¢/è±†åŒ…haha/è¿ç»´/mysql/å®‰è£…åŒ…/percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz?sign=ACz6_eFuWZX_T6RgCav47YUHm1b8Oo8OWfK1jwNvyf0=:0)\n\n> `æœ¬ç«™ä¸‹è½½çš„åŒ…ï¼Œé‚£ä¸ªåå­—å¯èƒ½ä¼šä¹±ç ï¼Œä½ è‡ªå·±æ”¹ä¸€ä¸‹å’Œæ–‡ä»¶åä¸€æ¨¡ä¸€æ ·`\n\n\n\n#### å®‰è£…åŸºæœ¬è½¯ä»¶\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\n```bash\nyum install libgcrypt libgcrypt-devel socat openssl-devel libaio numactl-libs libev -y \n```\n\n#### å®‰è£…xtrabackup\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\n```bash\nmkdir -p /usr/local/pxc_temp\ntar -xzf percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz --strip-components=1 -C /usr/local/pxc_temp\n\\cp -rf /usr/local/pxc_temp/bin/{xtrabackup,xbcloud,xbcloud_osenv,xbcrypt,xbstream,innobackupex} /usr/local/bin/\nchmod +x /usr/local/bin/{xtrabackup,xbcloud,xbcloud_osenv,xbcrypt,xbstream,innobackupex}\nrm -rf /usr/local/pxc_temp\n```\n\n#### åˆ›å»ºmysqlç”¨æˆ·\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\n```bash\ngroupadd mysql\nuseradd -r -g mysql -s /bin/false mysql\n```\n\n#### è§£å‹å®‰è£…åŒ…åˆ°æŒ‡å®šç›®å½•\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\n```bash\npxc_packge=$(ls | grep -i \"Percona-XtraDB-Cluster-5.7*\")\npxc_packge_filename=$(echo $pxc_packge | awk -F'.tar' '{print $1}')\ntar -xzf $pxc_packge\nmv $pxc_packge_filename /usr/local/pxc\n```\n\n#### åˆ›å»ºæœ€åŸºæœ¬çš„æ–‡ä»¶\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\n| è·¯å¾„               | è¯´æ˜            | ç¤ºä¾‹å€¼                                                  |\n| ------------------ | --------------- | ------------------------------------------------------- |\n| `basedir`          | å®‰è£…ç›®å½•        | `/usr/local/pxc`                                        |\n| `datadir`          | æ•°æ®ç›®å½•        | `/usr/local/pxc/data`                                   |\n| `my.cnf`           | è‡ªå®šä¹‰é…ç½®æ–‡ä»¶  | `/usr/local/pxc/my.cnf`                                 |\n| `mysqld.sock`      | socket æ–‡ä»¶è·¯å¾„ | `/tmp/mysql.sock`ï¼ˆæˆ– `/usr/local/pxc/tmp/mysql.sock`ï¼‰ |\n| `libgalera_smm.so` | Galera provider | `/usr/local/pxc/lib/libgalera_smm.so`                   |\n\n```bash\nmkdir -p /usr/local/pxc/{data,logs,tmp}\nchown -R mysql:mysql /usr/local/pxc\n\necho 'export PATH=/usr/local/pxc/bin:$PATH' > /etc/profile.d/pxc.sh  # å°†PXCçš„binç›®å½•åŠ å…¥ç³»ç»ŸPATH\nchmod +x /etc/profile.d/pxc.sh # è®¾ç½®è„šæœ¬å¯æ‰§è¡Œ\nsource /etc/profile.d/pxc.sh  # ç«‹å³ç”Ÿæ•ˆ\n```\n\n#### æ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\n```bash\ncluster_nodes=\"192.168.48.10,192.168.48.11,192.168.48.12\"\nsst_user=\"sstuser\"\nsst_pass=\"123456\"\n#ä½ å°±æ”¹ä¸Šé¢çš„ä¸‰é¡¹å°±è¡Œäº†\nnode_name=$(hostname)\nnode_ip=$(ip route get 1 | awk '{print $7; exit}')\nserver_id=${node_ip##*.}\n\ncat > /etc/my.cnf <<EOF\n[client]  # å®¢æˆ·ç«¯é…ç½®æ®µ\n# æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„æœ¬åœ° socket æ–‡ä»¶è·¯å¾„\nsocket=/usr/local/pxc/tmp/mysql.sock\n[mysqld]  # æœåŠ¡ç«¯é…ç½®æ®µ\n# è®¾ç½®è¯¥èŠ‚ç‚¹çš„å”¯ä¸€ server-idï¼ˆä¸€èˆ¬å– IP çš„æœ€åä¸€æ®µï¼‰\nserver-id=$server_id\n# æŒ‡å®šæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å­˜æ”¾ç›®å½•\ndatadir=/usr/local/pxc/data\n# æŒ‡å®šæœåŠ¡ç«¯ä½¿ç”¨çš„ socket æ–‡ä»¶è·¯å¾„\nsocket=/usr/local/pxc/tmp/mysql.sock\n# æŒ‡å®šé”™è¯¯æ—¥å¿—æ–‡ä»¶è·¯å¾„\nlog-error=/usr/local/pxc/logs/mysqld.log\n# æŒ‡å®šè¿›ç¨‹ ID æ–‡ä»¶è·¯å¾„\npid-file=/usr/local/pxc/data/mysqld.pid\n# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—å¹¶è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„\nlog-bin=/usr/local/pxc/logs/qybin\n# è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ä¸º ROWï¼ˆPXC è¦æ±‚ï¼‰\nbinlog_format=ROW\n# æŒ‡å®š Galera çš„å…±äº«åº“è·¯å¾„\nwsrep_provider=/usr/local/pxc/lib/libgalera_smm.so\n# æŒ‡å®šé›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ IP åˆ—è¡¨\nwsrep_cluster_address=gcomm://$cluster_nodes\n# è®¾ç½®é»˜è®¤å­˜å‚¨å¼•æ“ä¸º InnoDB\ndefault_storage_engine=InnoDB\n# è®¾ç½®ç”¨äºå¤åˆ¶çš„çº¿ç¨‹æ•°\nwsrep_slave_threads=8\n# å¯ç”¨å†²çªæ£€æµ‹æ—¥å¿—\nwsrep_log_conflicts\n# è®¾ç½®è‡ªå¢é”æ¨¡å¼ä¸º 2ï¼ˆPXC æ¨èï¼‰\ninnodb_autoinc_lock_mode=2\n# å½“å‰èŠ‚ç‚¹ç”¨äºé›†ç¾¤é€šä¿¡çš„ IP åœ°å€\nwsrep_node_address=$node_ip\n# è®¾ç½®é›†ç¾¤åç§°ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä¸€è‡´\nwsrep_cluster_name=pxc-cluster\n# è®¾ç½®å½“å‰èŠ‚ç‚¹çš„åç§°\nwsrep_node_name=$node_name\n# å¯ç”¨ PXC ä¸¥æ ¼æ¨¡å¼ï¼Œé˜²æ­¢éäº‹åŠ¡å¼•æ“ç­‰é—®é¢˜\npxc_strict_mode=ENFORCING\n# è®¾ç½® SSTï¼ˆçŠ¶æ€å¿«ç…§ä¼ è¾“ï¼‰çš„æ–¹æ³•ä¸º xtrabackup-v2\nwsrep_sst_method=xtrabackup-v2\n# é…ç½® SST ç”¨æˆ·åå’Œå¯†ç \nwsrep_sst_auth=\"$sst_user:$sst_pass\"\nEOF\nchown -R mysql:mysql /usr/local/pxc\n```\n\næ³¨æ„ï¼šå°½ç®¡Galera Clusterä¸å†éœ€è¦é€šè¿‡binlogçš„å½¢å¼è¿›è¡ŒåŒæ­¥ï¼Œä½†è¿˜æ˜¯å»ºè®®åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼ŒåŸå› æ˜¯åæœŸå¦‚æœæœ‰æ–°èŠ‚ç‚¹éœ€è¦åŠ å…¥ï¼Œè€èŠ‚ç‚¹é€šè¿‡SSTå…¨é‡ä¼ è¾“çš„æ–¹å¼å‘æ–°èŠ‚ç‚¹ä¼ è¾“æ•°æ®ï¼Œå¾ˆå¯èƒ½ä¼šæ‹–å®é›†ç¾¤æ€§èƒ½ï¼Œæ‰€ä»¥è®©æ–°èŠ‚ç‚¹å…ˆé€šè¿‡binlogæ–¹å¼å®ŒæˆåŒæ­¥åå†åŠ å…¥é›†ç¾¤ä¼šæ˜¯ä¸€ç§æ›´å¥½çš„é€‰æ‹©\n\n#### åˆå§‹åŒ–mysql\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\n```bash\n#æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦\nrm -rf /etc/init.d/mysqld\ncp /usr/local/pxc/support-files/mysql.server /etc/init.d/mysqld\n\nBASE_DIR=\"/usr/local/pxc\"\nDATA_DIR=\"$BASE_DIR/data\"\nLOGS_DIR=\"$BASE_DIR/logs\"\nTMP_DIR=\"$BASE_DIR/tmp\"\nPID_FILE=\"$DATA_DIR/mysqld.pid\" \nINIT_SCRIPT=\"/etc/init.d/mysqld\"\n\n# ä¸€é”®æ›¿æ¢ init è„šæœ¬ä¸­çš„å…³é”®è·¯å¾„\nsed -i \\\n  -e \"s|^basedir=.*|basedir=$BASE_DIR|\" \\\n  -e \"s|^datadir=.*|datadir=$DATA_DIR|\" \\\n  -e \"s|^mysqld_pid_file_path=.*|mysqld_pid_file_path=$PID_FILE|\" \\\n  \"$INIT_SCRIPT\"\n\n# ç¡®ä¿è¿è¡Œç”¨æˆ·ä¸º mysqlï¼ˆé˜²æ­¢å¯åŠ¨æƒé™é—®é¢˜ï¼‰\ngrep -q \"^user=mysql\" \"$INIT_SCRIPT\" || \\\n  sed -i \"/^app_name=/a user=mysql\" \"$INIT_SCRIPT\"\n  \n  \nsed -i 's|^PATH=\"\\(.*\\)\"|PATH=\"/usr/local/bin:\\1\"|' /etc/init.d/mysqld\n\n# ç¡®ä¿è„šæœ¬å¯æ‰§è¡Œ\nchmod +x \"$INIT_SCRIPT\"\n\n #åˆå§‹åŒ–\nrm -rf /usr/local/pxc/data/*\nrm -rf /usr/local/pxc/logs/mysqld.log\nmysqld --initialize --user=mysql --datadir=/usr/local/pxc/data\nawk '/temporary password/{print $NF}' /usr/local/pxc/logs/mysqld.log\n```\n\nå¦‚æœæœ€åä¸€å¤©æ²¡æœ‰ä¸ªéšæœºå­—ç¬¦å‡ºæ¥ï¼Œé‚£ä½ çš„mysqlåˆå§‹åŒ–å°±æ˜¯å¤±è´¥çš„ï¼Œä½ è¦æ£€æŸ¥ä¸€ä¸‹äº†ï¼Œè‡ªå·±çœ‹ä¸€ä¸‹æŠ¥é”™æ˜¯å•¥\n\n![image-20250803215220640](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/48912f6ba5383af5b18ec67ef8b961b8697559838.png)\n\n\n\n#### å¯åŠ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹\n\n`æ“ä½œèŠ‚ç‚¹:[pxc1]`\n\nä¸‰ä¸ªèŠ‚ç‚¹ä½ é€‰å“ªä¸ªéƒ½è¡Œ\n\n```bash\nservice mysqld bootstrap\n\n[root@pxc1 ~]# service mysqld bootstrap\nBootstrapping the cluster ERROR! MySQL (Percona XtraDB Cluster) is not running, but lock file (/var/lock/subsys/mysql) exists\nStarting MySQL (Percona XtraDB Cluster).... SUCCESS!\n\n[root@pxc1 ~]# ss -ntlp\n```\n\n![image-20250803164551002](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/71f4902012ee4b189d041339a8a6121e697559838.png)\n\n```bash\nMYSQL_PASSWD=\"123456\"\nMYSQL_OLD_PASSWD=$(awk '/temporary password/{print $NF}' /usr/local/pxc/logs/mysqld.log)\nmysql -uroot -p\"$MYSQL_OLD_PASSWD\" --connect-expired-password -e \"ALTER USER 'root'@'localhost' IDENTIFIED BY '123456'; FLUSH PRIVILEGES;\"\nmysql -uroot -p123456\n\n#åˆ›å»ºç”¨æˆ·çš„æ—¶å€™ï¼Œè¦å’Œå‰é¢çš„é…ç½®æ–‡ä»¶sstuserä¸€æ ·å“¦ï¼Œåˆ‡è®°ä¸€å®šå¾—æ˜¯localhostï¼Œä¸ç„¶åé¢ä¼šæŠ¥é”™\nCREATE USER 'sstuser'@'localhost' IDENTIFIED BY '123456';\nGRANT RELOAD, LOCK TABLES, PROCESS, REPLICATION CLIENT, REPLICATION SLAVE ON *.* TO 'sstuser'@'localhost';\nFLUSH PRIVILEGES;\n\nexit\n```\n\nè¿™é‡Œä¿®æ”¹årootå¯†ç ï¼Œä»¥åŠåˆ›å»ºäº†sstè´¦å·ï¼Œåé¢ç­‰å…¶ä»–èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤æ¥ï¼Œä¼šåŒæ­¥è¿‡å»\n\n![image-20250803164851177](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/c96d04e30dc570d5f34c928f7aec60f8697559838.png)\n\n#### å¯åŠ¨å…¶ä»–èŠ‚ç‚¹\n\n`æ“ä½œèŠ‚ç‚¹:[é™¤PXC1å¤–çš„èŠ‚ç‚¹]`\n\n```bash\nsystemctl daemon-reload\nservice mysqld start\n```\n\n```bash\n#ç»“æœå¦‚ä¸‹\n[root@pxc2 ~]# service mysqld start\nStarting mysqld (via systemctl):                           [  OK  ]\n[root@pxc3 ~]# service mysqld start\nStarting mysqld (via systemctl):                           [  OK  ]\n```\n\n#### æŸ¥çœ‹çŠ¶æ€\n\n`æ“ä½œèŠ‚ç‚¹:[å“ªä¸ªèŠ‚ç‚¹éƒ½è¡Œ]`\n\n```bash\n#æŸ¥çœ‹ç›¸å…³å˜é‡\nSHOW VARIABLES LIKE 'wsrep%'\\G\n......\n*************************** 7. row ***************************\nVariable_name: wsrep_cluster_address\n        Value: gcomm://192.168.48.10,192.168.48.11,192.168.48.12\n*************************** 8. row ***************************\nVariable_name: wsrep_cluster_name\n        Value: pxc-cluster\n*************************** 9. row ***************************\n......\n#æŸ¥çœ‹ç›¸å…³çŠ¶æ€å˜é‡\nSHOW STATUS LIKE 'wsrep%'\\G\n```\n\n```bash\n#æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªæˆå‘˜\nSHOW STATUS LIKE 'wsrep_cluster_size';\nSHOW VARIABLES LIKE 'wsrep_node_name';\nSHOW VARIABLES LIKE 'wsrep_node_address';\n```\n\n![image-20250803221343994](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/1ead92a3907122824bacc2bae632d3ec697559838.png)\n\nåˆ°è¿™ï¼Œpxcé›†ç¾¤å·²ç»éƒ¨ç½²æˆåŠŸäº†\n\n#### æµ‹è¯•1\n\n`æ“ä½œèŠ‚ç‚¹:[è‡ªå·±çœ‹æ³¨é‡Š]`\n\n```bash\n#åœ¨ä»»æ„èŠ‚ç‚¹åˆ›å»ºæ•°æ®åº“\n#æˆ‘è¿™é‡Œå°±æ˜¯pxc3\nmysql> create database testdb1;\nQuery OK, 1 row affected (0.00 sec)\n#pxc1æŸ¥çœ‹ï¼ŒæˆåŠŸåŒæ­¥\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n| testdb1            |\n+--------------------+\n5 rows in set (0.00 sec)\n\n#ç°åœ¨æˆ‘åˆ©ç”¨sshå·¥å…·ï¼Œè¿›è¡Œä¸€ä¸ªåŒæ—¶è¿è¡Œå‘½ä»¤çš„æ“ä½œï¼Œæˆ‘åŒæ—¶è¿è¡ŒåŒä¸€æ¡å‘½ä»¤\ncreate database testdb2;\n```\n\n![image-20250803221826389](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/03cdb202ff01571395c5d2d5a380096a697559838.png)\n\nåŸå› åˆ†æï¼š\n\nPXC æ˜¯ä¸€ä¸ª **å¤šä¸»å¤åˆ¶** çš„é›†ç¾¤ï¼Œæ‰€æœ‰èŠ‚ç‚¹ç†è®ºä¸Šéƒ½å¯ä»¥å†™å…¥ï¼Œä½†å®é™…ä¸Šæ‰€æœ‰å†™è¯·æ±‚ä¼šé€šè¿‡ Paxos åè®®ï¼ˆå³ Galera åè®®ï¼‰å®ç° **å…¨å±€åŒæ­¥æäº¤**ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´ã€‚\n\nå½“ä½ **åŒæ—¶åœ¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œç›¸åŒçš„åˆ›å»ºè¯­å¥æ—¶**ï¼Œå¯èƒ½å‘ç”Ÿä¸‹é¢çš„æƒ…å½¢ï¼š\n\n1. `pxc2` ä¸Šçš„ `CREATE DATABASE testdb2;` **ç¬¬ä¸€ä¸ªè¢«æäº¤å¹¶è¢«æ•´ä¸ªé›†ç¾¤æ¥å—**ã€‚\n2. `pxc1` å’Œ `pxc3` ä¹Ÿåœ¨æ‰§è¡Œ `CREATE DATABASE testdb2;`ï¼Œä½†æ­¤æ—¶è¿™ä¸ªæ•°æ®åº“å·²ç»è¢« `pxc2` æˆåŠŸåˆ›å»ºå¹¶åŒæ­¥è¿‡æ¥äº†ã€‚\n3. æ‰€ä»¥ `pxc1` å’Œ `pxc3` æ”¶åˆ°åŒæ­¥ä¿¡æ¯åï¼Œæœ¬åœ°å†æ‰§è¡Œæ—¶å°±å‘ç°æ•°æ®åº“å·²å­˜åœ¨ï¼ŒæŠ¥é”™ `1007`ã€‚\n\n> æ³¨æ„ï¼šè¿™ä¸ªé”™è¯¯å¹¶ä¸æ˜¯å¤åˆ¶å¤±è´¥ï¼Œè€Œæ˜¯å¹¶å‘å†™å…¥å†²çªå¯¼è‡´çš„â€œé‡å¤åˆ›å»ºâ€é”™è¯¯ã€‚\n\n![image-20250803222013960](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/f9d2b8a08953d13ec85ace38b8f13952697559838.png)\n\n\n\n**æµ‹è¯•å¤åˆ¶æ—¶é—´**\n\nä½ å…ˆè¿è¡Œæˆ‘ä¸‹é¢sqlä»£ç ï¼Œè¦é€€å‡ºmysqlï¼Œåœ¨ç»ˆç«¯è¿è¡Œï¼Œç›´æ¥å…¨é€‰å¤åˆ¶æ‰§è¡Œè¿™ä¸ªä»£ç å—\n\n```bash\ncat > testlog.sql<<\"EOF\"\ncreate table testlog (id int auto_increment primary key,name char(10),salary int default 20);\ndelimiter $$\ncreate procedure  sp_testlog() \nbegin  \ndeclare i int;\nset i = 1; \nwhile i <= 100000 \ndo  insert into testlog(name,salary) values (concat('wang',FLOOR(RAND() * 100000)),FLOOR(RAND() * 1000000)); \nset i = i +1; \nend while; \nend$$\ndelimiter ;\nEOF\n```\n\n```bash\n#ç„¶åä½ è¿™é‡Œå°±ä¼šå¤šå‡ºæ¥sqlæ–‡ä»¶\n[root@pxc1 ~]# ls testlog.sql\ntestlog.sql\n#testlog.sqlæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥ç”Ÿæˆ10wæ¡è¯­å¥\n#æ¥ç€å¯¼å…¥åˆ°æ•°æ®åº“ï¼Œæˆ‘ç°åœ¨åœ¨pcx1\nmysql -uroot -p123456 testdb1 < testlog.sql\nmysql -uroot -p123456 testdb1\n#è°ƒç”¨å‡½æ•°\ncall sp_testlog();\n```\n\nä»–åœ¨pxc1è°ƒç”¨å‡½æ•°ï¼Œä¸æ–­ç”Ÿæˆä¿¡æ¯æ’å…¥åˆ°testlogè¡¨ï¼Œç„¶åå¤åˆ¶åˆ°åˆ«çš„èŠ‚ç‚¹\n\n![image-20250803224235495](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/7362ed5d39edb6ce7acf43dae4d2b2b8697559838.png)\n\nä¸€çœ‹pxc1ç”¨äº†è¿™ä¹ˆé•¿æ—¶é—´\n\n![image-20250803224334897](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/b10640afb1fef06ba1ab6c5109812622697559838.png)\n\nè¿™å°±æ˜¯å¤šèŠ‚ç‚¹ï¼Œæ¯æäº¤ä¸€æ¬¡å‘½ä»¤å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åè¿›è¡Œå…¨å±€æ ¡éªŒï¼Œåä¸‡æ¬¡å°±æ˜¯åä¸‡æ¬¡å…¨å±€æ ¡éªŒï¼Œä¸‰ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸‰åä¸‡æ¬¡æ ¡éªŒï¼Œæ‰€ä»¥è¦è¿™ä¹ˆé•¿çš„æ—¶é—´\n\n`ä¸ºæ­¤æˆ‘ç‰¹åœ°æ‰¾äº†ä¸€ä¸ªå•èŠ‚ç‚¹çš„mysql5.7æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œåªç”¨äº†15s`\n\n![image-20250803224733909](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/0a80f9d51088ea3aecd6fd23ab128035697559838.png)\n\n\n\nå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿä½ æƒ³ä¸€ä¸‹ï¼Œæ—¢ç„¶æ¯æäº¤ä¸€æ¬¡å°±æ˜¯ä¸€æ¬¡äº‹åŠ¡ï¼Œé‚£å…¨éƒ¨æ”¾è¿›äº‹åŠ¡é‡Œä½ \n\n```bash\nbegin;call sp_testlog();commit;\n```\n\n![image-20250803225025832](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/bccea65a464404ca0fdf6dac08004f50697559838.png)\n\n\n\n**æµ‹è¯•é«˜å¯ç”¨**\n\nå½“æˆ‘å°†pxc1è¿›è¡Œå…³é—­mysqlæ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ä»ç„¶å¯ä»¥æŸ¥çœ‹æ•°æ®ç­‰æ“ä½œ\n\n```bash\n[root@pxc1 ~]# service mysqld stop\nReloading systemd:                                         [  OK  ]\nStopping mysqld (via systemctl):                           [  OK  ]\n[root@pxc1 ~]#\n\n#åœ¨pxc2èŠ‚ç‚¹è¿›è¡Œå†™æ“ä½œ\nuse testdb2;create table test(id int primary key);\nmysql> insert into test values(1);select * from test;\nQuery OK, 1 row affected (0.02 sec)\n+----+\n| id |\n+----+\n|  1 |\n+----+\n1 row in set (0.00 sec)\n\n#å…¶ä»–èŠ‚ç‚¹æŸ¥çœ‹\nuse testdb2;select * from test;\n#pxc3å’Œpxc2éƒ½æœ‰æ•°æ®éƒ½èƒ½åŒæ­¥\nmysql> use testdb2;select * from test;\nDatabase changed\n+----+\n| id |\n+----+\n|  1 |\n+----+\n1 row in set (0.00 sec)\n\n```\n\n**å½“æˆ‘åœ¨å¯¹pxc2å†æ¬¡æ¨¡æ‹Ÿä¸€ä¸ªå®•æœºï¼Œå¯ç”¨çš„å°±ä¸¤å°äº†**\n\n```bash\n[root@pxc2 ~]# service mysqld stop\n```\n\n```bash\n#pxc3èŠ‚ç‚¹å†æ¬¡æ’å…¥æ•°æ®æŸ¥çœ‹\nmysql> insert into test values(2);select * from test;\n+----+\n| id |\n+----+\n|  1 |\n|  2 |\n+----+\n#ä¾ç„¶å¯ä»¥æ“ä½œ\n```\n\n**å½“æˆ‘å›å¤å‰é¢ä¸¤ä¸ªèŠ‚ç‚¹æ—¶**\n\n```bash\n#pxc1å’Œpxc2éƒ½æ‰§è¡Œ\nservice mysqld start\n#å†æ¬¡æŸ¥çœ‹æ•°æ®pxc1å’Œpxc2éƒ½æˆåŠŸçš„åŒæ­¥äº†å…¶ä»–èŠ‚ç‚¹æ•°æ®\nmysql> use testdb2;select * from test;\n\nDatabase changed\n+----+\n| id |\n+----+\n|  1 |\n|  2 |\n+----+\n2 rows in set (0.00 sec)\n\n```\n\nè¿™å°±æ˜¯é«˜å¯ç”¨ï¼Œå“ªæ€•ä½ èŠ‚ç‚¹æ–­äº†ï¼Œå†æ¬¡å›å¤æ—¶ä¾ç„¶å¯ä»¥ç”¨\n\n#### éƒ¨ç½²æ–°å¢èŠ‚ç‚¹\n\n`æ“ä½œèŠ‚ç‚¹:[pxc4]`\n\nå°†æ–°å¢èŠ‚ç‚¹ï¼Œè‡ªå·±æ ¹æ®å‰é¢çš„æ­¥éª¤å†æ¥ä¸€æ¬¡\n\nå½“åšåˆ°[2.2.7æ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶](#æ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶)ï¼Œä½ å°±è¦æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯äº†ï¼Œ`æ³¨æ„æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ›´æ–°`ï¼Œä½†æ˜¯ä¸è¦å…³æ‰æ­£åœ¨è¿è¡Œçš„èŠ‚ç‚¹ï¼Œå°±æ›´æ–°å°±è¡Œäº†\n\n```bash\ncluster_nodes=\"192.168.48.10,192.168.48.11,192.168.48.12,192.168.48.13\"\nsst_user=\"sstuser\"\nsst_pass=\"123456\"\n#ä½ å°±æ”¹ä¸Šé¢çš„ä¸‰é¡¹å°±è¡Œäº†\nnode_name=$(hostname)\nnode_ip=$(ip route get 1 | awk '{print $7; exit}')\nserver_id=${node_ip##*.}\n\ncat > /etc/my.cnf <<EOF\n[client]  # å®¢æˆ·ç«¯é…ç½®æ®µ\n# æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„æœ¬åœ° socket æ–‡ä»¶è·¯å¾„\nsocket=/usr/local/pxc/tmp/mysql.sock\n[mysqld]  # æœåŠ¡ç«¯é…ç½®æ®µ\n# è®¾ç½®è¯¥èŠ‚ç‚¹çš„å”¯ä¸€ server-idï¼ˆä¸€èˆ¬å– IP çš„æœ€åä¸€æ®µï¼‰\nserver-id=$server_id\n# æŒ‡å®šæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å­˜æ”¾ç›®å½•\ndatadir=/usr/local/pxc/data\n# æŒ‡å®šæœåŠ¡ç«¯ä½¿ç”¨çš„ socket æ–‡ä»¶è·¯å¾„\nsocket=/usr/local/pxc/tmp/mysql.sock\n# æŒ‡å®šé”™è¯¯æ—¥å¿—æ–‡ä»¶è·¯å¾„\nlog-error=/usr/local/pxc/logs/mysqld.log\n# æŒ‡å®šè¿›ç¨‹ ID æ–‡ä»¶è·¯å¾„\npid-file=/usr/local/pxc/data/mysqld.pid\n# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—å¹¶è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„\nlog-bin=/usr/local/pxc/logs/qybin\n# è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ä¸º ROWï¼ˆPXC è¦æ±‚ï¼‰\nbinlog_format=ROW\n# æŒ‡å®š Galera çš„å…±äº«åº“è·¯å¾„\nwsrep_provider=/usr/local/pxc/lib/libgalera_smm.so\n# æŒ‡å®šé›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ IP åˆ—è¡¨\nwsrep_cluster_address=gcomm://$cluster_nodes\n# è®¾ç½®é»˜è®¤å­˜å‚¨å¼•æ“ä¸º InnoDB\ndefault_storage_engine=InnoDB\n# è®¾ç½®ç”¨äºå¤åˆ¶çš„çº¿ç¨‹æ•°\nwsrep_slave_threads=8\n# å¯ç”¨å†²çªæ£€æµ‹æ—¥å¿—\nwsrep_log_conflicts\n# è®¾ç½®è‡ªå¢é”æ¨¡å¼ä¸º 2ï¼ˆPXC æ¨èï¼‰\ninnodb_autoinc_lock_mode=2\n# å½“å‰èŠ‚ç‚¹ç”¨äºé›†ç¾¤é€šä¿¡çš„ IP åœ°å€\nwsrep_node_address=$node_ip\n# è®¾ç½®é›†ç¾¤åç§°ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä¸€è‡´\nwsrep_cluster_name=pxc-cluster\n# è®¾ç½®å½“å‰èŠ‚ç‚¹çš„åç§°\nwsrep_node_name=$node_name\n# å¯ç”¨ PXC ä¸¥æ ¼æ¨¡å¼ï¼Œé˜²æ­¢éäº‹åŠ¡å¼•æ“ç­‰é—®é¢˜\npxc_strict_mode=ENFORCING\n# è®¾ç½® SSTï¼ˆçŠ¶æ€å¿«ç…§ä¼ è¾“ï¼‰çš„æ–¹æ³•ä¸º xtrabackup-v2\nwsrep_sst_method=xtrabackup-v2\n# é…ç½® SST ç”¨æˆ·åå’Œå¯†ç \nwsrep_sst_auth=\"$sst_user:$sst_pass\"\nEOF\nchown -R mysql:mysql /usr/local/pxc\n```\n\néƒ¨ç½²åˆ°[2.2.8 åˆå§‹åŒ–mysql](#åˆå§‹åŒ–mysql)ç„¶åå¯åŠ¨èŠ‚ç‚¹\n\n```bash\n[root@pxc4 ~]# service mysqld start\nStarting mysqld (via systemctl):                           [  OK  ]\n```\n\n![image-20250803225649642](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/fdb47a22f1aaae906ab20a7fa75ffa11697559838.png)\n\n![image-20250803225729429](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/78fe080d7fd5502640fb0be01871182e697559838.png)\n\n#### é‡å¯é›†ç¾¤\n\nå½“ä½ æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å…³é—­äº†æˆ–è€…å®•æœºäº†ï¼Œä½ åšå¥½æ¢å¤å‡†å¤‡æ˜¯ä¸èƒ½ç›´æ¥å¯åŠ¨çš„\n\n```bash\n#è¿™æ¬¡æˆ‘é€‰pxc2ä¸ºå¼€å§‹çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¯åŠ¨ï¼Œå°±æŠ¥é”™äº†\n[root@pxc2 ~]# service mysqld bootstrap\nBootstrapping the cluster ERROR! MySQL (Percona XtraDB Cluster) is not running, but lock fi\nStarting MySQL (Percona XtraDB Cluster)...... ERROR! The server quit without updating PID f\n ERROR! MySQL (Percona XtraDB Cluster) server startup failed!\n\n```\n\n`grastate.dat` æ˜¯ **Percona XtraDB Clusterï¼ˆPXCï¼‰** å’Œ **Galera Cluster** ä¸­çš„ä¸€ä¸ªå…³é”®å…ƒæ•°æ®æ–‡ä»¶ï¼Œä½äº MySQL æ•°æ®ç›®å½•ä¸­ï¼ˆå¦‚ `/var/lib/mysql/grastate.dat` æˆ– `/usr/local/pxc/data/grastate.dat`ï¼‰ã€‚å®ƒç”¨äº**è®°å½•èŠ‚ç‚¹ä¸Šæ¬¡å…³é—­æ—¶çš„é›†ç¾¤çŠ¶æ€**\n\n`uuid`:èŠ‚ç‚¹æ‰€å±çš„ Galera é›†ç¾¤ UUID\n`seqno`:èŠ‚ç‚¹å…³é—­æ—¶çš„æœ€æ–°äº‹åŠ¡åºå·ï¼ˆsequence numberï¼‰ï¼Œè¶Šå¤§è¡¨ç¤ºæ•°æ®è¶Šæ–°\n`safe_to_bootstrap`:æ˜¯å¦å¯ä»¥ç”¨è¯¥èŠ‚ç‚¹æ¥å¼•å¯¼æ•´ä¸ªé›†ç¾¤ï¼š1 è¡¨ç¤ºå¯ä»¥ï¼Œ0 è¡¨ç¤ºä¸æ¨è\n\n```bash\ncat /usr/local/pxc/data/grastate.dat\n```\n\n![image-20250803232044374](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/1bc3f6642c4fd8850ed910cf149893f0697559838.png)\n\nå››ä¸ªèŠ‚ç‚¹å…¨æ˜¯`0`\n\næˆ‘ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„`safe_to_bootstrap`ä¸º1å°±è¡Œäº†ï¼Œæ¯”å¦‚è¯´ä¿®æ”¹pxc2ä¸º`safe_to_bootstrap: 1`ï¼Œå†æ¬¡å¯åŠ¨,æˆåŠŸå¯åŠ¨\n\n```bash\nservice mysqld bootstrap\n```\n\n![image-20250803232356596](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/ed9a24af679b8724ab7789765753dbe8697559838.png)\n\nå…¶ä»–èŠ‚ç‚¹ä¹ŸåŠ å…¥é›†ç¾¤\n\n```bash\nservice mysqld start\n```\n\næŸ¥çœ‹çŠ¶æ€,`é›†ç¾¤å¥åº·`\n\n```bash\nmysql -uroot -p123456 -e\"SHOW STATUS LIKE 'wsrep_cluster_size';\"\n```\n\n![image-20250803232624973](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/609e51e2dcae22359b65dd7168bfbacb697559838.png)\n\n\n\n### centos7 RPMéƒ¨ç½²PXC5.7\n\nè¿™æ˜¯æœ¬æ¬¡å®éªŒä¼šç”¨åˆ°çš„èµ„æºï¼Œè¯·ä½ æå‰ä¸‹è½½å¥½ï¼Œä¸Šä¼ åˆ°`æ¯ä¸ªèŠ‚ç‚¹`çš„`/root`ä¸‹ï¼Œå› ä¸ºæˆ‘ç°åœ¨æ˜¯ç”¨çš„æ˜¯rootç”¨æˆ·\n\nå®˜ç½‘ä¸‹è½½ï¼š[percona.com](www.percona.com/downloads)\n\n![image-20250803234342494](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/556a870ad6157bf73a576f1e840a5b8f697559838.png)\n\n#### æ¶æ„å›¾\n\næ‰€æœ‰ç³»ç»Ÿéƒ½æ˜¯centos7\n\n| ä¸»æœºå | ip            | å†…å­˜ | ç¡¬ç›˜ |\n| ------ | ------------- | ---- | ---- |\n| pxc1   | 192.168.48.10 | 3G   | 100G |\n| pxc2   | 192.168.48.11 | 3G   | 100G |\n| pxc3   | 192.168.48.12 | 3G   | 100G |\n| pxc4   | 192.168.48.13 | 3G   | 100G |\n\nå…³é—­é˜²ç«å¢™å’ŒSELinuxï¼Œä¿è¯æ—¶é—´åŒæ­¥ï¼Œ`è‡ªå·±æ”¹ä¸»æœºå`\n\næ³¨æ„ï¼šå¦‚æœå·²ç»å®‰è£…MySQLï¼Œå¿…é¡»å¸è½½\n\n#### å®‰è£…pxcè½¯ä»¶åŒ…\n\n`æ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]`\n\n```bash\nyum install -y https://repo.percona.com/yum/percona-release-latest.noarch.rpm\npercona-release setup -y ps-57\nyum localinstall Percona-XtraDB-Cluster-57-5.7.32-31.47.1.el7.x86_64.rpm \\\n                   Percona-XtraDB-Cluster-client-57-5.7.32-31.47.1.el7.x86_64.rpm \\\n                   Percona-XtraDB-Cluster-server-57-5.7.32-31.47.1.el7.x86_64.rpm \\\n                   Percona-XtraDB-Cluster-shared-57-5.7.32-31.47.1.el7.x86_64.rpm -y\n```\n\néƒ½æ˜¯å¯ä»¥æˆåŠŸå®‰è£…çš„å“¦\n\n#### è®¾ç½®é…ç½®æ–‡ä»¶\n\n`æ“ä½œèŠ‚ç‚¹:[PXC1,PXC2,PXC3]`\n\n```bash\n# é›†ç¾¤èŠ‚ç‚¹IPåˆ—è¡¨ï¼Œé€—å·åˆ†éš”ï¼Œä¿®æ”¹è¿™é‡Œå³å¯\ncluster_nodes=\"192.168.48.10,192.168.48.11,192.168.48.12\"\n# SSTåŒæ­¥ç”¨æˆ·åï¼Œä¿®æ”¹è¿™é‡Œ\nsst_user=\"sstuser\"\n# SSTåŒæ­¥å¯†ç ï¼Œä¿®æ”¹è¿™é‡Œ\nsst_pass=\"123456\"\n# è·å–å½“å‰ä¸»æœºåï¼Œä½œä¸ºèŠ‚ç‚¹åç§°\nnode_name=$(hostname)\n# è·å–é»˜è®¤è·¯ç”±IPï¼Œä½œä¸ºèŠ‚ç‚¹IP\nnode_ip=$(ip route get 1 | awk '{print $7; exit}')\n# æå–IPæœ€åä¸€æ®µæ•°å­—ï¼Œä½œä¸ºserver_idä¿è¯å”¯ä¸€\nserver_id=${node_ip##*.}\n# ç”ŸæˆGalera wsrepé…ç½®æ–‡ä»¶ï¼Œå†™å…¥ç›¸å…³å˜é‡\ncat >/etc/percona-xtradb-cluster.conf.d/wsrep.cnf<<EOF\n[mysqld]\n# Galeraæ’ä»¶è·¯å¾„\nwsrep_provider=/usr/lib64/galera3/libgalera_smm.so\n# é›†ç¾¤èŠ‚ç‚¹åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹é€—å·åˆ†éš”\nwsrep_cluster_address=gcomm://$cluster_nodes\n# binlogæ ¼å¼è®¾ä¸ºROWï¼Œä¿è¯æ•°æ®åŒæ­¥å‡†ç¡®\nbinlog_format=ROW\n# é»˜è®¤å­˜å‚¨å¼•æ“ä¸ºInnoDB\ndefault_storage_engine=InnoDB\n# å¹¶å‘å¤åˆ¶çº¿ç¨‹æ•°ï¼Œæå‡å¤åˆ¶æ•ˆç‡\nwsrep_slave_threads=8\n# è®°å½•å†²çªæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•\nwsrep_log_conflicts\n# InnoDBè‡ªå¢é”æ¨¡å¼ï¼Œæ¨è2æé«˜å¹¶å‘æ€§èƒ½\ninnodb_autoinc_lock_mode=2\n# å½“å‰èŠ‚ç‚¹IP\nwsrep_node_address=$node_ip\n# é›†ç¾¤åç§°ï¼Œä¿æŒä¸€è‡´\nwsrep_cluster_name=pxc-cluster\n# å½“å‰èŠ‚ç‚¹åç§°\nwsrep_node_name=$node_name\n# å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§\npxc_strict_mode=ENFORCING\n# SSTåŒæ­¥æ–¹å¼ï¼Œä½¿ç”¨xtrabackup-v2\nwsrep_sst_method=xtrabackup-v2\n# SSTåŒæ­¥è®¤è¯è´¦å·å¯†ç \nwsrep_sst_auth=\"$sst_user:$sst_pass\"\nEOF\n# ç”ŸæˆMySQLåŸºç¡€é…ç½®æ–‡ä»¶ï¼Œå†™å…¥server_idå’Œè·¯å¾„\ncat >/etc/percona-xtradb-cluster.conf.d/mysqld.cnf <<EOF\n[client]\n# MySQLå®¢æˆ·ç«¯socketæ–‡ä»¶ä½ç½®\nsocket=/var/lib/mysql/mysql.sock\n[mysqld]\n# å”¯ä¸€server_idï¼Œé€šå¸¸ä½¿ç”¨IPæœ€åä¸€æ®µ\nserver-id=$server_id\n# æ•°æ®ç›®å½•\ndatadir=/var/lib/mysql\n# MySQL socketæ–‡ä»¶\nsocket=/var/lib/mysql/mysql.sock\n# é”™è¯¯æ—¥å¿—æ–‡ä»¶è·¯å¾„\nlog-error=/var/log/mysqld.log\n# PIDæ–‡ä»¶è·¯å¾„\npid-file=/var/run/mysqld/mysqld.pid\n# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ”¯æŒå¤åˆ¶\nlog-bin\n# è®°å½•ä»åº“æ›´æ–°ï¼Œä¿è¯å¤åˆ¶æ­£ç¡®\nlog_slave_updates\n# è¿‡æœŸæ—¥å¿—è‡ªåŠ¨æ¸…ç†ï¼Œå•ä½ä¸ºå¤©\nexpire_logs_days=7\n# ç¦æ­¢ç¬¦å·é“¾æ¥ï¼Œå®‰å…¨è®¾ç½®\nsymbolic-links=0\nEOF\n```\n\n#### å¯åŠ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹\n\n`æ“ä½œèŠ‚ç‚¹:[PXC1]`,æ‹¿ä¸ªèŠ‚ç‚¹éƒ½è¡Œï¼Œä½ çœ‹ç€æ¥\n\n```bash\nsystemctl start mysql@bootstrap.service\nss -ntul\n```\n\n![image-20250803235835220](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/9ed8fece59e8cebf819874b67e257f73697559838.png)\n\nä¿®æ”¹rootå¯†ç ï¼Œåˆ›å»ºsstè´¦å·\n\n```bash\nMYSQL_PASSWD=\"123456\"\nMYSQL_OLD_PASSWD=$(awk '/temporary password/{print $NF}' /var/log/mysqld.log)\nmysql -uroot -p\"$MYSQL_OLD_PASSWD\" --connect-expired-password -e \"ALTER USER 'root'@'localhost' IDENTIFIED BY '123456'; FLUSH PRIVILEGES;\"\nmysql -uroot -p123456\n\nCREATE USER 'sstuser'@'localhost' IDENTIFIED BY '123456';\nGRANT RELOAD, LOCK TABLES, PROCESS, REPLICATION CLIENT ON *.* TO 'sstuser'@'localhost';\nFLUSH PRIVILEGES;\n#æŸ¥çœ‹ç›¸å…³å˜é‡\nSHOW VARIABLES LIKE 'wsrep%'\\G\n#æŸ¥çœ‹ç›¸å…³çŠ¶æ€å˜é‡\nSHOW STATUS LIKE 'wsrep%'\\G\n#é‡ç‚¹å…³æ³¨ä¸‹é¢å†…å®¹\nshow status like 'wsrep%';\n```\n\nè¿™é‡Œä¿®æ”¹årootå¯†ç ï¼Œä»¥åŠåˆ›å»ºäº†sstè´¦å·ï¼Œåé¢ç­‰å…¶ä»–èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤æ¥ï¼Œä¼šåŒæ­¥è¿‡å»\n\n![image-20250804000027129](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/a5e17d1c39c730c9ca7700ba05ede9ba697559838.png)\n\n![image-20250804000046322](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/966498eed39a41e56222411ca02ff8a9697559838.png)\n\n#### å…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤\n\n```bash\nsystemctl start mysql\n```\n\n#### æŸ¥çœ‹çŠ¶æ€\n\n```bash\nmysql -uroot -p123456\n#æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªæˆå‘˜\nSHOW STATUS LIKE 'wsrep_cluster_size';\nSHOW VARIABLES LIKE 'wsrep_node_name';\nSHOW VARIABLES LIKE 'wsrep_node_address';\n```\n\n![image-20250804000401713](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/0d7399cde3df7fef874e8920915b9726697559838.png)\n\né›†ç¾¤å¥åº·\n\n#### æµ‹è¯•\n\næµ‹è¯•ï¼Œè¯·å‰å¾€[2.2.13 æµ‹è¯•1](#æµ‹è¯•1)\n\nä½ è¦æ³¨æ„ï¼Œè¿™ä¸ªæµ‹è¯•æ˜¯äºŒè¿›åˆ¶éƒ¨ç½²pxcçš„æµ‹è¯•å†…å®¹ï¼Œå°±åªæœ‰è·¯å¾„ä¸ä¸€æ ·è¿˜æœ‰å¯åŠ¨æ–¹å¼å…³é—­é›†ç¾¤æ–¹å¼ä¸ä¸€æ ·ï¼Œä½ è‡ªå·±è¦çœ‹ä¸€ä¸‹ï¼Œåªæœ‰åœ¨mysqlé‡Œçš„æ’å…¥æ•°æ®ç­‰æ“ä½œéƒ½æ˜¯å¯ä»¥è¿™é‡Œè¿è¡Œçš„ï¼Œè‡ªå·±ç†è§£ä¸€ä¸‹ï¼Œæˆ‘è§‰å¾—ä½ èƒ½æœ‰å…´è¶£çœ‹åˆ°è¿™é‡Œï¼Œè¯´æ˜å‰é¢çš„ä½ ä¹Ÿæœ‰è®¤çœŸçœ‹ï¼Œæˆ‘å¤§éƒ¨åˆ†çš„ç†è§£å¯èƒ½éƒ½åœ¨å‰ä¸€ä¸ªç« èŠ‚ï¼ŒåŠ æ²¹ç‰¹ç§å…µ\n\n#### éƒ¨ç½²æ–°å¢èŠ‚ç‚¹\n\n`æ“ä½œèŠ‚ç‚¹:[pxc4]`\n\nåšå¥½[2.3.2å®‰è£…pxcè½¯ä»¶åŒ…](#å®‰è£…pxcè½¯ä»¶åŒ…)å’Œ[2.3.3è®¾ç½®é…ç½®æ–‡ä»¶](#è®¾ç½®é…ç½®æ–‡ä»¶)\n\næ³¨æ„ï¼Œ2.3.3è®¾ç½®é…ç½®æ–‡ä»¶ï¼Œè¦æ–°å¢èŠ‚ç‚¹ä¿¡æ¯äº†å–”ï¼ŒåŠ ä¸Špxc4çš„ipåœ°å€ï¼Œç„¶åå…¨éƒ¨èŠ‚ç‚¹éƒ½æ›´æ–°æ–‡ä»¶ï¼Œä½†æ˜¯ä¸è¦é‡å¯å·²è¿è¡Œçš„èŠ‚ç‚¹\n\n```bash\n# é›†ç¾¤èŠ‚ç‚¹IPåˆ—è¡¨ï¼Œé€—å·åˆ†éš”ï¼Œä¿®æ”¹è¿™é‡Œå³å¯\ncluster_nodes=\"192.168.48.10,192.168.48.11,192.168.48.12,192.168.48.13\"\n# SSTåŒæ­¥ç”¨æˆ·åï¼Œä¿®æ”¹è¿™é‡Œ\nsst_user=\"sstuser\"\n# SSTåŒæ­¥å¯†ç ï¼Œä¿®æ”¹è¿™é‡Œ\nsst_pass=\"123456\"\n# è·å–å½“å‰ä¸»æœºåï¼Œä½œä¸ºèŠ‚ç‚¹åç§°\nnode_name=$(hostname)\n# è·å–é»˜è®¤è·¯ç”±IPï¼Œä½œä¸ºèŠ‚ç‚¹IP\nnode_ip=$(ip route get 1 | awk '{print $7; exit}')\n# æå–IPæœ€åä¸€æ®µæ•°å­—ï¼Œä½œä¸ºserver_idä¿è¯å”¯ä¸€\nserver_id=${node_ip##*.}\n# ç”ŸæˆGalera wsrepé…ç½®æ–‡ä»¶ï¼Œå†™å…¥ç›¸å…³å˜é‡\ncat >/etc/percona-xtradb-cluster.conf.d/wsrep.cnf<<EOF\n[mysqld]\n# Galeraæ’ä»¶è·¯å¾„\nwsrep_provider=/usr/lib64/galera3/libgalera_smm.so\n# é›†ç¾¤èŠ‚ç‚¹åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹é€—å·åˆ†éš”\nwsrep_cluster_address=gcomm://$cluster_nodes\n# binlogæ ¼å¼è®¾ä¸ºROWï¼Œä¿è¯æ•°æ®åŒæ­¥å‡†ç¡®\nbinlog_format=ROW\n# é»˜è®¤å­˜å‚¨å¼•æ“ä¸ºInnoDB\ndefault_storage_engine=InnoDB\n# å¹¶å‘å¤åˆ¶çº¿ç¨‹æ•°ï¼Œæå‡å¤åˆ¶æ•ˆç‡\nwsrep_slave_threads=8\n# è®°å½•å†²çªæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•\nwsrep_log_conflicts\n# InnoDBè‡ªå¢é”æ¨¡å¼ï¼Œæ¨è2æé«˜å¹¶å‘æ€§èƒ½\ninnodb_autoinc_lock_mode=2\n# å½“å‰èŠ‚ç‚¹IP\nwsrep_node_address=$node_ip\n# é›†ç¾¤åç§°ï¼Œä¿æŒä¸€è‡´\nwsrep_cluster_name=pxc-cluster\n# å½“å‰èŠ‚ç‚¹åç§°\nwsrep_node_name=$node_name\n# å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§\npxc_strict_mode=ENFORCING\n# SSTåŒæ­¥æ–¹å¼ï¼Œä½¿ç”¨xtrabackup-v2\nwsrep_sst_method=xtrabackup-v2\n# SSTåŒæ­¥è®¤è¯è´¦å·å¯†ç \nwsrep_sst_auth=\"$sst_user:$sst_pass\"\nEOF\n# ç”ŸæˆMySQLåŸºç¡€é…ç½®æ–‡ä»¶ï¼Œå†™å…¥server_idå’Œè·¯å¾„\ncat >/etc/percona-xtradb-cluster.conf.d/mysqld.cnf <<EOF\n[client]\n# MySQLå®¢æˆ·ç«¯socketæ–‡ä»¶ä½ç½®\nsocket=/var/lib/mysql/mysql.sock\n[mysqld]\n# å”¯ä¸€server_idï¼Œé€šå¸¸ä½¿ç”¨IPæœ€åä¸€æ®µ\nserver-id=$server_id\n# æ•°æ®ç›®å½•\ndatadir=/var/lib/mysql\n# MySQL socketæ–‡ä»¶\nsocket=/var/lib/mysql/mysql.sock\n# é”™è¯¯æ—¥å¿—æ–‡ä»¶è·¯å¾„\nlog-error=/var/log/mysqld.log\n# PIDæ–‡ä»¶è·¯å¾„\npid-file=/var/run/mysqld/mysqld.pid\n# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ”¯æŒå¤åˆ¶\nlog-bin\n# è®°å½•ä»åº“æ›´æ–°ï¼Œä¿è¯å¤åˆ¶æ­£ç¡®\nlog_slave_updates\n# è¿‡æœŸæ—¥å¿—è‡ªåŠ¨æ¸…ç†ï¼Œå•ä½ä¸ºå¤©\nexpire_logs_days=7\n# ç¦æ­¢ç¬¦å·é“¾æ¥ï¼Œå®‰å…¨è®¾ç½®\nsymbolic-links=0\nEOF\n```\n\n```bash\n#å¼€å¯pxc4èŠ‚ç‚¹\nsystemctl start mysql\n```\n\næŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€\n\n```bash\nmysql -uroot -p123456\n#æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªæˆå‘˜\nSHOW STATUS LIKE 'wsrep_cluster_size';\nSHOW VARIABLES LIKE 'wsrep_node_name';\nSHOW VARIABLES LIKE 'wsrep_node_address';\n```\n\n![image-20250804001344186](../img/Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88.assets/e984ebe5d9ad4e88da69828f6b5322a9697559838.png)\n\nè‡³æ­¤PXCå®éªŒå®Œç»“\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Mysql"],"categories":["è¿ç»´"]},{"title":"å®ç°å•ç‚¹Mycatè¯»å†™åˆ†ç¦»","url":"/posts/c89451f8/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# å®ç°å•ç‚¹Mycatè¯»å†™åˆ†ç¦»\n\nä¸‹è½½é“¾æ¥1ï¼š[Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz](https://alist.qianyios.top/d/%E6%B8%B8%E5%AE%A2/%E8%B1%86%E5%8C%85haha/%E8%BF%90%E7%BB%B4/mysql/%E5%AE%89%E8%A3%85%E5%8C%85/Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz?sign=T83V18vz0xSMy6INAGV9eAzETOL7c0gxQuZA5YYWlhw=:0)\n\nä¸‹è½½é“¾æ¥2ï¼š[Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz](https://alist.qianyios.top/d/%E6%B8%B8%E5%AE%A2/R2/%E8%BF%90%E7%BB%B4/mysql/%E5%AE%89%E8%A3%85%E5%8C%85/Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz?sign=fiVJsbBnHpCcc-LiPoeFvx6TpHFj3DMkMAsSV_4rHDY=:0)\n\nå¦‚æœ‰ä¸‹è½½ä¸äº†è¯·åŠæ—¶åœ¨è¯„è®ºåŒºç•™è¨€\n\n## æ¶æ„å›¾\n\n![image-20250802140303841](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/0718ecea98764639cd8a6dd20af400de697559838.png)\n\n| ä¸»æœºå |       ip       | å†…å­˜ | ç¡¬ç›˜ |\n| :----: | :------------: | :--: | :--: |\n| master | 192.168.48.10  |  2G  | 100G |\n| slave  | 192.168.48.11  |  2G  | 100G |\n| mycat  | 192.168.48.128 | >=2G | 100G |\n| client | 192.168.48.101 |  2G  | 100G |\n\n## éƒ¨ç½²ä¸»ä»å¤åˆ¶\n\n### å®‰è£…mysql\n\næ“ä½œèŠ‚ç‚¹ï¼š[masterï¼Œslave]\n\nè¿™æ˜¯æˆ‘çš„äºŒè¿›åˆ¶mysqlå®‰è£…è„šæœ¬ï¼Œé€‚ç”¨äºå¤§éƒ¨åˆ†çš„linuxé€šç”¨å®‰è£…ï¼Œå¦‚æœä½ æœ‰è‡ªå·±çš„å®‰æ’å¯ä»¥ç›´æ¥ç•¥è¿‡è¿™ä¸ªï¼Œè‡ªå·±å®‰è£…mysql\n\n```bash\nwget https://blog.qianyios.top/file/mysql_install.sh\nbash mysql_install.sh\n```\n\n### é…ç½®master\n\n1.ä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```bash\nvim /etc/my.cnf\n##å…¶ä»–å®‰è£…mysqlçš„æ–¹æ³•ï¼Œä½ åªéœ€è¦ç¡®ä¿æœ‰å¦‚ä¸‹é€‰é¡¹å°±è¡Œäº†\n[mysqld]\nserver-id=10\nlog-bin=/data/logbin/qylog\n```\n\n`sever-id` ï¼šå¿…é¡»æ˜¯æ•´ä¸ªé›†ç¾¤é‡Œé¢å”¯ä¸€çš„ï¼Œä¸èƒ½é‡å¤\n\n`log-bin`:åç»­ä¼šåœ¨/data/logbinç”Ÿæˆqylog.000001çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è·¯å¾„å’Œæ–‡ä»¶åä¸ç”¨åŠ åç¼€\n\n```bash\nmkdir -p /data/logbin;chown -R mysql:mysql /data/logbin\nsystemctl restart mysqld\n```\n\n2.æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®\n\n```bash\nmysql -uroot -p123456\nshow master logs;\n\n(root@localhost) [(none)]> show master logs;\n+--------------+-----------+-----------+\n| Log_name     | File_size | Encrypted |\n+--------------+-----------+-----------+\n| qylog.000001 |       157 | No        |\n+--------------+-----------+-----------+\n1 row in set (0.00 sec)\n#è®°ä½è¿™ä¸ªqylog.000001å’Œ157ï¼Œä¸»ä»å¤åˆ¶è¦ç”¨åˆ°\n```\n\n3.åˆ›å»ºä¼ è¾“è´¦å·\n\n```bash\ncreate user repluser@'192.168.48.%' identified by '123456';\ngrant replication slave on *.* to repluser@'192.168.48.%';\n```\n\n### é…ç½®ä»èŠ‚ç‚¹\n\n1.ä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```bash\n#å…¶ä»–å®‰è£…mysqlçš„æ–¹æ³•ï¼Œä½ åªéœ€è¦ç¡®ä¿æœ‰å¦‚ä¸‹é€‰é¡¹å°±è¡Œäº†\n[mysqld]\nserver-id=11\nlog-bin=/data/logbin/qylog\nread_only=ON #è®¾ç½®æ•°æ®åº“åªè¯»ï¼Œé’ˆå¯¹supper useræ— æ•ˆ\n#å¯åŠ¨ä¸­ç»§æ—¥å¿—\nrelay_log=/data/relaylog/relay-log #relay logçš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼hostname-relay-bin\nrelay_log_index=/data/relaylog/relay-log.index  #é»˜è®¤å€¼hostname-relay-bin.index  \n```\n\n`sever-id` ï¼šå¿…é¡»æ˜¯æ•´ä¸ªé›†ç¾¤é‡Œé¢å”¯ä¸€çš„ï¼Œä¸èƒ½é‡å¤\n\n`log-bin`:åç»­ä¼šåœ¨/data/logbinç”Ÿæˆqylog.000001çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è·¯å¾„å’Œæ–‡ä»¶åä¸ç”¨åŠ åç¼€\n\n```bash\nmkdir -p /data/logbin /data/relaylog\nchown -R mysql:mysql /data/logbin /data/relaylog\nsystemctl restart mysqld\n```\n\n### å¯åŠ¨å¤åˆ¶çº¿ç¨‹\n\næ“ä½œèŠ‚ç‚¹ï¼š[slave]\n\n```bash\nmysql -u root -p123456\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.10', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000001', \nMASTER_LOG_POS=157,\nget_master_public_key=1; \nstart slave;\nshow slave status\\G;\n```\n\nç¡®ä¿æœ‰ä¸¤ä¸ªyeså°±è¡Œäº†\n\n![image-20250802111633490](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/e2c2d7f796758078e038b3d3472cfc13697559838.png)\n\nå¦‚æœä½ æƒ³é‡ç½®çº¿ç¨‹å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤\n\n```bash\nstop slave;\nreset slave;\n```\n\n   æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹ï¼Œå› ä¸ºäºŒè¿›åˆ¶æ—¥å¿—æ˜¯è®°å½•ä½ çš„æ“ä½œçš„å˜›ï¼Œæˆ‘ä»¬åœ¨å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ä¹‹åï¼Œä¸æ˜¯åœ¨`ä¸»èŠ‚ç‚¹`åˆ›å»ºäº†ä¸€ä¸ªrepluserç”¨æˆ·å—ï¼Œé‚£è¿™ä¸ªæ“ä½œè‚¯å®šä¹Ÿè¢«è®°å½•ï¼Œç„¶åè¿™ä¸æ˜¯ä¸»ä»å¤åˆ¶äº†å—ï¼Œè¿™é‡Œè‚¯å®šï¼Œä¹Ÿä¼šåŒæ­¥ï¼Œä¹Ÿä¼šè¿è¡Œï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æœ¬èº«å°±æ˜¯ä¸€ä¸ªsqlæ–‡ä»¶ï¼Œæ™®é€šcatæ˜¯çœ‹ä¸äº†ï¼Œä½ å¾—ç”¨è¿™ä¸ªå‘½ä»¤\n\n```bash\n[root@master ~]# mysqlbinlog -uroot -p123456 /data/logbin/qylog.000001 -v\n```\n\n![image-20250802111808465](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/45c889344e0bb1ae52efdfbca65dbde5697559838.png)\n\næ‰€æœ‰æ—¢ç„¶ä¸»ä»å¤åˆ¶äº†ï¼Œé‚£åœ¨ä»èŠ‚ç‚¹ï¼Œåº”è¯¥ä¹Ÿè¿è¡Œäº†è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±è¯´æ˜ä»èŠ‚ç‚¹ä¹Ÿæœ‰è¿™ä¸ªè´¦å·\n\n```bash\nselect host,user from mysql.user;\n```\n\n![image-20250802111832716](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/6d128299efb2e1530ef75cf3c0511be2697559838.png)\n\n### æµ‹è¯•\n\næ¥ä¸‹æ¥åœ¨ä¸»èŠ‚ç‚¹å¯¼å…¥æµ‹è¯•æ•°æ®\n\nå…¨é€‰å¤åˆ¶ç²˜è´´`é€€å‡ºmysql`è¿è¡Œ\n\n```bash\ncat > hellodb.sql <<\"EOF\"\n\nCREATE DATABASE /*!32312 IF NOT EXISTS*/ `hellodb` /*!40100 DEFAULT CHARACTER SET utf8 */;\nUSE `hellodb`;\n\nDROP TABLE IF EXISTS `classes`;\nCREATE TABLE `classes` (\n  `ClassID` tinyint(3) unsigned NOT NULL AUTO_INCREMENT,\n  `Class` varchar(100) DEFAULT NULL,\n  `NumOfStu` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ClassID`)\n) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `classes` WRITE;\nINSERT INTO `classes` VALUES\n(1,'Shaolin Pai',10),(2,'Emei Pai',7),\n(3,'QingCheng Pai',11),(4,'Wudang Pai',12),(5,'Riyue Shenjiao',31),\n(6,'Lianshan Pai',27),(7,'Ming Jiao',27),(8,'Xiaoyao Pai',15);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `coc`;\nCREATE TABLE `coc` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `ClassID` tinyint(3) unsigned NOT NULL,\n  `CourseID` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `coc` WRITE;\nINSERT INTO `coc` VALUES (1,1,2),(2,1,5),(3,2,2),(4,2,6),(5,3,1),(6,3,7),(7,4,5),(8,4,2),(9,5,1),(10,5,9),(11,6,3),(12,6,4),(13,7,4),(14,7,3);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `courses`;\nCREATE TABLE `courses` (\n  `CourseID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,\n  `Course` varchar(100) NOT NULL,\n  PRIMARY KEY (`CourseID`)\n) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `courses` WRITE;\n/*!40000 ALTER TABLE `courses` DISABLE KEYS */;\nINSERT INTO `courses` VALUES (1,'Hamo Gong'),(2,'Kuihua Baodian'),(3,'Jinshe Jianfa'),(4,'Taiji Quan'),(5,'Daiyu Zanghua'),(6,'Weituo Zhang'),(7,'Dagou Bangfa');\n/*!40000 ALTER TABLE `courses` ENABLE KEYS */;\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `scores`;\nCREATE TABLE `scores` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `StuID` int(10) unsigned NOT NULL,\n  `CourseID` smallint(5) unsigned NOT NULL,\n  `Score` tinyint(3) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `scores` WRITE;\nINSERT INTO `scores` VALUES (1,1,2,77),(2,1,6,93),(3,2,2,47),(4,2,5,97),(5,3,2,88),(6,3,6,75),(7,4,5,71),(8,4,2,89),(9,5,1,39),(10,5,7,63),(11,6,1,96),(12,7,1,86),(13,7,7,83),(14,8,4,57),(15,8,3,93);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `students`;\nCREATE TABLE `students` (\n  `StuID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `Name` varchar(50) NOT NULL,\n  `Age` tinyint(3) unsigned NOT NULL,\n  `Gender` enum('F','M') NOT NULL,\n  `ClassID` tinyint(3) unsigned DEFAULT NULL,\n  `TeacherID` int(10) unsigned DEFAULT NULL,\n  PRIMARY KEY (`StuID`)\n) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `students` WRITE;\nINSERT INTO `students` VALUES (1,'Shi Zhongyu',22,'M',2,3),(2,'Shi Potian',22,'M',1,7),(3,'Xie Yanke',53,'M',2,16),(4,'Ding Dian',32,'M',4,4),(5,'Yu Yutong',26,'M',3,1),(6,'Shi Qing',46,'M',5,NULL),(7,'Xi Ren',19,'F',3,NULL),(8,'Lin Daiyu',17,'F',7,NULL),(9,'Ren Yingying',20,'F',6,NULL),(10,'Yue Lingshan',19,'F',3,NULL),(11,'Yuan Chengzhi',23,'M',6,NULL),(12,'Wen Qingqing',19,'F',1,NULL),(13,'Tian Boguang',33,'M',2,NULL),(14,'Lu Wushuang',17,'F',3,NULL),(15,'Duan Yu',19,'M',4,NULL),(16,'Xu Zhu',21,'M',1,NULL),(17,'Lin Chong',25,'M',4,NULL),(18,'Hua Rong',23,'M',7,NULL),(19,'Xue Baochai',18,'F',6,NULL),(20,'Diao Chan',19,'F',7,NULL),(21,'Huang Yueying',22,'F',6,NULL),(22,'Xiao Qiao',20,'F',1,NULL),(23,'Ma Chao',23,'M',4,NULL),(24,'Xu Xian',27,'M',NULL,NULL),(25,'Sun Dasheng',100,'M',NULL,NULL);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `teachers`;\nCREATE TABLE `teachers` (\n  `TID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,\n  `Name` varchar(100) NOT NULL,\n  `Age` tinyint(3) unsigned NOT NULL,\n  `Gender` enum('F','M') DEFAULT NULL,\n  PRIMARY KEY (`TID`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `teachers` WRITE;\nINSERT INTO `teachers` VALUES (1,'Song Jiang',45,'M'),(2,'Zhang Sanfeng',94,'M'),(3,'Miejue Shitai',77,'F'),(4,'Lin Chaoying',93,'F');\nUNLOCK TABLES;\n\n\nDROP TABLE IF EXISTS `toc`;\nCREATE TABLE `toc` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `CourseID` smallint(5) unsigned DEFAULT NULL,\n  `TID` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nLOCK TABLES `toc` WRITE;\nUNLOCK TABLES;\n\nEOF\n```\n\nåœ¨ä¸»èŠ‚ç‚¹å¯¼å…¥\n\n```bash\nmysql -uroot -p123456 < hellodb.sql\nmysql -uroot -p123456 hellodb -e \"show tables;\"\n\nmysql: [Warning] Using a password on the command line interface can be insecure.\n+-------------------+\n| Tables_in_hellodb |\n+-------------------+\n| classes           |\n| coc               |\n| courses           |\n| scores            |\n| students          |\n| teachers          |\n| toc               |\n+-------------------+\n\nmysql -uroot -p123456\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"XIAOHU\",18,'M');\nselect * from teachers;\n\n(root@localhost) [hellodb]> select * from teachers;\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n|   5 | XIAOHU        |  18 | M      |#è¿™å°±æ˜¯æ–°åŠ çš„æ•°æ®\n+-----+---------------+-----+--------+\n\n```\n\nåœ¨ä»èŠ‚ç‚¹æŸ¥çœ‹æ˜¯å¦åŒæ­¥\n\n```bash\nmysql -uroot -p123456 hellodb -e \"use hellodb;select * from teachers;\"\n\n[root@slave ~]# mysql -uroot -p123456 hellodb -e \"use hellodb;select * from teachers;\"\nmysql: [Warning] Using a password on the command line interface can be insecure.\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n|   5 | XIAOHU        |  18 | M      |\n+-----+---------------+-----+--------+\n\n```\n\nè‡³æ­¤ä¸»ä»å¤åˆ¶æˆåŠŸåŒæ­¥\n\n## éƒ¨ç½²mycat\n\n`æ³¨æ„ï¼šè¿™å°æœºä¸Šä¸èƒ½ç”¨mysqlç­‰å…¶ä»–æ•°æ®åº“`\n\næ“ä½œèŠ‚ç‚¹ï¼š[mycat]\n\n### å®‰è£…jdk\n\n```bash\nwget https://alist.qianyios.top/d/%E6%B8%B8%E5%AE%A2/%E8%B1%86%E5%8C%85haha/%E8%BF%90%E7%BB%B4/mysql/%E5%AE%89%E8%A3%85%E5%8C%85/jdk-8u202-linux-x64.rpm?sign=1F6ZiF7m6XPKTiV2PiNEH2xIInIVrb2uHIm3TvyFXG0=:0\nmv 'jdk-8u202-linux-x64.rpm?sign=1F6ZiF7m6XPKTiV2PiNEH2xIInIVrb2uHIm3TvyFXG0=:0' jdk-8u202-linux-x64.rpm\nrpm -ivh jdk-8u202-linux-x64.rpm\n```\n\n```bash\n[root@mycat ~]# java -version\njava version \"1.8.0_202\"\nJava(TM) SE Runtime Environment (build 1.8.0_202-b08)\nJava HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode)\n```\n\n### ä¸‹è½½å®‰è£…mycat\n\n```bash\nwget https://alist.qianyios.top/d/%E6%B8%B8%E5%AE%A2/%E8%B1%86%E5%8C%85haha/%E8%BF%90%E7%BB%B4/mysql/%E5%AE%89%E8%A3%85%E5%8C%85/Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz?sign=T83V18vz0xSMy6INAGV9eAzETOL7c0gxQuZA5YYWlhw=:0\nmv 'Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz?sign=T83V18vz0xSMy6INAGV9eAzETOL7c0gxQuZA5YYWlhw=:0' Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz\nmkdir -p /apps\ntar xf Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz -C /apps\n```\n\nmycatå®‰è£…ç›®å½•ç»“æ„ï¼š\n\n- bin  mycatå‘½ä»¤ï¼Œå¯åŠ¨ã€é‡å¯ã€åœæ­¢ç­‰\n- catlet  catletä¸ºMycatçš„ä¸€ä¸ªæ‰©å±•åŠŸèƒ½\n- conf  Mycat é…ç½®ä¿¡æ¯,é‡ç‚¹å…³æ³¨\n- lib  Mycatå¼•ç”¨çš„jaråŒ…ï¼ŒMycatæ˜¯javaå¼€å‘çš„\n- logs  æ—¥å¿—æ–‡ä»¶ï¼ŒåŒ…æ‹¬Mycatå¯åŠ¨çš„æ—¥å¿—å’Œè¿è¡Œçš„æ—¥å¿—\n- version.txt  mycatç‰ˆæœ¬è¯´æ˜\n\nlogsç›®å½•:\n\n- wrapper.log mycatå¯åŠ¨æ—¥å¿—\n- mycat.log mycatè¯¦ç»†å·¥ä½œæ—¥å¿—\n\nMycatçš„é…ç½®æ–‡ä»¶éƒ½åœ¨confç›®å½•é‡Œé¢ï¼Œè¿™é‡Œä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„æ–‡ä»¶ï¼š\n\n- server.xml Mycatè½¯ä»¶æœ¬èº«ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®è´¦å·ã€å‚æ•°ç­‰\n- schema.xml Mycatå¯¹åº”çš„ç‰©ç†æ•°æ®åº“å’Œæ•°æ®åº“è¡¨çš„é…ç½®,è¯»å†™åˆ†ç¦»ã€é«˜å¯ç”¨ã€åˆ†å¸ƒå¼ç­–ç•¥å®šåˆ¶ã€èŠ‚ç‚¹æ§åˆ¶\n- rule.xml Mycatåˆ†ç‰‡ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰è§„åˆ™é…ç½®æ–‡ä»¶,è®°å½•åˆ†ç‰‡è§„åˆ™åˆ—è¡¨ã€ä½¿ç”¨æ–¹æ³•ç­‰\n\nå¯åŠ¨å’Œè¿æ¥\n\n```bash\necho 'PATH=/apps/mycat/bin:$PATH' > /etc/profile.d/mycat.sh\nsource /etc/profile.d/mycat.sh\nmycat start\n#è¿æ¥mycatï¼š\nmysql -uroot -p123456 -h 127.0.0.1 -P8066\nexit\n```\n\n\n\n### Mycat ä¸»è¦é…ç½®æ–‡ä»¶è¯´æ˜\n\nserver.xml\n\nå­˜æ”¾Mycatè½¯ä»¶æœ¬èº«ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šè¿æ¥Mycatçš„ç”¨æˆ·ï¼Œå¯†ç ï¼Œæ•°æ®åº“åç§°ç­‰\n\nserver.xmlæ–‡ä»¶ä¸­é…ç½®çš„å‚æ•°è§£é‡Šè¯´æ˜ï¼š\n\n| å‚æ•°       | è¯´æ˜                                                         |\n| ---------- | ------------------------------------------------------------ |\n| user       | ç”¨æˆ·é…ç½®èŠ‚ç‚¹                                                 |\n| name       | å®¢æˆ·ç«¯ç™»å½• MyCAT çš„ç”¨æˆ·åï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯ç”¨æ¥è¿æ¥ Mycat çš„ç”¨æˆ·åã€‚ |\n| password   | å®¢æˆ·ç«¯ç™»å½• MyCAT çš„å¯†ç                                       |\n| schemas    | æ•°æ®åº“åï¼Œè¿™é‡Œä¼šå’Œ `schema.xml` ä¸­çš„é…ç½®å…³è”ï¼Œå¤šä¸ªç”¨é€—å·åˆ†å¼€ï¼Œä¾‹å¦‚ï¼š`db1,db2` |\n| privileges | é…ç½®ç”¨æˆ·é’ˆå¯¹è¡¨çš„å¢åˆ æ”¹æŸ¥çš„æƒé™                               |\n| readOnly   | mycat é€»è¾‘åº“æ‰€å…·æœ‰çš„æƒé™ã€‚`true` ä¸ºåªè¯»ï¼Œ`false` ä¸ºè¯»å†™éƒ½æœ‰ï¼Œé»˜è®¤ä¸º `false` |\n\næ³¨æ„ï¼š\n\n- server.xmlæ–‡ä»¶é‡Œç™»å½•mycatçš„ç”¨æˆ·åå’Œå¯†ç å¯ä»¥ä»»æ„å®šä¹‰ï¼Œè¿™ä¸ªè´¦å·å’Œå¯†ç æ˜¯ä¸ºå®¢æˆ·æœºç™»å½•mycatæ—¶ä½¿ç”¨çš„è´¦å·ä¿¡æ¯\n- é€»è¾‘åº“å(å¦‚ä¸Šé¢çš„TESTDBï¼Œä¹Ÿå°±æ˜¯ç™»å½•mycatåæ˜¾ç¤ºçš„åº“åï¼Œåˆ‡æ¢è¿™ä¸ªåº“ä¹‹åï¼Œæ˜¾ç¤ºçš„å°±æ˜¯ä»£ç†çš„çœŸå®mysqlæ•°æ®åº“çš„è¡¨)è¦åœ¨schema.xmlé‡Œé¢ä¹Ÿå®šä¹‰ï¼Œå¦åˆ™ä¼šå¯¼è‡´mycatæœåŠ¡å¯åŠ¨å¤±è´¥ï¼\n- è¿™é‡Œåªå®šä¹‰äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œæ‰€ä»¥æŠŠå¤šä½™çš„éƒ½æ³¨é‡Šäº†ã€‚å¦‚æœå®šä¹‰å¤šä¸ªæ ‡ç­¾ï¼Œå³è®¾ç½®å¤šä¸ªè¿æ¥mycatçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨schema.xmlæ–‡ä»¶ä¸­å®šä¹‰å¤šä¸ªå¯¹åº”çš„åº“ï¼\n\n**schema.xml**\n\næ˜¯æœ€ä¸»è¦çš„é…ç½®é¡¹ï¼Œæ­¤æ–‡ä»¶å…³è”mysqlè¯»å†™åˆ†ç¦»ç­–ç•¥ï¼Œè¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ç­–ç•¥ã€åˆ†ç‰‡èŠ‚ç‚¹éƒ½æ˜¯åœ¨æ­¤æ–‡ä»¶ä¸­é…ç½®çš„.MyCatä½œä¸ºä¸­é—´ä»¶ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªä»£ç†ï¼Œæœ¬èº«å¹¶ä¸è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œéœ€è¦è¿æ¥åç«¯çš„MySQLç‰©ç†æœåŠ¡å™¨ï¼Œæ­¤æ–‡ä»¶å°±æ˜¯ç”¨æ¥è¿æ¥MySQLæœåŠ¡å™¨çš„\n\nschema.xmlæ–‡ä»¶ä¸­é…ç½®çš„å‚æ•°è§£é‡Šè¯´æ˜ï¼š\n\n| å‚æ•°     | è¯´æ˜                                                         |\n| -------- | ------------------------------------------------------------ |\n| schema   | æ•°æ®åº“è®¾ç½®ï¼Œæ­¤æ•°æ®åº“ä¸ºé€»è¾‘æ•°æ®åº“ï¼Œ`name` ä¸ `server.xml` ä¸­çš„ `schema` å¯¹åº” |\n| dataNode | åˆ†ç‰‡ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯åˆ†åº“ç›¸å…³é…ç½®                                 |\n| dataHost | ç‰©ç†æ•°æ®åº“ï¼ŒçœŸæ­£å­˜å‚¨æ•°æ®çš„æ•°æ®åº“                             |\n\n**é…ç½®è¯´æ˜**\n\nnameå±æ€§å”¯ä¸€æ ‡è¯†dataHostæ ‡ç­¾ï¼Œä¾›ä¸Šå±‚çš„æ ‡ç­¾ä½¿ç”¨ã€‚\n\nmaxConå±æ€§æŒ‡å®šæ¯ä¸ªè¯»å†™å®ä¾‹è¿æ¥æ± çš„æœ€å¤§è¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ ‡ç­¾å†…åµŒå¥—çš„writeHostã€readHostæ ‡ç­¾éƒ½ä¼šä½¿ç”¨è¿™ä¸ªå±æ€§çš„å€¼æ¥å®ä¾‹åŒ–å‡ºè¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°\n\nminConå±æ€§æŒ‡å®šæ¯ä¸ªè¯»å†™å®ä¾‹è¿æ¥æ± çš„æœ€å°è¿æ¥ï¼Œåˆå§‹åŒ–è¿æ¥æ± çš„å¤§å°\n\n**æ¯ä¸ªèŠ‚ç‚¹çš„å±æ€§é€ä¸€è¯´æ˜**\n\n**schema:**\n\n| å±æ€§           | è¯´æ˜                                             |\n| -------------- | ------------------------------------------------ |\n| name           | é€»è¾‘æ•°æ®åº“åï¼Œä¸ `server.xml` ä¸­çš„ `schema` å¯¹åº” |\n| checkSQLschema | æ•°æ®åº“å‰ç¼€ç›¸å…³è®¾ç½®ï¼Œè¿™é‡Œä¸º `false`               |\n| sqlMaxLimit    | `SELECT` æ—¶é»˜è®¤çš„ `LIMIT`ï¼Œé¿å…æŸ¥è¯¢å…¨è¡¨          |\n\n**table**\n\n| å±æ€§          | è¯´æ˜                                                         |\n| ------------- | ------------------------------------------------------------ |\n| name          | è¡¨åï¼Œç‰©ç†æ•°æ®åº“ä¸­è¡¨å                                       |\n| dataNode      | è¡¨å­˜å‚¨åˆ°å“ªäº›èŠ‚ç‚¹ï¼Œå¤šä¸ªèŠ‚ç‚¹ç”¨é€—å·åˆ†éš”ã€‚èŠ‚ç‚¹ä¸ºä¸‹æ–‡ `dataNode` è®¾ç½®çš„ `name` |\n| primaryKey    | ä¸»é”®å­—æ®µåï¼Œè‡ªåŠ¨ç”Ÿæˆä¸»é”®æ—¶éœ€è¦è®¾ç½®                           |\n| autoIncrement | æ˜¯å¦è‡ªå¢                                                     |\n| rule          | åˆ†ç‰‡è§„åˆ™åï¼Œå…·ä½“è§„åˆ™ä¸‹æ–‡ `rule` è¯¦ç»†ä»‹ç»                     |\n\n**dataNode**\n\n| å±æ€§     | è¯´æ˜                                         |\n| -------- | -------------------------------------------- |\n| name     | èŠ‚ç‚¹åï¼Œä¸ `table` ä¸­çš„ `dataNode` å¯¹åº”      |\n| datahost | ç‰©ç†æ•°æ®åº“åï¼Œä¸ `datahost` ä¸­çš„ `name` å¯¹åº” |\n| database | ç‰©ç†æ•°æ®åº“ä¸­æ•°æ®åº“å                         |\n\n**dataHost**\n\n| å±æ€§      | è¯´æ˜                                             |\n| --------- | ------------------------------------------------ |\n| name      | ç‰©ç†æ•°æ®åº“åï¼Œä¸ `dataNode` ä¸­çš„ `dataHost` å¯¹åº” |\n| balance   | å‡è¡¡è´Ÿè½½çš„æ–¹å¼                                   |\n| writeType | å†™å…¥æ–¹å¼                                         |\n| dbType    | æ•°æ®åº“ç±»å‹                                       |\n| heartbeat | å¿ƒè·³æ£€æµ‹è¯­å¥ï¼Œæ³¨æ„è¯­å¥ç»“å°¾çš„åˆ†å·è¦åŠ              |\n\nschema.xmlæ–‡ä»¶ä¸­æœ‰ä¸‰ç‚¹éœ€è¦æ³¨æ„ï¼šbalance=\"1\"ï¼ŒwriteType=\"0\" ,switchType=\"1\"\n\nschema.xmlä¸­çš„balanceçš„å–å€¼å†³å®šäº†è´Ÿè½½å‡è¡¡å¯¹éäº‹åŠ¡å†…çš„è¯»æ“ä½œçš„å¤„ç†ã€‚balance å±æ€§è´Ÿè½½å‡è¡¡ç±»å‹ï¼Œç›®å‰çš„å–å€¼æœ‰ 4 ç§ï¼š\n\n`balance=\"0\"`ï¼šä¸å¼€å¯è¯»å†™åˆ†ç¦»æœºåˆ¶ï¼Œæ‰€æœ‰è¯»æ“ä½œéƒ½å‘é€åˆ°å½“å‰å¯ç”¨çš„writeHostä¸Š,å³è¯»è¯·æ±‚ä»…å‘é€åˆ°writeHostä¸Š\n\n`balance=\"1\"`ï¼šä¸€èˆ¬ç”¨æ­¤æ¨¡å¼ï¼Œè¯»è¯·æ±‚éšæœºåˆ†å‘åˆ°å½“å‰writeHostå¯¹åº”çš„readHostå’Œstandbyçš„writeHostä¸Šã€‚å³å…¨éƒ¨çš„readHostä¸stand by writeHost å‚ä¸ select è¯­å¥çš„è´Ÿè½½å‡è¡¡ï¼Œç®€å•çš„è¯´ï¼Œå½“åŒä¸»åŒä»æ¨¡å¼(M1 ->S1 ï¼Œ M2->S2ï¼Œå¹¶ä¸” M1 ä¸ M2 äº’ä¸ºä¸»å¤‡)ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œ M2,S1, S2 éƒ½å‚ä¸ select è¯­å¥çš„è´Ÿè½½å‡è¡¡\n\n`balance=\"2\"`ï¼šè¯»è¯·æ±‚éšæœºåˆ†å‘åˆ°å½“å‰dataHostå†…æ‰€æœ‰çš„writeHostå’ŒreadHostä¸Šã€‚å³æ‰€æœ‰è¯»æ“ä½œéƒ½éšæœºçš„åœ¨writeHostã€ readhost ä¸Šåˆ†å‘\n\n`balance=\"3\"`ï¼šè¯»è¯·æ±‚éšæœºåˆ†å‘åˆ°å½“å‰writeHostå¯¹åº”çš„readHostä¸Šã€‚å³æ‰€æœ‰è¯»è¯·æ±‚éšæœºçš„åˆ†å‘åˆ°wiriterHost å¯¹åº”çš„ readhost æ‰§è¡Œ, writerHost ä¸è´Ÿæ‹…è¯»å‹åŠ›ï¼Œæ³¨æ„ balance=3 åªåœ¨ 1.4 åŠå…¶ä»¥åç‰ˆæœ¬æœ‰ï¼Œ1.3 æ²¡æœ‰\n\n**writeHostå’ŒreadHost æ ‡ç­¾**\n\nè¿™ä¸¤ä¸ªæ ‡ç­¾éƒ½æŒ‡å®šåç«¯æ•°æ®åº“çš„ç›¸å…³é…ç½®ç»™mycatï¼Œç”¨äºå®ä¾‹åŒ–åç«¯è¿æ¥æ± ã€‚\n\nå”¯ä¸€ä¸åŒçš„æ˜¯ï¼šwriteHostæŒ‡å®šå†™å®ä¾‹ã€readHostæŒ‡å®šè¯»å®ä¾‹ï¼Œç»„åˆè¿™äº›è¯»å†™å®ä¾‹æ¥æ»¡è¶³ç³»ç»Ÿçš„è¦æ±‚ã€‚\n\nåœ¨ä¸€ä¸ªdataHostå†…å¯ä»¥å®šä¹‰å¤šä¸ªwriteHostå’ŒreadHostã€‚ä½†æ˜¯ï¼Œå¦‚æœwriteHostæŒ‡å®šçš„åç«¯æ•°æ®åº“å®•æœºï¼Œé‚£ä¹ˆè¿™ä¸ªwriteHostç»‘å®šçš„æ‰€æœ‰readHostéƒ½å°†ä¸å¯ç”¨ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºè¿™ä¸ªwriteHostå®•æœºç³»ç»Ÿä¼šè‡ªåŠ¨çš„æ£€æµ‹åˆ°ï¼Œå¹¶åˆ‡æ¢åˆ°å¤‡ç”¨çš„writeHostä¸Šå»\n\næ³¨æ„ï¼šMycatä¸»ä»åˆ†ç¦»åªæ˜¯åœ¨è¯»çš„æ—¶å€™åšäº†å¤„ç†ï¼Œå†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œåªä¼šå†™å…¥åˆ°writehostï¼Œéœ€è¦é€šè¿‡mycatçš„ä¸»ä»å¤åˆ¶å°†æ•°æ®å¤åˆ¶åˆ°readhost\n\n### ä¿®æ”¹server.xmlæ–‡ä»¶é…ç½®Mycatçš„è¿æ¥ä¿¡æ¯\n\n```bash\nvim /apps/mycat/conf/server.xml\n```\n\n```bash\n        <property name=\"processorBufferPoolType\">0</property>\n#åœ¨ä¸Šè¡Œä¸‹é¢æ·»åŠ ä¸‹é¢çš„ä¿¡æ¯ï¼Œç«¯å£3306\n        <property name=\"serverPort\">3306</property>\n        <property name=\"managerPort\">9066</property>\n        <property name=\"idleTimeout\">300000</property>\n        <property name=\"authTimeout\">15000</property>\n        <property name=\"bindIp\">0.0.0.0</property>\n        <property name=\"dataNodeIdleCheckPeriod\">300000</property>\n        <property name=\"frontWriteQueueSize\">4096</property>\n        <property name=\"processors\">32</property>\n        \n        #å†å¾€ä¸‹é¢ç¿»ç¿»ï¼Œæ‰¾åˆ°ä¸‹é¢è¿™è¡Œï¼Œç”¨æˆ·årootï¼Œå¯†ç 123456\n        <user name=\"root\" defaultAccount=\"true\">\n        <property name=\"password\">123456</property>\n        <property name=\"schemas\">TESTDB</property>\n        #schemaså¯¹åº”çš„TESTDB æ•°æ®åº“è¦å’Œåé¢è¦æ”¹çš„schema.xmlç›¸å¯¹åº”\n```\n\nè¿™é‡Œå¡«çš„æ˜¯ç”¨æˆ·å»è¿æ¥çš„mysqlï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·ç”¨`mysql -uroot -p123465`è¿çš„æ˜¯mycat1çš„è¿™ä¸ªè™šæ‹Ÿçš„TESTDBæ•°æ®åº“ï¼Œä½†æ˜¯ä»–æ˜ å°„çš„æ˜¯åç«¯çš„æ•°æ®åº“ï¼Œè¿™ä¸ªåœ¨ä¸‹ä¸€æ­¥ä¼šè®²åˆ°\n\n### ä¿®æ”¹schema.xml\n\n```bash\n#ç›´æ¥å¤åˆ¶æˆ‘çš„æ–‡ä»¶å°±è¡Œäº†ï¼Œå…¨é€‰ä¸€é”®å¤åˆ¶ï¼Œçœ‹ä¸€ä¸‹æœ‰ä»€ä¹ˆä¿¡æ¯è¦ä¿®æ”¹ï¼Œä¿®æ”¹åå°±å¯ä»¥å¤åˆ¶äº†\ncat > /apps/mycat/conf/schema.xml <<\"EOF\"\n<?xml version=\"1.0\"?>\n<!DOCTYPE mycat:schema SYSTEM \"schema.dtd\">\n<mycat:schema xmlns:mycat=\"http://io.mycat/\">\n <schema name=\"TESTDB\" checkSQLschema=\"false\" sqlMaxLimit=\"100\" dataNode=\"dn1\"> </schema>\n <dataNode name=\"dn1\" dataHost=\"localhost1\" database=\"hellodb\" />\n <dataHost name=\"localhost1\" maxCon=\"1000\" minCon=\"10\" balance=\"1\"\n \t\t\twriteType=\"0\" dbType=\"mysql\" dbDriver=\"native\" switchType=\"1\" slaveThreshold=\"100\">\n <heartbeat>select user()</heartbeat>\n <!-- å†™çš„èŠ‚ç‚¹-->\n <writeHost host=\"host1\" url=\"192.168.48.10:3306\" user=\"qianyios\" password=\"123456\">\n      <!-- è¯»çš„èŠ‚ç‚¹-->\n     <readHost host=\"host2\" url=\"192.168.48.11:3306\" user=\"qianyios\" password=\"123456\" />\n </writeHost>\n  </dataHost>\n</mycat:schema>\nEOF\n```\n\n> `<schema name=\"TESTDB\" checkSQLschema=\"false\" sqlMaxLimit=\"100\" dataNode=\"dn1\"> </schema>`è¿™ä¸€è¡Œçš„dn1å¯¹åº”ä¸‹é¢çš„è¿™ä¸€è¡Œ\n> `<dataNode name=\"dn1\" dataHost=\"localhost1\" database=\"hellodb\" />`\n>\n> `TESTDB`æ˜¯å‰é¢ä¸Šä¸€æ­¥ä¿®æ”¹server.xmlæåˆ°çš„è¦å’Œå‰é¢ä¸€ä¸€å¯¹åº”çš„è™šæ‹Ÿæ•°æ®åº“\n> `hellodb`æ˜¯åç«¯å¯¹åº”çš„æ•°æ®åº“åï¼Œå°±æ˜¯è¯´ï¼Œæˆ‘åç«¯æœ‰å“ªä¸ªæ•°æ®åº“æ˜¯æƒ³æ˜ å°„åˆ°mycatçš„ï¼Œå°±å†™ï¼Œæˆ‘æ€»ä¸èƒ½è¯´æ‰€æœ‰æ•°æ®åº“éƒ½å†™éƒ½æ˜ å°„\n>\n> `<dataHost name=\"localhost1\" maxCon=\"1000\" minCon=\"10\" balance=\"1\" \n> \t\t\twriteType=\"0\" dbType=\"mysql\" dbDriver=\"native\" switchType=\"1\" slaveThreshold=\"100\">`\n>\n> å…¶ä¸­balance=\"1\"è®¾ç½®ä¸º1è¡¨ç¤ºè¯»å†™åˆ†ç¦»\n>\n> \n>\n>  <!-- å†™çš„èŠ‚ç‚¹-->\n>  `<writeHost host=\"host1\" url=\"192.168.48.10:3306\" user=\"qianyios\" password=\"123456\">`\n>       <!-- è¯»çš„èŠ‚ç‚¹-->\n>      `<readHost host=\"host2\" url=\"192.168.48.11:3306\" user=\"qianyios\" password=\"123456\" />`\n>\n> è¿™ä¸ªqianyiosç”¨æˆ·ç­‰ç­‰åé¢ä¼šåˆ›å»º\n\n![image-20250802140642277](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/a7d9fc131a73e87865e9a4a14f5c7ad2697559838.png)\n\n```bash\n#é‡å¯mycat\nmycat stop\nmycat start\n#æŸ¥çœ‹ç«¯å£çŠ¶æ€\n[root@mycat ~]# ss -ntlp\nState      Recv-Q     Send-Q          Local Address:Port            Peer Address:Port     Process\nLISTEN     0          1                   127.0.0.1:32000                0.0.0.0:*         users:((\"java\",pid=60546,fd=4))\nLISTEN     0          128                   0.0.0.0:22                   0.0.0.0:*         users:((\"sshd\",pid=991,fd=7))\nLISTEN     0          2048                        *:9066#è¿™ä¸ª                *:*         users:((\"java\",pid=60546,fd=179))\nLISTEN     0          50                          *:35183                      *:*         users:((\"java\",pid=60546,fd=70))\nLISTEN     0          128                      [::]:22                      [::]:*         users:((\"sshd\",pid=991,fd=8))\nLISTEN     0          50                          *:36743                      *:*         users:((\"java\",pid=60546,fd=68))\nLISTEN     0          50                          *:1984                       *:*         users:((\"java\",pid=60546,fd=69))\nLISTEN     0          2048                        *:3306#è¿™ä¸ª               *:*         users:((\"java\",pid=60546,fd=183))\n[root@mycat ~]#\n\n```\n\n\n\n### åœ¨masterä¸»èŠ‚ç‚¹å¯¼å…¥æµ‹è¯•çš„æ•°æ®åº“\n\n```bash\n#å…¨æ–°å¤åˆ¶è¿è¡Œå³å¯ï¼Œè¦é€€å‡ºmysqlï¼Œåœ¨shellç»ˆç«¯è¿è¡Œ\ncat > hellodb.sql <<\"EOF\"\n\nCREATE DATABASE /*!32312 IF NOT EXISTS*/ `hellodb` /*!40100 DEFAULT CHARACTER SET utf8 */;\nUSE `hellodb`;\n\nDROP TABLE IF EXISTS `classes`;\nCREATE TABLE `classes` (\n  `ClassID` tinyint(3) unsigned NOT NULL AUTO_INCREMENT,\n  `Class` varchar(100) DEFAULT NULL,\n  `NumOfStu` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ClassID`)\n) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `classes` WRITE;\nINSERT INTO `classes` VALUES\n(1,'Shaolin Pai',10),(2,'Emei Pai',7),\n(3,'QingCheng Pai',11),(4,'Wudang Pai',12),(5,'Riyue Shenjiao',31),\n(6,'Lianshan Pai',27),(7,'Ming Jiao',27),(8,'Xiaoyao Pai',15);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `coc`;\nCREATE TABLE `coc` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `ClassID` tinyint(3) unsigned NOT NULL,\n  `CourseID` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `coc` WRITE;\nINSERT INTO `coc` VALUES (1,1,2),(2,1,5),(3,2,2),(4,2,6),(5,3,1),(6,3,7),(7,4,5),(8,4,2),(9,5,1),(10,5,9),(11,6,3),(12,6,4),(13,7,4),(14,7,3);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `courses`;\nCREATE TABLE `courses` (\n  `CourseID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,\n  `Course` varchar(100) NOT NULL,\n  PRIMARY KEY (`CourseID`)\n) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `courses` WRITE;\n/*!40000 ALTER TABLE `courses` DISABLE KEYS */;\nINSERT INTO `courses` VALUES (1,'Hamo Gong'),(2,'Kuihua Baodian'),(3,'Jinshe Jianfa'),(4,'Taiji Quan'),(5,'Daiyu Zanghua'),(6,'Weituo Zhang'),(7,'Dagou Bangfa');\n/*!40000 ALTER TABLE `courses` ENABLE KEYS */;\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `scores`;\nCREATE TABLE `scores` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `StuID` int(10) unsigned NOT NULL,\n  `CourseID` smallint(5) unsigned NOT NULL,\n  `Score` tinyint(3) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `scores` WRITE;\nINSERT INTO `scores` VALUES (1,1,2,77),(2,1,6,93),(3,2,2,47),(4,2,5,97),(5,3,2,88),(6,3,6,75),(7,4,5,71),(8,4,2,89),(9,5,1,39),(10,5,7,63),(11,6,1,96),(12,7,1,86),(13,7,7,83),(14,8,4,57),(15,8,3,93);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `students`;\nCREATE TABLE `students` (\n  `StuID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `Name` varchar(50) NOT NULL,\n  `Age` tinyint(3) unsigned NOT NULL,\n  `Gender` enum('F','M') NOT NULL,\n  `ClassID` tinyint(3) unsigned DEFAULT NULL,\n  `TeacherID` int(10) unsigned DEFAULT NULL,\n  PRIMARY KEY (`StuID`)\n) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `students` WRITE;\nINSERT INTO `students` VALUES (1,'Shi Zhongyu',22,'M',2,3),(2,'Shi Potian',22,'M',1,7),(3,'Xie Yanke',53,'M',2,16),(4,'Ding Dian',32,'M',4,4),(5,'Yu Yutong',26,'M',3,1),(6,'Shi Qing',46,'M',5,NULL),(7,'Xi Ren',19,'F',3,NULL),(8,'Lin Daiyu',17,'F',7,NULL),(9,'Ren Yingying',20,'F',6,NULL),(10,'Yue Lingshan',19,'F',3,NULL),(11,'Yuan Chengzhi',23,'M',6,NULL),(12,'Wen Qingqing',19,'F',1,NULL),(13,'Tian Boguang',33,'M',2,NULL),(14,'Lu Wushuang',17,'F',3,NULL),(15,'Duan Yu',19,'M',4,NULL),(16,'Xu Zhu',21,'M',1,NULL),(17,'Lin Chong',25,'M',4,NULL),(18,'Hua Rong',23,'M',7,NULL),(19,'Xue Baochai',18,'F',6,NULL),(20,'Diao Chan',19,'F',7,NULL),(21,'Huang Yueying',22,'F',6,NULL),(22,'Xiao Qiao',20,'F',1,NULL),(23,'Ma Chao',23,'M',4,NULL),(24,'Xu Xian',27,'M',NULL,NULL),(25,'Sun Dasheng',100,'M',NULL,NULL);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `teachers`;\nCREATE TABLE `teachers` (\n  `TID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,\n  `Name` varchar(100) NOT NULL,\n  `Age` tinyint(3) unsigned NOT NULL,\n  `Gender` enum('F','M') DEFAULT NULL,\n  PRIMARY KEY (`TID`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `teachers` WRITE;\nINSERT INTO `teachers` VALUES (1,'Song Jiang',45,'M'),(2,'Zhang Sanfeng',94,'M'),(3,'Miejue Shitai',77,'F'),(4,'Lin Chaoying',93,'F');\nUNLOCK TABLES;\n\n\nDROP TABLE IF EXISTS `toc`;\nCREATE TABLE `toc` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `CourseID` smallint(5) unsigned DEFAULT NULL,\n  `TID` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nLOCK TABLES `toc` WRITE;\nUNLOCK TABLES;\n\nEOF\n```\n\n```bash\n#åœ¨ä¸»èŠ‚ç‚¹å¯¼å…¥\nmysql -uroot -p123456 < hellodb.sql\nmysql -uroot -p123456 hellodb -e \"show tables;\"\n```\n\n![image-20250802135101220](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/6475e98931df26fbbe28408cb7edb8b4697559838.png)\n\n### åœ¨masterèŠ‚ç‚¹åˆ›å»ºç”¨æˆ·å¹¶å¯¹mycatæˆæƒ\n\n```bash\nmysql -uroot -p123456 -e \"create user 'qianyios'@'192.168.48.%' identified by '123456' ;\"\nmysql -uroot -p123456 -e \"GRANT ALL PRIVILEGES ON *.* TO 'qianyios'@'192.168.48.%';\"\nmysql -uroot -p123456 -e\"flush privileges;\"\n```\n\n`qianyios`ç”¨æ¥ç»™mycatè¿æ¥æœ¬æ•°æ®åº“çš„çš„è´¦å·ï¼Œæ˜ å°„åˆ°å‰ç«¯\n\nåœ¨ä¸»èŠ‚ç‚¹åˆ›å»ºå¥½åï¼Œç”±äºä¸»ä»å¤åˆ¶ï¼Œåœ¨ä»èŠ‚ç‚¹æ˜¯å¯ä»¥çœ‹å¾—è§çš„\n\n```bash\nselect host,user from mysql.user\n```\n\n![image-20250802135801899](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/736a9906e4be1269488a29620579fdb4697559838.png)\n\n## æµ‹è¯•è¯»å†™åˆ†ç¦»\n\n![image-20250802140308663](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/9574df81ded0ce99d7683cdc83093325697559838.png)\n\n### å®¢æˆ·ç«¯ç™»å…¥mycat\n\næ“ä½œèŠ‚ç‚¹:[client]\n\n```bash\nmysql -u root -p123456 -h192.168.48.128\n```\n\n-h192.168.48.128è¦é“¾æ¥çš„æ˜¯mycatçš„åœ°å€\n\nç™»ä¸Šäº†ï¼Œä½†æ˜¯çœ‹ä¸äº†è¡¨\n\n![image-20250802142028803](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/d1c32e2e46ea6c394c7ef8774b2e95ca697559838.png)\n\nä¸€æŸ¥çœ‹æŠ¥é”™\n\n```bash\n[root@mycat ~]# tail -f /apps/mycat/logs/*\n```\n\n![image-20250802142013990](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/7751c71add118bb7e541161c3c41c4bf697559838.png)\n\n```\ncan't connect to mysql server ,errmsg:Client does not support authentication protocol requested by server; consider upgrading MySQL client\n```\n\nè¿™æ˜¯ç”±äº MySQL 8 é»˜è®¤ä½¿ç”¨äº†æ–°çš„è®¤è¯åè®® `caching_sha2_password`ï¼Œè€Œ MyCat å®¢æˆ·ç«¯å¯èƒ½ä¸æ”¯æŒè¿™ç§æ–°çš„è®¤è¯åè®®ã€‚ä»¥ä¸‹æ˜¯è§£å†³æ–¹æ³•ï¼š\n\n```bash\n#åœ¨masterä¸»èŠ‚ç‚¹è¿è¡Œ\nmysql -uroot -p123456 -e \"ALTER USER 'qianyios'@'192.168.48.%' IDENTIFIED WITH mysql_native_password BY '123456';\"\nmysql -uroot -p123456 -e \"FLUSH PRIVILEGES;\"\n```\n\n\n\nå†æ¬¡é‡æ–°ç™»å…¥å°±å¯ä»¥è¿æ¥äº†å¹¶æŸ¥çœ‹è¡¨é‡Œ\n\næ“ä½œèŠ‚ç‚¹:[client]\n\n```bash\nmysql -u root -p123456 -h192.168.48.128\nuse TESTDB;\nshow tables;\n\nmysql> show tables;\n+-------------------+\n| Tables_in_hellodb |\n+-------------------+\n| classes           |\n| coc               |\n| courses           |\n| scores            |\n| students          |\n| teachers          |\n| toc               |\n+-------------------+\n7 rows in set (0.00 sec)\n```\n\n### éªŒè¯è¯»å†™åˆ†ç¦»\n\nä¸ºäº†ç¡®ä¿æ•°æ®å¯è§‚ï¼Œè¿™é‡Œè¦é‡å¯ä¸€ä¸‹mycat\n\næ“ä½œèŠ‚ç‚¹:[mycat]\n\n9066æ˜¯mycatçš„ç®¡ç†ç«¯å£\n\n```bash\nmycat stop;mycat start;\nmysql -uroot -p123456 -P9066 -h127.0.0.1\n#æŸ¥çœ‹è¯»å†™åˆ†ç¦»çŠ¶æ€ä¿¡æ¯\nshow @@datasource;\n```\n\n![image-20250802142919545](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/9f5a322267cf45b071d7af727a463c96697559838.png)\n\nç›®çš„è¯»å’Œå†™çš„ä¿¡æ¯æ•°æ˜¯0\n\n\n\nå¼€å§‹æµ‹è¯•\n\næ“ä½œèŠ‚ç‚¹:[client]\n\n```bash\nmysql -uroot -p123456 -h 192.168.48.128 -P 3306\n#è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢\nuse TESTDB;select * from teachers;\n```\n\n![image-20250802143113971](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/afb8bba2902459eea36bb44b6de3449e697559838.png)\n\nå›åˆ°mycatçš„çŠ¶æ€æ \n\n![image-20250802143142635](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/630bafb486c803d587626fdb4b4ea8b4697559838.png)\n\næ˜¯ä¸æ˜¯è¯»çš„æ“ä½œå°±å‡ºæ¥äº†ï¼Œå°±æ˜¯ä»–èµ°çš„æ˜¯ä»èŠ‚ç‚¹\n\n\n\n\n\næ¥ä¸‹æ¥éªŒè¯å†™æ“ä½œ\n\næ“ä½œèŠ‚ç‚¹:[client]\n\n```bash\nmysql> insert into teachers(name,age,gender)values(\"xiaohu\",25,'M');\nQuery OK, 1 row affected (0.05 sec)\n```\n\nå›åˆ°mycatçš„çŠ¶æ€æ \n\n![image-20250802143403801](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/349bdecff6e6ba495c7789c9f44ffcbb697559838.png)\n\næ˜¯ä¸æ˜¯ä¸€ç›®äº†ç„¶ï¼Œä¸»èŠ‚ç‚¹æœ‰äº†å†™å…¥çš„æ•°æ®ï¼Œä»èŠ‚ç‚¹æ²¡æœ‰\n\nè‡³æ­¤è¯»å†™åˆ†ç¦»éƒ¨ç½²æˆåŠŸ\n\n\n\n## æ¨¡æ‹Ÿä»èŠ‚ç‚¹å®•æœº\n\n```bash\n[root@slave ~]# systemctl stop mysqld\n```\n\nç„¶åé‡Œé¢å»å®¢æˆ·ç«¯è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢\n\n```bash\n use TESTDB;select * from teachers;\n```\n\n![image-20250802152050769](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/cb72c2951e177a4d1638570d24e7112c697559838.png)\n\nç„¶åå»mycatèŠ‚ç‚¹æŸ¥çœ‹çŠ¶æ€\n\n![image-20250802152133703](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/a7da301c9f8f4bc6a150397cfc0c5dd1697559838.png)\n\nè¿™æ—¶å€™ä»èŠ‚ç‚¹å®•æœºä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šå‡ºç°å‡ ç§’é’Ÿçš„æŸ¥è¯¢ä¸åˆ°çš„çŠ¶æ€ï¼Œç„¶åmycatä¼šæŠŠè¯·æ±‚è½¬å‘ä¸»èŠ‚ç‚¹\n\n## é¢è¯•é¢˜\n\nmycatæ˜¯å¦‚ä½•æ£€æŸ¥ä¸»ä»èŠ‚ç‚¹å­˜æ´»çš„\n\n\n\nçœ‹æˆ‘çš„æ“ä½œï¼Œç­”æ¡ˆåœ¨æœ€å\n\nåœ¨ä¸»ä»ä¸¤ä¸ªèŠ‚ç‚¹çš„my.cntæ·»åŠ è¿™ä¸ª\n\n```bash\n[mysqld]\ngeneral_log\n\n#é‡å¯\nsystemctl restart mysqld\n```\n\n`general_log` æ˜¯ä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œç”¨äºè®°å½•æ‰€æœ‰ç”± MySQL æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¿æ¥å’Œæ‰§è¡Œçš„ SQL è¯­å¥ã€‚è¿™ä¸ªæ—¥å¿—å¯¹äºç›‘æ§æ•°æ®åº“æ“ä½œã€åˆ†ææ€§èƒ½é—®é¢˜ã€å®¡è®¡å’Œæ•…éšœæ’é™¤éå¸¸æœ‰ç”¨ã€‚\n\n```bash\n[root@master ~]# tail -f /data/mysql/master.log\n```\n\n![image-20250802151405779](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/3d8703acfaa6bdaf2557717d070a2630697559838.png)\n\n```bash\n[root@slave ~]# tail -f /data/mysql/slave.log\n```\n\n![image-20250802151421746](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/b4c46354756ff95e2d011c3ce27358bf697559838.png)\n\n\n\n è§£ç­”ï¼šåœ¨mycatçš„/apps/mycat/conf/schema.xmlçš„å¿ƒè·³æœºåˆ¶é‡Œ\n\n![image-20250802151809659](../img/%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9Mycat%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.assets/db2617a3569cd8b0da4e00b8fe172e51697559838.png)\n\nmycatå°±ä¼šæ¯10så‘é€ä¸€æ¬¡select user()å»ç›‘æµ‹ä¸»ä»èŠ‚ç‚¹çŠ¶æ€\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Mysql","Mycat"],"categories":["è¿ç»´"]},{"title":"Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹","url":"/posts/8acdcc65/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹\n\n## å„ç§å¤åˆ¶æ¶æ„\n\n![image-20250801002414524](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/6a36c7f04b86bf01ddcc822171475ca9697559838.png)\n\n## ä¸»ä»å¤åˆ¶åŸç†\n\n![image-20250731190104674](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/6505ba695f312d6504c17f292e78a981697559838.png)\n\nä¸»ä»å¤åˆ¶ç›¸å…³çº¿ç¨‹\n\n- ä¸»èŠ‚ç‚¹ï¼š\n\nâ€‹\tdump Threadï¼š ä¸ºæ¯ä¸ªSlaveçš„I/O Threadå¯åŠ¨ä¸€ä¸ªdumpçº¿ç¨‹ï¼Œç”¨äºå‘å…¶å‘é€binary log events\n\n- ä»èŠ‚ç‚¹ï¼š\n\nâ€‹\tI/O Threadï¼š å‘Masterè¯·æ±‚äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼Œå¹¶ä¿å­˜äºä¸­ç»§æ—¥å¿—ä¸­\n\nâ€‹\tSQL Threadï¼š ä»ä¸­ç»§æ—¥å¿—ä¸­è¯»å–æ—¥å¿—äº‹ä»¶ï¼Œåœ¨æœ¬åœ°å®Œæˆé‡æ”¾\n\nè·Ÿå¤åˆ¶åŠŸèƒ½ç›¸å…³çš„æ–‡ä»¶ï¼š\n\n- master.info ï¼šç”¨äºä¿å­˜slaveè¿æ¥è‡³masteræ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚è´¦å·ã€å¯†ç ã€æœåŠ¡å™¨åœ°å€ç­‰\n- relay-log.info ï¼šä¿å­˜åœ¨å½“å‰slaveèŠ‚ç‚¹ä¸Šå·²ç»å¤åˆ¶çš„å½“å‰äºŒè¿›åˆ¶æ—¥å¿—å’Œæœ¬åœ°relay logæ—¥å¿—çš„å¯¹åº”å…³ç³»\n- mysql-relay-bin.00000#: ä¸­ç»§æ—¥å¿—,ä¿å­˜ä»ä¸»èŠ‚ç‚¹å¤åˆ¶è¿‡æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—,æœ¬è´¨å°±æ˜¯äºŒè¿›åˆ¶æ—¥å¿—\n\n## äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½\n\nã€`å®‰è£…å¥½mysqlå†æ¥æŸ¥è¯¢`ã€‘\n\nè¿™é‡Œè®²ä¸€ä¸‹äºŒè¿›åˆ¶æ—¥å¿—æ˜¯å¹²å•¥çš„ï¼Œä½ åªè¦å¼€å¯äº†äºŒè¿›åˆ¶æ—¥å¿—çš„åŠŸèƒ½\n\n`sql_log_bin=ON`ï¼šå¼€å¯äºŒè¿›åˆ¶æ—¥å¿—è®°å½•çš„åŠŸèƒ½ï¼Œä½ æ‰§è¡Œä¸€ä¸ªmysqlè¯­å¥ä»–å°±ä¼šè®°å½•ä¸€ä¸‹ï¼Œ`ä»–åœ¨mysqlé»˜è®¤æ˜¯å¼€å¯çš„å°±ä¸ç”¨ç®¡äº†`\n\n`log-bin=è·¯å¾„/æ–‡ä»¶å‰ç¼€`ï¼šå¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½,è¿™ä¸ªå¯ä»¥ç›´æ¥å†™åœ¨/etc/my.cnfé‡Œ,ä¸€ä¸»ä¸€ä»çš„æ­¥éª¤é‡Œæœ‰ä»‹ç»\n\nä¸€ä¸ªæ˜¯è®°å½•ï¼Œä¸€ä¸ªæ˜¯å¼€å¯ï¼Œå¦‚æœä½ åªæœ‰è®°å½•ï¼Œæ²¡æœ‰å¼€å¯æ˜¯æ²¡æœ‰äºŒè¿›åˆ¶æ—¥å¿—çš„ï¼Œæ‰€ä»¥äºŒè€…`ç¼ºä¸€ä¸å¯`\n\nå…ˆçœ‹çœ‹æ€ä¹ˆæŸ¥\n\n```bash\n[root@master ~]# mysql -uroot -p123456 -e \"select @@log_bin;\"\nmysql: [Warning] Using a password on the command line interface can be insecure.\n+-----------+\n| @@log_bin |\n+-----------+\n|         1 |\n+-----------+\n[root@master ~]# mysql -uroot -p123456 -e \"select @@sql_log_bin;\"\nmysql: [Warning] Using a password on the command line interface can be insecure.\n+---------------+\n| @@sql_log_bin |\n+---------------+\n|             1 |\n+---------------+\n[root@master ~]#\n```\n\nå¦‚æœä½ çœ‹åˆ°ä¸¤ä¸ªéƒ½æ˜¯1æˆ–è€…ONé‚£å°±æ˜¯å…¨éƒ¨å¼€å¯äº†\n\n## ä¸€ä¸»ä¸€ä»\n\nmasterï¼š192.168.48.128\n\nslaveï¼š192.168.48.11\n\n### å®‰è£…mysql\n\n> è‡ªè¡Œå…³é—­firewalldï¼Œselinux\n\næ“ä½œèŠ‚ç‚¹ï¼šã€æ‰€æœ‰èŠ‚ç‚¹ã€‘\n\n#### äºŒè¿›åˆ¶å®‰è£…ï¼ˆé€‚åˆæ–°æœºï¼‰\n\n```bash\n#ä½ å¯ä»¥é€‰æ‹©ç”¨æˆ‘çš„è„šæœ¬è¿›è¡Œå®‰è£…äºŒè¿›åˆ¶çš„mysql\n#äºŒè¿›åˆ¶å®‰è£…æ˜¯åŸºæœ¬æ‰€æœ‰linuxéƒ½å¯ä»¥ä½¿ç”¨çš„ï¼Œå¦‚æœæœ‰å“ªä¸ªç³»ç»Ÿè¿è¡Œä¸äº†è¯·ç•™è¨€\nwget https://blog.qianyios.top/file/mysql_install.sh\nbash mysql_install.sh\n#å¯†ç æˆ‘è®¾ç½®äº†123456ï¼ˆå»ºè®®ä¸è¦å¤ªç®€å•ï¼‰\n#å»ºè®®é€‰æ¸…ç†ä¸€éï¼ˆè¾“å…¥3ï¼‰ï¼Œå†è¿›è¡Œå®‰è£…mysql8.0ï¼ˆè¾“å…¥2ï¼‰\n```\n\n#### å…¶ä»–å®‰è£…\n\nå…¶ä»–æ–¹å¼è‡ªè¡Œå®‰è£…ï¼Œæˆ‘å°±ä¸è§£é‡Šäº†ï¼Œåªè¦ç¡®ä¿åŒä¸ªç‰ˆæœ¬å·®ä¸å¤šå°±è¡Œäº†8.0.xè¿™äº›ã€‚\n\n### ä¸»èŠ‚ç‚¹é…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼šã€masterã€‘\n\n#### ä¿®æ”¹/etc/my.cnf\n\n```bash\n#å…¶ä»–å®‰è£…mysqlçš„æ–¹æ³•ï¼Œä½ åªéœ€è¦ç¡®ä¿æœ‰å¦‚ä¸‹é€‰é¡¹å°±è¡Œäº†\n[mysqld]\nsever-id=128\nlog-bin=/data/logbin/qylog\n```\n\n`sever-id` ï¼šå¿…é¡»æ˜¯æ•´ä¸ªé›†ç¾¤é‡Œé¢å”¯ä¸€çš„ï¼Œä¸èƒ½é‡å¤ \n\n`log-bin`:åç»­ä¼šåœ¨/data/logbinç”Ÿæˆqylog.000001çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è·¯å¾„å’Œæ–‡ä»¶åä¸ç”¨åŠ åç¼€\n\nå¦‚æœæ˜¯ç”¨äº†æˆ‘çš„è„šæœ¬å®‰è£…çš„mysqlå¯ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¸æ˜¯çš„è¯å°±çœ‹ä¸Šé¢é‚£ä¸ªæ­¥éª¤æ‰‹åŠ¨ä¿®æ”¹\n\n```bash\ncat > /etc/my.cnf << \"EOF\"\n[mysqld]\nserver-id=128\ndatadir=/data/mysql\nskip_name_resolve=1\nsocket=/data/mysql/mysql.sock\nlog-error=/data/mysql/mysql.log\npid-file=/data/mysql/mysql.pid\ncharacter-set-server=utf8mb4\n#å¼€å¯äºŒè¿›åˆ¶é€‰é¡¹\nlog-bin=/data/logbin/qylog\n#äºŒè¿›åˆ¶æ—¥å¿—è®°å½•çš„æ ¼å¼ï¼Œmariadb5.5é»˜è®¤STATEMENT\n#binlog_format=STATEMENT|ROW|MIXED\n[client]\nsocket=/data/mysql/mysql.sock\n[mysql]\nprompt=(\\\\u@\\\\h) [\\\\d]>\\\\_\nEOF\n```\n\n\n\nç”±äºå‰é¢ä¸æ˜¯å¼€å¯äº†äºŒè¿›åˆ¶æ–‡ä»¶çš„åŠŸèƒ½å—\n\næˆ‘çš„è·¯å¾„æ˜¯ï¼š`/data/logbin/qylog`ï¼Œå…¶ä¸­`/data/logbin`å¹¶ä¸å­˜åœ¨ï¼Œä½ è¦æ‰‹åŠ¨åˆ›å»ºï¼Œä¸ç„¶å¼€å¯mysqlä¼šæŠ¥é”™\n\n```bash\nmkdir -p /data/logbin\nchown -R mysql:mysql /data/logbin\nsystemctl restart mysqld\n```\n\næ­¤æ—¶äºŒè¿›åˆ¶æ–‡ä»¶å·²ç»åˆ›å»ºæˆåŠŸ\n\n```bash\n[root@master ~]# ll /data/logbin/\ntotal 8\n-rw-r----- 1 mysql mysql 157 Jul 31 18:53 qylog.000001\n-rw-r----- 1 mysql mysql  26 Jul 31 18:53 qylog.index\n```\n\n\n\n#### åˆ›å»ºç”¨äºä¸»ä»å¤åˆ¶çš„è´¦å·\n\n```bash\n[root@master ~]# mysql -uroot -p123456 -e \"show master status\"\nmysql: [Warning] Using a password on the command line interface can be insecure.\n+--------------+----------+--------------+------------------+-------------------+\n| File         | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+--------------+----------+--------------+------------------+-------------------+\n| qylog.000001 |      157 |              |                  |                   |\n+--------------+----------+--------------+------------------+-------------------+\n#è®°ä½è¿™ä¸ªqylog.000001å’Œèµ·å§‹ä½ç½®157ï¼Œåé¢ä¼šç”¨åˆ°\n```\n\n```bash\n#åˆ›å»ºrepluserç”¨æˆ·ï¼Œå¯†ç æ˜¯123456ï¼Œå…è®¸ä»192.168.48.0æ¥è¿æ¥masterçš„mysql\nmysql -uroot -p123456 -e \"create user repluser@'192.168.48.%' identified by '123456';\"\nmysql -uroot -p123456 -e \"grant replication slave on *.* to repluser@'192.168.48.%';\"\n```\n\n### ä»èŠ‚ç‚¹é…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼šã€slave1ã€‘\n\n#### ä¿®æ”¹/etc/my.cnf\n\n```bash\n#å…¶ä»–å®‰è£…mysqlçš„æ–¹æ³•ï¼Œä½ åªéœ€è¦ç¡®ä¿æœ‰å¦‚ä¸‹é€‰é¡¹å°±è¡Œäº†\n[mysqld]\nserver-id=11\nlog-bin=/data/logbin/qylog\nread_only=ON #è®¾ç½®æ•°æ®åº“åªè¯»ï¼Œé’ˆå¯¹supper useræ— æ•ˆ\n#å¯åŠ¨ä¸­ç»§æ—¥å¿—\nrelay_log=/data/relaylog/relay-log #relay logçš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼hostname-relay-bin\nrelay_log_index=/data/relaylog/relay-log.index  #é»˜è®¤å€¼hostname-relay-bin.index\n```\n\n`sever-id` ï¼šå¿…é¡»æ˜¯æ•´ä¸ªé›†ç¾¤é‡Œé¢å”¯ä¸€çš„ï¼Œä¸èƒ½é‡å¤\n\n`log-bin`:åç»­ä¼šåœ¨/data/logbinç”Ÿæˆqylog.000001çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è·¯å¾„å’Œæ–‡ä»¶åä¸ç”¨åŠ åç¼€\n\nå¦‚æœæ˜¯ç”¨äº†æˆ‘çš„è„šæœ¬å®‰è£…çš„mysqlå¯ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¸æ˜¯çš„è¯å°±çœ‹ä¸Šé¢é‚£ä¸ªæ­¥éª¤æ‰‹åŠ¨ä¿®æ”¹\n\n```bash\ncat > /etc/my.cnf << \"EOF\"\n[mysqld]\nserver-id=11\ndatadir=/data/mysql\nsocket=/data/mysql/mysql.sock\nlog-error=/data/mysql/mysql.log\npid-file=/data/mysql/mysql.pid\ncharacter-set-server=utf8mb4\n#å¼€å¯äºŒè¿›åˆ¶é€‰é¡¹\nlog-bin=/data/logbin/qylog\n#äºŒè¿›åˆ¶æ—¥å¿—è®°å½•çš„æ ¼å¼ï¼Œmariadb5.5é»˜è®¤STATEMENT\n#binlog_format=STATEMENT|ROW|MIXED\nread_only=ON #è®¾ç½®æ•°æ®åº“åªè¯»ï¼Œé’ˆå¯¹supper useræ— æ•ˆ\nrelay_log=/data/relaylog/relay-log #relay logçš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼hostname-relay-bin\nrelay_log_index=/data/relaylog/relay-log.index  #é»˜è®¤å€¼hostname-relay-bin.index\n[client]\nsocket=/data/mysql/mysql.sock\n[mysql]\nprompt=(\\\\u@\\\\h) [\\\\d]>\\\\_\nEOF\n```\n\n\n\nç”±äºå‰é¢ä¸æ˜¯å¼€å¯äº†äºŒè¿›åˆ¶æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè¿˜æœ‰å¼€å¯ä¸­ç»§æ—¥å¿—çš„åŠŸèƒ½å—\n\næˆ‘çš„è·¯å¾„æ˜¯ï¼š\n\n`log-bin=/data/logbin/qylog`ï¼Œå…¶ä¸­`/data/logbin`å¹¶ä¸å­˜åœ¨\n\n`relay_log=/data/relaylog/relay-log`ï¼Œå…¶ä¸­`/data/relaylog`å¹¶ä¸å­˜åœ¨\n\nä½ è¦æ‰‹åŠ¨åˆ›å»ºï¼Œä¸ç„¶å¼€å¯mysqlä¼šæŠ¥é”™\n\n```bash\nmkdir -p /data/logbin /data/relaylog\nchown -R mysql:mysql /data/logbin /data/relaylog\nsystemctl restart mysqld\n```\n\n#### å¯åŠ¨å¤åˆ¶çº¿ç¨‹\n\næ“ä½œèŠ‚ç‚¹ï¼š[slave]\n\nä½¿ç”¨æœ‰å¤åˆ¶æƒé™çš„ç”¨æˆ·è´¦å·è¿æ¥è‡³ä¸»æœåŠ¡å™¨\n\n```bash\nmysql -u root -p123456\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.128', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000001', \nMASTER_LOG_POS=157,\nget_master_public_key=1,\nMASTER_DELAY=10; \n```\n\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.128',  `masterçš„ip`\nMASTER_USER='repluser',              `masteråˆ›å»ºçš„ä¸»ä»å¤åˆ¶çš„è´¦å·`\nMASTER_PASSWORD='123456',   `masteråˆ›å»ºçš„ä¸»ä»å¤åˆ¶çš„è´¦å·çš„å¯†ç `\nMASTER_LOG_FILE='qylog.000001',   `masteræŸ¥çœ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶`\nMASTER_LOG_POS=157,              `masteræŸ¥çœ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„èµ·å§‹ä½ç½®`\nMASTER_DELAY=10;                `å»¶è¿Ÿæ›´æ–°10s`\n\n\n\n**å¯åŠ¨å¤åˆ¶çº¿ç¨‹**\n\n```bash\nstart slave;\nshow slave status\\G;\n```\n\nç¡®ä¿æœ‰ä¸¤ä¸ªyeså°±è¡Œäº†\n\n![image-20250731192451014](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/0826b51610ecc401cf7a6e0078dceeed697559838.png)\n\nå¦‚æœä½ æƒ³é‡ç½®çº¿ç¨‹å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤\n\n```bash\nstop slave;\nreset slave;\n```\n\n   æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹ï¼Œå› ä¸ºäºŒè¿›åˆ¶æ—¥å¿—æ˜¯è®°å½•ä½ çš„æ“ä½œçš„å˜›ï¼Œæˆ‘ä»¬åœ¨å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ä¹‹åï¼Œä¸æ˜¯åœ¨`ä¸»èŠ‚ç‚¹`åˆ›å»ºäº†ä¸€ä¸ªrepluserç”¨æˆ·å—ï¼Œé‚£è¿™ä¸ªæ“ä½œè‚¯å®šä¹Ÿè¢«è®°å½•ï¼Œç„¶åè¿™ä¸æ˜¯ä¸»ä»å¤åˆ¶äº†å—ï¼Œè¿™é‡Œè‚¯å®šï¼Œä¹Ÿä¼šåŒæ­¥ï¼Œä¹Ÿä¼šè¿è¡Œï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æœ¬èº«å°±æ˜¯ä¸€ä¸ªsqlæ–‡ä»¶ï¼Œæ™®é€šcatæ˜¯çœ‹ä¸äº†ï¼Œä½ å¾—ç”¨è¿™ä¸ªå‘½ä»¤\n\n```bash\n[root@master ~]# mysqlbinlog -uroot -p123456 /data/logbin/qylog.000001 -v\n```\n\n![image-20250731192811206](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/3a0d670c6707001c2d0f71197c80a912697559838.png)\n\næ‰€æœ‰æ—¢ç„¶ä¸»ä»å¤åˆ¶äº†ï¼Œé‚£åœ¨ä»èŠ‚ç‚¹ï¼Œåº”è¯¥ä¹Ÿè¿è¡Œäº†è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±è¯´æ˜ä»èŠ‚ç‚¹ä¹Ÿæœ‰è¿™ä¸ªè´¦å·\n\n```bash\nselect host,user from mysql.user;\n```\n\n![image-20250731193001300](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/7746b8ac2ccfcde6db4d4498c24db96c697559838.png)\n\n### æµ‹è¯•\n\næ¥ä¸‹æ¥åœ¨ä¸»èŠ‚ç‚¹å¯¼å…¥æµ‹è¯•æ•°æ®\n\nå…¨é€‰å¤åˆ¶ç²˜è´´`é€€å‡ºmysql`è¿è¡Œ\n\n```bash\ncat > hellodb.sql <<\"EOF\"\n\nCREATE DATABASE /*!32312 IF NOT EXISTS*/ `hellodb` /*!40100 DEFAULT CHARACTER SET utf8 */;\nUSE `hellodb`;\n\nDROP TABLE IF EXISTS `classes`;\nCREATE TABLE `classes` (\n  `ClassID` tinyint(3) unsigned NOT NULL AUTO_INCREMENT,\n  `Class` varchar(100) DEFAULT NULL,\n  `NumOfStu` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ClassID`)\n) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `classes` WRITE;\nINSERT INTO `classes` VALUES\n(1,'Shaolin Pai',10),(2,'Emei Pai',7),\n(3,'QingCheng Pai',11),(4,'Wudang Pai',12),(5,'Riyue Shenjiao',31),\n(6,'Lianshan Pai',27),(7,'Ming Jiao',27),(8,'Xiaoyao Pai',15);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `coc`;\nCREATE TABLE `coc` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `ClassID` tinyint(3) unsigned NOT NULL,\n  `CourseID` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `coc` WRITE;\nINSERT INTO `coc` VALUES (1,1,2),(2,1,5),(3,2,2),(4,2,6),(5,3,1),(6,3,7),(7,4,5),(8,4,2),(9,5,1),(10,5,9),(11,6,3),(12,6,4),(13,7,4),(14,7,3);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `courses`;\nCREATE TABLE `courses` (\n  `CourseID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,\n  `Course` varchar(100) NOT NULL,\n  PRIMARY KEY (`CourseID`)\n) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `courses` WRITE;\n/*!40000 ALTER TABLE `courses` DISABLE KEYS */;\nINSERT INTO `courses` VALUES (1,'Hamo Gong'),(2,'Kuihua Baodian'),(3,'Jinshe Jianfa'),(4,'Taiji Quan'),(5,'Daiyu Zanghua'),(6,'Weituo Zhang'),(7,'Dagou Bangfa');\n/*!40000 ALTER TABLE `courses` ENABLE KEYS */;\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `scores`;\nCREATE TABLE `scores` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `StuID` int(10) unsigned NOT NULL,\n  `CourseID` smallint(5) unsigned NOT NULL,\n  `Score` tinyint(3) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `scores` WRITE;\nINSERT INTO `scores` VALUES (1,1,2,77),(2,1,6,93),(3,2,2,47),(4,2,5,97),(5,3,2,88),(6,3,6,75),(7,4,5,71),(8,4,2,89),(9,5,1,39),(10,5,7,63),(11,6,1,96),(12,7,1,86),(13,7,7,83),(14,8,4,57),(15,8,3,93);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `students`;\nCREATE TABLE `students` (\n  `StuID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `Name` varchar(50) NOT NULL,\n  `Age` tinyint(3) unsigned NOT NULL,\n  `Gender` enum('F','M') NOT NULL,\n  `ClassID` tinyint(3) unsigned DEFAULT NULL,\n  `TeacherID` int(10) unsigned DEFAULT NULL,\n  PRIMARY KEY (`StuID`)\n) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `students` WRITE;\nINSERT INTO `students` VALUES (1,'Shi Zhongyu',22,'M',2,3),(2,'Shi Potian',22,'M',1,7),(3,'Xie Yanke',53,'M',2,16),(4,'Ding Dian',32,'M',4,4),(5,'Yu Yutong',26,'M',3,1),(6,'Shi Qing',46,'M',5,NULL),(7,'Xi Ren',19,'F',3,NULL),(8,'Lin Daiyu',17,'F',7,NULL),(9,'Ren Yingying',20,'F',6,NULL),(10,'Yue Lingshan',19,'F',3,NULL),(11,'Yuan Chengzhi',23,'M',6,NULL),(12,'Wen Qingqing',19,'F',1,NULL),(13,'Tian Boguang',33,'M',2,NULL),(14,'Lu Wushuang',17,'F',3,NULL),(15,'Duan Yu',19,'M',4,NULL),(16,'Xu Zhu',21,'M',1,NULL),(17,'Lin Chong',25,'M',4,NULL),(18,'Hua Rong',23,'M',7,NULL),(19,'Xue Baochai',18,'F',6,NULL),(20,'Diao Chan',19,'F',7,NULL),(21,'Huang Yueying',22,'F',6,NULL),(22,'Xiao Qiao',20,'F',1,NULL),(23,'Ma Chao',23,'M',4,NULL),(24,'Xu Xian',27,'M',NULL,NULL),(25,'Sun Dasheng',100,'M',NULL,NULL);\nUNLOCK TABLES;\n\nDROP TABLE IF EXISTS `teachers`;\nCREATE TABLE `teachers` (\n  `TID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,\n  `Name` varchar(100) NOT NULL,\n  `Age` tinyint(3) unsigned NOT NULL,\n  `Gender` enum('F','M') DEFAULT NULL,\n  PRIMARY KEY (`TID`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;\n\nLOCK TABLES `teachers` WRITE;\nINSERT INTO `teachers` VALUES (1,'Song Jiang',45,'M'),(2,'Zhang Sanfeng',94,'M'),(3,'Miejue Shitai',77,'F'),(4,'Lin Chaoying',93,'F');\nUNLOCK TABLES;\n\n\nDROP TABLE IF EXISTS `toc`;\nCREATE TABLE `toc` (\n  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `CourseID` smallint(5) unsigned DEFAULT NULL,\n  `TID` smallint(5) unsigned DEFAULT NULL,\n  PRIMARY KEY (`ID`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nLOCK TABLES `toc` WRITE;\nUNLOCK TABLES;\n\nEOF\n```\n\nåœ¨ä¸»èŠ‚ç‚¹å¯¼å…¥\n\n```bash\n#å¯¼å…¥\n[root@master ~]# mysql -uroot -p123456 < hellodb.sql\nmysql: [Warning] Using a password on the command line interface can be insecure.#è¿™ä¸ªè­¦å‘Šæ²¡å…³ç³»\n\n[root@master ~]# mysql -uroot -p123456 hellodb -e \"show tables;\"\nmysql: [Warning] Using a password on the command line interface can be insecure.\n+-------------------+\n| Tables_in_hellodb |\n+-------------------+\n| classes           |\n| coc               |\n| courses           |\n| scores            |\n| students          |\n| teachers          |\n| toc               |\n+-------------------+\n#æˆåŠŸå¯¼å…¥\n\n#åœ¨ä¸»èŠ‚ç‚¹æ’å…¥ä¸€æ¡æ•°æ®\nmysql -uroot -p123456\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"XIAOHU\",18,'M');\nselect * from teachers;\n#æˆåŠŸæ’å…¥æ•°æ®\n(root@localhost) [hellodb]> select * from teachers;\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n|   5 | XIAOHU        |  18 | M      |\n+-----+---------------+-----+--------+\n\n```\n\næ¥ä¸‹æ¥çœ‹çœ‹ä»èŠ‚ç‚¹æ˜¯å¦æœ‰æˆåŠŸå®ç°ä¸»ä»å¤åˆ¶\n\n```bash\n[root@slave ~]# mysql -uroot -p123456\nuse hellodb;\nshow tables;\nselect * from teachers;\n\n#çœ‹å§ï¼Œå·²ç»æˆåŠŸä»ä¸»èŠ‚ç‚¹å¤åˆ¶æ•°æ®åˆ°ä»èŠ‚ç‚¹\n(root@localhost) [hellodb]> show tables;\n+-------------------+\n| Tables_in_hellodb |\n+-------------------+\n| classes           |\n| coc               |\n| courses           |\n| scores            |\n| students          |\n| teachers          |\n| toc               |\n+-------------------+\n7 rows in set (0.00 sec)\n#æ–°æ’å…¥çš„æ•°æ®ä¹Ÿåœ¨\n(root@localhost) [hellodb]> select * from teachers;\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n|   5 | XIAOHU        |  18 | M      |\n+-----+---------------+-----+--------+\n5 rows in set (0.00 sec)\n\n```\n\nè‡³æ­¤ï¼Œä¸€ä¸»ä¸€ä»çš„ä¸»ä»å¤åˆ¶å®éªŒæˆåŠŸï¼Œä½ å¿…é¡»ç†è§£ï¼Œä¸»è¦æ˜¯é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—æ¥ä¾é ä¼ è¾“çš„\n\n### æ¡ˆä¾‹\n\nå®æˆ˜æ¡ˆä¾‹ï¼šå°†å·²æœ‰çš„`MySQL8.0`å•æœºæ¶æ„å˜æˆä¸»ä»å¤åˆ¶æ¶æ„\n\nè¿™å°å•æœºï¼Œå¯èƒ½è¿è¡Œå¾ˆä¹…äº†ï¼Œæœ‰å¾ˆå¤šæ•°æ®äº†ï¼Œç°åœ¨è¦è®©ä»–å˜æˆä¸»ä»æ¶æ„\n\nå‰æï¼š`ä¸¤è€…å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½`\n\n1.mysqldumpå¤‡ä»½æ‰€æœ‰æ•°æ®åº“\n\n2.åˆ›å»ºä¼ è¾“ç”¨æˆ·å¹¶ä¸”æˆæƒ\n\n3.å°†å¤‡ä»½scpå¤åˆ¶åˆ°ä»èŠ‚ç‚¹\n\n4.ä»èŠ‚ç‚¹å¼€å¯read-onlyç­‰å‚æ•°\n\n5.ä»èŠ‚ç‚¹è®¾ç½®ä¸»ä»å¤åˆ¶è¿æ¥\n\n6.ä»èŠ‚ç‚¹è¿›è¡Œè¿˜åŸå¤‡ä»½\n\n7.å¼€å¯ä¸»ä»å¤åˆ¶ï¼Œstart slaveï¼›\n\n```bash\n#å·²æœ‰çš„masterèŠ‚ç‚¹,å¤‡ä»½æ‰€æœ‰çš„æ•°æ®åº“\nmysqldump -uroot -p123456 -A -F -E -R --triggers --single-transaction \\\n--source-data=1 --flush-privileges --hex-blob --default-character-set=utf8 > all.sql\n\n#åˆ›å»ºä¼ è¾“ç”¨æˆ·å¹¶ä¸”æˆæƒ\nmysql -uroot -p123456 -e \"create user repluser@'192.168.48.%' identified by '123456';\"\nmysql -uroot -p123456 -e \"grant replication slave on *.* to repluser@'192.168.48.%';\"\n\n#å°†å¤‡ä»½scpå¤åˆ¶åˆ°ä»èŠ‚ç‚¹\nscp -p all.sql 192.168.48.11:/root/\n\n#ä»èŠ‚ç‚¹å¼€å¯read-onlyç­‰å‚æ•°\n[root@slave ~]# cat /etc/my.cnf\nserver-id=8\nlog-bin=/data/logbin/qylog\nread_only=ON\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\n\n#ä»èŠ‚ç‚¹è®¾ç½®ä¸»ä»å¤åˆ¶è¿æ¥\n#1.æŸ¥çœ‹all.sqlçš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œèµ·å§‹ä½ç½®\nhead -n 30 all.sql\nCHANGE MASTER TO MASTER_LOG_FILE='qylog.000002', MASTER_LOG_POS=157;\n#2.è®¾ç½®å¤åˆ¶è¿æ¥ï¼Œå¡«å…¥å‰é¢çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œèµ·å§‹ä½ç½®\nmysql -u root -p123456\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.128', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000002', \nMASTER_LOG_POS=157,\nMASTER_DELAY=10; \n\n#ä»èŠ‚ç‚¹è¿›è¡Œè¿˜åŸå¤‡ä»½\n#å…ˆåœæ­¢è®°å½•äºŒè¿›åˆ¶æ—¥å¿—\nmysql -u root -p123456\nset sql_log_bin=0;\nsource all.sql\nset sql_log_bin=1;\n\n#å¼€å¯ä¸»ä»å¤åˆ¶\nstart slave;\nshow slave status\\G;\n#å¯èƒ½ç­‰å¾…60ç§’æ‰èƒ½ä¸»ä»åŒyes\n\n#ä¸»èŠ‚ç‚¹æ’å…¥æ–°æ•°æ®\nmysql -uroot -p123456\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"qianyios\",18,'M');\nselect * from teachers;\n#æœ€åçœ‹çœ‹æ˜¯å¦æœ‰æ•°æ®åº“å·²ç»æ–°æ’å…¥çš„æ•°æ®åº“æ˜¯å¦åŒæ­¥æˆåŠŸ\n(root@localhost) [hellodb]> show tables;\n+-------------------+\n| Tables_in_hellodb |\n+-------------------+\n| classes           |\n| coc               |\n| courses           |\n| scores            |\n| students          |\n| teachers          |\n| toc               |\n+-------------------+\n7 rows in set (0.00 sec)\n\n(root@localhost) [hellodb]> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| hellodb            |\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n5 rows in set (0.00 sec)\n(root@localhost) [hellodb]> select * from teachers;\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n|   5 | XIAOHU        |  18 | M      |\n|   6 | qianyios      |  18 | M      |\n+-----+---------------+-----+--------+\n\n```\n\n## ä¸€ä¸»å¤šä»\n\nmasterï¼š192.168.48.128\n\nslave1ï¼š192.168.48.11\n\nslave2ï¼š192.168.48.10\n\næ¥ä¸‹æ¥åœ¨å‰é¢çš„ä¸€ä¸»ä¸€ä»å¤åˆ¶æ¶æ„ï¼Œå˜æˆä¸€ä¸»å¤šä»ï¼Œä¸€æ ·ï¼Œå¦‚æœè¿™ä¸ªmysqlçš„ä¸»èŠ‚ç‚¹æ˜¯å·²ç»è¿è¡Œå¾ˆä¹…äº†ï¼Œä½ å°±è¦å…¨éƒ¨å¤‡ä»½ï¼Œæ‹‰åˆ°ä»èŠ‚ç‚¹ï¼Œ`æ³¨æ„æ–°çš„ä»èŠ‚ç‚¹è¦å®‰è£…å’Œå¦å¤–ä¸€ä¸ªä»èŠ‚ç‚¹ä¸€æ ·çš„mysqlç‰ˆæœ¬ï¼ˆè¿™é‡Œæˆ‘å°±ç•¥è¿‡å®‰è£…æ•™ç¨‹äº†ï¼‰`ï¼Œç„¶ååªéœ€è¦åœ¨æ–°ä»èŠ‚ç‚¹è®¾ç½®å¥½/etc/my.cnfå’Œä¸»ä»è¿æ¥ä¿¡æ¯ï¼Œå…³é—­äºŒè¿›åˆ¶è®°å½•ï¼Œè¿˜åŸall.sqlæ–‡ä»¶ï¼Œå¼€å¯äºŒè¿›åˆ¶è®°å½•ï¼Œå¼€å¯ä¸»ä»å¤åˆ¶å³å¯\nè¿™é‡Œå°±æ¥ç€é‚£ä¸ª`æ¡ˆä¾‹`æ¥\n\n```bash\n#åœ¨æ¡ˆä¾‹çš„æ—¶é—´ç‚¹ä¹‹åï¼Œåˆè¿è¡Œäº†ä¸€æ®µæ—¶é—´ï¼Œæ­¤æ—¶ä½ å¿…é¡»é‡æ–°å¤‡ä»½å…¨éƒ¨æ•°æ®åº“ï¼Œæ‹‰åˆ°ä»èŠ‚ç‚¹\nmysqldump -uroot -p123456 -A -F -E -R --triggers --single-transaction \\\n--source-data=1 --flush-privileges --hex-blob --default-character-set=utf8 > all.sql\n\nscp -p all.sql 192.168.48.10:/root/\n\n#æ–°ä»èŠ‚ç‚¹åˆ›å»ºä¼ è¾“ç”¨æˆ·å¹¶ä¸”æˆæƒ\nmysql -uroot -p123456 -e \"create user repluser@'192.168.48.%' identified by '123456';\"\nmysql -uroot -p123456 -e \"grant replication slave on *.* to repluser@'192.168.48.%';\"\n\n#vimè¿›å»all.sql\nä¼šæœ‰ä¸€æ®µ\nCHANGE MASTER TO MASTER_LOG_FILE='qylog.000003', MASTER_LOG_POS=157;\n#æ˜¯ä¸æ˜¯å¾ˆåƒè¿æ¥ä¿¡æ¯ï¼Œé‚£ä½ å°±æŠŠå®ƒå˜æˆä¸‹é¢é‚£æ ·ï¼Œå°±å…¶å®å®ƒäºŒè¿›åˆ¶æ–‡ä»¶å’Œèµ·å§‹ä½ç½®éƒ½æœ‰äº†ï¼Œåªéœ€è¦æŠŠå…¶ä»–è¡¥é½å°±è¡Œäº†\n\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.128', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000003', \nMASTER_LOG_POS=157; \n\n#ç„¶åä¿å­˜é€€å‡ºï¼Œè¿™å’Œæ¡ˆä¾‹é‡Œçš„å…ˆè®¾ç½®ä¸»ä»å¤åˆ¶è¿æ¥æ•ˆæœæ˜¯ä¸€æ ·ï¼Œæˆ‘å°±ç›´æ¥åœ¨æ–‡ä»¶é‡Œè®¾ç½®ä¹Ÿä¸€æ ·\n#æ²¡å…³ç³»çš„ï¼Œè¿™æ ·è¿›æ–‡ä»¶ï¼Œçœå¾—æˆ‘è¿˜è¦çœ‹ä¸€éäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å•¥äº†ï¼Œå¯¹ä¸å¯¹ï¼Œæˆ‘ç›´æ¥è¿›å»è®¾ç½®\n\n\n#æ¥ä¸‹æ¥è¿›è¡Œè¿˜åŸ\nset sql_log_bin=0;\nsource all.sql;\nset sql_log_bin=1;\n\n#å¼€å¯slaveä¸»ä»å¤åˆ¶\nstart slave;\nshow slave status\\G;\n\n#æ¥ä¸‹æ¥ä½ å°±è‡ªè¡Œæµ‹è¯•ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ•°æ®åº“å·²ç»è¿˜åŸæˆåŠŸå’Œæ–°æ’å…¥æ•°æ®æ˜¯å¦æˆåŠŸå¹¶ç¡®è®¤æ˜¯å¦åŒæ­¥\n```\n\nè‡³æ­¤ä¸€ä¸»å¤šä»æˆåŠŸï¼\n\n## çº§è”å¤åˆ¶\n\nmasterï¼š192.168.48.128\n\nslave1ï¼š192.168.48.11ï¼ˆå……å½“çº§è”slaveä¸­é—´èŠ‚ç‚¹ï¼‰\n\nslave2ï¼š192.168.48.10\n\nè¿™ä¸ªå®éªŒï¼Œæˆ‘å°±åªç”¨äº†ä¸€ä¸ªslave2ï¼Œslave3å’Œslave2çš„æ“ä½œä¸€æ ·çš„\n\n![image-20250801003323415](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/06188566f044314ee81657ce9bdd637d697559838.png)\n\nä¸ºå•¥ä¼šæœ‰çº§è”å‘¢ï¼\n\nå°±å¥½æ¯”å‰é¢çš„ä¸€ä¸»å¤šä»ï¼Œä»–è¦è¿›è¡Œå¤šä¸ªå¤åˆ¶ä»»åŠ¡ç»™ä»èŠ‚ç‚¹ï¼Œé‚£ä¸»èŠ‚ç‚¹çš„å‹åŠ›æ˜¯ä¸æ˜¯å¤§ä¸€ç‚¹ï¼Œé‚£ä¹ˆå°±æœ‰äº†çº§è”ï¼ŒæŠŠå¤åˆ¶ä»»åŠ¡åˆ†æ‹…ç»™ä»èŠ‚ç‚¹\n\nè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜\n\né¦–å…ˆæˆ‘ä»¬éƒ½çŸ¥é“ä¸»ä»å¤åˆ¶çš„åŸç†å°±æ˜¯ï¼Œä¸»èŠ‚ç‚¹é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—`bin`ä¼ è¾“æ•°æ®åˆ°ä»èŠ‚ç‚¹çš„ioçº¿ç¨‹æ¥æ”¶å†™åˆ°ä¸­ç»§æ—¥å¿—`relay`,é‚£åé¢çš„`slave2`å’Œ`slave3`åº”è¯¥ä¹Ÿæ˜¯è¿™æ ·ï¼Œåªéœ€è¦æ¥æ”¶`slave1`çš„binçš„æ•°æ®å°±è¡Œäº†æ˜¯ä¸æ˜¯\n\né”™ï¼å¤§é”™ç‰¹é”™ï¼ï¼ï¼ï¼ï¼ï¼\n\nslave1çš„binçš„æ•°æ®ä»å“ªé‡Œæ¥ï¼Œä»–è‡ªå·±æœ¬èº«å°±æ˜¯ç”Ÿæˆè‡ªå·±è‡ªèº«çš„æ•°æ®ï¼Œä»–æ€ä¹ˆå¯èƒ½æœ‰ä¸»èŠ‚ç‚¹çš„æ•°æ®å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å¾—ä»è‡ªèº«çš„relayæ¥ï¼Œæ‰€ä»¥åé¢ä¼šè®²åˆ°ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯å¯ä»¥è®©relayçš„æ•°æ®ä¼ è¾“è¿‡æ¥çš„æ—¶å€™è‡ªåŠ¨å†™å…¥åˆ°binï¼Œé‚£å°±åé¢å†è¯´\n\n`è¿™é‡Œå»¶ç»­å‰é¢çš„ä¸€ä¸»å¤šä»`\n\n```bash\n#é¦–å…ˆæˆ‘å¾—æŠŠslave2çš„ä¸€äº›ä¿¡æ¯åˆ é™¤ï¼Œè„±ç¦»åŸæ¥ä¸€ä¸»å¤šä»\n#/etc/my.cnfçš„ä¿¡æ¯ä¸ç”¨åˆ ï¼Œæœ¬èº«å°±æ˜¯ç»™ä»èŠ‚ç‚¹ç”¨çš„\n#è¦åˆ å°±è¦åˆ é™¤ä¸»ä»å¤åˆ¶çš„è¿æ¥ä¿¡æ¯ï¼Œé¡ºä¾¿é‡ç½®äºŒè¿›åˆ¶ä¿¡æ¯\nstop slave;\nreset slave all;\nreset master;\n```\n\nåœ¨ä¸­é—´èŠ‚ç‚¹`slave1`å¯ç”¨ä»¥ä¸‹é…ç½®ï¼Œå®ç°ä¸­é—´slaveèŠ‚ç‚¹èƒ½å°†masterçš„äºŒè¿›åˆ¶æ—¥å¿—åœ¨æœ¬æœºè¿›è¡Œæ•°æ®åº“æ›´æ–°ï¼Œå¹¶ä¸”ä¹ŸåŒæ—¶æ›´æ–°æœ¬æœºçš„äºŒè¿›åˆ¶ï¼Œä»è€Œå®ç°çº§è”å¤åˆ¶\n\n```bash\n[mysqld]\nsever-id=11\nlog-bin=/data/logbin/qylog\nread_only=ON\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\nlog_slave_updates #çº§è”å¤åˆ¶ä¸­é—´èŠ‚ç‚¹çš„å¿…é€‰ï¼Œ,MySQL8.0æ­¤ä¸ºé»˜è®¤å€¼,å¯ä»¥ä¸ç”¨äººä¸ºæ·»åŠ ,å…¶å®ƒç‰ˆæœ¬é»˜è®¤ä¸å¼€å¯\n```\n\né‡å¯mysql\n\n```bash\n systemctl restart mysqld\n```\n\næ¥ç€åœ¨æ–°çš„ä»èŠ‚ç‚¹ï¼ˆslave2ï¼‰è¿›è¡Œæ“ä½œï¼Œå‡è®¾ä»–æ˜¯æ–°çš„ï¼Œä½ è¦è¿›è¡Œçš„æ˜¯ï¼Œé…ç½®my.cnfï¼Œåˆ›å»ºä¸»ä»å¤åˆ¶è´¦å·å’Œæˆæƒï¼Œè¿˜æœ‰å› ä¸ºä»–æ˜¯æ–°çš„ï¼Œæ²¡æœ‰æ•°æ®ï¼Œä½ è¿˜è¦åœ¨`ä»èŠ‚ç‚¹`å¤‡ä»½å…¨éƒ¨æ•°æ®åº“åˆ°ä»èŠ‚ç‚¹\n\n```bash\n#æ–°çš„ä»èŠ‚ç‚¹\n[mysqld]\nserver-id=10\nlog-bin=/data/logbin/qylog\nread_only=ON \nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\n\n#ä»èŠ‚ç‚¹å¯¼å‡ºå…¨éƒ¨æ•°æ®åº“çš„å¤‡ä»½ï¼ˆæ³¨æ„æ˜¯ä»èŠ‚ç‚¹ï¼‰\nmysqldump -uroot -p123456 -A -F -E -R --triggers --single-transaction \\\n--source-data=1 --flush-privileges --hex-blob --default-character-set=utf8 > all.sql\n\n#å°†å¤‡ä»½scpå¤åˆ¶åˆ°ä»èŠ‚ç‚¹\nscp -p all.sql 192.168.48.10:/root/\n\n#æ–°çš„ä»èŠ‚ç‚¹åˆ›å»ºä¼ è¾“ç”¨æˆ·å¹¶ä¸”æˆæƒ\nmysql -uroot -p123456 -e \"create user repluser@'192.168.48.%' identified by '123456';\"\nmysql -uroot -p123456 -e \"grant replication slave on *.* to repluser@'192.168.48.%';\"\n\n#æ–°çš„ä»èŠ‚ç‚¹vimè¿›å…¥all.sql\n#ç¼–è¾‘é‚£æ¡è¯­å¥ï¼Œè¿™æ—¶å€™è¿™é‡Œçš„masterå°±ä¸æ˜¯ä¸»èŠ‚ç‚¹è€Œæ˜¯æŒ‡å‘ä¸­é—´èŠ‚ç‚¹äº†\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.11', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000003', \nMASTER_LOG_POS=157; \n#ç„¶åä¿å­˜é€€å‡º\n\n\n#æ–°çš„ä»èŠ‚ç‚¹æ¥ä¸‹æ¥è¿›è¡Œè¿˜åŸ\nset sql_log_bin=0;\nsource all.sql;\nset sql_log_bin=1;\n\n#æ–°çš„ä»èŠ‚ç‚¹å¼€å¯slaveä¸»ä»å¤åˆ¶\nstart slave;\nshow slave status\\G;\n\n#æ¥ç€æˆ‘åœ¨ä¸»èŠ‚ç‚¹æ’å…¥æ•°æ®\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"qianyios2\",18,'M');\n#ä¹‹ååœ¨ä¸­é—´ä»èŠ‚ç‚¹çœ‹åˆ°äº†æ–°çš„æ•°æ®\n#åœ¨æœ€åçš„ä»èŠ‚ç‚¹ä¹Ÿçœ‹åˆ°äº†æ•°æ®\n```\n\n## ä¸»ä¸»å¤åˆ¶\n\nmasterï¼š192.168.48.128\n\nslave1ï¼š192.168.48.11ï¼ˆè®©ä»–å˜æˆmasterä¸»èŠ‚ç‚¹ï¼‰\n\nslave2ï¼š192.168.48.10\n\n`å®¹æ˜“äº§ç”Ÿçš„é—®é¢˜ï¼šæ•°æ®ä¸ä¸€è‡´ï¼›å› æ­¤æ…ç”¨`\n\né…ç½®æ­¥éª¤\n\n(1) å„èŠ‚ç‚¹ä½¿ç”¨ä¸€ä¸ªæƒŸä¸€server_id\n\n(2) éƒ½å¯åŠ¨binary logå’Œrelay log\n\n(3) åˆ›å»ºæ‹¥æœ‰å¤åˆ¶æƒé™çš„ç”¨æˆ·è´¦å·\n\n(4) å‡æŠŠå¯¹æ–¹æŒ‡å®šä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶å¯åŠ¨å¤åˆ¶çº¿ç¨‹\n\n![image-20250801013423555](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/8ff1515067c1f24ea0b8c8c1726fded6697559838.png)\n\nkeepalivedæä¾›vipåœ°å€ï¼Œå®ç°æ•°æ®åº“é›†ç¾¤é«˜å¯ç”¨ï¼Œè¿™ä¸ªç‚¹åé¢å†è¯´\n\nåŒä¸»çš„æ„æ€å°±æ˜¯ï¼Œè¿™ä¸¤ä¸ªèŠ‚ç‚¹äº’ä¸ºä¸»ä»ï¼Œå®ç°åŒå‘å¤åˆ¶ï¼Œæˆ‘æ˜¯ä¸»çš„æ—¶å€™ä½ æ˜¯ä»ï¼Œä½ æ˜¯ä¸»çš„æ—¶å€™æˆ‘æ˜¯ä»\n\n```bash\n#å°†slave1çš„/etc/my.cnfé‡Œçš„read onlyç›¸å…³å‚æ•°è¦åˆ æ‰ï¼Œæ—¢ç„¶éƒ½æ˜¯ä¸»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè‚¯å®šè¦å¯è¯»å¯å†™ï¼Œä¿ç•™å¦‚ä¸‹\n[mysqld]\nserver-id=11\nlog-bin=/data/logbin/qylog\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\n\n#ä¸»èŠ‚ç‚¹æ·»åŠ relay_logç›¸å…³å‚æ•°\n[mysqld]\nserver-id=128\nlog-bin=/data/logbin/qylog\nlog_slave_updates\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\n#ä¸»èŠ‚ç‚¹è¿˜è¦åˆ›å»º/data/relaylog\nmkdir -p /data/relaylog\nchown -R mysql:mysql /data/relaylog\nsystemctl restart mysqld\n\n#ç”±äºslave1çš„ä¸»ä»å¤åˆ¶è¿æ¥å·²ç»æŒ‡å‘äº†masterèŠ‚ç‚¹ï¼Œæˆ‘å°±ä¸æ”¹äº†ï¼Œï¼ˆè¿™æ˜¯ä¹‹å‰çš„ï¼‰\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.128', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000001', \nMASTER_LOG_POS=157,\nMASTER_DELAY=10; \n```\n\n```bash\n#ç°åœ¨æ¥ç€é…ç½®ä¸»èŠ‚ç‚¹çš„ä¸»ä»å¤åˆ¶è¿æ¥æŒ‡å‘ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹ï¼Œslave1\n#ä½ é¦–å…ˆè¦åœ¨ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹(slave1)æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®\n(root@localhost) [hellodb]> show master logs;\n+--------------+-----------+-----------+\n| Log_name     | File_size | Encrypted |\n+--------------+-----------+-----------+\n| qylog.000001 |      1405 | No        |\n| qylog.000002 |       200 | No        |\n| qylog.000003 |       180 | No        |\n| qylog.000004 |       488 | No        |\n| qylog.000005 |       180 | No        |\n| qylog.000006 |       465 | No        |\n+--------------+-----------+-----------+\n#è®°ä½qylog.000006 | 465 ï¼ˆçœ‹æœ€æ–°çš„å°±è¡Œäº†ï¼‰\n\n#åœ¨ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹è®¾ç½®å¤åˆ¶è¿æ¥ï¼ŒæŒ‡å‘ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.11', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000006', \nMASTER_LOG_POS=465,\nMASTER_DELAY=10;\nstart slave;\nshow slave status\\G;\n#è¿™æ—¶å€™ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹æ˜¾ç¤ºçš„æ˜¯åŒyes\n```\n\næµ‹è¯•ä¸¤ä¸ªèŠ‚ç‚¹å„è‡ªæ’å…¥æ–°æ•°æ®ï¼Œçœ‹çœ‹å¯¹æ–¹æœ‰æ²¡æœ‰å®ç°åŒå‘å¤åˆ¶\n\n```bash\n#ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"qi1\",18,'M');\n#ç¬¬äºŒä¸ªèŠ‚ç‚¹æŸ¥è¯¢\n(root@localhost) [hellodb]>  select * from teachers;\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n|   5 | XIAOHU        |  18 | M      |\n|   6 | qianyios      |  18 | M      |\n|   7 | qianyios1     |  18 | M      |\n|   8 | qianyios2     |  18 | M      |\n|   9 | qianyios3     |  18 | M      |\n|  10 | qi1           |  18 | M      |\n+-----+---------------+-----+--------+\n\n#ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"qi2\",18,'M');\n\n#å¥½å¥‡æ€ªï¼Œæˆ‘è¿™é‡Œå°±å‡ºé—®é¢˜äº†ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹å¤åˆ¶ä¸åˆ°ä¸»èŠ‚ç‚¹ä¸çŸ¥é“ä»€ä¹ˆé—®é¢˜\n#åæ¥æ‰çŸ¥é“æ˜¯è®¾ç½®äº†æ—¶é—´å»¶è¿Ÿ\n#ä½†èµ·å§‹ä¹Ÿä¸æ˜¯è¿™ä¸ªåŸå› ï¼Œä½ è¦å…³é—­å»¶è¿Ÿä¹Ÿæ²¡é—®é¢˜ï¼Œä¸»è¦åŸå› ï¼ˆå¯ä»¥åƒä¸‡æœ€åä¸€ä¸ªç« èŠ‚bugé›†é”¦ä¸­æŸ¥çœ‹ï¼‰\nSTOP SLAVE SQL_THREAD;\nCHANGE MASTER TO MASTER_DELAY = 0;\nSTART SLAVE SQL_THREAD;\nSHOW SLAVE STATUS\\G;\n#ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œä¸€ä¸‹\n#æŸ¥çœ‹ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æœ‰æ•°æ®\n(root@localhost) [hellodb]> select * from teachers;\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n|   9 | qi1           |  18 | M      |\n|  10 | qi2           |  18 | M      |\n+-----+---------------+-----+--------+\n6 rows in set (0.00 sec)\n```\n\n```bash\nå¦‚æœä½ ä¸¤ä¸ªèŠ‚ç‚¹éƒ½åŒæ—¶æ’å…¥æ•°æ®ï¼Œä¼šå‡ºç°ä¸€ä¸ªä¸»é”®çš„å†²çª\næ¯”å¦‚è¯´æ•™å¸ˆid\nä½ ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è¿™è¾¹æ·»åŠ äº†ä¸€ä¸ªæ–°æ•°æ®ï¼Œidè‡ªåŠ¨åˆ†é…ä¸º5\nä½†æ˜¯åˆæœ‰10ç§’çš„å»¶è¿Ÿï¼Œéƒ½è¿˜æ²¡åŒæ­¥è¿‡å»\nä½ åœ¨ç¬¬äºŒä¸ªèŠ‚ç‚¹åˆæ·»åŠ ä¸€ä¸ªæ–°æ•°æ®ï¼ŒIdè‡ªåŠ¨åˆ†é…ä¸º5ï¼Œ\né‚£è¿™æ ·å°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥ä¸¤ä¸ªæ•°æ®åº“æŠŠæ’å…¥çš„æ•°æ®è®°å¾—åˆ æ‰\n```\n\næ‰€ä»¥è¦è¿™æ ·é…ç½®\n\næ·»åŠ auto_increment_offsetå’Œauto_increment_increment\n\n```bash\n#slave1\n[mysqld]\nserver-id=11\nlog-bin=/data/logbin/qylog\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\nauto_increment_offset=2     #å¼€å§‹ç‚¹\nauto_increment_increment=2   #å¢é•¿å¹…åº¦ \n\n#ä¸»èŠ‚ç‚¹\n[mysqld]\nserver-id=128\nlog-bin=/data/logbin/qylog\nlog_slave_updates\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\nauto_increment_offset=1     #å¼€å§‹ç‚¹\nauto_increment_increment=2   #å¢é•¿å¹…åº¦\n```\n\nä¸¤ä¸ªèŠ‚ç‚¹é‡å¯æœåŠ¡\n\n```bash\nsystemctl restart mysqld\n```\n\nå†æ¬¡ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶æ’å…¥æ•°æ®\n\n```bash\n#ç¬¬ä¸€ä¸ªèŠ‚ç‚¹\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"qi111\",18,'M');\nselect * from teachers;\n......ï¼Œ#idè‡ªåŠ¨å¢é•¿ä¸º19\n|  17 | qi13          |  18 | M      |\n|  19 | qi111         |  18 | M      |\n\n#ç¬¬äºŒä¸ªèŠ‚ç‚¹\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"qi112\",18,'M');\nselect * from teachers;\n......ï¼Œ#idè‡ªåŠ¨å¢é•¿ä¸º17\n|  17 | qi13          |  18 | M      |\n|  18 | qi112         |  18 | M      |\n\n#å°±è¿™æ ·å°±ä¸ä¼šå¯¼è‡´ä¸»é”®çš„å†²çª\n\n#æœ€åç­‰å¾…10ç§’çš„å»¶è¿Ÿï¼Œæ•°æ®å°±ä¼šä¸€è‡´ï¼Œä¸¤ä¸ªèŠ‚ç‚¹éƒ½åŒæ­¥æˆåŠŸäº†\n(root@localhost) [hellodb]> select * from teachers;\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n......\n|  17 | qi13          |  18 | M      |\n|  18 | qi112         |  18 | M      |\n|  19 | qi111         |  18 | M      |\n+-----+---------------+-----+--------+\n13 rows in set (0.00 sec)\n```\n\n\n\n> çœ‹å‰é¢çš„æ¶æ„å›¾ï¼Œä¸¤ä¸»ä¸€ä»ï¼Œå…¶å®ç°åœ¨çš„çŠ¶å†µæ˜¯ï¼Œæ•°æ®ä»masterå†™å…¥åˆ°slaveå†åˆ°slave2çš„ï¼Œslave2æ˜¯æ²¡æœ‰è¿æ¥masterï¼Œæ‰€ä»¥åªèƒ½åæœŸå†™è„šæœ¬ï¼Œç›‘æµ‹keepalivedçš„vipå˜åŒ–ï¼Œä¸€æ—¦å˜åŒ–ï¼Œå°±å»ä¿®æ”¹é‚£ä¸ªä¸»ä»å¤åˆ¶è¿æ¥ä¸­çš„master ipå»å˜åŒ–ã€‚\n\n## åŠåŒæ­¥å¤åˆ¶\n\n![image-20250801134915055](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/f55e5a62ef5cce8a60a51931bacf7c24697559838.png)\n\n![image-20250801134926467](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/dac93171620ac4af1897bddc06e2b1de697559838.png)\n\nå®˜æ–¹æ–‡æ¡£\n\n```bash\nhttps://dev.mysql.com/doc/refman/8.0/en/replication-semisync.html\nhttps://dev.mysql.com/doc/refman/5.7/en/replication-semisync.html\nhttps://mariadb.com/kb/en/library/semisynchronous-replication/\n```\n\nç»è¿‡å‰ä¸¤ä¸ªå›¾çš„ç†è§£ï¼Œç°åœ¨å°±å¼€å§‹å®æ“\n\n```bash\n#æ¥ç€ä¸Šé¢ä¸€ä¸ªä¸»ä¸»çš„æ¡ˆä¾‹ä¸‹æ¥ï¼Œå¦‚æœä¸æ˜¯ï¼Œä½ åªéœ€è¦ä¿ç•™/etc/my.cnfæœ‰å¦‚ä¸‹é€‰é¡¹å³å¯\n#master\n[mysqld]\nserver-id=128\nlog-bin=/data/logbin/qylog\nrpl_semi_sync_master_enabled=ON   #æ·»åŠ æ­¤è¡Œ,éœ€è¦å…ˆå®‰è£…semisync_master.soæ’ä»¶å,å†é‡å¯é…ç½®æ–‡ä»¶,å¦åˆ™æ— æ³•å¯åŠ¨\nrpl_semi_sync_master_timeout=10000  #è®¾ç½®10så†…æ— æ³•åŒæ­¥ï¼Œä¹Ÿå°†è¿”å›æˆåŠŸä¿¡æ¯ç»™å®¢æˆ·ç«¯\n\n#slave1\nserver-id=11\nlog-bin=/data/logbin/qylog\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\nrpl_semi_sync_slave_enabled=ON #ä¿®æ”¹æ­¤è¡Œ,éœ€è¦å…ˆå®‰è£…semisync_slave.soæ’ä»¶å,å†é‡å¯,å¦åˆ™æ— æ³•å¯åŠ¨\n\n#slave1\nserver-id=10\nlog-bin=/data/logbin/qylog\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\nrpl_semi_sync_slave_enabled=ON #ä¿®æ”¹æ­¤è¡Œ,éœ€è¦å…ˆå®‰è£…semisync_slave.soæ’ä»¶å,å†é‡å¯,å¦åˆ™æ— æ³•å¯åŠ¨\n\n#æ³¨æ„å…ˆåˆ«é‚£ä¹ˆå¿«é‡å¯mysqlï¼ï¼è¦å®‰è£…åŠåŒæ­¥å¤åˆ¶æ’ä»¶\n#master(æ°¸ä¹…å®‰è£…)ï¼Œå¦‚æœæƒ³è¦ä¸´æ—¶çš„ç›´æ¥è®¾ç½®å…¨å±€å˜é‡å³å¯\nmysql -uroot -p123456 -e \"INSTALL PLUGIN rpl_semi_sync_master SONAME 'semisync_master.so';\"\nsystemctl restart mysql\n\n\n#slave1\nmysql -uroot -p123456 -e \"INSTALL PLUGIN rpl_semi_sync_slave SONAME 'semisync_slave.so';\"\nsystemctl restart mysql\n\n#slave2\nmysql -uroot -p123456 -e \"INSTALL PLUGIN rpl_semi_sync_slave SONAME 'semisync_slave.so';\"\nsystemctl restart mysql\n\n```\n\n```bash\n#ä¸‰ä¸ªèŠ‚ç‚¹çš„å¤åˆ¶å…³ç³»éƒ½è¦åˆ æ‰\nmysql -uroot -p123456\nstop slave;\nreset slave all;\n#ä¸‰ä¸ªèŠ‚ç‚¹é‡ç½®äºŒè¿›åˆ¶æ—¥å¿—\nreset master;\n```\n\nmasterå¯¼å‡ºå…¨éƒ¨å¤‡ä»½ç»™slave1å’Œslave2ï¼Œåˆ›å»ºå¤åˆ¶è´¦å·ï¼Œå…³é—­äºŒè¿›åˆ¶æ—¥å¿—è®°å½•\nè¿˜åŸæ•°æ®åº“ï¼Œå¼€å¯äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ï¼Œè‡ªè¡ŒéªŒè¯æ˜¯å¦åŒæ­¥ï¼Œè¿™é‡Œå°±ç•¥è¿‡äº†\nï¼ˆæ³¨æ„æ˜¯ä¸€ä¸»äºŒä»ï¼‰ç›¸å½“äºé‡æ–°å¼€å§‹äº†\n\nåŠåŒæ­¥å¤åˆ¶çš„ä¸€äº›å‚æ•°\n\n```bash\n#masterèŠ‚ç‚¹\n\n(root@localhost) [hellodb]> SHOW GLOBAL VARIABLES LIKE '%semi%';\n+-------------------------------------------+------------+\n| Variable_name                             | Value      |\n+-------------------------------------------+------------+\n| rpl_semi_sync_master_enabled             | ON         |\n| rpl_semi_sync_master_timeout             | 10000      |\n| rpl_semi_sync_master_trace_level          | 32         |\n| rpl_semi_sync_master_wait_for_slave_count | 1          |\n| rpl_semi_sync_master_wait_no_slave        | ON         |\n| rpl_semi_sync_master_wait_point           | AFTER_SYNC |\n+-------------------------------------------+------------+\n\n```\n\n- **`rpl_semi_sync_master_enabled`**ï¼šæ˜¯å¦å¯ç”¨åŠåŒæ­¥å¤åˆ¶åŠŸèƒ½ã€‚`ON` è¡¨ç¤ºå¯ç”¨ï¼Œ`OFF` è¡¨ç¤ºç¦ç”¨ã€‚\n- **`rpl_semi_sync_master_timeout`**ï¼šä¸»åº“ç­‰å¾…ä»åº“å“åº”çš„è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ã€‚è¶…æ—¶åä¸»åº“ä¼šåˆ‡æ¢ä¸ºå¼‚æ­¥å¤åˆ¶ã€‚\n- **`rpl_semi_sync_master_trace_level`**ï¼šæ—¥å¿—è®°å½•çš„è¯¦ç»†ç¨‹åº¦ï¼Œæ•°å€¼è¶Šå¤§è®°å½•è¶Šè¯¦ç»†ã€‚\n- **`rpl_semi_sync_master_wait_for_slave_count`**ï¼šä¸»åº“æäº¤äº‹åŠ¡æ—¶éœ€è¦ç­‰å¾…çš„ä»åº“æ•°é‡ã€‚\n- **`rpl_semi_sync_master_wait_no_slave`**ï¼šå½“æ²¡æœ‰ä»åº“è¿æ¥æ—¶ï¼Œä¸»åº“æ˜¯å¦ç»§ç»­ä½¿ç”¨åŠåŒæ­¥å¤åˆ¶ã€‚`ON` è¡¨ç¤ºç»§ç»­ç­‰å¾…ï¼Œ`OFF` è¡¨ç¤ºåˆ‡æ¢ä¸ºå¼‚æ­¥å¤åˆ¶ã€‚\n- **`rpl_semi_sync_master_wait_point`**ï¼šåŠåŒæ­¥å¤åˆ¶çš„ç­‰å¾…ç‚¹ã€‚`AFTER_SYNC` è¡¨ç¤ºåœ¨åŒæ­¥å®Œæˆåç­‰å¾…ï¼Œ`AFTER_FLUSH` è¡¨ç¤ºåœ¨æ•°æ®åˆ·æ–°åˆ°ç£ç›˜åç­‰å¾…ã€‚\n\n```bash\n#master\n(root@localhost) [hellodb]> SHOW GLOBAL STATUS LIKE '%semi%';\n+--------------------------------------------+-------+\n| Variable_name                              | Value |\n+--------------------------------------------+-------+\n| Rpl_semi_sync_master_clients               | 2     | #æˆåŠŸçš„æœ‰ä¸¤ä¸ª\n| Rpl_semi_sync_master_net_avg_wait_time     | 0     |\n| Rpl_semi_sync_master_net_wait_time         | 0     |\n| Rpl_semi_sync_master_net_waits             | 2     |\n| Rpl_semi_sync_master_no_times              | 0     |\n| Rpl_semi_sync_master_no_tx                 | 0     |\n| Rpl_semi_sync_master_status                | ON    |\n| Rpl_semi_sync_master_timefunc_failures     | 0     |\n| Rpl_semi_sync_master_tx_avg_wait_time      | 674   |\n| Rpl_semi_sync_master_tx_wait_time          | 674   |\n| Rpl_semi_sync_master_tx_waits              | 1     |\n| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |\n| Rpl_semi_sync_master_wait_sessions         | 0     |\n| Rpl_semi_sync_master_yes_tx                | 1     |\n+--------------------------------------------+-------+\n```\n\n**`Rpl_semi_sync_master_clients`**ï¼šå½“å‰è¿æ¥åˆ°ä¸»åº“å¹¶æ”¯æŒåŠåŒæ­¥å¤åˆ¶çš„ä»åº“æ•°é‡ã€‚\n\n**`Rpl_semi_sync_master_net_avg_wait_time`**ï¼šåŠåŒæ­¥å¤åˆ¶ä¸­ç½‘ç»œå¹³å‡ç­‰å¾…æ—¶é—´ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ã€‚\n\n**`Rpl_semi_sync_master_net_wait_time`**ï¼šåŠåŒæ­¥å¤åˆ¶ä¸­ç½‘ç»œæ€»ç­‰å¾…æ—¶é—´ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ã€‚\n\n**`Rpl_semi_sync_master_net_waits`**ï¼šåŠåŒæ­¥å¤åˆ¶ä¸­ç½‘ç»œç­‰å¾…çš„æ€»æ¬¡æ•°ã€‚\n\n**`Rpl_semi_sync_master_no_times`**ï¼šåŠåŒæ­¥å¤åˆ¶æœªæˆåŠŸï¼ˆåˆ‡æ¢ä¸ºå¼‚æ­¥å¤åˆ¶ï¼‰çš„æ¬¡æ•°ã€‚\n\n**`Rpl_semi_sync_master_no_tx`**ï¼šåŠåŒæ­¥å¤åˆ¶æœªæˆåŠŸæ—¶çš„äº‹åŠ¡æ•°é‡ã€‚\n\n**`Rpl_semi_sync_master_status`**ï¼šå½“å‰åŠåŒæ­¥å¤åˆ¶çš„çŠ¶æ€ï¼Œ`ON` è¡¨ç¤ºå¯ç”¨ï¼Œ`OFF` è¡¨ç¤ºç¦ç”¨ã€‚\n\n**`Rpl_semi_sync_master_timefunc_failures`**ï¼šåŠåŒæ­¥å¤åˆ¶ä¸­æ—¶é—´å‡½æ•°å¤±è´¥çš„æ¬¡æ•°ã€‚\n\n**`Rpl_semi_sync_master_tx_avg_wait_time`**ï¼šäº‹åŠ¡å¹³å‡ç­‰å¾…æ—¶é—´ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ã€‚\n\n**`Rpl_semi_sync_master_tx_wait_time`**ï¼šäº‹åŠ¡æ€»ç­‰å¾…æ—¶é—´ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ã€‚\n\n**`Rpl_semi_sync_master_tx_waits`**ï¼šäº‹åŠ¡ç­‰å¾…çš„æ€»æ¬¡æ•°ã€‚\n\n\n\n**æ¥ä¸‹æ¥è¿›è¡Œæµ‹è¯•**\n\n1.æµ‹è¯•éƒ½å¯åŠ¨çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸»äºŒä»ï¼Œæ˜¯å¦æ­£å¸¸çš„ä¸»ä»åŒæ­¥\n\n```bash\n#ä¸»èŠ‚ç‚¹\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"oooo1\",18,'M');\nuse hellodb;select * from teachers;\n#ä»èŠ‚ç‚¹\nuse hellodb;select * from teachers;\n\n#ç»æµ‹è¯•åŒæ­¥æˆåŠŸ\n(root@localhost) [hellodb]> use hellodb;select * from teachers;\nDatabase changed\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n......\n|  21 | qy2           |  56 | F      |\n|  22 | oooo1         |  18 | M      |\n+-----+---------------+-----+--------+\n15 rows in set (0.00 sec)\n```\n\n2.æ¥ä¸‹æ¥æµ‹è¯•ï¼Œslaveå…³é—­mysqlæ¨¡æ‹Ÿå®•æœºçš„æ“ä½œï¼Œå†æ¬¡è¿›è¡Œæ’å…¥æ•°æ®\n\n```bash\n#slave2\nsystemctl stop mysqld\n\n#ä¸»èŠ‚ç‚¹\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"oooo1\",18,'M');\nuse hellodb;select * from teachers;\n#slave1\nuse hellodb;select * from teachers;\n#slave1æˆåŠŸåŒæ­¥æ•°æ®\n(root@localhost) [hellodb]> use hellodb;select * from teachers;\nDatabase changed\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n|   2 | Zhang Sanfeng |  94 | M      |\n|   3 | Miejue Shitai |  77 | F      |\n|   4 | Lin Chaoying  |  93 | F      |\n|   9 | qi1           |  18 | M      |\n|  10 | qi2           |  18 | M      |\n|  11 | qi3           |  18 | M      |\n|  12 | qi4           |  18 | M      |\n|  13 | qi19          |  18 | M      |\n|  14 | qi20          |  18 | M      |\n|  17 | qi13          |  18 | M      |\n|  18 | qi112         |  18 | M      |\n|  19 | qi111         |  18 | M      |\n|  21 | qy2           |  56 | F      |\n|  22 | oooo1         |  18 | M      |\n|  23 | oooo1         |  18 | M      |\n+-----+---------------+-----+--------+\n16 rows in set (0.00 sec)\n\n```\n\n3.æ¥ä¸‹æ¥ï¼Œè®©æœ€åä¸€ä¸ªslave1ä¹Ÿå®•æœºçœ‹çœ‹æ˜¯ä»€ä¹ˆæƒ…å†µ\n\n```bash\n#slave1\nsystemctl stop mysqld\n\n#ä¸»èŠ‚ç‚¹\nuse hellodb;\ninsert into teachers (name,age,gender)values(\"oooo2\",18,'M');\nuse hellodb;select * from teachers;\n\n#æƒ…å†µå¦‚ä¸‹ï¼Œé»˜è®¤ç­‰å¾…10s\n(root@localhost) [hellodb]> insert into teachers (name,age,gender)values(\"oooo2\",18,'M');\nQuery OK, 1 row affected (10.01 sec)\n\n#æ­¤æ—¶å·²ç»æ²¡æœ‰slaveèŠ‚ç‚¹è¿æ¥æ•°äº†\n(root@localhost) [hellodb]> SHOW GLOBAL STATUS LIKE '%semi%';\n+--------------------------------------------+----------+\n| Variable_name                              | Value    |\n+--------------------------------------------+----------+\n| Rpl_semi_sync_master_clients               | 0        |\n#åœ¨æ’å…¥ä¸€æ¬¡æ•°æ®ï¼Œè¿™é‡Œå°±æ²¡æœ‰ç­‰å¾…äº†\n(root@localhost) [hellodb]> insert into teachers (name,age,gender)values(\"oooo3\",18,'M');\nQuery OK, 1 row affected (0.05 sec)\n\n```\n\n- ç¬¬ä¸€æ¬¡æ’å…¥æ“ä½œç­‰å¾… 10 ç§’ï¼Œæ˜¯å› ä¸ºä¸»èŠ‚ç‚¹åœ¨åŠåŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹ç­‰å¾…ä»èŠ‚ç‚¹ç¡®è®¤ï¼Œä½†è¶…æ—¶äº†ã€‚\n- ç¬¬äºŒæ¬¡æ’å…¥æ“ä½œæ²¡æœ‰ç­‰å¾…ï¼Œæ˜¯å› ä¸ºä¸»èŠ‚ç‚¹å·²ç»æ£€æµ‹åˆ°æ²¡æœ‰ä»èŠ‚ç‚¹è¿æ¥ï¼Œç›´æ¥ä»¥å¼‚æ­¥å¤åˆ¶æ¨¡å¼æ‰§è¡Œã€‚\n\n\n\n4.æ¢å¤æ‰€æœ‰çš„slaveèŠ‚ç‚¹ï¼Œçœ‹çœ‹æœ‰æ— åŒæ­¥\n\n```bash\n#slave1å’Œslave2\nsystemctl start mysqld\n\n#ä¸»èŠ‚ç‚¹çš„æ•°æ®\n(root@localhost) [hellodb]> use hellodb;select * from teachers;\nDatabase changed\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n......\n|  22 | oooo1         |  18 | M      |\n|  23 | oooo1         |  18 | M      |\n|  24 | oooo1         |  18 | M      |\n|  32 | oooo2         |  18 | M      |\n|  33 | oooo3         |  18 | M      |\n+-----+---------------+-----+--------+\n19 rows in set (0.00 sec)\n\n#slave1å’Œslave2çš„æ•°æ®æˆåŠŸåŒæ­¥\n(root@localhost) [hellodb]> use hellodb;select * from teachers;\nDatabase changed\n+-----+---------------+-----+--------+\n| TID | Name          | Age | Gender |\n+-----+---------------+-----+--------+\n|   1 | Song Jiang    |  45 | M      |\n......\n|  22 | oooo1         |  18 | M      |\n|  23 | oooo1         |  18 | M      |\n|  24 | oooo1         |  18 | M      |\n|  32 | oooo2         |  18 | M      |\n|  33 | oooo3         |  18 | M      |\n+-----+---------------+-----+--------+\n19 rows in set (0.00 sec)\n\n```\n\nè‡³æ­¤åŠåŒæ­¥å¤åˆ¶æˆåŠŸ\n\n## å¤åˆ¶è¿‡æ»¤å™¨\n\nè®©ä»èŠ‚ç‚¹ä»…å¤åˆ¶æŒ‡å®šçš„æ•°æ®åº“ï¼Œæˆ–æŒ‡å®šæ•°æ®åº“çš„æŒ‡å®šè¡¨\n\n**å¤åˆ¶è¿‡æ»¤å™¨ä¸¤ç§å®ç°æ–¹å¼ï¼š**\n\n(1) æœåŠ¡å™¨é€‰é¡¹ï¼šä¸»æœåŠ¡å™¨ä»…å‘äºŒè¿›åˆ¶æ—¥å¿—ä¸­è®°å½•ä¸ç‰¹å®šæ•°æ®åº“ç›¸å…³çš„äº‹ä»¶\n\nç¼ºç‚¹ï¼šåŸºäºäºŒè¿›åˆ¶è¿˜åŸå°†æ— æ³•å®ç°ï¼›ä¸å»ºè®®ä½¿ç”¨\n\nä¼˜ç‚¹: åªéœ€è¦åœ¨ä¸»èŠ‚ç‚¹é…ç½®ä¸€æ¬¡å³å¯\n\n![image-20250801161612462](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/f99ecf97fca20046fea77990157d38b7697559838.png)\n\n> åªéœ€è¦åœ¨ä¸»æœåŠ¡å™¨é…ç½®ï¼Œå¦‚æœæˆ‘ä¸æƒ³åŒæ­¥è®ºå›ï¼Œåªæƒ³åŒæ­¥å…¶ä»–çš„ï¼Œåªéœ€è¦ç¦ç”¨è®ºå›çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå°±è¡Œäº†ï¼Œä½†æ˜¯è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä½ è®ºå›çš„äºŒè¿›åˆ¶æ—¥å¿—éƒ½ç¦ç”¨äº†ï¼Œé‚£ä½ è¿™ä¸ªè®ºå›çš„è¿™ä¸ªæ•°æ®åº“çªç„¶å‡ºç°é—®é¢˜äº†ï¼Œæ•°æ®æ€ä¹ˆåŠï¼Ÿè¿™å°±æ˜¯ç¼ºç‚¹\n\nè¿™ä¸ªç¦ç”¨äºŒè¿›åˆ¶ï¼Œä¸ç”¨ç¦ç”¨log_biné€‰é¡¹ï¼Œçœ‹ä¸‹é¢çš„æ¥é…ç½®é»‘ç™½åå•å°±è¡Œ\n\næ³¨æ„ï¼šæ­¤é¡¹å’Œ binlog_formatç›¸å…³\n\nå‚çœ‹ï¼šhttps://mariadb.com/kb/en/library/mysqld-options/#-binlog-ignore-db\n\n```bash\n#åªåŒæ­¥db1å’Œdb2ï¼Œä¹Ÿå°±æ˜¯åªæœ‰è¿™ä¸¤ä¸ªä¼šå¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå…¶ä»–æ•°æ®åº“ä¸ä¼š\n#ï¼ˆç™½åå•å’Œé»‘åå•å¿…é¡»äºŒé€‰ä¸€)\n#é»˜è®¤å°±æ˜¯ç™½åå•)\nvim /etc/my.cnf\n#ç™½åå•\nbinlog-do-db=db1 #æ•°æ®åº“ç™½åå•åˆ—è¡¨ï¼Œä¸æ”¯æŒåŒæ—¶æŒ‡å®šå¤šä¸ªå€¼ï¼Œå¦‚æœæƒ³å®ç°å¤šä¸ªæ•°æ®åº“éœ€å¤šè¡Œå®ç°\nbinlog-do-db=db2 \n#ä¹Ÿå¯ä»¥è®¾ç½®é»‘åå•\nbinlog-ignore-db=db3 #æ•°æ®åº“é»‘åå•åˆ—è¡¨\n```\n\næ³¨æ„ï¼š\n\n```bash\nThis option will not work with cross-database updates with statement-based  logging. See the Statement-Based Logging section for more information.\nThis option can not be set dynamically.\nWhen setting it on the command-line or in a server option group in an option  file, the option does not accept a comma-separated list. If you would like to  specify multiple filters, then you need to specify the option multiple times.\n#æ­¤é€‰é¡¹ä¸é€‚ç”¨äºä½¿ç”¨åŸºäºè¯­å¥çš„æ—¥å¿—è®°å½•çš„è·¨æ•°æ®åº“æ›´æ–°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…åŸºäºè¯­å¥çš„æ—¥å¿—è®°å½•éƒ¨åˆ†ã€‚\n#æ­¤é€‰é¡¹ä¸èƒ½åŠ¨æ€è®¾ç½®ã€‚\n#åœ¨å‘½ä»¤è¡Œæˆ–é€‰é¡¹æ–‡ä»¶ä¸­çš„æœåŠ¡å™¨é€‰é¡¹ç»„ä¸­è®¾ç½®è¯¥é€‰é¡¹æ—¶ï¼Œè¯¥é€‰é¡¹ä¸æ¥å—é€—å·åˆ†éš”çš„åˆ—è¡¨ã€‚å¦‚æœå¸Œæœ›æŒ‡å®šå¤šä¸ªè¿‡æ»¤å™¨ï¼Œåˆ™éœ€è¦å¤šæ¬¡æŒ‡å®šè¯¥é€‰é¡¹ã€‚\n```\n\næ¥æµ‹è¯•å§\n\n```bash\n#master\n#é…ç½®æ–‡ä»¶åªéœ€è¦ä¿ç•™å¦‚ä¸‹é€‰é¡¹\nvim /etc/my.cnf\n[mysqld]\nserver-id=128\nlog-bin=/data/logbin/qylog\nbinlog-do-db=db1\nbinlog-do-db=db2 \nbinlog-ignore-db=db3\n\n#slave1å’Œslave2è®°å¾—åˆ é™¤åŠåŒæ­¥çš„é€‰é¡¹ï¼Œæœ€åæ‰€æœ‰æœåŠ¡å™¨é‡å¯mysql\nsystemctl restart mysqld\n\n#ä¸»èŠ‚ç‚¹åˆ›å»ºæµ‹è¯•çš„æ•°æ®åº“\nmysql -u root -p123456 -e\"create database db1;\"\nmysql -u root -p123456 -e\"create database db2;\"\nmysql -u root -p123456 -e\"create database db3;\"\n#db1å’Œdb2æ’å…¥æ•°æ®\nmysql -u root -p123456 -e\"USE db1;CREATE TABLE test ( id INT);INSERT INTO test (id) VALUES (1);SELECT * FROM test;\"\nmysql -u root -p123456 -e\"USE db2;CREATE TABLE test ( id INT);INSERT INTO test (id) VALUES (1);SELECT * FROM test;\"\n#æŸ¥çœ‹æ•°æ®åº“\nmysql -u root -p123456 -e\"show databases;\"\n+--------------------+\n| Database           |\n+--------------------+\n| db1                |\n| db2                |\n| db3                |\n| hellodb            |\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n\n#è¿™æ—¶å€™å…¶ä»–ä»èŠ‚ç‚¹å¯ä»¥æŸ¥çœ‹æ˜¯å¦æœ‰è¿™ä¸ªdb1å’Œdb2æ•°æ®åº“\nmysql -u root -p123456 -e\"show databases;\"\nmysql -u root -p123456 -e\"USE db1;SELECT * FROM test;\"\nmysql -u root -p123456 -e\"USE db2;SELECT * FROM test;\"\n\n#åŒæ­¥æˆåŠŸï¼Œslave1å’Œslave2éƒ½ä¸€æ ·ï¼Œéƒ½æˆåŠŸåŒæ­¥äº†ç™½åå•çš„æ•°æ®åº“ï¼Œé»‘åå•çš„æ•°æ®åº“å°±æ²¡åŒæ­¥\n[root@slave1 ~]# mysql -u root -p123456 -e\"show databases;\"\n+--------------------+\n| Database           |\n+--------------------+\n| db1                |\n| db2                |\n| hellodb            |\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n[root@slave1 ~]# mysql -u root -p123456 -e\"USE db1;SELECT * FROM test;\"\n+------+\n| id   |\n+------+\n|    1 |\n+------+\n[root@slave1 ~]# mysql -u root -p123456 -e\"USE db2;SELECT * FROM test;\"\n+------+\n| id   |\n+------+\n|    1 |\n+------+\n[root@slave ~]#\n\n```\n\n\n\n(2) ä»æœåŠ¡å™¨SQL_THREADåœ¨relay logä¸­çš„äº‹ä»¶æ—¶ï¼Œä»…è¯»å–ä¸ç‰¹å®šæ•°æ®åº“(ç‰¹å®šè¡¨)ç›¸å…³çš„äº‹ä»¶å¹¶åº”ç”¨äºæœ¬åœ°\n\nç¼ºç‚¹ï¼šä¼šé€ æˆç½‘ç»œåŠç£ç›˜IOæµªè´¹,åœ¨æ‰€æœ‰ä»èŠ‚ç‚¹éƒ½è¦é…ç½®\n\nä¼˜ç‚¹: ä¸å½±å“äºŒè¿›åˆ¶å¤‡ä»½è¿˜åŸ\n\nä»æœåŠ¡å™¨ä¸Šçš„å¤åˆ¶è¿‡æ»¤å™¨ç›¸å…³å˜é‡\n\n`ç™½åå•å’Œé»‘åå•äºŒé€‰ä¸€`ï¼Œ`å¤åˆ¶åº“å’Œå¤åˆ¶è¡¨ï¼Œä»¥åŠé€šé…ç¬¦ç±»å‹ä¸‰é€‰ä¸€ï¼ˆç™½åå•å’Œé»‘åå•äºŒé€‰ä¸€ï¼‰`ï¼Œä¸ç„¶ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ\n\n```bash\nreplicate_do_db=db1 #æŒ‡å®šå¤åˆ¶åº“çš„ç™½åå•ï¼Œé€‰é¡¹ä¸æ”¯æŒå¤šå€¼,åªèƒ½åˆ†åˆ«å†™å¤šè¡Œå®ç°\nreplicate_do_db=db2 #æŒ‡å®šå¤åˆ¶åº“çš„ç™½åå•ï¼Œé€‰é¡¹ä¸æ”¯æŒå¤šå€¼,åªèƒ½åˆ†åˆ«å†™å¤šè¡Œå®ç°\nreplicate_ignore_db=db4  #æŒ‡å®šå¤åˆ¶åº“é»‘åå•\nreplicate_do_table=db1.test #æŒ‡å®šå¤åˆ¶æ•°æ®åº“ä¸­çš„è¡¨çš„ç™½åå•\nreplicate_ignore_table=db2.test #æŒ‡å®šå¤åˆ¶æ•°æ®åº“ä¸­è¡¨çš„é»‘åå•\nreplicate_wild_do_table= foo%.bar% #æ”¯æŒé€šé…ç¬¦ åªå¤åˆ¶æ•°æ®åº“åä»¥ foo å¼€å¤´ï¼Œè¡¨åä»¥ bar å¼€å¤´çš„è¡¨\nreplicate_wild_ignore_table=db1.tbl_% #å¿½ç•¥ db1 æ•°æ®åº“ä¸­æ‰€æœ‰ä»¥ tbl_ å¼€å¤´çš„è¡¨çš„å¤åˆ¶\n```\n\n![image-20250801164314565](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/2cdd518f7c2d07c53342701bd8276b80697559838.png)\n\n\n\n```bash\n#åˆ é™¤masterçš„ç¬¬ä¸€æ­¥çš„é…ç½®ï¼Œä¿ç•™å¦‚ä¸‹\n[mysqld]\nserver-id=128\nlog-bin=/data/logbin/qylog\n\n#ç„¶åé‡å¯\nsystemctl restart mysqld\n```\n\nåœ¨æ‰€æœ‰çš„ä»èŠ‚ç‚¹ï¼Œæ³¨æ„æ˜¯æ‰€æœ‰çš„ä»èŠ‚ç‚¹\n\n```bash\n[mysqld]\nreplicate_do_db=db2 \nreplicate_do_db=db1\n\n#è¿™æ¬¡æˆ‘ä¸åŠ é»‘åå•ï¼Œæˆ‘çœ‹ä¼šä¸ä¼šåŒæ­¥db3\n#ç„¶åé‡å¯\nsystemctl restart mysqld\n```\n\nmasteråˆ›å»ºæµ‹è¯•æ•°æ®\n\n```bash\nmysql -u root -p123456\n#db1åˆ›å»ºtes1è¡¨ï¼Œä»¥åŠåœ¨åŸæ¥çš„testè¡¨æ’å…¥æ–°æ•°æ®\nUSE db1;CREATE TABLE test1 ( id INT);INSERT INTO test1 (id) VALUES (1);SELECT * FROM test1;\nUSE db1;INSERT INTO test (id) VALUES (2);SELECT * FROM test;\n\n#åœ¨db2åŸæ¥çš„testæ’å…¥æ–°æ•°æ®ï¼Œä¸”åˆ›å»ºæ–°è¡¨\nUSE db2;CREATE TABLE test1 ( id INT);INSERT INTO test1 (id) VALUES (1);SELECT * FROM test1;\nUSE db2;INSERT INTO test (id) VALUES (2);SELECT * FROM test;\n#åœ¨db3åˆ›å»ºæ–°è¡¨\nUSE db3;CREATE TABLE test ( id INT);INSERT INTO test (id) VALUES (1);SELECT * FROM test;\nUSE db3;INSERT INTO test (id) VALUES (2);SELECT * FROM test;\n```\n\nslaveæŸ¥çœ‹ä»èŠ‚ç‚¹\n\n```bash\nUSE db1;SELECT * FROM test1;\nUSE db1;SELECT * FROM test;\nUSE db2;SELECT * FROM test1;\nUSE db2;SELECT * FROM test;\nuse db3;\n\n\n#éƒ½æ˜¯å¯ä»¥æˆåŠŸåŒæ­¥æ•°æ®ï¼Œåªæœ‰db3æ˜¯æ²¡æœ‰åŒæ­¥è¿‡æ¥çš„\n(root@localhost) [(none)]> USE db1;SELECT * FROM test1;\n+------+\n| id   |\n+------+\n|    1 |\n+------+\n1 row in set (0.00 sec)\n\n(root@localhost) [db1]> USE db1;SELECT * FROM test;\n+------+\n| id   |\n+------+\n|    1 |\n|    2 |\n+------+\n2 rows in set (0.00 sec)\n\n(root@localhost) [db1]> USE db2;SELECT * FROM test1;\n+------+\n| id   |\n+------+\n|    1 |\n+------+\n1 row in set (0.00 sec)\n\n(root@localhost) [db2]> USE db2;SELECT * FROM test;\n+------+\n| id   |\n+------+\n|    1 |\n|    2 |\n+------+\n2 rows in set (0.00 sec)\n(root@localhost) [db2]> use db3;\nERROR 1049 (42000): Unknown database 'db3'\n```\n\n## GTIDå¤åˆ¶\n\nå…¨å±€å¤åˆ¶Id\n\nèƒŒæ™¯\n\n![image-20250801194126280](../img/Mysqlä¸»ä»å¤åˆ¶æ¡ˆä¾‹.assets/499d8ec33768d330b3ae08f74371cdb2697559838.png)\n\nğŸ’¥ ä¼ ç»Ÿå¤åˆ¶æœºåˆ¶çš„é—®é¢˜ï¼ˆåŸºäº binlog ä½ç½®ç‚¹ï¼‰\n\n1. å¤šä¸ªå®¢æˆ·ç«¯ï¼ˆå¦‚å›¾ä¸­ï¼‰åˆ†åˆ«å‘èµ·äº‹åŠ¡ 1001ã€1002ã€1003ï¼Œä¸»åº“ä¾æ¬¡æ‰§è¡Œï¼Œå†™å…¥ binlogã€‚\n2. ä¸»åº“é€šè¿‡`åªæœ‰ä¸€ä¸ª`çš„ dump çº¿ç¨‹æŠŠ binlog å‘é€ç»™ä»åº“ã€‚\n3. ä»åº“é€šè¿‡ IO çº¿ç¨‹è¯»å– binlogï¼Œé€šè¿‡ SQL çº¿ç¨‹ **ä¸€ä¸ªä¸€ä¸ªä¸²è¡Œæ‰§è¡Œäº‹åŠ¡**ã€‚\n\nâ—é—®é¢˜æ¥äº†ï¼š\n\n- ä»åº“è‡ªèº«ä¹Ÿæœ‰å®¢æˆ·ç«¯è®¿é—®ï¼Œå¯èƒ½ä¹Ÿä¼šäº§ç”Ÿäº‹åŠ¡ï¼Œç¼–å·ä¹Ÿå¯èƒ½æ˜¯ 1001ã€1002ã€1003ï¼ˆç¼–å·åªæ˜¯åº”ç”¨å†…éƒ¨çš„ä¸šåŠ¡ç¼–å·ï¼Œä¸æ˜¯æ•°æ®åº“å”¯ä¸€æ ‡è¯†ï¼‰ã€‚\n- ä¸»åº“ä¼ è¿‡æ¥çš„ binlogï¼Œåªè®°å½•äº†æ“ä½œå†…å®¹ã€è¡¨åã€æ•°æ®æ”¹åŠ¨ï¼Œä½†**æ²¡æœ‰å…¨å±€å”¯ä¸€äº‹åŠ¡ ID**ã€‚\n- æ‰€ä»¥ä»åº“æ ¹æœ¬**åˆ†ä¸æ¸…ï¼šè¿™ä¸ª 1001 æ˜¯ä¸»åº“çš„ï¼Ÿè¿˜æ˜¯æˆ‘è‡ªå·±äº§ç”Ÿçš„ï¼Ÿ**\n- ä¸ºäº†é¿å…æ•°æ®å†²çªã€ä¿è¯é¡ºåºä¸€è‡´ï¼Œä»åº“**åªèƒ½ä¸²è¡Œåœ°ç…§ç€ binlog æ‰§è¡Œäº‹åŠ¡**ï¼Œè€Œä¸èƒ½ä¹±åºæ‰§è¡Œæˆ–å¹¶å‘æ‰§è¡Œã€‚\n\n> æ­£æ˜¯å› ä¸ºåˆ†ä¸æ¸…ï¼Œæ€•åŒæ–¹çš„äº‹åŠ¡ä¹±åºæ‰§è¡Œï¼Œæ‰€ä»¥æ‰ä¼šé€‰æ‹©ä¸²è¡Œæ‰§è¡Œï¼Œç¡®ä¿å®‰å…¨\n>\n> è€Œä¸”å¦‚æœä¸€ä¸ªäº‹åŠ¡ç‰¹åˆ«ç‰¹åˆ«æ…¢ï¼Œä»–ä¼šæ‹–ç´¯æ•´ä¸ªä¸²è¡Œæ‰§è¡Œçš„è¿›åº¦ï¼Œæ•ˆç‡æ…¢\n\n**GTIDï¼ˆå…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦ï¼‰** ä» MySQL 5.6 å¼€å§‹å¼•å…¥ï¼Œå»ºè®®ä½¿ç”¨ **5.7 åŠä»¥ä¸Šç‰ˆæœ¬**ï¼Œæ›´ç¨³å®šå¯é ã€‚\n\nåœ¨ MySQL 5.7 ä¸­ï¼Œå³ä½¿æœªå¼€å¯ GTIDï¼Œä¹Ÿä¼šç”ŸæˆåŒ¿å GTIDï¼Œå…·å¤‡ä¸€å®šè¿½è¸ªèƒ½åŠ›ã€‚\n\n**GTID å¤åˆ¶çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š**\n\n- æ”¯æŒ `master_auto_position=1`ï¼Œ**æ— éœ€æŒ‡å®š binlog æ–‡ä»¶å’Œ POS ç‚¹**ï¼Œä¸»ä»å¤åˆ¶æ›´ç®€åŒ–ã€‚\n\n> å°±æ˜¯ä½ é‚£ä¸ªä¸»ä»å¤åˆ¶è¿æ¥é‡Œï¼Œä¸ç”¨è®°å½•äº†æ˜¯å“ªä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å’Œèµ·ç‚¹äº†ï¼Œæœ‰äº†è¿™ä¸ªå‚æ•°å°±å¯ä»¥è‡ªåŠ¨è¯†åˆ«ï¼Œå‰ææ˜¯`ä¸»ä»çš„æ•°æ®åº“è¦ä¸€è‡´`\n\n- å®ç°äº†äº‹åŠ¡çº§çš„**å¹‚ç­‰æ€§**ï¼Œé‡å¤æ‰§è¡Œäº‹åŠ¡ä¸ä¼šå‡ºé”™ã€‚\n- é…åˆ 5.6 çš„**åº“çº§å¹¶è¡Œå¤åˆ¶**å’Œ 5.7 çš„**äº‹åŠ¡çº§å¹¶è¡Œå¤åˆ¶**ï¼ˆé€»è¾‘æ—¶é’Ÿæœºåˆ¶ï¼‰ï¼Œæ˜¾è‘—æå‡å¤åˆ¶å¹¶å‘æ€§èƒ½ï¼Œé™ä½å»¶è¿Ÿã€‚\n- å¯å®‰å…¨æ”¯æŒå¤šä¸ª **dump çº¿ç¨‹ + å¤š SQL çº¿ç¨‹** å¹¶å‘å¤åˆ¶ã€‚\n\nGTID ä¼˜ç‚¹:\n\n- ä¿è¯äº‹åŠ¡å…¨å±€ç»Ÿä¸€\n- æˆªå–æ—¥å¿—æ›´åŠ æ–¹ä¾¿ã€‚è·¨å¤šæ–‡ä»¶ï¼Œåˆ¤æ–­èµ·ç‚¹ç»ˆç‚¹æ›´åŠ æ–¹ä¾¿\n- åˆ¤æ–­ä¸»ä»å·¥ä½œçŠ¶æ€æ›´åŠ æ–¹ä¾¿\n- ä¼ è¾“æ—¥å¿—ï¼Œå¯ä»¥å¹¶å‘ä¼ è¾“ã€‚SQLå›æ”¾å¯ä»¥æ›´`é«˜å¹¶å‘`\n- ä¸»ä»å¤åˆ¶æ„å»ºæ›´åŠ æ–¹ä¾¿\n\n\n\n> GTID = `server_uuid`:`transaction_id`ï¼Œåœ¨ä¸€ç»„å¤åˆ¶ä¸­ï¼Œå…¨å±€å”¯ä¸€\n>\n> server_uuid æ¥æºäº /var/lib/mysql/auto.cnf\n\nGTIDæœåŠ¡å™¨ç›¸å…³é€‰é¡¹\n\n```bash\ngtid_mode=ON #gtidæ¨¡å¼\nenforce_gtid_consistency=ON #ä¿è¯GTIDå®‰å…¨çš„å‚æ•°\n```\n\næµ‹è¯•æ¡ˆä¾‹ï¼šå‰ææ˜¯`ä¸»ä»çš„æ•°æ®åº“è¦ä¸€è‡´`ï¼Œ`å¹¶ä¸”åˆ›å»ºå¥½å¤åˆ¶ä¼ è¾“çš„è´¦å·`\n\n#å¦‚æœä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨æ•°æ®ä¸ä¸€è‡´,éœ€è¦å…ˆå°†ä¸»åº“æ•°æ®å¤‡ä»½è¿˜åŸè‡³ä»åº“,å†æ‰§è¡Œä¸‹é¢æ“ä½œ\n\n```bash\nmysqldump -uroot -p123456 -A -F -E -R --triggers --single-transaction \\\n--source-data=1 --flush-privileges --hex-blob --default-character-set=utf8 > all.sql\n#è‡ªè¡Œå¤åˆ¶çš„ä»èŠ‚ç‚¹ï¼Œè¿˜åŸçš„æ­¥éª¤æˆ‘å°±ä¸è¯´äº†\n```\n\n1.ä¸»èŠ‚ç‚¹\n\n```bash\nvim /etc/my.cnf\n#ä¿ç•™å¦‚ä¸‹\n[mysqld]\nserver-id=128\nlog-bin=/data/logbin/qylog\ngtid_mode=ON\nenforce_gtid_consistency=ON\n\n#ç„¶åé‡å¯mysql\nsystemctl restart mysqld\n```\n\n2.ä»èŠ‚ç‚¹ï¼ˆslave1å’Œslave2éƒ½ä¸€æ ·ï¼‰\n\n```bash\nvim /etc/my.cnf\nserver-id=ï¼ˆä»èŠ‚ç‚¹çš„å”¯ä¸€idï¼‰\n\nlog-bin=/data/logbin/qylog\nrelay_log=/data/relaylog/relay-log\nrelay_log_index=/data/relaylog/relay-log.index\ngtid_mode=ON\nenforce_gtid_consistency=ON\n\n#ç„¶åé‡å¯mysql\nsystemctl restart mysqld\n\n```\n\n3.ä»èŠ‚ç‚¹é‡ç½®å‰é¢å®éªŒçš„slaveå¤åˆ¶è¿æ¥\n\n```bash\n#slave1å’Œslave2éƒ½æ‰§è¡Œ\nstop slave;\nreset slave all;\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.128', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nget_master_public_key=1,\nMASTER_AUTO_POSITION=1; #ä½¿ç”¨GTID\nstart slave;\nshow slave status\\G;\n\n#ç„¶åå°±æ˜¯åŒyes\n```\n\n4.æŸ¥çœ‹æ˜¯å¦æˆåŠŸ\n\n```bash\nä¸»èŠ‚ç‚¹æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œæˆ‘è¿™é‡Œå°±æ‰§è¡Œåˆ›å»ºä¸€ä¸ªdb4æ•°æ®åº“\n(root@localhost) [(none)]> create database db5;\nQuery OK, 1 row affected (0.05 sec)\n\n(root@localhost) [(none)]> SHOW MASTER STATUS\\G\n*************************** 1. row ***************************\n             File: qylog.000004\n         Position: 339\n     Binlog_Do_DB:\n Binlog_Ignore_DB:\nExecuted_Gtid_Set: 363255e7-6ebc-11f0-80de-000c293bf782:1#è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°gtidäº†\n1 row in set (0.00 sec)\n\n#ç„¶åä»èŠ‚ç‚¹\n(root@localhost) [(none)]> show slave status\\G;\n......\n           Retrieved_Gtid_Set: 363255e7-6ebc-11f0-80de-000c293bf782:1\n            Executed_Gtid_Set: 363255e7-6ebc-11f0-80de-000c293bf782:1  #æ˜¯ä¸æ˜¯å’Œå‰é¢ä¸»èŠ‚ç‚¹ä¸€æ ·\n......\n\n```\n\nè‡³æ­¤gtidæˆåŠŸ\n\n## ä¸»ä»å¤åˆ¶bugé›†é”¦\n\n1.ä¸»ä»å¤åˆ¶åœ¨ä»èŠ‚ç‚¹ä½ å¯èƒ½ä¼šçœ‹è§\n\nshow slave status\\G;\n\n```bash\nLast_IO_Error: error connecting to master 'repluser@192.168.48.11:3306' - retry-time: 60 retries: 1 message: Authentication plugin 'caching_sha2_password' reported error: Authentication requires secure connection.\n```\n\nåŸå› ï¼šMySQL 8 é»˜è®¤ä½¿ç”¨ `caching_sha2_password` ä½œä¸ºè®¤è¯æ’ä»¶ï¼Œè¿™ç§è®¤è¯æ–¹å¼éœ€è¦å®‰å…¨è¿æ¥ï¼ˆSSL/TLSï¼‰ã€‚éœ€è¦ç”Ÿæˆè¯ä¹¦ï¼Œå¦‚æœä¸æƒ³ç”Ÿæˆè¯ä¹¦ï¼Œä½ è‡ªå·±ç°åœ¨ä»èŠ‚ç‚¹è¿›è¡Œä¸€æ¬¡ç™»å…¥\n\nå¦‚æœä½ æ˜¯çº§è”æœ€åçš„slaveï¼Œä¸»èŠ‚ç‚¹çš„åœ°å€è¦æŒ‡å‘ä¸­é—´èŠ‚ç‚¹\n\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å°†RSAå…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯ï¼Œåè€…ä½¿ç”¨å®ƒæ¥åŠ å¯†å¯†ç å¹¶å°†ç»“æœè¿”å›ç»™æœåŠ¡å™¨ã€‚æ’ä»¶ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„RSAç§é’¥è§£å¯†å¯†ç ï¼Œå¹¶æ ¹æ®å¯†ç æ˜¯å¦æ­£ç¡®æ¥æ¥å—æˆ–æ‹’ç»è¿æ¥ã€‚\n\n```bash\nmysql -urepluser -p123456 -h192.168.48.128 --get-server-public-key\n```\n\nç„¶åé‡å¯slaveå¤åˆ¶çº¿ç¨‹\n\n```bash\nstop slave;start slave;show slave status\\G;\n```\n\nä»¥ä¸Šåªæ˜¯ä¸´æ—¶çš„è§£å†³æ–¹æ¡ˆï¼Œè¿˜æœ‰ä¸€ä¸ªåŠæ³•å°±æ˜¯\n\nåŠ è¿™ä¸ªå‚æ•°`get_master_public_key=1`\n\nå¦‚æœè¿™ä¸ªä¸è¡Œå°±æ¢`get_source_public_key=1`\n\n```bash\nCHANGE MASTER TO \nMASTER_HOST='192.168.48.128', \nMASTER_USER='repluser', \nMASTER_PASSWORD='123456', \nMASTER_LOG_FILE='qylog.000001', \nMASTER_LOG_POS=157,\nget_master_public_key=1,\nMASTER_DELAY=10; \n```\n\n2.åœ¨ä¸»ä¸»å¤åˆ¶çš„æ—¶å€™ï¼Œæˆ‘çŸ¥é“ä¸æ˜¯è®¾ç½®äº†å»¶è¿Ÿå¤åˆ¶ä¸º10ç§’å—ï¼Œå°±æ˜¯é‚£ä¸ªä¸»ä»å¤åˆ¶çš„è¿æ¥æœ€åä¸€é¡¹\n\nä½†æ˜¯æƒ…å†µæ˜¯ï¼š\n\nç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹æ’å…¥æ•°æ®æˆåŠŸå¤åˆ¶åˆ°ä»èŠ‚ç‚¹ \n\nä½†æ˜¯åœ¨ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹ï¼Œæ’å…¥æ•°æ®ä¹‹åï¼Œå°±å‡ºç°lä¸‹é¢çš„æƒ…å†µ\n\nSQL_Remaining_Delay: 3995      \n\nSlave_SQL_Running_State: Waiting until SOURCE_DELAY seconds after source executed event           Master_Retry_Count: 86400\n\né—®äº†ai\n\n```bash\nä½ è®¾ç½®äº†å»¶è¿Ÿå¤åˆ¶ MASTER_DELAY = 10ï¼›\nä»åº“æ˜¾ç¤º SQL_Remaining_Delay: 3995ï¼Œè¯´æ˜å®ƒåœ¨â€œç­‰äº‹ä»¶æ‰§è¡Œæ—¶é—´åˆ°äº†å†å¤„ç†â€ï¼›\nè¿™ä¸ªæ˜¯æ­£å¸¸ç°è±¡ï¼Œä¸æ˜¯é”™è¯¯ï¼›\nå»¶è¿Ÿæ—¶é—´è¿™ä¹ˆé•¿ï¼Œå¯èƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„ç³»ç»Ÿæ—¶é—´æ¯”ä»èŠ‚ç‚¹æ…¢ï¼›\n```\n\nç»“æœä½ çŸ¥é“å—ï¼ŒçœŸçš„æœäº†ï¼Œä¸¤ä¸ªä¸»æœºçš„æ—¶é—´ä¸ä¸€è‡´\n\n```bash\n[root@slave ~]# date\nFri Aug  1 03:06:40 CST 2025\n[root@master ~]# date\nFri Aug  1 02:00:20 AM CST 2025\n#ä½†æ˜¯æ˜¯æˆ‘çš„ä»èŠ‚ç‚¹æ—¶é—´æœ‰é—®é¢˜ï¼Œæˆ‘æ›´æ–°äº†ä¸€ä¸‹æ—¶é—´\n```\n\n## å¤åˆ¶çš„ç›‘æ§å’Œç»´æŠ¤\n\n### æ¸…ç†æ—¥å¿—\n\n```bash\nPURGE { BINARY | MASTER } LOGS  { TO 'log_name' | BEFORE datetime_expr }\nRESET MASTER TO # #mysql ä¸æ”¯æŒ\nRESET SLAVE [ALL]\n```\n\n### å¤åˆ¶ç›‘æ§\n\n```bash\nSHOW MASTER STATUS\nSHOW BINARY LOGS\nSHOW BINLOG EVENTS\nSHOW SLAVE STATUS\nSHOW PROCESSLIST\n```\n\n### ä»æœåŠ¡å™¨æ˜¯å¦è½åäºä¸»æœåŠ¡\n\n```bash\nSeconds_Behind_Masterï¼š0\n```\n\n### å¦‚ä½•ç¡®å®šä¸»ä»èŠ‚ç‚¹æ•°æ®æ˜¯å¦ä¸€è‡´\n\n```bash\npercona-toolkit\n```\n\n### æ•°æ®ä¸ä¸€è‡´å¦‚ä½•ä¿®å¤\n\nåˆ é™¤ä»æ•°æ®åº“ï¼Œé‡æ–°å¤åˆ¶\n\n## å¤åˆ¶çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ\n\n### æ•°æ®æŸåæˆ–ä¸¢å¤±\n\n- Masterï¼šMHA + semisync replication\n- Slaveï¼š é‡æ–°å¤åˆ¶\n\n### ä¸æƒŸä¸€çš„ server id\n\né‡æ–°å¤åˆ¶\n\n### å¤åˆ¶å»¶è¿Ÿ\n\n- å‡çº§åˆ°MySQL5.7ä»¥ä¸Šç‰ˆæœ¬(5.7ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæ²¡æœ‰å¼€GTIDä¹‹å‰ï¼Œä¸»åº“å¯ä»¥å¹¶å‘äº‹åŠ¡ï¼Œä½†æ˜¯dumpä¼ è¾“æ—¶æ˜¯ä¸²è¡Œ)åˆ©ç”¨GTID(MySQL5.6éœ€è¦æ‰‹åŠ¨å¼€å¯,MySQL5.7ä»¥ä¸Šé»˜è®¤å¼€å¯)æ”¯æŒå¹¶å‘ä¼ è¾“binlogåŠå¹¶è¡Œå¤šä¸ªSQLçº¿ç¨‹\n- å‡å°‘å¤§äº‹åŠ¡,å°†å¤§äº‹åŠ¡æ‹†åˆ†æˆå°äº‹åŠ¡\n- å‡å°‘é”\n- sync_binlog=1 åŠ å¿«binlogæ›´æ–°æ—¶é—´,ä»è€ŒåŠ å¿«æ—¥å¿—å¤åˆ¶\n- éœ€è¦é¢å¤–çš„ç›‘æ§å·¥å…·çš„è¾…åŠ©\n- ä¸€ä»å¤šä¸»ï¼šMariadb10 ç‰ˆåæ”¯æŒ\n- å¤šçº¿ç¨‹å¤åˆ¶ï¼šå¯¹å¤šä¸ªæ•°æ®åº“å¤åˆ¶\n\n### MySQL ä¸»ä»æ•°æ®ä¸ä¸€è‡´\n\n#### é€ æˆä¸»ä»ä¸ä¸€è‡´çš„åŸå› \n\n- ä¸»åº“binlogæ ¼å¼ä¸ºStatementï¼ŒåŒæ­¥åˆ°ä»åº“æ‰§è¡Œåå¯èƒ½é€ æˆä¸»ä»ä¸ä¸€è‡´ã€‚\n- ä¸»åº“æ‰§è¡Œæ›´æ”¹å‰æœ‰æ‰§è¡Œset sql_log_bin=0ï¼Œä¼šä½¿ä¸»åº“ä¸è®°å½•binlogï¼Œä»åº“ä¹Ÿæ— æ³•å˜æ›´è¿™éƒ¨åˆ†æ•°æ®ã€‚\n- ä»èŠ‚ç‚¹æœªè®¾ç½®åªè¯»ï¼Œè¯¯æ“ä½œå†™å…¥æ•°æ®\n- ä¸»åº“æˆ–ä»åº“æ„å¤–å®•æœºï¼Œå®•æœºå¯èƒ½ä¼šé€ æˆbinlogæˆ–è€…relaylogæ–‡ä»¶å‡ºç°æŸåï¼Œå¯¼è‡´ä¸»ä»ä¸ä¸€è‡´\n- ä¸»ä»å®ä¾‹ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œç‰¹åˆ«æ˜¯é«˜ç‰ˆæœ¬æ˜¯ä¸»ï¼Œä½ç‰ˆæœ¬ä¸ºä»çš„æƒ…å†µä¸‹ï¼Œä¸»æ•°æ®åº“ä¸Šé¢æ”¯æŒçš„åŠŸèƒ½ï¼Œä»æ•°æ®åº“ä¸Šé¢å¯èƒ½ä¸æ”¯æŒè¯¥åŠŸèƒ½\n- ä¸»ä»sql_mode ä¸ä¸€è‡´\n- MySQLè‡ªèº«bugå¯¼è‡´\n\n####  ä¸»ä»ä¸ä¸€è‡´ä¿®å¤æ–¹æ³•\n\n- å°†ä»åº“é‡æ–°å®ç°\n\nè™½ç„¶è¿™ä¹Ÿæ˜¯ä¸€ç§è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆæ¢å¤æ—¶é—´æ¯”è¾ƒæ…¢ï¼Œè€Œä¸”æœ‰æ—¶å€™ä»åº“ä¹Ÿæ˜¯æ‰¿æ‹…ä¸€éƒ¨åˆ†çš„æŸ¥è¯¢æ“ä½œçš„ï¼Œä¸èƒ½è´¸ç„¶é‡å»ºã€‚\n\n- ä½¿ç”¨percona-toolkitå·¥å…·è¾…åŠ©\n\nPTå·¥å…·åŒ…ä¸­åŒ…å«pt-table-checksumå’Œpt-table-syncä¸¤ä¸ªå·¥å…·ï¼Œä¸»è¦ç”¨äºæ£€æµ‹ä¸»ä»æ˜¯å¦ä¸€è‡´ä»¥åŠä¿®å¤æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚è¿™ç§æ–¹æ¡ˆä¼˜ç‚¹æ˜¯ä¿®å¤é€Ÿåº¦å¿«ï¼Œä¸éœ€è¦åœæ­¢ä¸»ä»è¾…åŠ©ï¼Œç¼ºç‚¹æ˜¯éœ€è¦çŸ¥è¯†ç§¯ç´¯ï¼Œéœ€è¦æ—¶é—´å»å­¦ä¹ ï¼Œå»æµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œè¿˜æ˜¯è¦å°å¿ƒä½¿ç”¨\n\nå…³äºä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢é“¾æ¥ï¼šhttps://www.cnblogs.com/feiren/p/7777218.html\n\n- æ‰‹åŠ¨é‡å»ºä¸ä¸€è‡´çš„è¡¨\n\nåœ¨ä»åº“å‘ç°æŸå‡ å¼ è¡¨ä¸ä¸»åº“æ•°æ®ä¸ä¸€è‡´ï¼Œè€Œè¿™å‡ å¼ è¡¨æ•°æ®é‡ä¹Ÿæ¯”è¾ƒå¤§ï¼Œæ‰‹å·¥æ¯”å¯¹æ•°æ®ä¸ç°å®ï¼Œå¹¶ä¸”é‡åšæ•´ä¸ªåº“ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åªé‡åšè¿™å‡ å¼ è¡¨æ¥ä¿®å¤ä¸»ä»ä¸ä¸€è‡´è¿™ç§æ–¹æ¡ˆç¼ºç‚¹æ˜¯åœ¨æ‰§è¡Œå¯¼å…¥æœŸé—´éœ€è¦æš‚æ—¶åœæ­¢ä»åº“å¤åˆ¶ï¼Œä¸è¿‡ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„\n\nèŒƒä¾‹ï¼šA,B,Cè¿™ä¸‰å¼ è¡¨ä¸»ä»æ•°æ®ä¸ä¸€è‡´\n\n```bash\n1ã€ä»åº“åœæ­¢Slaveå¤åˆ¶\nmysql>stop slave;\n2ã€åœ¨ä¸»åº“ä¸Šdumpè¿™ä¸‰å¼ è¡¨ï¼Œå¹¶è®°å½•ä¸‹åŒæ­¥çš„binlogå’ŒPOSç‚¹\nmysqldump -uroot -pmagedu -q --single-transaction --master-data=2 testdb A B C >/backup/A_B_C.sql\n3ã€æŸ¥çœ‹A_B_C.sqlæ–‡ä»¶ï¼Œæ‰¾å‡ºè®°å½•çš„binlogå’ŒPOSç‚¹\nhead A_B_C.sql\nä¾‹å¦‚:MASTERLOGFILE='mysql-bin.888888', MASTERLOGPOS=666666;\n#ä»¥ä¸‹æŒ‡ä»¤æ˜¯ä¸ºäº†ä¿éšœå…¶ä»–è¡¨çš„æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸€ç›´åŒæ­¥ç›´åˆ°é‚£ä¸ªç‚¹ç»“æŸï¼ŒA,B,Cè¡¨çš„æ•°æ®åœ¨ä¹‹å‰çš„å¤‡ä»½å·²ç»ç”Ÿæˆäº†ä¸€ä»½å¿«ç…§ï¼Œåªéœ€è¦å¯¼å…¥è¿›å…¥ï¼Œç„¶åå¼€å¯åŒæ­¥å³å¯\n4ã€æŠŠA_B_C.sqlæ‹·è´åˆ°Slaveæœºå™¨ä¸Šï¼Œå¹¶åšæŒ‡å‘æ–°ä½ç½®\nmysql>start slave until MASTERLOGFILE='mysql-bin.888888', MASTERLOGPOS=666666;\n5ã€åœ¨Slaveæœºå™¨ä¸Šå¯¼å…¥A_B_C.sql\nmysql -uroot -pmagedu testdb \nmysql>set sql_log_bin=0;\nmysql>source /backup/A_B_C.sql\nmysql>set sql_log_bin=1;\n6ã€å¯¼å…¥å®Œæ¯•åï¼Œä»åº“å¼€å¯åŒæ­¥å³å¯ã€‚\nmysql>start slave;\n```\n\n####  å¦‚ä½•é¿å…ä¸»ä»ä¸ä¸€è‡´\n\n- ä¸»åº“binlogé‡‡ç”¨ROWæ ¼å¼\n- ä¸»ä»å®ä¾‹æ•°æ®åº“ç‰ˆæœ¬ä¿æŒä¸€è‡´\n- ä¸»åº“åšå¥½è´¦å·æƒé™æŠŠæ§ï¼Œä¸å¯ä»¥æ‰§è¡Œset sql_log_bin=0\n- ä»åº“å¼€å¯åªè¯»ï¼Œä¸å…è®¸äººä¸ºå†™å…¥\n- å®šæœŸè¿›è¡Œä¸»ä»ä¸€è‡´æ€§æ£€éªŒ\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Mysql"],"categories":["è¿ç»´"]},{"title":"ç½‘ç»œå·¥ç¨‹å¸ˆå¤‡è€ƒç¬”è®°","url":"/posts/2c5e9e22/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# ç½‘ç»œå·¥ç¨‹å¸ˆå¤‡è€ƒç¬”è®°\n\n## è®¡ç®—æœºç½‘ç»œæ¦‚è®º\n\næ—©æœŸçš„è®¡ç®—æœºç½‘ç»œæ˜¯é¢å‘ç»ˆç«¯çš„è®¡ç®—æœºç½‘ç»œï¼Œåœ¨è¿™ç§ç½‘ç»œä¸­ä¸»è¦å­˜åœ¨çš„æ˜¯ç»ˆç«¯å’Œä¸­å¿ƒè®¡ç®—æœºè¿›è¡Œé€šä¿¡ã€‚<font color='red'>è®¡ç®—æœºç½‘ç»œ:è®¡ç®—æœºæŠ€æœ¯ä¸é€šä¿¡æŠ€æœ¯çš„ç»“åˆã€‚</font>\n\n### è®¡ç®—æœºç½‘ç»œçš„åˆ†ç±»\n\n`1.é€šä¿¡å­ç½‘å’Œèµ„æºå­ç½‘ï¼š`\n\n`é€šä¿¡å­ç½‘`:é€šä¿¡èŠ‚ç‚¹(é›†çº¿å™¨ã€äº¤æ¢æœºã€è·¯ç”±å™¨ç­‰)å’Œé€šä¿¡é“¾è·¯(ç”µè¯çº¿ã€åŒè½´ç”µç¼†ã€æ— çº¿ç”µçº¿è·¯,å«æ˜Ÿçº¿è·¯ã€å¾®æ³¢ä¸­ç»§çº¿è·¯å’Œå…‰çº¤ç¼†çº¿)ã€‚\n`ç”¨æˆ·èµ„æºå­ç½‘`:PCã€æœåŠ¡å™¨ç­‰\n\n![image-20241126165519628](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/32166a5a07a4302e5ff93edaf1f0ad3c697559838.png)\n\n`3.LAN MAN WAN`\n\n1. æŒ‰åœ°åŸŸèŒƒå›´ï¼Œå¯åˆ†ä¸ºå±€åŸŸç½‘(LAN)ã€åŸåŸŸç½‘(MAN)å’Œå¹¿åŸŸç½‘(WAN)3 ç±»ã€‚\n2. æŒ‰æ‰€é‡‡ç”¨ç½‘ç»œåè®®çš„ä¸åŒï¼Œå¯åˆ†ä¸ºTCP/IP ç½‘ç»œã€SPX/IPXç½‘ç»œç­‰ã€‚\n3. æŒ‰äº¤æ¢æ–¹å¼ï¼Œå¯åˆ†ä¸º`ç”µè·¯äº¤æ¢ç½‘`ã€`åˆ†ç»„äº¤æ¢ç½‘`ã€`æŠ¥æ–‡äº¤æ¢`ç­‰ã€‚\n\n![image-20241126170308183](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/35813a62f4291ce75ad91edc20595fd1697559838.png)\n\n1. æŒ‰é€šä¿¡ä»‹è´¨ï¼Œå¯åˆ†ä¸ºæœ‰çº¿ç½‘å’Œæ— çº¿ç½‘ã€‚\n2. æŒ‰ç½‘ç»œæ§åˆ¶æ–¹å¼ï¼Œå¯åˆ†ä¸ºé›†ä¸­å¼å’Œåˆ†å¸ƒå¼ã€‚\n\n![image-20241126170015939](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f462a7003d679b87e7322c7f0f83d892697559838.png)\n\n### æˆ‘å›½äº’è”ç½‘çš„å‘å±•\n\n![image-20250119223158856](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/005e8e3f623b947ae236399898c9b7ab697559838.png)\n\n`è®¡ç®—æœºç½‘ç»œçš„åº”ç”¨`\n\n![image-20250119223353599](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9909a6f3e2c7205d6d03372387dfb15f697559838.png)\n\n![image-20250119223409936](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e38ea03bc0fe5b3b907b4d344d1239ec697559838.png)\n\n![image-20250119223459679](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7b7e3fb719545f06d7d6e79f2c9ad7ab697559838.png)\n\n`æ¡ˆä¾‹åˆ†æé¢˜`\n\næŸä»“å‚¨ä¼ä¸šç½‘ç»œæ‹“æ‰‘ç»“æ„å¦‚å›¾1-1æ‰€ç¤ºï¼Œè¯¥ä¼ä¸šå åœ°500äº©ã€‚æœ‰äº”å±‚åŠå…¬æ¥¼1æ ‹ï¼Œå¤§å‹ä»“åº“10æ ‹ã€‚æ¯æ ‹ä»“åº“å†…ã€å¤–éƒ¨é…ç½®è§†é¢‘ç›‘æ§16å°ï¼Œå…±è®¡å®‰è£…è§†é¢‘ç›‘æ§160å°ï¼ŒSwitchAã€æœåŠ¡å™¨ã€é˜²ç«å¢™ã€ç®¡ç†æœºã€Router Aç­‰è®¾å¤‡éƒ¨ç½²åœ¨ä¼ä¸šåŠå…¬æ¥¼ä¸€å±‚çš„æ•°æ®æœºæˆ¿ä¸­ï¼ŒSwitch Béƒ¨ç½²åœ¨åŠå…¬æ¥¼ä¸€å±‚é…çº¿é—´ä½œä¸ºä¸€å±‚çš„æ¥å…¥è®¾å¤‡ï¼ŒSwitch Cå’ŒSwitch Dåˆ†åˆ«éƒ¨ç½²åœ¨ä»“åº“1å’Œä»“åº“2ï¼Œå„ä»“åº“çš„äº¤æ¢æœºä¸Switch Aç›¸è¿ã€‚åŠå…¬æ¥¼çš„å…¶ä»–æ¥¼å±‚çš„äº¤æ¢æœºä»¥åŠå…¶ä»–ä»“åº“çš„äº¤æ¢æœºçš„ç½‘ç»œæ¥å…¥æ–¹å¼ä¸å›¾1-1ä¸­Switch Bã€SwitchCã€SwitchDæ¥å…¥æ–¹å¼ç›¸åŒï¼Œä¸å†å•ç‹¬åœ¨å›¾1-1ä¸Šæ ‡ç¤ºã€‚\n\nè‹¥æ¥å…¥çš„IPCé‡‡ç”¨1080Pçš„å›¾åƒä¼ è¾“è´¨é‡ä¼ è¾“æ•°æ®ï¼ŒSwitchCã€Switch Aé€‰ç”¨ç™¾å…†äº¤æ¢æœºæ˜¯å¦æ»¡è¶³å¸¦å®½è¦æ±‚ï¼Œè¯·è¯´æ˜ç†ç”±ã€‚\n\n![image-20250119223647314](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/88bcb90f26806d6f296654f376b1025a697559838.png)\n\n![image-20250119223716699](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8b7b9836eb0b17d0297e1a080180473a697559838.png)\n\n### OSIå’ŒTCP/IPå‚è€ƒæ¨¡å‹\n\n#### å‰æƒ…æè¦\n\nä¸ºä»€ä¹ˆè¦è¿›è¡Œç½‘ç»œåˆ†å±‚ï¼Ÿ\n\n![image-20241126170441814](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6a5734509aed808e087646f6b00acb97697559838.png)\n\nOSIå‚è€ƒæ¨¡å‹:CPU/å†…å­˜/ç¡¬ç›˜/æ˜¾å¡/ä¸»æ¿ç­‰æ ‡å‡†åŒ–\næŸä¸€å±‚æ‰€åšçš„æ”¹åŠ¨ä¸ä¼šå½±å“åˆ°å…¶ä»–çš„å±‚ï¼Œ<font color='red'>åˆ©äºè®¾è®¡ã€å¼€å‘å’Œæ•…éšœæ’é™¤</font>ã€‚\né€šè¿‡å®šä¹‰åœ¨æ¨¡å‹çš„æ¯ä¸€å±‚å®ç°åŠŸèƒ½ï¼Œé¼“åŠ±<font color='red'>äº§ä¸šçš„æ ‡å‡†åŒ–</font>ã€‚\né€šè¿‡ç½‘ç»œç»„ä»¶çš„æ ‡å‡†åŒ–ï¼Œå…è®¸<font color='red'>å¤šä¸ªä¾›åº”å•†</font>ååŒè¿›è¡Œå¼€å‘ã€‚\nå…è®¸å„ç§ç±»å‹çš„ç½‘ç»œç¡¬ä»¶å’Œè½¯ä»¶äº’ç›¸é€šä¿¡ï¼Œ<font color='red'>æ— ç¼èåˆ</font>ã€‚\nä¿ƒè¿›ç½‘ç»œæŠ€æœ¯<font color='red'>å¿«é€Ÿè¿­ä»£ï¼Œé™ä½æˆæœ¬</font>\n\n#### OSIå‚è€ƒæ¨¡å‹\n\nä¸ƒå±‚çš„è¯¦ç»†çŸ¥è¯†ç‚¹å¯ä»¥è·³è½¬ï¼š[2.6 OSIåè®®é›†](#OSIåè®®é›†(é‡ç‚¹))\n\nç‰©ç†å±‚(PI):ç¡®å®š<font color='red'>ç‰©ç†è®¾å¤‡æ¥å£</font>ï¼Œæä¾›ç‚¹ä¸€ç‚¹çš„äºŒè¿›åˆ¶ä½æµä¼ è¾“çš„ç‰©ç†é“¾è·¯ã€‚\n\næ•°æ®é“¾è·¯å±‚(DLL):åˆ©ç”¨å·®é”™å¤„ç†æŠ€æœ¯ï¼Œæä¾›é«˜<font color='red'>å¯é çš„ç‚¹åˆ°ç‚¹ä¼ è¾“</font>çš„æ•°æ®é“¾è·¯\n\nç½‘ç»œå±‚(NL):åˆ©ç”¨<font color='red'>é€»è¾‘å¯»å€;è·¯ç”±é€‰æ‹©</font>ï¼Œå®ç°ç”¨æˆ·æ•°æ®çš„ä¼ è¾“ã€‚\n\nä¼ è¾“å±‚(TL):æä¾›å¯é æˆ–è€…ä¸å¯é çš„<font color='red'>ç«¯åˆ°ç«¯</font>ä¼ è¾“ã€‚\n\nä¼šè¯å±‚(SL):ä¸ºé€šä¿¡åŒæ–¹æŒ‡å®šé€šä¿¡æ–¹å¼ï¼Œå¹¶åˆ›å»ºã€æ³¨é”€ä¼šè¯\n\nè¡¨ç¤ºå±‚(PL):æ•°æ®å’Œä¿¡æ¯çš„è¯­æ³•è½¬æ¢å†…ç ï¼Œæ•°æ®å‹ç¼©è§£å‹ã€åŠ å¯†è§£å¯†\n\nåº”ç”¨å±‚(AL):å„ç§åº”ç”¨ç¨‹åºã€åè®®\n\n![image-20250119223844310](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/442ac2df125e2dd35a5786e8980f8d39697559838.png)\n\n#### TCP/IPå‚è€ƒæ¨¡å‹\n\n![image-20250119224047355](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7d72d497b937ca66c27ac98570c53856697559838.png)\n\n![image-20250119223929940](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/055e4a689f4179a33d9c1b4ef9c8a8ad697559838.png)\n\nTCP/IPå‚è€ƒæ¨¡å‹å¯¹åº”åè®®\n\n![image-20241126171714516](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/66e384a731b7973568bc4a58be4e4b9e697559838.png)\n\n#### OSIä¸TCP/IPæ¨¡å‹å¯¹&åè®®å±‚æ¬¡\n\n![image-20250119224025281](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/265e0c405f47e6d83225061831643ca6697559838.png)\n\n### ä¾‹é¢˜\n\n1. åœ¨OSIå‚è€ƒæ¨¡å‹ä¸­ï¼Œå®ç°ç«¯åˆ°ç«¯çš„åº”ç­”ã€åˆ†ç»„æ’åºå’Œæµé‡æ§åˆ¶åŠŸèƒ½çš„åè®®å±‚æ˜¯(C)ã€‚\n   A.æ•°æ®é“¾è·¯å±‚ B.ç½‘ç»œå±‚ C.ä¼ è¾“å±‚ D.ä¼šè¯å±‚\n\n2. åœ¨OSIå‚è€ƒæ¨¡å‹ä¸­ï¼Œ(B)åœ¨ç‰©ç†çº¿è·¯ä¸Šæä¾›å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚\n\nâ€‹    A.ç‰©ç†å±‚ B.æ•°æ®é“¾è·¯å±‚ C.ç½‘ç»œå±‚ D.ä¼ è¾“å±‚\nã€è§£æã€‘æœ¬é¢˜éå¸¸å®¹æ˜“è¯¯é€‰Dï¼Œä¸€å®šè¦å­¦ä¼šåŒºåˆ†\n\nç®€å•ç†è§£:ç‰©ç†é“¾è·¯ä¹‹<font color='red'>ä¸Š</font>æ˜¯æ•°æ®é“¾è·¯å±‚ï¼ŒOSIæ¨¡å‹çš„æ•°æ®é“¾è·¯å±‚æœ‰å¾ˆå¤šå¯é æ€§ä¿éšœæœºåˆ¶ã€‚\n\næ·±å…¥ç†è§£:æ•°æ®é“¾è·¯å±‚ä¸ä¼ è¾“å±‚çš„åŒºåˆ«,æ¯”å¦‚æœ‰3ä¸ªèŠ‚ç‚¹æ˜¯1-2-3,1åˆ°3æ˜¯ç«¯åˆ°ç«¯ï¼Œå¯é æ€§é€šè¿‡ä¼ è¾“å±‚åè®®ä¿éšœï¼Œ1åˆ°2æˆ–è€…2åˆ°3æ˜¯ç‰©ç†é“¾è·¯ï¼Œå¯é æ€§é€šè¿‡æ•°æ®é“¾è·¯å±‚ä¿éšœï¼Œé‚£ä¹ˆè¿™é¢˜æ˜æ˜¾é—®çš„æ˜¯ç‰©ç†é“¾è·¯ä¸Šçš„å¯é æ€§ã€‚\n\n![Snipaste_2024-11-26_17-23-10](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4a500c4846e3a1f58b2374ca759a6993697559838.png)\n\n\n\n### æ•°æ®å°è£…ä¸è§£å°è¿‡ç¨‹åˆ†æ\n\næ•°æ®å°è£…ï¼ˆä»ä¸Šå¾€ä¸‹ï¼‰\n\n![image-20241126172919585](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/62aaa41a441ff615043bf3375724854a697559838.png)\n\næ•°æ®è§£å°ï¼ˆä»ä¸‹å¾€ä¸Šï¼‰\n\n![image-20241126173002551](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2f67c40b8f65bd6a8bba09bae9da983d697559838.png)\n\nä¾‹å­ï¼š\n\n![image-20241126173021860](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b9d9d87495d82d8a62f1eeb1ccf61c9d697559838.png)\n\n### ä¾‹é¢˜\n\n1. åœ¨ISO OSI/RMä¸­ï¼Œ(1)å®ç°æ•°æ®å‹ç¼©åŠŸèƒ½ã€‚åœ¨OSIå‚è€ƒæ¨¡å‹ä¸­ï¼Œæ•°æ®é“¾è·¯å±‚å¤„ç†çš„æ•°æ®å•ä½æ˜¯(2)ã€‚\n\n(1)A.åº”ç”¨å±‚ B.è¡¨ç¤ºå±‚ C.ä¼šè¯å±‚ D.ç½‘ç»œå±‚  \n\n(2)A.æ¯”ç‰¹ B.å¸§ C.åˆ†ç»„  D.æŠ¥æ–‡\n\nç­”æ¡ˆï¼šB;B\n\n2. åœ¨OSIå‚è€ƒæ¨¡å‹ä¸­ï¼Œä¼ è¾“å±‚ä¸Šä¼ è¾“çš„æ•°æ®å•ä½æ˜¯(D)ã€‚\n\n   A.æ¯”ç‰¹  B.å¸§  C.åˆ†ç»„  D.æŠ¥æ–‡\n\n![image-20250119224255544](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dc2ba82a73ebec61489b87c5d8362f66697559838.png)\n\n## æ•°æ®é€šä¿¡åŸºç¡€\n\n### ä¿¡é“ç‰¹æ€§\n\n#### æ¦‚å¿µ\n\n![image-20241126202312912](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5b60d7e2c4c70aa44d20e98fd4335763697559838.png)\n\né€šä¿¡çš„ç›®çš„å°±æ˜¯<font color='red'>ä¼ é€’ä¿¡æ¯</font>ã€‚\né€šä¿¡ä¸­äº§ç”Ÿå’Œå‘é€ä¿¡æ¯çš„ä¸€ç«¯å«<font color='red'>ä¿¡æº</font>ï¼Œæ¥æ”¶ä¿¡æ¯çš„ä¸€ç«¯å«<font color='red'>ä¿¡å®¿</font>ï¼Œä¿¡æºå’Œä¿¡å®¿ä¹‹é—´çš„é€šä¿¡çº¿è·¯ç§°ä¸º<font color='red'>ä¿¡é“</font>ã€‚\n\n#### ä¿¡é“å¸¦å®½\n\n![image-20241126202551494](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7f26fbc0f579722332ee11ea9bbfd933697559838.png)\n\n#### ç å…ƒå’Œç å…ƒé€Ÿç‡\n\n![image-20241120200921145](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a846c13a89bc4370afb2623e52c8ea9d697559838.png)\n\n<font color='red'>ç å…ƒï¼ˆNæˆ–ä¿¡å·çŠ¶æ€ï¼‰</font>:ä¸€ä¸ªæ•°å­—è„‰å†²ç§°ä¸ºä¸€ä¸ªç å…ƒ(å¯ç†è§£ä¸ºæ—¶é’Ÿå‘¨æœŸçš„ä¿¡å·)\n\n<font color='red'>ç å…ƒé€Ÿç‡</font>:å•ä½æ—¶é—´å†…ä¿¡é“ä¼ é€çš„ç å…ƒä¸ªæ•°ã€‚<font color='red'>å¦‚æœç å…ƒå®½åº¦</font>(è„‰å†²å‘¨æœŸ)ä¸ºTï¼Œåˆ™ç å…ƒé€Ÿç‡(æ³¢ç‰¹ç‡)ä¸º<font color='red'>B=1/T</font>ï¼Œå•ä½æ˜¯<font color='red'>æ³¢ç‰¹ Baud</font>ã€‚\n\nä¸€ä¸ªç å…ƒæºå¸¦ä¿¡æ¯é‡n(ä½)ä¸ç å…ƒç§ç±»æ•°(N)çš„å…³ç³» <font color='red'>n=log~2~N</font>ã€‚\n\n#### å¥ˆå¥æ–¯ç‰¹å®šç†\n\n<font color='red'>è¦ç†è§£ï¼Œæ…¢æ…¢ç†è§£å¾ˆé‡è¦ï¼</font>\n\n`å¥ˆå¥æ–¯ç‰¹å®šç†`:åœ¨ä¸€ä¸ªç†æƒ³çš„(`æ²¡æœ‰å™ªå£°ç¯å¢ƒ`)ä¿¡é“ä¸­ï¼Œè‹¥ä¿¡é“å¸¦å®½ä¸ºWï¼Œ<font color='red'>æœ€å¤§ç å…ƒé€Ÿç‡</font>ä¸º<font color='red'>B=2W</font>(Baud)ã€‚\n\n<font color='red'>æé™æ•°æ®é€Ÿç‡</font>ä¸º<font color='red'>R=Blog~2~N=2Wlog~2~N</font>ã€‚(Nè¡¨ç¤ºç å…ƒç§ç±»æ•°)\n\n\n\næ–¹ä¾¿ç†è§£ç¤ºæ„ï¼šï¼ˆä»¥ä¸‹ç å…ƒç”¨åŒ…è£¹è¡¨ç¤ºï¼Œä»¥ä¸‹éƒ½ç”¨ç®€å•çš„è¯­è¨€æè¿°ï¼‰\n\n<font color='cornflowerblue'>ç å…ƒé€Ÿç‡ï¼ˆBï¼‰= æ¯ç§’å‘é€åŒ…è£¹ä¸ªæ•°</font>,æ¦‚å¿µè¦è®°ä½ï¼ˆ<font color='red'>ç å…ƒé€Ÿç‡</font>:å•ä½æ—¶é—´å†…ä¿¡é“ä¼ é€çš„ç å…ƒä¸ªæ•°ï¼‰\n\n\n\n<font color='cornflowerblue'>æ•°æ®é€Ÿç‡ = æ¯ç§’å‘é€åŒ…è£¹é‡é‡</font>\n\nâ¬‡ï¸\n\næ¯ç§’å‘é€åŒ…è£¹é‡é‡(R) = æ¯<font color='red'>ç§’</font>å‘é€åŒ…è£¹<font color='red'>ä¸ª</font>æ•°(B) * æ¯<font color='red'>ä¸ª</font>åŒ…è£¹é‡é‡(n)\n\nâ¬‡ï¸\n\næ•°æ®é€Ÿç‡(R) = ç å…ƒé€Ÿç‡(B) * æ¯ä¸ªç å…ƒæºå¸¦ä¿¡æ¯é‡(n) \n\nä¸‹é¢é’ˆå¯¹ä¸Šé¢çš„å›¾è§£ï¼š\n\n![image-20241126210948833](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dd64729881949cf7c6d35b4f96479fac697559838.png)\n\n#### é¦™å†œå®šç†\n\n`é¦™å†œå®šç†`:åœ¨ä¸€ä¸ª`å™ªå£°ä¿¡é“`çš„æé™æ•°æ®é€Ÿç‡å’Œå¸¦å®½ä¹‹é—´çš„å…³ç³»ã€‚    C(ä¹Ÿå«`ä¿¡é“å®¹é‡`)\n\n<font color='red'>æé™æ•°æ®é€Ÿç‡</font>å…¬å¼ä¸º:<font color='red'>C=Wlog~2~(1+S/N)</font>\n\nåˆ†è´ä¸ä¿¡å™ªæ¯”å…³ç³»:<font color='red'>dB=10log~10~S/N</font>\n\nå…¶ä¸­Wä¸ºå¸¦å®½ï¼ŒSä¸ºä¿¡å·å¹³å‡åŠŸç‡ï¼ŒNä¸ºå™ªå£°å¹³å‡åŠŸç‡ï¼ŒS/Nä¸ºä¿¡å™ªæ¯”ã€‚\n\nè€ƒè¯•ä¸€èˆ¬ä¸ä¼šç›´æ¥ç»™ä½ ä¿¡å™ªæ¯”ï¼Œä¼šç»™ä½ dB\n\nä¾‹é¢˜ï¼š\n\ndB=10ï¼ŒS/N=10\n\ndB=30ï¼ŒS/N=1000  ï¼ˆä¹¦ä¸Šçš„ä¾‹é¢˜ï¼‰\n\n#### å¸¦å®½/ç å…ƒé€Ÿç‡/æ•°æ®é€Ÿç‡å…³ç³»æ¢³ç†\n\n![image-20241126230341540](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/18158d8e5aeca157609ab2784471f6ed697559838.png)\n\n#### è¯¯ç ç‡\n\n![image-20250119224538201](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/12b99b65d64be3b6d025a61903c47249697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20250119224732463](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9879168be1f10c1509600248ad83a307697559838.png)\n\n![image-20250119224917081](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9fb1f86188807156623026d6392d699f697559838.png)\n\n![image-20250119230034073](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/268e8e8ab9f7e78cbf6eac0c7c8cd2d0697559838.png)\n\n![image-20250123172700088](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1ba348efd78bf489448d46132c797aea697559838.png)\n\n![image-20250119231902011](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b601eb2701d9811bb0b531e19939f80b697559838.png)\n\n### ä¿¡é“å»¶è¿Ÿ\n\n<font color='red'>æœ¬èŠ‚æ³¨æ„ï¼šè¿™é‡Œåšé¢˜ä¸å¯å¥—ç”¨å‰é¢æåˆ°çš„å¥ˆå¥æ–¯ç‰¹å®šç†å’Œé¦™æµ“å®šç†ç­‰</font>\n\n![image-20241127221231188](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/87a90de497b45a898afec53570c924e6697559838.png)\n\nä¿¡é“å»¶è¿Ÿçš„è®¡ç®—\n\n![image-20250119232129732](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c34cb53f3501c69f00df6af5b685c565697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20241127221314270](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4fede01bf628f8e0f5f39333978a55cf697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5aaa723dd9af8f6b68f4a252c4cadbb3697559838.png)\n\n![image-20241127221404135](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/183518bff8884f741609f9a821066738697559838.png)\n\n![image-20241127221414000](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0e4576615eb202bc1d59eeb0e3b9dc0f697559838.png)\n\n![image-20250119232312558](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a6b9a09ce24b0c870b40aaa93819098e697559838.png)\n\n![image-20250119233700726](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c21da6b8c60e6397145c887121f84be4697559838.png)\n\n![image-20250119233724307](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6b8b25bd8468ee3dd815fe4e1c584ca9697559838.png)\n\n#### å«æ˜Ÿä¿¡é“å»¶è¿Ÿ\n\n![image-20250119235011991](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3309d2da8112d241d591fe188d7ac9f1697559838.png)\n\n![image-20250119235024560](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ce26a6a0352aac210e0e3600bf7a5252697559838.png)\n\n![image-20250119235037039](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8af095d36e01703a596b90eb7af04f50697559838.png)\n\n### ä¼ è¾“ä»‹è´¨ \n\n#### æ¦‚å¿µ\n\nè¦è®°ä½ï¼š `æ— çº¿ç”µæ³¢:500kHz-1000Mhz`   `å¾®æ³¢:300MHZ-300GHz`\n\n![image-20241129010641477](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cc4959b1243beb032fd48ebf7e1a1cc2697559838.png)\n\n![image-20241129010750953](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d5b6a185af9d9b5baadfa9571711b31d697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20241129010820514](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/62c41c0467ab03b346c670e068a14cb3697559838.png)\n\n#### åŒè½´ç”µç¼†\n\n![image-20250119235626520](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f6bb1cde95e0730429b38be576b84fe4697559838.png)\n\né€šå¸¸æŠŠè¡¨ç¤º` æ•°å­—ä¿¡å· `çš„æ–¹æ³¢æ‰€å›ºæœ‰çš„é¢‘å¸¦ç§°ä¸º`åŸºå¸¦`ï¼Œè¿™ç§ç”µç¼†ä¹Ÿå«`åŸºå¸¦åŒè½´ç”µç¼†`ï¼Œç›´æ¥ä¼ è¾“æ–¹æ³¢ä¿¡å·ç§°ä¸º`åŸºå¸¦ä¼ è¾“`ã€‚\n\n`å®½å¸¦`åŒè½´ç”µç¼†:ç”¨äºä¼ è¾“`æ¨¡æ‹Ÿä¿¡å·`\n\nå®½å¸¦ç³»ç»Ÿçš„ä¼˜ç‚¹æ˜¯`ä¼ è¾“è·ç¦»è¿œ`ï¼Œå¯è¾¾å‡ åå¹²ç±³ï¼Œè€Œä¸”å¯åŒæ—¶æä¾›å¤šä¸ªä¿¡é“ã€‚ç„¶è€Œå’ŒåŸºå¸¦ç³»ç»Ÿç›¸æ¯”ï¼Œå®ƒçš„æŠ€æœ¯æ›´å¤æ‚ï¼Œéœ€è¦ä¸“é—¨çš„å°„é¢‘æŠ€æœ¯äººå‘˜å®‰è£…å’Œç»´æŠ¤ï¼Œå®½å¸¦ç³»ç»Ÿçš„`æ¥å£è®¾å¤‡ä¹Ÿæ›´æ˜‚è´µ`\n\næ¨¡æ‹Ÿä¿¡å·æ¯”æ•°å­—è„‰å†²å—`å™ªå£°å’Œè¡°å‡çš„å½±å“æ›´å°`ï¼Œå¯ä»¥ä¼ æ’­æ›´è¿œçš„è·ç¦»ï¼Œç”šè‡³è¾¾åˆ°100kmã€‚\n\n#### åŒç»çº¿\n\n`ç¼ ç»•ç›®çš„ï¼šé™ä½ä¿¡å·å¹²æ‰°çš„ç¨‹åº¦`\n\n![image-20250120000033391](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/84faf5276a723b69d983e5526db6ed08697559838.png)\n\n![image-20250120000106455](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b9254ae710125172a6fd31bd1643acbd697559838.png)\n\n![image-20241129010932728](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ee7ca6b77ed5dadd8861650d51cc94b2697559838.png)\n\n#### å…‰çº¤\n\n![image-20250120000202260](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/175e1893706c134ec56d9efbfeaa1c3b697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/daee325862d12564182f5a50a353f332697559838.png)\n\n![image-20241129011427160](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1fdd6f828a9bf3483b888886e7451b8c697559838.png)\n\n![image-20250120000339846](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/159dacf92d2620eb4f6ca138fc5f6a84697559838.png)\n\n![image-20250120000420454](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6c63323b4b7cc32a13d114912e1f688d697559838.png)\n\n![image-20241129011452527](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f081e984ca782d62e18a9eabd4e53632697559838.png)\n\n#### è·³çº¿å’Œå°¾çº¤\n\n![image-20241129011641549](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ceef8fc565b1d719fce9c93a5a65eed1697559838.png)\n\nä¾‹é¢˜\n\n![image-20241129011704585](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9b686e723910c854f4b8f18db4114fd3697559838.png)\n\n![image-20241129011746906](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2d0e6ef0655a20bdbf236a9d1ed7911d697559838.png)\n\n![image-20250120000512609](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2b83f62a13c2892daa259d4b72acd35e697559838.png)\n\n![image-20250120000536292](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ff90aa1cc845df6ecf2bce7cff7cc95b697559838.png)\n\n![image-20250120000849324](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bca2388847e8f42ce780365183852a00697559838.png)\n\n### æ•°æ®ç¼–ç \n\n#### æ›¼åˆ‡æ–¯ç‰¹ç¼–ç \n\næ›¼å½»æ–¯ç‰¹ç¼–ç èƒ½ä»æ•°æ®ä¿¡å·æ³¢å½¢ä¸­æå–åŒæ­¥ä¿¡å·ã€‚\n\n![image-20241129175703215](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/228dce459b41abed89a6a7490df4e027697559838.png)\n\n#### å·®åˆ†æ›¼åˆ‡æ–¯ç‰¹ç¼–ç \n\n![image-20241129175854470](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a15a11fbb8a8f0d979e42ad9cb838131697559838.png)\n\n#### ä¸¤ç§æ›¼åˆ‡æ–¯ç‰¹ç¼–å·ç‰¹ç‚¹\n\næ›¼ç å’Œå·®åˆ†æ›¼ç æ˜¯å…¸å‹çš„åŒç›¸ç ï¼ŒåŒç›¸ç è¦æ±‚æ¯ä¸€ä½éƒ½æœ‰ä¸€ä¸ªç”µå¹³è½¬æ¢ï¼Œ`ä¸€é«˜ä¸€ä½`ï¼Œ`å¿…é¡»ç¿»è½¬`ã€‚\næ›¼ç å’Œå·®åˆ†æ›¼ç å…·æœ‰`è‡ªå®šæ—¶`å’Œ`æ£€æµ‹é”™è¯¯`çš„åŠŸèƒ½ã€‚\nä¸¤ç§æ›¼å½»æ–¯ç‰¹ç¼–ç ä¼˜ç‚¹:å°†æ—¶é’Ÿå’Œæ•°æ®åŒ…å«åœ¨ä¿¡å·æ•°æ®æµä¸­ï¼Œä¹Ÿç§°`è‡ªåŒæ­¥ç `ã€‚\nç¼–ç æ•ˆç‡ä½:`ç¼–ç æ•ˆç‡éƒ½æ˜¯50%`\nä¸¤ç§æ›¼ç `æ•°æ®é€Ÿç‡æ˜¯ç å…ƒé€Ÿç‡çš„ä¸€åŠ`ï¼Œå½“æ•°æ®ä¼ è¾“é€Ÿç‡ä¸º100Mbpsæ—¶ï¼Œç å…ƒé€Ÿç‡ä¸º200M baudã€‚\n\n<font color='red'>è¿™é‡Œçš„é«˜äº®å¥å­å¾ˆé‡è¦</font>\n\n#### å…¶ä»–ç¼–ç \n\næ²¡ç‰¹æ®Šè¯´æ˜ã€‚åªè¦çœ‹è§ä»¥å¤ªç½‘å°±æ˜¯10M\n\n![image-20241129180129386](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b83de54cf04db1966b7445fe5931de77697559838.png)\n\n#### ä¾‹é¢˜\n\n![image-20241129180216213](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c47940792df13b4f569efb71dfd48434697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b2a1f338d8fe87181118c8d0fa531fe8697559838.png)\n\n![image-20241129180620381](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2c4e59f8060d0c103ed15db0c2bfd3d1697559838.png)\n\n![image-20241129180637289](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bc0d7b1c00779209e2b4747e7fd7f105697559838.png)\n\n![image-20241129180824240](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/03cb1fae84f6e91e49f23e592d802e38697559838.png)![image-20241129180833924](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bc7f39fb666b55d9874d62fd72b950ba697559838.png)\n\n![image-20250120001039678](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2965fe65d5d038ad3222304ad8472177697559838.png)\n\n### æ•°å­—è°ƒåˆ¶æŠ€æœ¯\n\n![image-20241129210422403](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fe48e71ac3e17768b28816f3e02c60f6697559838.png)\n\n![image-20241129210456827](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fa26193dbcd279603c7724650109da3c697559838.png)\n\n![image-20241129210731252](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7984f0d0b21be2d75f2f687c73cb8a4a697559838.png)\n\n![image-20241129210928728](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6550a257991c1fc5bc769c321a177569697559838.png)\n\n![image-20241129211200886](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/40bbb148f85498305c1a424d58fc6d45697559838.png)\n\n![image-20241210172343452](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/57576e5fb1423718f06e68529b23eade697559838.png)\n\n![image-20250120001147330](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/23f0244aa545df3b6043e067a283fe6c697559838.png)\n\n![image-20250120001231958](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f65458ebd592ae2d7cbad1f173fcea8b697559838.png)\n\n![image-20250119231759706](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ee857eb4fc6db739fd97d8ac49892f60697559838.png)\n\n![image-20250120001400190](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c0879d2b4d8bb76722f58659fd013eb4697559838.png)\n\n### è„‰å†²ç¼–ç è°ƒåˆ¶PCM\n\n<font color='red'>æœ¬èŠ‚æ³¨æ„ï¼šè¿™é‡Œåšé¢˜ä¸å¯å¥—ç”¨å‰é¢æåˆ°çš„å¥ˆå¥æ–¯ç‰¹å®šç†å’Œé¦™æµ“å®šç†ç­‰</font>\n\n![image-20241129233323663](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/91d2ac0e975dc75e1cb0f48a4995a41b697559838.png)\n\n\n\nè¿™é‡Œæœ‰ä¸ªå°çŸ¥è¯†ç‚¹ï¼Œä¸ºä»€ä¹ˆ`è¯­éŸ³æœ€é«˜é¢‘ç‡æ˜¯4kHzï¼Œæ‰€ä»¥å–æ ·é¢‘ç‡æ˜¯8kHz`,å‰é¢æœ‰æåˆ°:\n\næ ¹æ®å¥ˆå¥æ–¯ç‰¹é‡‡æ ·å®šç†ï¼Œä¸ºäº†æ— å¤±çœŸåœ°é‡å»ºä¸€ä¸ªè¿ç»­æ—¶é—´ä¿¡å·ï¼Œé‡‡æ ·é¢‘ç‡(`8K`)å¿…é¡»è‡³å°‘æ˜¯ä¿¡å·æœ€é«˜é¢‘ç‡(`4K`)çš„ä¸¤å€ã€‚è¿™ä¸ªæœ€ä½çš„é‡‡æ ·é¢‘ç‡è¢«ç§°ä¸ºå¥ˆå¥æ–¯ç‰¹é¢‘ç‡ï¼ˆ`8K`ï¼‰ã€‚\n\n![image-20241129233827597](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a6654df2d5d12deac48911fadf1b9975697559838.png)\n\n![image-20241129234338545](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f99bff0b00c2970dd33a4ef84449d349697559838.png)\n\n\n\nä¸ºä»€ä¹ˆè¿™é‡Œä¸ç”¨å‰é¢æåˆ°çš„å¥ˆå¥æ–¯ç‰¹å®šç†å’Œé¦™å†œå®šç†,å› ä¸ºè¿™ä¸¤ä¸ªå®šç†ç®—çš„æ˜¯`æé™å€¼`,è€Œè¿™é‡Œä¸æ˜¯ç®—`æé™å€¼`çš„å“‡\n\n![image-20241129234406969](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c13a2c8e7b8b4b559d4b5465fc211965697559838.png)\n\n![image-20250120001635912](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0aac0bd7ce6ec71165cde9f8086b82d2697559838.png)\n\n### é€šä¿¡å’Œäº¤æ¢æ–¹å¼\n\n#### æ•°æ®é€šä¿¡æ–¹å¼\n\n1. æŒ‰é€šä¿¡æ–¹å‘åˆ†\n\n|  é€šä¿¡æ–¹å¼  | æ¶ˆæ¯ä¼ é€’æ–¹å¼ |       åº”ç”¨å®ä¾‹       |\n| :--------: | :----------: | :------------------: |\n|  å•å·¥é€šä¿¡  | å•å‘ä¸€æ¡ä¿¡é“ | æ— çº¿ç”µå¹¿æ’­ã€ç”µè§†å¹¿æ’­ |\n| åŠåŒå·¥é€šä¿¡ | åŒå‘ä¸€å¤©ä¿¡é“ |        å¯¹è®²æœº        |\n| å…¨åŒå·¥é€šä¿¡ |   ä¸¤æ¡ä¿¡é“   |     å®æ—¶ç”µè¯é€šä¿¡     |\n\n`å•å·¥é€šä¿¡`:ä¿¡æ¯åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¼ é€ï¼Œå‘é€æ–¹ä¸èƒ½æ¥æ”¶ï¼Œæ¥æ”¶æ–¹ä¸èƒ½å‘é€(ç”µè§†/å¹¿æ’­)\n\n`åŠåŒå·¥é€šä¿¡`:é€šä¿¡çš„åŒæ–¹å¯ä»¥äº¤æ›¿å‘é€å’Œæ¥æ”¶ä¿¡æ¯ï¼Œä½†ä¸èƒ½åŒæ—¶æ¥æ”¶æˆ–å‘é€(å¯¹è®²æœº/Wi-Fi/Hub)\n\n`å…¨åŒå·¥é€šä¿¡`:é€šä¿¡åŒæ–¹å¯åŒæ—¶è¿›è¡ŒåŒå‘çš„ä¿¡æ¯ä¼ é€(ç”µè¯/äº¤æ¢æœº)\n\n\n\n2. æŒ‰åŒæ­¥æ–¹å¼åˆ†\n\n![image-20250120001905037](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8e80d424f847eb35a768fda2e5cbcf85697559838.png)\n\n![image-20241130162332434](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c2bc8f8dcf53fb320c824e21a72d2fc9697559838.png)\n\n![image-20250120001937175](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/003b84af7f24f658f01fe875cb00f8e3697559838.png)\n\n![image-20250120002205017](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/245f0d7188b4960950d225027011ca77697559838.png)\n\n#### æ•°æ®äº¤æ¢æ–¹å¼\n\n![image-20250120002440608](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9a2655560350c7676378b404e66e9a93697559838.png)\n\nå…³é”®è¯ï¼šç”µè·¯äº¤æ¢ï¼ŒæŠ¥æ–‡äº¤æ¢ï¼Œåˆ†ç»„äº¤æ¢ï¼Œæ•°æ®æŠ¥ï¼Œè™šç”µè·¯\n\n![image-20241130162751674](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f626b9a8190eecb4da6748fb53e73cbf697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f9cf987d39c1defd5d986f06e8c0e8e0697559838.png)\n\n![image-20250120002341860](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/184485c076f55117e23b0d06f9f0d796697559838.png)\n\n![image-20250120002418556](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6c7dc4b44e5c1c55a6248797a7276ec1697559838.png)\n\n![image-20250120002457147](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/13fa6b1eb0eb1685d7c9578e48bb780f697559838.png)\n\n### å¤šè·¯å¤ç”¨æŠ€æœ¯\n\n#### å¤šè·¯å¤ç”¨æŠ€æœ¯\n\nå¤šè·¯å¤ç”¨æŠ€æœ¯æ˜¯æŠŠå¤šä¸ª`ä½é€Ÿä¿¡é“`ç»„åˆæˆä¸€ä¸ª`é«˜é€Ÿä¿¡é“`çš„æŠ€æœ¯\n\nå…‰çº¤å…¥æˆ·:ä¸Šç½‘ã€ç”µè§†ã€ç”µè¯ã€‚\n\n![image-20241120204240470](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bb17b1dfa474bfbc6435cfdaed14ac31697559838.png)\n\nè¿™ç§æŠ€æœ¯è¦ç”¨åˆ°ä¸¤ä¸ªè®¾å¤‡ï¼š\n\n![image-20241130174353895](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/290fc51bc2512a600b36f19393d8a758697559838.png)\n\n#### é¢‘åˆ†å¤ç”¨ï¼ˆFDMï¼‰\n\nåœ¨ä¸€æ¡ä¼ è¾“ä»‹è´¨ä¸Šä½¿ç”¨å¤šä¸ªé¢‘ç‡ä¸åŒçš„æ¨¡æ‹Ÿè½½æ³¢ä¿¡å·è¿›è¡Œå¤šè·¯ä¼ è¾“ï¼Œé€šè¿‡ä¸åŒçš„é¢‘ç‡æ¥åŒºåˆ†ä¸åŒçš„ä¸šåŠ¡\n\n![image-20241130174704632](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/682b0d118e0a87cd1159cf3634689be3697559838.png)\n\n#### æ—¶åˆ†å¤ç”¨ï¼ˆTDMï¼‰\n\nä»¥ä¿¡é“çš„ä¼ è¾“æ—¶é—´ä½œä¸ºåˆ†å‰²å¯¹è±¡(åˆ’åˆ†æ—¶é—´ç‰‡)æ¥å®ç°çš„å¤ç”¨ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®æ—¶é—´ç‰‡æ˜¯å¦å›ºå®šåˆ†é…ï¼Œåˆ†ä¸º`åŒæ­¥æ—¶åˆ†å¤ç”¨æŠ€æœ¯`å’Œ`ç»Ÿè®¡æ—¶åˆ†å¤ç”¨æŠ€æœ¯`ã€‚\n\n`åŒæ­¥æ—¶åˆ†å¤ç”¨`\n\n![image-20241130175025105](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5d842de44c4d6189f6abd3d8983144df697559838.png)\n\n`ç»Ÿè®¡æ—¶åˆ†å¤ç”¨`\n\n![image-20250120002755035](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/90e1e8b86442b7e024cf30ab63c39060697559838.png)\n\n#### E1å’ŒT1\n\nåŒæ­¥æ—¶åˆ†å¤ç”¨æŠ€æœ¯çš„åº”ç”¨ï¼ˆä¸‹é¢æœ‰è€ƒç‚¹ï¼‰\n\n![image-20241130180003778](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/040c5f1b48e8abaca17f49160ab78d62697559838.png)\n\n#### æ³¢åˆ†å¤ç”¨ï¼ˆWDMï¼‰\n\n![image-20241130175327973](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dae627e45b57bb843eff5ac966fe4327697559838.png)\n\n![image-20250120003009199](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/01724da0c232f00ff3c69f4d2da086e6697559838.png)\n\n![image-20250120003030950](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d94919831c2a65c68c2e2eeb25fa40ca697559838.png)\n\n![image-20250120003113578](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b4289fc865d2b5e6300779c2bece584c697559838.png)\n\n![image-20250120003138571](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2a1ebe629a86bdde0b34751c19aaed41697559838.png)\n\n#### åŒæ­¥æ•°å­—ç³»åˆ—\n\nâ€‹             `SONET/SDHå¤šè·¯å¤ç”¨çš„é€Ÿç‡ï¼ˆæ—¶åˆ†å¤ç”¨ï¼‰`\n\n![image-20241130180134405](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c4a8bdba63679fd670763df57aa05a2c697559838.png)\n\n#### è€ƒç‚¹\n\n`è€ƒæ³•1`ï¼š\n\n![image-20241120210212913](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f3af19b3cbee2113bff17a248731df0c697559838.png)\n\n`è€ƒæ³•2`ï¼š\n\n| åç§°   | æŠ€æœ¯åŸç†     | è½½æ³¢é€Ÿç‡  | å­ä¿¡é“ | ä¼ é€ä¸€å¸§çš„æ—¶é—´ | æ¯ç§’é’Ÿä¼ å¤šå°‘ä¸ªå¸§         | å­ä¿¡é“æ•°æ®é€Ÿç‡     |\n| ------ | ------------ | --------- | ------ | -------------- | ------------------------ | ------------------ |\n| E1è½½æ³¢ | åŒæ­¥æ—¶åˆ†å¤ç”¨ | 2.048Mbps | 32ä¸ª   | 125Î¼s          | 8000b/sï¼ˆ1b/125Î¼s=8000ï¼‰ | 64kbps (8bit*8000) |\n| T1è½½æ³¢ | åŒæ­¥æ—¶åˆ†å¤ç”¨ | 1.544Mbps | 24ä¸ª   | 125Î¼s          | 8000b/sï¼ˆ1b/125Î¼s=8000ï¼‰ | 56kbps (7bit*8000) |\n\n#### ä¾‹é¢˜\n\n![image-20241130180202781](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/623e083dbf6ded105cdd0192ed6b2c18697559838.png)\n\n ![image-20241130180222892](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/29e6d19e38f12ebb4ff5722516a79031697559838.png)\n\n![image-20241130180231724](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eb061a689da3defed0c29b09a81fe052697559838.png)\n\n![image-20241130180349190](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f88918a799df6ba1a3172beb820e8850697559838.png)\n\n![image-20250120004055447](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/83836c2e0a2de71f0c4a0b6a5620039e697559838.png)\n\n### æµ·æ˜ç çº é”™ç \n\n#### å·®é”™æ§åˆ¶\n\n![image-20241130225057731](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/084e03e05ecc4d2055221affad0a3edb697559838.png)\n\n#### å¥‡å¶æ ¡éªŒ\n\n![image-20241130225247357](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/714d650a0241bcffb3a7a0b79acd50e0697559838.png)\n\n![image-20250120004213514](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/adee5b079eb3baf1cbcf96c71253dc02697559838.png)\n\n![image-20250120004308685](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7ac26dd58932dd0d5e3524e60911fe36697559838.png)\n\n#### æµ·æ˜ç \n\n![image-20241130225408077](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d9e6140661e43e5a712b113a920f7abb697559838.png)\n\n![image-20241130225434337](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/38b45c6fb00d35b9e8382d7cafb9c1c4697559838.png)\n\n#### æµ·æ˜ç åŸç†\n\n![image-20241130225523883](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/201ab695cbb4dbec1c6d6f48ce5a61c0697559838.png)\n\n#### æµ·æ˜ç ç¼–ç â­ï¸\n\n![image-20241130232204073](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/be1659d999601c4047f2d7e961a69231697559838.png)\n\n![image-20241130235116614](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5f2f82e5b57f2bff3d91cb634e78eb70697559838.png)\n\n#### ä¾‹é¢˜\n\n![image-20241130235200782](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eaaa8ab8c7424f51bbb036bfd0fd4e70697559838.png)\n\n![image-20241130235224442](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/84ee5748211429527cbb0899226650d3697559838.png)\n\n![image-20250120005245637](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7d289544a808da2ca5ce9fc3896a349d697559838.png)\n\n![image-20250120005349706](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7840e6b9bd2a807c8d78edf834ab1db7697559838.png)\n\n![image-20250120010026219](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/de8bd8c7537c3c191c1df6c645131d7e697559838.png)\n\n### CRCå¾ªç¯å†—ä½™æ ¡éªŒç \n\næœ«å°¾åŠ å…¥CRCå¾ªç¯å†—ä½™æ ¡éªŒç èƒ½`æ£€é”™ä¸èƒ½çº é”™`ï¼Œå¹¿æ³›ç”¨äºç½‘ç»œé€šä¿¡å’Œç£ç›˜å­˜å‚¨ã€‚\n\nä»¥ä¸‹æˆ‘ä»¬é‡‡ç”¨ä¾‹é¢˜æ¥äº†è§£ï¼š\n\n1.é‡‡ç”¨CRCè¿›è¡Œå·®é”™æ ¡éªŒï¼Œç”Ÿæˆå¤šé¡¹å¼ä¸ºG(X)=X^4^+X+1ï¼Œä¿¡æ¯ç å­—ä¸º10111ï¼Œåˆ™è®¡ç®—å‡ºCRCæ ¡éªŒç æ˜¯()ã€‚\nA.0000 B.0100 C.0010 D.1100\n\nè§£ï¼š\n\n`1`.åˆ¤æ–­æ ¡éªŒä½æ•°:ç”Ÿæˆå¤šé¡¹å¼çš„`æœ€é«˜æ¬¡æ–¹`æ˜¯å‡ ï¼Œæ ¡éªŒä½å°±æ˜¯å‡ ä½ã€‚<font color='red'>4ä½æ£€éªŒä½</font>\n\nå› ä¸ºG(X)=X^4^+X+1 ä¸­ x^4^æœ‰æœ€é«˜æ¬¡æ–¹æ˜¯4ï¼Œé‚£ä¹ˆåˆ°æ—¶å€™ç®—å‡ºæ¥çš„`CRCæ ¡éªŒç `ä¹Ÿä¼šæ˜¯`å››ä½`\n\nä¸€èˆ¬é€‰é¡¹ä¼šå‡ºç°ä¸å›ºå®šæ•°å­—çš„æ ¡éªŒç ï¼Œè¿™æ—¶å€™ä½ å°±è¦çœ‹ï¼Œæœ€é«˜æ¬¡æ–¹ï¼Œæ’é™¤ä¸ç¬¦åˆçš„é€‰é¡¹\n\n\n\n`2`.ç»„åˆè¢«é™¤æ•°  `ä¿¡æ¯ç å­—+æ£€éªŒä½`   ==10111<font color='red'>0000</font>\n\nç¬¬ä¸€æ­¥çœ‹å‡ºæœ‰å¤šå°‘ä½æ ¡éªŒä½å°±åœ¨ä¿¡æ¯ç å­—åè¡¥å¤šå°‘ä¸ª0\n\n\n\n`3`.å¯»æ‰¾é™¤æ•°==æå–å¤šé¡¹å¼çš„ç³»æ•°\n\n![image-20241201152735569](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a6212c29b440a211f1bad811e93d225c697559838.png)\n\n\n\n`4`.ç”¨ç¬¬äºŒæ­¥çš„ç»“æœï¼Œé™¤ä»¥ç¬¬ä¸‰æ­¥çš„ç»“æœ(<font color='red'>å¼‚æˆ–è¿ç®—</font>) <font color='red'>ä½™æ•°å°±æ˜¯CRCæ ¡éªŒç ï¼Œä½™æ•°ä¸å¤Ÿä½ï¼Œå‰é¢è¡¥0</font>\n\n![image-20241201153600703](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/53df1f8ef4d0003e294e4ee0fdc822f2697559838.png)\n\n![image-20250120004459559](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/07439938668cc131222a7cf455513eab697559838.png)\n\n#### ä¾‹é¢˜\n\n![image-20241201153853385](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c36e9a39d936ecde6a6cee4a758b1eb0697559838.png)\n\n![image-20241201153954545](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/234c652bbf4de814e706cd021ba671ba697559838.png)\n\n![image-20250120004938343](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/66c650e5ce949ce95ffcb2b342291677697559838.png)\n\n### ç« èŠ‚æ€»ç»“\n\n![image-20241130235409017](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6875ad5c5a081ba140ff274af312ef59697559838.png)\n\n![image-20241130235415893](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5fc331d9886d24269d4804e3e8bda9cd697559838.png)\n\n## å±€åŸŸç½‘\n\n### å±€åŸŸç½‘æŠ€æœ¯æ¦‚è®º\n\n#### ç»“æ„\n\n![image-20250120152920993](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/14831e0a4d4e755c1cfa213cb2f4a9f6697559838.png)\n\næ—©æœŸç»„ç½‘ä½¿ç”¨é›†çº¿å™¨ç»„ç½‘ï¼Œç°åœ¨éƒ½æ˜¯äº¤æ¢æœºï¼Œç°åœ¨çœŸæ­£åº”ç”¨å¹¿æ³›çš„æ˜¯æ ‘å½¢å’Œæ··åˆå‹\n\n![image-20241201172424111](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/25e633bc17adaf71c0e230b56fe83dae697559838.png)\n\nä¼ ç»Ÿå±€åŸŸç½‘æ˜¯åˆ†ç»„å¹¿æ’­å¼ç½‘ç»œï¼Œè¿™æ˜¯ä¸åˆ†ç»„äº¤æ¢å¼çš„å¹¿åŸŸç½‘çš„ä¸»è¦åŒºåˆ«\n\n### CSMA/CD\n\n`CSMAåŸºæœ¬åŸç†`:å‘é€æ•°æ®ä¹‹å‰ï¼Œå…ˆç›‘å¬ä¿¡é“ä¸Šæ˜¯å¦æœ‰äººåœ¨å‘é€ã€‚è‹¥æœ‰ï¼Œè¯´æ˜ä¿¡é“æ­£å¿™ï¼Œå¦åˆ™è¯´æ˜ä¿¡é“æ˜¯ç©ºé—²çš„ï¼Œç„¶åæ ¹æ®`é¢„å®šçš„ç­–ç•¥`å†³å®š:\n(1)è‹¥ä¿¡é“ç©ºé—²ï¼Œæ˜¯å¦ç«‹å³å‘é€ã€‚\n(2)è‹¥ä¿¡é“å¿™ï¼Œæ˜¯å¦ç»§ç»­ç›‘å¬\nå¦‚æœè¿ç»­å‘ç”Ÿ`16æ¬¡`ç¢°æ’åï¼Œè®¤ä¸º`ç½‘ç»œç¹å¿™æˆ–æ•…éšœ`ï¼Œä¸å†å°è¯•å‘é€ã€‚\n\n#### CSMAä¸‰ç§ç›‘å¬ç®—æ³•\n\n![image-20241201191331171](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eb1cf68c60883d23fc825685c1700d24697559838.png)\n\n(1)`éåšæŒå‹ç›‘å¬ç®—æ³•`:åé€€éšæœºæ—¶é—´ç”±äºéšæœºæ—¶å»¶åé€€ï¼Œä»è€Œ`å‡å°‘äº†å†²çªçš„æ¦‚ç‡`ã€‚é—®é¢˜æ˜¯å› ä¸ºåé€€è€Œä½¿ä¿¡é“é—²ç½®ä¸€æ®µæ—¶é—´ï¼Œè¿™ä½¿`ä¿¡é“çš„åˆ©ç”¨ç‡é™ä½`ï¼Œè€Œä¸”`å¢åŠ äº†å‘é€æ—¶å»¶`\n\n(2`1-åšæŒå‹ç›‘å¬ç®—æ³•`:ç»§ç»­ç›‘å¬ï¼Œä¸ç­‰å¾…æœ‰åˆ©äºæŠ¢å ä¿¡é“ï¼Œå‡å°‘ä¿¡é“ç©ºé—²æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå¤šä¸ªç«™åŒæ—¶éƒ½åœ¨ç›‘å¬ä¿¡é“æ—¶å¿…ç„¶ä¼šå‘ç”Ÿå†²çªã€‚`å†²çªæ¦‚ç‡å’Œåˆ©ç”¨ç‡éƒ½é«˜(åŒé«˜)`\n\n(3)`P-åšæŒå‹ç›‘å¬ç®—æ³•`:è‹¥ä¿¡é“ç©ºé—²ï¼Œä»¥æ¦‚ç‡På‘é€ï¼Œä»¥æ¦‚ç‡(1-P)å»¶è¿Ÿä¸€ä¸ªæ—¶é—´å•ä½ï¼ŒPå¤§å°å¯è°ƒæ•´ã€‚\n\n![image-20241201191518523](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/49a052daccd43be24867c103a70efc32697559838.png)\n\n![image-20241201191537398](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4d5e903d45f10543876e62435e227219697559838.png)\n\n#### å†²çªæ£€æµ‹åŸç†CD\n\nè½½æ³¢ç›‘å¬åªèƒ½`å‡å°å†²çªçš„æ¦‚ç‡,ä¸èƒ½å®Œå…¨é¿å…å†²çª`ã€‚å½“ä¸¤ä¸ªå¸§å‘ç”Ÿå†²çªåï¼Œ`è‹¥ç»§ç»­å‘é€ï¼Œå°†ä¼šæµªè´¹ç½‘ç»œå¸¦å®½`ã€‚ä¸ºäº†æ”¹è¿›å¸¦å®½åˆ©ç”¨ç‡ï¼Œå‘é€ç«™åº”é‡‡å–`è¾¹å‘è¾¹å¬`çš„å†²çªæ£€æµ‹æ–¹æ³•ï¼Œå³\n\n(1)å‘é€æœŸé—´åŒæ—¶æ¥æ”¶ï¼Œå¹¶æŠŠæ¥æ”¶çš„æ•°æ®ä¸ç«™ä¸­å­˜å‚¨çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒã€‚\n(2)è‹¥æ¯”è¾ƒç»“æœä¸€è‡´ï¼Œè¯´æ˜æ²¡æœ‰å†²çªï¼Œé‡å¤(1)ã€‚\n(3)è‹¥æ¯”è¾ƒç»“æœä¸ä¸€è‡´ï¼Œè¯´æ˜`å‘ç”Ÿäº†å†²çªï¼Œç«‹å³åœæ­¢å‘é€`,å¹¶å‘é€ä¸€ä¸ªç®€çŸ­çš„`å¹²æ‰°ä¿¡å·(Jamming)`ä½¿æ‰€æœ‰ç«™éƒ½åœæ­¢å‘é€ã€‚\n(4)å‘é€Jammingä¿¡å·åï¼Œ`ç­‰å¾…ä¸€æ®µéšæœºé•¿çš„æ—¶é—´`ï¼Œé‡æ–°ç›‘å¬ï¼Œå†è¯•ç€å‘é€ã€‚\n\n> - å¯¹æ€»çº¿å‹ã€æ˜Ÿå‹å’Œæ ‘å‹æ‹“æ‰‘è®¿é—®æ§åˆ¶åè®®æ˜¯`CSMA/CD`(Carrier Sense Multiple Access/ColisionDetectionï¼Œè½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®/å†²çªæ£€æµ‹)\n>\n> - å¸¦å†²çªæ£€æµ‹çš„ç›‘å¬ç®—æ³•æŠŠ`æµªè´¹å¸¦å®½çš„æ—¶é—´å‡å°‘åˆ°æ£€æµ‹å†²çªçš„æ—¶é—´ã€‚`\n\n![image-20241201191825014](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a3c7b0aee74640e71dcf8206fb677517697559838.png)\n\n![image-20250120153419358](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ef5cecf31e06fe04a900c2942d6789fa697559838.png)\n\n![image-20250120153452669](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5a869fb7dce3f0fb75dd4bb5f8273f69697559838.png)\n\n![image-20250120153816784](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5f8403207e1b5a1036500683ed0671b2697559838.png)\n\n### äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•\n\n![image-20250120153852322](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/86284acd56910f9dbb51b3ef6092af0a697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20241201195052699](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/64fbc050af0952f98dae956fb3552505697559838.png)\n\n![image-20241201195103352](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/936776fbbcaef98e7e5d85dc1bb0bdc4697559838.png)\n\n![image-20241201195130723](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0b2d501be560082b87e4420219d488ae697559838.png)\n\n![image-20241201195216099](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/48409bb4472adb50e1220bbc8b1a094d697559838.png)\n\n![image-20250120154109981](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/485e2fe53fe6cb2730f14a067de3f476697559838.png)\n\n![image-20250120154641777](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/788415aee50003ab6007ae92150a2dc3697559838.png)\n\n### æœ€å°å¸§é•¿è®¡ç®—\n\n![image-20250120154704710](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/07e4eaebb64869957c1859827ea999a5697559838.png)\n\n![image-20241210180641626](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0b567393fb17ea8cf5f039ffd11cf23e697559838.png)\n\n![image-20250120154757034](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1bb9741514a7d25c43013e336c0d731a697559838.png)\n\n![image-20250120155607705](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/376b2c9e591f52da741955aa8c1ff104697559838.png)\n\n![image-20250120155628203](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3fc73cda9a1fbaec1a89d070ae6fee33697559838.png)\n\n### ä»¥å¤ªç½‘å¸§\n\nä»¥å¤ªç½‘ç¡¬ä»¶åœ°å€ï¼ˆMACåœ°å€ï¼Œä¸æ˜¯å¸§å“¦ï¼‰çš„ä½æ•°æ˜¯48ä½ã€‚ä¾‹å¦‚ï¼š`00:1A:2B:3C:4D:5E`\n\nå‰é¢7+1å­—èŠ‚ç”¨äºæ—¶é’ŸåŒæ­¥ï¼Œä¸ç®—å…¥å¸§é•¿ã€‚\n\næ•°æ®46-1500å­—èŠ‚ï¼Œä¸å¤Ÿè‡³å°‘å¡«å……åˆ°46å­—èŠ‚ã€‚\n\næ ¡éªŒä½4å­—èŠ‚ï¼ŒCRCå¾ªç¯å†—ä½™æ ¡éªŒ 32ä½ã€‚\n\næœ€å°å¸§é•¿`64å­—èŠ‚`:6+6+2+46+4=64    ï¼ˆä»ç›®çš„åœ°å€å¼€å§‹å¾€åç®—ï¼‰\n\næœ€å¤§å¸§é•¿`1518å­—èŠ‚`:6+6+2+1500+4=1518.   ï¼ˆä»ç›®çš„åœ°å€å¼€å§‹å¾€åç®—ï¼‰\n\n![image-20250301185415386](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/433deacf32c9132b080835ebbe83e9aa55933597.png)\n\nè€ƒæ³•ï¼š\n\n1.ç®€å•ç›´ç™½çš„é—®ä½ ï¼Œæœ€å¤§å¸§é•¿å’Œæœ€å°å¸§é•¿æ˜¯å¤šå°‘\n\n2.é—®ä½ ç¡®è®¤å¸§æ˜¯å¤šå°‘ï¼Œæœ€å°çš„64å­—èŠ‚ï¼Œæœ€å¤§1518å­—èŠ‚\n\n3.ä»¥å¤ªç½‘æœ€å¤§åˆ©ç”¨ç‡=1500/1518   æœ€å°åˆ©ç”¨ç‡=46/64   å°±ä¼ è¾“çš„æ•°æ®é™¤ä»¥æœ€å¤§çš„å¸§é•¿\n\n\n\n**ä»¥å¤ªç½‘æŠ¥æ–‡å°è£…**\n\n![image-20241201213518010](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4ef9610756110c67eac443200ae73be9697559838.png)\n\n1.ä»¥å¤ªç½‘æŠ¥å¤´æ˜¯\n\n![image-20250120160109048](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3692f60638fb17b144927cb9744c77f1697559838.png)\n\n2.åœ¨MTUé‡Œï¼Œæœ€å°å­—èŠ‚æ˜¯20+20+6å­—èŠ‚ï¼Œå› ä¸ºæ•°æ®æ®µï¼ˆMTUæ®µï¼‰æ˜¯æœ€å°æ˜¯46å­—èŠ‚\n\n\n\næ‰©å±•çŸ¥è¯†ï¼š\n\nIPæŠ¥å¤´å’ŒTCPæŠ¥å¤´å„è‡ªæœ€å¤§çš„å­—èŠ‚éƒ½æ˜¯60å­—èŠ‚ï¼Œæ ‡å‡†æ˜¯20å­—èŠ‚\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20241201214104667](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7059ee257e2c998513b4ff66db6eba42697559838.png)\n\n![image-20241201214211745](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d05d6f9971075c1d5d4f3fadac799074697559838.png)\n\n![image-20241201214231695](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cabbd4d298983a0cc636fb5dc12b1ad6697559838.png)\n\n![image-20250120160236376](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/46c347a27f7bfd639dd9988e352d18b3697559838.png)\n\n![image-20250301184943193](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4b4cd669ade517519bb8ba1f00c13c1c55933597.png)\n\n![image-20250301185004004](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a4da5decb3c5b0e6f65cce056d10cee055933597.png)\n\n### ä»¥å¤ªç½‘ç‰©ç†å±‚è§„èŒƒ\n\nä»¥ä¸‹æ‰€æœ‰çš„è¡¨æ ¼éƒ½è¦è®°ä½\n\n#### 802.3ä»¥å¤ªç½‘(10M)\n\n![image-20250120160746397](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f8e7bed30744d65fe1dc43b6135bf44e697559838.png)\n\n#### å¿«é€Ÿä»¥å¤ªç½‘802.3u(100M)\n\n![image-20250120160817387](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d5a06f388ec478b2a6ff81ccc0418f64697559838.png)\n\n![image-20241202192925787](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/87dd9d93e65ccf1f15af28e70bf2a25d697559838.png)\n\n![image-20241202193608658](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8301da98dfd0f18dd643c52dbb1751f5697559838.png)\n\n#### å¹²å…†ä»¥å¤ªç½‘(1000M)\n\n![image-20250120160926228](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/179d3eb97891065e3ac5f115361fc140697559838.png)\n\n`ç¼–ç æ€»ç»“`\n\nå…³é”®å­—ï¼š8B/10B,4D-PAM5,64B,66B,MLT-3,8B/6T\n\n![image-20250120160957784](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7cc36dc9afe3299e61e5e9003169a36e697559838.png)\n\n![image-20250120161335795](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/49d7f188c4fef42dd7157d1c0ed24911697559838.png)\n\n![image-20241202193940207](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/01389b17709911c9ad605a8b7a6c48ed697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ff122820b7810c0cd62a59cfc204459c697559838.png)\n\n![image-20250120161416746](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0cb77bae06847b5fdda69de3abd74d22697559838.png)\n\n#### ä¸‡å…†ä»¥å¤ªç½‘802.3ae(10G)\n\n![image-20250120161501157](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/92de720dd60c864159e212d059ff47df697559838.png)\n\n![image-20250120161925494](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ebaf89bd4a54d0f7622908d80d846b77697559838.png)\n\n![image-20241202194121542](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b726266c1991a1a046fb013309cd71dd697559838.png)\n\n![image-20241202194144377](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/09bbf730f681ad07f4200dc755dae36a697559838.png)\n\n### VLAN\n\n#### VlanåŸºç¡€\n\nè™šæ‹Ÿå±€åŸŸç½‘(Virtual Local Area Netwokï¼ŒVLAN)\n\næ ¹æ®ç®¡ç†åŠŸèƒ½ã€ç»„ç»‡æœºæ„æˆ–åº”ç”¨ç±»å‹å¯¹äº¤æ¢å±€åŸŸç½‘è¿›è¡Œåˆ†æ®µè€Œå½¢æˆçš„<font color='red'>é€»è¾‘ç½‘ç»œ</font>ã€‚\n\nä¸åŒVLANé€šä¿¡å¿…é¡»ç»è¿‡ä¸‰å±‚è®¾å¤‡:<font color='red'>è·¯ç”±å™¨(è€ƒç‚¹æœ€å¤š)</font>ã€ä¸‰å±‚äº¤æ¢æœºã€é˜²ç«å¢™ç­‰ã€‚\n\n\n\n> <font color='red'>å†²çªåŸŸå’Œå¹¿æ’­åŸŸ:</font>\n>\n> `ä¸€ä¸ªä¸­ç»§å™¨å’Œé›†çº¿å™¨æ˜¯ä¸€ä¸ªå†²çªåŸŸ`\n>\n> `ç½‘æ¡¥/äº¤æ¢æœºçš„ä¸€ä¸ªæ¥å£ä¸ºä¸€ä¸ªå†²çªåŸŸ`\n>\n> `ä¸€ä¸ªVLANä¸ºä¸€ä¸ªå¹¿æ’­åŸŸï¼Œäº¤æ¢æœºé»˜è®¤æ‰€æœ‰æ¥å£éƒ½åœ¨VLAN 1`\n>\n> `è·¯ç”±ä¸€ä¸ªæ¥å£å°±æ˜¯å¹¿æ’­åŸŸ`\n\n#### å†²çªåŸŸ\n\n![image-20241202222046003](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/89752dac937b8afceb580bb2b49abdbf697559838.png)\n\n#### å¹¿æ’­åŸŸ\n\n![image-20241202222642381](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c0f2bc3e65b50166dc486ac67ef49a12697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20241202224809857](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/18e9ee19b60916bba115da45e3dbd888697559838.png)\n\n#### äº¤æ¢æœºVLANåˆ’åˆ†\n\né™æ€åˆ’åˆ†VLAN:<font color='red'>åŸºäºäº¤æ¢æœºç«¯å£</font>ã€‚\n\nåŠ¨æ€åˆ’åˆ†VLAN:<font color='red'>åŸºäºMACåœ°å€ã€åŸºäºç­–ç•¥ã€åŸºäºç½‘ç»œå±‚åè®®ã€åŸºäºç½‘ç»œå±‚åœ°å€</font>ã€‚\n\n![image-20241202225027051](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/efb16017cb63683f2c501cd159abba0a697559838.png)\n\n#### vlanåˆ’åˆ†é…ç½®\n\nç®€å•äº†è§£ä¸€ä¸‹ï¼Œåé¢è¿˜ä¼šè®²\n\n![image-20241202225202514](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9c137e4770d9cd109f403be42e77d887697559838.png)\n\n#### VLANä½œç”¨\n\n(1)`æ§åˆ¶ç½‘ç»œæµé‡`ã€‚ä¸€ä¸ªVLAN å†…éƒ¨çš„é€šä¿¡(åŒ…æ‹¬å¹¿æ’­é€šä¿¡)ä¸ä¼šè½¬å‘åˆ°å…¶ä»–VLAN ä¸­å»ï¼Œä»è€Œæœ‰åŠ©äºæ§åˆ¶å¹¿æ’­é£æš´ï¼Œå‡å°å†²çªåŸŸï¼Œ`æé«˜ç½‘ç»œå¸¦å®½çš„åˆ©ç”¨ç‡`ã€‚\n\n(2)`æé«˜ç½‘ç»œçš„å®‰å…¨æ€§`ã€‚å¯ä»¥é€šè¿‡é…ç½®VLAN ä¹‹é—´çš„è·¯ç”±æ¥æä¾›å¹¿æ’­è¿‡æ»¤ã€å®‰å…¨å’Œæµé‡æ§åˆ¶ç­‰åŠŸèƒ½ã€‚\nä¸åŒVLAN ä¹‹é—´çš„é€šä¿¡å—åˆ°é™åˆ¶ï¼Œ`æé«˜äº†ä¼ä¸šç½‘ç»œçš„å®‰å…¨æ€§`ã€‚\n\n(3)`çµæ´»çš„ç½‘ç»œç®¡ç†`ã€‚VLAN æœºåˆ¶ä½¿å¾—å·¥ä½œç»„å¯ä»¥`çªç ´åœ°ç†ä½ç½®çš„é™åˆ¶è€Œæ ¹æ®ç®¡ç†åŠŸèƒ½æ¥åˆ’åˆ†`ã€‚å¦‚æœæ ¹æ®MAC åœ°å€åˆ’åˆ†VLANï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æ¥å…¥äº¤æ¢ç½‘ç»œï¼Œå®ç°ç§»åŠ¨åŠå…¬ã€‚\n\n#### 802.1Qæ ‡ç­¾\n\n802.1Q æ ‡ç­¾å­—æ®µï¼Œé‡ç‚¹æŒæ¡`PRI`å’Œ`VID`ã€‚\n\n`PRI(3 ä½)`:Priorityè¡¨ç¤ºä¼˜å…ˆçº§ï¼Œæä¾›0~7å…±`8ä¸ªä¼˜å…ˆçº§`ï¼Œå½“æœ‰å¤šä¸ªå¸§ç­‰å¾…å‘é€æ—¶ï¼ŒæŒ‰ä¼˜å…ˆçº§é¡ºåºå‘é€æ•°æ®åŒ…ã€‚\n\n`VID(12 ä½)`:å³VLAN æ ‡è¯†ç¬¦ï¼Œæœ€å¤šå¯ä»¥è¡¨ç¤º2^12^=4096ä¸ªVLANï¼Œå…¶ä¸­VID0ç”¨äºè¯†åˆ«ä¼˜å…ˆçº§,VID 4095 ä¿ç•™æœªç”¨ï¼Œæ‰€ä»¥æœ€å¤šå¯é…ç½®`4094`ä¸ªVLANï¼ˆ1-4094ï¼‰ã€‚`é»˜è®¤ç®¡ç†VLANæ˜¯1,ä¸èƒ½åˆ é™¤`ã€‚\n\n`äº¤æ¢æœºæ·»åŠ å’Œåˆ é™¤VLANæ ‡ç­¾çš„è¿‡ç¨‹ç”±ä¸“ç”¨ç¡¬ä»¶è‡ªåŠ¨å®ç°ï¼Œå¤„ç†é€Ÿåº¦å¾ˆå¿«ï¼Œä¸ä¼šå¼•å…¥å¤ªå¤§çš„å»¶è¿Ÿã€‚`\n\nä»ç”¨æˆ·è§’åº¦çœ‹ï¼Œæ•°æ®æºäº§ç”Ÿæ ‡å‡†çš„ä»¥å¤ªå¸§ï¼Œç›®æ ‡æ¥æ”¶çš„ä¹Ÿæ˜¯æ ‡å‡†çš„ä»¥å¤ªå¸§ï¼Œ`VLANæ ‡è®°å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚`\n\nä»¥ä¸‹æ˜¯åœ¨ä»¥å¤ªç½‘å¸§çš„åŸºç¡€ä¸ŠåŠ äº†ä¸€ä¸ªæ ‡ç­¾æ®µ\n\næœ€å°å¸§é•¿54å­—èŠ‚\n\n![image-20241202225742170](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d8d9e7030cc9368d0bb843d35776be64697559838.png)\n\n#### äº¤æ¢æœºç«¯å£ç±»å‹\n\n`Accessæ¥å£`:åªèƒ½ä¼ é€å•ä¸ªVLANæ•°æ®ï¼Œä¸€èˆ¬ç”¨äºè¿æ¥PC/æ‘„åƒå¤´ç­‰ç»ˆç«¯ã€‚\n`Trunkæ¥å£`:èƒ½ä¼ é€å¤šä¸ªVLANæ•°æ®ï¼Œä¸€èˆ¬ç”¨äºäº¤æ¢æœºä¹‹é—´äº’è”ã€‚\nHybridæ¥å£:æ··åˆæ¥å£ï¼ŒåŒ…å«accesså’Œtrunkå±æ€§ã€‚\nQinQ:åŒå±‚æ ‡ç­¾ï¼Œä¸€èˆ¬ç”¨äºè¿è¥å•†åŸåŸŸç½‘ã€‚\n\n![image-20250120162307198](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7f75ef548d51ce794f4fff232a6e34f9697559838.png)\n\nä¾‹é¢˜\n\n![image-20241202225913912](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eea8e73917d1b3ea2aa6753a2e90f3bb697559838.png)\n\n![image-20241202225926858](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9f4eb46f7ee3b1af9e760d22072bae75697559838.png)\n\n![image-20241202225945929](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/41301a8ca81e7c68ec1a2e4fc80bcfee697559838.png)\n\n![image-20241202230054681](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c2fe5bffe6511d2818d0bb1ae9909309697559838.png)\n\n### ç”Ÿæˆæ ‘åè®®STP\n\n#### ç”Ÿæˆæ ‘èƒŒæ™¯\n\n![image-20241203212437360](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5018fa6fbd0789b8cc2c697eff17c9f9697559838.png)\n\n![image-20241203212457427](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2149b196497a4b8a699d65186fbe0c12697559838.png)\n\näºŒå±‚ç¯è·¯é—®é¢˜-å¹¿æ’­é£æš´\n\n![image-20250120162959091](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/53c1daaf59ab61e59bed0ce0b9742589697559838.png)\n\nç½‘ç»œä¸­è‹¥å­˜åœ¨äºŒå±‚ç¯è·¯ï¼Œä¸€æ—¦å‡ºç°å¹¿æ’­æ•°æ®å¸§ï¼Œè¿™äº›æ•°æ®å¸§å°†è¢«äº¤æ¢æœºä¸æ–­æ³›æ´ªï¼Œé€ æˆå¹¿æ’­é£æš´ã€‚\n\nå¹¿æ’­é£æš´å¯¹ç½‘ç»œå±å®³éå¸¸å¤§ï¼Œå°†ä¸¥é‡æ¶ˆè€—è®¾å¤‡CPUèµ„æºåŠç½‘ç»œå¸¦å®½ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„ã€‚\n\nå¹¿æ’­é£æš´ç°è±¡:`ç½‘ç»œæ…¢ã€æ¥å£æŒ‡ç¤ºç¯é«˜é€Ÿé—ªçƒã€CPUä½¿ç”¨ç‡é«˜ã€CLIå¡é¡¿ã€è¿œç¨‹ç®¡ç†å¡æˆ–ç™»å½•ä¸ä¸Š`\n\nä¾‹é¢˜\n\n![image-20250120162717418](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/597d2256aff881c0d35c03a7880b008d697559838.png)\n\n`äºŒå±‚ç¯è·¯é—®é¢˜-MACè¡¨éœ‡è¡`\n\n![image-20250120163123103](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/16f4a6dfdefe20eb5ef7fd826e4e985a697559838.png)\n\n![image-20250120163350977](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1e53000868d1fc84225ac5bf2260963d697559838.png)\n\n#### STPåŸºæœ¬æ¦‚å¿µ\n\né‡‡ç”¨ç”Ÿæˆæ ‘(Spanning-tree)æŠ€æœ¯ï¼Œèƒ½å¤Ÿåœ¨ç½‘ç»œä¸­å­˜åœ¨äºŒå±‚ç¯è·¯æ—¶ï¼Œé€šè¿‡`é€»è¾‘é˜»å¡`(Block)ç‰¹å®šç«¯å£ï¼Œä»è€Œ`æ‰“ç ´ç¯è·¯`ï¼Œå¹¶ä¸”åœ¨ç½‘ç»œå‡ºç°æ‹“æ‰‘å˜æ›´æ—¶åŠæ—¶æ”¶æ•›ï¼Œ`ä¿éšœç½‘ç»œä½™æ€§`ã€‚\n\n![image-20241203214506947](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a32bf9696d690de58d0cc71710a5498c697559838.png)\n\nå½“å‡ºç°ç½‘ç»œæ•…éšœæ—¶\n\nåœ¨ç½‘ç»œå‡ºç°æ‹“æ‰‘å˜æ›´æ—¶åŠæ—¶æ”¶æ•›ï¼Œä¿éšœç½‘ç»œå†—ä½™æ€§\n\n![image-20241203215012844](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/77c02f52447ba632bff2955843553c85697559838.png)\n\n#### ç½‘æ¡¥ID(Bridge ID)\n\næ¡¥IDä¸€å…±8ä¸ªå­—èŠ‚ï¼Œç”±`2ä¸ªå­—èŠ‚ä¼˜å…ˆçº§`å’Œ`6ä¸ªå­—èŠ‚çš„MACåœ°å€`æ„æˆã€‚(ipåœ°å€32ä½æ˜¯4ä¸ªå­—èŠ‚ï¼Œ1å­—èŠ‚=8bit)\n\næ¡¥ä¼˜å…ˆçº§é»˜è®¤ä¸º`32768`ï¼Œå¯ä»¥æ‰‹å·¥ä¿®æ”¹ã€‚\n\nMACåœ°å€ä¸ºäº¤æ¢æœºèƒŒæ¿MAC.\n\n![image-20241203215227993](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d9c88b56bf5b19a40d2401c5ae1b3df7697559838.png)\n\n#### è·¯å¾„å¼€é”€(Path Cost)\n\nè·¯å¾„å¼€é”€æ˜¯ä¸€ä¸ªç«¯å£é‡ï¼Œæ˜¯STP/RSTPåè®®ç”¨äºé€‰æ‹©é“¾è·¯çš„å‚è€ƒå€¼ã€‚\n\nç«¯å£è·¯å¾„å¼€é”€çš„é»˜è®¤å€¼åŠå–å€¼èŒƒå›´ç”±é€‰å®šçš„è·¯å¾„å¼€é”€ç®—æ³•å†³å®šï¼Œ`è·¯å¾„å¼€é”€ä¸ç«¯å£å¸¦å®½æˆåæ¯”`ã€‚\n\nåä¸ºè®¾å¤‡è·¯å¾„å¼€é”€æ ‡å‡†æœ‰:802.1d-1998ã€802.1tåŠç§æœ‰çš„legacyï¼Œé»˜è®¤ä¸º802.1tæ ‡å‡†ã€‚\n\n![image-20241203215656444](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0d91066a86643602fee5784f9d335bd7697559838.png)\n\n#### STPé€‰ä¸¾æ“ä½œâ­ï¸\n\n1.ç¡®å®šä¸€ä¸ªæ ¹æ¡¥(Root Bridge)ã€`é€‰ä¼˜å…ˆçº§å’ŒMACåœ°å€æœ€å°çš„ç½‘æ¡¥`ã€‘\n\n2.ç¡®å®šå…¶ä»–ç½‘æ¡¥çš„æ ¹ç«¯å£(Root Port)ã€`éæ ¹æ¡¥çš„ç«¯å£åˆ°æ ¹æ¡¥æœ€è¿‘çš„ç«¯å£`ã€‘\n\n3.æ¯ä¸ªæ®µé€‰æ‹©ä¸€ä¸ªæŒ‡å®šç«¯å£(Designated Port)ã€`å…ˆé€‰æŒ‡å®šæ¡¥ï¼ŒæŒ‡å®šæ¡¥ä¸Šä¸ºæŒ‡å®šç«¯å£`ã€‘\n\n4.é€‰å‡ºéæŒ‡å®šç«¯å£(NonDesignated Port)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9aa31a00b6e3348e5f0404cf84517ce5697559838.png)\n\nã€é€‰ä¸¾ç¬¬ä¸€æ­¥ã€‘\n\n1.ç¡®å®šä¸€ä¸ªæ ¹æ¡¥(Root Bridge)ã€`é€‰ä¼˜å…ˆçº§å’ŒMACåœ°å€æœ€å°çš„ç½‘æ¡¥`ã€‘\n\né¦–å…ˆæ¯”è¾ƒä¼˜å…ˆçº§ï¼Œå…¶æ¬¡å†æ˜¯macåœ°å€ï¼Œä¸¤è€…éƒ½æ˜¯è¶Šå°è¶Šä¼˜å…ˆ\n\nå›¾ä¸­ä¼˜å…ˆçº§éƒ½ä¸€æ ·ï¼Œä½†æ˜¯sw1çš„macåœ°å€æœ€å°ï¼Œæ‰€ä»¥ä»–æ˜¯æ ¹æ¡¥\n\nã€BPDUã€‘:æ˜¯è¿è¡ŒSTPçš„äº¤æ¢æœºä¹‹é—´äº¤æ¢çš„ä¿¡æ¯å¸§ã€‚ BPDUå†…åŒ…å«äº†STPæ‰€éœ€çš„è·¯å¾„å’Œä¼˜å…ˆæƒä¿¡æ¯ï¼ŒSTPä¾¿åˆ©ç”¨è¿™äº›ä¿¡æ¯æ¥ç¡®å®šæ ¹æ¡¥ä»¥åŠåˆ°æ ¹æ¡¥çš„è·¯å¾„ã€‚\n\n![image-20241203220205266](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cf89afd2d965f568764e201bd79f74c5697559838.png)\n\nã€é€‰ä¸¾ç¬¬äºŒæ­¥ã€‘\n\n2.ç¡®å®šå…¶ä»–ç½‘æ¡¥çš„æ ¹ç«¯å£(Root Port)ã€`éæ ¹æ¡¥çš„ç«¯å£åˆ°æ ¹æ¡¥æœ€è¿‘çš„ç«¯å£`ã€‘\n\n![image-20241203221107618](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f0258731442688eb0c05c5b14fef0343697559838.png)\n\nã€é€‰ä¸¾ç¬¬ä¸‰æ­¥ã€‘\n\n3.æ¯ä¸ªæ®µé€‰æ‹©ä¸€ä¸ªæŒ‡å®šç«¯å£(Designated Port)ã€`å…ˆé€‰æŒ‡å®šæ¡¥ï¼ŒæŒ‡å®šæ¡¥ä¸Šä¸ºæŒ‡å®šç«¯å£`ã€‘\n\n![image-20241203221712630](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3de34d5a84c121810a25f0dc9bdc632a697559838.png)\n\nã€é€‰ä¸¾ç¬¬å››æ­¥ã€‘\n\n4.é€‰å‡ºéæŒ‡å®šç«¯å£(NonDesignated Port)\n\n![image-20241203222244999](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e0088c705e2da801e8328306c85e49fa697559838.png)\n\n#### STPæ¡ˆä¾‹åˆ†æ\n\n![image-20241203224424435](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/170a01fd738ab593d07c2e005b5c35b5697559838.png)\n\n![image-20241203224930816](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/161e5d528d30903218d320ce49c6caf3697559838.png)\n\n![image-20241203230350961](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8b01622ad4a6d397d21e4300cdb1f037697559838.png)\n\n#### å‡ ç§ç”Ÿæˆæ ‘åè®®\n\nç”Ÿæˆæ ‘åè®®     802.1d   STP(`æ…¢ï¼Œæ‹“æ‰‘æ”¶æ•›éœ€è¦30-50s`)\nå¿«é€Ÿç”Ÿæˆæ ‘åè®® 802.1W   RSTP(`å¿«ï¼Œ6så†…å®Œæˆæ”¶æ•›`)\nå¤šç”Ÿæˆæ ‘åè®®   802.1    SMSTP(`å®ç°å¤šä¸ªVLANè´Ÿè½½å‡è¡¡`)\n\n#### ä¾‹é¢˜\n\n![image-20241203230748842](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d58695a921728ec6f73b91e2bfeef4c7697559838.png)\n\n![image-20241203231400013](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0a8172d6ff0da3d5ee7382aafb5e1743697559838.png)\n\n![image-20241203231543924](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c17ed6b52a470971c0836b6a4c3ef456697559838.png)\n\n![image-20241203231724574](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2815cba86d2d129695ea37531463e5bc697559838.png)\n\n![image-20241203231734882](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6d5e08d949c0465eddc77246e17f4dfe697559838.png)\n\n![image-20241203231841056](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/512f732ca101734e290706b2944b9368697559838.png)\n\n![image-20250120163746069](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5f9e078887bbe91a85ee50438df17e0c697559838.png)\n\n![image-20250120164445439](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/08080bf6c17e9e7ccd43c98d9092bcd3697559838.png)\n\n![image-20250120164948611](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/14774127f2acf1a393160506da20c0d3697559838.png)\n\n### åŸåŸŸç½‘åŸºç¡€\n\n(1)E-LANæŠ€æœ¯æ˜¯802.1Qçš„VLANå¸§æ ‡è®°ï¼ŒåŒå±‚æ ‡è®°ï¼Œæ‰“äº†`ä¸¤å±‚VLANæ ‡ç­¾`ï¼Œè¿™ç§æŠ€æœ¯è¢«å®šä¹‰ä¸º`IEEE802.1ad`ï¼Œä¹Ÿç§°ä¸º`QinQ`æŠ€æœ¯ã€‚\nQinQå®é™…æ˜¯æŠŠ`ç”¨æˆ·VLAN`åµŒå¥—åœ¨`è¿è¥å•†åŸåŸŸä»¥å¤ªç½‘VLAN`ä¸­ä¼ é€\n(2)IEEE802.1ahï¼Œä¹Ÿç§°ä¸ºPBBï¼Œä¹Ÿå«`MAC-IN-MAC`æŠ€æœ¯ã€‚\n\n![image-20241204164002546](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fb1c64f88779d6db2592a04bc3ece618697559838.png)\n\n![image-20241204164032857](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e412a102ddf505e3fea2db133f2499f3697559838.png)\n\n![image-20241204164051101](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e0d1041ac4be4fa927ce41874777715c697559838.png)\n\n### ç« èŠ‚æ€»ç»“\n\n![image-20241204164249120](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ed0e82edfe07562fd3e91bb77ae55dfe697559838.png)\n\n## æ— çº¿é€šä¿¡ç½‘\n\n### ç§»åŠ¨é€šè®¯ä¸4G/5G\n\n#### ä»‹ç»\n\n![image-20241204172055053](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a1a6af92b9c66cdcf22a3b7f923a62e4697559838.png)\n\nä¸­å›½ç§»åŠ¨ã€ä¸­å›½è”é€šã€ä¸­å›½ç”µä¿¡çš„ç§»åŠ¨é€šä¿¡åˆ¶å¼\n\n`TD-LTE-Aavancedæ˜¯æˆ‘å›½è‡ªä¸»çŸ¥è¯†äº§æƒçš„4Gæ ‡å‡†`\n\n![image-20241204172107750](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b8d47fe1b2fd589a81b7e0cc1681a43e697559838.png)\n\n#### ç§»åŠ¨é€šä¿¡æŠ€æœ¯æ ‡å‡†\n\n![image-20250120165245162](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/77d60e797331303c94009358cba9a5e2697559838.png)\n\n#### 4Gæ ‡å‡†\n\n![image-20250120165341463](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5a5db6f9762299a885b5a17daeab80e3697559838.png)\n\n#### 4Gå…³é”®æŠ€æœ¯\n\n4Gå…³é”®æŠ€æœ¯åŒ…æ‹¬:OFDMA(Orthogonal Frequency Division Multiple Access)ã€MIMO (MultipleInput Multiple Output)ã€è½¯ä»¶æ— çº¿ç”µ(Software Defined Radio,SDR)æŠ€æœ¯ã€VoIP (Voice overInternet Protocol)æŠ€æœ¯ç­‰\n\n![image-20250120165457363](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8e109bf89e7113d57439b790768dd39f697559838.png)\n\n##### OFDMA\n\n![image-20250120165610208](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/62670b082c46d8b6dfea7ccf8164efa1697559838.png)\n\n##### MIMO\n\n![image-20250120165630316](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/67643fae00adeed50de9e2a64ba10361697559838.png)\n\n##### è½¯ä»¶æ— çº¿ç”µSDR\n\n![image-20250120165651984](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/423b77a489916c1a4444e79cae3e43c3697559838.png)\n\n##### Voip\n\n![image-20250120165728288](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9e9d31716230b80a381325bfdac34998697559838.png)\n\n#### 5G\n\n`5Gåº”ç”¨åœºæ™¯`\n\n![image-20250120165850654](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/22d56369dbf4edcdaab8bb6358e643ad697559838.png)\n\n`5Gä¸¤ç§ç»„ç½‘æ¨¡å¼ï¼ˆNSA/SAï¼‰`\n\n![image-20250120165934625](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7d464dd46ad431264c805ed66bff2c9c697559838.png)\n\n`5Gå…³é”®æŠ€æœ¯`\n\n5Gå…³é”®æŠ€æœ¯åŒ…æ‹¬:`è¶…å¯†é›†å¼‚æ„æ— çº¿ç½‘ç»œ`ã€`å¤§è§„æ¨¡è¾“å…¥è¾“å‡º(MIMO)`ã€`æ¯«ç±³æ³¢é€šä¿¡`ã€`è½¯ä»¶å®šä¹‰ç½‘ç»œ`å’Œ`ç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–`ã€‚\n\n`è¶…å¯†é›†å¼‚æ„æ— çº¿ç½‘ç»œ`:ç›¸å¯¹äº4Gç½‘ç»œï¼Œ5Gä½¿ç”¨è¾ƒé«˜çš„é¢‘è°±ï¼Œè¦†ç›–èŒƒå›´ç›¸å¯¹è¾ƒå°ï¼Œéœ€è¦å¯†é›†éƒ¨ç½²å®åŸºç«™ã€å¾®åŸºç«™å’Œå®¤åˆ†ç­‰ä¸åŒæ¶æ„çš„ç½‘ç»œæ»¡è¶³è¦†ç›–éœ€æ±‚\n\n`å¤§è§„æ¨¡è¾“å…¥è¾“å‡º(MIMO)`:5Gæ²¿ç”¨äº†4Gç½‘ç»œçš„å¤šè¿›å¤šå‡ºæŠ€æœ¯(MultipleInput MultipleOutput,MIMO)ï¼Œèƒ½æœ‰æ•ˆæå‡ç½‘ç»œå¸¦å®½ã€‚\n\n`æ¯«ç±³æ³¢é€šä¿¡`:æ¯«ç±³æ³¢å°åŸºç«™å¯ä»¥å¢å¼ºé«˜é€Ÿç¯å¢ƒä¸‹ç”¨æˆ·çš„ç½‘ç»œä½“éªŒï¼Œæå‡ç½‘ç»œçš„ç»„ç½‘çµæ´»æ€§ã€‚\n\n`SDNå’ŒNFV`:SDNæŠ€æœ¯å®ç°æ§åˆ¶å±‚é¢å’Œæ•°æ®å±‚é¢åˆ†ç¦»ï¼Œæå‡ç½‘ç»œçµæ´»æ€§ã€å¯ç®¡ç†æ€§å’Œæ‰©å±•æ€§ã€‚NFVæŠ€æœ¯å¯ä»¥å®ç°è½¯ä»¶å’Œç¡¬ä»¶è§£è€¦ï¼Œæ¯”å¦‚ä¼ ç»Ÿç½‘ç»œéœ€è¦è´­ä¹°é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ã€é˜²ç—…æ¯’ç­‰ç¡¬ä»¶å®‰å…¨è®¾å¤‡NFVå®ç°ç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–åï¼Œåªéœ€è¦è´­ä¹°æ ‡å‡†æœåŠ¡å™¨ï¼Œç„¶åè™šæ‹Ÿå‡ºå¤šå°è™šæ‹Ÿæœºï¼Œå¯ä»¥åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œè½¯ä»¶çš„è™šæ‹Ÿé˜²ç«å¢™(vFW)ã€è™šæ‹Ÿæœºå…¥ä¾µæ£€æµ‹(VIPS)å’Œè™šæ‹Ÿé˜²ç—…æ¯’(VAV)ï¼Œä»è€Œå¤§å¹…é™ä½ç½‘ç»œçš„å»ºè®¾å’Œç»´æŠ¤æˆæœ¬ï¼Œ\n\n\n\nä¾‹é¢˜\n\n![image-20250120170246492](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f9a17ae10bf493709280148b702397b2697559838.png)\n\n![image-20250120170311066](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/21671587d48be6eceb88da2e52dc8c25697559838.png)\n\n![image-20250120170405480](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/819cc625c0600e3a2a624d232ea9a9e2697559838.png)\n\n![image-20241204172505544](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/019f267ec3459588b31c1585a3e31f8f697559838.png)\n\n![image-20241204172555532](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a5f1167f9d3bf7124ba38e08ab5c6790697559838.png)\n\n![image-20250120170444020](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/04a0953b86f76cbe3462f385a864f9d4697559838.png)\n\n![image-20250120170513849](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/907cfedef9a6bf1c225c425131ed93d6697559838.png)\n\n### CDMAè®¡ç®—\n\nåŸç†\n\nCDMAç³»ç»Ÿä¸ºä¸åŒç”¨æˆ·åˆ†é…ç ç‰‡ï¼Œæ ¹æ®è®¡ç®—`æ­£äº¤å€¼æ¥åˆ¤æ–­æ˜¯å¦æ¥æ”¶æ•°æ®å’Œæ¥æ”¶çš„æ•°æ®æ˜¯å¤šå°‘`\n\n`æ­£äº¤ç»“æœä¸º1ï¼Œè¡¨ç¤ºå‘é€æ•°æ®1`\n`æ­£äº¤ç»“æœä¸º-1ï¼Œè¡¨ç¤ºå‘é€æ•°æ®ä¸º0`\n`æ­£äº¤ç»“æœä¸º0ï¼Œè¡¨ç¤ºæœªå‘è¯¥ç»ˆç«¯å‘é€æ•°æ®ã€‚`\n\n![image-20250120170924945](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/926d3973188a10f794b5429f16dcd599697559838.png)\n\n![image-20250120170953022](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/993f76528298b2d4c765b0f53ee96465697559838.png)\n\n### WLANé€šä¿¡æŠ€æœ¯\n\næ— çº¿ç½‘ä¸»è¦ä½¿ç”¨ä¸‰ç§é€šä¿¡æŠ€æœ¯:`çº¢å¤–çº¿ã€æ‰©å±•é¢‘è°±(æ‰©é¢‘)å’Œçª„å¸¦å¾®æ³¢æŠ€æœ¯`ã€‚\n\næ‰©å±•é¢‘è°±é€šä¿¡:å°†ä¿¡å·æ•£æ­¥åˆ°æ›´å®½çš„å¸¦å®½ä¸Šä»¥`å‡å°‘å‘é€é˜»å¡å’Œå¹²æ‰°`çš„æœºä¼šï¼Œæœ‰åˆ©äºä¿å¯†ã€‚\n\næ‰©é¢‘æŠ€æœ¯å°±æ˜¯ç”¨ä¼ªéšæœºåºåˆ—å¯¹ä»£è¡¨æ•°æ®çš„æ¨¡æ‹Ÿä¿¡å·è¿›è¡Œè°ƒåˆ¶\n\nWLANä¸»è¦ä½¿ç”¨æ‰©å±•é¢‘è°±æŠ€æœ¯:`é¢‘ç‡è·³åŠ¨æ‰©é¢‘FHSS(è“ç‰™)`å’Œ`ç›´æ¥åºåˆ—æ‰©å±•é¢‘è°±DSSS(Wi-Fi)`ã€‚\n\n![image-20241204213422283](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/40c9395aaebd06cd2217ccd0acf57b3e697559838.png)\n\n`ç›´æ¥åºåˆ—æ‰©å±•é¢‘è°±DSSS`ï¼šä¿¡å·æºä¸­çš„æ¯ä¸€ä½ç”¨ç§°ä¸ºç ç‰‡çš„Nä¸ªä½æ¥ä¼ è¾“ã€‚\n\n`é¢‘ç‡è·³åŠ¨æ‰©é¢‘FHSS`æ˜¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­åå¤è½¬æ¢é¢‘ç‡\n\n![image-20250120171106773](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b3bb3feca7f1a79dd48b67881bb433fa697559838.png)\n\nä¾‹é¢˜\n\n![image-20241204214037025](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c495dce4a8648cf8bcfc5a29f25795e3697559838.png)\n\n![image-20241204214107659](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/55ce421520074814137b13394a902b7c697559838.png)\n\n![image-20241204214116557](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5f9e385703ead84c40a95498f16becc6697559838.png)\n\n### WLANé¢‘è°±ä¸ä¿¡é“\n\n#### wlanç½‘ç»œåˆ†ç±»\n\nWLANç½‘ç»œå¯ä»¥åˆ†ä¸ºä¸‰ç±»:`åŸºç¡€æ— çº¿ç½‘ç»œã€Ad Hocç½‘ç»œå’Œåˆ†å¸ƒå¼æ— çº¿ç³»ç»Ÿã€‚`\n\nåŸºç¡€æ— çº¿ç½‘ç»œ(Infrastructure Networking):ç”¨æˆ·é€šè¿‡æ— çº¿æ¥å…¥ç‚¹APæ¥å…¥\n\nç‰¹æ®Šç½‘ç»œ(Ad Hoc Networking):ç”¨äºå†›ç”¨è‡ªç»„ç½‘æˆ–å¯å®¤å±€åŸŸç½‘è”æœºæ¸¸æˆã€‚\n\nåˆ†å¸ƒå¼æ— çº¿ç³»ç»Ÿ:é€šè¿‡ACæ§åˆ¶å¤§é‡APç»„æˆçš„æ— çº¿ç½‘ç»œã€‚\n\n![image-20241204234334041](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a7df7e298122958ac7590a8984666ceb697559838.png)\n\n`ISMé¢‘æ®µ`\n\n![image-20241204234358223](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8dc885fa711fddd353f985fe69191aaa697559838.png)\n\n#### ä¸é‡å ä¿¡é“ğŸŒŸ\n\n![image-20241204234449450](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0f8d1eca9a054b752a7ae068bc812a89697559838.png)\n\nä¸–ç•Œåˆ†å¸ƒçš„2.4gå’Œ5gé¢‘é“\n\n![image-20250120171300910](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e6e651f19c8026034c84252696af09bf697559838.png)\n\n![image-20241204234607601](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b41cb73c550368c1e583a29774762fbc697559838.png)\n\nä¿¡é“é‡ç”¨ä¸APéƒ¨ç½²\n\n![image-20241204234653176](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ddc36a4300578675506067c7471bf136697559838.png)\n\n![image-20241204234717843](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e103edc579a673ba5af1e74f19fc2468697559838.png)\n\n![image-20241204234727411](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bff3d2f5fb6b2aaed151d15d3e5867ff697559838.png)\n\n![image-20241204234741692](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/577298a59a20ad551702b345e17cf270697559838.png)\n\n### 802.11æŠ€æœ¯æ ‡å‡†å¯¹æ¯”\n\n![image-20250120171212613](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8ce3968e1260014e9b92d9630d760b13697559838.png)\n\n![image-20250120171605571](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9f19a86c194f627ba711226fdcda3335697559838.png)\n\nğŸŒŸ\n\n1.Wi-Fiæ ‡å‡†çš„å·¥ä½œé¢‘æ®µã€‚\n\n`2.4GHZ`:802.11ã€802.11bå’Œ802.119 \n\n`5GHz`:802.11aå’Œ802.11ac\n\n`2.4GHZ+5GHz`:802.11nå’Œ802.11ax\n2.éé‡çœ‹ä¿¡é“æ•°é‡ã€‚2.4GHzé¢‘æ®µåŒ…å«`13`ä¸ªä¿¡é“ï¼Œæœ‰`3`ä¸ªä¸é‡åˆä¿¡é“ï¼Œå¸¸ç”¨ä¿¡é“ä¸º`1ã€6å’Œ11`ï¼Œä¸é‡åˆä¿¡é“`é—´éš”5ä¸ªä¿¡é“`ã€‚\n3.ä¸åŒ802.11æ ‡å‡†çš„æœ€å¤§é€Ÿç‡ã€‚æ¯”å¦‚ï¼Œ`802.11næœ€å¤§æ”¯æŒ600Mbps`ï¼Œ`802.11axé€Ÿç‡å¯è¾¾9600Mbps`ã€‚\n\n### WIFI7(802.11be)\n\n![image-20250120171538159](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/117fcfb276c245ddd5dd6d1eecc1c970697559838.png)\n\n![image-20250120171554397](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b009b5c8138c376bd1cedc43e98f10f5697559838.png)\n\n\n\n\n\n**ä¾‹é¢˜**\n\n![image-20241205000156435](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d2d2ae1088eb08046b454488829c74f8697559838.png)\n\n![image-20241205000203375](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f6387767322f5e737f2c468faa400a8d697559838.png)\n\n![image-20241205000215394](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/33a97bc85037dd10b1050490c0c7facb697559838.png)\n\n![image-20241205000231188](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4c1ec4aed3573f739a6615411f07d3c0697559838.png)\n\n![image-20241205000243204](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ec823fd1f0547579d9a3a793f3caf8f7697559838.png)\n\n![image-20241205000254736](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/22b366438b3396f54077fc7bf1fce705697559838.png)\n\n![image-20241205000307640](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3f70bc0248281a32da8ee66583feeb9c697559838.png)\n\n![image-20241205000317751](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7071e8688d7e2a7a0364fe1e52ec3a1d697559838.png)\n\n![image-20250120171732596](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6516aec231166937ac75cd764ad851f7697559838.png)\n\n![image-20250120171753130](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a4701954fd98d93c75619013b221e7e5697559838.png)\n\n![image-20250120171829987](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6526ea9d2094dd4bf959df08ab809705697559838.png)\n\n![image-20250120171914280](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4cc084c6be9caa66a16d4f59ae83ecf5697559838.png)\n\n\n\n### 802.11 MACå±‚\n\n802.11 MACå­å±‚å®šä¹‰äº†3ç§è®¿é—®æ§åˆ¶æœºåˆ¶:CSMA/CA(æ”¯æŒç«äº‰è®¿é—®)ï¼ŒRTS/CTSå’Œç‚¹åè°ƒåŠŸèƒ½(æ”¯æŒæ— ç«äº‰è®¿é—®)ã€‚\n`CSMA/CA`æ ¸å¿ƒåŸç†:å‘é€æ•°æ®å‰å…ˆæ£€æµ‹ä¿¡é“æ˜¯å¦ä½¿ç”¨ï¼Œè‹¥ä¿¡é“ç©ºé—²ï¼Œåˆ™ç­‰å¾…ä¸€æ®µéšæœºæ—¶é—´åï¼Œå‘é€æ•°æ®ã€‚æ‰€æœ‰ç»ˆç«¯éƒ½éµå®ˆè¿™ä¸ªè§„åˆ™ï¼Œæ•…è¿™ä¸ªç®—æ³•å¯¹å‚ä¸ç«äº‰çš„ç»ˆç«¯æ˜¯å…¬å¹³çš„ï¼ŒæŒ‰`å…ˆæ¥å…ˆæœåŠ¡`çš„é¡ºåºè·å¾—å‘é€æœºä¼š\n\n`RTS/CTSä¿¡é“é¢„çº¦`:å‘é€å‰å…ˆæ‰“æŠ¥å‘Šï¼Œå…¶ä»–ç»ˆç«¯è®°å½•ä¿¡é“å ç”¨æ—¶é—´ã€‚\n\n`PCFç‚¹åè°ƒåŠŸèƒ½`:ç”±APé›†ä¸­è½®è¯¢æ‰€æœ‰ç»ˆç«¯ï¼Œå°†å‘é€æƒé™è½®æµäº¤ç»™å„ä¸ªç»ˆç«¯ï¼Œç±»ä¼¼ä»¤ç‰Œï¼Œæ‹¿åˆ°ä»¤ç‰Œçš„ç»ˆç«¯å¯ä»¥å‘é€æ•°æ®ï¼Œæ²¡æœ‰ä»¤ç‰Œçš„ç»ˆç«¯åˆ™ç­‰å¾…ã€‚ç‚¹åè°ƒåŠŸèƒ½æ¯”DCFåˆ†å¸ƒå¼åè°ƒä¼˜å…ˆçº§æ›´é«˜ã€‚`(æ— äº‰ç”¨)`\n\n![image-20250120172136030](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/63a57de07c17752e191d7bf560c591a0697559838.png)\n\n#### ä¸‰ç§å¸§é—´é—´éš”\n\nDIFS(åˆ†å¸ƒå¼åè°ƒIFS):æœ€é•¿çš„IFSï¼Œ`ä¼˜å…ˆçº§æœ€ä½`ï¼Œç”¨äº`å¼‚æ­¥å¸§ç«äº‰è®¿é—®`çš„æ—¶å»¶\nPIFS(ç‚¹åè°ƒIFS):ä¸­ç­‰é•¿åº¦çš„IFSï¼Œ`ä¼˜å…ˆçº§å±…ä¸­`ï¼Œåœ¨PCFæ“ä½œä¸­ä½¿ç”¨ã€‚\nSIFS(çŸ­IFS):æœ€çŸ­çš„IFSï¼Œ`ä¼˜å…ˆçº§æœ€é«˜`,ç”¨äºéœ€è¦ç«‹å³å“åº”çš„æ“ä½œ(`ç¡®è®¤ACK`)\n\n#### å¸§é—´é—´éš”ç”¨é€”\n\n![image-20250120172223420](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2d0ac9e7ffc5f7e47afe6860aa1c388d697559838.png)\n\n\n\n\n\nä¾‹é¢˜\n\n![image-20250120172255988](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9d5b9581525bc4fcf293acabae718289697559838.png)\n\n![image-20250120172304170](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9f9897ba7c18fa8b2d0fcc3e531939e5697559838.png)\n\n![image-20250120172332148](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b90609220372928d406d32dded3757b6697559838.png)\n\n![image-20241207134000239](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/590fff1fe02a4a123461f03e153c0fa0697559838.png)\n\n### ç§»åŠ¨AD Hocç½‘ç»œ\n\n802.11å®šä¹‰AD Hocç½‘ç»œæ˜¯ç”±æ— çº¿ç§»åŠ¨èŠ‚ç‚¹ç»„æˆçš„`å¯¹ç­‰ç½‘`ï¼Œæ— éœ€ç½‘ç»œåŸºç¡€è®¾æ–½çš„æ”¯æŒï¼Œ`æ¯ä¸ªèŠ‚ç‚¹æ—¢æ˜¯ä¸»æœºï¼Œåˆæ˜¯è·¯ç”±å™¨`ï¼Œæ˜¯ä¸€ç§MANNET(Mobile Ad Hoc Network)ç½‘ç»œã€‚\nAd Hocæ˜¯æ‹‰ä¸è¯­ï¼Œå…·æœ‰â€å³å…´ï¼Œä¸´æ—¶â€çš„æ„æ€ã€‚\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8959d723769cea90b940597921dd51f6697559838.png)\n\n\n\n#### MANETç½‘ç»œç‰¹ç‚¹ï¼ˆé€‰æ‹©é¢˜ï¼‰\n\nç½‘ç»œæ‹“æ‰‘ç»“æ„åŠ¨æ€å˜åŒ–çš„ï¼Œ`ä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿè·¯ç”±åè®®`ï¼ˆRIP,OSPF,BGPï¼‰ã€‚\næ— çº¿ä¿¡é“æä¾›çš„å¸¦å®½è¾ƒå°ï¼Œ`ä¿¡å·è¡°è½å’Œå™ªå£°å¹²æ‰°çš„å½±å“å´å¾ˆå¤§`ã€‚\næ— çº¿ç»ˆç«¯æºå¸¦çš„`ç”µæºèƒ½é‡æœ‰é™ã€‚`\nå®¹æ˜“æ‹›è‡´`ç½‘ç»œçªƒå¬ã€æ¬ºéª—ã€æ‹’ç»æœåŠ¡`ç­‰æ¶æ„æ”»å‡»çš„å¨èƒã€‚\n\n#### MANETè·¯ç”±åè®®\n\n![image-20250120172500726](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/312bec5dba0ddddad06e28555050e6c7697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250120172529770](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f56db96c70c6dd04b1dbfe05dc14cc98697559838.png)\n\n![image-20250120172545214](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b556c0253cc631b1e8137e7710c80488697559838.png)\n\n![image-20250120172602118](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7315bf9dc4696382fb1c93593f16daa8697559838.png)\n\n![image-20250120172628705](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9f11e1bf066c3689ed7260d24ba142ce697559838.png)\n\n### WLANå®‰å…¨æŠ€æœ¯\n\n#### wlanå®‰å…¨æœºåˆ¶\n\n![image-20250120172706027](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a38a9e99ff725a59a0a813b7d9ff1a4c697559838.png)\n\n#### wepå’Œwpaæ‰©å±•\n\n![image-20250120172750255](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7b5c3fd548ac3200cf66af92d4c5441e697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20241207143723571](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bebcd071d3f8fa036faf236051017698697559838.png)\n\n![image-20241207143741440](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d84012b34e4ed9f48f6988c05bddd605697559838.png)\n\n![image-20241207144010306](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2ad66ca0d79887a9c21b31eb6ee2dfc8697559838.png)\n\n![image-20241207144027063](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3506ff8f5cafeb14faae08fd55115743697559838.png)\n\n![image-20250120172831426](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b063f3881d7786b9e4379b032a81aad3697559838.png)\n\n![image-20250120172848965](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a4e3ae3df495022714b3757947af43b5697559838.png)\n\n![image-20250120172915328](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bf7df559b01fbba932f8db7ad1500c60697559838.png)\n\n### æ— çº¿ä¸ªäººç½‘\n\n#### è“ç‰™å’ŒzigbeeæŠ€æœ¯\n\n![image-20250120173016381](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/25ed7c72e17ede08b6277180e08cea45697559838.png)\n\nZigbeeè®¾å¤‡\n\n![image-20250120173035010](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/57621e6a5cc8797483e034ffa065deef697559838.png)\n\n#### Zigbeeåº•å±‚æŠ€æœ¯\n\n![image-20250120173104327](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/69f919f94fdc36a1feb6f42e89194b23697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250120173124254](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7008fab8d7592bfc021e5e17ad157c44697559838.png)\n\n![image-20250120173136098](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b567d5c095ac13dbaa5f595f132767ee697559838.png)\n\n![image-20250120173152879](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3e5757028381ed152acb75ccac9f8619697559838.png)\n\n![image-20250120173205203](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a3fb9214511080fe9215ba02ca277711697559838.png)\n\n## ç½‘ç»œäº’è”\n\n![image-20250308230440245](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2d42b2f015a95fc4c8b3a0828b0ce5ec55933597.png)\n\n### å¹¿åŸŸç½‘æŠ€æœ¯\n\n#### å…¬å…±äº¤æ¢ç”µè¯ç½‘\n\n![image-20250121145420398](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e27c8850b268e2b22a778dfb6846dc55697559838.png)\n\n#### X.25\n\n![image-20250121145510558](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/393e6d243688e67e9f564c03dabbfd12697559838.png)\n\n#### å¸§ä¸­ç»§FR\n\n![image-20250121145620170](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e8c82c6c62de19ef896529f09cebd8f2697559838.png)\n\nä¾‹é¢˜\n\n![image-20241201165130897](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7357ca413ecbb876d203ef1d0bf8664a697559838.png)\n\n#### ISDNå’ŒATM\n\n![image-20250121145748214](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/42e9120d476647f90adf28e8bbaa1c5e697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250121145929124](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a1f87a0fc49565b1e2044c3db02591cf697559838.png)\n\n![image-20250121145944366](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/004209765e363e7311460df0776127cc697559838.png)\n\n![image-20250121150001846](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/31976497435435a637c9471f4c9b74a5697559838.png)\n\n![image-20250121150016266](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0a3b758c3be8ec85d61032c6bc6ad3df697559838.png)\n\n### ipv4\n\n#### ipæŠ¥æ–‡æ ¼å¼  \n\nIHLå­—æ®µæ˜¯ä¸€ä¸ª4ä½çš„å­—æ®µï¼Œå®ƒçš„å•ä½æ˜¯4å­—èŠ‚ï¼ˆæˆ–è€…è¯´32ä½ï¼‰ã€‚IHLå­—æ®µçš„å€¼è¡¨ç¤ºçš„æ˜¯IPv4å¤´éƒ¨çš„é•¿åº¦ï¼Œä»¥4å­—èŠ‚ä¸ºå•ä½ã€‚è¿™æ„å‘³ç€ï¼š\n\n- æœ€å°å€¼ï¼šIHLå­—æ®µçš„æœ€å°å€¼æ˜¯5ï¼Œè¿™æ„å‘³ç€IPv4å¤´éƒ¨çš„æœ€å°é•¿åº¦æ˜¯5ä¸ª4å­—èŠ‚ï¼Œå³20å­—èŠ‚ã€‚\n- æœ€å¤§å€¼ï¼šIHLå­—æ®µçš„æœ€å¤§å€¼æ˜¯15ï¼Œè¿™æ„å‘³ç€IPv4å¤´éƒ¨çš„æœ€å¤§é•¿åº¦æ˜¯15ä¸ª4å­—èŠ‚ï¼Œå³60å­—èŠ‚ã€‚\n\nç‰ˆæœ¬å·:0100\n\nåˆ†ç‰‡åç§»æ˜¯`8å­—èŠ‚`çš„å€æ•°ï¼Œåœ¨ä¸‹é¢è®²ipåˆ†ç‰‡çš„æ—¶å€™ä¼šç”¨åˆ°\n\nIPè´Ÿè½½ä¹Ÿå°±æ˜¯é™¤å¼€æŠ¥å¤´çš„æ•°æ®éƒ¨åˆ†æœ€å¤§ä¸º65535-20=65515\n\n![image-20250114160711389](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7d184fd601d1e197d1e4e414d14ed7a7697559838.png)\n\n![image-20241207213409449](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5d1c5c19a9c192acf2a478b328821697697559838.png)\n\n![image-20241207213518964](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a46651af9607605c310993a431eb1c36697559838.png)\n\n![image-20241207213532416](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c1cc388b8d3ed3f66bdc855ac8b8ace5697559838.png)\n\n![image-20250121150809355](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e8baaa132d9531b8c9c1c8b77fd16e21697559838.png)\n\n![image-20250121151805749](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/afcc454b01772425e57042ea2facd293697559838.png)\n\n#### ipåˆ†ç‰‡ä¸è®¡ç®—\n\nå…³é”®è¯ï¼šåç§»ï¼ŒMFï¼Œç‰‡åç§»\n\nIPæŠ¥æ–‡æœ€å¤§65535å­—èŠ‚ï¼Œè€Œä»¥å¤ªç½‘MTUä¸º1500å­—èŠ‚\n\nç›¸å½“äºè´§è½®èƒ½è½½é‡65535ï¼Œè€Œç«è½¦è½½é‡1500ï¼Œé‚£ä¹ˆå¿…é¡»æŠŠè´§è½®ä¸Šçš„è´§ç‰©åˆ†è£…ç»™å¤šä¸ªç«è½¦è¿è¾“ã€‚\n\n![image-20250121151835897](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6f210b28127dea3efbabf0058cfb104b697559838.png)\n\nä¾‹é¢˜\n\n![image-20250109185350031](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d0c5b4baa74089c3ad41fe79b935eaba697559838.png)\n\nç±»æ¯”è§£æ\n\n`åŸé¢˜`ï¼šä¸€ä¸ª`IPæ•°æ®æŠ¥æ–‡é•¿åº¦`ä¸º3000å­—èŠ‚(åŒ…æ‹¬é¦–éƒ¨é•¿åº¦)ï¼Œè¦ç»è¿‡ä¸€ä¸ª`MTU`ä¸º1500å­—èŠ‚çš„ç½‘ç»œä¼ è¾“ã€‚æ­¤æ—¶éœ€å°†åŸå§‹æ•°æ®æŠ¥åˆ‡åˆ†ä¸º3ç‰‡è¿›è¡Œä¼ è¾“ï¼Œè¯·å°†æ¯ä¸ªæ•°æ®æŠ¥åˆ†ç‰‡çš„æ€»é•¿åº¦ã€æ•°æ®é•¿åº¦ã€MFæ ‡å¿—å’Œç‰‡åç§»å¡«å…¥ç­”é¢˜çº¸å¯¹åº”è¡¨æ ¼ä¸­ã€‚\n`ç±»æ¯”ç¿»è¯‘`:ä¸€ä¸ªå¤§å‹é›†è£…ç®±ï¼Œ`è´§ç‰©+é›†è£…ç®±`=3000æ–¤,ç°åœ¨è¦ç”¨`å°å‹é›†è£…ç®±`è¿›è¡Œåˆ†è£…,æ¯ä¸ª`å°å‹é›†è£…ç®±è‡ªèº«é‡é‡+è´§ç‰©é‡é‡`=1500æ–¤,å·²çŸ¥å¤§å‹é›†è£…ç®±å’Œå°å‹é›†è£…ç®±é‡é‡éƒ½æ˜¯20æ–¤,é—®:å¯ä»¥ç”¨å‡ ä¸ªå°å‹é›†è£…ç®±è¿›è¡Œåˆ†è£…?æ¯ä¸ªå°é›†è£…ç®±çš„è´§ç‰©åˆ†åˆ«æ˜¯å¤šå°‘æ–¤?\n\n![image-20250109185552769](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b25a746e93b7dafcd2c6c451f4af71c1697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250109185748314](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5d7d0276169403f7998243230df7c8d5697559838.png)\n\n![image-20250109185934070](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/47ca9f45f4dc9c79c1e5faf7dcd0cda0697559838.png)\n\n![image-20250109190540292](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c72779c13d8e796d366f18ad44d0d3cd697559838.png)\n\n![image-20250121152137683](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/04a4ca50de86f6e19f5e73996975990f697559838.png)\n\n![image-20250121152236151](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c560120fef47f0ee7e511479df83c168697559838.png)\n\n![image-20250109190604413](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5db81e014173a84ede8e18f6c9f4eb4c697559838.png)\n\n![image-20250121152457803](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/86ba07b918702fcc155e2b7b811d2770697559838.png)\n\n#### IPåˆ†ç±»ä¸ç‰¹æ®Šipåœ°å€\n\nå…³é”®è¯ï¼šAç±»ã€Bç±»ã€Cç±»ã€Dç±»ã€Eç±»\n\n![image-20250109190655034](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/88737fb50976afcdc8533efedfb8754b697559838.png)\n\nç‰¹æ®Šipv4åœ°å€\n\n1. `0.0.0.0`\n   `ä¸»æœºç«¯`:DHCPåˆ†é…è¿‡ç¨‹ä¸­ï¼Œç”¨0.0.0.0è¡¨ç¤ºæœ¬æœºï¼Œæ¯”å¦‚ä¸»æœºDHCPDiscoverå¹¿æ’­æŠ¥æ–‡æºç›®åœ°å€å’Œç«¯å£æ˜¯0.0.0.0:68->255.255.255.255:67.\n\n   `æœåŠ¡å™¨ç«¯`:0.0.0.0æœ¬æœºæ‰€æœ‰IPv4åœ°å€ï¼Œå¦‚æœæŸä¸»æœºæœ‰ä¸¤ä¸ªIPåœ°å€ï¼Œè¯¥ä¸»æœºä¸€ä¸ªæœåŠ¡ç›‘å¬çš„åœ°å€æ˜¯0.0.0.0ï¼Œé‚£ä¹ˆé€šè¿‡ä¸¤ä¸ªIPåœ°å€éƒ½èƒ½å¤Ÿè®¿é—®è¯¥æœåŠ¡ã€‚\n\n   `è·¯ç”±`:0.0.0.0è¡¨ç¤ºé»˜è®¤è·¯ç”±ï¼Œå³å½“è·¯ç”±è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°å®Œå…¨åŒ¹é…è·¯ç”±çš„æ—¶å€™æ‰€å¯¹åº”çš„è·¯ç”±ã€‚\n\n2. `255.255.255.255`\n   å—é™å¹¿æ’­åœ°å€ï¼Œè¡¨ç¤º3å±‚å¹¿æ’­çš„ç›®æ ‡åœ°å€ï¼Œåœ¨åŒä¸€ä¸ªå¹¿æ’­åŸŸèŒƒå›´å†…æ‰€æœ‰ä¸»æœºéƒ½ä¼šæ¥æ”¶è¿™ä¸ªåŒ…ï¼Œå¹¿æ’­åŸŸçš„èŒƒå›´å¯å˜ï¼Œè·Ÿå­ç½‘åˆ’åˆ†ç›¸å…³ã€‚\n\n3. `169.254.0.0/16`\n   ä½¿ç”¨DHCPè‡ªåŠ¨è·å–IPåœ°å€ï¼Œå½“DHCPæœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œæˆ–å“åº”æ—¶é—´è¶…æ—¶ç³»ç»Ÿä¼šä¸ºä½ åˆ†é…è¿™æ ·ä¸€ä¸ªåœ°å€ï¼Œä¸èƒ½æ­£å¸¸ä¸Šç½‘ã€‚\n\n4. `127.0.0.0/8`(127.0.0.1-127.255.255.255)\n\n   æœ¬åœ°ç¯å›åœ°å€ï¼Œèƒ½pingé€š127åœ°å€ï¼Œè¯æ˜TCP/IPåè®®æ ˆæ­£å¸¸ã€‚\n\n5. RFC1918ç§æœ‰IPåœ°å€IPv4åœ°å€ç©ºé—´ä¸­æœ‰ä¸€éƒ¨åˆ†ç‰¹æ®Šçš„åœ°å€ï¼Œæˆä¸ºç§æœ‰IPåœ°å€ï¼Œç§æœ‰IPåœ°å€ä¸èƒ½ç›´æ¥è®¿é—®å…¬ç½‘(Internet)çš„IPï¼Œåªèƒ½åœ¨æœ¬åœ°ä½¿ç”¨ï¼Œ\n\n   Aç±»:`10.0.0.0/8`(10.0.0.1-10.255.255.255)1ä¸ªAç±»ç½‘ç»œ\n\n   Bç±»:`172.16.0.0/12`(172.16.0.1-172.31.255.255)16ä¸ªBç±»ç½‘ç»œ\n\n   Cç±»:`192.168.0.0/16`(192.168.0.1-192.168.255.255)256ä¸ªC\n\n6. å¸¸è§ç»„æ’­\n\n\n  224.0.0.1 æ‰€æœ‰ä¸»æœº\n\n  224.0.0.2 æ‰€æœ‰è·¯ç”±å™¨\n\n  `224.0.0.5 æ‰€æœ‰è¿è¡ŒOSPFçš„è·¯ç”±å™¨`\n\n  `224.0.0.6 DRå’ŒBDRçš„ç»„æ’­æ¥æ”¶åœ°å€`\n\n  `224.0.0.9 RIPv2ç»„æ’­æ›´æ–°åœ°å€`\n\n  224.0.0.18 VRRPç»„æ’­åœ°å€\n\n\n\nä¾‹é¢˜\n\n![image-20250121152646359](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4aeb73703fef515cf28fbd7facda845e697559838.png)\n\n![image-20250109191626999](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8416a2006578a8c70f8eedaa87d9c43d697559838.png)\n\n![image-20250109191655920](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0f15ab24b530e92f9327cad890479263697559838.png)\n\n![image-20250121152742137](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3f7597df959366249c0d5ceb9c074a95697559838.png)\n\n![image-20250109191711532](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d1a8801459fcea97c7517fd1d4c76c05697559838.png)\n\n![image-20250109191722502](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8ecf5ed019a5300969eabd800eb0c49a697559838.png)\n\n### ipv6\n\n#### IPV6æ”¹è¿›\n\n![image-20250121152935024](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5ab6cbec5f641ed62a2d1c7f6ccf2bb6697559838.png)\n\n#### IPV6æŠ¥æ–‡æ ¼å¼\n\n![image-20250114161616034](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ef606c0dab4389d3826cf1d838eefb47697559838.png)\n\nç‰ˆæœ¬ï¼ˆ4ä½ï¼‰ï¼šç”¨0110è¡¨ç¤ºIPv6ã€‚ \n\né€šä¿¡ç±»å‹/æµé‡ç­‰çº§ï¼ˆ8ä½ï¼‰ï¼šç”¨äºåŒºåˆ†ä¸åŒçš„IPåˆ†ç»„ï¼Œç›¸å½“äºIPv4ä¸­`æœåŠ¡ç±»å‹`å­—æ®µã€‚ \n\næµæ ‡ç­¾ï¼ˆ20ä½ï¼‰ï¼šæ ‡è¯†æŸäº›éœ€è¦ç‰¹åˆ«å¤„ç†çš„åˆ†ç»„ã€‚ \n\n`è´Ÿè½½é•¿åº¦ï¼ˆ16ä½ï¼‰`ï¼šè¡¨ç¤ºé™¤äº†IPv6å›ºå®šå¤´éƒ¨40ä¸ªå­—èŠ‚ä¹‹å¤–çš„è´Ÿè½½é•¿åº¦ï¼Œæ‰©å±•å¤´åŒ…å«åœ¨è´Ÿè½½é•¿åº¦ä¹‹ä¸­ã€‚ \n\nä¸‹ä¸€å¤´éƒ¨ï¼ˆ8ä½ï¼‰ï¼šæŒ‡æ˜ä¸‹ä¸€ä¸ªå¤´éƒ¨ç±»å‹ï¼Œå¯èƒ½æ˜¯IPv6`æ‰©å±•å¤´éƒ¨æˆ–é«˜å±‚åè®®(tcp,udp)`çš„å¤´éƒ¨ã€‚ \n\n`è·³æ•°é™åˆ¶ï¼ˆ8ä½ï¼‰`ï¼šç”¨äºæ£€æµ‹è·¯ç”±å¾ªç¯ï¼Œç±»ä¼¼IPV4çš„TTLã€‚ \n\næºåœ°å€ï¼ˆ128ä½ï¼‰ï¼šå‘é€èŠ‚ç‚¹çš„åœ°å€ã€‚ \n\nç›®æ ‡åœ°å€ï¼ˆ128ä½ï¼‰ï¼šæ¥æ”¶èŠ‚ç‚¹çš„åœ°å€ã€‚\n\n\n\nIPV6æœ€å¤§è´Ÿè½½é•¿åº¦=å›ºå®š40å­—èŠ‚åŠ +65535=65575\n\n`IPV6æ‰©å±•å¤´éƒ¨`\n\n| ä¸‹ä¸€å¤´éƒ¨ç¼–å· |           ä¸‹ä¸€å¤´éƒ¨ç±»å‹           |                             è§£é‡Š                             |\n| :----------: | :------------------------------: | :----------------------------------------------------------: |\n|     `0`      |   `Hop-by-Hop Options Header`    |           `é€è·³é€‰é¡¹ï¼šè¿™äº›ä¿¡æ¯ç”±æ²¿é€”å„ä¸ªè·¯ç”±å™¨å¤„ç†`           |\n|      6       |        TCP (Upper Layer)         |                  è¯¥IPv6æŠ¥æ–‡çš„ä¸Šå±‚å°è£…æ˜¯TCP                   |\n|      17      |        UDP (Upper Layer)         |                  è¯¥IPv6æŠ¥æ–‡çš„ä¸Šå±‚å°è£…æ˜¯UDP                   |\n|      43      |          Routing Header          | è·¯ç”±é€‰æ‹©å¤´ï¼šç»™å‡ºä¸€ä¸ªè·¯ç”±å™¨åœ°å€åˆ—è¡¨ï¼Œç±»ä¼¼äº`IPv4çš„æ¾æ•£æºè·¯ç”±`å’Œè·¯ç”±è®°å½• |\n|      44      |         Fragment Header          |                  åˆ†æ®µï¼šå¤„ç†æ•°æ®æŠ¥çš„åˆ†æ®µé—®é¢˜                  |\n|     `50`     | `Encapsulating Security Payload` |               `ESPï¼šå°è£…å®‰å…¨è½½è·ï¼Œè·ŸIPSecç±»ä¼¼`               |\n|     `51`     |     `Authentication Header`      |                  `AHï¼šè®¤è¯å¤´ï¼Œè·ŸIPSecç±»ä¼¼`                   |\n|      60      |       Destination Options        |           ç›®æ ‡é€‰é¡¹ï¼šé€‰é¡¹ä¸­çš„ä¿¡æ¯ç”±ç›®æ ‡èŠ‚ç‚¹æ£€æŸ¥å¤„ç†           |\n\n#### IPV6ç›¸å…³åè®®\n\nå…³é”®è¯ï¼šRIPngã€OSPFv3ã€BGP4+\n\n![image-20250121153644146](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1b0dc9d401cde2313a2ae454e8fab434697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250114162210939](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1408a4407d2f11dfcc2a99ccc84ba94c697559838.png)\n\n![image-20250114162220571](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1b1ab24f7c8e32c15df63df6434a16c3697559838.png)\n\n![image-20250121154916937](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/417d200ad75ce4a6a36168f03f5f6dce697559838.png)\n\n![image-20250121155257440](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9502786687f51baf0a3522049fa1bf0e697559838.png)\n\n![image-20250121155335040](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/183966a978a7eeb9777a38fdaacc47e4697559838.png)\n\n![image-20250121155447578](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/08f605b8202ecd9716607ad19c419773697559838.png)\n\n#### IPV6åœ°å€\n\n`IPV6åœ°å€åŸºç¡€`\n\nIPv6åœ°å€`128ä½`ï¼Œé‡‡ç”¨`å†’å·åˆ†éš”çš„åå…­è¿›åˆ¶æ•°(8ç»„)`è¡¨ç¤ºã€‚\n\nä¾‹å¦‚:8000:`0000:0000:0000`:0123:4567:89AB:CDEF\n\nâ€‹      â‘    â‘¡   â‘¢   â‘£    â‘¤   â‘¥   â‘¦   â‘§\n\nä¹¦å†™è§„åˆ™ï¼š\n\næ¯ä¸ªå­—æ®µå‰é¢çš„0å¯ä»¥çœå»ï¼Œä¾‹å¦‚0123å¯ä»¥ç®€å†™ä¸º123.\n\nä¸€ä¸ªæˆ–å¤šä¸ªå…¨0å­—æ®µï¼Œå¯ä»¥ç”¨ä¸€å¯¹å†’å·â€œ`::`â€ä»£æ›¿\n\næœ‰æ•ˆ0ä½ä¸å¯ä»¥ç®€å†™ï¼Œ`åŒå†’å·åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚`\n\nä»¥ä¸Šåœ°å€å¯ç®€å†™ä¸º 8000`::`123:4567:89AB:CDEF\n\nIPv4å…¼å®¹åœ°å€å¯ä»¥å†™ä¸º âˆ·192.168.10.1\n\n\n\n`ipv6åœ°å€ä¹¦å†™`\n\nåˆæ³•å†™æ³•\n\n- 12AB:0000:0000:CD30:0000:0000:0000:0000/60\n- 12AB::CD30:0:0:0:0/60\n- 12AB:0:0:CD30::/60\n\néæ³•å†™æ³•\n\n- 12AB:0:0:CD3/60ï¼ˆåœ¨16ä½çš„å­—æ®µä¸­å¯ä»¥çœæ‰å‰é¢çš„0ï¼Œä½†ä¸èƒ½çœæ‰åé¢çš„0ï¼‰ï¼ˆ`çœç•¥äº†åé¢çš„0ï¼Œç¼ºé¡¹äº†ä»¥åŠCD30çš„æœ€åä¸€ä¸ª0`ï¼‰\n- 12AB::CD3/60ï¼ˆè¿™ç§è¡¨ç¤ºå¯å±•å¼€ä¸º12AB:`0000:0000:0000:0000:0000:0000`:`0`CD3ï¼‰\n- 12AB::CD30/60ï¼ˆè¿™ç§è¡¨ç¤ºå¯å±•å¼€ä¸º12AB:`0000:0000:0000:0000:0000:0000`:CD30ï¼‰\n\n\n\n`IPV6åœ°å€åˆ†ç±»`\n\n`å•æ’­åœ°å€`\n\n- å¯`èš`åˆå…¨çƒå•æ’­åœ°å€ï¼šè¿™ç§åœ°å€åœ¨å…¨çƒèŒƒå›´å†…æœ‰æ•ˆï¼Œç›¸å½“äºIPv4å…¬ç”¨åœ°å€ï¼ˆå‰ç¼€ä¸º0`01`ï¼‰ã€‚\n- `é“¾`è·¯æœ¬åœ°åœ°å€ï¼šç”¨äºåŒä¸€é“¾è·¯çš„ç›¸é‚»èŠ‚ç‚¹é—´çš„é€šä¿¡ï¼ˆå‰ç¼€ä¸º11111110`10`ï¼‰ï¼Œç»“åˆMACåœ°å€è‡ªåŠ¨ç”Ÿæˆã€‚\n- `ç«™`ç‚¹æœ¬åœ°åœ°å€ï¼šç›¸å½“äºIPv4ä¸­çš„ç§ç½‘åœ°å€ï¼ˆå‰ç¼€ä¸º11111110`11`ï¼‰ã€‚\n- `åŠ©è®°`ï¼š`1èš2é“¾3ç«™ï¼ˆ1[01]èš2[10]æ‹3[11]å æœ‰ï¼‰æœ€åä¸¤ä½äºŒè¿›åˆ¶`\n\n`ç»„æ’­åœ°å€`\n\n- IPv6ä¸­æ²¡æœ‰å¹¿æ’­åœ°å€ï¼Œå¹¿æ’­åŠŸèƒ½è¢«ç»„æ’­ä»£æ›¿ã€‚\n- IPv6ç»„æ’­åœ°å€çš„æ ¼å¼å‰ç¼€ä¸º`1111 1111`ï¼Œå³`FF00`å¼€å¤´ã€‚\n\n`ä»»æ„æ’­åœ°å€`\n\n- è¡¨ç¤ºä¸€ç»„æ¥å£çš„æ ‡è¯†ç¬¦ï¼Œé€šå¸¸æ˜¯`è·¯ç”±è·ç¦»æœ€è¿‘çš„æ¥å£ã€‚`\n- ä»»æ„æ’­åœ°å€ä¸èƒ½ç”¨ä½œæºåœ°å€ï¼Œè€Œåªèƒ½ä½œä¸ºç›®æ ‡åœ°å€ã€‚\n- ä»»æ„æ’­åœ°å€ä¸èƒ½æŒ‡å®šç»™IPv6ä¸»æœºï¼Œåªèƒ½æŒ‡å®šç»™IPv6è·¯ç”±å™¨ã€‚\n\n\n\n\n\n`ç‰¹æ®Šåœ°å€å¯¹æ¯”ï¼ˆIPV4  VS  IPV6ï¼‰`\n\n|                       IPv4åœ°å€                       |             IPv6åœ°å€              |\n| :--------------------------------------------------: | :-------------------------------: |\n|                    ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤º                    |  å¸¦å†’å·çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œ0å¯ä»¥å‹ç¼©  |\n|                åˆ†ä¸ºAã€Bã€Cã€Dã€E  5ç±»                |              ä¸åˆ†ç±»               |\n|                 ç»„æ’­åœ°å€224.0.0.0/4                  |         ç»„æ’­åœ°å€FF00::/8          |\n|              å¹¿æ’­åœ°å€ï¼ˆä¸»æœºéƒ¨åˆ†å…¨ä¸º1ï¼‰               |      ä»»æ„æ’­ï¼ˆé™äºå­ç½‘å†…éƒ¨ï¼‰       |\n|                   é»˜è®¤åœ°å€0.0.0.0                    |          `ä¸ç¡®å®šåœ°å€::`           |\n|                  å›ç¯åœ°å€127.0.0.1                   |           `å›ç¯åœ°å€::1`           |\n|                       å…¬å…±åœ°å€                       | å¯èšåˆå…¨çƒå•æ’­åœ°å€ FP(å‰ç¼€)=`001` |\n| ç§æœ‰åœ°å€10.0.0.0/8<br />127.16.0.0/12,192.168.0.0/16 |     `ç«™ç‚¹æœ¬åœ°åœ°å€ FEC0::/48`      |\n|             è‡ªåŠ¨ä¸“ç”¨IPåœ°å€169.254.0.0/16             |     `é“¾è·¯æœ¬åœ°åœ°å€ FE80::/48`      |\n|                          -                           |     â˜†`6to4éš§é“åœ°å€ 2002::/16`     |\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121160757852](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e408df899794f77c66cbe96133e54d5d697559838.png)\n\n![image-20250121160820727](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d549492f7b653391579772c066b33bb1697559838.png)\n\n![image-20250114180352110](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e96eb2ac0734a90a94da2c5e1ca35a89697559838.png)\n\n![image-20250114180401886](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0ef7c54cfce8fd94e2b04a502806d97f697559838.png)\n\n![image-20250121161501763](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a40eeec41017a6e968d8e30c0dd30ce5697559838.png)\n\n![image-20250114180428509](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c297708e50c2bc918a273fd5420bb307697559838.png)\n\n![image-20250121161613420](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/57464f9007af70c3ec79def6f86976f2697559838.png)\n\n![image-20250114180439709](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9cc767b0e0db3595e6b10d64b8c98f91697559838.png)\n\n#### è¿‡åº¦æŠ€æœ¯\n\n`åŒæ ˆæŠ€æœ¯`:åŒæ—¶è¿è¡ŒIPv4å’ŒIPv6ã€‚\n\n`éš§é“æŠ€æœ¯`:è§£å†³IPv6èŠ‚ç‚¹ä¹‹é—´é€šè¿‡IPv4ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚\n\n`ç¿»è¯‘æŠ€æœ¯`:è§£å†³çº¯IPv6èŠ‚ç‚¹ä¸çº¯IPv4èŠ‚ç‚¹ä¹‹é—´é€šè¿›è¡Œé€šä¿¡ã€‚\n\n\n\n`éš§é“æŠ€æœ¯`\n\n![image-20250114181848655](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/603b2df19fdccb9d8d001f5eff725e7b697559838.png)\n\n\n\n`åœ°å€ç¿»è¯‘æŠ€æœ¯`\n\nNAT-PT(Network Address Trannslation-Protocol Translator )\n\nå®ç°`çº¯IPv6èŠ‚ç‚¹ä¸çº¯IPv4èŠ‚ç‚¹`é—´çš„é€šä¿¡ã€‚\n\n  é™æ€NAT-PT 1:1\n\n  åŠ¨æ€NAT-PT M:N\n\n  åŸºäºç«¯å£NAPT-PT M:1\n\n![image-20250114181944803](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0eb5f2d6469eba441b368232fe32fc58697559838.png)\n\n![image-20250114181952413](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/214935d8dfd49f9268320634753c7d3c697559838.png)\n\n![image-20250114182005201](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/834093d7f13a7d2277752145b1590dd2697559838.png)\n\n#### æ€»ç»“\n\nIPv6æŠ¥æ–‡æ ¼å¼:æ¯ä¸ªå­—æ®µä½œç”¨(`è·³æ•°é™åˆ¶`)\n\nIPv6åœ°å€:128ä½ï¼Œå†’å·åå…­è¿›åˆ¶æ³•\n\nç®€å†™è§„åˆ™:æ¯æ®µä¸­`æ— æ•ˆé›¶ä½å¯ä»¥çœç•¥`ï¼Œè¿ç»­ä¸€æ®µæˆ–å¤šæ®µé›¶å¯ä»¥ç”¨::ä»£æ›¿ï¼Œä½†::åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚\n\nåœ°å€åˆ†ç±»:å•æ’­/ç»„æ’­/ä»»æ„æ’­ï¼Œä¸‰ç±»å•æ’­:`1èš2æ‹3å æœ‰`:\n\n\n\nè¿‡æ¸¡æŠ€æœ¯\néš§é“æŠ€æœ¯:è§£å†³IPv6èŠ‚ç‚¹ä¹‹é—´é€šè¿‡IPv4ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚\nåŒæ ˆæŠ€æœ¯:åŒæ—¶è¿è¡ŒIPv4å’ŒIPv6ã€‚\nç¿»è¯‘æŠ€æœ¯:è§£å†³çº¯IPv6èŠ‚ç‚¹ä¸çº¯IPv4èŠ‚ç‚¹ä¹‹é—´é€šè¿›è¡Œé€šä¿¡\n\n### ARPä¸RARPåè®®\n\nARPï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰æ˜¯å°†IPåœ°å€è§£æä¸ºä»¥å¤ªç½‘MACåœ°å€ï¼ˆç‰©ç†åœ°å€ï¼‰çš„åè®®ã€‚\n\nRARPåˆ†ç»„çš„æ ¼å¼ä¸ARPåˆ†ç»„åŸºæœ¬ä¸€è‡´ã€‚RARPä¸ºé€†åœ°å€è§£æåè®®ï¼Œä½œç”¨ä¸ARPç›¸åï¼Œç”¨äºå°†MACåœ°å€è½¬æ¢ä¸ºIPåœ°å€ã€‚\n\n![image-20250109234131114](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8a015273388d127c1bf95dfca9fdb42f697559838.png)\n\n![image-20250109235045582](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/86818dee7bd344a72746c1309489ea18697559838.png)\n\n![image-20250109235821377](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a4edb513a3c5cec2bef6a5f8091a308d697559838.png)\n\n![image-20250110001314555](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d5fc27879c5c0c482264ffa96e428f69697559838.png)\n\n![image-20250121162929475](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ce61707262738b8ca85d1a0f2b9bd486697559838.png)\n\n![image-20250110003159533](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/429c91d2f73b7959f95f6a430a2094ec697559838.png)\n\n![image-20250121163023107](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/986f16b0cf2cbcfd1021c5bb1f112fd8697559838.png)\n\n![image-20250110001300960](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/64b3a17c6d78e5ee1339819e2d4903e4697559838.png)\n\n![image-20250110003233664](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fa094eddce390409511cf88074fa1a7a697559838.png)\n\n![image-20250308230617592](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b9ad23ae2a8a8c82f6d45eece017761355933597.png)\n\nä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Š\n\nä¸Šå›¾å±•ç¤ºä¸»æœºAè¿›è¡Œarpè¯·æ±‚ä¸»æœºBçš„è¿‡ç¨‹\n\nä»¥ä¸‹æ¶‰åŠå›¾ç‰‡æ¥æºï¼š[ã€ARPåœ°å€è§£æåè®®ã€‘CSDNåšå®¢](https://blog.csdn.net/weixin_55807049/article/details/122652454)\n\n> 1ï¼‰ä¸»æœºAé¦–å…ˆä¼šæŸ¥è¯¢è‡ªèº«çš„ARPç¼“å­˜è¡¨ï¼Œæ˜¯å¦å­˜åœ¨ç›®æ ‡ARPç¼“å­˜æ¡ç›®ã€‚\n>\n> æœ‰ç¼“å­˜æ¡ç›®åˆ™ç›´æ¥é€šä¿¡ã€‚`æ— ï¼Œåˆ™éœ€å‘é€ARPè¯·æ±‚æŠ¥æ–‡ï¼Œæ¥è·å–å¯¹æ–¹çš„macåœ°å€ã€‚`ä»¥å¹¿æ’­çš„å½¢å¼å‘é€ã€‚\n\n  äºŒå±‚å¤´éƒ¨ä¸­ï¼Œç›®æ ‡macåœ°å€**å…¨Få¡«å……ï¼ˆFF-FF-FF-FF-FFï¼‰**ï¼Œåœ¨è¯¥[å¹¿æ’­åŸŸ](https://so.csdn.net/so/search?q=å¹¿æ’­åŸŸ&spm=1001.2101.3001.7020)èŒƒå›´å†…æ‰€æœ‰ä¸»æœºéƒ½ä¼šæ”¶åˆ°è¯¥ARPè¯·æ±‚æŠ¥æ–‡ã€‚ï¼ˆä»¥ä¾¿äºæ­£ç¡®çš„ä¸»æœºèƒ½æ”¶åˆ°è¯¥æŠ¥æ–‡ï¼‰\n\nâ€‹    ä¸‰å±‚å¤´éƒ¨ä¸­ï¼Œç›®æ ‡macåœ°å€æœªçŸ¥ï¼Œä¸ºäº†ä¿è¯æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼Œ**å…¨0å¡«å……ï¼ˆ00-00-00-00-00ï¼‰ã€‚ï¼ˆå‘Šè¯‰å¯¹æ–¹pc1ï¼ŒæœªçŸ¥ä½ çš„macåœ°å€ï¼‰**\n\n![img](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/109ee03d3f47548818ae93020f3f8cba697559838.png)\n\n> 2ï¼‰ç”±äºä¸»æœºAå·²ç»å°†è‡ªå·±çš„æºIPã€æºmacåœ°å€å‘é€ç»™ä¸»æœºBï¼Œä¸»æœºBæ”¶åˆ°åï¼ŒæŠŠä¸»æœºAçš„IPã€MACå¯¹åº”ä¿¡æ¯å¡«å…¥è‡ªå·±çš„ARPç¼“å­˜ä¸­(ARPå­¦ä¹ )ï¼Œä¼šå°†è‡ªèº«ipã€è‡ªèº«macå¡«å……ï¼Œä»¥å•æ’­çš„å½¢å¼å“åº”ï¼ˆARP REPLYï¼‰ã€‚\n\n> 3ï¼‰å½“ä¸»æœºAæ”¶åˆ°å“åº”åï¼Œå‰¥ç¦»äºŒå±‚å¤´éƒ¨ï¼Œå°†ä¸‰å±‚å¤´éƒ¨ä¸­çš„æºIPåœ°å€ã€æºMacåœ°å€çš„æ˜ å°„å…³ç³»ï¼Œè®°å½•åœ¨è‡ªå·±çš„ARPç¼“å­˜è¡¨ä¸­ã€‚ï¼ˆæ­¤æ—¶ï¼ŒåŒæ–¹éƒ½æœ‰å¯¹æ–¹çš„ARPæ¡ç›®ï¼Œå¯ä»¥æ­£å¸¸é€šä¿¡äº†ã€‚ï¼‰\n\n`ä¸ºäº†é˜²æ­¢ARPç¼“å­˜è¡¨é¡¹è¿‡å¤§ï¼Œæ¯ä¸ªARPæ¡ç›®éšè—è¿è¡Œä¸€ä¸ª1200sçš„å®šæ—¶å™¨ï¼Œå¦‚æœåœ¨æ­¤æ—¶é—´å†…æ”¶åˆ°è¯¥æ¡æ˜“çš„æŠ¥äº§åˆ™åˆ·æ–°è¯¥è¡¨é¡¹ï¼Œå¦‚æœæ²¡æ”¶åˆ°ï¼Œåˆ™æ¸…ç©ºè¯¥æ¡ç›®`\n\nARPç¼“å­˜è¡¨çš„æ¡ç›®ä¸æ˜¯ä¸€ç›´ç¼“å­˜åœ¨é‡Œé¢çš„ï¼Œä¼šéš”ä¸€æ®µæ—¶é—´è¿›è¡Œåˆ·æ–°ï¼Œæˆ–è€…å°†é•¿æ—¶é—´ä¸è¿›è¡Œé€šä¿¡çš„æ¡ç›®æ¸…é™¤æ‰ã€‚\n\n\n\n`å…è´¹arp`\n\n![image-20250110005546893](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ba3dc6e9ad939d9f01ee1d5b64646fe9697559838.png)\n\n`ARPä»£ç†`\n\n![image-20250121164207930](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fca401893a03c5fe89ef2add207cdb26697559838.png)\n\næ€»ç»“ï¼š\n\n![image-20250121164249904](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/436e523fb695fee3e3c1bf06ed020b40697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250121164431556](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dc4b00101daf20c17093107747d10a8b697559838.png)\n\n![image-20250110005617290](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/66d4973656d28e713ea9df6280af8488697559838.png)\n\n![image-20250121164637811](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4282ec1e1b824536ccc1a5c9e478bf71697559838.png)\n\n![image-20250121164745701](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2ed38c258ed692ffdce4bdbce175f24d697559838.png)\n\n![image-20250121165101222](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ef005d9febfcd7d68c0da5b934eb488f697559838.png)\n\n![image-20250121165150204](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fc866caaa12110ef62fccc4aa19be4ab697559838.png)\n\n![image-20250121165203325](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7775d3dbfb8826e3f5af4d550394667e697559838.png)\n\n### ICMPå’ŒICMPv6\n\n#### ICMP\n\nICMP(Internet Control Message Protocol,Internetæ§åˆ¶æŠ¥æ–‡åè®®),`åè®®å·ä¸º1`,å°è£…åœ¨IPæŠ¥æ–‡ä¸­ï¼Œç”¨æ¥`ä¼ é€’å·®é”™ã€æ§åˆ¶ã€æŸ¥è¯¢`ç­‰ä¿¡æ¯ï¼Œå…¸å‹åº”ç”¨`ping/tracert`ä¾èµ–ICMPæŠ¥æ–‡ã€‚\n\n`ICMPæŠ¥æ–‡ç±»å‹ä¸ä»£ç `\n\n![image-20250121165333288](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/60aa798bebf11bd384b79dc750925c4c697559838.png)\n\n`ICMPåº”ç”¨-ping`\n\n![image-20250110185542495](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dfffdc5d9e88f8422753f31c372278b9697559838.png)\n\n`Echo Request`å’Œ`Echo Reply`åˆ†åˆ«ç”¨æ¥æŸ¥è¯¢å’Œå“åº”æŸäº›ä¿¡æ¯ï¼Œè¿›è¡Œå·®é”™æ£€æµ‹ã€‚\n\n\n\n`ICMPåº”ç”¨-tracert`\n\ntracertï¼ˆtracerouteï¼‰æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç½‘ç»œå·¥å…·ï¼Œç”¨äºè¿½è¸ªåˆ†ææ•°æ®åŒ…åœ¨ç½‘ç»œä¸­ä¼ è¾“æ—¶ç»è¿‡çš„è·¯å¾„ï¼Œå¹¶è¾“å‡ºåˆ°è¾¾ç›®æ ‡åœ°å€çš„å»¶è¿Ÿæƒ…å†µå’ŒèŠ‚ç‚¹ä¿¡æ¯ã€‚\n\n![image-20250110185619352](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ada02c6ce0a897751a6c4b703cdaef91697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250121165530701](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0f158c0ff9482b3e673a328592b6f7be697559838.png)\n\n![image-20250121165619565](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c8b846d11375f78fbcc265f56a922c7e697559838.png)\n\n![image-20250121165701697](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ecf1c27e916e41e0b063599044a8e434697559838.png)\n\n![image-20250121170142092](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0d63713b967651d2dfdd0789328ab0f3697559838.png)\n\n![image-20250110185656795](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8c91dfa2f73bc73504f29d3b2121bf5c697559838.png)\n\n![image-20250110185709784](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8fa11ed82e73a0560509e396f1cf0600697559838.png)\n\n![image-20250121170228849](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/877198cd3c5e1f3488195c5815a22bc5697559838.png)\n\n![image-20250121170305858](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/50006644caaf5bb54ffcba87f3bb7fcd697559838.png)\n\n![image-20250110185734015](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c63445aca14d216a7788ff80ef2c9810697559838.png)\n\n#### ICMPv6\n\nICMPv6æŠ¥æ–‡åˆ†ä¸ºä¸¤ç±»:`å·®é”™æŠ¥æ–‡`å’Œ`ä¿¡æ¯æŠ¥æ–‡`\n\n![image-20250121171356182](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a7cf4839e9814a7ac09cedb471dc34b9697559838.png)\n\nICMPv6å·®é”™æŠ¥æ–‡åº”ç”¨-Path MTUå‘ç°\n\n![image-20250121171430558](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2cf27366e65fee99a4482179ddf852ff697559838.png)\n\nICMPV6ä¿¡æ¯æŠ¥æ–‡åº”ç”¨-Ping\n\n![image-20250121171512361](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c5e8f056bd77fd00cc5bbd732f6d0237697559838.png)\n\n#### NDP\n\nIPv6é‚»å±…å‘ç°åè®®(Neighbor Discovery Protocol,ç®€ç§°NDPæˆ–ND)å®šä¹‰äº†5ç§ç±»å‹çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬`è·¯ç”±å™¨å®£å‘Šã€è·¯ç”±å™¨è¯·æ±‚ã€è·¯ç”±é‡å®šå‘ã€é‚»å±…è¯·æ±‚å’Œé‚»å±…å®£å‘Š`ï¼Œå…·ä½“å¦‚ä¸‹åŠŸèƒ½:\n\n`è·¯ç”±å™¨å‘ç°`:å‘ç°é“¾è·¯ä¸Šçš„è·¯ç”±å™¨ï¼Œè·å¾—è·¯ç”±å™¨é€šå‘Šçš„ä¿¡æ¯ã€‚\n\n`æ— çŠ¶æ€è‡ªåŠ¨é…ç½®`:é€šè¿‡è·¯ç”±å™¨é€šå‘Šçš„åœ°å€å‰ç¼€ï¼Œç»ˆç«¯è‡ªåŠ¨ç”ŸæˆIPv6åœ°å€ã€‚\n\n`é‡å¤åœ°å€æ£€æµ‹`:è·å¾—åœ°å€åï¼Œè¿›è¡Œåœ°å€é‡å¤æ£€æµ‹ï¼Œç¡®ä¿åœ°å€ä¸å­˜åœ¨å†²çªã€‚\n\n`åœ°å€è§£æ`:è¯·æ±‚ç›®çš„ç½‘ç»œåœ°å€å¯¹åº”çš„æ•°æ®é“¾è·¯å±‚åœ°å€ï¼Œç±»ä¼¼IPv4çš„ARP\n\n`é‚»å±…çŠ¶æ€è·Ÿè¸ª`:é€šè¿‡NDPå‘ç°é“¾è·¯ä¸Šçš„é‚»å±…å¹¶è·Ÿè¸ªé‚»å±…çŠ¶æ€ã€‚\n\n`å‰ç¼€é‡ç¼–å€`:è·¯ç”±å™¨å¯¹æ‰€é€šå‘Šçš„åœ°å€å‰ç¼€è¿›è¡Œçµæ´»è®¾ç½®ï¼Œå®ç°ç½‘ç»œé‡ç¼–å€ã€‚\n\n`é‡å®šå‘`:å‘ŠçŸ¥å…¶ä»–è®¾å¤‡ï¼Œåˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„æ›´ä¼˜ä¸‹ä¸€è·³ã€‚\n\n\n\nNDPæŠ¥æ–‡ç±»å‹åŠåŠŸèƒ½\n\n![image-20250121171731499](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2e7e6844d6d1bdf3450eb4e6e0c72658697559838.png)\n\n`IPV6åœ°å€è‡ªåŠ¨é…ç½®çš„åˆ†ç±»`\n\næ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®ã€æœ‰çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®\n\n![image-20250121171837766](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d5ab293722c00726ba242e7746cf95ce697559838.png)\n\n![image-20250121171856245](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ddd772bb503764574702665310afeb38697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121171920664](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e80342c69c7cc8bf1de3a5f2144ee062697559838.png)\n\n### IPç»„æ’­æŠ€æœ¯ä¸MPLS\n\n#### ç»„æ’­æŠ€æœ¯\n\n![image-20250121172221375](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7af346b7eca0201ea8809a5e13973bbf697559838.png)\n\n`ç»„æ’­ç½‘ç»œæ¶æ„`\n\n![image-20250121172304777](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cc5567dfbaae6e493d5e4d58eeb6cb05697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121172327181](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a336303f4e767d14cc026cf6ff6c429a697559838.png)\n\n#### MPLS\n\n![image-20250121172402958](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e95c49c02a2bd0049ede6be0a92debf0697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121172441314](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1bc70aa29a7ed30df9911e45d02d6bdb697559838.png)\n\n![image-20250121172426086](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dabe8f9d42faf554b613bd4dfbd5d2e9697559838.png)\n\n### TCPå’ŒUDPåè®®\n\n#### TCPå’ŒUDPä»‹ç»\n\nä¼ è¾“å±‚ä¸»è¦ä¸¤ä¸ªä¼ è¾“åè®®ï¼Œåˆ†åˆ«æ˜¯`TCPå’ŒUDP`\n\n(1)TCPæ˜¯`é¢å‘è¿æ¥çš„`ï¼Œä¸€èˆ¬ç”¨äºä¼ è¾“æ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œä¸”å¯¹å¯é æ€§è¦æ±‚é«˜çš„åº”ç”¨ã€‚`[æ–‡ä»¶]`\n\n(2)UDPæ˜¯ä¸€ç§`ä¸å¯é çš„ã€æ— è¿æ¥çš„åè®®`ã€‚ç”¨äºä¼ è¾“æ•°æ®é‡å¤§ï¼Œå¯é æ€§è¦æ±‚ä¸é«˜ä½†è¦æ±‚é€Ÿåº¦å¿«çš„åœºæ™¯`ã€éŸ³è§†é¢‘ã€‘`\n\n![image-20250110212939627](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4beeb2160ceb1e4091a99653827c7f07697559838.png)\n\n![image-20250121172737701](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2eba23cb9b898dcee94e3244b9325f2b697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20250121172801732](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1765b4cb94104ebfd70d827fa9e02e54697559838.png)\n\n![image-20250121172839115](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d4309f634bb26b8a8555b8dec45a648a697559838.png)\n\n##### TCPæŠ¥æ–‡æ ¼å¼\n\nTCPå¤´éƒ¨æœ€å¤§å¯ä»¥æ‰©å±•åˆ°60å­—èŠ‚\n\n![image-20250110213135891](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b0296a8b0a54e3eaf0389e5b9f539b7c697559838.png)\n\n![image-20250121173004890](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c612b9161be921cbce3e4ebaba51aa27697559838.png)\n\n\n\n![image-20250121172944906](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ba85b6b7ac7fd2dbb5caeff295e593c5697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20250121173038530](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/257c602ad27dcf6586436960bc8f5a92697559838.png)\n\n![image-20250121173049421](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bfe85c19dc43368e03e84d68f816c980697559838.png)\n\n![image-20250121173127226](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/52d7869684df78d243f94e5040dfeb9a697559838.png)\n\n\n\n`TCPä¼ªé¦–éƒ¨`\n\nTCPä¼ªé¦–éƒ¨æœ¬è´¨æ˜¯IPå¤´çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…å«æºç›®`IPåœ°å€ï¼Œåè®®å·ã€TCPæŠ¥å¤´å’Œç”¨æˆ·æ•°æ®ï¼Œä¸»è¦ç”¨äºTCPæ ¡éªŒ\nå’Œè®¡ç®—`ã€‚\n\n![image-20250110213240250](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/19e8404b166261bd76ab2b6022f76a84697559838.png)\n\n##### UDPæŠ¥æ–‡æ ¼å¼\n\nUDPçš„æœ€å¤§è´Ÿè½½ä¹Ÿå°±æ˜¯é™¤å¼€æŠ¥å¤´çš„æ•°æ®ï¼ˆ65527Bï¼‰ï¼ŒæŠ¥æ–‡æ€»é•¿åº¦16ä½\n\n![image-20250110213354799](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b6e059aeae5cadf93275efd5717fa7db697559838.png)\n\nä¸TCPç›¸æ¯”ï¼Œåšäº†å¾ˆå¤§ç²¾ç®€ï¼Œçœç•¥è¯¸å¤šæ§åˆ¶å­—æ®µã€‚\n\n\n\nä¾‹é¢˜\n\n![image-20250121173222558](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/38c0975a115a4487839db2117d7be597697559838.png)\n\n![image-20250121173251974](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/34594e9db9eb8a43e938c8429b5db2e0697559838.png)\n\n![image-20250110213542956](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/abf32ab3ab21fe3da175fbfb2c34c903697559838.png)\n\n![image-20250110213553876](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/13f0ce203bd2c1de35440a6b22110919697559838.png)\n\n![image-20250110213640938](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5c7d4abdc5327d4377f571a76ad5150b697559838.png)\n\n#### TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹\n\nACK=0è¡¨ç¤ºç¬¬ä¸€æ¬¡åˆå§‹åŒ–æŠ¥æ–‡\n\n![image-20250110214938164](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d126074c182e821e3d6d0f307c54177c697559838.png)\n\n![image-20250110215002504](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5168a085d4a34ed383a0a1a931fabcd1697559838.png)\n\ntcpå››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥\n\n![image-20250110215031125](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6ca9ed981c20c455cad1d0b6c8c9017b697559838.png)\n\nä¾‹é¢˜\n\n![image-20250121173336741](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5c1586b46857034e81fd6b19bf372995697559838.png)\n\n![image-20250121173357040](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bf201b0e0a20176c0a5169eeaae99d79697559838.png)\n\n![image-20250121173523751](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7c1690212d6df6ac20b8657dfc3de2a5697559838.png)\n\n![image-20250121173556562](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8f6bdeb2fee4befc4bd8bae25b1f5fd5697559838.png)\n\n![image-20250110224547515](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7365e2e7ea352fa4514c852d83ddc545697559838.png)\n\n![image-20250110224559739](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d17f23de9f3c3b5b249fac9190b55ea8697559838.png)\n\n![image-20250110224606522](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d77549f17499640cc55074293b421c3d697559838.png)\n\n\n\nTCPåºåˆ—å·åŠç¡®è®¤å·ï¼ˆæ§åˆ¶æŠ¥æ–‡ï¼‰\n\n![image-20250121173719505](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/be0a4ab30dc62e4de8d37eb5fb303b0d697559838.png)\n\nTCPåºåˆ—å·åŠç¡®è®¤å·ï¼ˆæ•°æ®æŠ¥æ–‡ï¼‰\n\n![image-20250121173739221](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bb68026e1f1942c3d7299efc0147f356697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250121173910482](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bdef4b486d2cfd136c37d5050904e964697559838.png)\n\n![image-20250121174023423](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ce6372e8039d5b5c65ba159303fcdfa7697559838.png)\n\n![image-20250121174119576](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2af093814ac448d4edaec62da5656ba2697559838.png)\n\n#### æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶\n\næµé‡æ§åˆ¶:ä¸ºäº†`é˜²æ­¢å‘é€æ–¹å‘é€é€Ÿåº¦è¿‡å¿«`,å¯¼è‡´æ¥æ”¶æ–¹å¤„ç†ä¸è¿‡æ¥ï¼Œé€ æˆä¸¢åŒ…é‡ä¼ ï¼Œæµªè´¹ç½‘ç»œèµ„æºã€‚\nTCPæµé‡æ§åˆ¶æœºåˆ¶:`å¯å˜å¤§å°çš„æ»‘åŠ¨çª—å£`\n\n![image-20250121174156964](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4db2028c3a2d59f0ca5bd2d09edbf80d697559838.png)\n\n##### TCPæ»‘åŠ¨çª—å£æœºåˆ¶\n\n![image-20250111161004816](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5e616351887bc30f539928530c173a53697559838.png)\n\n[5åˆ†é’Ÿäº†è§£æ»‘åŠ¨çª—å£åè®®-[iiiiiFå‘€]](https://www.bilibili.com/video/BV1Go4y1M7uZ/?share_source=copy_web&vd_source=ee3bb79c6a500b8fb62eb9daab5faedb)\n\nè¿™ä¸ªåšä¸»è®²çš„å¾ˆç»†ï¼Œéå¸¸ok\n\n\n##### TCPæ‹¥å¡æ§åˆ¶\n\næœ‰äº†æµé‡æ§åˆ¶ï¼Œå¯ä»¥è°ƒèŠ‚å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„èŠ‚å¥ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰æ‹¥å¡æ§åˆ¶?\n`æµé‡æ§åˆ¶`:åœ¨ABä¸¤ä¸ªç«¯ç‚¹è¿›è¡Œã€‚\n`æ‹¥å¡æ§åˆ¶`:åœ¨ABå’Œæ‰€æœ‰ç½‘ç»œèŠ‚ç‚¹ä¸­è¿›è¡Œã€‚\n\n![image-20250111161423511](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/592021218c70b02e00422e2d4fbc3271697559838.png)\n\n![image-20250313203616320](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2fc1768fa76da9cdfc6682e86e74a9aa697559838.png)\n\nå¿«é‡ä¼ å¿«æ¢å¤\n\n![image-20250121174442783](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a91ac520b630ab05b654296bdf811e21697559838.png)\n\n![image-20250121174724106](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6188344d104053b06e17bc2537264b2b697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20250121174747214](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/122e570ba36b3141127c2eb79ebbfd30697559838.png)\n\n![image-20250121174839227](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a90227a733230c1737ec238ccadfd51a697559838.png)\n\n![image-20250121174900591](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/819d8769870bcfdc5277a671bc5527b8697559838.png)\n\n![image-20250111174716163](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1685f82e448f0ca9d78716b319e6b9f2697559838.png)\n\n![image-20250121174945549](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f094585498c026e9d9edb0307ccbe636697559838.png)\n\n![image-20250121175008427](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1ac42df0d29f4d656af464689531361f697559838.png)\n\n![image-20250111174828561](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0d34eeef93df0ca427da27db29661bd2697559838.png)\n\n![image-20250111174906019](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fb9bf7c295d273734599735b0f93b5c1697559838.png)\n\n![image-20250111175901443](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7867190f668b2d6b2600bddad3b3d5ee697559838.png)\n\n#### é‡ç‚¹åè®®ç«¯å£å·æ€»ç»“\n\n![image-20250111185854662](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8b010f49e254726ad1da49413dcc4491697559838.png)\n\n`æºç«¯å£éšæœºåˆ†é…`ï¼Œç›®æ ‡ç«¯å£ä½¿ç”¨çŸ¥åç«¯å£ã€‚\n\nåº”ç”¨å®¢æˆ·ç«¯ä½¿ç”¨çš„`æºç«¯å£`ä¸€èˆ¬ä¸ºç³»ç»Ÿä¸­æœªä½¿ç”¨çš„ä¸”`å¤§äº1024`\n\nç›®çš„ç«¯å£å·ä¸ºæœåŠ¡å™¨ç«¯åº”ç”¨æœåŠ¡å™¨çš„è¿›ç¨‹ï¼Œå¦‚telnetä¸º23\n\nä¸»æµç½‘ç»œåè®®é­”åŠ›å›¾\n\n![image-20250121175149552](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a76c8638c95d46ecf05f7b139b6c57cf697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/43cf78e4a824595f089b9975a1c0699a697559838.png)\n\nä¾‹é¢˜\n\n![image-20250121175259525](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/796af30263cd5172812c094ecbf47171697559838.png)\n\n![image-20250121175320116](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/24c472fe48d81e7b14573ef81927e759697559838.png)\n\n![image-20250111185937294](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e19e5719a37c7ebe2d089f68659cdb97697559838.png)\n\n![image-20250111185951907](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b36b319a263136f3937383306de7671f697559838.png)\n\n![image-20250111190030104](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2739072c83e81bd86598bd365272541e697559838.png)\n\n![image-20250111190038417](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ea0a805c5519214b2e5bc6b3034d4555697559838.png)\n\n![image-20250111190051828](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fb537cd1b6e692ff1a3e84cfe0bdff72697559838.png)\n\n![image-20250111190110694](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1ea217af29c55af7b8fed5224f220a3c697559838.png)\n\n### è·¯ç”±åè®®\n\n#### è·¯ç”±è¡¨\n\nä»€ä¹ˆæ˜¯è·¯ç”±\n\nå½“è·¯ç”±å™¨(æˆ–å…¶ä»–ä¸‰å±‚è®¾å¤‡)æ”¶åˆ°ä¸€ä¸ªIPæ•°æ®åŒ…æ—¶ï¼Œä¼šæŸ¥çœ‹æ•°æ®åŒ…çš„IPå¤´éƒ¨ä¸­çš„`ç›®çš„IPåœ°å€`ï¼Œå¹¶åœ¨è·¯ç”±è¡¨ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œåœ¨åŒ¹é…åˆ°`æœ€ä¼˜çš„è·¯ç”±`åï¼Œå°†æ•°æ®åŒ…æ‰”ç»™è¯¥è·¯ç”±æ‰€`æŒ‡å‡ºæ¥å£`æˆ–è€…`ä¸‹ä¸€è·³`ã€‚\n\n![image-20250111193104684](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3ad847504d8f5bd204fb3330fdca5cc5697559838.png)\n\n`è·¯ç”±å™¨å·¥ä½œåŸç†`\n\nå»ºç«‹å¹¶ç»´æŠ¤è·¯ç”±è¡¨RIB.\n\n  ç›´è¿è·¯ç”±:è·¯ç”±å™¨`æœ¬åœ°æ¥å£`æ‰€åœ¨ç½‘æ®µï¼Œ\n\n  é™æ€è·¯ç”±:`æ‰‹å·¥é…ç½®`çš„è·¯ç”±æ¡ç›®ï¼Œ\n\n  åŠ¨æ€è·¯ç”±:è·¯ç”±å™¨ä¹‹é—´é€šè¿‡`åŠ¨æ€è·¯ç”±åè®®`å­¦ä¹ åˆ°çš„è·¯ç”±\n\næ ¹æ®è·¯ç”±è¡¨è¿›è¡Œ`æ•°æ®è½¬å‘`\n\n\n\n`æŸ¥çœ‹è·¯ç”±è¡¨`\n\n![image-20250111193545150](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/47bf773e98845180f51533a97c33c49f697559838.png)\n\n| è·¯ç”±åè®®æˆ–è·¯ç”±ç§ç±» | ç›¸åº”è·¯ç”±çš„ä¼˜å…ˆçº§ |\n| :----------------: | :--------------: |\n|       DIRECT       |        0         |\n|        OSPF        |        10        |\n|       IS-IS        |        15        |\n|       STATIC       |        60        |\n|        RIP         |       100        |\n|     OSPF AS E      |       150        |\n|     OSPF NSSA      |       150        |\n|        IBGP        |       255        |\n|        EBGP        |       255        |\n\n`è¿­ä»£è·¯ç”±`\n\n![image-20250121175436255](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5c55e8d11c6eb577c404fb21dcceb417697559838.png)\n\nIPè·¯ç”±æŸ¥æ‰¾çš„æœ€é•¿åŒ¹é…åŸåˆ™\n\n![image-20250121175512329](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c40c2dd980903e8b22313c0bab033c3a697559838.png)\n\n![image-20250121175535834](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2c6e99a65013035c5fb239393ea3fffa697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20250121175618017](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1428f34869a0eced4d2183f337b8852e697559838.png)\n\n![image-20250121175634072](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d565758d611af67823e6c93ec165bddc697559838.png)\n\n![image-20250121175928992](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/99c6fb1b63d8dc80982189f639abc360697559838.png)\n\n![image-20250121175954850](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/df6c8f2744144aed9e97470f235fd997697559838.png)\n\n#### é™æ€è·¯ç”±å’Œé»˜è®¤è·¯ç”±\n\nä¼—æ‰€å‘¨çŸ¥ï¼šä¸åŒç½‘æ®µä¹‹é—´æ˜¯æ— æ³•é€šä¿¡çš„ï¼Œ10ç½‘æ®µæƒ³å»åˆ°R2æˆ–R3æ€ä¹ˆåŠå‘¢\n\n![image-20250113153334426](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/911f456dc9db418efcf25e62892df15f697559838.png)\n\n![image-20250113154122422](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8823f2bc4e3e67d4bae75249631b8469697559838.png)\n\né™æ€è·¯ç”±é…ç½®\n\n`é™æ€è·¯ç”±çš„é…ç½®(å…³è”ä¸‹ä¸€è·³IPçš„æ–¹å¼ )` `90%éƒ½ä¼šç”¨è¿™ä¸ªæ–¹å¼æ¥é…ç½®`\n\n[Router]ip route-static ç½‘ç»œå· æ©ç  `ä¸‹ä¸€è·³IPåœ°å€`\n\né™æ€è·¯ç”±çš„é…ç½®(å…³è”å‡ºæ¥å£çš„æ–¹å¼)\n\n[Router]ip route-static ç½‘ç»œå· æ©ç  `å‡ºæ¥å›—`\n\né™æ€è·¯ç”±çš„é…ç½®(å…³è”å‡ºæ¥å£å’Œä¸‹ä¸€è·³IPçš„æ–¹å¼ )\n\n[Router] ip route-static ç½‘ç»œå· æ©ç  `å‡ºæ¥å›—` `ä¸‹ä¸€è·³IPåœ°å€`\n\né…ç½®ç¤ºä¾‹\n\n> å­ç½‘æ©ç å¯ä»¥é€‰æ‹©255.255.255.0ä¹Ÿå¯ä»¥é€‰æ‹©24,ä¸ä»…é™äº24æ©ç ï¼Œå°±æ˜¯å…¶ä»–æ©ç ä¹Ÿå¯ä»¥é€‚ç”¨\n\n```ini\n#å»å¾€100ç½‘æ®µ\n[R1] ip route-static 192.168.100.0 255.255.255.0 192.168.12.2\n```\n\n```ini\n#å»å¾€200ç½‘æ®µ\n[R1] ip route-static 192.168.200.0 24 192.168.13.2\n```\n\n![image-20250113154441981](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d8cf12de5a3892b8258ea29ac177f9b9697559838.png)\n\n\n\n`é»˜è®¤è·¯ç”±`\n\n![image-20250113154604147](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b3442a79b8dbd285ef9ca8711f816a0a697559838.png)\n\n![image-20250113154740736](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/847d7bd86876a3fc4a707b1b97554370697559838.png)\n\n\n\n`é™æ€è·¯ç”±ä¸é»˜è®¤è·¯ç”±ç‰¹ç‚¹` \n\n> `é™æ€è·¯ç”±`\n>\n>   é…ç½®ç®€å•\n>\n>   æ‰‹å·¥é…ç½®ï¼Œå¯æ§æ€§é«˜\n>\n>   èŠ‚çœç½‘ç»œå¸¦å®½\n>\n>   `ç½‘ç»œå¤§ï¼Œå·¥ä½œé‡å¤§ï¼Œæ¯”å¦‚é…ç½®1000æ¡é™æ€è·¯ç”±`\n>\n>   `ç½‘ç»œæ•…éšœï¼Œæ— æ³•å“åº”æ‹“æ‰‘åŠ¨æ€å˜åŒ–`\n\n\n\n> `é»˜è®¤è·¯ç”±`\n>\n>   é»˜è®¤è·¯ç”±æ˜¯ä¸€ç§ç‰¹æ®Šçš„é™æ€è·¯ç”±ï¼Œèµ°æŠ•æ— è·¯çš„é€‰æ‹©\n>\n>   é…ç½®ç®€å•ï¼Œç®€åŒ–ç®¡ç†\n>\n>   é™ä½è·¯ç”± CPUã€å†…å­˜èµ„æº\n>\n>   `ç”¨å¤„:ç½‘ç»œå‡ºå£è·¯ç”±å™¨/é˜²ç«å¢™/æ ¸å¿ƒäº¤æ¢æœº`\n\n`ç­‰ä»·è·¯ç”±å’Œæµ®åŠ¨è·¯ç”±`\n\n![image-20250121180122191](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/782ac0f9958f13ec96e6048700d7f343697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20250121180152821](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2905d2a2faaf7cac3022f68e3e7d7e01697559838.png)\n\n![image-20250121180337804](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/31ffacd72ccbd25da40b24a537562ac2697559838.png)\n\n#### è·¯ç”±åè®®åˆ†ç±»\n\nè·¯ç”±åè®®åˆ†ç±»æ–¹å¼:`æŒ‰è·ç¦»çŸ¢é‡å’Œé“¾è·¯çŠ¶æ€åˆ†ç±»ã€æŒ‰å†…éƒ¨ç½‘å…³å’Œå¤–éƒ¨ç½‘å…³åè®®`\n\nè·ç¦»çŸ¢é‡è·¯ç”±åè®®ä¸€èˆ¬åŸºäº`Bellman-Fordç®—æ³•`ï¼Œé“¾è·¯çŠ¶æ€è·¯ç”±åè®®åŸºäº`Dijkstraç®—æ³•`(ä¹Ÿå«SPFæœ€çŸ­è·¯å¾„ä¼˜å…ˆç®—æ³•)\n\n![image-20250121180459846](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bfdab2de18cb05b53e3c92663781f182697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121180526280](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/96f3458a2a075574df7ae6ff9b4c4a2b697559838.png)\n\n![image-20250121180604787](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8bac99a8b66afda6d2dbcad400e3d73d697559838.png)\n\n![image-20250121180616597](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/376893c03de50e8d307fd220b5e84b82697559838.png)\n\n#### RIP\n\nRIP(Routing Information Protocol,`è·¯ç”±ä¿¡æ¯åè®®`)\n\n`å†…éƒ¨ç½‘å…³åè®®ï¼Œè·ç¦»çŸ¢é‡è·¯ç”±åè®®ã€‚`\n\nåä¸ºè®¾å¤‡ä¸Šè·¯ç”±ä¼˜å…ˆçº§ä¸º100ã€‚\n\nè®¡ç®—è·³æ•°:`æœ€å¤§15è·³ï¼Œ16è·³ä¸å¯è¾¾`ï¼Œ`ä¸€èˆ¬ç”¨äºå°å‹ç½‘ç»œ`ã€‚\n\nå‡ ä¸ªæ—¶é’Ÿ:30så‘¨æœŸæ€§æ›´æ–°è·¯ç”±è¡¨ã€180sæ— æ›´æ–°è¡¨ç¤ºä¸å­˜åœ¨ã€300såˆ é™¤è·¯ç”±è¡¨ã€‚\n\næ”¯æŒç­‰ä»·è´Ÿè½½å‡è¡¡å’Œé“¾è·¯å†—ä½™ï¼Œä½¿ç”¨`UDP 520`ç«¯å£ã€‚\n\n`RIPv2`æ”¯æŒè‡ªåŠ¨è·¯ç”±æ±‡æ€»\n\n![image-20250121180658953](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b25cc419f07e472a54fabbed5e58118a697559838.png)\n\n`RIPv1ä¸RIPv2å¯¹æ¯”`â˜…éå¸¸é‡è¦è¦è®°å¿†\n\n![image-20250121180739760](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0c310b600dae9cfe2f835fa60d44033a697559838.png)\n\n`è·ç¦»çŸ¢é‡è·¯ç”±åè®®`\n\n![image-20250113183210420](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ac96a134f42ff16cc5f2946fedc2659c697559838.png)\n\n`è·ç¦»çŸ¢é‡è·¯ç”±åè®®ç‰¹ç‚¹`\n\n![image-20250113183234191](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/01b15a26094312dcb585cafe778afb0e697559838.png)\n\n`RIPè·¯ç”±çš„åº¦é‡å€¼`\n\nRIPä»¥`è·³æ•°`ä½œä¸ºåº¦é‡å€¼ï¼Œè™½ç„¶ç®€å•ï¼Œä½†äº‹å®ä¸Šä¸ç§‘å­¦ï¼Œå¦‚ä¸‹å›¾\n\n![image-20250113183339658](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fd3dbfed57aeb25a9632e137321a3689697559838.png)\n\n![image-20250113183356617](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d07746dc21024dac39bc2ba4e2adfbc1697559838.png)\n\n`è·¯ç”±çš„ä¼˜å…ˆçº§,è¶Šå°è¶Šä¼˜å…ˆ`\n\n![image-20250113183503295](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2b6e8225fa284299b9f9b5701ad294d2697559838.png)\n\n`RIPé˜²ç¯æœºåˆ¶` `ç®€å•ç†è§£ä¸€ä¸‹å°±è¡Œï¼Œä¸ç”¨èƒŒï¼Œå¤§å‚éƒ½åˆ äº†`\n\nâ‘ æœ€å¤§è·³æ•°:å½“ä¸€ä¸ªè·¯ç”±æ¡ç›®å‘é€å‡ºå»ä¼šè‡ªåŠ 1è·³ï¼Œè·³æ•°æœ€å¤§ä¸º16è·³ï¼Œæ„å‘³ç€ä¸å¯è¾¾ã€‚\nâ‘¡æ°´å¹³åˆ†å‰²:ä¸€æ¡è·¯ç”±ä¿¡æ¯ä¸ä¼šå‘é€ç»™ä¿¡æ¯çš„æ¥æºã€‚\nâ‘¢åå‘æ¯’åŒ–çš„æ°´å¹³åˆ†å‰²:æŠŠä»é‚»å±…å­¦ä¹ åˆ°çš„è·¯ç”±ä¿¡æ¯è®¾ä¸º16è·³ï¼Œå†å‘é€ç»™é‚£ä¸ªé‚»å±…\nâ‘£æŠ‘åˆ¶å®šæ—¶å™¨å’Œè§¦å‘æ›´æ–°ä¹Ÿå¯ä»¥é˜²æ­¢ç¯è·¯ã€‚\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121180909999](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/08087c4b2239c06b3a17466bc34ab46b697559838.png)\n\n![image-20250121180929000](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3cafedbd838229c2b46d0cdd7b0ae75b697559838.png)\n\n![image-20250121181000472](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/42d480681de14d36f2cde64c283cf52b697559838.png)\n\n![image-20250121181027273](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4fe5edb5c9e55e5ff5ba9d59b404b149697559838.png)\n\n#### OSPF\n\nOSPF(Open Shortest Path Firstï¼Œå¼€æ”¾å¼æœ€çŸ­è·¯å¾„ä¼˜å…ˆåè®®)æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„è·¯ç”±åè®®ã€‚\n\nOSPFæ˜¯ä¸€ç§`å†…éƒ¨ç½‘å…³åè®®IGP`ï¼Œä¹Ÿæ˜¯`é“¾è·¯çŠ¶æ€`è·¯ç”±åè®®ï¼Œæ”¯æŒVLSMï¼Œé€šè¿‡å¸¦å®½è®¡ç®—æœ€ä½³è·¯å¾„ï¼Œé‡‡ç”¨`Dijkstra`ç®—æ³•(ä¹Ÿå«SPFæœ€çŸ­è·¯å¾„ç®—æ³•)\n\nåä¸ºè®¾å¤‡OSPFåè®®ä¼˜å…ˆçº§Internal10ï¼ŒExternal150(import-route)\n\næ”¯æŒåœ¨`ABR/ASBRæ‰‹å·¥è·¯ç”±æ±‡æ€»`ï¼Œä¸æ”¯æŒè‡ªåŠ¨æ±‡æ€»ã€‚\n\n##### OSPFç‰¹ç‚¹\n\n![image-20250121181218171](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/644999f341be3aeaf8bd6e0d67f8cc9c697559838.png)\n\nHELLOå®šæ—¶å™¨\n\n![image-20250121181245766](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6a7c965e4450e30d4429320dc1bdd980697559838.png)\n\n![image-20250121181611376](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b1030639c756c68e14856b2e813d1905697559838.png)\n\n##### DRä¸BDRçš„ä½œç”¨\n\n![image-20250121182038202](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d50db3190803e5bfed4413b8376156b5697559838.png)\n\n![image-20250121182110321](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/53e167bea7cae273ea487e34cd61d592697559838.png)\n\n![image-20250121182128207](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/55563429b6f7971a4a946a044c30dc82697559838.png)\n\n![image-20250121182201557](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a83c9772330ec8abb8dd8b44ec66f9a1697559838.png)\n\n##### LSA\n\n![image-20250121182316573](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/db27588495675fd5f7c09e7ffb134837697559838.png)\n\nä¾‹é¢˜ï¼š\n\n![image-20250121182336080](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/acb4eef86f1727716902af9c28e08bc8697559838.png)\n\n![image-20250121182347237](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f3fea0f1b4166c6604b97a8b90608dd0697559838.png)\n\n##### OSPF Cost\n\nOSPFä½¿ç”¨Costâ€œå¼€é”€â€ä½œä¸ºè·¯ç”±åº¦é‡å€¼ã€‚\n\nOSPFæ¥å£`cost=100M/æ¥å£å¸¦å®½`ï¼Œå…¶ä¸­100Mä¸ºOSPFå‚è€ƒå¸¦å®½(reference-bandwidth)ï¼Œå¯ä¿®æ”¹ã€‚\n\næ¯ä¸€ä¸ªæ¿€æ´»OSPFçš„æ¥å£éƒ½æœ‰ä¸€ä¸ªcostå€¼ã€‚\n\nä¸€æ¡OSPFè·¯ç”±çš„costç”±è¯¥è·¯ç”±ä»èµ·æº ä¸€è·¯åˆ°è¾¾æœ¬åœ°çš„æ‰€æœ‰`å…¥æ¥å£costå€¼çš„æ€»å’Œã€‚`\n\n![image-20250113184357981](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9e937c30f67d48fd726b20211337e509697559838.png)\n\n##### OSPFåŒºåŸŸæ¦‚å¿µ\n\næ‰€æœ‰ééª¨å¹²åŒºåŸŸå¿…é¡»ä¸éª¨å¹²åŒºåŸŸç›´è¿ã€‚\n\n![image-20250121182509802](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b93350a394aa49d859be18566dd116c4697559838.png)\n\n##### OSPFè·¯ç”±å™¨è§’è‰²\n\n![image-20250113184521839](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/43796d814e0c6cb2b91c2f69f41ebdc2697559838.png)\n\nåŒºåŸŸå†…è·¯ç”±å™¨IR     Internal Router\n\nåŒºåŸŸè¾¹ç•Œè·¯ç”±å™¨ABR  Area Border Router\n\néª¨å¹²è·¯ç”±å™¨BR       Backbone Router\n\nASè¾¹ç•Œè·¯ç”±å™¨ASBR   AS Boundary Router\n\n\n\n`æ€»ç»“`\n\nè§¦å‘å¼æ›´æ–°ã€åˆ†å±‚è·¯ç”±ï¼Œæ”¯æŒå¤§å‹ç½‘ç»œã€‚\n\n`Area 0.0.0.0æˆ–è€…Area 0`æ¥è¡¨ç¤ºéª¨å¹²åŒºåŸŸï¼Œä¸æ˜¯åŒºåŸŸ1\n\nç‚¹å¯¹ç‚¹ç½‘ç»œä¸Šæ¯10ç§’å‘é€ä¸€æ¬¡helloï¼Œåœ¨NBMAç½‘ç»œæ¯30ç§’å‘é€ä¸€æ¬¡ï¼ŒDeadtimeä¸ºhelloæ—¶é—´4å€ã€‚\n\nOSPFç³»ç»Ÿå†…å‡ ä¸ªç‰¹æ®Šç»„æ’­åœ°å€:\n  224.0.0.1-åœ¨æœ¬åœ°å­ç½‘çš„æ‰€æœ‰ä¸»æœºã€‚\n  224.0.0.2-åœ¨æœ¬åœ°å­ç½‘çš„æ‰€æœ‰è·¯ç”±å™¨,\n  `224.0.0.5-è¿è¡ŒOSPFåè®®çš„è·¯ç”±å™¨ã€‚`\n  `224.0.0.6-OSPFæŒ‡å®š/å¤‡ç”¨æŒ‡å®šè·¯ç”±å™¨DR/BDR.`  \n\n  224.0.0.9-RIPv2è·¯ç”±å™¨\n\n  224.0.0.18 VRRPï¼ˆè™šæ‹Ÿè·¯ç”±å™¨å†—ä½™åè®®ï¼‰\n\n  ç›®æ ‡åœ°å€224.0.0.5æŒ‡æ‰€æœ‰è·¯ç”±å™¨ï¼Œç”¨äºå‘ç°å»ºç«‹é‚»å±…ã€è¿˜ç”¨äºé€‰å‡ºåŒºåŸŸå†…çš„æŒ‡å®šè·¯ç”±å™¨DRå’Œå¤‡ä»½æŒ‡å®šè·¯ç”±å™¨BDR(DR/BDRç»„æ’­åœ°å€æ˜¯224.0.0.6)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121182537638](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ecf0ddec23d933f63809b441d858a78c697559838.png)\n\n![image-20250121182556758](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/de22db13072f7c99a4f2bcbb55fe86aa697559838.png)\n\n![image-20250121182608970](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/196495bc2c618435793f8d9a78719264697559838.png)\n\n![image-20250121182825567](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e8d234376e1c180afc498217399096a0697559838.png)\n\n![image-20250121182849234](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4e64dc62de5da5d20a3bc6425529c19a697559838.png)\n\n![image-20250121182910010](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f273ebeb71f5d3e50134b1bc07179507697559838.png)\n\n![image-20250121182923986](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2b1a2717971899beec3387b637df0867697559838.png)\n\n![image-20250121183003336](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d0d3be6b78d99b9df3dd8b7b78a1a636697559838.png)\n\n#### OSPFå’ŒRIPçš„åŒºåˆ«\n\n(1)RIPä½¿ç”¨è·ç¦»çŸ¢é‡ç®—æ³•ï¼Œé€šè¿‡å­¦ä¹ å…¶ä»–è·¯ç”±å™¨å‘é€çš„è·¯ç”±è¡¨ä¿¡æ¯ï¼Œç”Ÿæˆè·¯ç”±è¡¨ã€‚OSPFé¦–å…ˆè·å–å…¨ç½‘çš„æ‹“æ‰‘ä¿¡æ¯ï¼Œç„¶ååˆ©ç”¨SPFæœ€çŸ­è·¯å¾„ä¼˜å…ˆ(ä¹Ÿå«Diikstra)ç®—æ³•ï¼Œç”Ÿæˆè·¯ç”±è¡¨ã€‚\n(2)RIPä¸€èˆ¬é€‚ç”¨äºå°å‹ç½‘ç»œï¼ŒOSPFé€‚ç”¨äºä¸­å¤§å‹ç½‘ç»œã€‚\n(3)RIPå’ŒOSPFéƒ½æ˜¯åŠ¨æ€è·¯ç”±åè®®ï¼Œå¯ä»¥æ ¹æ®æ‹“æ‰‘å˜åŒ–ï¼Œæ›´æ–°è·¯ç”±è¡¨ã€‚RIPé…ç½®ç®€å•ï¼ŒåŠŸèƒ½ä¹Ÿç›¸å¯¹ç®€å•ï¼Œæ”¶æ•›é€Ÿåº¦æ…¢ï¼Œå®¹æ˜“å½¢æˆç¯è·¯ã€‚OSPFæ”¯æŒå±‚æ¬¡åŒ–ç»„ç½‘ã€ç½‘ç»œä¼˜åŒ–ã€ç­‰ä»·è´Ÿè½½å‡è¡¡ã€æŠ¥æ–‡åŠ å¯†ç­‰åŠŸèƒ½ã€‚\n\n\n\n#### BGP\n\nBGP(Border Gateway Protocol,è¾¹ç•Œç½‘å…³åè®®)`å¤–éƒ¨ç½‘å…³åè®®`,ç”¨äºä¸åŒè‡ªæ²»ç³»ç»ŸASä¹‹é—´ï¼Œå¯»æ‰¾æœ€ä½³è·¯ç”±ã€‚\n\n![image-20250121183026225](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ed0ac839fa7cc8326d073c716bb70795697559838.png)\n\n\n\n`BGPå››ä¸ªæŠ¥æ–‡`\n\n![image-20250121183059548](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/96c76799215a8f5957b7ee576ced27ea697559838.png)\n\n\n\n`BGPé€‰è·¯è§„åˆ™`\n\næœ€é‡è¦çš„æ—¶å€™2,3,4,5,6\n\n1. ä¸¢å¼ƒä¸‹ä¸€è·³ä¸å¯è¾¾çš„è·¯ç”±ã€‚\n2. ä¼˜é€‰`Preference_Value`æœ€é«˜çš„è·¯ç”±ï¼ˆç§æœ‰å±æ€§ï¼Œä»…æœ¬åœ°æœ‰æ•ˆï¼‰ã€‚\n3. ä¼˜é€‰`Local_Preference`æœ€é«˜çš„è·¯ç”±ã€‚\n4. ä¼˜é€‰`æ‰‹åŠ¨èšåˆ > è‡ªåŠ¨èšåˆ > network > import > ä»å¯¹ç­‰ä½“å­¦åˆ°çš„ã€‚`\n5. ä¼˜é€‰`AS_Path`æœ€çŸ­çš„è·¯ç”±ã€‚\n6. èµ·æºç±»å‹`IGP > EGP > Incompleteã€‚`\n7. å¯¹äºæ¥è‡ªåŒä¸€ASçš„è·¯ç”±ï¼Œä¼˜é€‰`MEDæœ€å°`çš„ã€‚\n8. ä¼˜é€‰ä»EBGPå­¦æ¥çš„è·¯ç”±ï¼ˆ`EBGP > IBGP`ï¼‰ã€‚\n9. ä¼˜é€‰ASå†…éƒ¨`IGPçš„Metricæœ€å°`çš„è·¯ç”±ã€‚\n10. ä¼˜é€‰`Cluster_List`æœ€çŸ­çš„è·¯ç”±ã€‚\n11. ä¼˜é€‰`Originator_IDæœ€å°`çš„è·¯ç”±ã€‚\n12. ä¼˜é€‰`Router_IDæœ€å°`çš„è·¯ç”±å™¨å‘å¸ƒçš„è·¯ç”±ã€‚\n13. ä¼˜é€‰`IPåœ°å€æœ€å°`çš„é‚»å±…å­¦æ¥çš„è·¯ç”±ã€‚\n\n![image-20250121183213948](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4d7b838e11720fb9dc1e8eb07aeaeb9d697559838.png)\n\n#### ISIS\n\n![image-20250121183247749](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e1d2c49597a7d1fcca715be77cb9cf95697559838.png)\n\n\n\n![image-20250113185552699](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7aaea67c056aa3d08e9bcf125ac06279697559838.png)\n\n\n\n#### ä¾‹é¢˜\n\n![image-20250121183628812](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a7047f3d9eb36613b78ae2a30cdffa60697559838.png)\n\n![image-20250121183656628](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e7357ab2b93689d9d78ea0310e6ed375697559838.png)\n\n![image-20250121183959632](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/88726691e7055eeb84d2bea8e658d94b697559838.png)\n\n![image-20250121184019360](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e9a4c7d1fa39f689c2b2d717fa7e324d697559838.png)\n\n![image-20250121184055047](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/60f9501e859ac4af9675216f42bf3681697559838.png)\n\n![image-20250121184111075](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a595787bea7fa08e9c884e0c6b0f89a8697559838.png)\n\n![image-20250113185610836](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/605ecf7b49b3ada21b62b41dcc7464cc697559838.png)\n\n![image-20250113185840813](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/12ee891af5bbd09f3ed6f427a33e82fd697559838.png)\n\n![image-20250113185852204](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/147c55b08b7756282b124b1133b7f99b697559838.png)\n\n![image-20250113185859896](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9015bce2f10aa32a9f59747214b8316b697559838.png)\n\n![image-20250113185915044](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b68d940d3dbc837968164d88ddc2d7df697559838.png)\n\nè¦åˆ†ä¸¤ç§æƒ…å†µAAæ˜¯é…ospfä¹‹åï¼ŒDDæ˜¯é…OSPFä¹‹å‰ï¼Œå…·ä½“çœ‹ä¸‹é¢çš„router-idé€‰ä¸¾è§„åˆ™\n\n![image-20250113190006730](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a669ea53053da7cc4586722b2d043088697559838.png)\n\n![image-20250113190148856](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/22c57f58367158721b1cbf61edc388f0697559838.png)\n\n![image-20250113190307130](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1cab29d743811383f99a8a061a8c7526697559838.png)\n\n![image-20250113190455915](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fbfe08094da56bc5bd20ffb36a1896b8697559838.png)\n\n![image-20250113190524734](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1e20cefc2ffcb2461467901a64875198697559838.png)\n\n### internetåº”ç”¨\n\n#### è¿œç¨‹ç™»å…¥\n\n![image-20250121184344540](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7300061ae2cb3b947c3158dc4a076d40697559838.png)\n\nä¾‹é¢˜\n\n![image-20250121184413042](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dac70829d6c3ff69d18854647b2726c3697559838.png)\n\n![image-20250121184428810](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/54fc830fc71999283b6cb124395583fb697559838.png)\n\n#### æ–‡ä»¶ä¼ è¾“åè®®\n\nå…³é”®è¯ï¼šftpï¼Œtftp\n\n![image-20250121184506889](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8395e3a9536a2285dea6824b90435bc0697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250121184535025](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/aa395be942efaea06411929b2c35afb9697559838.png)\n\n![image-20250121184554855](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f5cd77d52ca192308fe9db84f795127e697559838.png)\n\n#### ç”µå­é‚®ä»¶åè®®\n\nå…³é”®è¯ï¼špop3ï¼Œsmtpï¼Œimap\n\n![image-20250121184613851](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/19b7e8930179d43cc7c96e9a8c3b62a9697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250121184713733](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/59f08480b6dd43546946521c687163cd697559838.png)\n\n![image-20250121184736035](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/da08a120567668afb835a7aafb416cf3697559838.png)\n\n![image-20250121184804544](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3ff6a4303505a60315c59896258575ef697559838.png)\n\n![image-20250121184814833](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7ae997b281724babac320a0742305604697559838.png)\n\n#### è¶…æ–‡æœ¬ä¼ è¾“åè®®HTP\n\n![image-20250121184838438](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/af3bbc97175f4d6f12049630e6f44432697559838.png)\n\n#### ç½‘é¡µè®¿é—®è¿‡ç¨‹\n\n![image-20250121184918495](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c9f37881daa0d61d172618200fe99039697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121184939120](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eca70f7f4f7da414e071d84eda68bee5697559838.png)\n\n![image-20250121184955529](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e885aca2b4c45ab86a58faf517f6832e697559838.png)\n\n#### P2Påº”ç”¨\n\n![image-20250121185026968](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3bcdee7f0b678cd402ae719bca099cf9697559838.png)\n\n![image-20250121185040005](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2d55ae98b6a7e66348eb7ec625ac7a28697559838.png)\n\n![image-20250121185055086](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bc53b746bbd59f064d0b26247ea963ff697559838.png)\n\n![image-20250121185112033](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d13a02545a12bdb0529378feb0ae3836697559838.png)\n\n![image-20250121185125599](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b55b87e8532683d50714a7914eb1ab58697559838.png)\n\n\n\n### ç½‘ç»œäº’è”è®¾å¤‡\n\n#### æ€»ç»“\n\n![image-20241207175921195](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e9a957f2ba7f66784b28bedf5e6290e5697559838.png)\n\n#### ä¸­ç»§å™¨ä¸é›†çº¿å™¨\n\n![image-20241207180425414](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cf7665aded0ef4e45e426c5654e22a5c697559838.png)\n\n![image-20241207180433761](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1b1a6a47c921e6d74751ebac3dad702d697559838.png)\n\né›†çº¿å™¨å·¥ä½œåŸç†\n\n![image-20241207180459249](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/028db5f97d816d10d15d1ae66fe23eef697559838.png)\n\n![image-20241207180548592](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f775a9b592660daa3485ac5c86eec8a6697559838.png)\n\nå°±æ˜¯å› ä¸ºä¼šå‡ºç°å¯¹æ‰€æœ‰æ¥å£è¿›è¡Œæ³›æ´ªï¼Œè¿™æ ·æ‰€æœ‰çš„ç»ˆç«¯éƒ½ä¼šæ”¶åˆ°æ•°æ®ï¼Œä¼šé€ æˆæ•°æ®æ³„éœ²\n\n#### ç½‘æ¡¥ä¸äº¤æ¢æœº\n\n![image-20241207180625649](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e677b43141274f16df126666f678004a697559838.png)\n\näº¤æ¢æœºå·¥ä½œåŸç†ï¼ˆäº¤æ¢æœºå¯»å€ï¼‰\n\n![image-20241207180825811](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a4122334f8b5b3ca774938fed2385d30697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0bd6793bc08cdb1e8f1f34b893adbc7f697559838.png)\n\n![image-20241207180900252](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5e485f053f922a52571c3e6f292e52cf697559838.png)\n\n![image-20241207180949114](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/18a101e44c71b63c7c392d752c9d13ea697559838.png)\n\n![image-20241207180958416](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2a976a8ff62edf08cab553a201af9dc6697559838.png)\n\n![image-20241207181007405](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/03ff688070843207e28ed017109d0535697559838.png)\n\n![image-20241207181014888](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/127227bb5feeddc2c6ca0df04b911471697559838.png)\n\n![image-20241207181023612](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ee5d3d0b31f0e33635699d842af8d534697559838.png)\n\nä¾‹é¢˜\n\n![image-20241207181139171](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7cf948e370bc579c3bc6e7fa63a73061697559838.png)\n\n#### è·¯ç”±å™¨ä¸ä¸‰å±‚äº¤æ¢æœº\n\n`è·¯ç”±å™¨`\n\n![image-20250121185348310](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5007d289acdaf5b1d58c6945a3e05656697559838.png)\n\n`ä¸‰å±‚äº¤æ¢æœº`\n\n![image-20250121185421097](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/afd40d43336d32af730585a7ca9c44e7697559838.png)\n\n![image-20241207181402810](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bb3b921257d052473c3dc990626fdb84697559838.png)\n\nä¾‹é¢˜\n\n![image-20241207181436829](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/116719b8f1c28b2b1e2d4b264fb55ab7697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/39b274f74a5cacf04195c9319adced72697559838.png)\n\n\n\n`è·¯ç”±å™¨è·Ÿä¸‰å±‚äº¤æ¢æœºæœ‰ä»€ä¹ˆåŒºåˆ« ?`\n\nå…¸å‹å›­åŒºç½‘æ‹“æ‰‘ç»“æ„\n\n![image-20250121185454541](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/95aebd05c5490ad6209b0f37284e438a697559838.png)\n\nå¯¹æ¯”\n\n![image-20241207181944064](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9043ab82da3ce59b96617046fa1835d6697559838.png)\n\n#### å¤šå±‚äº¤æ¢æœºå’Œç½‘å…³è®¾å¤‡\n\nç½‘å…³æ˜¯äº’è¿ç½‘ç»œä¸­æ“ä½œåœ¨OSIä¼ è¾“å±‚ä¹‹ä¸Šçš„è®¾æ–½ã€‚\n\nç½‘å…³çš„ä¸»è¦åŠŸèƒ½:\nÂ·(1)è¿æ¥ç½‘ç»œå±‚ä¹‹ä¸Šæ‰§è¡Œ`ä¸åŒåè®®çš„å­ç½‘`ï¼Œç»„æˆå¼‚æ„å‹çš„äº’è”ç½‘ã€‚\nÂ·(2)ç½‘å…³èƒ½å¯¹äº’ä¸å…¼å®¹çš„`é«˜å±‚åè®®è¿›è¡Œè½¬æ¢`ã€‚\nÂ·(3)ä¸ºäº†å®ç°å¼‚æ„å‹è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œç½‘å…³è¦å¯¹ä¸åŒä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€åº”ç”¨å±‚åè®®è¿›è¡Œ`ç¿»è¯‘å’Œè½¬æ¢`ã€‚\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/148493e33d96e584b380eb64229e66f3697559838.png)\n\n![image-20241207192432316](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/02f80c788ec223651f03683e67aa4138697559838.png)\n\nSDNå¯ç¼–ç¨‹äº¤æ¢æœº\n\n![image-20241207193304482](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/639068169c56abf8d7ac14e8ecab201c697559838.png)\n\nç½‘ç»œæ¼”è¿›æ€»ç»“\n\n![image-20241207193339729](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1e9c082b6b57fe3109f98039a006a355697559838.png)\n\n### å­ç½‘åˆ’åˆ†ä¸“é¢˜VLSM  CIDR\n\n#### IPåœ°å€åŸºç¡€\n\n![image-20250121185704437](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b763d549cb42cd3cd3e8c5242c71833e697559838.png)\n\n![image-20250121190105190](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/43b0d7ac2ba117ee2137f9109e908b6a697559838.png)\n\n![image-20250121185822209](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/763b53ee09644979c048d275a85c1163697559838.png)\n\nç½‘ç»œæ©ç ï¼ˆå­ç½‘æ©ç ï¼‰\n\n![image-20250121190232985](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8f3fb6ae568afca8f94afcfaa65302bf697559838.png)\n\nä¸‰ç±»åœ°å€\n\n![image-20250121190310649](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/283cea532d0b7d7491b34ac914341ecb697559838.png)\n\n#### å­ç½‘åˆ’åˆ†VLSM\n\n![image-20250121190331654](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ea2d083862baa4c6fcafb6aee00ef1bf697559838.png)\n\n![image-20250121190358666](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ab1c86c742f85d89724fb75af7e62b38697559838.png)\n\nå­ç½‘åˆ’åˆ†åŸç†-ç½‘ç»œä½å‘ä¸»æœºä½å€Ÿä½(åˆ†é¥¼)\n\n![image-20250121190457040](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0c4e5a7451d261af619738d9afe59218697559838.png)\n\n#### è€ƒç‚¹\n\nè€ƒç‚¹1:å·²çŸ¥å­ç½‘æ•°é‡ï¼Œè¿›è¡Œå­ç½‘åˆ’åˆ†\n\n![image-20250121190541379](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bd647b2a94ba5d917178a34a7b748d36697559838.png)\n\n![image-20250121190554935](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0b0bae54da530317287f9efe2c391c2a697559838.png)\n\nè€ƒç‚¹2:å·²çŸ¥å­ç½‘ä¸»æœºæ•°é‡ï¼Œè¿›è¡Œå­ç½‘åˆ’åˆ†\n\n![image-20250121190625605](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fe917e576a18233c71b267442298b9fb697559838.png)\n\nè€ƒç‚¹3:æ©ç è½¬æ¢\n\n![image-20250121190653167](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2f498baee8c6df2e413cbcd68920a369697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250121190712348](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a245b17b5846eff5e8b623dcd1611d66697559838.png)\n\n![image-20250121190730188](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0ba9a4ca468acd6e3275a53c1db6e99c697559838.png)\n\n![image-20250121190749561](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fd9b77e2ecc126b64ddff523888f9ed5697559838.png)\n\n\n\nè€ƒç‚¹4:æ©ç ä½œç”¨ä½ç½®ä¸åœ°å€å—è®¡ç®—\n\n![image-20250121190835317](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/918afef2b2c00306482794dc6a324500697559838.png)\n\n![image-20250121190844643](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3ce08a1bd3adaed8378d8d2235799d01697559838.png)\n\n![image-20250121190854744](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9b18c91e3cbda6327e93f7321539c646697559838.png)\n\n![image-20250121190909572](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d69262730ccc20f5e1b2a16123ecff0c697559838.png)\n\nè€ƒç‚¹5:åº”ç”¨å‹å­ç½‘åˆ’åˆ†\n\n![image-20250121190937726](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/03990d3037002db9bb56d10196aa7f54697559838.png)\n\n![image-20250121190948501](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7f7a9c3fa2fe01cbc033ef7fc382407a697559838.png)\n\n![image-20250121191007625](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1da843246b3c1a92d93963269fb0264c697559838.png)\n\n![image-20250121191015672](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/137fb1425241a01eebec95e7b2ab316a697559838.png)\n\n![image-20250121191031466](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2cee03acef10b51598d19a9d4e7bad3c697559838.png)\n\n![image-20250121191038475](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c37816d3b38fb4f1ae68ac60aeb108a4697559838.png)\n\n![image-20250121191048733](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9b2f75eec73b65a213bb85e3c9151211697559838.png)\n\n![image-20250121191101880](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9b697c7db72a554b4e3e274209d5d678697559838.png)\n\n![image-20250121191115433](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4a4c5cac61c6db4d9b50e9dd336e2a5e697559838.png)\n\n![image-20250121191125532](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0f329745076e800c7791db05706d2566697559838.png)\n\n![image-20250121191133369](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1c0a9f0b43f7be50174ede15159bd56c697559838.png)\n\n![image-20250121191146988](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/128ec692dd1d04c5024d10406403bd6a697559838.png)\n\n![image-20250121191156602](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/648208f84da9be1c6428c23315fa18f0697559838.png)\n\n#### æ— ç±»åŸŸé—´è·¯ç”±CIDR\n\n![image-20250121191212796](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4c409444a044f9da5e87031b71199181697559838.png)\n\n![image-20250121191230389](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8545e81f685806a7bcb2810c36f0bc92697559838.png)\n\n![image-20250121191248332](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/deac2d07b7ec065e54a97236a3528744697559838.png)\n\n![image-20250121191259758](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a3977430a30a4ab7b73dcf750a9ee039697559838.png)\n\n![image-20250121191343729](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/20ca4507c02db349dcc31ce6f5be6c07697559838.png)\n\n![image-20250121191354069](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c1df28fc32b321b9be72eb9a72fbef7f697559838.png)\n\n#### IPv6å­ç½‘åˆ’åˆ†\n\n![image-20250121191420903](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/336ba3a669e230c753c61e6f71721ebd697559838.png)\n\n![image-20250121191436494](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/99b99843a1fa038e133b4704195e25a7697559838.png)\n\nè¦ç‚¹ï¼š\n\n![image-20250121191454055](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e43dc175e9b6fdf8c374a74c455d06d7697559838.png)\n\n2024å¹´5æœˆæ¡ˆä¾‹åˆ†æè¯•é¢˜ä¸€\n\n![image-20250121191508523](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ddad657ffdbad6550547a44a93b3d044697559838.png)\n\n![image-20250121191529187](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/36f7e0ee67ce73ade2e9c754ec154cc3697559838.png)\n\n![image-20250121191537314](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b590c175e7e55b19cdd426ac66ce8895697559838.png)\n\n![image-20250121191547301](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/99cac8b9364f24a5846abb8f9750ed46697559838.png)\n\n------------------------------------------------------------------------\n\n\n\n![image-20250121191621645](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/274b62287b40f007a91dfb5854cef5d0697559838.png)\n\n![image-20250121191639233](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ee7069381f21e6fd556ccf65f85c0995697559838.png)\n\n## ç½‘ç»œå®‰å…¨\n\n### ç½‘ç»œå®‰å…¨åŸºç¡€\n\n#### ç½‘ç»œå®‰å…¨å¨èƒç±»å‹\n\n(1)çªƒå¬:ä¾‹å¦‚æ­çº¿çªƒå¬ã€å®‰è£…é€šä¿¡ç›‘è§†å™¨å’Œè¯»å–ç½‘ä¸Šçš„ä¿¡æ¯ç­‰ã€‚\n\n(2)å‡å†’:å½“ä¸€ä¸ªå®ä½“å‡æ‰®æˆå¦ä¸€ä¸ªå®ä½“è¿›è¡Œç½‘ç»œæ´»åŠ¨æ—¶å°±å‘ç”Ÿäº†å‡å†’ã€‚\n\n(3)æµé‡åˆ†æ:å¯¹ç½‘ä¸Šä¿¡æ¯æµè§‚å¯Ÿå’Œåˆ†ææ¨æ–­å‡ºç½‘ä¸Šä¼ è¾“çš„æœ‰ç”¨ä¿¡æ¯ã€‚\n\n(4)é‡æ”¾æ”»å‡»:é‡å¤å‘é€ä¸€ä»½æŠ¥æ–‡æˆ–æŠ¥æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œä»¥ä¾¿äº§ç”Ÿä¸€ä¸ªè¢«æˆæƒæ•ˆæœã€‚\n(è§£å†³åŠæ³•ï¼š`éšæœºæ•°ã€æ—¶é—´æˆ³`)\n\n![image-20250114183751736](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/526fa6f4a4ba9e5e1f2e5f07b6044e4c697559838.png)\n\n(5)æ•°æ®å®Œæ•´æ€§ç ´å:æœ‰æ„æˆ–æ— æ„åœ°ä¿®æ”¹æˆ–ç ´åä¿¡æ¯ç³»ç»Ÿï¼Œæˆ–è€…åœ¨éæˆæƒå’Œä¸èƒ½ç›‘æµ‹çš„æ–¹å¼ä¸‹å¯¹æ•°æ®è¿›è¡Œ\n\n(6)åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡DDoS:å½“ä¸€ä¸ªæˆæƒå®ä½“ä¸èƒ½è·å¾—åº”æœ‰çš„å¯¹ç½‘ç»œèµ„æºçš„è®¿é—®æˆ–ç´§æ€¥æ“ä½œè¢«å»¶è¿Ÿæ—¶ï¼Œå°±å‘ç”Ÿäº†æ‹’ç»æœåŠ¡ã€‚DDoSæ˜¯å¯¹ä¼ ç»ŸDoSæ”»å‡»çš„å‘å±•ï¼Œé»‘å®¢æ§åˆ¶æµ·é‡è‚‰é¸¡å‘èµ·ã€‚`SYN-Flooding`ã€`HTTP-Flood/CC`\n\n(7)æ¶æ„è½¯ä»¶ï¼šæ¶æ„è½¯ä»¶æŒ‡ä»»ä½•æ•…æ„è®¾è®¡ä¼šæŸå®³è®¡ç®—æœºæˆ–ä¿¡æ¯ç³»ç»Ÿçš„æ–‡ä»¶æˆ–ç¨‹åºåŒ…æ‹¬æœ¨é©¬ç—…æ¯’ã€æµæ°“è½¯ä»¶ã€é—´è°è½¯ä»¶ã€å‹’ç´¢ç—…æ¯’ç­‰ï¼Œè¿™äº›æ¶æ„è½¯ä»¶å°†è‡ªå·±ä¼ªè£…æˆåˆæ³•æ–‡ä»¶ä»è€Œç»•è¿‡æ£€æµ‹ã€‚\n\n(8)webæ”»å‡»ï¼š åŒ…æ‹¬:è·¨ç«™è„šæœ¬(XSS)æ”»å‡»ã€SQLæ³¨å…¥æ”»å‡»ã€è·¨ç«™åŸŸè¯·æ±‚ä¼ªé€ (CSRF)æ”»å‡»ã€WebShellæ”»å‡»ä»¥åŠåˆ©ç”¨è½¯ä»¶æ¼æ´è¿›è¡Œçš„æ”»å‡»ã€‚\n\n(9)é«˜çº§å¯æŒç»­ï¼ˆAPTï¼‰æ”»å‡»ï¼šAPTæ”»å‡»æ˜¯å¤šç§å¸¸è§ç½‘ç»œ`æ”»å‡»æ‰‹æ®µ/æŠ€æœ¯çš„ç»„åˆ`ï¼Œé€šè¿‡é—´æ¥è¿‚å›æ–¹å¼ï¼Œæ¸—é€è¿›ç»„ç»‡å†…éƒ¨ç³»ç»Ÿæ½œä¼èµ·æ¥ï¼Œ`æŒç»­ä¸æ–­åœ°æ”¶é›†æ”»å‡»ç›®æ ‡ç›¸å…³çš„å„ç§ä¿¡æ¯`ï¼Œå…¶æ½œä¼å’Œæ”¶é›†ä¿¡æ¯æ—¶é—´`å¯èƒ½ä¼šé•¿è¾¾æ•°å¹´`ï¼Œå½“æ¡ä»¶æˆç†Ÿæ—¶ï¼Œä¼ºæœºè€ŒåŠ¨ï¼Œè¾¾åˆ°æ”»å‡»ç›®çš„ã€‚è¿™ç±»æ”»å‡»ä¸€èˆ¬æ˜¯`æœ‰ç»„ç»‡æœ‰é¢„è°‹çš„`ï¼Œæ”»å‡»`ç›®æ ‡ä¸€èˆ¬ä¸ºå›½å®¶å’Œæ”¿åºœéƒ¨é—¨çš„æ ¸å¿ƒä¿¡æ¯ç³»ç»Ÿ`ï¼Œä¸€æ—¦å¯¹è¿™äº›ç³»ç»Ÿé€ æˆç ´åï¼Œå¯¹å›½å®¶å®‰å…¨ã€ç¤¾ä¼šç§©åºã€ç»æµæ´»åŠ¨ä¼šé€ æˆ`éå¸¸å¤§çš„å½±å“`ã€‚\n\n\n\n#### ç½‘ç»œæ”»å‡»åˆ†ç±»\n\nè¢«åŠ¨æ”»å‡»ï¼š`å—…æ¢ã€çªƒå¬ã€æµé‡åˆ†æ`ï¼Œæœ€éš¾è¢«æ£€æµ‹ï¼Œé‡ç‚¹æ˜¯é¢„é˜²ï¼Œä¸»è¦æ‰‹æ®µæ˜¯åŠ å¯†\n\nä¸»åŠ¨æ”»å‡»ï¼š`å‡å†’ã€é‡æ”¾ã€æ•°æ®å®Œæ•´æ€§ç ´åã€åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡DDoSã€æ¶æ„è½¯ä»¶ã€webæ”»å‡»ã€é«˜çº§å¯æŒç»­ï¼ˆAPTï¼‰æ”»å‡»`ç­‰ï¼Œé‡ç‚¹æ˜¯`æ£€æµ‹è€Œä¸æ˜¯é¢„é˜²`ï¼Œæ‰‹æ®µæœ‰é˜²ç«å¢™ã€IDS\n\n\n\n#### ç½‘ç»œå®‰å…¨é˜²èŒƒæŠ€æœ¯\n\nç½‘ç»œå®‰å…¨æªæ–½ï¼š `æ•°æ®åŠ å¯†ã€æ•°å­—ç­¾åã€èº«ä»½è®¤è¯ã€é˜²ç«å¢™ã€ç‰¹å¾è¿‡æ»¤`ç­‰ã€‚ \n\n(1)æ•°æ®åŠ å¯†ã€‚\n\n(2)æ•°å­—ç­¾åï¼šç”¨æ¥éªŒè¯æ•°æ®æˆ–ç¨‹åºçš„`å®Œæ•´æ€§`ã€‚\n\n(3)èº«ä»½è®¤è¯ï¼šè®¤è¯ç”¨æˆ·çš„åˆæ³•æ€§ï¼Œä¾‹å¦‚`å¯†ç æŠ€æœ¯ã€åˆ©ç”¨äººä½“ç”Ÿç†ç‰¹å¾(å¦‚æŒ‡çº¹)è¿›è¡Œè¯†åˆ«ã€æ™ºèƒ½ ICå¡ã€æ•°å­—è¯ä¹¦`ç­‰ã€‚\n\n(4)é˜²ç«å¢™ï¼šé˜²ç«å¢™æ˜¯ä½äºä¸¤ä¸ªç½‘ç»œä¹‹é—´çš„å±éšœï¼Œè¿›è¡Œ`è®¿é—®æ§åˆ¶`ã€‚\n\n(5)å…¥ä¾µæ£€æµ‹å’Œé˜»æ–­ï¼šå¯¹ç½‘ç»œæµé‡æˆ–åº”ç”¨è®¿é—®è¿›è¡Œæ”»å‡»ç‰¹å¾åŒ¹é…å’Œè¿‡æ»¤ï¼Œé˜»æ–­éæ³•æ”»å‡»ï¼Œå¸¸è§è®¾å¤‡æœ‰ å…¥ä¾µé˜²æŠ¤ç³»ç»Ÿ (IPS)ã€Web  åº”ç”¨é˜²ç«å¢™ (WAF)  ç­‰ã€‚\n\n(6)è®¿é—®æ§åˆ¶ï¼šåœ¨éª¨å¹²ç½‘ç»œè®¾å¤‡æˆ–è€…æœåŠ¡å™¨é…ç½®è®¿é—®æ§åˆ¶ç­–ç•¥ï¼Œå…è®¸æˆ–è€…æ‹’ç»æŸäº›æºå¯¹ç›®æ ‡çš„è®¿é—®ï¼Œ å®ç°ç½‘ç»œå®‰å…¨é˜²æŠ¤ã€‚\n\n(7)è¡Œä¸ºå®¡è®¡ã€‚å¯¹ç½‘ç»œè¡Œä¸ºæˆ–è€…ç”¨æˆ·æ“ä½œè¿›è¡Œå®¡è®¡ï¼Œé˜»æ–­éæ³•æ“ä½œæˆ–è€…é«˜å±æ“ä½œè¡Œä¸ºï¼Œå¸¸è§è®¾å¤‡ï¼š`æ•°æ®åº“å®¡è®¡ç³»ç»Ÿã€å ¡å’æœºã€ä¸Šç½‘è¡Œä¸ºç®¡ç†ç³»ç»Ÿ`ç­‰ã€‚\n\n#### ç­‰çº§ä¿æŠ¤\n\n![image-20250214160836444](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/49e7c621cfbb4523a5a520a23b1d1c53697559838.png)\n\n![image-20250214160852003](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/14871f5cc9f7e1f750eb4a495874ead8697559838.png)\n\n![image-20250214160904400](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a17f33ba212dd7b6b764c81cd5c34322697559838.png)\n\n![image-20250214160918127](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/94cc1715a01714a4128faa2a9330f828697559838.png)\n\n#### ç½‘ç»œä¿¡æ¯å®‰å…¨æ³•å¾‹ä¸æ”¿ç­–\n\n![image-20250214160957700](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e71f5bcf24591958d73f974b822f30f2697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250214161022328](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/da323d422d48ad10820e3765d04ee9ea697559838.png)\n\n![image-20250214161104192](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/84770aac7b3cca704fb2b43f8f93eee2697559838.png)\n\n![image-20250214161129120](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/236f48c2341ccc0cd9314df463e479a1697559838.png)\n\n![image-20250214161148455](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/760fa264559398386f2acd15056dbfbd697559838.png)\n\n![image-20250214161227953](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d48a5576a7517a87920cc7f5a471c5d4697559838.png)\n\n![image-20250214161352842](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/26816c7367fd4e896762a83c4b3081ac697559838.png)\n\n#### CCæ”»å‡»æ—¥å¿—\n\n![image-20250214161500368](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4a0f0d8d5005cc0d037d9190fcbb0404697559838.png)\n\nDDoSæ”»å‡»å’ŒCCæ”»å‡»\n\n|          |        |             DDoSæ”»å‡»VS CCæ”»å‡»              |            |      |\n| -------- | :----: | :----------------------------------------: | :--------: | :--: |\n|          |  æ¥æº  |                    å±å®³                    |    åè®®    | å˜ç§ |\n| CCæ”»å‡»   | çœŸå®IP | ä¸šåŠ¡æ•…éšœã€æˆ–è€…ä¸šåŠ¡å¯ç”¨  ä½†ç”¨æˆ·éšç§ç­‰è¢«çªƒå– |    HTTP    | è¾ƒå¤š |\n| DDoSæ”»å‡» | ä¼ªé€ IP |         æµé‡æ‰“æ»¡ï¼Œä¸šåŠ¡å½»åº•ä¸å¯ ç”¨          | TCP/UDP/IP | è¾ƒå°‘ |\n\n![image-20250314164640258](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/19d8966f8cccb06c7468991387bb8bc5697559838.png)\n\n![image-20250314164654096](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d9b68f6300495c3979bc802a76ea6717697559838.png)\n\n![image-20250314164707228](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/212294e07742c544ea1a8a361e88ae9c697559838.png)\n\n### ä¿¡æ¯åŠ å¯†æŠ€æœ¯\n\n#### å¯†ç å­¦åŸºæœ¬æ¦‚å¿µ\n\nä¿¡æ¯å®‰å…¨çš„æ ¸å¿ƒæ˜¯`å¯†ç æŠ€æœ¯`ï¼Œç ”ç©¶æ•°æ®åŠ å¯†çš„ç§‘å­¦å«ä½œå¯†ç å­¦(Cryptography)ã€‚\n\nç°ä»£å¯†ç ç†è®ºçš„ä¸€ä¸ªæ ¹æœ¬æ€§åŸåˆ™KerckhoffsåŸåˆ™:`å¯†ç ä½“åˆ¶çš„å®‰å…¨æ€§ä¸ä¾èµ–äºç®—æ³•çš„ä¿å¯†ï¼Œè€Œä»…ä»…ä¾èµ–äºå¯†é’¥çš„ä¿å¯†ã€‚`\nä¸è®ºçªƒå¬è€…è·å–äº†å¤šå°‘å¯†æ–‡ï¼Œå¦‚æœå¯†æ–‡ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯å¯ä»¥ç¡®å®šå‡ºå¯¹åº”çš„æ˜æ–‡ï¼Œåˆ™è¿™ç§å¯†ç ä½“åˆ¶æ˜¯`æ— æ¡ä»¶å®‰å…¨çš„`ï¼Œæˆ–ç§°ä¸º`ç†è®ºä¸Šä¸å¯ç ´è§£çš„`ã€‚\n\nåœ¨æ— ä»»ä½•é™åˆ¶çš„æ¡ä»¶ä¸‹ï¼Œç›®å‰å‡ ä¹æ‰€æœ‰çš„å¯†ç ä½“åˆ¶éƒ½``ä¸æ˜¯ç†è®ºä¸Šä¸å¯ç ´è§£çš„``ã€‚èƒ½å¦ç ´è§£ç»™å®šçš„å¯†ç å–å†³äºä½¿ç”¨çš„è®¡ç®—èµ„æºã€‚\n\n#### ç»å…¸åŠ å¯†æŠ€æœ¯\n\nç»å…¸åŠ å¯†æŠ€æœ¯ä¸»è¦æœ‰3ç§:\n\n(1)`æ›¿æ¢åŠ å¯†(Substitutkm)`ã€‚ç”¨ä¸€ä¸ªå­—æ¯æ›¿æ¢å¦ä¸€ä¸ªå­—æ¯ï¼Œä¾‹å¦‚Caesarå¯†ç (Dæ›¿æ¢a, Eæ›¿æ¢bç­‰)ã€‚è¿™ç§æ–¹æ³•ä¿ç•™äº†æ˜æ–‡çš„é¡ºåºï¼Œå¯æ ¹æ®è‡ªç„¶è¯­è¨€çš„``ç»Ÿè®¡ç‰¹æ€§``(ä¾‹å¦‚å­—æ¯å‡ºç°çš„é¢‘ç‡)ç ´è¯‘ã€‚\n(2)`æ¢ä½åŠ å¯†(Transposition)`.æŒ‰ç…§ä¸€å®šçš„è§„å¾‹é‡æ’å­—æ¯çš„é¡ºåºã€‚(3)`ä¸€æ¬¡æ€§å¡«å……(One-TimePad)`ã€‚æŠŠæ˜æ–‡å˜ä¸ºä½ä¸²(ä¾‹å¦‚ç”¨ASCIIç¼–ç )ï¼Œé€‰æ‹©ä¸€ä¸ªç­‰é•¿çš„éšæœºä½ä¸²ä½œä¸ºå¯†é’¥ï¼Œå¯¹äºŒè€…è¿›è¡ŒæŒ‰ä½`å¼‚æˆ–`å¾—åˆ°å¯†æ–‡ã€‚\n\n#### ç°ä»£åŠ å¯†æŠ€æœ¯\n\nç°ä»£å¯†ç ä½“åˆ¶ä½¿ç”¨çš„åŸºæœ¬æ–¹æ³•ä»ç„¶æ˜¯`æ›¿æ¢å’Œæ¢ä½`ï¼Œä½†æ˜¯é‡‡ç”¨æ›´åŠ å¤æ‚çš„åŠ å¯†ç®—æ³•å’Œç®€å•çš„å¯†é’¥ï¼Œè€Œä¸”å¢åŠ äº†å¯¹ä»˜ä¸»åŠ¨æ”»å‡»çš„æ‰‹æ®µã€‚ä¾‹å¦‚`åŠ å…¥éšæœºçš„å†—ä½™ä¿¡æ¯`ï¼Œä»¥é˜²æ­¢åˆ¶é€ å‡æ¶ˆæ¯;åŠ å…¥æ—¶é—´æ§åˆ¶ä¿¡æ¯ï¼Œä»¥`é˜²æ­¢æ—§æ¶ˆæ¯é‡æ”¾ã€‚`\n``æ›¿æ¢å’Œæ¢ä½``å¯ä»¥ç”¨ç®€å•çš„`ç”µè·¯æ¥å®ç°`\n\n#### ç§é’¥å¯†ç /å¯¹ç§°å¯†ç ä½“åˆ¶\n\nç§é’¥å¯†ç åˆç§°å¯¹ç§°å¯†ç ï¼Œè¯¥ä½“åˆ¶çš„ç‰¹ç‚¹æ˜¯`åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥`ã€‚æ¶ˆæ¯çš„æ”¶å‘åŒæ–¹å¿…é¡»äº‹å…ˆé€šè¿‡`å®‰å…¨æ¸ é“äº¤æ¢å¯†é’¥ã€‚`\n\nÂ·**ä¼˜ç‚¹**:`åŠ è§£å¯†é€Ÿåº¦å¿«ã€å¯†æ–‡ç´§å‡‘ã€ä½¿ç”¨é•¿å¯†é’¥æ—¶çš„éš¾ç ´è§£ã€‚`\n\nÂ·**ç¼ºç‚¹**:`å¯†é’¥åˆ†é…é—®é¢˜ã€å¯†é’¥ç®¡ç†é—®é¢˜ã€æ— æ³•è®¤è¯æºã€‚`\n\nå¸¸è§çš„å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•å¦‚ä¸‹:DESã€3DESã€AESã€RC4/5ã€IDEAã€‚\n\n![image-20250116180343257](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/60fe733fb11315dc6a3d39e1fbacff65697559838.png)\n\nä»¥ä¸‹è¿™ä¸ªè¡¨æ ¼è¦èƒŒï¼\n\n| ç®—æ³•  | è§£é‡Š                                                         | ç‰¹ç‚¹                                                 |\n| :---- | :----------------------------------------------------------- | :--------------------------------------------------- |\n| DES   | Data Encryption Standardï¼Œæ•°æ®åŠ å¯†æ ‡å‡†ï¼Œ`åˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œé‡‡ç”¨ç§»ä½+æ›¿æ¢`ï¼Œé€Ÿåº¦å¿«ï¼Œå¯†é’¥æ˜“äº§ç”Ÿã€‚ | åˆ†ç»„é•¿åº¦`64`ä½ï¼Œå¯†é’¥é•¿åº¦64ä½ï¼Œæœ‰æ•ˆå¯†é’¥é•¿åº¦æ˜¯`56`ä½   |\n| 3DES  | ä¸‰é‡DESï¼ˆTDEAï¼‰ï¼Œä½¿ç”¨DESå¯¹æ˜æ–‡è¿›è¡Œâ€œåŠ å¯†-è§£å¯†-åŠ å¯†â€æ“ä½œã€‚<br />åŠ å¯†ï¼šK1åŠ å¯†â†’K2è§£å¯†â†’K3åŠ å¯†<br />è§£å¯†ï¼šK3è§£å¯†â†’K2åŠ å¯†â†’K1è§£å¯†<br />ä¸€èˆ¬K1å’ŒK3æ˜¯ç›¸åŒçš„å¯†é’¥ã€‚ | å¯†é’¥é•¿åº¦`112`ä½                                      |\n| IDEA  | International Data Encryption Algorithmï¼Œå›½é™…æ•°æ®åŠ å¯†ç®—æ³•ï¼Œåˆ†ç»„åŠ å¯†ç®—æ³•ã€‚è®¾è®¡æ€æƒ³ï¼šæ··åˆä½¿ç”¨æ¥è‡ªä¸åŒä»£æ•°ç¾¤ä¸­çš„è¿ç®—ã€‚ | æ˜æ–‡å’Œå¯†æ–‡åˆ†ç»„éƒ½æ˜¯`64`ä½ï¼Œå¯†é’¥é•¿åº¦ä¸º`128`ä½ï¼Œç”¨äºPGP |\n| AES   | `åˆ†ç»„åŠ å¯†ç®—æ³•`Advanced Encryption Standardï¼Œé«˜çº§åŠ å¯†æ ‡å‡†ã€‚å¯ä»¥é€šè¿‡ç¡¬ä»¶å®ç°ï¼Œé€Ÿåº¦å¿«ï¼Œåƒ3DESä¸€æ ·å®‰å…¨ã€‚ | åˆ†ç»„é•¿åº¦`128`ä½ï¼Œæ”¯æŒ`128ï¼Œ192å’Œ256`ä½ä¸‰ç§å¯†é’¥é•¿åº¦   |\n| RC4/5 | `æµåŠ å¯†ç®—æ³•`ï¼Œç”¨äºWIFIã€‚åŠ å¯†é€Ÿåº¦å¿«ï¼Œå¯è¾¾åˆ°DESçš„10å€ã€‚        | åˆ†ç»„å’Œå¯†é’¥é•¿åº¦éƒ½`å¯å˜`                               |\n\n\n\nä¾‹é¢˜\n\n![image-20250214164110400](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5192abb4a2557e66477a490a27a0965e697559838.png)\n\n![image-20250214164153256](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/28333e0ee79058b74978ae7b3a005131697559838.png)\n\n![image-20250214164847797](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1db83fbef01bf4c48d49787d263b81eb697559838.png)\n\n#### å…¬é’¥å¯†ç /éå¯¹ç§°å¯†ç \n\nå…¬é’¥å¯†ç åˆç§°ä¸ºéå¯¹ç§°åŠ å¯†ï¼Œå°±æ˜¯å¯¹æ•°æ®`åŠ å¯†å’Œè§£å¯†çš„å¯†é’¥æ˜¯ä¸åŒçš„ã€‚`\n\nÂ·ä¼˜ç‚¹:`å¯†é’¥åˆ†å‘æ–¹ä¾¿ã€å¯†é’¥ä¿ç®¡é‡å°‘ã€æ”¯æŒæ•°å­—ç­¾å`\n\nÂ·ç¼ºç‚¹:`åŠ å¯†é€Ÿåº¦æ…¢(è®¡ç®—é‡å¤§ï¼Œä¸é€‚åˆåŠ å¯†å¤§æ•°æ®)ã€æ•°æ®è†¨èƒ€ç‡é«˜`\n\næ¯ä¸ªå®ä½“æœ‰ä¸¤ä¸ªå¯†é’¥:`å…¬é’¥å…¬å¼€ï¼Œç§é’¥è‡ªå·±ä¿å­˜`\n\nÂ·`å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œå¯å®ç°ä¿å¯†é€šä¿¡`\n\nÂ·`ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼Œå¯å®ç°æ•°å­—ç­¾å`\n\nå¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•å¦‚ä¸‹:\n\nÂ·`RSA`:512ä½(æˆ–1024ä½)å¯†é’¥ï¼Œè®¡ç®—é‡æå¤§ï¼Œéš¾ç ´è§£ã€‚\n\nÂ·`Elgamal`ã€`ECC`(æ¤­åœ†æ›²çº¿ç®—æ³•)ã€èƒŒåŒ…ç®—æ³•ã€Rabinã€DHç­‰ã€‚\n\n![image-20250116181309538](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/46be21359d214bbaebd174d5c3c44d6f697559838.png)\n\n#### å¯†ç åˆ†ç±»\n\n![image-20250214165430800](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/af8956c36d469645407c18ec523837ca697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250214165506572](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/377accda7fb235de69e6098c4fcc8592697559838.png)\n\n#### æ··åˆå¯†ç \n\næ··åˆå¯†ç :å‘é€æ–¹ç”¨`å¯¹ç§°å¯†é’¥åŠ å¯†éœ€è¦å‘é€çš„æ¶ˆæ¯ï¼Œå†ç”¨æ¥æ”¶æ–¹çš„å…¬é’¥åŠ å¯†å¯¹ç§°å¯†é’¥`ï¼Œç„¶åä¸€èµ·å‘é€ç»™æ¥æ”¶æ–¹;æ¥æ”¶æ–¹å…ˆç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ°å¯¹ç§°å¯†é’¥ï¼Œç„¶åç”¨å¯¹ç§°å¯†é’¥è§£å¯†å¾—åˆ°æ˜æ–‡\n\n![image-20250116181701747](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/abb331ba9fdcd6134d6c9801e6b18de6697559838.png)\n\n\n\n#### å›½äº§åŠ å¯†ç®—æ³•ï¼ˆSMï¼‰ç³»åˆ—\n\nã€Šä¸­åäººæ°‘å…±å’Œå›½å¯†ç æ³•ã€‹å¯†ç åˆ†ä¸º`æ ¸å¿ƒå¯†ç ã€æ™®é€šå¯†ç å’Œå•†ç”¨å¯†ç `ï¼Œå®è¡Œåˆ†ç±»ç®¡ç†\n\n  `æ ¸å¿ƒå¯†ç ã€æ™®é€šå¯†ç ç”¨äºä¿æŠ¤å›½å®¶ç§˜å¯†ä¿¡æ¯`ï¼Œå±äºå›½å®¶ç§˜å¯†ï¼Œç”±å¯†ç ç®¡ç†éƒ¨é—¨ä¾æ³•å®è¡Œä¸¥æ ¼ç»Ÿä¸€ç®¡ç†ã€‚\n\n  å•†ç”¨å¯†ç ç”¨äºä¿æŠ¤ä¸å±äºå›½å®¶ç§˜å¯†çš„ä¿¡æ¯ï¼Œå…¬æ°‘ã€æ³•äººå¯ç”¨ã€‚\n\nå›½äº§å¯†ç ç®—æ³•:æ˜¯æŒ‡ç”±å›½å®¶å¯†ç ç ”ç©¶ç›¸å…³æœºæ„è‡ªä¸»ç ”å‘ï¼Œå…·æœ‰ç›¸å…³çŸ¥è¯†äº§æƒçš„å•†ç”¨å¯†ç ç®—æ³•ï¼Œç›®å‰å·²ç»å…¬å¸ƒçš„å›½äº§å¯†ç ç®—æ³•å¦‚ä¸‹:\n\n| ç®—æ³•åç§° | ç®—æ³•ç‰¹å¾æè¿°                                                 |\n| :------- | :----------------------------------------------------------- |\n| SM1      | `å¯¹ç§°åŠ å¯†`ï¼Œåˆ†ç»„é•¿åº¦å’Œå¯†é’¥é•¿åº¦éƒ½ä¸º128æ¯”ç‰¹                    |\n| SM2      | `éå¯¹ç§°åŠ å¯†`ï¼Œç”¨äºå…¬é’¥åŠ å¯†ç®—æ³•ã€å¯†é’¥äº¤æ¢åè®®ã€æ•°å­—ç­¾åç®—æ³•`æ¤­åœ†æ›²çº¿é—®é¢˜ECCç®—æ³•ã€æ‘˜è¦ç®—æ³•ï¼‰` |\n| SM3      | æ‚å‡‘ç®—æ³•ï¼ˆ`å“ˆå¸Œ`ï¼‰ï¼Œåˆ†ç»„512ä½ï¼Œè¾“å‡ºæ‚å‡‘å€¼é•¿åº¦ä¸º256ä½         |\n| SM4      | `å¯¹ç§°åŠ å¯†`ï¼Œåˆ†ç»„é•¿åº¦å’Œå¯†é’¥é•¿åº¦éƒ½ä¸º128æ¯”ç‰¹                    |\n| SM9      | `æ ‡è¯†å¯†ç ç®—æ³•`ï¼Œæ”¯æŒå…¬é’¥åŠ å¯†ã€å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åç­‰å®‰å…¨åŠŸèƒ½   |\n\n2é3å“ˆ9æ ‡è¯†ï¼Œ14æˆåŒå¯¹\n\n![image-20250214170307429](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/20d698b25f3e5e416205e2839f91244c697559838.png)\n\n![image-20250214170314118](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ef4b194c7ea1cccd18ae727e9e5d5f11697559838.png)\n\n\n\n\n\nä¾‹é¢˜\n\n![image-20250214171409121](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/65c16f81fc0d8cb7d712087cfb71031b697559838.png)\n\n![image-20250214171440653](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a53dace3f90222c716b2f810c9e66f66697559838.png)\n\n![image-20250214171504650](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8147cd53f177a845f482b7f3294137e0697559838.png)\n\n![image-20250116182042387](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7e4e8e4dd8c0e8775039526d107d5835697559838.png)\n\n![image-20250116182135547](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/05c5a886b4caad76ddc8623321b4f6f2697559838.png)\n\n![image-20250116182159166](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/216abdd6e32500764708861792876cbd697559838.png)\n\n### Hashå“ˆå¸Œç®—æ³•\n\nHASHå‡½æ•°ï¼Œåˆç§°ä¸º`æ‚å‡‘å‡½æ•°ã€æ•£åˆ—å‡½æ•°`ï¼Œå®ƒèƒ½å¤Ÿå°†`ä»»æ„é•¿åº¦çš„ä¿¡æ¯è½¬æ¢æˆå›ºå®šé•¿åº¦çš„å“ˆå¸Œå€¼`ï¼ˆæ•°å­—æ‘˜è¦ï¼‰ï¼Œå¹¶ä¸”ä»»æ„ä¸åŒæ¶ˆæ¯æˆ–æ–‡ä»¶æ‰€ç”Ÿæˆçš„å“ˆå¸Œå€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚\nhè¡¨ç¤ºhashå‡½æ•°ï¼Œåˆ™hæ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š\nï¼ˆ1ï¼‰hçš„è¾“å…¥å¯ä»¥æ˜¯ä»»æ„é•¿åº¦çš„æ¶ˆæ¯æˆ–æ–‡ä»¶Mã€‚\nï¼ˆ2ï¼‰hçš„è¾“å‡ºçš„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚\nï¼ˆ3ï¼‰ç»™å®šhå’ŒMï¼Œè®¡ç®—hï¼ˆMï¼‰æ˜¯å®¹æ˜“çš„ã€‚\nï¼ˆ4ï¼‰ç»™å®šhçš„æè¿°ï¼Œæ‰¾ä¸¤ä¸ªä¸åŒçš„æ¶ˆæ¯M1å’ŒM2ï¼Œä½¿å¾—hï¼ˆM1ï¼‰=hï¼ˆM2ï¼‰æ˜¯è®¡ç®—ä¸Šä¸å¯è¡Œçš„ã€‚\nå“ˆå¸Œå‡½æ•°ç‰¹æ€§ï¼š`ä¸å¯é€†æ€§ï¼ˆå•å‘ï¼‰ã€æ— ç¢°æ’æ€§ã€é›ªå´©æ•ˆåº”ã€‚`\n\nå¸¸è§çš„Hashç®—æ³•æœ‰ï¼š\nï¼ˆ1ï¼‰MD5ç®—æ³•ï¼šä»¥512ä½æ•°æ®å—ä¸ºå•ä½æ¥å¤„ç†è¾“å…¥ï¼Œäº§ç”Ÿ`128`ä½çš„ä¿¡æ¯æ‘˜è¦ã€‚å¸¸ç”¨äºæ–‡ä»¶æ ¡éªŒã€‚\nï¼ˆ2ï¼‰SHAç®—æ³•ï¼šä»¥512ä½æ•°æ®å—ä¸ºå•ä½æ¥å¤„ç†è¾“å…¥ï¼Œäº§ç”Ÿ`160`ä½çš„å“ˆå¸Œå€¼ï¼Œå…·æœ‰æ¯”MD5æ›´å¼ºçš„å®‰å…¨æ€§ã€‚\nï¼ˆ3ï¼‰SM3å›½äº§ç®—æ³•ï¼šæ¶ˆæ¯åˆ†ç»„é•¿åº¦ä¸º512æ¯”ç‰¹ï¼Œè¾“å‡º`256`ä½æ‘˜è¦ã€‚\n\n\n\n`HASHåº”ç”¨-1.æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ`\n\né‡è¦æ–‡ä»¶ç¡®ä¿æ— æŸåç­‰ä¹‹åç”Ÿæˆ`hashå€¼1`ï¼Œå°†æ–‡ä»¶å‘é€ç»™å¯¹æ–¹ï¼Œä»–è‡ªå·±å†ç”Ÿæˆ`hashå€¼2`ä¸¤ä¸ªå€¼å¦‚æœç›¸ç­‰ï¼Œè¿™å‘é€ç»™å¯¹æ–¹çš„æ–‡ä»¶æ— æŸå\n\n![image-20250116185821494](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9eb32f76f3cd8f5cd4fc700ef4d3c399697559838.png)\n\n\n\n`HASHåº”ç”¨-2.è´¦å·å¯†ç å­˜å‚¨`\n\n1. æ˜æ–‡å­˜å‚¨ï¼Œæ— å®‰å…¨é˜²æŠ¤\n\n| ç”¨æˆ·å |  å¯†ç   |\n| :----: | :----: |\n|  test  | 123456 |\n\n2. å“ˆå¸Œå­˜å‚¨ï¼ˆRainbow Table Attackï¼Œå½©è™¹è¡¨æ”»å‡»ï¼‰\n\n| ç”¨æˆ·å |               å¯†ç                |\n| :----: | :------------------------------: |\n|  test  | e10adc3949ba59abbe56e057f20f883e |\n\n3. ï¼ˆ`ç›+å“ˆå¸Œ`ï¼‰å­˜å‚¨ï¼ˆå½©è™¹è¡¨æ”»å‡»å¤±æ•ˆï¼‰\n\n| ç”¨æˆ·å |         ç›         |               å¯†ç                |\n| :----: | :----------------: | :------------------------------: |\n|  test  | 2026-2-20 20:08:23 | d8e423a9d5eb97da9e2d58cd57b92808 |\n\n\n\n`HASHåº”ç”¨-3.ç”¨æˆ·èº«ä»½è®¤è¯`\n\nå¢åŠ ä¸€ä¸ªéšæœºæ•°Råšå“ˆå¸Œ MAC=Hash(å¯†ç +R)\n\néœ€è¦åŒæ–¹é¢„å…ˆçŸ¥é“è¿™ä¸ªR\n\nMAC:æ¶ˆé™¤ä¸­é—´äººæ”»å‡»ï¼Œæºè®¤è¯+å®Œæ•´æ€§æ ¡éªŒ\n\n\n\nå¼ ä¸‰å‘èµ·è®¤è¯ï¼ŒæœåŠ¡ç«¯æ£€æŸ¥æœ‰å¼ ä¸‰è¿”å›ä¸€ä¸ªéšæœºæ•°Rï¼Œå®¢æˆ·ç«¯å°†è‡ªå·±è¾“å…¥çš„å¯†ç å’Œéšæœºæ•°Råˆåœ¨ä¸€èµ·ç”Ÿæˆhashå€¼ï¼ˆ`MAC`ï¼‰ï¼Œå‘å›ç»™æœåŠ¡ç«¯ï¼Œç„¶åç›¸åŒæ“ä½œï¼Œè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å¯¹æ¯”æˆåŠŸ\n\n![image-20250116190332623](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c6b3246bc7eab13647da8189470b03aa697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250116224856158](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a40c8a0dd23c3659aa9cc55f46b7d160697559838.png)\n\n![image-20250214174631918](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1c1a5c9bbfbfc06ae595c77d3917a7f9697559838.png)\n\n![image-20250214174614802](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d3e0f86af56297644aa774374a7c9e8c697559838.png)\n\n![image-20250214174651826](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/09c8d553c96f36e9176409bf2a54a2bd697559838.png)\n\n### æ•°å­—ç­¾å\n\n- ç­¾åæ–¹ç”¨è‡ªå·±çš„`ç§é’¥è¿›è¡Œç­¾å`ï¼Œå¯¹æ–¹æ”¶åˆ°åï¼Œç”¨`ç­¾åæ–¹çš„å…¬é’¥è¿›è¡ŒéªŒè¯`ã€‚\n- æ•°å­—ç­¾åç®—æ³•ï¼ˆå…¬é’¥åŠ å¯†ç®—æ³•ï¼‰ï¼š`RSA`ã€Rabinã€ELGamalç­¾åä½“åˆ¶å’ŒDSSæ ‡å‡†ã€‚\n- æ•°æ®ç­¾åæ˜¯ç”¨äº`ç¡®è®¤å‘é€è€…èº«ä»½å’Œæ¶ˆæ¯å®Œæ•´æ€§`çš„ä¸€ä¸ªåŠ å¯†æ¶ˆæ¯æ‘˜è¦ï¼Œå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n  - `ï¼ˆ1ï¼‰æ•°å­—ç­¾åæ˜¯å¯ä¿¡çš„ã€‚`\n  - `ï¼ˆ2ï¼‰æ•°å­—ç­¾åä¸å¯ä¼ªé€ ã€‚`\n  - `ï¼ˆ3ï¼‰æ•°å­—ç­¾åä¸èƒ½é‡æ–°ä½¿ç”¨ã€‚`\n  - `ï¼ˆ4ï¼‰ç­¾åæ–‡ä»¶æ˜¯ä¸èƒ½æ”¹å˜çš„ã€‚`\n  - `ï¼ˆ5ï¼‰æ•°å­—ç­¾åä¸èƒ½æŠµèµ–ã€‚`\n  - `ï¼ˆ6ï¼‰æ¥æ”¶è€…èƒ½å¤Ÿæ ¸å®å‘é€è€…èº«ä»½ã€‚`\n\n`æ•°å­—ç­¾åè¿‡ç¨‹`ï¼šå¸¸ç”¨çš„ç­¾åç®—æ³•æ˜¯RSAï¼Œé‡‡ç”¨`å‘é€è€…ç§é’¥ç­¾å`ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åï¼Œé‡‡ç”¨å‘é€è€…çš„å…¬é’¥è¿›è¡ŒéªŒè¯ã€‚å¯ä»¥ç›´æ¥å¯¹æ˜æ–‡è¿›è¡Œç­¾åï¼Œç”±äºæ˜æ–‡æ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼Œè¿™ç§ç­¾åæ–¹æ¡ˆæ•ˆç‡ä½ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥å…ˆç”±`æ˜æ–‡ç”ŸæˆHash`(æ¯”å¦‚MD5ç”Ÿæˆ128ä½)ï¼Œå†å¯¹`Hashå€¼è¿›è¡Œç­¾å`ï¼Œæ•ˆç‡æ›´é«˜ã€‚\n\n![image-20250117164042873](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/645269fb9838739a20356045a378aa6f697559838.png)\n\n![image-20250117164054145](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b527db344db595f791cde9284dec20fd697559838.png)\n\n![image-20250117164105639](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d7cbbeead75c6dacc2164a631df1c7d7697559838.png)\n\n![image-20250117164410147](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f3485a7d4261c67d6cc9cc4468b583ac697559838.png)\n\n![image-20250214181048775](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0d50bd83c31d6c67a2a1c2acde6c0ae3697559838.png)\n\n![image-20250214181118821](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ad07b48d49a98c370323dff4b5c45883697559838.png)\n\n![image-20250214181300292](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b499778bdc1c04438b555c803f9154e1697559838.png)\n\n### æ•°å­—è¯ä¹¦ä¸CA\n\n`ä¸ºä»€ä¹ˆéœ€è¦æ•°å­—è¯ä¹¦`\n\n![image-20250214181551038](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e4f585e41d82c8feabecc8262e000053697559838.png)\n\n`æ•°å­—è¯ä¹¦ç±»æ¯”`\n\n![image-20250117180138086](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/456e037ee1ffb568a1f746b0178f0551697559838.png)\n\n`PKIä½“ç³»ç»“æ„`\n\nå…³é”®è¯ï¼špkiã€caã€RAã€è¯ä¹¦å‘å¸ƒç³»ç»Ÿã€crlåº“\n\n![image-20250117180433462](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dd59d8e215fb5960587caa5f22547307697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250117180538158](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/84699fedca2394992a07f76edbdb550f697559838.png)\n\n![image-20250117180555739](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/157dacf8b85381ca8223c54c5ba50075697559838.png)\n\n![image-20250117180635576](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/53ab1addd8da00d52e7710e5ccf190b5697559838.png)\n\n![image-20250214182838393](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2ff0e52bc3e659cd06c3d0d4bafca641697559838.png)\n\n![](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3c79cb2fb55647ef40c09ed42086ac39697559838.png)\n\n![image-20250214184428386](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b4b73c691a51265ecfb4727fe29d4416697559838.png)\n\n\n\n`è¯ä¹¦é“¾`\n\nå¦‚æœç”¨æˆ·æ•°é‡å¾ˆå¤šï¼Œé€šå¸¸ç”±å¤šä¸ªCAï¼Œæ¯ä¸ªCAä¸ºä¸€éƒ¨åˆ†ç”¨æˆ·å‘è¡Œå’Œç­¾ç½²è¯ä¹¦ã€‚\n\nå¦‚æœæœ‰ä¸¤ä¸ªCAï¼ŒX1å’ŒX2ï¼Œå‡è®¾ç”¨æˆ·Aä»CAæœºæ„X1è·å¾—äº†è¯ä¹¦ï¼Œç”¨æˆ·Bä»X2è·å¾—è¯ä¹¦ï¼Œå¦‚æœä¸¤ä¸ªè¯ä¹¦å‘æ”¾æœºæ„`X1å’ŒX2å½¼æ­¤é—´å®‰å…¨äº¤æ¢äº†å…¬é’¥`ï¼Œå½¼æ­¤ä¿¡ä»»ï¼Œé‚£ä¹ˆä»–ä»¬çš„è¯ä¹¦å¯ä»¥å½¢æˆè¯ä¹¦é“¾ã€‚\n\n- Aé€šè¿‡ä¸€ä¸ªè¯ä¹¦é“¾æ¥è·å–Bçš„å…¬é’¥ï¼Œè¯ä¹¦é“¾è¡¨ç¤ºä¸º:`X1ã€ŠX2ã€‹X2ã€ŠBã€‹`\n- Bä¹Ÿèƒ½é€šè¿‡ç›¸åçš„è¯ä¹¦é“¾æ¥è·å–Açš„å…¬å¼€å¯†é’¥:`X2ã€ŠX1ã€‹X1ã€ŠAã€‹`\n\n![image-20250117180842129](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b2e7db2babb0390066b75381df97b8b8697559838.png)\n\n![image-20250117180851532](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/115a0b25bfc563681329fb46997efef0697559838.png)\n\n![image-20250214185313929](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/057c686d96d6105f8b6b47e5f0beeb58697559838.png)\n\n![image-20250214185616125](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/294380612374bf3a1b08f42648107de7697559838.png)\n\n\n\n### è™šæ‹Ÿä¸“ç”¨ç½‘\n\n#### è™šæ‹Ÿä¸“ç”¨ç½‘åŸºç¡€\n\nè™šæ‹Ÿä¸“ç”¨ç½‘(Virtual Private Network)\n\n- ä¸€ç§å»ºç«‹åœ¨å…¬ç½‘ä¸Šçš„ï¼Œç”±æŸä¸€ç»„ç»‡æˆ–æŸä¸€ç¾¤ç”¨æˆ·ä¸“ç”¨çš„é€šä¿¡ç½‘ç»œ\n- äºŒå±‚:L2TPå’ŒPPTP(åŸºäºPPP)  ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰\n- ä¸‰å±‚:`IPSec`å’ŒGRE    ï¼ˆç½‘ç»œå±‚ï¼‰\n- å››å±‚:`SSL`/TLS       ï¼ˆä¼ è¾“å±‚ï¼‰\n\nå…¶ä¸­L2TPå’ŒGREä¸æ˜¯åŠ å¯†æŠ€æœ¯\n\nå®ç°è™šæ‹Ÿä¸“ç”¨ç½‘å…³é”®æŠ€æœ¯\n\néš§é“æŠ€æœ¯(Tuneling)\n\nåŠ è§£å¯†æŠ€æœ¯(Encryption&Decryption)\n\nå¯†é’¥ç®¡ç†æŠ€æœ¯(Key Management)\n\nèº«ä»½è®¤è¯æŠ€æœ¯(Authentication)\n\n\n\n`VPNåˆ†ç±»ï¼šæ ¹æ®åº”ç”¨åœºæ™¯`\n\n![image-20250214185823351](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6d9abc9aefb34b99200f6b51e1e0c3aa697559838.png)\n\n`VPNåˆ†ç±»ï¼šæ ¹æ®VPNå®ç°å±‚æ¬¡`\n\n![image-20250214185858496](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/82e21d81b17ed827217a9c3f7f19bb2a697559838.png)\n\n`äºŒå±‚éš§é“åè®®`\n\n![image-20250214190011495](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/07e0a2aeecf43aade9fab7816686132f697559838.png)\n\nPPPåè®®å¯ä»¥åœ¨ç‚¹å¯¹ç‚¹é“¾è·¯ä¸Š`ä¼ è¾“å¤šç§ä¸Šå±‚åè®®`çš„æ•°æ®åŒ…ï¼Œæœ‰æ ¡éªŒä½ã€‚\n\n![image-20250117191207665](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/743963ccfa4ec98116cd337f6e394fba697559838.png)\n\näºŒå±‚éš§é“åè®®æœ‰==PPTPå’ŒL2TP==ï¼Œéƒ½æ˜¯æŠŠæ•°æ®å°è£…åœ¨PPPå¸§ä¸­åœ¨å› ç‰¹ç½‘ä¸Šä¼ è¾“ã€‚\n\n#### PPPè®¤è¯æ–¹å¼ï¼šPAPå’ŒCHAP\n\nPAP:`ä¸¤æ¬¡æ¡æ‰‹`éªŒè¯åè®®ï¼Œå£ä»¤ä»¥`æ˜æ–‡`ä¼ é€ï¼Œè¢«éªŒè¯æ–¹é¦–å…ˆå‘èµ·è¯·æ±‚ã€‚\n\nCHAP:`ä¸‰æ¬¡æ¡æ‰‹`ï¼Œè®¤è¯è¿‡ç¨‹ä¸ä¼ é€è®¤è¯å£ä»¤ï¼Œä¼ é€`HMACæ•£åˆ—å€¼`ã€‚\n\n![image-20250117191323652](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/25bccbc3a9c20a71934f328713c105d8697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250117191333577](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/589cf992f635a4a9630eae132190d975697559838.png)\n\n![image-20250117191342485](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/25c3719ab12f89d082672d1cae29878f697559838.png)\n\n![image-20250214190116790](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/04daf29a350631d067d23b787fe171b4697559838.png)\n\n#### IPSecåŸºç¡€\n\nIPSec(IP Security)æ˜¯IETFå®šä¹‰çš„ä¸€ç»„åè®®ï¼Œç”¨äº`å¢å¼ºIPç½‘ç»œçš„å®‰å…¨æ€§`ã€‚\n\nIPSecåè®®é›†æä¾›å¦‚ä¸‹å®‰å…¨æœåŠ¡:\n\næ•°æ®å®Œæ•´æ€§(Data Integrity )\n\nè®¤è¯(Autentication )\n\nä¿å¯†æ€§(Confidentiality)\n\nåº”ç”¨é€æ˜å®‰å…¨æ€§(Application-transparent Security)\n\n\n\nIPSecåŸç†\n\nIPSecåŠŸèƒ½åˆ†ä¸ºä¸‰ç±»:è®¤è¯å¤´(AH)ã€å°è£…å®‰å…¨è´Ÿè·(ESP)ã€Internetå¯†é’¥äº¤æ¢åè®®(IKE)\n\n``è®¤è¯å¤´(AH)`:æä¾›æ•°æ®å®Œæ•´æ€§å’Œæ•°æ®æºè®¤è¯ï¼Œä½†`ä¸æä¾›æ•°æ®ä¿å¯†æœåŠ¡`ï¼Œå®ç°ç®—æ³•æœ‰MD5ã€SHA`.\n\n`å°è£…å®‰å…¨è´Ÿè·(ESP)`:`æä¾›æ•°æ®åŠ å¯†`åŠŸèƒ½ï¼ŒåŠ å¯†ç®—æ³•æœ‰`DESã€3DESã€AES`ç­‰ã€‚\n\n`Internetå¯†é’¥äº¤æ¢åè®®(IKE)`:ç”¨äº`ç”Ÿæˆå’Œåˆ†å‘`åœ¨ESPå’ŒAHä¸­ä½¿ç”¨çš„`å¯†é’¥`ã€‚\n\n![image-20250117192244783](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/933097680f02d5fefc9ab5bf959cba03697559838.png)\n\n\n\nIPSecä¸¤ç§å°è£…æ¨¡å¼\n\nå…³é”®è¯ï¼šåŸå§‹æ¨¡å¼ï¼Œä¼ è¾“æ¨¡å¼ï¼Œéš§é“æ¨¡å¼\n\n![image-20250117195129328](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8efda23b2b393d0e781684492c88e1fa697559838.png)\n\nä¼ è¾“æ¨¡å¼æ•ˆç‡é«˜ï¼Œéš§é“æ¨¡å¼æ›´å®‰å…¨\n\n#### GREè™šæ‹Ÿä¸“ç½‘\n\n![image-20250214190506552](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/93db44c28c9c74f02590764de25a846c697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250117224732999](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2f83a72cc21d566e44bff3c08270b540697559838.png)\n\n![image-20250214190609241](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/83629f12ebdfdf786b8a2cec4aa5d46b697559838.png)\n\n![image-20250117225659724](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c7b102d4b80f64dcc0599934ced3eb96697559838.png)\n\n![image-20250214190635518](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f1b04f48ebd56ddf834d7430252d646f697559838.png)\n\n![image-20250214190652424](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8dfbd9ab7de9f5492e81e935f70fae46697559838.png)\n\n![image-20250214190825942](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5fb1f60b56695ae8583bcef6024cb33e697559838.png)\n\n![image-20250214190848721](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2145b6e36fbf6190c1db83052349b63f697559838.png)\n\n![image-20250214190914304](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/457d546a5c7f95c9c2cb4fea780ebea0697559838.png)\n\n![image-20250214190932609](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1dbc7f865ee2ab22f033c5ae05ef3f6c697559838.png)\n\n![image-20250214191015231](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d3615681c79197d4e8efdc33fca932d2697559838.png)\n\n![image-20250214191037434](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7b14fe181494133ef154c875852a11ff697559838.png)\n\n### åº”ç”¨å±‚å®‰å…¨åè®®\n\n#### SSL/TLS\n\n![image-20250214191227558](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4917e3025e4236d8b7e3080de0f23cc4697559838.png)\n\n#### HTTPSä¸S-HTTP\n\n![image-20250214191411093](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0e7628190f09a727bc18a1708b787774697559838.png)\n\n![image-20250214191451321](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7f1ada3360b30b9aa6b329c20d52a194697559838.png)\n\n![image-20250214191532294](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b6cb3e0c1e03117b7379a35dbe79353c697559838.png)\n\n![image-20250214191630713](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/262af567f55134ac98017866ce3ea9bc697559838.png)\n\n![image-20250214191759458](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/785cf4a5febd4abf4a9b0d385fa38390697559838.png)\n\n#### SETå’ŒPGP\n\n![image-20250214212856846](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/22ad1cc3604af83b6325d511c4d5c6c0697559838.png)\n\n![image-20250119164752087](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/414ebe99b1d9ece5b85e2df3d44b6335697559838.png)\n\n![image-20250119164810396](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bdf630ea09e59e454ba39340f340f49a697559838.png)\n\n![image-20250119164819336](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/286864cf628bf622305d3643121500b1697559838.png)\n\n#### S/MIME\n\nå®‰å…¨å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•åè®®(Security/Multipurpose Internet Mail Extensions,S/MIME)`æä¾›ç”µå­é‚®ä»¶å®‰å…¨æœåŠ¡`\n\nS/MIMEé‡‡ç”¨`MD5ç”Ÿæˆæ•°å­—æŒ‡çº¹ï¼Œåˆ©ç”¨RSAè¿›è¡Œæ•°å­—ç­¾åï¼Œå¹¶é‡‡ç”¨3DESåŠ å¯†æ•°å­—ç­¾å`\n\nä¸è¦æ··æ·†MIMEå’ŒS/MIMEï¼Œ`MIMEä¸å…·å¤‡å®‰å…¨åŠŸèƒ½`ã€‚\n\n#### kerberoså’ŒPKI\n\n![image-20250214213917667](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/09f5faa8e77a054f8f4a3b9b78cf938f697559838.png)\n\n![image-20250214215343460](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c855872aba78750b9e4fe1cabd205f30697559838.png)\n\n![image-20250214215410312](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/81698c575ad9fcb78d51ff83731131de697559838.png)\n\n![image-20250313213230246](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2a91ddcdc66f0b71469a2de2ed0bb596697559838.png)\n\n![image-20250214215739532](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7412bcf825d5bcf99181598d4440488f697559838.png)\n\n![image-20250214215813396](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d5d5f26c5ca5904ec66b71d147683113697559838.png)\n\n![image-20250214215831820](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/454d82250524e5a7710e8d61425812fb697559838.png)\n\n![image-20250214215853249](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4e0c8398091aa3d774d27c7546723d67697559838.png)\n\n### é˜²ç«å¢™ä¸å…¥ä¾µæ£€æµ‹\n\n#### é˜²ç«å¢™\n\né˜²ç«å¢™å¯ä»¥å®ç°`å†…éƒ¨ç½‘ç»œä¿¡ä»»ç½‘ç»œ`ä¸`å¤–éƒ¨ä¸å¯ä¿¡ä»»ç½‘ç»œ`(Internet)ä¹‹é—´æˆ–æ˜¯å†…éƒ¨ç½‘ç»œä¸åŒåŒºåŸŸéš”ç¦»ä¸è®¿é—®æ§åˆ¶ã€‚\n\næ•™æé˜²ç«å¢™åŠŸèƒ½:`è®¿é—®æ§åˆ¶ã€NATã€è·¯ç”±ã€VLANã€é“¾è·¯èšåˆã€ç½‘ç»œç›‘æ§`ç­‰ï¼Œ`ä¸åŒ…å«åº”ç”¨å±‚åŠŸèƒ½`ã€‚\n\né˜²ç«å¢™æ¨¡å¼:`è·¯ç”±æ¨¡å¼ã€é€æ˜æ¨¡å¼å’Œæ··åˆæ¨¡å¼ã€‚`\n\n- é€æ˜/ç½‘æ¡¥æ¨¡å¼ï¼šé˜²ç«å¢™ç›¸å½“äºäºŒå±‚äº¤æ¢æœºï¼Œæ— éœ€é…ç½®IPåœ°å€ã€‚\n- è·¯ç”±æ¨¡å¼ï¼šé˜²ç«å¢™å…·æœ‰ä¸‰å±‚åŠŸèƒ½ï¼Œéœ€è¦é…ç½®IPåœ°å€ï¼Œå¯ä»¥åšNATã€‚\n- æ··åˆæ¨¡å¼ï¼šæ ¹æ®éœ€æ±‚ï¼Œå¯ä»¥åŒæ—¶ä»¥é€æ˜æ¨¡å¼å’Œè·¯ç”±æ¨¡å¼å·¥ä½œã€‚\n\n![image-20250119174649750](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/56af5d3e2072fd0d0736d13d574fb778697559838.png)\n\n#### é˜²ç«å¢™åŒºåŸŸåˆ’åˆ†\n\næ ¹æ®ç½‘ç»œçš„å®‰å…¨ä¿¡ä»»ç¨‹åº¦å’Œéœ€è¦ä¿æŠ¤çš„å¯¹è±¡ï¼Œäººä¸ºåˆ’åˆ†è‹¥å¹²å®‰å…¨åŒºåŸŸï¼ŒåŒ…æ‹¬\n`æœ¬åœ°åŒºåŸŸ(Local)`:é˜²ç«å¢™æœ¬èº«ã€‚\n`ä¿¡ä»»åŒºåŸŸ(Trust)`:å†…éƒ¨å®‰å…¨ç½‘ç»œï¼Œå¦‚å†…éƒ¨æ–‡ä»¶æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ã€‚\n`éä¿¡ä»»åŒºåŸŸ(Untrust)`:å¤–éƒ¨ç½‘ç»œï¼Œæ¯”å¦‚äº’è”ç½‘ã€‚\n`å†›äº‹ç¼“å†²åŒºåŸŸ(DMZ)`:å†…éƒ¨ç½‘ç»œå’Œå¤–éƒ¨ç½‘ç»œä¹‹é—´çš„ç½‘ç»œï¼Œå¸¸æ”¾ç½®`å…¬å…±æœåŠ¡è®¾å¤‡`ï¼Œå‘å¤–æä¾›ä¿¡æ¯æœåŠ¡ã€‚\n\n![image-20250119174819507](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d02287c8c79ea9552df74e9195a7cc70697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250214220329336](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1a9769a21cca3c4cd52d6d6990011b4e697559838.png)\n\n![image-20250214220401244](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a4d8af26e66b20da46e404cdadd67855697559838.png)\n\n![image-20250214220448577](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0272ed71ce67e619c1411c1ae8d83a2d697559838.png)\n\n![image-20250214220500422](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/43da996a0271d0f2508b9266393040e6697559838.png)\n\n![image-20250214220510821](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/55424cf0d57ea911fb6b0c968bcb0d09697559838.png)\n\n![image-20250214220547900](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3c1ff92012329a7f99e8034799f1c039697559838.png)\n\n![image-20250214220554652](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/83a2172e323dc7aa28a89a1215f71eb2697559838.png)\n\n![image-20250214220613732](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/997db3a2abb46272a6edceaf9566e0dc697559838.png)\n\n![image-20250214220633207](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0eeca39d312160293c1f57e1718a56e5697559838.png)\n\n![image-20250214220648665](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d936c5c82bf446a80a00f29aa1ffd6a6697559838.png)\n\n![image-20250214220755224](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dc7935cd4158686109394731a03c5c2e697559838.png)\n\n![image-20250214220908027](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e3c52550d658a110ac17962d9531d3d2697559838.png)\n\n#### å…¥ä¾µæ£€æµ‹ï¼ˆIDSï¼‰\n\n![image-20250214221010666](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8904a4a709ac9487d80936966f02c5ee697559838.png)\n\n![image-20250214221045261](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/02f9052853360d4a3e67b9ef604dc0fa697559838.png)\n\n`åä¸ºäº¤æ¢æœºç«¯å£é•œåƒé…ç½®`\n\nå°†äº¤æ¢æœºç½‘å£GigabitEthernet1/0/2çš„æµé‡é•œåƒåˆ°éƒ¨ç½²Snortçš„ç½‘å£GigabitEthernet1/0/1ä¸Šã€‚\n\nè¿›å…¥ç³»ç»Ÿæ¨¡å¼\n\n```\nsystem-view \n```\n\nå®šä¹‰ç´¢å¼•å·ä¸º1çš„è§‚å¯Ÿç«¯å£g1/0/1\n\n```\nobserve-port 1 interface gigabitethernet 1/0/1`\n```\n\nè¿›å…¥æµé‡é‡‡é›†æ¥å£\n\n```\ninterface gigabitethernet 1/0/2 \n```\n\nå°†g1/0/2å…¥æ–¹å‘çš„æµé‡é•œåƒåˆ°g1/0/1\n\n```\nport-mirroring to observe-port 1 inbound\n```\n\n\n\n`å…¥ä¾µæ£€æµ‹åˆ†ç±»`\n\næŒ‰ä¿¡æ¯æ¥æºåˆ†:HIDSã€NIDSã€DIDS(ä¸»æœº/ç½‘ç»œ/åˆ†å¸ƒå¼)ã€‚\n\næŒ‰å“åº”æ–¹å¼åˆ†:å®æ—¶æ£€æµ‹å’Œéå®æ—¶æ£€æµ‹ã€‚\n\næŒ‰æ•°æ®åˆ†ææŠ€æœ¯å’Œå¤„ç†æ–¹å¼åˆ†:`å¼‚å¸¸æ£€æµ‹`ã€`è¯¯ç”¨æ£€æµ‹`å’Œæ··åˆæ£€æµ‹ã€‚\n\n- `å¼‚å¸¸æ£€æµ‹`:å»ºç«‹å¹¶ä¸æ–­æ›´æ–°å’Œç»´æŠ¤ç³»ç»Ÿæ­£å¸¸è¡Œä¸ºçš„è½®å»“ï¼Œå®šä¹‰æŠ¥è­¦å€¼ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™æŠ¥è­¦`èƒ½å¤Ÿæ£€æµ‹ä»æœªå‡ºç°çš„æ”»å‡»ï¼Œä½†è¯¯æŠ¥ç‡é«˜ã€‚`\n\n- `è¯¯ç”¨æ£€æµ‹`:å¯¹å·²çŸ¥çš„å…¥ä¾µè¡Œä¸ºç‰¹å¾è¿›è¡Œæå–ï¼Œå½¢æˆå…¥ä¾µå¼åº“ï¼ŒåŒ¹é…åˆ™è¿›è¡ŒæŠ¥è­¦ã€‚å·²çŸ¥å…¥ä¾µæ£€æµ‹å‡†ç¡®ç‡é«˜ï¼Œå¯¹äºæœªçŸ¥å…¥ä¾µæ£€æµ‹å‡†ç¡®ç‡ä½ï¼Œ`é«˜åº¦ä¾èµ–ç‰¹å¾åº“`\n\n  ==æ£€æµ‹æŠ€æœ¯:ä¸“å®¶ç³»ç»Ÿå’Œæ¨¡å¼åŒ¹é…ã€‚==\n\n#### å…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰\n\n![image-20250214221338926](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ba2ae078f57ac22c89e134ca0419a7b8697559838.png)\n\n`å…¥ä¾µé˜²å¾¡ç³»ç»ŸIPS vS å…¥ä¾µæ£€æµ‹ç³»ç»ŸIDS`  `ï¼ˆæ¡ˆä¾‹åˆ†æä¸€è¡Œ2åˆ†ï¼‰`\n\néƒ¨ç½²ä½ç½®ä¸åŒ:IPSä¸€èˆ¬`ä¸²è¡Œéƒ¨ç½²`ï¼ŒIDSä¸€èˆ¬`æ—è·¯éƒ¨ç½²`\nå…¥ä¾µå“åº”èƒ½åŠ›ä¸åŒ:IPSèƒ½`æ£€æµ‹å…¥ä¾µ`ï¼Œå¹¶èƒ½`é˜»æ–­`ï¼ŒIDSåªèƒ½æ£€æµ‹è®°å½•æ—¥å¿—ï¼Œå‘å‡ºè­¦æŠ¥\n\n![image-20250119175926898](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/076dbe4adc81c4cdc93c142342990a20697559838.png)\n\n![image-20250214221509869](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c7ee9c0c81f8be3a9d41f50c14a8006f697559838.png)\n\n![image-20250119180116050](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ad87e3dca6692ccc4fb3c8202b15e5d1697559838.png)\n\n![image-20250119180123559](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ba6a8ba2e247ec6a8cc0df8665e74c41697559838.png)\n\n### ç½‘ç»œå®‰å…¨é˜²æŠ¤ç³»ç»Ÿ\n\n#### Webåº”ç”¨é˜²ç«å¢™\n\nWebåº”ç”¨é˜²ç«å¢™(Web Application Firewal,WAF)æ˜¯ä¸€ç§ç”¨äº`HTTPåº”ç”¨`çš„é˜²ç«å¢™ï¼Œå·¥ä½œåœ¨åº”ç”¨å±‚å¯ä»¥æ›´æ·±å…¥åœ°æ£€æµ‹Webæµé‡ï¼Œé€šè¿‡åŒ¹é…Webæ”»å‡»ç‰¹å¾åº“ï¼Œå‘ç°æ”»å‡»å¹¶é˜»æ–­ã€‚\n\nWebæ”»å‡»:`SQLæ³¨å…¥ã€XSSã€ååºåˆ—åŒ–ã€è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€æ–‡ä»¶ä¸Šä¼ ã€Webshellã€‚`\n\n\n\nWAFåŠŸèƒ½ï¼š\n\n(1)Webæ”»å‡»é˜²æŠ¤ï¼Œé€šè¿‡ç‰¹å¾åŒ¹é…`é˜»æ–­`SQLæ³¨å…¥ã€è·¨ç«™è„šæœ¬æ”»å‡»ã€Webæ‰«æç­‰æ”»å‡»è¡Œä¸ºã€‚\n(2)Web`ç™»å½•`æ”»å‡»é˜²æŠ¤ï¼ŒåŒ…æ‹¬æš´åŠ›ç ´è§£é˜²æŠ¤ã€æ’åº“é˜²æŠ¤ã€å¼±å£ä»¤é˜²æŠ¤ç­‰ã€‚\n(3)æ¼æ´åˆ©ç”¨é˜²æŠ¤ï¼ŒåŒ…æ‹¬ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ã€è¿œç¨‹å‘½ä»¤æ‰§è¡Œåˆ©ç”¨ç­‰å…¶ä»–è½¯ä»¶æ¼æ´åˆ©ç”¨æ”»å‡»é˜²æŠ¤\n\n(4)Webæ¶æ„`è¡Œä¸º`é˜²æŠ¤ï¼ŒåŒ…æ‹¬æ¶æ„æ³¨å†Œé˜²æŠ¤ã€é«˜é¢‘äº¤æ˜“é˜²æŠ¤ã€è–…ç¾Šæ¯›è¡Œä¸ºé˜²æŠ¤ã€çŸ­ä¿¡éªŒè¯ç æ»¥åˆ·é˜²æŠ¤ç­‰.\n\n(5)æ¶æ„`æµé‡`é˜²æŠ¤ï¼ŒåŒ…æ‹¬CCæ”»å‡»é˜²æŠ¤ã€äººæœºè¯†åˆ«ã€TCP Floodæ”»å‡»é˜²æŠ¤ç­‰\n\n#### æ¼æ´æ‰«æ\n\n![image-20250214222022813](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5f616b7b070a3c693aaf51b48021f5de697559838.png)\n\n#### ç»Ÿä¸€å¨èƒç®¡ç†UTMå’Œä¸‹ä¸€ä»£é˜²ç«å¢™NGFW\n\n![image-20250214222107451](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eccb20bf1d280c59a6cb8650b9096251697559838.png)\n\n#### æ•°æ®åº“å®¡è®¡\n\n![image-20250214222129551](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8d7f7476cb5893269bab11728e37f5cd697559838.png)\n\n#### æ€åŠ¿æ„ŸçŸ¥\n\n![image-20250214222155067](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2608cb679b3b4dd4167f5832bdb10a77697559838.png)\n\n#### åˆ†é’Ÿçº§è”åŠ¨é˜²æŠ¤-å…¨ç½‘ååŒ\n\n![image-20250214222316223](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5250b37a2759dda05bff208636ef68f1697559838.png)\n\n#### åä¸ºæ²™ç®±-å…¨é¢é¢†å…ˆçš„æœªçŸ¥æ–‡ä»¶æ£€æµ‹æœºåˆ¶\n\n![image-20250214222342693](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/45b65fe97df26383ab05dff0948ef576697559838.png)\n\n![image-20250214222405546](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1e785658e99bdd958593c577c06d3259697559838.png)\n\n#### è¿ç»´å®‰å…¨ç®¡ç†ä¸å®¡è®¡ç³»ç»Ÿ(å ¡å’æœº)\n\n![image-20250214222439717](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9cd39dde8caea5275c1cc238544e58fb697559838.png)\n\n#### èœœç½\n\n![image-20250214222525361](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6eac6fc37816b82bb15d0368dd8d02bc697559838.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250214222551793](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/97b2b65567ef625cb5fe441015230d67697559838.png)\n\n![image-20250214222616665](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/004ffbb28b5e9d90af93162fbd253465697559838.png)\n\n![image-20250214222633631](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7f4f92128d7d37ed436c3dbae806a4c1697559838.png)\n\n![image-20250214222643180](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/85570957df416eb55640dafed2067f05697559838.png)\n\n![image-20250214222709105](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/31511e00654320f43f31a2daae803587697559838.png)\n\n![image-20250214222841424](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/13606dbc1d17a05fd1259fc896bece90697559838.png)\n\n## ç½‘ç»œæ“ä½œç³»ç»Ÿä¸åº”ç”¨æœåŠ¡å™¨\n\n### Windows Server 2016\n\n![image-20250214223101400](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c2fc3a9c16f905ad0ff063f452e0edfd697559838.png)\n\n### å›½äº§æ“ä½œç³»ç»Ÿ\n\n![image-20250214223142015](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/46285378b018fac4729ce455bd695998697559838.png)\n\n![image-20250214223248665](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/262cfd467e94bce445a8dea82a6f0d01697559838.png)\n\n![image-20250214223310084](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d616e3559e3151d852ce27b4bc3375ff697559838.png)\n\n![image-20250214223325860](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/acdb5278c8f43acab6e934ddd75f4cd9697559838.png)\n\n### UOS Linuxç½‘ç»œé…ç½®\n\n**å…³é”®è¯ï¼šifcfg-ens**\n\n![image-20250214223408555](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7a36cb2b528f5f94edf501f19f547721697559838.png)\n\n**å…³é”®è¯ï¼šnmcli**\n\n![image-20250214223420875](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/996ab863401c2f34153424492fa52f6d697559838.png)\n\n![image-20250214223653001](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4facf946d08fa1bd7490857e235a4b3f697559838.png)\n\n![image-20250214223707063](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/deccaaed00f1e819d7fe2aa33a935b75697559838.png)\n\n**å…³é”®è¯ï¼šifconfig**\n\n![image-20250214223722318](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d9a60c2015a1b2035ddc02186538a877697559838.png)\n\n**å…³é”®è¯ï¼šroute**\n\n![image-20250214223947260](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f0d3685803aca152a9b22caec408cf81697559838.png)\n\n**å…³é”®è¯ï¼šip**\n\n![image-20250214224020149](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/79767bda5764d65cee4e23b195c6340f697559838.png)\n\n![c4d2b98152b00c8e42f47f790b2c2253697559838](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7e71406e34fd1792362b8e4cf9e9dd14697559838.png)\n\n**å…³é”®è¯ï¼šnetstat**\n\n![image-20250214224200470](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/281e1e3a909b48cc367d45f6890dbea6697559838.png)\n\n![image-20250214224215204](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9fcd01b8a330c319f0139aa17387a0a5697559838.png)\n\n![image-20250214224241919](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/83330420b8bd17ec1c70ce143209846a697559838.png)\n\n![image-20250214224303647](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5bbffba7fb5343fd19e894765e064a78697559838.png)\n\n![image-20250214224326684](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b77b1b32d7c5a80c466c24f901797a1e697559838.png)\n\n### UOS Linuxæ–‡ä»¶å’Œç›®å½•ç®¡ç†\n\n#### æ–‡ä»¶ç®¡ç†\n\n![image-20250214224521046](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7c6af7c20d20427f963f56737b276607697559838.png)\n\n#### æ–‡ä»¶ç±»å‹\n\n![image-20250214224551488](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6ae01138a36ad6377af89246c8ae1613697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250214224711406](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/da96b17e5c6349bb17d015a8c96e148d697559838.png)\n\n#### æ–‡ä»¶æƒé™\n\n![image-20250214224815652](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/32e857688b27ed6632bb8d9b485cf908697559838.png)\n\n![image-20250214224840357](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ba16122aa2b10c39610033dee229b8a8697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250313212258910](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6a75cfee0f6ec02db96014e13b7fb351697559838.png)\n\n![image-20250214225123331](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0274f87dab763ccd7b0660977dded2a8697559838.png)\n\n#### 13ä¸ªLinuxåŸºç¡€å‘½ä»¤\n\n![image-20250214225153851](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2e023f3ce17f396047f89733e02f70f4697559838.png)\n\n![image-20250214225207793](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/50da2cf850df8312883db5c49ec8654d697559838.png)\n\n![image-20250214225219419](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/11ab224d56935a68313cdbd6bb7efd80697559838.png)\n\n![image-20250214225250338](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ad39d99ce0d8c65dae044afa180960e6697559838.png)\n\n![image-20250214225314808](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b2c66e55e3f63cb33b0fe42cd98396a7697559838.png)\n\n![image-20250214225332695](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0e6530bb9fe6583247e6218296d2214b697559838.png)\n\n![image-20250214225345763](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8f671387074801c279ec8be7e67f267a697559838.png)\n\n### UOS Linuxç”¨æˆ·å’Œç»„ç®¡ç†\n\n![image-20250214225513683](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/16dcd66358b553fabffa7e17191ca5ed697559838.png)\n\n![image-20250214225528170](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8c04bfb89cbb518cba16b16563c0a305697559838.png)\n\n![image-20250214225536484](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ddb5a41b05de57401e0ddd7318cceb16697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250214225555138](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ebdfa212cf9edf013748b0235ddc2b04697559838.png)\n\n![image-20250214225640657](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e88b7b59fb7a6cc000787393a4516852697559838.png)\n\n### UOS Linuxé˜²ç«å¢™é…ç½®\n\n#### é˜²ç«å¢™ç±»å‹\n\n![image-20250214225716962](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/188be195b5a1b56b0bfeb5f65cc97167697559838.png)\n\n#### firewalld\n\n![image-20250313213336391](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/44c2d2e4752bed98fec5a979a3ccbfd2697559838.png)\n\n#### iptablesçš„å››è¡¨äº”é“¾\n\n![image-20250214225821696](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/df8096459d54417987ddde3a34c9d05e697559838.png)\n\n![image-20250313213404439](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b820d5925c2f7d16c8414d7b57e182c6697559838.png)\n\n#### è¯­æ³•æ ¼å¼\n\n![image-20250214225904034](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6ebdd8db351a1d4627f3b5b895c7c88f697559838.png)\n\n![image-20250214225918100](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c1a3ab12dd8c951331f25171b921c152697559838.png)\n\n![image-20250214225958186](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/15cfa03678057db5748ace76293e9e5e697559838.png)\n\n##### nftables\n\n![image-20250214230020411](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9c8a859b47696f8945babbd9b99b3aa8697559838.png)\n\n![image-20250214230045665](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/64ed4e9d70041391681bc41eed0042af697559838.png)\n\n![image-20250214230114460](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0913a353df8f7d4123233293e6d5c473697559838.png)\n\n![image-20250214230140709](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/577a3ccf430e891da41baca77d907122697559838.png)\n\n![image-20250214230203936](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eff2418f501268b631eba9d368207892697559838.png)\n\n![image-20250214230223894](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/85446802c6df75bfb796115ae65fd41d697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250214230248894](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6080fe46c1b4279b3bf79494dbde0b2a697559838.png)\n\n![image-20250214230304328](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/05e7d1031079810d23989bd7e2be8565697559838.png)\n\n![image-20250214230324285](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ec961cd89aab41a958958ae3cbbf3bf0697559838.png)\n\n![image-20250214230337205](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/68fb5bcfc1a845bf04a6388ce47ca563697559838.png)\n\n![image-20250214230357865](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/009cef91de60ec1fe1e67edb397ac32d697559838.png)\n\n![image-20250214230420433](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/04f8d805abae5c73ac2cacbdb2b2bff4697559838.png)\n\n![image-20250214230519506](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/616c378263e7c9c70d4d16a77a216527697559838.png)\n\n### Webåº”ç”¨æœåŠ¡é…ç½®\n\n#### webæœåŠ¡è½¯ä»¶\n\n![image-20250214230555253](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d1ffe72983968c70fbae89777c83b353697559838.png)\n\n![image-20250214230611121](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/69c338fa3af300137d5ffa179b67e13c697559838.png)\n\n![image-20250313213439443](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/26a51f2d7264e36bf099a8c100d65619697559838.png)\n\n![image-20250214230655854](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3834b00a74d00e754e059e129160dcea697559838.png)\n\n![image-20250214230729070](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dc8008b01ea0aae5ca41863734cfb88c697559838.png)\n\n![image-20250313213501295](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e3aacac85f272420b412c3a5f445cf2a697559838.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250313213519450](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f809c78d7e175e20b27d87282b4eb6fe697559838.png)\n\n![image-20250214230903637](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d4de4c5125d64fe1e439f4d1b9150334697559838.png)\n\n![image-20250214231019584](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e809ab442930c66896eb484b111a4185697559838.png)\n\n![image-20250214231027465](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/276c8556f3a181e93a164497c00137b4697559838.png)\n\n### DHCP\n\n#### å·¥ä½œåŸç†\n\n![image-20250216144117666](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5631af6c3f8946c62d6acb7b4397bccb697559838.png)\n\n#### DHCPç§ŸæœŸæ›´æ–°\n\n![image-20250216144154375](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3df65e6745dfbff4b9856dc1b89562f3697559838.png)\n\n#### DHCPæŠ¥æ–‡æ ¼å¼\n\n![image-20250216144315443](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1a6702034ee33d2ba24b2a8ccdcab2e7697559838.png)\n\n#### Option 43 åº”ç”¨ä¸¾ä¾‹\n\n![image-20250216144346310](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7452db012e2de87233e0409b458c1b4f697559838.png)\n\n#### åä¸ºDHCP option43é…ç½®\n\n1. DHCPå¸¸è§„é…ç½®ï¼Œä¸ºAPåˆ†é…IPåœ°å€ã€‚\n\n  [DHCP-HW] `dhcp enable`\n\n  [DHCP-HW] `ip pool huawei`\n\n  [DHCP-HW-ip-pool-huawei] `network 192.168.100.0 255.255.255.0`\n\n  [DHCP-HW-ip-pool-huawei] `gateway-list 192.168.100.1`\n\n\n\n2. é…ç½®Option 43ï¼Œä½¿APèƒ½å¤Ÿè·å¾—ACçš„IPåœ°å€ï¼Œå‡è®¾ACçš„IPåœ°å€æ˜¯10.10.10.1ã€‚\n\n  [DHCP-HW-ip-pool-huawei] `option 43 sub-option 3 ascii 10.10.10.1`\n\n```\ndhcp server option 43 sub-option 1 hex c0a86401\n```\n\n```\ndhcp server option 43 sub-option 2 ip-address 192.168.100.1\n```\n\n```\ndhcp server option 43 sub-option 3 ascii 192.168.100.1\n```\n\n\n\n#### DHCPåˆ†é…å›ºå®šipåœ°å€\n\n![image-20250216144845074](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f3c209953aaaea34e7be6386706c7855697559838.png)\n\n\n\n#### DHCPä¸­ç»§ï¼ˆDHCP Relayï¼‰\n\n![image-20250216145020054](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eabb19483784aa9fdba1cb9c19c19a43697559838.png)\n\n`DHCP Relay å·¥ä½œåŸç†`\n\n![image-20250216145051040](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7b660fad1d3fd4169d8cd3e4f3dc3ff7697559838.png)\n\n`é…ç½®ä¸¾ä¾‹`\n\n![image-20250216145301044](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1740ed77ebd261bede0603cfc2b05b8d697559838.png)\n\n```\n[R1]interface GigabitEthernet0/0/0\n[R1-GigabitEthernet0/0/0]ip address DHCP-alloc\n[R1-GigabitEthernet0/0/0]quit\n\n[R2]DHCP server group HW\n[R2-DHCP-server-group-HW]DHCP-server 10.1.1.2\n[R2-DHCP-server-group-HW]quit\n[R2]interface GigabitEthernet 0/0/1\n[R2-GigabitEthernet0/0/1]ip address 10.1.1.124\n[R2-GigabitEthernet0/0/1]quit\n[R2]interface GigabitEthernet 0/0/0\n[R2-GigabitEthernet0/0/0]ip address 192.168.1.124\n[R2-GigabitEthernet0/0/0]DHCP select relay\n[R2-GigabitEthernet0/0/0]DHCP relay server-select HW\n[R2-GigabitEthernet0/0/0]quit\n```\n\n\n\n#### DHCP Snoopingé˜²æ­¢ç§æ¥DHCPæœåŠ¡å™¨\n\n![image-20250216145422479](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c1ae4c0478bcaa578a30e3ec71a2ec30697559838.png)\n\n`DHCP Snoopingé…ç½®`\n\nDHCP Snoopingé…ç½®\n\n1.å¼€å¯DHCPåŠŸèƒ½ï¼Œæ‰€æœ‰æ¥å£é»˜è®¤ä¸º untrusted\n\n[Huawei] `dhcp enable`\n\n2.å¼€å¯DHCP snoopingåŠŸèƒ½\n\n[Huawei] `dhcp snooping enable` \n\n\n\n[Huawei]int GigabitEthernet0/0/1\n\n3.æ¥å£ä¸‹å¼€å¯DHCP SnoopingåŠŸèƒ½\n\n[Huawei-GigabitEthernet0/0/1]dhcp snooping enable \n\n4.æŠŠæ¥å£g0/0/1è®¾ç½®ä¸ºä¿¡ä»»æ¥å£\n\n[Huawei-GigabitEthernet0/0/1]dhcp snooping trusted \n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216145730262](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fe7780d59fdf5218c027f51c14f5d58f697559838.png)\n\n![image-20250216145804401](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b4a64bb6492374a3e7778c92adfad387697559838.png)\n\n![image-20250313213631154](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2d9ddf9f29262b0013a81e5e355f048d697559838.png)\n\n![image-20250216145820556](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8aaa4d9fc9e7f1e66f4ec6848add6481697559838.png)\n\n![image-20250216145830776](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e603a03fd97350c7012ba5bf945f51b7697559838.png)\n\n![image-20250216145845283](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cb63e76c1bcf9eee0095caabecdbc6b1697559838.png)\n\n![image-20250216145903003](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b031be526d9f490456ada7043eec5eb555933597.png)\n\n![image-20250216145912952](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b5faf62e9f5ab00c470d091fe37f890c55933597.png)\n\n\n\n### DNS\n\nDNSä½œç”¨:æŠŠåŸŸåè½¬æ¢æˆIPåœ°å€ã€‚\n\nDNS/DHCPæœåŠ¡å™¨å¿…é¡»ä¸ºé™æ€IPåœ°å€ï¼Œè€ŒWeb/FTPå‡å¯ä¸ºåŠ¨æ€IP\n\nLinuxç³»ç»Ÿä¸­æä¾›DNSæœåŠ¡çš„ç»„ä»¶ä¸º `bind`ï¼Œä¸»é…ç½®æ–‡ä»¶ä¸º`named.conf`\n\nè¯Šæ–­åŸŸåç³»ç»ŸåŸºç¡€ç»“æ„çš„ä¿¡æ¯å’ŒæŸ¥çœ‹DNSæœåŠ¡å™¨çš„IPåœ°å€å‘½ä»¤æ˜¯:`nslookup`.\n\n\n\n#### DNSè®°å½•ç±»å‹\n\n![image-20250216150142702](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9f627cce6c527ba2601f1dd1c01601ba55933597.png)\n\n#### DNSæŸ¥è¯¢è¿‡ç¨‹\n\n![image-20250216150210395](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fc91c103f000d70acd083cdf09c3b31955933597.png)\n\n#### DNSæŸ¥è¯¢æ–¹å¼\n\né€’å½’æŸ¥è¯¢:åŸŸåæœåŠ¡å™¨å¸®åŠ©ç”¨æˆ·è¿›è¡Œåå­—è§£æï¼Œå¹¶è¿”å›æœ€åçš„ç»“æœã€‚ã€è€å¥½äººã€‘\n\nè¿­ä»£æŸ¥è¯¢:åŸŸåæœåŠ¡å™¨è¿›è¡Œè¿­ä»£è®¿é—®ï¼Œåå¤å¤šæ¬¡ï¼Œç›´åˆ°æœ€åæ‰¾åˆ°ç»“æœã€‚ã€è¸¢çš®çƒã€‘\n\n![image-20250216150345965](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9bf65332e240a5e97cc3a55032c0ad6355933597.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250216150428218](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4b839818127721881b3b78f9a20a013855933597.png)\n\n![image-20250216150442287](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/02fd631f0c9d54660818321cb3d5bdb355933597.png)\n\n![image-20250216150501398](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/35a1795b22e88713122aca805040269e55933597.png)\n\n![image-20250216150513170](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f9f79e547b38855830bac90e576ebb7b55933597.png)\n\n![image-20250216150522383](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2312d4c9f36bfb0fb3b52720bd4a474c55933597.png)\n\n\n\n## ç»„ç½‘æŠ€æœ¯\n\n### äº¤æ¢æœºåŸºç¡€\n\n#### äº¤æ¢æœºåˆ†ç±»\n\n![image-20250216152155701](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b43c5ae9fc4594bdc8be546f42eab51e55933597.png)\n\nå…¶ä»–åˆ†ç±»æ–¹å¼\n\n![image-20250216152320582](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8f9a747ec63055b18587965221c079b055933597.png)\n\n![image-20250216152346321](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d1d6c3d08d234d8a38d68ebbab0e790f55933597.png)\n\n#### åä¸ºæ¨ªå‘è™æ‹ŸåŒ– CSS+iStack\n\næ¡†å¼äº¤æ¢æœºå †å å¤šç”¨äºç½‘ç»œæ ¸å¿ƒå±‚æˆ–æ±‡èšå±‚ï¼Œè€Œç›’å¼äº¤æ¢æœºå †å ä¸€èˆ¬ç”¨äºæ±‡èšå±‚æˆ–æ¥å…¥å±‚ã€‚\n\n![image-20250216152508101](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b88a7cf1f8c5dc89e3a142044d2e3eba55933597.png)\n\nå¤šå°è®¾å¤‡å †å å’Œé›†ç¾¤\n\n![image-20250216152551902](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d8aa0c0ab13de4dad38d26d859a6255455933597.png)\n\n![image-20250216152604924](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b1968742e259fc128887ab7ac16f9de455933597.png)\n\n#### å †å çš„ä¼˜åŠ¿\n\n![image-20250216152659368](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e0d23c30b903efe4fd3ea2517eac741355933597.png)\n\n#### å †å çš„åŠ£åŠ¿\n\n![image-20250216153516922](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/37f9573b7b05ac7704ae975dafaa876755933597.png)\n\n(1)å †å æŠ€æœ¯ä¼˜ç‚¹:\n\nâ‘ é€»è¾‘ä¸Šå˜ä¸ºä¸€å°è®¾å¤‡ï¼Œç®€åŒ–ç½‘ç»œç®¡ç†;\n\nâ‘¡æå‡ç³»ç»Ÿå¯é æ€§ï¼Œé¿å…å•ç‚¹æ•…éšœ;\n\nâ‘¢é…åˆé“¾è·¯èšåˆç­‰æŠ€æœ¯ï¼Œé˜²æ­¢æ¥å£è¢«ç”Ÿæˆæ ‘é˜»å¡ï¼Œæå‡é“¾è·¯åˆ©ç”¨ç‡ã€‚\n\nå †å æŠ€æœ¯ç¼ºç‚¹:\n\nâ‘ å †å æ˜¯ç§æœ‰åè®®ï¼Œä¸æ”¯æŒè·¨å‚å•†è®¾å¤‡å †å ;\n\nâ‘¡ç³»ç»Ÿå‡çº§ä¼šé€ æˆä¸šåŠ¡ä¸­æ–­;\n\nâ‘¢å¤šå°è®¾å¤‡å †å ï¼Œåªæœ‰ä¸€ä¸ªä¸»æ§å¤„äºå·¥ä½œçŠ¶æ€ï¼Œå­˜åœ¨èµ„æºæµªè´¹ã€‚\n\n\n\n\n\n#### å †å çš„ä¸‰ç§è§’è‰²\n\n![image-20250216153547000](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/05380bcfecf3292e32898230783161c355933597.png)\n\n#### äº¤æ¢æœºæ€§èƒ½å‚æ•°\n\n![image-20250216153615483](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6afc7c5df3c45cbc725392cc2d3114da55933597.png)\n\n![image-20250216154430026](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2685f9a2ee36888e84d95aa5d987c22b55933597.png)\n\n\n\nä¾‹é¢˜\n\n![image-20250216154455616](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/92445015e3bc1fd2f86b98cdbca2164e55933597.png)\n\n![image-20250216154514569](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/40f31034c70dd51025707ed3fa5b638755933597.png)\n\n![image-20250216154527506](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/310ab8b0477d8238bd1dc2294eb96f1555933597.png)\n\n![image-20250216154717799](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cc963fbbf7c43fda5b660087a77f434255933597.png)\n\n![image-20250216154732049](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/478a54d038320ecc24567dd82744778255933597.png)\n\n### è·¯ç”±å™¨åŸºç¡€\n\n#### è·¯ç”±å™¨æ¥å£\n\nå¹¿åŸŸç½‘WANç«¯å£å’Œå±€åŸŸç½‘LANç«¯å£ã€‚\n RJ45ç«¯å£:å¸¸è§„ä»¥å¤ªç½‘ç”µå£ã€‚\n\n ä»¥å¤ªç½‘å…‰å£:GBIC/`SFP/SFP+/QSFP+`/SFP28.\n\n AUIç«¯å£:ç”¨äºä»¤ç‰Œç¯æˆ–æ€»çº¿å‹ä»¥å¤ªç½‘æ¥å£ã€‚\n\n\n\n `Serialä¸²å£`:ç”¨äºè¿æ¥DDNã€å¸§ä¸­ç»§ã€X.25ã€PSTNç­‰ç½‘ç»œã€‚\n\n ISDN BRI/PRIç«¯å£:ISDNçº¿è·¯äº’è”ã€‚BRI:144K,PRI:2.048M\n\n SDH POSæ¥å£:`155M/622M/2.5G/10G`ã€‚\n\n\n\n#### è®¾å¤‡ç®¡ç†æ–¹å¼\n\n![image-20250216155029939](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3e647f2399f6b07bffe4c4b4f20c302d55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216155128226](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/572290a4a1f54597839e52f26b76279b55933597.png)\n\n![image-20250216155142124](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1e3a4ff6f81553bc890fbd049c4bd05c55933597.png)\n\n![image-20250216155200721](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/522427ba6b43f478f21d63029d23852e55933597.png)\n\n## ç½‘ç»œç®¡ç†\n\n### ç½‘ç»œç®¡ç†åŸºç¡€\n\n#### ç½‘ç»œç®¡ç†ä½“ç³»ç»“æ„\n\nç½‘ç»œç®¡ç†äº”å¤§åŠŸèƒ½åŸŸ:`æ•…éšœç®¡ç†ã€é…ç½®ç®¡ç†ã€è®¡è´¹ç®¡ç†ã€æ€§èƒ½ç®¡ç†å’Œå®‰å…¨ç®¡ç†`ã€‚\n\nåŠ©è®°:â€œ`å®‰é…èƒ½è®¡éšœ`'\n\næ•…éšœç®¡ç†:`å°½å¿«å‘ç°æ•…éšœï¼Œæ‰¾å‡ºæ•…éšœåŸå› `ï¼Œä»¥ä¾¿é‡‡å–è¡¥æ•‘æªæ–½ã€‚\n\n\n\n#### ç½‘ç»œç›‘æ§ç³»ç»Ÿä½“ç³»ç»“æ„\n\nä»£ç†ä¸ç›‘è§†å™¨ä¸¤ç§é€šä¿¡æ–¹å¼:`è½®è¯¢å’Œäº‹ä»¶æŠ¥å‘Š`\n\n![image-20250216155550295](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c8ea734a6cdf4f7983c7824f8b7d501e55933597.png)\n\nè½®è¯¢æ—¶é—´ä¸ç®¡ç†è®¾å¤‡æ•°é‡\n\n![image-20250216155717773](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/50c2de3e929abe93541196f90bf22d7455933597.png)\n\n![image-20250216155745594](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1584d70bb4a9ccc038d7766dfc3930fe55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216155810862](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cda7825e52113cb83db5305f54256d1455933597.png)\n\n![image-20250216155834705](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9c71dcf84ae094bd4d31a8d2bbd0221055933597.png)\n\n![image-20250216155856075](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/64d7d87a76fc21640552bf6c3421ea9755933597.png)\n\n#### ç½‘ç»œç®¡ç†åè®®äº”å¤§æ ‡å‡†\n\nISOåˆ¶å®š:<font color='red'>CMIS/CMIP</font>å…¬å…±ç®¡ç†ä¿¡æ¯æœåŠ¡è§„èŒƒã€‚\n\nåŸºäºTCP/IP:ç®€å•ç½‘ç»œç®¡ç†åè®®<font color='red'>SNMPv1ã€SNMPv2ã€SNMPv3</font>ã€‚\n\nåŸºäºå±€åŸŸç½‘:è¿œç¨‹ç›‘æ§ç½‘ç»œ<font color='red'>RMON-1å’ŒRMON-2</font>ã€‚\n\nIEEEåˆ¶å®š:åŸºäºç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚<font color='red'>CMOL</font>ã€‚\n\nITU-T:ç”µä¿¡ç½‘ç»œç®¡ç†æ ‡å‡†<font color='red'>TMN</font>ã€‚\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216160057974](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f29762eac4e865808172ce57835f98b955933597.png)\n\n\n\n`RMON`\n\n![image-20250216160135408](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bfdb2612b1980f36fbd00356c7a52c7b55933597.png)\n\n![image-20250313213855988](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ee9bfb7a722bb6e254452c8e6a104ea9697559838.png)\n\n`SNMPå’ŒRMONåŒºåˆ«`\n\n![image-20250216160256753](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/124ab4bb3849e56795f04633ec4d2b8755933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216160328931](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/38ce1e9393faba8d5f445846e059a27e55933597.png)\n\n\n\n### SNMP\n\n#### SNMP-2ä¸ªæœåŠ¡2ä¸ªç«¯å£5ä¸ªæŠ¥æ–‡ï¼ˆ225ï¼‰\n\n![image-20250216160413334](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bb010b00bcb7431b9fcc131439d689dd55933597.png)\n\n![image-20250216160433213](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2d5c0332192ad06107d31f877dd1623955933597.png)\n\n\n\n#### SNMPåè®®çš„æ“ä½œ-5ä¸ªæŠ¥æ–‡\n\n![image-20250216160621370](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dfc036ef6fb4a74f9b54bf8cf34450b955933597.png)\n\n![image-20250216160640045](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/71200361f945c8e09a1f6a231573ce0d55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216160658487](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6c6db95f219843b8b2bc4f83735355e055933597.png)\n\n![image-20250216160711186](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6e45a8e51a82dae68b9dfa55f289d45855933597.png)\n\n![image-20250216160722636](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fb61ec1d89203055b09e52a7a01fe32055933597.png)\n\n![image-20250216160736237](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1bbc6cc8137714eb61b97778dfa6ca1d55933597.png)\n\n![image-20250216160846940](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/aeaa84bbbe7b65ee1ffd21ee598cb3c755933597.png)\n\n![image-20250216160859058](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/46a1a85f4c247ea944b576bb8821006555933597.png)\n\n#### SNMPç‰ˆæœ¬å¯¹æ¯”\n\n![image-20250216160930586](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7ea6e0e5555c677c4de6bb88a775bb1b55933597.png)\n\n![image-20250216160950572](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ae2448f13d4504f85a752be50d71414655933597.png)\n\n![image-20250216161002738](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/727e7a5d07952ef20f13d3a1a68092f355933597.png)\n\n![image-20250216161015013](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4b568e83c6f0312a7aeb6fdfa6f8bf9955933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216161056660](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/69fd948b8697126a89ec6e963aa026a555933597.png)\n\n![image-20250216161114554](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a8f4fa77f8418f4c7f0f172cff668e3755933597.png)\n\n![image-20250216161135191](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/16b5b7f1d4ebbacc7efc56f70a66d2b355933597.png)\n\n![image-20250216161233264](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/720bf09369549645dae0bdfb350fec0f55933597.png)\n\n\n\n#### ç®¡ç†æ•°æ®åº“MIB-2\n\n![image-20250216161255572](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/22f62ffc018122b4fa0ef580a49f35f355933597.png)\n\nä¾‹é¢˜\n\n![image-20250216161315503](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7aa313a775c88dc08c428b00031e6f8355933597.png)\n\n\n\n### ç½‘ç»œç®¡ç†å‘½ä»¤\n\n#### ç½‘ç»œè¯Šæ–­å‘½ä»¤ ipconfig\n\n![image-20250216161407023](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c2986597834b99f4e649d729fa34fb0155933597.png)\n\n![image-20250216161447532](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cef05e4767cc22b3fff04d3b5d12ad0755933597.png)\n\n#### æ•…éšœè¯Šæ–­ ping traceroute\n\n![image-20250216161519587](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4bfafa0a4d73e1a952682fb4d743562e55933597.png)\n\n\n\n#### ARPå‘½ä»¤\n\n![image-20250216161556511](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b317956ab90309cf4db86f9bb112310d55933597.png)\n\n\n\n#### Netstat\n\n![image-20250216161621699](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c7a07ce8767a260841b90c9accc3896555933597.png)\n\n![image-20250216161636713](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/65c64d3f5418512deb4c21b7272a5f1655933597.png)\n\n\n\n#### routeå’Œnslookup\n\n![image-20250216161705657](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fb0cf128d68960b50a330e6f5843c80d55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216161755887](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a22e9656f0a18306195bf71b623b32c055933597.png)\n\n![image-20250216161817979](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f24e1ece58ed8e16ac23031a74bf0f3a55933597.png)\n\n![image-20250216161838539](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/81f19d4f28bc0fa8fcdf1e29f00c346055933597.png)\n\n\n\n### ç½‘ç»œæ•…éšœæ’é™¤å·¥å…·\n\n#### ç½‘ç»œæ•…éšœæ’æŸ¥å·¥å…·\n\n![image-20250216174500678](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/88eff2b90c9dade17c2fbeda4261f12355933597.png)\n\n![image-20250216174520151](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0ffc0b919b11e67224647430a18d38dc55933597.png)\n\n\n\n`displayæ˜¾ç¤ºè®¤è¯å¤±è´¥åŸå› `\n\n![image-20250216174912314](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2d2f52c6b7b227329c4657d4fbb4b83355933597.png)\n\n\n\n![image-20250216174951346](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0ee989322f8a4bb5e9f27a4e307d7c0a55933597.png)\n\n![image-20250216175002516](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cc0e968290baf8f439b35266c2b238ef55933597.png)\n\n![image-20250216175042157](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5e3a25ba519081e034b989a8209475ee55933597.png)\n\n#### åŒç»çº¿æµ‹è¯•å·¥å…·\n\nå¤šåŠŸèƒ½ç½‘ç»œå¯»çº¿ä»ª/æµ‹çº¿ä»ª\n\n![image-20250216175129520](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e52bfc2c14d8d90edd82657b5d197f9655933597.png)\n\n![image-20250216175142864](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/140c0112a0af6136d8a1ebfe219756d855933597.png)\n\n#### å…‰çº¤æµ‹è¯•å·¥å…·-çº¢å…‰ç¬”\n\n![image-20250216175213562](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1a158cd652b535af6514d8dc704f04d955933597.png)\n\n#### å…‰çº¤ç†”æ¥æœº\n\n![image-20250216175234510](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cc85ae005def706da42f8934eefb27dc55933597.png)\n\n![image-20250216175243372](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c518ba46e1ddf9df8d9934285d79a41355933597.png)\n\n#### å…‰çº¤æµ‹è¯•å·¥å…·-å…‰åŠŸç‡è®¡\n\n![image-20250216175301802](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/47a05d079c4b279d7ea849523c77142255933597.png)\n\n![image-20250216175311927](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6b0ae1b418b57bb47229b1075adf059255933597.png)\n\n#### å…‰æ¨¡å—åŠŸç‡\n\nåä¸‰40Gå…‰æ¨¡å—è¾“å‡ºå…‰åŠŸç‡/æ¥æ”¶å…‰åŠŸç‡\n\n![image-20250216175404411](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/03e0dcb0c2fe5873aee17bc7882d816455933597.png)\n\n![image-20250216175417878](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6824e793ce2a5c754d11c4b03d42407955933597.png)\n\n\n\n#### å…‰çº¤æµ‹è¯•å·¥å…·-å…‰æ—¶åŸŸåå°„ä»ªOTDR\n\n![image-20250216175451412](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d4e151d83f625b307bfbe57aaed7621755933597.png)\n\n![image-20250216175514211](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/93653a02d1f3387d339d5f1cfefca5d855933597.png)\n\n#### å…‰åŠŸç‡è®¡å’Œå…‰æ—¶åŸŸåå°„ä»ªOTDRåŸç†å¯¹æ¯”\n\n![image-20250216175533129](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/81cc1605241e35a1e053bb93d7e9aeac55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216175557952](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8f6c2ef8aca6824e428f7612d9e2535f55933597.png)\n\n![image-20250216175611834](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/13bd7fc837f1765eb6db9b62ccc8710555933597.png)\n\n![image-20250216175626305](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/61e267e8f8fd487371ec70253537314d55933597.png)\n\n![image-20250216175635297](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4f2777eaf4e2c918edf71b9a12300ff255933597.png)\n\n![image-20250216175651575](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f010bdbcf6736bac2c18df3ce4a1c06155933597.png)\n\n![image-20250216175659892](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d547909c70cbe8fae56e419bf78efed555933597.png)\n\n### ç½‘ç»œæ•…éšœè¯Šæ–­ä¸æ’æŸ¥\n\n![image-20250216175802468](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/48999afb9a73d77294f82ff0d708e9e855933597.png)\n\n![image-20250216175812185](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4820ac0fbf1cd119d01e4adda9042ce655933597.png)\n\n![image-20250216175959531](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e78e136a2592ad3f46c0ebf68c78472455933597.png)\n\n## ç½‘ç»œè§„åˆ’å’Œè®¾è®¡\n\n### ç»¼åˆå¸ƒçº¿\n\n![image-20250216184407967](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9d6d0a5d53c01b5ad88a2be76c08907155933597.png)\n\n![image-20250216184419846](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f29eadb04d33124704c9b29339db825155933597.png)\n\n![image-20250216184634908](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c530c8c617db4dc3dea6a73793faa78a55933597.png)\n\næ³¨æ„çº¿ç¼†é•¿åº¦çš„é™åˆ¶\n\n![image-20250216184706226](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7e9876f8ef5f04d0b604a12fae9fc1ea55933597.png)\n\n![image-20250216184719021](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/36a899dddf5d041acb136cde2293b7bd55933597.png)\n\n![image-20250216184733236](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1cbf3eef57766469fd8083379d405f2d55933597.png)\n\n![image-20250216184801410](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/72357e7df7568c8aa2fca94b8a2476a755933597.png)\n\n![image-20250216184848986](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/25f5b4c2924ab40e221cd920c834303255933597.png)\n\n![image-20250216184905596](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/07bc21668eaceb5d4bbd3a7352a3762e55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216184920906](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3314ad065753011202192c9e0a25c01755933597.png)\n\n![image-20250216184936502](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f6a8217f783521500c5423cabb64bf2a55933597.png)\n\n![image-20250216184950392](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6fbcf2e7fbdb5a96c3eeee47c28e526655933597.png)\n\n![image-20250216185010010](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/99426d293ca01183bbdc4018d6f4142455933597.png)\n\n![image-20250216185032784](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/42b89e511524df7e5ad711b9018085b955933597.png)\n\n![image-20250216185043658](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d9d79e8859862a13e4f613ba44aa003255933597.png)\n\n![image-20250216185101989](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8d7dd3b4c747ff56c07316f02d0c0a1955933597.png)\n\n![image-20250216185158507](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f577481b51285e58e6dce389661ad73255933597.png)\n\n![image-20250216185247358](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a063e040df08f30eadeb9e79896431d255933597.png)\n\n![image-20250313214036038](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ee1eec55a03b780ffb98de55b2f903dd697559838.png)\n\n![image-20250216185305677](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4e9f98a69b098fea246e346fb8ef8bed55933597.png)\n\n![image-20250216185311019](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/38fff8301202102bb13b18cbe627fe8355933597.png)\n\n\n\n![image-20250216185354516](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2d03575f3709eb4adcc00b7228ec62f255933597.png)\n\n![image-20250216185402148](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/81c11bebf9b4ee7aba11c7ba4180d66755933597.png)\n\n\n\n![image-20250216185416122](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0fbe1cd1bfab1418176e1e5be2cd9ce055933597.png)\n\n![image-20250216185424208](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/88986d010d897f727741c1728e32923a55933597.png)\n\n\n\n### ç½‘ç»œåˆ†æä¸è®¾è®¡\n\n#### ç½‘ç»œè§„åˆ’è®¾è®¡æ¨¡å‹\n\n![image-20250216185524910](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/65eaa36dd180337974e7d5e371440b5255933597.png)\n\n![image-20250216185543964](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/76c1a5c3494be1af92cbfa765cdfced455933597.png)\n\n![image-20250216185559468](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3e645a4e944cdf49c43362a8127f53ff55933597.png)\n\n\n\n#### ç½‘ç»œè®¾è®¡çš„çº¦æŸå› ç´ \n\n![image-20250216185614373](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bcbe8ee6cc38822a4e98ca95aa5ca5aa55933597.png)\n\n![image-20250216185639899](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/df1a5f1464f52c5f6dc88e55a4dde62955933597.png)\n\n\n\n#### ç½‘ç»œæµé‡åˆ†æ\n\n![image-20250216185656281](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c36670d7603852ffd0c5bf2fec8c809255933597.png)\n\n![image-20250216185715939](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/80ea92f9d0135012286df638ecfb105755933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216185735105](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c29d2b8d891c7a0e1b1bdc879322038b55933597.png)\n\n![image-20250216185751847](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c417b1846eb0982e383cf919d609729155933597.png)\n\n![image-20250216185803802](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f876032e464236450298f1f976873fbc55933597.png)\n\n![image-20250216185821847](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e63fc265df3d6d5ff00cb78b3866f09655933597.png)\n\n![image-20250216185836680](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c0f426a55190d290014dfc02681beb2155933597.png)\n\n![image-20250216185921665](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d951674ecaa33f3b4a7e1abccdd9905b55933597.png)\n\n![image-20250216185903899](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4983ff7408649e2f3054e1f92a405f6a55933597.png)\n\n\n\n#### æŠ€æœ¯è¯„ä»·\n\n![image-20250216185946309](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b044ccf04d12dde12ca9b9659590e1ea55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216190008608](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/34f51434d497cca60a284e8449c1a78855933597.png)\n\n\n\n### ç½‘ç»œç»“æ„ä¸åŠŸèƒ½\n\n#### å±€åŸŸç½‘ç»“æ„ç±»å‹\n\n![image-20250216190045674](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/02c3666f0ea34d0a604f2c34110a4b4155933597.png)\n\nå•æ ¸å¿ƒå±€åŸŸç½‘ç‰¹ç‚¹\n\n![image-20250216190112805](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c431070d5802484cb46e1e263f5f176355933597.png)\n\nåŒæ ¸å¿ƒå±€åŸŸç½‘ç‰¹ç‚¹\n\n![image-20250216190135740](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d773a606b1dc1d9d2b252eb769a323f055933597.png)\n\n#### ç¯å½¢å±€åŸŸç½‘ç»“æ„\n\n![image-20250216190152871](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9ab88c73fff98cdfe6725beb07388b2755933597.png)\n\nç¯å½¢å±€åŸŸç½‘ç»“æ„ç‰¹ç‚¹\n\n![image-20250216190211960](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3c8f41b4cfb2200c128bbe9a7a95b44355933597.png)\n\n#### å±‚æ¬¡åŒ–ç½‘ç»œè®¾è®¡/ä¸‰å±‚ç»„ç½‘æ¶æ„\n\n![image-20250216190245123](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6c1fddd1f08822b669e2191bea6e57b855933597.png)\n\nå±‚æ¬¡å±€åŸŸç½‘ç»“æ„ç‰¹ç‚¹\n\n![image-20250216190317372](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1bcda3738ed0926342641e8425640b4b55933597.png)\n\n\n\n#### ä¸‰å±‚ç»„ç½‘æ¶æ„\n\n![image-20250216190338287](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d5dd251ac8932b076efc19abe67edea655933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216190359531](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fe3d89ca382407f69c501d71305fde1155933597.png)\n\n\n\n#### å±‚æ¬¡åŒ–ç½‘ç»œæ¨¡å‹ä¼˜ç‚¹\n\n![image-20250216190420615](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b3c823ab8e59db0723680b47a5a9bd2055933597.png)\n\nå±‚æ¬¡åŒ–ç½‘ç»œæ¨¡å‹åŸåˆ™\n\n![image-20250216190445111](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e9107937f8cada411016816a65951ccf55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216190512385](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a18efb3cac468c8a690d54a46648af2455933597.png)\n\n![image-20250216190526972](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1e5944a3e66ed66b28338e688ee5a1eb55933597.png)\n\n![image-20250216190540976](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/391068dc714d790bde8ebd1dcbdb022d55933597.png)\n\n![image-20250216190556276](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b2f09be8a5b3a56c281627e17b375c8555933597.png)\n\n![image-20250216190609688](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/496c8ea2453dd03584bb716a5ddf8e3d55933597.png)\n\n\n\n#### ç½‘ç»œå†—ä½™è®¾è®¡\n\n![image-20250216190653672](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b158bbcfbf8cc753ad75e82869c8e0b255933597.png)\n\n![image-20250216190701686](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5469780dad428e5f13d3fc74933ef4c055933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216190717585](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c8635f0d8e26e3445e452ab5d8bfa7c955933597.png)\n\n![image-20250216190732441](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/adf96373329d51333a54d3fc3260803355933597.png)\n\n\n\n#### å¹¿åŸŸç½‘æ¥å…¥æŠ€æœ¯\n\n![image-20250216190750833](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/87db5e9abcf41ea215ce391df1438dd755933597.png)\n\næ¥å…¥å’Œç»ˆç»“è®¾å¤‡\n\n![image-20250216190813602](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e325f2130fa7db49ee58931e353547ca55933597.png)\n\n\n\n##### PONæ¥å…¥\n\n![image-20250216190845269](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a0871e1046d804730939d653bebc2c1955933597.png)\n\n##### å…¶ä»–æ¥å…¥æŠ€æœ¯\n\nå…³é”®è¯ï¼šMSTP\n\n![image-20250216190916888](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/010060d54cb969055662f846569292b555933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216190947382](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a76f1eaee305829a8c81ad6db6f4b2dd55933597.png)\n\n![image-20250216191001731](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e56165bf1ba7303e106bac2c56ae223355933597.png)\n\n![image-20250216191014121](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d3ef5131c02c72d9e527f5856b001a3c55933597.png)\n\n![image-20250216191024441](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8df2c208e3ba5f9c4b346303005432c655933597.png)\n\n![image-20250216191036724](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4cd83d89f6b5baec3b21f1d7c6f7549f55933597.png)\n\n![image-20250216191050013](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b03863ae46d726297a870e63637dedb955933597.png)\n\n## å­˜å‚¨ä¸RAIDæŠ€æœ¯ä¸“é¢˜\n\n### å­˜å‚¨åŸºç¡€\n\n#### å­˜å‚¨ç³»ç»Ÿå±‚æ¬¡ç»“æ„\n\nå­˜å‚¨ä½“ç³»ç»“æ„å¦‚ä¸‹å›¾ï¼Œåˆ†ä¸º`å¯„å­˜å™¨ã€é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ã€ä¸»å­˜å‚¨å™¨å’Œå¤–å­˜å‚¨å™¨`\n\n![image-20250216180325243](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/82b629f6bcf7f687ed62a9cb142cb80255933597.png)\n\n#### å­˜å‚¨ä»‹è´¨\n\n![image-20250216180347565](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ad41327a2ec6829ce47c3fd2d52d8ee555933597.png)\n\n#### HDDæœºæ¢°ç¡¬ç›˜ä¸SSDå›ºæ€ç¡¬ç›˜\n\n![image-20250216180436503](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2a77241e1037a9b57a6c253de3bb387355933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216180459600](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1b566f1982261c476be81545b4207a6355933597.png)\n\n![image-20250216180513829](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/71d1b78dd12774ffb69c57a5d650797055933597.png)\n\n![image-20250216180529487](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a8b800dea50cc499dea039513d692e9f55933597.png)\n\n![image-20250216180542913](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1598b7cb5ab871afa620565004df84e455933597.png)\n\n![image-20250216180606667](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/46682b608032453282a1c63cbf7a66d455933597.png)\n\n![image-20250216180621416](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9d11be76597fc5c0bad7ba2f6475d28f55933597.png)\n\n![image-20250216180635266](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/994e83873481e21ebb633e589536c1c955933597.png)\n\n![image-20250216180658186](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ca613b9dec0e61f445abf320298ed17255933597.png)\n\n\n\n### ä¼ ç»ŸRAIDæŠ€æœ¯\n\n#### RAIDå®šä¹‰\n\nRAID(Redundant Array of Independent Disks)å³`ç‹¬ç«‹ç£ç›˜å†—ä½™é˜µåˆ—`ï¼ŒRAIDæŠ€æœ¯å°†å¤šä¸ªå•ç‹¬çš„ç‰©ç†ç¡¬ç›˜ä»¥ä¸åŒçš„æ–¹å¼ç»„åˆæˆä¸€ä¸ªé€»è¾‘ç¡¬ç›˜ï¼Œä»è€Œæé«˜äº†`ç¡¬ç›˜çš„è¯»å†™æ€§èƒ½å’Œæ•°æ®å®‰å…¨æ€§`ã€‚\n\n![image-20250216180826250](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/78dec64a29a358bb828a73394ffb021355933597.png)\n\n\n\n#### RAIDæ•°æ®ç»„ç»‡åŠå­˜å–æ–¹å¼\n\n![image-20250313214741121](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a0b504ac255437752e33c2269b018f78697559838.png)\n\n\n\n#### RAIDçƒ­å¤‡ä¸é‡æ„\n\n![image-20250216180935507](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f49f736438be50edc2d48f7419c44a9155933597.png)\n\n#### RAIDåŸºæœ¬æ¦‚å¿µ-é€»è¾‘å·\n\n![image-20250216181000339](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e7eebb6ee9c4c48b1f95f340502211bc55933597.png)\n\n#### å¸¸ç”¨RAIDæŠ€æœ¯-RAID Oå’ŒRAID 1\n\n![image-20250216181024535](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/45d862773f82a6d84c1aa05a0286524d55933597.png)\n\n#### å¸¸ç”¨RAIDæŠ€æœ¯-RAID 3å’ŒRAID 5\n\n![image-20250216181105601](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0f7d7efc6b4c3befdef302ab122290d155933597.png)\n\n#### å¸¸ç”¨RAIDæŠ€æœ¯-RAID 6\n\n![image-20250216181147124](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/12c1fdbf00f387654fc4d4be7ffa28d155933597.png)\n\n#### RAIDç»„åˆ-RAID 10å’ŒRAID 50\n\n![image-20250216181212977](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fef82ce528f4e5ebaedde5b37d52575f55933597.png)\n\n#### å¸¸ç”¨RAIDæŠ€æœ¯å¯¹æ¯”\n\n![image-20250216181312353](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/05056bc2a92496610bd6511f56d5c5bb55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216181351506](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4e31dea0ce3d879cd2927d8e0d32bc4d55933597.png)\n\n![image-20250216181412077](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/67b8f9e1b86e58dec53f95bf179bb1f755933597.png)\n\n![image-20250216181427635](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3bb6ee25201ed01208ec5447b332722c55933597.png)\n\n\n\n### RAID2.0æŠ€æœ¯\n\n#### RAIDæ•…éšœè‡ªæ£€è‡ªæ„ˆï¼Œä¿è¯ç³»ç»Ÿå¯é æ€§\n\n![image-20250216181514587](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3cc7829cfa7a732a5c2655250d5e09fe55933597.png)\n\n#### RAID2.0æŠ€æœ¯ä¼˜åŠ¿\n\n![image-20250216181550402](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0ee2150284feb6859efd51e20981ac1c55933597.png)\n\n![image-20250216181606736](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eab8c62674cea5b7c2ddbabf2e65e90255933597.png)\n\n\n\n### ç½‘ç»œå­˜å‚¨ä½“ç³»DAS/NAS/SAN\n\n![image-20250216181648317](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/37816a480e0859967bc25616a1ea351455933597.png)\n\n#### DASèµ·æº\n\n![image-20250216182134133](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/982df2f09df9e8ba063489838eea464955933597.png)\n\n#### FC SANèµ·æºï¼ˆç”±DASåˆ°FC SANï¼‰\n\n![image-20250216182232439](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/369030afe4179c02bf937bf22cc17e4c55933597.png)\n\n#### IP SANèµ·æº(ç”±FC SANåˆ°IP SAN)\n\n![image-20250216182316591](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3d831517054a174f6f960e9e7925364d55933597.png)\n\n#### NASèµ·æº(ç½‘ç»œæ•°æ®å…±äº«ä¸äº¤æ¢éœ€æ±‚)\n\n![image-20250216182355067](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f0932494a24046d84f3684ecd47f984755933597.png)\n\n#### å‡ ç§å­˜å‚¨å¯¹æ¯”\n\n![image-20250216182424954](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a3455095e3091215d880fe8b1e3635fd55933597.png)\n\n![image-20250216182436585](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3e343e790bfc8b1fa23123cc80b8678e55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216182500895](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/91b9b1076d3d8bd4e700a0757572d79155933597.png)\n\n![image-20250216182709520](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/12f6bf889fd352df08949bdb9762f73855933597.png)\n\n\n\n#### åˆ†å¸ƒå¼å­˜å‚¨/è¶…èåˆ\n\n![image-20250216182739556](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e589f4070ed9fc46a1a9c113e43e0bea55933597.png)\n\nåˆ†å¸ƒå¼å­˜å‚¨ç»„æˆä¸ç‰¹ç‚¹\n\n![image-20250216183130610](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/924acff70ee7aba6d156f0b70e6d937855933597.png)\n\n#### æ•°æ®å¤‡ä»½ç­–ç•¥\n\n![image-20250216183157113](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6a75b717a07242fe44b426549adb4e6955933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216183218139](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/95a89ad3ae61b3c214d3336343f24fd955933597.png)\n\n\n\n#### æ•°æ®å¤‡ä»½ç½‘ç»œæ¶æ„\n\n![image-20250216183303477](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bccaa7a015e90755a44c5cba71f2613e55933597.png)\n\næ•°æ®å¤‡ä»½ç½‘ç»œæ¶æ„:Server-Free\n\n![image-20250216183329896](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d046748302dc849a98f75266352c968255933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250216183357159](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b668353733a32ea69b5193072554b00755933597.png)\n\n![image-20250216183447828](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/de1e55afcf303e968bb9357cd5b3888b55933597.png)\n\n![image-20250216183502576](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7fb188afff2e107b9245bbaeefc5cc8855933597.png)\n\n![image-20250216183517425](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2676f6ab6d65637f39ecc993f7871c8855933597.png)\n\n![image-20250216183531589](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/702d5e5bee74b229fe7c2488fd86ef9e55933597.png)\n\n![image-20250216183542367](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3cd7cb524ff1be57938473e7f234da9b55933597.png)\n\n![image-20250216183604895](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/02e0d534d0cf2dc9d104c894ff4acf7855933597.png)\n\n![image-20250216183614393](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/045f30f82a5bb4165210d954c0b2265055933597.png)\n\n\n\n\n\n## äºŒå±‚åè®®ä¸“é¢˜\n\n### HDLC\n\n`HDLCé«˜çº§æ•°æ®é“¾è·¯æ§åˆ¶`\n\n![image-20250301171901602](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f11b6d5199ca8ce17ab92744a5f123c455933597.png)\n\n![image-20250301171910761](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d1b4f7510f74c3666bf4e62b68cff0bc55933597.png)\n\nHDLCå¸§ç»“æ„\n\n\n\n`HDLCå¸§æ ¼å¼åŠæ§åˆ¶å­—æ®µ`\n\n![image-20250301171959458](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ce685ee140a2d91ced294418f0807d3855933597.png)\n\n![image-20250301172013862](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ef2d4323b40c11f5d2fb36792d740b3f55933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250301175126312](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e5c24a6f8f72edb6544521696da53b5355933597.png)\n\n![image-20250301175200012](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d0cf227032c3e0ced9e8b9ac7e97737255933597.png)\n\n![image-20250301175545999](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/14ced7d91e7923c6e9208b176c4fe1cf55933597.png)\n\n![image-20250301175612205](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/10e17735c13ef31bf83f78aad2da430455933597.png)\n\n![image-20250301180238134](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/db544abacd26c9a8b70148401e9875c855933597.png)\n\n![image-20250301181014503](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/36d88f3e57edc62c819957ac915b2f2055933597.png)\n\n\n\n![image-20250301181411135](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7030cfa26213dec45c0c0a2eb9e62b3555933597.png)\n\n![image-20250301181429639](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/961d4912e45bbf64f556a9466b8b856155933597.png)\n\n### PPP/L2TP/PPTP\n\n[7.6.1 è™šæ‹Ÿä¸“ç”¨ç½‘åŸºç¡€](#è™šæ‹Ÿä¸“ç”¨ç½‘åŸºç¡€)\n\n### ä»¥å¤ªç½‘å¸§æ ¼å¼\n\n[4.5ä»¥å¤ªç½‘å¸§](#ä»¥å¤ªç½‘å¸§)\n\n### VLANæ‰©å±•æŠ€æœ¯\n\n#### ç«¯å£éš”ç¦»æŠ€æœ¯\n\n![image-20250313215001041](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a0fb499c4fbd567bbae01cfec1499dca697559838.png)\n\n==æŠ€æœ¯èƒŒæ™¯==\n\nvlanèšåˆ\n\n![image-20250301222653912](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/140cfa17c066087293076db1785db04655933597.png)\n\n\n\n==Super-VLAN/Aggregate-vlan==\n\n![image-20250301222846974](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b8e0e588a7b048294ed7cad30688b02255933597.png)\n\n![image-20250301223220111](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ddc006a136d4c1206fe3d33a50f68be855933597.png)\n\n![image-20250301223416905](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/87303b14b4d6e51e62dbf06b82a3dada55933597.png)\n\n\n\n#### QinQ\n\nç”±äºVLANçš„VIDèŒƒå›´æ˜¯[0,4095]\\(2^12^=4096\\),è€ŒQinQæŠ€æœ¯è¦æ‰“ä¸Šä¸¤å±‚VLANæ‰€ä»¥ä»–çš„èŒƒå›´æ˜¯4096*4096ï¼Œ2^24^ä½å¯ä»¥è¡¨ç¤ºå‡º1600ä¸‡ä¸ªç½‘ç»œ\n\n![image-20250301223501690](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b28ec1836ad813c8dae4ec839d9cc1be55933597.png)\n\n==åŸºæœ¬QinQ==\n\nåŸºäºç«¯å£ï¼Œæ¯”å¦‚è¯´ç»è¿‡G0/0/1çš„ç«¯å£çš„æ‰€æœ‰æµé‡æˆ‘éƒ½ç»™ä½ æ‰“ä¸Š100çš„æ ‡ç­¾\n\nç¼ºç‚¹ï¼šæ— æ³•ç»†åŒ–æµé‡ï¼Œå¤ªç®€å•ç²—æš´\n\n![image-20250301223542839](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/af691adb4411458c3c1ce0e8835e47c755933597.png)\n\n==çµæ´»QinQ==\n\nå¯¹ç»è¿‡è¿™ä¸ªç«¯å£çš„æµé‡ï¼Œå‡è®¾ä½ æ˜¯10æ ‡ç­¾çš„æµé‡å°±ç»™æ‰“ä¸Š100çš„æ ‡ç­¾ï¼Œå‡è®¾ä½ æ˜¯20æ ‡ç­¾çš„æµé‡ï¼Œå°±ç»™ä½ æ‰“ä¸Šä¸¤ç™¾çš„æ ‡ç­¾\n\nä¹Ÿå¯ä»¥åŸºäºå¾ˆå¤šæ–¹å¼è¿›è¡Œåˆ†ç±»çœ‹ä¸‹å›¾çº¢è‰²æ³¨é‡Š\n\n![image-20250301223627408](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b992b14d26b4278882cb0c3e3084689b55933597.png)\n\n==QinQåœ¨å›­åŒºç½‘ç»œä¸­çš„åº”ç”¨==\n\n![image-20250301224346192](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/72073a780f17b35b854b5f4daca0b73b55933597.png)\n\n==QinQé…ç½®ä¸¾ä¾‹-åŸºæœ¬QinQ==\n\n![image-20250301224913544](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d4cacf3008a8f1e72a61ad8ea2cbca8e55933597.png)\n\n==QinQé…ç½®ä¸¾ä¾‹-çµæ´»QinQ==\n\n![image-20250301224947807](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1f8b73840be38d2faced06c6510506fa55933597.png)\n\n#### VxLan\n\nä¼ ç»Ÿç½‘ç»œé¢ä¸´çš„é—®é¢˜\n\n![image-20250301225118049](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/50e019996fa6ebe73885cc3e7ee174d655933597.png)\n\n==VxLANæŠ¥æ–‡æ ¼å¼==\n\n![image-20250301225146874](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0078e4a3520fe539e25b26758004312355933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\nVNIç”¨æ¥è¡¨ç¤ºä¸åŒç”¨æˆ·çš„å­—æ®µã€‚2^24^ä½å¯ä»¥è¡¨ç¤ºå‡º1600ä¸‡ä¸ªç½‘ç»œ\n\n![image-20250301225212275](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0686dc8d7b9384fe0f2f3de31637734955933597.png)\n\n-------------------------------------------------------------------------\n\n![image-20250301225232220](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/56419a7a7c477049a3832a2e815a562c55933597.png)\n\n![image-20250301225248641](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7f38ca4689704746a40b138557c5f49b55933597.png)\n\n-------------------------------------------------------------------------\n\n![image-20250301225319737](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4d662dac70571d8c1caa165ff95e543055933597.png)\n\n![image-20250301225338393](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/183386440d94dbb7a50fd80cc98c443955933597.png)\n\n-------------------------------------------------------------------------\n\n![image-20250301225426644](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/88a1430ac0bb74b5a8863874ae7ca47755933597.png)\n\n![image-20250301225436331](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/96c9dabb110eec489f799c4c46ea077f55933597.png)\n\n-------------------------------------------------------------------------\n\n![image-20250301225459287](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/00f09c2f5218a724f7e71fbee2226c5955933597.png)\n\n![image-20250301225537101](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/66e6d7d2a7ad09e9c3ef82ab6efe596655933597.png)\n\n![image-20250301225627202](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bc304ae7c285279e0361af4a1b6b62ec55933597.png)\n\n![image](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/26a96b9abf3a0ae139665096fd3599f455933597.png)\n\n\n\n## ä¸‰å±‚å°è£…åè®®ä¸“é¢˜\n\n### ipv4å’Œipv6\n\n[6.2 IPV4](#ipv4)\n\n[6.3 IPV6](#ipv6)\n\n![image-20250308221102692](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e4b4a92418bcb723d963e7de4443e0ad55933597.png)\n\n![image-20250308221228872](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/84e3b7f9637ded45df54615b497682fb55933597.png)\n\n![image-20250308221245268](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4422fe2fe11207337e56cf3bfb5c715d55933597.png)\n\n[6.2.2 ipåˆ†ç‰‡ä¸è®¡ç®—](#ipåˆ†ç‰‡ä¸è®¡ç®—)\n\n![image-20250308224640115](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/422d32dc5dc50d7c8ee69830e15e2b9e55933597.png)\n\n![image-20250308224922542](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5decabbffa7cbff80d5b3e8176b4858c55933597.png)\n\n[6.2.2 ipåˆ†ç‰‡ä¸è®¡ç®—](#ipåˆ†ç‰‡ä¸è®¡ç®—)\n\n![image-20250308230504021](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/38f61d5d2931bd1476739ad9da92658f55933597.png)\n\n\n\n### ARP\n\n[6.4 ARPä¸RARPåè®®](#ARPä¸RARPåè®®)\n\n#### ARPæ³›æ´ªæ”»å‡»\n\n![image-20250308230952355](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e51abf6af96663dcac088c9e5eee412a55933597.png)\n\n![image-20250308231046464](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/472379261b97f469fe2f4b5c2f0c4afb55933597.png)\n\n![image-20250308231122699](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3cfa51bd99aeb9f9f6e24d774ec4d27f55933597.png)\n\n![image-20250308231144190](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fae9f30d10b92b74b2f05541ed23b83d55933597.png)\n\n#### ARPæ¬ºéª—\n\n![image-20250308231220920](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3cee9caa55d47565284f841914b8236155933597.png)\n\n![image-20250308231255715](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a6ff6216ee6aad5de77d37a17944bfbf55933597.png)\n\n![image-20250308231310934](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/42526683747f152ec5d737589469de5a55933597.png)\n\n![image-20250308231320752](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a1da62c1cb0a71fb92579853d4f4b4c955933597.png)\n\n![image-20250308231330464](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5495c020e5026953abd6d3125e2d670555933597.png)\n\n![image-20250308231341913](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d1040154ff09aead59821dc27b4f45ec55933597.png)\n\n\n\n## ä¼ è¾“å±‚å°è£…åè®®TCPå’ŒUDP\n\n[5.7 TCPå’ŒUDPåè®®](#TCPå’ŒUDPåè®®)\n\n![image-20250314164523319](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d6ebd4228b8629123c840ce20e5207f5697559838.png)\n\n![image-20250314164535275](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7e0d0de5a381448b6b8c13324ab33172697559838.png)\n\n![image-20250314164549035](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a66d023d957f08180b256c77c0903100697559838.png)\n\n\n\n![image-20250314164640258](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/19d8966f8cccb06c7468991387bb8bc5697559838.png)\n\n![image-20250314164654096](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d9b68f6300495c3979bc802a76ea6717697559838.png)\n\n![image-20250314164707228](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/212294e07742c544ea1a8a361e88ae9c697559838.png)\n\n## è·¯ç”±åè®®åŸºç¡€RIP OSPF BGP ISIS \n\n[5.8 è·¯ç”±åè®®](#è·¯ç”±åè®®)\n\n![image-20250321154647205](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250321154647205.png)\n\n![image-20250321154844044](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250321154844044.png)\n\n![image-20250321154922515](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250321154922515.png)\n\n\n\n##  è·¯ç”±ç»¼åˆé…ç½®ä¸“é¢˜\n\n### å›­åŒºè·¯ç”±è§„åˆ’\n\n![image-20250328163413057](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328163413057.png)\n\n![image-20250328164302152](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328164302152.png)\n\n![image-20250328164309969](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328164309969.png)\n\n![image-20250328164326882](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328164326882.png)\n\n![image-20250328165633739](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328165633739.png)\n\n![image-20250328165643427](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328165643427.png)\n\n### åŠ¨æ€è·¯ç”±é…ç½®\n\n![image-20250328165702573](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328165702573.png)\n\n![image-20250328165726466](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328165726466.png)\n\n![image-20250328165851303](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328165851303.png)\n\n![image-20250328165901848](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328165901848.png)\n\n![image-20250328170453273](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328170453273.png)\n\n![image-20250328170502595](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328170502595.png)\n\n![image-20250328170940153](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328170940153.png)\n\n![image-20250328171002952](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328171002952.png)\n\n### è·¯ç”±å¼•å…¥å’Œè·¯ç”±ç­–ç•¥\n\n![image-20250328171023683](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328171023683.png)\n\n![image-20250328171033505](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328171033505.png)\n\n![image-20250328171046246](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328171046246.png)\n\n![image-20250328171053877](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328171053877.png)\n\n![image-20250328171100389](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250328171100389.png)\n\n## åº”ç”¨å±‚åè®®DHCP SNMP DNS\n\n[5.7.4 é‡ç‚¹åè®®ç«¯å£å·æ€»ç»“](#é‡ç‚¹åè®®ç«¯å£å·æ€»ç»“)\n\n### dhcp\n\n[7.8 DHCP](#DHCP)\n\n![image-20250407200519952](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250407200519952.png)\n\n![image-20250407200532586](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250407200532586.png)\n\n![image-20250407200546755](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250407200546755.png)\n\n![image-20250407200616109](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250407200616109.png)\n\n![image-20250407200631461](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250407200631461.png)\n\n![image-20250407200650097](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250407200650097.png)\n\n![image-20250407200702711](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/image-20250407200702711.png)\n\n### snmp\n\n[9.2 SNMP](#SNMP)\n\n### DNS\n\n[7.4 DNS](#DNS)\n\n\n\n## ipå­ç½‘åˆ’åˆ†ä¸“é¢˜\n\n[5.11 å­ç½‘åˆ’åˆ†ä¸“é¢˜VLSM  CIDR](#å­ç½‘åˆ’åˆ†ä¸“é¢˜VLSM  CIDR)\n\n\n\n\n\n## è®¡ç®—ä¸“é¢˜çªç ´\n\nè¡¥å……çŸ¥è¯†çš„è¿›åˆ¶è½¬æ¢\n\nè¡¥å……çŸ¥è¯†çš„å†…å­˜æ•°é‡è®¡ç®—\n\n[3.3 äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•](#äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•)\n\n[2.1.4 å¥ˆå¥æ–¯ç‰¹å®šç†](#å¥ˆå¥æ–¯ç‰¹å®šç†)\n\n[2.1.5 é¦™å†œå®šç†](#é¦™å†œå®šç†)\n\n[2.6 PCM](#è„‰å†²ç¼–ç è°ƒåˆ¶PCM)\n\n[2.4 æ•°æ®ç¼–ç ](#æ•°æ®ç¼–ç )\n\n[2.2 ä¿¡é“å»¶è¿Ÿ](#ä¿¡é“å»¶è¿Ÿ)\n\n[2.10 CRCå¾ªç¯å†—ä½™æ ¡éªŒç ](#CRCå¾ªç¯å†—ä½™æ ¡éªŒç )\n\n\n\n\n\n## è®¡ç®—æœºç»„æˆåŸç†\n\n### è¿›åˆ¶è½¬æ¢\n\n**åè¿›åˆ¶**ï¼š\n\n- åè¿›åˆ¶æ˜¯Decimalï¼Œç®€å†™ä¸ºD\n- ä»¥ `0b` æˆ– `0B` ä½œä¸ºå‰ç¼€\n- éƒ½æ˜¯ä»¥0-9è¿™ä¹ä¸ªæ•°å­—ç»„æˆã€‚\n- å¦‚:12,34,345ç­‰æ•°å­—\n\n**äºŒè¿›åˆ¶**ï¼š\n\n- äºŒè¿›åˆ¶æ˜¯Binaryï¼Œç®€å†™ä¸ºB\n- ç”±0å’Œ1ä¸¤ä¸ªæ•°å­—ç»„æˆã€‚\n- 10001ç­‰\n- äºŒè¿›åˆ¶æƒè¡¨å±•å¼€å¦‚ä¸‹\n\n| 2^7^ | 2^6^ | 2^5^ | 2^4^ | 2^3^ | 2^2^ | 2^1^ | 2^0^ |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n| 128  |  64  |  32  |  16  |  8   |  4   |  2   |  1   |\n\n**å…«è¿›åˆ¶**ï¼š\n\n- å…«è¿›åˆ¶æ˜¯Octalï¼Œç®€å†™ä¸ºO\n- ç”±0-7æ•°å­—ç»„æˆï¼Œä¸ºäº†åŒºåˆ†ä¸å…¶ä»–è¿›åˆ¶çš„æ•°å­—åŒºåˆ«ï¼Œ<font color='red'>å¼€å¤´éƒ½æ˜¯ä»¥0å¼€å§‹</font>ã€‚\n- å¦‚å…«è¿›åˆ¶0127\n\n**åå…­è¿›åˆ¶**ï¼š\n\n- åå…­è¿›åˆ¶ä¸ºHexadecimalï¼Œç®€å†™ä¸ºH\n- <font color='red'>è¡¨ç¤ºæ–¹å¼ä¸º0xæˆ–0Xå¼€å¤´</font>\n- è®¡æ•°åˆ°Fåï¼Œå†å¢åŠ 1ä¸ªï¼Œå°±è¿›ä½ã€‚\n- ç”±0-9å’ŒA-Fç»„æˆï¼Œè‹±æ–‡å­—æ¯Aï¼ŒBï¼ŒCï¼ŒDï¼ŒEï¼ŒFåˆ†åˆ«è¡¨ç¤ºæ•°å­—10ï½15ã€‚\n- å¦‚åå…­è¿›åˆ¶0xA87\n\n|  1   |  2   |  3   |  4   |  5   |  6   |  7   |  8   |  9   |  A   |  B   |  C   |  D   |  E   |  F   |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  1   |  2   |  3   |  4   |  5   |  6   |  7   |  8   |  9   |  10  |  11  |  12  |  13  |  14  |  15  |\n\n#### æ•´æ•°è½¬æ¢\n\n##### åè¿›åˆ¶è½¬äºŒè¿›åˆ¶\n\n1. `åè¿›åˆ¶è½¬äºŒè¿›åˆ¶`çš„åŸç†ï¼šåè¿›åˆ¶æ•°é™¤ä»¥2ï¼Œä½™æ•°ä¸ºæƒä½ä¸Šçš„æ•°ï¼Œå¾—åˆ°å•†ç»§ç»­é™¤ä»¥2ï¼Œç›´åˆ°å•†ä¸º0ç»ˆæ­¢ï¼Œç„¶å`åå‘`å–ä½™æ•°ã€‚\n\nä¾‹å¦‚ï¼š(87)~10~è½¬ï¼ˆ1010111ï¼‰~2~\n\n> ![image-20241207144402642](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a7743ab6eb3a1bca4703f26b5c97f339697559838.png)\n\n2. `åè¿›åˆ¶è½¬å…«`ã€`åå…­è¿›åˆ¶`çš„åŸç†ï¼šè·Ÿåè½¬äºŒåŸç†ä¸€æ ·ï¼Œåè¿›åˆ¶æ•°é™¤ä»¥`8`æˆ–`16`ï¼Œä½™æ•°ä¸ºæƒä½ä¸Šçš„æ•°ï¼Œå¾—åˆ°å•†ç»§ç»­é™¤ä»¥`8`æˆ–`16`ï¼Œç›´åˆ°å•†ä¸º0ç»ˆæ­¢ï¼Œç„¶ååå‘å–ä½™æ•°ã€‚\n\nä¾‹å¦‚ï¼š(763)~10~è½¬ï¼ˆ1373ï¼‰~8~æˆ–(2FB)~16~\n\n> ![image-20241207144414396](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4097607368734d0c601a66e7f7969d73697559838.png)\n\n##### äºŒè¿›åˆ¶è½¬æ¢åè¿›åˆ¶\n\næ–¹æ³•ï¼šæŠŠäºŒè¿›åˆ¶æ•°æŒ‰æƒå±•å¼€ã€ç›¸åŠ å³å¾—åè¿›åˆ¶æ•°ã€‚ \n\nå¦‚ï¼ˆ1001ï¼‰~2~è½¬ï¼ˆ9ï¼‰~10~\n\n1001ä»å³å¾€å·¦è¡¨ç¤ºå¦‚ä¸‹\n\n|  1   |  0   |  0   |  1   |\n| :--: | :--: | :--: | :--: |\n| 2^3^ | 2^2^ | 2^1^ | 2^0^ |\n|  8   |  4   |  2   |  1   |\n\nä¹Ÿå°±æ˜¯  1\\*2^3^+0\\*2^2^+0\\*2^1^\\+1\\*2^0^=9\n\nå¦‚(17)~8~è½¬(15)~10~  å±•å¼€2\\*8^1^+7\\*8^0^=15\n\nå¦‚(1AB)~16~è½¬(427)~10~  Aå¯¹åº”10ï¼ŒBå¯¹åº”11  å±•å¼€å¼ 1\\*16^2^+A\\*16^1^+B\\*16^0^=16\\*16+10\\*16+11*1=427\n\n##### äºŒè¿›åˆ¶è½¬å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶\n\nå¦‚(10101110)~2~è½¬(256)~8~\n\n![image-20241110211812140](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fa31747f9e7532d3a28ce4bf4222d435697559838.png)\n\nå¦‚(1110101110)~2~è½¬(256)~16~\n\n![image-20241110212859073](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bd6607c723c286d2eac4259d76af9657697559838.png)\n\nå…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶è¦è½¬äºŒè¿›åˆ¶å€’æ¨å³å¯\n\n#### å°æ•°è½¬æ¢\n\n##### åè¿›åˆ¶è½¬äºŒè¿›åˆ¶\n\næ–¹æ³•ï¼šåè¿›åˆ¶å°æ•°è½¬æ¢æˆäºŒè¿›åˆ¶å°æ•°é‡‡ç”¨â€œä¹˜2å–æ•´ï¼Œé¡ºåºè¾“å‡ºâ€\n\nï¼ˆ0.125ï¼‰~10~è½¬(0.001ï¼‰~2~\n\n0.125\\*2=0.25  å–0   å‘\n\n0.25\\*2=0.5    å–0   ä¸‹\n\n0.5*2=1       å–1   å–\n\nä¹Ÿå°±æ˜¯ï¼ˆ0.001ï¼‰~2~\n\n##### äºŒè¿›åˆ¶è½¬åè¿›åˆ¶\n\n(0.001ï¼‰~2~è½¬ï¼ˆ0.125ï¼‰~10~\n\n0\\*($\\frac{1}{2}$â€‹)      å³ä¹˜ä»¥2çš„è´Ÿä¸€æ¬¡æ–¹\n\n0\\*($\\frac{1}{4}$)      å³ä¹˜ä»¥2çš„è´ŸäºŒæ¬¡æ–¹\n\n1\\*($\\frac{1}{8}$)      å³ä¹˜ä»¥2çš„è´Ÿä¸‰æ¬¡æ–¹\n\n($\\frac{1}{2}$)+($\\frac{1}{4}$)+($\\frac{1}{8}$)=0.125\n\n##### äºŒè¿›åˆ¶è½¬æ¢æˆåå…­è¿›åˆ¶\n\n(0.101ï¼‰~2~è½¬ï¼ˆ0.125ï¼‰~16~\n\n0.101  è¡¥4åˆ1  å°æ•°éƒ¨åˆ†ä»å·¦å¾€å³è¡¥4ä½ï¼Œç¼ºçš„è¡¥0\n\n0.1010   ç„¶åä»å³å¾€å·¦è¡¥ï¼ˆåå…­è¿›åˆ¶1248ç§˜è¯€ï¼‰\n\n  8421   ç›¸åŠ å¾—10ä¸”å¯¹åº”çš„æ˜¯A\n\næœ€åç»“æœæ˜¯(0.A)~16~\n\n#### è¿›åˆ¶è½¬æ¢åº”ç”¨\n\n![image-20250309181023219](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b8276ae0b7322a6669c6487b45dd55c355933597.png)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250309181115643](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f2a8970aa4522098a1fd227747af2e2055933597.png)\n\n\n\n### å¸¦å®½ä¸å­˜å‚¨è®¡ç®—\n\n`ä½(bit)`:ç½‘ç»œæ•°æ®ä¼ è¾“çš„æœ€å°å•ä½ã€‚\n`å­—èŠ‚(byte)`:ç”±8ä¸ªbitç»„æˆï¼Œå­˜å‚¨ç©ºé—´çš„æœ€å°å•ä½ã€‚`1byte=1B=8bit=8b`\n\n\n\næ—¶é—´é¢†åŸŸï¼š1s = 10^3^ms = 10^6^us = 10^9^ns\n\nå­˜å‚¨é¢†åŸŸï¼š1K=1024,å³1KB=1024B,1MB=1024`K`B=1024 âœ• `1024`B=2^10^ âœ• 2^10^B=2^20^B\n\nç½‘ç»œé¢†åŸŸï¼š1k=1000,å³1kb/s=1000b/s,1Mb/s=1000kb/s=10^6^b/s\n\nâ€‹         1Gb = 10^3^Mb = 10^6^kb = 10^9^b\n\nå…¶ä»–å•ä½:1G=1024Mï¼Œ1T=1024Gï¼Œ1P=1024T(å­˜å‚¨å•ä½æ˜¯Bå­—èŠ‚)\n\n\n\nä¾‹é¢˜ï¼š\n\n![image-20250309190015939](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/21c5163f53033234d9cbc701764586f755933597.png)\n\n![image-20250309210604785](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7d70a10421ad74cef0a5c0b476f4752755933597.png)\n\n![image-20250309212729716](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/39049b0de2524eeff21596c50f716bad55933597.png)\n\n![image-20250309192025914](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/8ffa69bd7eb9b3b4619faf2f9053f8e655933597.png)\n\n### è®¡ç®—æœºç¡¬ä»¶æ¶æ„\n\n  è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿæ˜¯å†¯è¯ºä¾æ›¼è®¾è®¡çš„ä½“ç³»ç»“æ„ï¼Œç”±`è¿ç®—å™¨`ã€`æ§åˆ¶å™¨`ã€`å­˜å‚¨å™¨`ã€`è¾“å…¥/è¾“å‡ºè®¾å¤‡(I/O)`äº”å¤§éƒ¨ä»¶ç»„æˆ,è¿ç®—å™¨å’Œæ§åˆ¶å™¨ç»„æˆä¸­å¤®å¤„ç†å™¨(CPU)\n\n![image-20250310195958625](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bd411045032cf5139277124375723c0155933597.png)\n\n![image-20250310201849764](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cf6c5142d1555580adede47683b12f5255933597.png)\n\n![image-20250310203106112](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a6aab7a6e7820ef03f1c29013e1f5c6455933597.png)\n\n![image-20250310203128006](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9bcae3b69f6ac2ba0bfbda413468366f55933597.png)\n\n![image-20250310203234656](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/97583496d7b621dfc4ca3ad5eb30c26755933597.png)\n\n![image-20250310203248782](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/588ac6167c82591fc5969bd1133a809355933597.png)\n\n### æŒ‡ä»¤é›†RISCå’ŒCISC\n\n![image-20250310203852002](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bdaa98a3acc3db71d3ad842b03adb18d55933597.png)\n\n\n\n![image-20250310203959076](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/714a05cc1b8c61d951ee999df484cae055933597.png)\n\n![image-20250310204142546](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d57089961673eac241ef9f469949b3e955933597.png)\n\n![image-20250310204327741](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2c26f6422c7038460d529d7659b573bd55933597.png)\n\n### å­˜å‚¨åˆ†ç±»ä¸åº”ç”¨\n\nå­˜å‚¨å™¨åˆ†ç±»\n\nè®¡ç®—æœºå­˜å‚¨å™¨åˆ†ä¸º:`å¯„å­˜å™¨`ã€`Cache(é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨)`ã€`ä¸»å­˜å‚¨å™¨(å†…å­˜)`ã€`è¾…åŠ©å­˜å‚¨å™¨( ç¡¬ç›˜)`ã€‚\n\nä»ä¸‹å¾€ä¸Šï¼Œé€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œå®¹é‡è¶Šæ¥è¶Šå°ï¼Œæˆæœ¬è¶Šæ¥è¶Šé«˜,\n![image-20250310225543539](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/006c94ebe6865a75f8363d959d4b46e2697559838.png)\n\n![image-20250310230507271](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/537762343a33a39da4f1b6bde0d66b9e697559838.png)\n\n![image-20250310230443891](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1f215610962a9b80570410f80667facc697559838.png)\n\n![image-20250310225852036](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/07a8399c5b3ae370e89b41fb85c95525697559838.png)\n\n![image-20250310225912097](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2917725a2337dcd7d35fd8e6efb1224d697559838.png)\n\n![image-20250310225927751](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7e37e462ae461d43abda57e1a1800eb8697559838.png)\n\n![image-20250310225950446](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d8b11fe871b2364ee2a59559b01db949697559838.png)\n\n![image-20250310230007955](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/53079feb9f57ed06b0e2453b457f24b2697559838.png)\n\n![image-20250310230027468](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b8c79a9a038f125aa7847b5ff44acd2e697559838.png)\n\n![image-20250310230049723](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/65523b4652101f747bff75a42ce4f733697559838.png)\n\n![`](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/68e9738546550290b1dfb99a5774b9d3697559838.png)\n\n### å­˜å‚¨èŠ¯ç‰‡æ•°é‡è®¡ç®—\n\nå†…å­˜èŠ¯ç‰‡æ•°é‡è®¡ç®—\n\n![image-20250311105317750](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/db110996c0cd806c4b8e2a2c5204402a697559838.png)\n\n![image-20250311105337444](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e794db1ea7e461c429d166a80497bade697559838.png)\n\n![image-20250311105350115](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a58ccb50c4c960fec69352db74a50b40697559838.png)\n\n![image-20250311105406993](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cfff36f38d255056c458d9b4f8b41d8a697559838.png)\n\n### è¾“å…¥è¾“å‡ºI/O\n\n![image-20250311105615965](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fb73a1ebebe8bcff2113d20d384cc43c697559838.png)\n\n![image-20250311105633147](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/31406775772f3d8614a1b35967ec6b04697559838.png)\n\n![image-20250311105646104](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c5a323962d82cb22ae5b5968af935e04697559838.png)\n\n![image-20250311105700745](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/94f8546fb846775f28c731fe88408080697559838.png)\n\n![image-20250311105717408](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ea5a107bd2c6538d8c285a20bfccbd6f697559838.png)\n\n![image-20250311105735303](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/2b0597fa3f1df999ce1b7b928c4f1087697559838.png)\n\n### åŸç ï¼Œåç å’Œè¡¥ç \n\nè®¡ç®—æœºåªè¯†åˆ«å’Œå¤„ç†äºŒè¿›åˆ¶ï¼Œè€Œå¯¹äºæ•°æ®åˆåˆ†ä¸º`æœ‰ç¬¦å·æ•°æ®`å’Œ`æ— ç¬¦å·æ•°æ®`\n\næœ‰ç¬¦å·æ•°æ®æ˜¯æŒ‡æœ‰æ­£è´Ÿä¹‹åˆ†çš„æ•°æ®(å¦‚-10æˆ–+8)ï¼Œæ— ç¬¦å·æ•°æ®æ˜¯æ²¡æœ‰æ­£è´Ÿä¹‹åˆ†çš„ï¼Œå¦‚ASCIå­—ç¬¦ã€‚\nè€ŒåŸç ï¼Œåç ï¼Œè¡¥ç æ˜¯è®¡ç®—æœºå­˜å‚¨`æœ‰ç¬¦å·æ•°æ®`çš„ç¼–ç æ–¹å¼ã€‚\nåœ¨è®¡ç®—æœºä¸­ç”¨ä¸€ä¸ªæ•°çš„`æœ€é«˜ä½è¡¨ç¤ºç¬¦å·ä½`ï¼Œæ­£æ•°ä¸º0ï¼Œè´Ÿæ•°ä¸º1ã€‚\n\n|      | æ­£æ•°              | è´Ÿæ•°                                            |\n| ---- | ----------------- | ----------------------------------------------- |\n| åŸç  | æœ€é«˜ä½æ·»åŠ ç¬¦å·ä½0 | æœ€é«˜ä½æ·»åŠ ç¬¦å·ä½1                               |\n| åç  | æœ€é«˜ä½æ·»åŠ ç¬¦å·ä½0 | ä¿æŒå…¶åŸç ç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™æ•°å€¼æŒ‰ä½å–å          |\n| è¡¥ç  | æœ€é«˜ä½æ·»åŠ ç¬¦å·ä½0 | å…ˆä¿æŒå™¨åŸç ç¬¦å·ä½ä¸å˜ï¼Œæ•°å€¼æŒ‰ä½å–åï¼Œç„¶åå†åŠ 1 |\n\n ä¸€èˆ¬å…«ä½äºŒè¿›åˆ¶æ•°\n\n|      | æ­£æ•°     | æ•°å€¼ | è´Ÿæ•°                                                       | æ•°å€¼ |\n| ---- | -------- | ---- | ---------------------------------------------------------- | ---- |\n| åŸç  | 00001001 | 9    | <font color='red'>1</font>0001001                          | -9   |\n| åç  | 00001001 | 9    | <font color='red'>1</font>1110110                          | -9   |\n| è¡¥ç  | 00001001 | 9    | <font color='red'>1</font>111011<font color='red'>1</font> | -9   |\n\nè‹¥æŸè¯ä¹¦çš„16ä½è¡¥ç ä¸ºFFFFHï¼ˆHè¡¨ç¤ºåå…­è¿›åˆ¶ï¼‰ï¼Œåˆ™è¯¥æ•°çš„åè¿›åˆ¶çš„å€¼ä½ï¼ˆï¼‰\n\n  F    F     F     F\n\nå±•å¼€è¡¥ç å¦‚ä¸‹\n\n1111  1111  1111  1111\n\nç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™æŒ‰ä½å–å\n\n1000  0000  0000  0000\n\næœ€åä¸€ä½åŠ ä¸€\n\n1000  0000  0000  0001\n\nç»“è®ºï¼šå¯¹äºè´Ÿæ•°æ¥è¯´ï¼š<font color='red'>è¡¥ç æ±‚åŸç </font>å°±æ˜¯è¡¥ç æŒ‰ä½å–åç„¶åæœ€åä¸€ä½åŠ 1\n\n### é€»è¾‘è¿ç®—\n\né€»è¾‘è¿ç®—åªæœ‰ä¸¤ä¸ªå¸ƒå°”å€¼ï¼š\n\n- `0` ï¼Œè¡¨ç¤ºå‡å€¼ï¼ˆFalseï¼‰ã€‚\n- `1` ï¼Œè¡¨ç¤ºçœŸå€¼ï¼ˆTrueï¼‰ã€‚\n\n| é€»è¾‘è¿ç®— |               è¿ç®—è§„åˆ™               |  å¸¸è§è¿ç®—ç¬¦   |\n| :------: | :----------------------------------: | :-----------: |\n|    ä¸    | æœ‰ 0 ä¸º 0ï¼Œå…¨ 1 ä¸º 1ï¼ˆæœ‰ä¸€ä¸ªå‡å…¨å‡ï¼‰ | \"Ã—\"ã€\"Â·\"ã€\"âˆ§\" |\n|    æˆ–    | æœ‰ 1 ä¸º 1ï¼Œå…¨ 0 ä¸º 0ï¼ˆæœ‰ä¸€ä¸ªçœŸå…¨çœŸï¼‰ |   \"ï¼‹\"ã€\"âˆ¨\"   |\n|    é    |   1 ä¸º 0ï¼Œ0 ä¸º 1ï¼ˆéé»‘å³ç™½ï¼Œç›¸åï¼‰   | \"Â¬\"ã€\"!\"ã€\"â€”\" |\n|   åŒæˆ–   |          ç›¸åŒä¸º 1ï¼Œä¸åŒä¸º 0          |      \"âŠ™\"      |\n|   å¼‚æˆ–   |          ä¸åŒä¸º 1ï¼Œç›¸åŒä¸º 0          |      \"âŠ•\"      |\n\n![image-20241110232015128](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4142f5c899165b35a7ffacc0c66fd3d2697559838.png)\n\n\n\nä¾‹é¢˜ï¼šX,Yéƒ½æ˜¯é€»è¾‘å˜é‡ï¼Œä¸é€»è¾‘è¡¨è¾¾å¼X+!XYç­‰ä»·çš„æ˜¯ï¼ˆDï¼‰\n\nA.X+!Y   B.!X+!Y  C.!XX+Y  D.X+Y\n\nè§£ï¼šå¯ä»¥å‡è®¾x=0,y=0,ä»¥åŠx=1,y=1ç­‰å¦‚ä¸‹\n\n|         | x=0,y=0                    | x=0,y=1                    | x=1,y=0                    | x=1,y=1                    |\n| ------- | -------------------------- | -------------------------- | -------------------------- | -------------------------- |\n| X+!XY   | 0+1\\*0=0                   | 1                          | 1                          | 1                          |\n| A.X+!Y  | 1                          | 0                          | 1                          | 1                          |\n| B.!X+!Y | 1                          | 1                          | 1                          | 0                          |\n| C.!XX+Y | 1                          | 1                          | 0                          | 1                          |\n| D.X+Y   | <font color='red'>0</font> | <font color='red'>1</font> | <font color='red'>1</font> | <font color='red'>1</font> |\n\n## æ“ä½œç³»ç»Ÿ\n\n### æ“ä½œç³»ç»ŸåŸºç¡€\n\næ“ä½œç³»ç»Ÿ5å¤§åŠŸèƒ½`è¿›ç¨‹ç®¡ç†`ã€`å­˜å‚¨ç®¡ç†`ã€`æ–‡ä»¶ç®¡ç†`ã€`è®¾å¤‡ç®¡ç†`ã€`ä½œä¸šç®¡ç†`ã€‚\nPCå’ŒæœåŠ¡å™¨ç«¯æ“ä½œç³»ç»Ÿåˆ†ç±»:`Windowsã€Unixã€Linux`(å¼€æº)\nå›½äº§æ“ä½œç³»ç»Ÿ:`UOSã€éº’éºŸã€ä¸­ç§‘æ–¹å¾·ã€æ·±åº¦ã€çº¢æ——ã€‚`ã€éƒ½æ˜¯åŸºäºLinuxå¼€å‘)ã€‘\nç§»åŠ¨æ“ä½œç³»ç»Ÿ:IOS(è‹¹æœ)ã€`å®‰å“(Android)å’Œé¸¿è’™(HarmonyOs)`\n\n![image-20250311155456574](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/aef3e454527d8fe20ca10e1f4ceac8d4697559838.png)\n\n![image-20250311155616342](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/676bf22573c366b79147689b21938b7a697559838.png)\n\n![image-20250311155723701](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cffb02e33615c9c1eb473f473dcdb14a697559838.png)\n\n![image-20250311155824336](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d0eb11557683a4c5702e9757c81b7c47697559838.png)\n\n![image-20250311155847319](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d7417078f8613e894c4c29e99314a979697559838.png)\n\n### è¿›ç¨‹å’Œçº¿ç¨‹\n\n![image-20250311160353617](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/870ee5985a631f20a9dae70c2908b24d697559838.png)\n\nåŒºåˆ«æ€»ç»“\n\n![image-20250311160437708](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/518d767dbf94880110010d6cc8c67051697559838.png)\n\nå›¾ç±»å¯¹æ¯”\n\n![image-20250311160455987](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/50a57ca7940e5ee97028722dc794ff5c697559838.png)\n\n![image-20250311160508964](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/edf601489f969c12d30a165707a7107e697559838.png)\n\n\n\n![image-20250311160533320](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c340d72dc00fcd1f95a5c1608faad639697559838.png)\n\n![image-20250311160637178](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/991a40955ee2f4eaa1b14a6b043798e1697559838.png)\n\n![image-20250311160657264](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5eba9d9105467f0adb4a63111027cf9c697559838.png)\n\n### èµ„æºäº’æ–¥\n\nè¿›ç¨‹æ­»é”\n\n![image-20250311170804085](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/57f8a311c5f91b212b061c21b0dfe587697559838.png)\n\n![image-20250311171344209](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/f6d571bd4f1996643b8b34c21e50827f697559838.png)\n\n### ä½ç¤ºå›¾è®¡ç®—\n\n|  ç®¡ç†æ–¹æ³•  |                        è¯´æ˜                        |                          ç‰¹ç‚¹                          |\n| :--------: | :------------------------------------------------: | :----------------------------------------------------: |\n| **ä½å›¾æ³•** | ç”¨ä¸€ä¸ªå‘é‡æè¿°æ•´ä¸ªç£ç›˜ï¼Œæ¯ä¸€ä½è¡¨ç¤ºä¸€ä¸ªç‰©ç†å—çš„çŠ¶æ€ | æ˜“äºå¯»æ‰¾ç©ºé—²å—ï¼Œé€‚åˆå„ç§æ–‡ä»¶åˆ†é…æ³•ï¼Œæœ¬èº«å°ï¼Œå¯æ”¾äºä¸»å­˜ |\n| **é“¾æ¥æ³•** |              ä½¿ç”¨é“¾è¡¨å°†ç©ºé—²å—ç»„ç»‡èµ·æ¥              |                   é€‚åˆå„ç§æ–‡ä»¶åˆ†é…æ³•                   |\n| **ç´¢å¼•æ³•** |        å°†ç©ºé—²å—ä½œä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶é‡‡ç”¨ç´¢å¼•æŠ€æœ¯        |                   é€‚åˆå„ç§æ–‡ä»¶åˆ†é…æ³•                   |\n\nä½ç¤ºå›¾\n\n|      | 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   | 15   |\n| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |\n| 0    | 1    | 1    | 0    | 0    | 0    | 1    | 1    | 1    | 0    | 1    | 0    | 1    | 1    | 1    | 1    | 0    |\n| 1    | 0    | 0    | 0    | 1    | 1    | 1    | 1    | 1    | 1    | 0    | 0    | 0    | 0    | 1    | 1    | 1    |\n| 2    | 1    | 1    | 1    | 1    | 0    | 0    | 0    | 1    | 1    | 1    | 1    | 1    | 0    | 0    | 0    | 0    |\n| 3    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |\n| â€¦    |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |\n| 15   |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |\n\næˆ‘ä»¬çš„ç£ç›˜ç©ºé—´éƒ½åˆ’åˆ†äº†å¾ˆå¤šä¸ªå—ï¼Œæ¯ä¸ªå—éƒ½æœ‰ä¸€ä¸ªæ ‡è¯†ï¼Œè¦ä¹ˆä¸º`0`è¦ä¹ˆä¸º`1`ï¼Œè‹¥ä¸º1åˆ™è¡¨ç¤ºå·²ç»è¢«ä½¿ç”¨ï¼Œåä¹‹æœªä½¿ç”¨\n\n![image-20250311172800371](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/eac256d5233200ed0c118da101edaedf697559838.png)\n\n![image-20250311172813833](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/963bccd0a3cfbabe786e654a893f4b84697559838.png)\n\n![image-20250311172828921](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/34a8304f0e23076320cd22736ad92097697559838.png)\n\n### å†…å­˜é¡µé¢è½¬æ¢\n\n![image-20250311172901948](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fb3852b00cebbab899917d0e5a81c932697559838.png)\n\n![image-20250311172912471](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/09ac1cdc8fe12414da925f2ca1ea1a48697559838.png)\n\n---\n\n![image-20250311173011501](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/deb5b38385a075e7e57b31ebb58fad56697559838.png)\n\n### æ–‡ä»¶ç›®å½•\n\nWindows `C:`\\windows\\system32\\test.txt ä»¥æŸä¸ªç›˜ç¬¦ä¸ºæ ¹ã€‚\n\nLinux: `/`etc/test.txt åªæœ‰ä¸€ä¸ªæ ¹ç›®å½•ã€‚\n\nç»å¯¹è·¯å¾„:å®Œæ•´è®¿é—®è·¯å¾„ã€‚\n\nç›¸å¯¹è·¯å¾„:ä»å½“ä»Šè·¯å¾„å‡ºå‘çš„è®¿é—®è·¯å¾„ï¼Œè°ƒç”¨é€Ÿåº¦å¿«ã€‚\n\n\n\n![image-20250311202438546](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/79551cadb5c70f0800a77c5bfa53d7c6697559838.png)\n\n![image-20250311202501637](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ad5d4c4dd2f2795adf3668786932576b697559838.png)\n\n## è½¯ä»¶å·¥ç¨‹\n\n### è½¯ä»¶å·¥ç¨‹åŸºç¡€\n\nè½¯ä»¶å±æœº:éšç€è½¯ä»¶å¤æ‚åº¦æå‡ï¼Œå¼€å‘æˆæœ¬ã€è½¯ä»¶è´¨é‡ã€ç”Ÿäº§æ•ˆç‡ç­‰é—®é¢˜ã€‚\n\nè½¯ä»¶å·¥ç¨‹:ä¸ºäº†æ¶ˆé™¤è½¯ä»¶å±æœºï¼Œä»¥`å·¥ç¨‹å­¦æ€è·¯`è¿›è¡Œè½¯ä»¶å¼€å‘ï¼Œå³è½¯ä»¶å·¥ç¨‹ã€‚\n\nè½¯ä»¶å·¥ç¨‹ä¸‰ä¸ªè¦ç´ ï¼š\n\næ–¹æ³•:å®Œæˆè½¯ä»¶å·¥ç¨‹é¡¹ç›®çš„æŠ€æœ¯æ‰‹æ®µã€‚\n\nå·¥å…·:æ”¯æŒè½¯ä»¶çš„å¼€å‘ã€ç®¡ç†ã€æ–‡æ¡£ç”Ÿæˆã€‚\n\nè¿‡ç¨‹:æ”¯æŒè½¯ä»¶å¼€å‘çš„å„ä¸ªç¯èŠ‚æ§åˆ¶ã€ç®¡ç†ã€‚\n\n---\n\n`ä¿¡æ¯ç³»ç»Ÿç”Ÿå‘½å‘¨æœŸæ¨¡å‹`\n\n![image-20250311203051644](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d3e23fa4c371c5238b21cbd24941bd4d697559838.png)\n\n---\n\n`è½¯ä»¶ç”Ÿå‘½å‘¨æœŸ`\n\n![image-20250311203119777](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/36ec1b9becf7da2b1a460bec2c776361697559838.png)\n\n\n\n![image-20250311203626663](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d2a951683065c4ed4a93fd6d67fd9294697559838.png)\n\n![image-20250311203747361](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/5f6b35839248ac0ab7f98502df31ce03697559838.png)\n\n### è½¯ä»¶å¼€å‘æ¨¡å‹\n\nå…¸å‹çš„è½¯ä»¶ç”Ÿå‘½å‘¨æœŸæ¨¡å‹\nÂ·1.ç€‘å¸ƒæ¨¡å‹\nÂ·2.èºæ—‹æ¨¡å‹\nÂ·3.è¿­ä»£æ¨¡å‹\nÂ·4.Væ¨¡å‹\nÂ·5.åŸå‹åŒ–æ¨¡å‹\nÂ·6.æ•æ·æ–¹æ³•\n\n#### ç€‘å¸ƒæ¨¡å‹\n\n![image-20250311212440137](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/619eb13ebe06110a0577b910a7d8a62d697559838.png)\n\nç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç¼ºç‚¹\n\n![image-20250311212510305](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/fddb4cfe6057a09b498755a5bc3667db697559838.png)\n\n![image-20250311212528300](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/18948fa356f86285ac39cf33cf9bc447697559838.png)\n\n#### èºæ—‹æ¨¡å‹\n\n![image-20250311212614263](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/674080d9586ce812d85c251cde00e44f697559838.png)\n\n![image-20250311212633004](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/17ef17f0822a3f6e2f9e00a90fde1a60697559838.png)\n\n#### è¿­ä»£æ¨¡å‹\n\n![image-20250311212700964](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/19097d3e12353e741358ccc1af190921697559838.png)\n\n#### å¢é‡æ¨¡å‹\n\n![image-20250311212727026](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/333096e2f6ba3e0046832a2198035e71697559838.png)\n\n#### Væ¨¡å‹\n\n![image-20250311212753133](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/db537178b02b2ba03201aae5bd94e09c697559838.png)\n\n#### åŸå‹åŒ–æ¨¡å‹\n\n![image-20250311212832401](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7b07f7d9da4143d26b8f86017dd1d462697559838.png)\n\n#### æ•æ·å¼€å‘æ¨¡å‹\n\n![image-20250311212902311](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/57ea9a48cbd9808f724daedac393d893697559838.png)\n\n#### ä¸åŒè½¯ä»¶ç”Ÿå‘½å‘¨æœŸæ¨¡å‹ä¼˜ç¼ºç‚¹å¯¹æ¯”\n\n![image-20250311213000657](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/d228bd2e07eb40c2ca1c436783d07450697559838.png)\n\n\n\n![image-20250311213043377](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ebbe426377f23fcabba3ed8d06d114c2697559838.png)\n\n![image-20250311213100796](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4b46dc968453dd1fd32dc6a01567b490697559838.png)\n\n![image-20250311213124112](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/b4456f785a01fae37f050a7312168377697559838.png)\n\n### è½¯ä»¶å¼€å‘æ–¹æ³•\n\n#### ä¿¡æ¯ç³»ç»Ÿå¼€å‘æ–¹æ³•\n\n![image-20250311234000093](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/70be59a810a253d5bddffebaa93f4a0f697559838.png)\n\n#### é¢å‘å¯¹è±¡çš„å¼€å‘æ–¹æ³•\n\n![image-20250311234022071](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/aed66a23b6454006cc0ce4b25178eddd697559838.png)\n\n![image-20250311234043059](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0f8402ee2bd827b175232b932219c8ac697559838.png)\n\n#### åŸå‹åŒ–æ–¹æ³•\n\n![image-20250311234116787](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/1620905dcdbb0bdba951ae3df17e31ed697559838.png)\n\n![image-20250311234147047](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/346e116670dbb60ec6f5794aef7ff9ef697559838.png)\n\n#### é¢å‘æœåŠ¡çš„æ–¹æ³•\n\n![image-20250311234204985](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/36dd1dbf04f60549bf21aeb6c265f6f1697559838.png)\n\n#### å¼€å‘æ–¹æ³•å¯¹æ¯”ï¼ˆæŒæ¡ï¼‰\n\n![image-20250311234259456](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/40865b96f90fa092d43873f9eaa5ddf5697559838.png)\n\n![image-20250311234336417](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ef7f5f7460ed7808a0e1bb6a1b152ea7697559838.png)\n\n\n\n![image-20250311234354391](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/330c6d3794325d772b53831a70908eb8697559838.png)\n\n![image-20250311234412953](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/04b4338ecce1e2dddb4a5e23d2d7c5fb697559838.png)\n\n![image-20250311234430928](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/160c39ef23b94f627b63d681c9538e3d697559838.png)\n\n### è½¯ä»¶å¼€å‘è¯­è¨€\n\n![image-20250311235319782](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/073618dca3f1248f9a41619cf4230da6697559838.png)\n\n![image-20250311235335182](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ee82196fab0890b51009f70774a4efac697559838.png)\n\n![image-20250311235351852](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7abefba50b984689568f33a39c60f51e697559838.png)\n\n![image-20250311235401854](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4a466d30d1c1bc3550d346bf4555dc75697559838.png)\n\n![image-20250311235446510](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ded811f5f1f412d29d4727bde801b967697559838.png)\n\n### è½¯ä»¶æµ‹è¯•\n\n![image-20250311235507803](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6ee38d30d935f2609b04c268cc636360697559838.png)\n\n![image-20250311235520366](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/78aa542e2da2dd3f703faec0582a6436697559838.png)\n\n![image-20250311235542942](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/50a85161d8c3f0a36d0a279a43eada1b697559838.png)\n\n![image-20250311235623562](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cf7de230e84a019aceb4a12db0c3cbb5697559838.png)\n\n![image-20250311235647874](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/9cfd11cc64655b1b700451250a4902af697559838.png)\n\n![image-20250311235705010](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3cd16974e56c644fd07f29df6ad428bf697559838.png)\n\n![image-20250311235726014](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/ff33152f542687220f7de1c85f21567f697559838.png)\n\n![image-20250311235744851](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/dc5495e6d2cf15e72f50a5ea75037ddf697559838.png)\n\n![image-20250311235812542](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4c5fb58ae0d1b8ab7fb8ad02b6255fda697559838.png)\n\n![image-20250311235834708](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cf7710f326464f9c84ee15902695fca3697559838.png)\n\n![image-20250311235853771](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/61a30787d7d12cc7036fc6d708942165697559838.png)\n\n![image-20250311235910383](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/6ee8c291ea5d48df43e2ab75cfaacad1697559838.png)\n\n![image-20250311235927147](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e76f9b2e9b14e02dc84de348c31f0cce697559838.png)\n\n## æ ‡å‡†åŒ–çŸ¥è¯†äº§æƒ\n\n### æ ‡å‡†åŒ–çŸ¥è¯†\n\næˆ‘å›½æ ‡å‡†çš„çº§åˆ«\n\n![image-20250312183507177](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/cf24ba5141bc1e093138325740d2baeb697559838.png)\n\n![image-20250312183522862](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/416dfb004f492246a0e040ed8313e02d697559838.png)\n\n![image-20250312183530808](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/4bc3cd3b11245bb5f625a761dd1031b3697559838.png)\n\n![image-20250312183541189](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/94b66bde00278c288022d76ddf4445ba697559838.png)\n\n![image-20250312183550924](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/83d4176a7ded34322b4347d7e59a8b7c697559838.png)\n\n![image-20250312183601818](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/7b1aaa9c929eecd272114af89e358229697559838.png)\n\n### çŸ¥è¯†äº§æƒ\n\nçŸ¥è¯†äº§æƒä¿æŠ¤ç›¸å…³æ³•å¾‹\n\n![image-20250312183623749](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/10794c37b0c4d0de754fb43d0a82bb5c697559838.png)\n\n![image-20250312183637036](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c9a90a4c6138152fa3b19825d6d9d943697559838.png)\n\n![image-20250312183650138](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/26d659a6055bb236a7204c36fff17f27697559838.png)\n\n\n\nçŸ¥è¯†äº§æƒä¿æŠ¤æœŸé™\n\n![image-20250312183711428](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/c59f15c0c9e0e72238c4e75ab41c144a697559838.png)\n\n![image-20250312183731979](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/3274510b50dae42d6cd2f9248cdb7704697559838.png)\n\n![image-20250312183755635](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/e40168e8684860d10f40bf447ed62c45697559838.png)\n\n\n\nçŸ¥è¯†äº§æƒå½’å±\n\n![image-20250312183829753](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/104afc19d7458cff69d9ade2a9afe449697559838.png)\n\n\n\nä¾µæƒåˆ¤æ–­\n\n![image-20250312183856114](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/0a91918d9737334435eb51bced4a3795697559838.png)\n\n![image-20250312183920337](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/950456a556501e2c42e71d3954f3993f697559838.png)\n\n![image-20250312183936963](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/bd450bfc2aac0cfc966a24025b5f411c697559838.png)\n\n![image-20250312183954479](../img/%E7%BD%91%E5%B7%A5%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B0/a2bb7b952fafd2cdc992195b33b9b12a697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["ç½‘ç»œ"],"categories":["ç½‘ç»œ"]},{"title":"åä¸ºé…ç½®ä¸“é¢˜","url":"/posts/1c79e7d0/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# åä¸ºé…ç½®ä¸“é¢˜\n\n`åŸºç¡€é…ç½®ï¼ˆé€åˆ†é¢˜ï¼‰ï¼š`system-viewã€sysnameã€interface vlanifã€å†™ä¸ªIPåœ°å€\n\n`é«˜é¢‘é…ç½®ï¼ˆä¸€å®šè¦ä¼šï¼‰ï¼š`VLAN ã€DHCPã€ACLã€ç­–ç•¥è·¯ç”±ã€NATã€é™æ€/é»˜è®¤/RIP/OSPF\n\n`åé—¨çš„è€ƒç‚¹ï¼ˆå°½åŠ›è€Œä¸ºï¼‰ï¼š`IPv6ã€4Gã€WLANï¼ˆç¼ºå°‘è¿™ä¸ªæ¡ˆä¾‹ï¼‰ã€IPSECï¼ˆä¸å…¨ï¼Œå°‘äº†åŠ¨æ€é…ç½®ï¼‰\n\ntopoä¸‹è½½ï¼š[åä¸ºé…ç½®ä¸“é¢˜æ¡ˆä¾‹](https://blog.qianyios.top/img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/%E6%A1%88%E4%BE%8B.7z)\n\n## åŸºç¡€é…ç½®\n\n### åŸºç¡€é…ç½®è§†å›¾\n\n![image-20250314221911397](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250314221911397-1742376668496-8-1742488602419-3.png)\n\n### åä¸ºç™»å…¥é…ç½®\n\n\\<AR\\> `system-view` //è¿›å…¥ç³»ç»Ÿæ¨¡å¼\n[AR]`sysname` Huawei //è®¾å¤‡å‘½åä¸ºHuawei\n[Huawei] telnet server `enable` //å¼€å¯è®¾å¤‡telnetåŠŸèƒ½\n[Huawei] user-interface vty 0 4 //å¼€å¯ç™»å½•ç«¯å£0-4\n[Huawei-ui-vty0-4] protocol `inbound` telnet //é€šè¿‡telnetåè®®ç™»å½•\n[Huawei-ui-vty0-4] authentication-mode `aaa` //è®¤è¯æ–¹å¼ä¸ºaaa\n\n[Huawei] aaa //å¯ç”¨aaa\n[Huawei-aaa] local-user admin123 password admin123 //é…ç½®ç”¨æˆ·åå¯†ç \n[Huawei-aaa] local-user admin123 service-type `telnet` //ç”¨æˆ·ç”¨äºtelnet\n[Huawei-aaa] local-user admin123 privilege level 15 //ç”¨æˆ·ç­‰çº§ä¸º15\n[Huawei-aaa] `quit` //é€€å‡ºæ¥\n[Huawei]\n\n### VLANä¸VLANIFåœ°å€é…ç½®\n\n\\<HUAWEI\\> `system-view` //è¿›å…¥ç³»ç»Ÿæ¨¡å¼\n[HUAWEI] `sysname` Switch //äº¤æ¢æœºé‡å‘½å\n[Switch] vlan 100 //åˆ›å»ºvlan 100ï¼ˆæ‰¹é‡åˆ›å»ºå‘½ä»¤ï¼švlan `batch` 10 20ï¼‰\n[Switch-vlan100] `quit` //é€€å‡ºvlanæ¨¡å¼\n[Switch] `interface gigabitethernet 0/0/1` //è¿›å…¥æ¥å£\n[Switch-GigabitEthernet0/0/1] port link-type `access` //æŠŠäº¤æ¢æœºæ¥å£æ¨¡å¼è®¾ç½®ä¸ºaccess\n[Switch-GigabitEthernet0/0/1] port `default` vlan 100 //æŠŠæ¥å£åˆ’å…¥vlan100\n[Switch-GigabitEthernet0/0/1] quit //é€€å‡º\n\n[Switch] `interface vlanif 100` //è¿›å…¥ä¸‰å±‚vlanifæ¥å£\n[Switch-Vlanif100] `ip address 172.16.1.1 24` //é…ç½®IPåœ°å€\n[Switch-Vlanif100] quit //é€€å‡º\n[Switch]\n\n### DHCPé…ç½®å‘½ä»¤\n\n\\<SwitchA\\> `system-view` //è¿›å…¥ç³»ç»Ÿæ¨¡å¼\n[SwitchA] dhcp `enable` //å¯ç”¨dhcpæœåŠ¡\n[SwitchA] ip `pool` 1 //ç³»ç»Ÿè§†å›¾ä¸‹åˆ›å»ºIPåœ°å€æ± 1\n[SwitchA-ip-pool-1] `network` 10.1.1.0 `mask` 255.255.255.128 //é…ç½®åœ°å€æ± èŒƒå›´\n[SwitchA-ip-pool-1] `dns-list` 10.1.1.1 //é…ç½®DNS \n[SwitchA-ip-pool-1] `gateway-list` 10.1.1.1 //é…ç½®PCç”µè„‘ç½‘å…³\n[SwitchA-ip-pool-1] `excluded-ip-address` 10.1.1.2 //ä¿ç•™IPåœ°å€\n[SwitchA-ip-pool-1] `excluded-ip-address` 10.1.1.4 //ä¿ç•™IPåœ°å€\n[SwitchA-ip-pool-1] `lease` 10 // é…ç½®ç§ŸæœŸ\n[SwitchA-ip-pool-1] `quit` //é€€å‡º\n\né…ç½®VLANIF10æ¥å£ä¸‹çš„å®¢æˆ·ç«¯ä»å…¨å±€åœ°å€æ± ip pool 1ä¸­è·å–IPåœ°å€ã€‚\n[SwitchA] interface vlanif 10 //è¿›å…¥VLAN10æ¥å£\n[SwitchA-Vlanif10] ip address 10.1.1.254 255.255.255.128 //é…ç½®VLANç½‘å…³\n[SwitchA-Vlanif10] dhcp select `global`/`interface` //`å…¨å±€`æˆ–`æ¥å£`dhcpæœåŠ¡å™¨\n\n### ACLè®¿é—®æ§åˆ¶åˆ—è¡¨é…ç½®\n\n//é…ç½®æ—¶é—´æ®µï¼Œå‘¨ä¸€åˆ°å‘¨äº”æ—©ä¸Š8:30åˆ°ä¸‹åˆ18:00\n\n[Huawei] `time-range` workday 8:30 to 18:00 working-day \n\n//å¯ç”¨ç¼–å·ä¸º2000çš„ACL\n\n[Huawei] `acl` 2000 \n\n//åªå…è®¸192.168.1.10è¿™ä¸€ä¸ªç”¨æˆ·åœ¨å·¥ä½œæ—¥å¯ä»¥telnetäº¤æ¢æœº\n\n[Huawei-acl-basic-2000]` rule permit source` 192.168.1.10 0 `time-range` workday \n\n//è¿™ä¸ªåœ°æ–¹rule denyå¯ä»¥ä¸ç”¨å†™ï¼Œaclåœ¨è¿™ç§åœºæ™¯ä¸‹æœ€åéšå«æœ‰ä¸€æ¡deny anyçš„è¯­å¥\n\n[Huawei-acl-basic-2000] rule `deny` \n\n//è¿›å…¥è™šæ‹Ÿæ¥å£0-4\n\n[Huawei] user-interface vty 0 4 \n\n//åº”ç”¨ACLï¼Œåªå…è®¸åŒ¹é…aclæ•°æ®æµçš„çš„ç”¨æˆ·telentç™»é™†äº¤æ¢æœºï¼Œæ²¡æœ‰è¢«permitçš„å…¨éƒ¨è¢«deny\n\n[Huawei-ui-vty0-4] acl 2000 `inbound` \n\n### NATåœ°å€è½¬æ¢é…ç½®\n\n[Router] nat `address-group` 1 2.2.2.100 2.2.2.200 //é…ç½®NATåœ°å€æ± 1\n[Router] nat `address-group` 2 2.2.2.80 2.2.2.83 //é…ç½®NATåœ°å€æ± 2\n[Router] `acl` 2000 //é…ç½®ACL2000\n\n//è®¾ç½®ACL200ç¼–å·ä¸º5çš„è§„åˆ™ï¼Œå…è®¸ä¸Šè¿°æºåœ°å€é€šè¿‡\n\n[Router-acl-basic-2000] rule 5 `permit source` 192.168.20.0 0.0.0.255 \n[Router-acl-basic-2000] `quit`\n[Router] `acl` 2001 //é…ç½®ACL2001\n\n//è®¾ç½®ACL2001ä¸­ç¼–å·ä¸º5çš„è§„åˆ™ï¼Œå…è®¸ä¸Šè¿°åœ°å€é€šè¿‡\n\n[Router-acl-basic-2001] rule 5 `permit source` 10.0.0.0 0.0.0.255 \n[Router-acl-basic-2001] quit\n[Router] interface gigabitethernet 3/0/0 //è¿›å…¥æ¥å£\n\n//å°†è®¾ç½®ACL2000åŒ¹é…çš„æºåœ°å€ï¼Œè½¬æ¢ä¸ºåœ°å€æ± 1çš„åœ°å€ï¼Œå¹¶ä¸”ä¸å¼€å¯ç«¯å£NAT\n\n[Router-GigabitEthernet3/0/0] `nat outbound` 2000 address-group 1 `no-pat`\n\n//å°†è®¾ç½®ACL2001åŒ¹é…çš„æºåœ°å€ï¼Œè½¬æ¢ä¸ºåœ°å€æ± 2çš„åœ°å€\n\n[Router-GigabitEthernet3/0/0] `nat outbound` 2001 address-group 2 \n[Router-GigabitEthernet3/0/0] `quit`\n[Router]\n\n## åŠ¨æ€ä¸»æœºé…ç½®åè®® DHCP\n\n![image-20250315142040835](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142040835-1742376668497-9-1742488602419-4.png)\n\n![image-20250315142113739](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142113739-1742376668497-10-1742488602419-5.png)\n\n### DHCPæ¦‚å¿µå’Œå·¥ä½œåŸç†\n\n![image-20250315142145449](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142145449-1742376668497-12-1742488602419-6.png)\n\n![image-20250315142446263](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142446263-1742376668497-11-1742488602419-8.png)\n\n![image-20250315142534400](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142534400-1742376668497-13-1742488602419-7.png)\n\n### åŸºäºæ¥å£åœ°å€æ± çš„DHCPé…ç½®\n\n![image-20250315142605183](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142605183-1742376668497-14-1742488602419-9.png)\n\n### åŸºäºå…¨å±€åœ°å€æ± çš„DHCPé…ç½®\n\n![image-20250315142635892](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142635892-1742376668497-15-1742488602419-10.png)\n\n### DHCPæ¥å£åœ°å€æ± é…ç½®æ¡ˆä¾‹\n\n![image-20250315142720850](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142720850-1742376668497-18-1742488602419-11.png)\n\n### DHCPå…¨å±€åœ°å€æ± é…ç½®æ¡ˆä¾‹\n\n![image-20250315142751379](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315142751379-1742376668497-16-1742488602419-12.png)\n\n\n\n### DHCPæ¡ˆä¾‹\n\n#### ä¸‰å±‚äº¤æ¢æœºè·¨vlané€šä¿¡æ¡ˆä¾‹\n\n![image-20250315150817358](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315150817358-1742376668497-17-1742488602419-13.png)\n\n![image-20250315150846398](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315150846398-1742376668497-19-1742488602419-14.png)\n\n```\nsystem-view\nsysname SW\nvlan batch 10 20\ninterface vlanif10\nip address 192.168.10.254 24\ninterface vlanif20\nip address 192.168.20.254 24\ninterface GigabitEthernet 0/0/1\nport link-type access\nport default vlan 10\ninterface GigabitEthernet 0/0/2\nport link-type access\nport default vlan 20\n```\n\n![image-20250315150916270](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315150916270-1742376668497-20-1742488602419-15.png)\n\n#### DHCPæ¥å£å’Œå…¨å±€é…ç½®\n\nè¿˜æ˜¯ä¸Šé¢é‚£ä¸ªå›¾ï¼Œ`å·¦è¾¹å®ç°dhcpæ¥å£åœ°å€æ± `ï¼Œ`å³è¾¹å®ç°å…¨å±€é…ç½®`\n\næˆ‘ä»¬å°±ç”¨`SWäº¤æ¢æœº`æ¥åš`dhcpæœåŠ¡ç«¯`ç»™ä¸‹é¢çš„å®¢æˆ·ç«¯åˆ†é…IPåœ°å€\n\n![image-20250315150817358](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315150817358-1742376668497-17-1742488602419-13.png)\n\nåŸºç¡€vlané…ç½®\n\n```\nsystem-view\nsysname SW\nvlan batch 10 20\ninterface vlanif10\nip address 192.168.10.254 24\ninterface vlanif20\nip address 192.168.20.254 24\n\ninterface GigabitEthernet 0/0/1\nport link-type access\nport default vlan 10\ninterface GigabitEthernet 0/0/2\nport link-type access\nport default vlan 20\n```\n\n`vlanif10 å®ç°æ¥å£dhcp`\n\n```bash\nsystem-view\ndhcp enable\ninterface vlanif 10\ndhcp select interface\ndhcp server dns-list 8.8.8.8\n#æ’é™¤192.168.10.101åˆ°192.168.10.253è¿™äº›åœ°å€ï¼Œå…¶ä»–å¯åˆ†é…\ndhcp server excluded-ip-address 192.168.10.101 192.168.10.253\ndhcp server lease day 8\n```\n\n![image-20250315164414794](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315164414794-1742376668497-21-1742488602419-16.png)\n\nå¯¹PC1çš„E0/0/1æ¥å£è¿›è¡ŒæŠ“åŒ…ï¼Œå¹¶ä¸”è®¾ç½®dhcpæ¨¡å¼å¹¶ä¸”åº”ç”¨\n\n![image-20250315164721703](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315164721703-1742376668497-23-1742488602420-18.png)\n\n![image-20250315164740355](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315164740355-1742376668497-22-1742488602419-17.png)\n\nè¿™æ—¶å€™ä»–å°±å¯ä»¥ä»å¯é€‰åœ°å€é‡Œä»å¤§åˆ°å°åˆ†é…åœ°å€ï¼Œè¿™æ˜¯åä¸ºæ‰ä¼šçš„ï¼Œæ€ç§‘åˆ™ä¼šä»å°åˆ°å¤§è¿›è¡Œåˆ†é…\n\n![image-20250315170617540](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315170617540-1742376668497-24-1742488602420-19.png)\n\n`vlanif20 å®ç°å…¨å±€dhcp`\n\n```\nsystem-view\ninterface vlanif 20\ndhcp select global\nq\nip pool 20\nnetwork 192.168.20.0 mask 24\ngateway-list 192.168.20.254\ndns-list 9.9.9.9\nlease 10\nexcluded-ip-address 192.168.20.151 192.168.20.253\nq\ndis cu\n```\n\n![image-20250315171942987](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315171942987-1742376668497-25-1742488602420-20.png)\n\nå¯¹pc2è¿›è¡Œè®¾ç½®è‡ªåŠ¨è·å–ipæ¨¡å¼\n\n![image-20250315172017450](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315172017450-1742376668497-26-1742488602420-21.png)\n\n![image-20250315172028490](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315172028490-1742376668497-27-1742488602420-24.png)\n\næˆåŠŸï¼Œè€Œä¸”ä¸¤å°æœºå­äº’é€š\n\n![image-20250315172140253](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315172140253-1742376668497-28-1742488602420-22.png)\n\n\n\n`å¯¹å·¦è¾¹çš„æ¥å£dhcpè¿›è¡Œä¿®æ”¹æˆå…¨å±€dhcp`\n\n```bash\nsystem-view\ninterface vlan 10\nundo dhcp select interface\n#è¾“å…¥y\ndhcp select global\nq\nip pool 10\nnetwork 192.168.10.0 mask 24\ngateway-list 192.168.10.254\ndns-list 8.8.8.8\nlease 8\n```\n\n![image-20250315174619405](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315174619405-1742376668497-29-1742488602420-23.png)\n\n![image-20250315174708636](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250315174708636-1742376668497-30-1742488602420-25.png)\n\nè¿™æ¬¡æˆ‘æ²¡æœ‰æ’é™¤ipåœ°å€ï¼Œæ‰€ä»¥ä»–ä¼šä»è¿™ä¸ªç½‘æ®µä¸‹çš„æ‰€æœ‰å¯ç”¨åœ°å€è¿›è¡Œåˆ†é…\n\n#### æ‰©å±•çŸ¥è¯†ç‚¹\n\n7.8.4 Option 43 åº”ç”¨ä¸¾ä¾‹\n\n7.8.7 DHCPä¸­ç»§ï¼ˆDHCP Relayï¼‰\n\n7.8.8 DHCP Snooping\n\n\n\n## ACLåŸç†ä¸é…ç½®\n\n### ACLæ¦‚è¿°\n\n![image-20250316173925603](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316173925603-1742376668497-31-1742488602420-26.png)\n\n![image-20250316173933483](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316173933483-1742376668497-32-1742488602420-27.png)\n\n### ACLå·¥ä½œåŸç†\n\nACLç”±è‹¥å¹²æ¡permitæˆ–denyè¯­å¥ç»„æˆã€‚\n\nâ€¢ æ¯æ¡è¯­å¥å°±æ˜¯è¯¥ACLçš„ä¸€æ¡è§„åˆ™ï¼Œæ¯æ¡è¯­å¥ä¸­çš„permitæˆ–denyå°±æ˜¯ä¸è¿™æ¡è§„åˆ™ç›¸å¯¹åº”çš„å¤„ç†åŠ¨ä½œã€‚\n\n![image-20250316174021516](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316174021516-1742376668497-33-1742488602420-28.png)\n\n`è§„åˆ™ç¼–å·`\n\n![image-20250316175414159](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175414159-1742376668497-34-1742488602420-29.png)\n\nåŒ¹é…ç¬¦\n\n![image-20250316175449238](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175449238-1742376668497-35-1742488602420-30.png)\n\n![image-20250316175546519](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175546519-1742376668497-36-1742488602420-31.png)\n\n`ACLåˆ†ç±»`\n\n![image-20250316175620835](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175620835-1742376668497-37-1742488602420-32.png)\n\n`åŸºæœ¬ACLå’Œé«˜çº§ACL`\n\n![image-20250316175646236](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175646236-1742376668497-38-1742488602420-33.png)\n\n`ACLçš„åŒ¹é…æœºåˆ¶`\n\n![image-20250316175712089](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175712089-1742376668497-42-1742488602420-34.png)\n\n`ACLçš„åŒ¹é…é¡ºåºåŠåŒ¹é…ç»“æœ`\n\n![image-20250316175804375](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175804375-1742376668497-39-1742488602420-35.png)\n\n`ACLçš„åº”ç”¨ä½ç½®`\n\n![image-20250316175830957](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175830957-1742376668497-40-1742488602420-36.png)\n\n`å…¥ç«™ (Inbound)åŠå‡ºç«™ (Outbound)æ–¹å‘`\n\n![image-20250316175855519](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175855519-1742376668497-41-1742488602420-37.png)\n\n### ACLé…ç½®åŠåº”ç”¨\n\n![image-20250316175925487](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175925487-1742376668497-43-1742488602420-38.png)\n\n![image-20250316175935553](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175935553-1742376668497-44-1742488602420-39.png)\n\n`é«˜çº§ACLå‘½ä»¤ï¼ˆ1ï¼‰`\n\n![image-20250316175953586](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316175953586-1742376668497-45-1742488602420-40.png)\n\n![image-20250316180000385](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316180000385-1742376668497-48-1742488602420-41.png)\n\n\n\nè¿›é˜¶æ¡ˆä¾‹ï¼šä½¿ç”¨é«˜çº§ACLé™åˆ¶ä¸åŒç½‘æ®µçš„ç”¨æˆ·äº’è®¿ (1)\n\n![image-20250316180015688](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316180015688-1742376668497-46-1742488602420-42.png)\n\n![image-20250316180025795](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316180025795-1742376668497-47-1742488602420-43.png)\n\n\n\n1.ä¸‹åˆ—é€‰é¡¹ä¸­ï¼Œå“ªä¸€é¡¹æ‰æ˜¯ä¸€æ¡åˆæ³•çš„åŸºæœ¬ACLçš„è§„åˆ™?(C)\n\nA. rule permit ip\nB. rule deny ip\nC. rule permit source any\nD. rule deny tcp source any\n\n2.é«˜çº§ACLå¯ä»¥åŸºäºå“ªäº›æ¡ä»¶æ¥å®šä¹‰è§„åˆ™?\n\n1. æºIPåœ°å€\n2. ç›®çš„IPåœ°å€\n3. æºç«¯å£å·\n4. ç›®çš„ç«¯å£å·\n5. åè®®ç±»å‹ï¼ˆå¦‚TCPã€UDPã€ICMPç­‰ï¼‰\n6. æ•°æ®åŒ…ä¼˜å…ˆçº§ï¼ˆDSCPã€ToSç­‰ï¼‰\n7. ICMPæ¶ˆæ¯ç±»å‹å’Œä»£ç \n8. æ—¶é—´èŒƒå›´ï¼ˆåŸºäºæ—¶é—´çš„ACLï¼‰\n9. ç‰‡æ®µæ ‡è®°ï¼ˆéé¦–ç‰‡åˆ†ç‰‡ï¼‰\n10. æ•°æ®åŒ…é•¿åº¦\n11. TCPæ ‡å¿—ä½ï¼ˆå¦‚SYNã€ACKã€FINç­‰ï¼‰\n12. VLAN ID\n13. æºMACåœ°å€\n14. ç›®çš„MACåœ°å€\n15. ä»¥å¤ªç½‘åè®®ç±»å‹\n\n\n\n### ç« èŠ‚æ€»ç»“\n\nACLæ˜¯ä¸€ç§åº”ç”¨éå¸¸å¹¿æ³›çš„ç½‘ç»œæŠ€æœ¯ã€‚å®ƒçš„åŸºæœ¬åŸç†æ˜¯:é…ç½®äº†ACLçš„ç½‘ç»œè®¾å¤‡æ ¹æ®äº‹å…ˆè®¾å®šå¥½çš„æŠ¥æ–‡åŒ¹é…è§„åˆ™å¯¹ç»è¿‡è¯¥è®¾å¤‡çš„æŠ¥æ–‡è¿›è¡ŒåŒ¹é…ï¼Œç„¶åå¯¹åŒ¹é…ä¸Šçš„æŠ¥æ–‡æ‰§è¡Œäº‹å…ˆè®¾å®šå¥½çš„å¤„ç†åŠ¨ä½œã€‚è¿™äº›åŒ¹é…è§„åˆ™åŠç›¸åº”çš„å¤„ç†åŠ¨ä½œæ˜¯æ ¹æ®å…·ä½“çš„ç½‘ç»œéœ€æ±‚è€Œè®¾å®šçš„ã€‚å¤„ç†åŠ¨ä½œçš„ä¸åŒä»¥åŠåŒ¹é…è§„åˆ™çš„å¤šæ ·æ€§ï¼Œä½¿å¾—ACLå¯ä»¥å‘æŒ¥å‡ºå„ç§å„æ ·çš„åŠŸæ•ˆã€‚\n\nACLæŠ€æœ¯æ€»æ˜¯ä¸é˜²ç«å¢™ã€è·¯ç”±ç­–ç•¥ã€QoSã€æµé‡è¿‡æ»¤ç­‰å…¶ä»–æŠ€æœ¯ç»“åˆä½¿ç”¨ã€‚\n\nåœ¨æœ¬ç« èŠ‚ä¸­ï¼Œä¸»è¦ä»‹ç»äº†ACLçš„ç›¸å…³æŠ€æœ¯çŸ¥è¯†ï¼ŒåŒ…æ‹¬:ACLçš„ä½œç”¨ï¼ŒACLçš„ç»„æˆã€åŒ¹é…å’Œåˆ†ç±»ã€é€šé…ç¬¦çš„ä½¿ç”¨æ–¹æ³•ï¼Œä»¥åŠACLçš„åŸºæœ¬é…ç½®åŠåº”ç”¨ã€‚\n\n### æ¡ˆä¾‹\n\n![image-20250316192011927](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316192011927-1742376668497-49-1742488602420-44.png)\n\næŸå…¬å¸ä¸ºä¿è¯è´¢åŠ¡æ•°æ®å®‰å…¨ï¼Œç¦æ­¢ç ”å‘éƒ¨é—¨è®¿é—®è´¢åŠ¡æœåŠ¡å™¨ï¼Œä½†æ€»è£åŠä¸å—é™åˆ¶\n\nä¸­é—´çš„è·¯ç”±å™¨æ·»åŠ äº†ä¸€ä¸ªç™¾å…†ç½‘å¡æ¥å£\n\n![image-20250316201601548](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316201601548-1742376668497-50-1742488602420-45.png)\n\n![image-20250316201949240](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316201949240-1742376668497-51-1742488602420-46.png)\n\n![image-20250316202111022](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316202111022-1742376668497-54-1742488602420-47.png)\n\n![image-20250316202323963](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316202323963-1742376668497-52-1742488602420-48.png)\n\né…ç½®è·¯ç”±å™¨å„ä¸ªæ¥å£çš„ipåœ°å€\n\n`Router`\n\n```\nsystem-view\nsysname Router\ninterface GigabitEthernet 0/0/0\nip address 192.168.1.254 24\ninterface GigabitEthernet 0/0/1\nip address 192.168.2.254 24\ninterface GigabitEthernet 0/0/2\nip address 1.1.1.254 24\ninterface Ethernet 4/0/0\nip address 192.168.3.254 24\n```\n\n`äº’è”ç½‘`\n\n```\nsystem-view\nsysname hlw\ninterface GigabitEthernet 0/0/0\nip address 1.1.1.1 24\n```\n\nä¸ºå•¥pingä¸é€š\n\n![image-20250316204423261](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316204423261-1742376668497-53-1742488602420-49.png)\n\nå› ä¸ºpc1çš„æµé‡å¯ä»¥èµ°åˆ°äº’è”ç½‘è¿™å°è·¯ç”±å™¨ï¼Œä½†æ˜¯å›æ¥çš„æµé‡æ²¡æœ‰å•Šï¼Œå› ä¸ºäº’è”ç½‘è¿™å°è·¯ç”±å™¨é‡Œæ²¡æœ‰pc1ç½‘æ®µçš„è·¯ç”±\n\n![image-20250316204850670](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316204850670-1742376668497-55-1742488602420-50.png)\n\n```\nsystem-view\nip route-static 0.0.0.0 0 1.1.1.254\n```\n\n![image-20250316204921136](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316204921136-1742376668497-56-1742488602420-51.png)\n\n![image-20250316205026516](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316205026516-1742376668497-57-1742488602420-52.png)\n\nç°åœ¨æ‰€æœ‰ç½‘ç»œéƒ½é€šäº†ï¼Œæ¥ä¸‹æ¥è¦é…ç½®aclå®ç°è®¿é—®ç­–ç•¥äº†\n\n> æŸå…¬å¸ä¸ºä¿è¯è´¢åŠ¡æ•°æ®å®‰å…¨ï¼Œç¦æ­¢ç ”å‘éƒ¨é—¨è®¿é—®è´¢åŠ¡æœåŠ¡å™¨ï¼Œä½†æ€»è£åŠä¸å—é™åˆ¶\n\nRouter\n\n```bash\nsystem-view\nacl 3000\n#ç¦æ­¢æºç½‘æ®µ192.168.1.0è®¿é—®192.168.3.100\nrule 10 deny ip source 192.168.1.0 0.0.0.255 destination 192.168.3.100 0.0.0.0\n#å…è®¸æºç½‘æ®µ192.168.2.0è®¿é—®192.168.3.100\nrule 20 permit ip source 192.168.2.0 0.0.0.255 destination 192.168.3.100 0.0.0.0\n#ç¦æ­¢äº’è”ç½‘çš„æ‰€æœ‰æµé‡è®¿é—®192.168.3.100\nrule 30 deny ip source any destination 192.168.3.100 0.0.0.0\n```\n\né…ç½®å®Œåæµ‹è¯•ä¸€ä¸‹PC1èƒ½ä¸èƒ½è®¿é—®è´¢åŠ¡éƒ¨\n\n![image-20250316210433035](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316210433035-1742376668497-60-1742488602420-53.png)\n\nè¿˜èƒ½è®¿é—®ä¸ºä»€ä¹ˆï¼Œå› ä¸ºä½ çš„aclè¿˜æ²¡æœ‰åº”ç”¨åˆ°æ¥å£ä¸Š\n\n![image-20250316210639466](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316210639466-1742376668497-58-1742488602420-54.png)\n\nRouter\n\n```\nsystem-view\ninterface Ethernet 4/0/0\ntraffic-filter outbound acl 3000\n```\n\n![image-20250316210937258](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316210937258-1742376668497-59-1742488602420-55.png)\n\nç›®çš„è¾¾æˆï¼Œä¸”ä¸¤å°pcè®¿é—®äº’è”ç½‘æ˜¯æ²¡æœ‰å½±å“çš„\n\n![image-20250316211017980](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250316211017980-1742376668497-61-1742488602420-57.png)\n\n## ç½‘ç»œåœ°å€è½¬æ¢NAT\n\n`æŠ€æœ¯èƒŒæ™¯`\n\néšç€Internetçš„å‘å±•å’Œç½‘ç»œåº”ç”¨çš„å¢å¤šï¼Œæœ‰é™çš„IPv4å…¬æœ‰åœ°å€å·²ç»æˆä¸ºåˆ¶çº¦ç½‘ç»œå‘å±•çš„ç“¶é¢ˆã€‚ä¸ºè§£å†³\n\nè¿™ä¸ªé—®é¢˜ï¼ŒNATï¼ˆNetwork Address Translationï¼Œç½‘ç»œåœ°å€è½¬æ¢ï¼‰æŠ€æœ¯åº”éœ€è€Œç”Ÿã€‚\n\nNATæŠ€æœ¯ä¸»è¦ç”¨äºå®ç°å†…éƒ¨ç½‘ç»œçš„ä¸»æœºè®¿é—®å¤–éƒ¨ç½‘ç»œã€‚\n\næœ¬ç« èŠ‚æˆ‘ä»¬å°†äº†è§£NATçš„æŠ€æœ¯èƒŒæ™¯ï¼Œ å­¦ä¹ ä¸åŒç±»å‹NATçš„æŠ€æœ¯åŸç†ã€ä½¿ç”¨åœºæ™¯ã€‚\n\n### NATæ¦‚è¿°\n\n![image-20250317210628030](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317210628030-1742376668497-63-1742488602420-56.png)\n\n#### ç§æœ‰IPåœ°å€\n\n![image-20250317210650214](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317210650214-1742376668497-62-1742488602420-58.png)\n\n#### NATæŠ€æœ¯åŸç†\n\n![image-20250317210710154](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317210710154-1742376668497-65-1742488602420-59.png)\n\n### é™æ€NAT\n\n#### é™æ€NATåŸç†\n\n![image-20250317210739619](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317210739619-1742376668497-64-1742488602420-60.png)\n\n#### é™æ€NATè½¬æ¢ç¤ºä¾‹\n\n![image-20250317210815832](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317210815832-1742376668497-66-1742488602420-61.png)\n\n#### é™æ€NATé…ç½®ä»‹ç»\n\n![image-20250317211130187](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317211130187-1742376668497-67-1742488602420-62.png)\n\n#### é™æ€NATé…ç½®ç¤ºä¾‹\n\n![image-20250317211155403](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317211155403-1742376668497-68-1742488602420-63.png)\n\n### åŠ¨æ€NAT\n\n#### åŠ¨æ€NATåŸç†\n\n![image-20250317211242892](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317211242892-1742376668498-71-1742488602420-64.png)\n\n#### åŠ¨æ€NATè½¬æ¢ç¤ºä¾‹ (å‡ºå»æµé‡)\n\n![image-20250317211307890](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317211307890-1742376668497-69-1742488602420-65.png)\n\n#### åŠ¨æ€NATè½¬æ¢ç¤ºä¾‹ (å›ç¨‹æµé‡)\n\n![image-20250317211415839](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317211415839-1742376668497-70-1742488602420-66.png)\n\n#### åŠ¨æ€NATé…ç½®ä»‹ç»\n\n![image-20250317212242367](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317212242367-1742376668498-72-1742488602420-67.png)\n\n#### åŠ¨æ€NATé…ç½®ç¤ºä¾‹\n\n![image-20250317212308080](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317212308080-1742376668498-73-1742488602420-68.png)\n\n### NAPTã€Easy-IP\n\n#### NAPTåŸç†\n\n![](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317212818719-1742376668498-74-1742488602420-69.png)\n\n![image-20250317221226334](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317221226334-1742376668498-78-1742488602420-70.png)\n\n#### NAPTè½¬æ¢ç¤ºä¾‹ (å‡ºå»æµé‡)\n\n![](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317212851278-1742376668498-77-1742488602420-71.png)\n\n#### NAPTè½¬æ¢ç¤ºä¾‹ (å›ç¨‹æµé‡)\n\n![](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317212918911-1742376668498-75-1742488602420-72.png)\n\n#### NAPTé…ç½®ç¤ºä¾‹\n\n![](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317213720455-1742376668498-76-1742488602420-73.png)\n\n#### Easy IP\n\n![](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317213959237-1742376668498-79-1742488602420-74.png)\n\n#### Easy IPé…ç½®ç¤ºä¾‹\n\n![](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317214039642-1742376668498-80-1742488602420-75.png)\n\n### NAT Server\n\n#### NAT Serverä½¿ç”¨åœºæ™¯\n\n![image-20250317214311969](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317214311969-1742376668498-81-1742488602420-76.png)\n\n#### NAT Serverè½¬æ¢ç¤ºä¾‹\n\n![image-20250317214602568](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317214602568-1742376668498-84-1742488602420-77.png)\n\n#### NAT Serveré…ç½®ç¤ºä¾‹\n\n![image-20250317215037441](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317215037441-1742376668498-82-1742488602420-78.png)\n\n\n\n\n\nä½•ç§NATè½¬æ¢å¯ä»¥è®©å¤–éƒ¨ç½‘ç»œä¸»åŠ¨è®¿é—®å†…ç½‘æœåŠ¡å™¨ï¼Ÿ\n\n1.é™æ€NATé€šè¿‡å›ºå®šæ˜ å°„å†…ç½‘IPåˆ°å…¬ç½‘IPå®ç°å¤–ç½‘è®¿é—®ï¼Œé€‚åˆé•¿æœŸå¯¹å¤–æœåŠ¡çš„æœåŠ¡å™¨ï¼›\n\n2.ç«¯å£æ˜ å°„(NAPT)åˆ™é€šè¿‡æŒ‡å®šå…¬ç½‘IPå’Œç«¯å£å·å°†æµé‡è½¬å‘åˆ°å†…ç½‘æœåŠ¡å™¨ï¼ŒèŠ‚çœå…¬ç½‘IPèµ„æºä¸”çµæ´»æ€§é«˜ã€‚\n\n\n\nNAPTç›¸æ¯”è¾ƒäºNo-PATæœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ\n\n1.NAPTç›¸æ¯”No-PATçš„ä¼˜ç‚¹åœ¨äºèƒ½å¤Ÿé€šè¿‡ç«¯å£å¤ç”¨æŠ€æœ¯è®©å¤šä¸ªå†…ç½‘è®¾å¤‡å…±äº«ä¸€ä¸ªå…¬ç½‘IPåœ°å€ï¼Œä»è€Œå¤§å¹…èŠ‚çœå…¬ç½‘IPèµ„æºï¼ŒåŒæ—¶æ”¯æŒæ›´å¤šå†…ç½‘è®¾å¤‡è®¿é—®å¤–ç½‘ã€‚è€ŒNo-PATä»…è¿›è¡ŒIPåœ°å€è½¬æ¢ï¼Œæ¯ä¸ªå†…ç½‘è®¾å¤‡éœ€å ç”¨ä¸€ä¸ªç‹¬ç«‹çš„å…¬ç½‘IPï¼Œèµ„æºåˆ©ç”¨ç‡ä½ã€‚\n\n### ç« èŠ‚æ€»ç»“\n\n![image-20250317220752420](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317220752420-1742376668498-83-1742488602420-79.png)\n\n\n\n### NATæ¡ˆä¾‹\n\n![image-20250318191232078](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/5c6c4dd3e13f4ab9c2dfffd3ef693a34697559838-1742488602420-81.png)\n\n![image-20250317225617841](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250317225617841-1742376668498-85-1742488602420-80.png)\n\n#### åŸºæœ¬é…ç½®\n\n`AR1`\n\n```\nsystem-view\nun in en\nsysname AR1\ninterface GigabitEthernet 0/0/1\nip address 12.1.1.1 24\ninterface GigabitEthernet 0/0/0\nip address 192.168.1.254 24\n```\n\n`AR2`\n\n```\nsystem-view\nun in en\nsysname AR2\ninterface GigabitEthernet 0/0/0\nip address 12.1.1.254 24\n```\n\n#### é™æ€NAT\n\nåŠŸèƒ½å°±æ˜¯å†…ç½‘åœ°å€å’Œå…¬ç½‘åœ°å€ä¸€ä¸€å¯¹åº”\n\næœ‰ä¸¤ä¸ªæ–¹æ³•\n\n1.åœ¨æ¥å£ä¸‹é…\n\n`AR1`\n\n```\nsystem-view\nun in en\ninterface GigabitEthernet 0/0/1 \nnat static global 12.1.1.2 inside 192.168.1.1\n```\n\n2.ä¸åœ¨æ¥å£ä¸‹é…ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿè§†å›¾ä¸‹,ä¹Ÿå°±æ˜¯è¯´ä½ è™½ç„¶åˆ›å»ºäº†é™æ€natè§„åˆ™ï¼Œä½†æ˜¯ä½ æ²¡æœ‰åœ¨æ¥å£åº”ç”¨\n\n```\nsystem-view\nun in en\nnat static global 12.1.1.2 inside 192.168.1.1\ninterface GigabitEthernet 0/0/1 \nnat static enable\n```\n\näºŒè€…çš„åŒºåˆ«å°±æ˜¯ï¼Œä½ è¦æ˜¯åœ¨`æ¥å£è¯•å›¾`ä¸‹é…ç½®natæ˜¯ä¸ç”¨è¾“å…¥`nat static enable`\n\n`12.1.1.2`æ˜¯å…¬ç½‘åœ°å€ï¼Œè¿™é‡Œçš„12.1.1.0/24æ˜¯å…¬ç½‘ç½‘æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ globalæˆ‘å®šä¹‰è¿™ä¸ªç½‘æ®µçš„å“ªä¸€ä¸ªåœ°å€éƒ½è¡Œï¼Œç”Ÿäº§ä¸­æ²¡æœ‰è¿™ä¹ˆå¤šåœ°å€ï¼Œè¿™é‡Œå°±ä»¥12.1.1.2åˆ°12.1.1.10ä¸ºå…¬ç½‘åœ°å€\n\n![image-20250318191821003](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/ed3409c8e47e09695496a4a19b369b43697559838-1742488602420-83.png)\n\n#### åŠ¨æ€nat\n\næœ‰å…¬ç½‘åœ°å€æ± æ¦‚å¿µï¼Œä¹Ÿæ˜¯å†…ç½‘åœ°å€å’Œå…¬ç½‘ä¸€ä¸€å¯¹åº”ï¼Œä½†æ˜¯å…¬ç½‘åœ°å€ä¼šæœ‰ç©ºé—²çš„\n\nåˆ æ‰é™æ€NATçš„é…ç½®\n\n`AR1`\n\nåœ¨æ¥å£ä¸‹é…\n\n```\nsystem-view\nun in en\ninterface GigabitEthernet 0/0/1 \nundo nat static global 12.1.1.2 inside 192.168.1.1\n```\n\nä¸åœ¨æ¥å£ä¸‹é…\n\n```\nsystem-view\nun in en\nundo nat static global 12.1.1.2 inside 192.168.1.1\ninterface GigabitEthernet 0/0/1 \nundo nat static enable\n```\n\nå¿«å¼€å§‹é…ç½®NAT\n\n`AR1`\n\n1.åˆ›å»ºåœ°å€æ± ï¼Œç¼–å·ä¸º1ï¼ŒèŒƒå›´æ˜¯12.1.1.2åˆ°12.1.1.10\n\n2.åˆ›å»ºåœ°å€è½¬æ¢acl\n\n3.åœ¨æ¥å£ä¸‹åº”ç”¨acl,å¹¶ä¸”è®¾ç½®ä¸ºno-patï¼ˆéç«¯å£åœ°å€è½¬æ¢ï¼‰\n\n```\nsystem-view\nun in en\nnat address-group 1 12.1.1.2 12.1.1.10\nacl 2000\nrule 10 permit source 192.168.1.0 0.0.0.255\ninterface GigabitEthernet 0/0/1\nnat outbound 2000 address-group 1 no-pat\n```\n\n![image-20250318200124937](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/2bcc3263efdefb11d32fd9e3685008ac697559838-1742488602420-82.png)\n\n#### NAPT\n\næ¥å£åœ°å€è½¬æ¢ï¼Œå¸¦ç«¯å£çš„,è¿™ç§æƒ…å†µåªé€‚åˆå…¬ç½‘åœ°å€ä¸å¤šçš„æƒ…å†µï¼Œä¸€èˆ¬å°å…¬å¸åªæœ‰ä¸€ä¸ªå…¬ç½‘åœ°å€çš„æƒ…å†µï¼Œè¦ç»™å…¬å¸æ‰€æœ‰å†…ç½‘ç”µè„‘å»ä½¿ç”¨ï¼Œå’‹åŠå‘¢ï¼Œè¿™æ—¶å€™å°±æœ‰äº†å¸¦ç«¯å£çš„åœ°å€è½¬æ¢\n\nåˆ é™¤åŠ¨æ€natçš„é…ç½®ï¼Œå‰é¢åŠ ä¸ªundoå°±è¡Œäº†\n\n`AR1`\n\n```\nsystem-view\nun in en\nnat address-group 1 12.1.1.2 12.1.1.2\nacl 2000\nrule 10 permit source 192.168.1.0 0.0.0.255\ninterface GigabitEthernet 0/0/1\nnat outbound 2000 address-group 1\n```\n\n![image-20250318201734960](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/d3a0cdf593fc83c8685e1d625831454e697559838-1742488602420-84.png)\n\n![image-20250318202742348](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/99404aa38b5a715d8462e9700ea9f670697559838-1742488602420-93.png)\n\n#### Easy-Ip\n\né€‚ç”¨äºæ²¡æœ‰å›ºå®šçš„å…¬ç½‘ipçš„ç½‘ç»œï¼ŒåŸç†è·ŸNAPTä¸€æ ·ä¹Ÿæ˜¯åŸºäºç«¯å£è½¬æ¢,æŠŠè§„åˆ™åº”ç”¨åˆ°å‡ºæ¥å£å°±è¡Œäº†ï¼Œä»¥å‡ºæ¥å£çš„åœ°å€ä¸ºå…¬ç½‘åœ°å€åšè½¬æ¢\n\n```\nsystem-view\nun in en\nacl 2000\nrule 10 permit source 192.168.1.0 0.0.0.255\ninterface GigabitEthernet 0/0/1\nnat outbound 2000\n```\n\npc1ä¸€æ ·å¯ä»¥pingå¤–ç½‘\n\n![image-20250318204906974](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/ac12515bb578d3c4bddb651bf4b7bb06697559838-1742488602420-87.png)\n\n#### NAT Server\n\nä¸Šé¢å‡ ç§æ–¹æ³•éƒ½æ˜¯å†…è®¿é—®å¤–ï¼Œæˆ‘ä»¬å†…ç½‘ä¸»åŠ¨å»è®¿é—®å¤–ç½‘çš„ï¼Œè€Œä¸”æœ‰äº†natæŠ€æœ¯ï¼Œå¯ä»¥ä¿æŠ¤å†…ç½‘åœ°å€ï¼Œè¿™æ ·å¤–ç½‘å°±ä¸çŸ¥é“æˆ‘ä»¬çš„å†…ç½‘åœ°å€ï¼ŒåªçŸ¥é“ä¸€ä¸ªå…¬ç½‘çš„natåœ°å€ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æœ‰ä¸€ç§æ˜¯å¤–è®¿é—®å†…çš„\n\nä¸€èˆ¬å«å®ƒç«¯å£æ˜ å°„ï¼Œæ¯”å¦‚è¯´`pc2`æ˜¯ä¸€å°æœåŠ¡å™¨ï¼Œä½ éƒ¨ç½²äº†ä¸€ä¸ªç½‘é¡µï¼Œé‚£æˆ‘ä»¬å°±æŠŠå†…ç½‘80ç«¯å£æ˜ å°„åˆ°å¤–ç½‘çš„80ç«¯å£ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡å…¬ç½‘ï¼š80è®¿é—®åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨\n\n```\nsystem-view \nun in en\ninterface GigabitEthernet 0/0/1\nnat server protocol tcp global 12.1.1.2 80 inside 192.168.1.2 80\n```\n\n![image-20250318210001319](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/ccd286f3c509a6b5f2ce21aa7da5e80c697559838-1742488602420-85.png)\n\n\n\n## VRRP\n\n### VRRPæ¦‚è¿°ä¸åŸç†\n\nVRRPæŠ€æœ¯èƒŒæ™¯ï¼šå•ç½‘å…³é¢ä¸´çš„é—®é¢˜\n\n![image-20250319173330233](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319173330233-1742488602420-86.png)\n\n#### VRRPæ¦‚è¿°\n\n![image-20250319173834567](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319173834567-1742488602420-89.png)\n\n#### VRRPçš„åŸºæœ¬æ¦‚å¿µ\n\n![image-20250319174016874](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319174016874-1742488602420-88.png)\n\n![image-20250319174101349](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319174101349-1742488602420-91.png)\n\n![image-20250319174113230](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319174113230-1742488602420-90.png)\n\n\n\n### VRRPå…¸å‹åº”ç”¨\n\n#### VRRPè´Ÿè½½åˆ†æ‹…\n\n![image-20250319174351202](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319174351202-1742488602420-92.png)\n\n#### VRRPä¸MSTPç»“åˆåº”ç”¨\n\n![image-20250319174434581](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319174434581-1742488602421-94.png)\n\n#### VRRPç›‘è§†ä¸Šè¡Œç«¯å£\n\n![image-20250319174648770](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319174648770-1742488602421-96.png)\n\n#### VRRPä¸BFDè”åŠ¨\n\n![image-20250319174716503](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319174716503-1742488602421-95.png)\n\n\n\n### VRRPåŸºæœ¬é…ç½®\n\n![image-20250319175248301](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319175248301-1742488602421-98.png)\n\n![image-20250319175257510](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319175257510-1742488602421-97.png)\n\n![image-20250319175322038](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319175322038-1742488602421-99.png)\n\n![image-20250319175359962](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250319175359962-1742488602421-100.png)\n\n### VRRPæ¡ˆä¾‹\n\n![image-20250320234251076](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250320234251076-1742488602421-101.png)\n\nè®¾ç½®pc\n\n![image-20250320191357273](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/329218117f9d3bd3febaff437a01e876697559838.png)\n\n`acsw`\n\n```\nsystem-view\nun in en\nsysname acsw\nvlan 10\ninterface GigabitEthernet 0/0/3\nport link-type access\nport default vlan 10\ninterface GigabitEthernet 0/0/1\nport link-type trunk\nport trunk allow-pass vlan all\ninterface GigabitEthernet 0/0/2\nport link-type trunk\nport trunk allow-pass vlan all\n```\n\n`coresw1`\n\n```\nsystem-view\nun in en\nsysname coresw1\nvlan batch 10 100\ninterface GigabitEthernet 0/0/1\nport link-type trunk\nport trunk allow-pass vlan all\ninterface GigabitEthernet 0/0/3\nport link-type trunk\nport trunk allow-pass vlan all\ninterface GigabitEthernet 0/0/2\nport link-type access\nport default vlan 100\n\ninterface vlanif 10\nip address 192.168.10.252 24\ninterface vlanif 100\nip address 192.168.100.1 30\n```\n\n`coresw2`\n\n```\nsystem-view\nun in en\nsysname coresw2\nvlan batch 10 200\ninterface GigabitEthernet 0/0/1\nport link-type trunk\nport trunk allow-pass vlan all\ninterface GigabitEthernet 0/0/3\nport link-type trunk\nport trunk allow-pass vlan all\ninterface GigabitEthernet 0/0/2\nport link-type access\nport default vlan 200\n\ninterface Vlanif 10\nip address 192.168.10.253 24\ninterface Vlanif 200\nip address 192.168.200.1 30\n```\n\n`é…ç½®VRRP`\n\n`coresw1`\n\n```\ninterface Vlanif 10\nvrrp vrid 10 virtual-ip 192.168.10.254 \nvrrp vrid 10 priority 120\nvrrp vrid 10 preempt-mode timer delay 20\n```\n\n`coresw2`\n\nè¿™é‡Œå°±é…ç½®ä¼˜å…ˆçº§äº†ï¼Œé»˜è®¤100\n\n```\ninterface Vlanif 10\nvrrp vrid 10 virtual-ip 192.168.10.254 \n```\n\n\n\n![image-20250320191126645](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/9f8fee4f597666f0bd292ce1b860d6d5697559838.png)\n\n`AR1é…ç½®ipåœ°å€`\n\n```\nsystem-view\nsysname AR1\nun in en\ninterface GigabitEthernet 0/0/0\nip address 100.1.1.2 30\ninterface GigabitEthernet 0/0/1\nip address 192.168.100.2 30\ninterface GigabitEthernet 0/0/2\nip address 192.168.200.2 30\n```\n\n`äº’è”ç½‘é…ç½®ipåœ°å€`\n\n```\nsystem-view\nsysname hlw\nun in en\ninterface GigabitEthernet 0/0/0\nip address 100.1.1.1 30\n```\n\n\n\n`æµ‹è¯•pc1æ˜¯å¦èƒ½ä¸äº’è”ç½‘äº’é€š`\n\n![image-20250320234659976](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250320234659976-1742488602421-102.png)\n\nå‘ç°ä¸èƒ½äº’é€šï¼Œç»tracertæ£€æµ‹ï¼Œè·¯ç”±åªåˆ°äº†coresw1ï¼Œè¿™æ—¶å€™æŸ¥çœ‹coresw1çš„è·¯ç”±è¡¨\n\n![image-20250320234807138](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250320234807138-1742488602421-103.png)\n\nå‘ç°å¹¶æ²¡æœ‰æŒ‡å‘100.1.1.0/30ç½‘æ®µçš„è·¯ç”±ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–åªåœç•™åœ¨äº†coresw1ï¼Œè¿™æ—¶å€™å¯ä»¥é…ä¸€ä¸ªé»˜è®¤è·¯ç”±ï¼Œå°†æ‰€æœ‰æµé‡æŒ‡å‘AR1çš„å…¥æ¥å£ï¼Œä¸¤ä¸ªæ ¸å¿ƒäº¤æ¢æœºéƒ½è¦æŒ‡å‘å‡ºå£è·¯ç”±å™¨AR1\n\ncoresw1\n\n```\nip route-static 0.0.0.0 0 192.168.100.2\n```\n\ncoresw2\n\n```\nip route-static 0.0.0.0 0 192.168.200.2\n```\n\n\n\n`æµ‹è¯•pc1æ˜¯å¦èƒ½ä¸äº’è”ç½‘äº’é€š`\n\n![image-20250320235341346](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250320235341346-1742488602421-104.png)\n\n![image-20250320235823347](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250320235823347-1742488602421-105.png)\n\nç»“è®ºï¼šæŠ“åŒ…ä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼Œè·¯ç”±å¯ä»¥åˆ°è¾¾äº’è”ç½‘ï¼Œä½†æ˜¯äº’è”ç½‘æ²¡æœ‰è¿”ç¨‹è·¯ç”±ä¹Ÿå°±æ˜¯pc1çš„è·¯ç”±ï¼Œé‚£å°±è¦ç»™äº’è”ç½‘é…ç½®è¿”ç¨‹è·¯ç”±æŒ‡å‘AR1çš„å¦‚æ¥å£\n\n`hlw`\n\n```\nip route-static 192.168.10.0 24 100.1.1.2 \n```\n\n\n\n`æµ‹è¯•pc1æ˜¯å¦èƒ½ä¸äº’è”ç½‘äº’é€š`\n\n![image-20250321000345253](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321000345253-1742488602421-106.png)\n\nç»“è®ºï¼šè¿”ç¨‹è·¯ç”±192.168.10.0åˆ°äº†AR1ï¼ŒæŸ¥è¯¢è‡ªå·±çš„è·¯ç”±è¡¨æ²¡æœ‰è¿™ä¸ªè¡¨é¡¹å°±ä¸¢å¼ƒäº†ï¼Œæ‰€ä»¥è¦åœ¨AR1é…ç½®é™æ€è·¯ç”±æŒ‡å‘coresw1ï¼Œè€Œä¸”ä¹Ÿè¦æŒ‡å‘coresw2\n\n`AR1`\n\n```\nip route-static 192.168.10.0 24 192.168.100.1\nip route-static 192.168.10.0 24 192.168.200.1\n```\n\n\n\n`æµ‹è¯•pc1æ˜¯å¦èƒ½ä¸äº’è”ç½‘äº’é€š`\n\n![image-20250321000754057](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321000754057-1742488602421-107.png)\n\n\n\n`æµ‹è¯•ç»™coresw1è®¾ç½®åˆ°90ä¼˜å…ˆçº§`\n\n```\ninterface vlanif10\nvrrp vrid 10 priority 90\n```\n\n![image-20250321001911438](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321001911438-1742488602421-108.png)\n\n\n\n`æµ‹è¯•å»¶è¿ŸæŠ¢å `\n\nå½“ä¼˜å…ˆçº§å˜å›120æ—¶ï¼Œcoresw1å¹¶æ²¡æœ‰é‚£ä¹ˆå¿«è¿›è¡ŒæŠ¢å ï¼Œå› ä¸ºå‰é¢é…ç½®äº†ä¸€ä¸ª20ç§’çš„å»¶è¿Ÿï¼Œç­‰å»¶è¿Ÿè¿‡åï¼Œå°±ä¼šå˜å›master\n\n```\nvrrp vrid 10 preempt-mode timer delay 20\n```\n\n![image-20250321002210996](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321002210996-1742488602421-109.png)\n\n\n\n`æµ‹è¯•ç›‘è§†ä¸Šè¡Œæ¥å£`\n\n`coresw1`\n\nç›‘è§†g0/0/2ï¼Œå¦‚æœg0/0/2  downæ‰äº†ï¼Œé‚£ä¹ˆcoresw1çš„ä¼˜å…ˆçº§å°±ä¼šå‡30å˜æˆ90ï¼Œåˆ™coresw2çš„ä¼˜å…ˆçº§é»˜è®¤å°±æ˜¯100å°±ä¼šå¤§äºcoresw1ï¼Œå˜æˆmaster\n\n```\ninterface vlanif10\nvrrp vrid 10 track interface g0/0/2 reduced 30\ninterface GigabitEthernet 0/0/2\nshutdown\n```\n\n![image-20250321003422229](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321003422229-1742488602421-110.png)\n\n## æµ®åŠ¨è·¯ç”±ä¸BFDç›‘è§†\n\nç›®çš„ï¼šåœ¨å‡ºå£è·¯ç”±å™¨é…ç½®é»˜è®¤è·¯ç”±æŒ‡å‘è”é€šå’Œç”µä¿¡ï¼Œä¸»è¦å®ç°ï¼Œå½“ç”µä¿¡æŒ‚äº†ï¼Œé»˜è®¤è·¯ç”±å°±ä¼šæŒ‡å‘ç”µä¿¡è·¯ç”±å™¨ï¼Œä»¥æ­¤è¾¾åˆ°æµ®åŠ¨è·¯ç”±çš„ç›®çš„\n\n![image-20250321194128757](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321194128757.png)\n\n### é…ç½®IPåœ°å€\n\n`route`2000\n\n```\nsystem-view\nsysname route\nun in en\ninterface GigabitEthernet 0/0/0\nip address 192.168.10.254 24\ninterface GigabitEthernet 0/0/1\nip address 192.168.20.254 24\ninterface GigabitEthernet 0/0/2\nip address 12.1.1.1 30\ninterface GigabitEthernet 4/0/0\nip address 13.1.1.1 30\n```\n\n`dianxin`2001\n\n```\nsystem-view\nsysname dianxin\nun in en\ninterface GigabitEthernet 0/0/0\nip address 12.1.1.2 30\ninterface GigabitEthernet 0/0/1\nip address 100.1.1.1 30\n```\n\n`liantong`2002\n\n```\nsystem-view\nsysname liantong\nun in en\ninterface GigabitEthernet 0/0/0\nip address 13.1.1.2 30\ninterface GigabitEthernet 0/0/1\nip address 200.1.1.1 30\n```\n\n`äº’è”ç½‘`2003\n\n```\nsystem-view\nsysname hlw\nun in en\ninterface GigabitEthernet 0/0/0\nip address 100.1.1.2 30\ninterface GigabitEthernet 0/0/1\nip address 200.1.1.2 30\ninterface LoopBack 0\nip address 22.22.22.22 32\n```\n\n### é…ç½®OSPF\n\n`dianxingï¼Œäº’è”ç½‘ï¼Œliantong`\n\nè¿™æ ·åšçš„ç›®çš„ï¼Œä¼šæŠŠè‡ªå·±ç›´è¿çš„è·¯ç”±å®£å‘Šå‡ºå»\n\n```\nospf 1\narea 0\nnetwork 0.0.0.0 0.0.0.0\nq\ndis ospf peer brief\n```\n\n![image-20250321201250406](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321201250406.png)\n\n![image-20250321201323819](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321201323819.png)\n\nç”µä¿¡è·¯ç”±å™¨ï¼Œå·²ç»å­¦åˆ°äº†ospfåŒºåŸŸå†…è®¾å¤‡çš„ç›´è¿è·¯ç”±ï¼Œå…¶ä»–è®¾å¤‡ä¹Ÿä¸€æ ·\n\n### é…ç½®nat\n\næ¥ç€ï¼Œåœ¨routeï¼ˆè§’è‰²ï¼šå‡ºå£è·¯ç”±å™¨ï¼‰é…ç½®natï¼Œå‡è®¾ä»–ä¸å…·å¤‡å›ºå®šçš„å…¬ç½‘ipåœ°å€ï¼ŒæŠŠå†…ç½‘è·¯ç”±è½¬æ¢åˆ°å‡ºæ¥å£\n\n`route`\n\n```\nacl 2000\nrule 10 permit source 192.168.10.0 0.0.0.255\nrule 20 permit source 192.168.20.0 0.0.0.255\nq\ninterface GigabitEthernet 0/0/2\nnat outbound 2000\ninterface GigabitEthernet 4/0/0\nnat outbound 2000\n```\n\nè¿˜è¦é…ä¸¤æ¡é™æ€è·¯ç”±æŒ‡å‘è¿è¥å•†ï¼Œè€ƒç‚¹ï¼šå‡ºå£è·¯ç”±å™¨éƒ½è¦é…ç½®é»˜è®¤è·¯ç”±\n\n```\nip route-static 0.0.0.0 0 12.1.1.2\nip route-static 0.0.0.0 0 13.1.1.2\n```\n\n![image-20250321202432474](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321202432474.png)\n\nç”±äºæˆ‘ä½¿ç”¨çš„è·¯ç”±å™¨æ˜¯AR2000ç³»åˆ—çš„ï¼Œä¸­ä½ç«¯è·¯ç”±å™¨ï¼Œä»–æ˜¯ä¸æ”¯æŒåŸºäºåŒ…æ¥åšæµé‡çš„è´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥ï¼Œå½“è¿›è¡Œtracert 22.22.22.22ä½ ä¼šå‘ç°ï¼Œä»–çš„æ¯ä¸€æ¬¡è·¯å¾„éƒ½æ˜¯èµ°è”é€šçš„ï¼Œäº†è§£ä¸€ä¸‹å°±è¡Œäº†\n\n### é…ç½®æµ®åŠ¨è·¯ç”±\n\nåŸå…ˆé…ç½®äº†ä¸¤æ¡ç­‰ä»·è·¯ç”±ï¼Œç°åœ¨ä¸ºäº†è¾¾åˆ°ï¼Œå¼€å¤´çš„ç›®çš„ï¼Œå°±å¿…é¡»å…ˆæŠŠèµ°å‘è”é€šçš„è·¯ç”±å™¨çš„ä¼˜å…ˆçº§è°ƒé«˜ï¼Œè¿™æ ·è¶Šå°è¶Šä¼˜å…ˆï¼Œå°±ä¼šèµ°å‘ç”µä¿¡è·¯ç”±å™¨\n\n`route`\n\n```\nip route-static 0.0.0.0 0 13.1.1.2 preference 100\ndis ip rou\n```\n\n![image-20250321204055539](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321204055539.png)\n\nè¿™æ—¶å€™ä½ ä¼šå‘ç°ï¼Œåªæœ‰ä¸€æ¡æŒ‡å‘ç”µä¿¡çš„è·¯ç”±äº†ï¼Œè¿™å°±æ˜¯æµ®åŠ¨è·¯ç”±ï¼Œè°ƒæˆ100çš„ä¼˜å…ˆçº§å°±ä¸ä¼˜å…ˆäº†ï¼Œå°±ä¼šè¢«éšè—èµ·æ¥ï¼Œå½“ä½ ç”µä¿¡çš„é»˜è®¤è·¯ç”±ï¼Œæ‰äº†ï¼ŒæŒ‡å‘è”é€šçš„è·¯ç”±æ‰ä¼šæ˜¾ç°å‡ºæ¥ï¼Œæ¥ä¸‹æ¥å°±æ¨¡æ‹Ÿè¿™ä¸ªæµ®åŠ¨è·¯ç”±çš„å®éªŒ\n\n```\nint g0/0/2\nshutdown\ndis ip rou\n```\n\n![image-20250321204314224](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321204314224.png)\n\nè¿™æ—¶å€™æŒ‡å‘è”é€šè·¯ç”±å°±ä¼šå‡ºæ¥ï¼Œä¿è¯äº†ä¸šåŠ¡çš„è¿ç»­æ€§\n\n```\nint g0/0/2\nundo shutdown\n```\n\n![image-20250321204414971](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321204414971.png)\n\nç­‰å‡ ç§’å°±ä¼šå›æ¥äº†\n\n\n\nè€Œä¸”ï¼Œä¸ç®¡æ˜¯ä»¥ä¸‹å›¾ç‰‡å“ªä¸ªæ¥å£downäº†ï¼Œä»–éƒ½ä¼šå®ç°æµ®åŠ¨è·¯ç”±åˆ°è”é€š\n\n![image-20250321204547809](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321204547809.png)\n\n### BFDç›‘æµ‹ç½‘ç»œçŠ¶æ€\n\n#### èƒŒæ™¯\n\nèƒŒæ™¯ï¼šæˆ‘ä»¬å‰é¢ä¸æ˜¯é…ç½®äº†æŒ‡å‘ç”µä¿¡çš„é»˜è®¤è·¯ç”±å—ï¼Œä½†æ˜¯ç°å®æƒ…å†µï¼Œä¸å¯èƒ½è¯´å‡ºå£è·¯ç”±å™¨ç›´æ¥ä¸è¿è¥å•†å»äº’è”çš„ï¼Œä¸­é—´è‚¯å®šç»è¿‡å¾ˆå¤šå±‚äº¤æ¢æœºï¼Œè·¯ç”±å™¨å•¥çš„ï¼Œç°åœ¨å°±æ¥æ¨¡æ‹Ÿè¿™ä¸ªå®éªŒï¼Œå°±ä¼šå½±å“æˆ‘ä»¬çš„æµ®åŠ¨è·¯ç”±\n\n![image-20250321205400654](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321205400654.png)\n\nè¿™æ—¶å€™å°†ç”µä¿¡è·¯ç”±å™¨çš„g0/0/0å£æ–­æ‰ï¼ŒæŸ¥çœ‹æƒ…å†µ\n\n`dianxin`\n\n```\nsys\nun in en\ninterface GigabitEthernet 0/0/0\nshutdown\n```\n\n![image-20250321205655014](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321205655014.png)\n\n### é…ç½®bfd\n\næ¥ä¸‹æ¥å°±åœ¨dianxinå’Œrouteé…ç½®bfdï¼Œæ¥è¾¾åˆ°åŒå‘æ£€æµ‹ï¼Œå¦‚æœç›‘æµ‹æ–­æ‰ä¹‹åï¼Œå°±å¯ä»¥å®ç°æµ®åŠ¨è·¯ç”±\n\n`route`\n\n```\nbfd\nbfd 1 bind peer-ip 12.1.1.2 source-ip 12.1.1.1 auto\ncommit\ndis bfd session all\n```\n\n`dianxin`\n\né…ç½®è¿™ä¸ªä¹‹å‰ï¼Œä½ è¦æŠŠåŸæ¥çš„g0/0/0æ¥å£æ‰“å¼€ï¼Œä¸ç„¶å³ä½¿åˆ›å»ºäº†è§„åˆ™ï¼Œä¹Ÿä¼šæŠ¥é”™\n\n```\nint g0/0/0\nundo shutdown\nbfd\nbfd 1 bind peer-ip 12.1.1.1 source-ip 12.1.1.2 auto\nbfd 1\ncommit\ndis bfd session all\n```\n\næ¥å£æ²¡æ‰“å¼€ï¼Œä½ é…ç½®äº†å°±ä¼šæŠ¥è¿™ä¸ªé”™ï¼Œæ¥å£å¼€å¯æ¥å°±è¡Œäº†ï¼Œæ²¡äº‹\n\n![image-20250321212105330](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321212105330.png)\n\n![image-20250321212636243](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321212636243.png)\n\næ¥ä¸‹æ¥åœ¨æŒ‡å‘ç”µä¿¡è·¯ç”±å™¨çš„é»˜è®¤è·¯ç”±é…ç½®bfdç›‘è§†ï¼Œå½“è¿™ä¸ªbfd 1çš„ç›‘è§†å™¨å‡ºç°äº†downçš„æƒ…å†µï¼Œé‚£ä¹ˆè¿™ä¸ªé»˜è®¤è·¯ç”±å°±ä¼šè¢«åˆ æ‰ï¼Œä»è€Œå®ç°æµ®åŠ¨è·¯ç”±\n\n`route`\n\n```\nip route-static 0.0.0.0 0 12.1.1.2 track bfd-session 1\n```\n\nå½“dianxinçš„g0/0/0æ¥å£æ–­æ‰ä¹‹å\n\n![image-20250321213916096](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321213916096.png)\n\nèµ°çš„æ˜¯è”é€šæœåŠ¡å™¨\n\n![image-20250321214005270](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250321214005270.png)\n\n\n\n## è·¯ç”±ç»¼åˆå®éªŒRIP OSPF BGP\n\nç›®çš„ï¼šä¸­é—´é€šè¿‡ospfæˆ–ripï¼Œç„¶åç»è¿‡bgpä¹‹é—´å­¦ä¹ è·¯ç”±ï¼Œè¾¾åˆ°PCå¯ä»¥äº’é€š\n\n![image-20250322145223208](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322145223208.png)\n\n### é…ç½®IPåœ°å€\n\n`PC1ã€PC2`\n\n![image-20250322145601647](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322145601647.png)\n\n`R1`\n\n```\nsystem-view\nsysname R1\nun in en\ninterface GigabitEthernet 0/0/0\nip address 100.1.1.254 24\ninterface GigabitEthernet 0/0/1\nip add 12.1.1.1 30\nint g0/0/2\nip add 13.1.1.1 30\ndis ip in br\n```\n\n![image-20250322173951643](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322173951643.png)\n\n`R2`\n\n```\nsys\nsysname R2\nun in en\nint g0/0/1\nip add 12.1.1.2 30\nint g0/0/2\nip add 23.1.1.1 30\ndis ip in br\n```\n\n![image-20250322174103265](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322174103265.png)\n\n`R3`\n\n```\nsys\nsysname R3\nun in en\nint g0/0/2\nip add 23.1.1.2 30\nint g0/0/1\nip add 13.1.1.2 30\nint g0/0/0\nip add 34.1.1.1 30\ndis ip in br\n```\n\n`R4`\n\n```\nsys \nsysname R4\nun in en\nint g0/0/0\nip add 34.1.1.2 30\nint g0/0/1\nip add 45.1.1.1 30\ndis ip in br\n```\n\n`R5`\n\n```\nsys \nsysname R5\nun in en\nint g0/0/0\nip add 200.1.1.254 24\nint g0/0/1\nip add 45.1.1.2 30\ndis ip in br\n```\n\n### é…ç½®RIP(ä¸osfpäºŒé€‰ä¸€)\n\né…ç½®ripå®£å‘Šç½‘æ®µæ—¶ï¼Œ`ä¾‹å¦‚`R2å®£å‘Š12.1.1.0çš„ç½‘æ®µæ—¶ï¼Œä¼šæŠ¥é”™ï¼Œä¸€èˆ¬ç”Ÿäº§ä¸­éƒ½ä¼šé…ç½®ripv2ï¼Œç”±äºä»–çš„è·¯ç”±è‡ªåŠ¨æ±‡æ€»ï¼Œä»–ä¼šæŠŠ12.1.1.0æ±‡æ€»åˆ°æ›´å¤§çš„ç½‘ç»œ12.0.0.0ï¼Œå› ä¸ºè¿™äº›åœ°å€éƒ½æ˜¯Aç±»åœ°å€ï¼Œæ‰€ä»¥ripå°±é»˜è®¤è‡ªåŠ¨æ±‡æ€»åˆ°12.0.0.0ï¼Œç›®çš„æ˜¯å‡å°‘è·¯ç”±è¡¨çš„å¤§å°ï¼Œæé«˜ç½‘ç»œçš„å¯æ‰©å±•æ€§ã€‚\n\nAç±»åœ°å€èŒƒå›´ï¼š1.0.0.0-126.0.0.0   /8\n\nBç±»åœ°å€èŒƒå›´ï¼š128.0.0.0-191.255.0.0  /16\n\nCç±»åœ°å€èŒƒå›´ï¼š192.0.0.0-223.255.255.0  /24\n\n`R1`\n\n```\nsys\nrip 1\nversion 2\nnetwork 100.0.0.0\nnetwork 12.0.0.0\nnetwork 13.0.0.0\n```\n\n`R2`\n\n```\nsys\nrip 1\nversion 2\nnetwork 12.0.0.0\nnetwork 23.0.0.0\n```\n\n`R3`\n\n```\nsys\nrip 1\nversion 2\nnetwork 13.0.0.0\nnetwork 23.0.0.0\n```\n\né…ç½®å®Œæ£€æŸ¥ä¸€ä¸‹3ä¸ªè·¯ç”±çš„è·¯ç”±è¡¨\n\n```\ndis ip rou\n```\n\n![image-20250322182520041](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322182520041.png)\n\n![image-20250322182533446](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322182533446.png)\n\n![image-20250322183010425](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322183010425.png)\n\nRIPåŒºåŸŸå†…çš„è·¯ç”±å™¨ï¼Œé€šè¿‡ripå­¦ä¹ åˆ°å„ä¸ªè·¯ç”±å™¨å®£å‘Šçš„è·¯ç”±ï¼Œä½†æ˜¯å¦‚æœå…¶ä¸­æœ‰è‡ªå·±ç›´è¿çš„è·¯ç”±ä¿¡æ¯ï¼Œå°±æ²¡æœ‰ripè·¯ç”±æ˜¾ç¤ºï¼Œæœ¬èº«å°±æ˜¯ç›´è¿çš„å˜›ï¼Œåªä¼šå­¦ä¹ åˆ°æ²¡æœ‰çš„\n\n### é…ç½®OSPF(ä¸RIPäºŒé€‰ä¸€)\n\nç”±äºæˆ‘å‰é¢é…ç½®äº†ripï¼Œè¿™é‡Œè¦æ¼”ç¤ºospfæˆ‘å°±åˆ æ‰å‰é¢çš„ripé…ç½®ï¼Œå¦‚æœä½ æ²¡æœ‰æ•²å‰é¢çš„ripå°±ä¸ç”¨æ‰§è¡Œä¸‹é¢çš„åˆ é™¤ripé…ç½®çš„å‘½ä»¤\n\n`R1,R2,R3`\n\n```bash\nsys\nundo rip 1\n#ä¼šæç¤ºä½ æ˜¯å¦åˆ é™¤ï¼Œä½ è¾“å…¥Yå°±è¡Œäº†\nWarning: The RIP process will be deleted. Continue?[Y/N]y\n```\n\næ¥ä¸‹æ¥æ­£å¼é…ç½®ospf,å®ƒå®£å‘Šç½‘æ®µçš„æ–¹å¼å’Œripæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¦åŠ ä¸Šåæ©ç ï¼Œè€Œä¸”æ²¡æœ‰ripçš„è‡ªåŠ¨æ±‡æ€»ï¼Œæ˜¯å¯ä»¥ç›´æ¥å†™ç½‘æ®µçš„\n\n\n\n`R1`\n\n```\nsys\nospf 1\narea 0\nnetwork 100.1.1.0 0.0.0.255\nnetwork 13.1.1.0 0.0.0.3\nnetwork 12.1.1.0 0.0.0.3\n```\n\n`R2`\n\n```\nsys\nospf 1\narea 0\nnetwork 23.1.1.0 0.0.0.3\nnetwork 12.1.1.0 0.0.0.3\n```\n\n`R3`\n\n```\nsys\nospf 1\narea 0\nnetwork 23.1.1.0 0.0.0.3\nnetwork 13.1.1.0 0.0.0.3\n```\n\n\n\n```\ndis ospf peer brief\n```\n\n![image-20250322184011046](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322184011046.png)\n\n![image-20250322184019062](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322184019062.png)\n\n![image-20250322184038280](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322184038280.png)\n\nè¿™æ—¶å€™æŸ¥çœ‹è·¯ç”±è¡¨\n\n```\ndis ip rou\n```\n\n![image-20250322184227091](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322184227091.png)\n\n![image-20250322184230947](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322184230947.png)\n\n![image-20250322184234155](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322184234155.png)\n\nospfä¹Ÿå’Œripä¸€æ ·ï¼Œå°±å¯ä»¥å­¦ä¹ åˆ°å…¶ä»–è·¯ç”±å™¨å®£å‘Šçš„ï¼Œéç›´è¿çš„è·¯ç”±\n\n\n\nä»¥ä¸Šæ˜¯RIPå’ŒOSPFçš„é…ç½®è¿‡ç¨‹ï¼Œå°±æ˜¯äº†é…ç½®IGPåè®®è¿›è¡Œä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿï¼ˆASï¼‰å†…éƒ¨äº¤æ¢è·¯ç”±ä¿¡æ¯çš„åè®®\n\nIGPå¯ä»¥è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºä¸¤ç±»ï¼šè·ç¦»çŸ¢é‡è·¯ç”±åè®®å’Œé“¾è·¯çŠ¶æ€è·¯ç”±åè®®ã€‚å¸¸è§çš„IGPåè®®åŒ…æ‹¬RIPï¼ˆè·¯ç”±ä¿¡æ¯åè®®ï¼‰ã€OSPFï¼ˆå¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼‰å’ŒIS-ISï¼ˆä¸­é—´ç³»ç»Ÿåˆ°ä¸­é—´ç³»ç»Ÿï¼‰ç­‰ã€‚\n\n- **RIP**ï¼šä½¿ç”¨è·³æ•°ä½œä¸ºè·¯å¾„é€‰æ‹©çš„åº¦é‡æ ‡å‡†ï¼Œé€‚ç”¨äºå°å‹ç½‘ç»œã€‚\n- **OSPF**ï¼šåŸºäºé“¾è·¯çŠ¶æ€çš„åè®®ï¼Œä½¿ç”¨Dijkstraç®—æ³•æ¥è®¡ç®—æœ€çŸ­è·¯å¾„ï¼Œé€‚ç”¨äºä¸­å‹åˆ°å¤§å‹ç½‘ç»œã€‚\n- **IS-IS**ï¼šä¹Ÿæ˜¯ä¸€ç§åŸºäºé“¾è·¯çŠ¶æ€çš„åè®®ï¼Œç±»ä¼¼äºOSPFï¼Œé€šå¸¸ç”¨äºISPå’Œå¤§å‹ä¼ä¸šç½‘ç»œä¸­ã€‚\n\n### é…ç½®bgp\n\n- **BGP**ï¼šè¾¹ç•Œç½‘å…³åè®®ï¼ˆBorder Gateway Protocolï¼‰æ˜¯ä¸€ç§å…·ä½“çš„å¤–éƒ¨ç½‘å…³åè®®ï¼Œæ˜¯EGPçš„ä¸€ç§å®ç°ã€‚BGPæ˜¯äº’è”ç½‘ä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„å¤–éƒ¨ç½‘å…³åè®®ï¼Œç”¨äºåœ¨è‡ªæ²»ç³»ç»Ÿä¹‹é—´è¿›è¡Œè·¯ç”±ä¿¡æ¯äº¤æ¢ã€‚å–ä»£`EGP`\n\n`R3` ä»–åœ¨BGP AS 100 ,è¦å¡«å†™é¢†å±…ä¹Ÿå°±æ˜¯å¯¹ç«¯çš„ä¿¡æ¯ï¼Œæ„å»ºé¢†å±…å…³ç³»\n\n```\nsys\nbgp 100\npeer 34.1.1.2 as-number 200\n```\n\n`R4`\n\n```\nsys\nbgp 200\npeer 34.1.1.1 as-number 100\npeer 45.1.1.2 as-number 200\n```\n\n`R4`\n\n```\nsys\nbgp 200\npeer 45.1.1.1 as-number 200\n```\n\nç­‰å¾…ç‰‡åˆ»ï¼ŒæŸ¥çœ‹R4æ˜¯å¦ä¸R3å’ŒR5å»ºç«‹é¢†å±…å…³ç³»\n\n![image-20250322200223520](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322200223520.png)\n\nEstablishedç›¸å½“äºospfçš„fullï¼Œå›¾ä¸­å·²ç»æˆåŠŸå»ºç«‹äº†ï¼ŒæŸ¥çœ‹R4çš„è·¯ç”±è¡¨\n\n```\ndis ip rou\n```\n\n![image-20250322200357923](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322200357923.png)\n\nè¿™æ—¶å€™å¹¶æ²¡æœ‰bgpçš„è·¯ç”±ï¼Œä¸ºå•¥ï¼Œå› ä¸ºbgpçš„ç‰¹æ®Šæ€§ï¼Œéœ€è¦æ‰‹åŠ¨å®£å‘Šå’Œå°†å…¶ä»–è·¯ç”±å™¨å­¦åˆ°çš„è·¯ç”±å¯¼å…¥åˆ°æœ¬è·¯ç”±å™¨æ‰è¡Œ\n\n`æ¥ä¸‹æ¥ä¼šæ¼”ç¤ºä¸¤ç§æ–¹æ³•`\n\n### æ‰‹åŠ¨å®£å‘Šè·¯ç”±\n\n`R5`å°†200.1.1.0çš„ç½‘æ®µå®£å‘Šè¿›IBGPé‡Œï¼Œåœ¨BGPä¸­ï¼Œé€šè¿‡`ipv4-family unicast`å‘½ä»¤è¿›å…¥IPv4å•æ’­åœ°å€æ—è§†å›¾åï¼Œå¯ä»¥ä½¿ç”¨`network`å‘½ä»¤æ¥å®£å‘Šå“ªäº›IPv4ç½‘ç»œå°†è¢«åŠ å…¥åˆ°BGPçš„è·¯ç”±è¡¨ä¸­ï¼Œå¹¶å‘å…¶ä»–BGPå¯¹ç­‰ä½“å‘å¸ƒã€‚è¿™æ ·å…¶ä»–bgpè·¯ç”±å™¨å°±å¯ä»¥å­¦ä¹ åˆ°è¿™ä¸ªç½‘æ®µ\n\n```\nsys\nbgp 200\nipv4-family unicast\nnetwork 200.1.1.0 24\n```\n\n![image-20250322201454338](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322201454338.png)\n\n![image-20250322201511836](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322201511836.png)\n\nä¸€çœ‹ï¼ŒR3å’ŒR4éƒ½å­¦åˆ°äº†è¿™ä¸ªè·¯ç”±\n\n### å¼•è¿›è·¯ç”±\n\né¦–å…ˆæˆ‘ä»¬å¯ä»¥å…ˆï¼Œpcå„è‡ªçš„ç½‘å…³ï¼Œæ˜¯å¦æœ‰å¯¹æ–¹ç½‘æ®µçš„è·¯ç”±\n\n```\ndis ip rou\n```\n\n![image-20250322201737800](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322201737800.png)\n\n![image-20250322201816368](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322201816368.png)\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œpc1æ— æ³•ping   pc2çš„ï¼Œå„è‡ªçš„ç½‘å…³éƒ½æ²¡æœ‰å¯¹ç«¯çš„è·¯ç”±ã€‚\n\n`ä½†æ˜¯R3åˆšåˆšä¸æ˜¯ç»è¿‡R5æ‰‹åŠ¨å®£å‘Šè·¯ç”±å­¦åˆ°äº†200.1.1.0çš„è·¯ç”±å—ï¼Œè¿™æ˜¯R3è¦å°†å³è¾¹å­¦åˆ°çš„bgpè·¯ç”±ä¿¡æ¯å¼•å…¥åˆ°ospfé‡Œ`\n\n```\nsys\nospf 1\nimport-route bgp\n```\n\nå¦‚æœæ˜¯`rip`ï¼Œå°±è¿›å…¥åˆ°`rip` `version2`é‡Œä¸€æ ·çš„è¾“å…¥`import-route bgp`\n\n\n\nè¿™æ—¶å€™æŸ¥çœ‹R1çš„è·¯ç”±è¡¨,å·²ç»å­¦ä¹ åˆ°äº†200çš„è·¯ç”±äº†\n\n```\ndis ip rou\n```\n\n![image-20250322202705651](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322202705651.png)\n\nä½†æ˜¯æˆ‘ä»¬pc1è¦pingåˆ°pc2ï¼Œpc2çš„ç½‘å…³R5æ²¡æœ‰100çš„è·¯ç”±å•Šï¼Œæ˜¯pingä¸äº†çš„\n\n```\ndis ip rou\n```\n\n![image-20250322202813067](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322202813067.png)\n\næ‰€ä»¥æˆ‘ä»¬è¦åœ¨R3ä¸Šï¼Œå°†ospf è¿›ç¨‹1çš„è·¯ç”±å¼•å…¥åˆ°bgpé‡Œ\n\n```\nsys\nbgp 100\nimport-route ospf 1\n```\n\næŸ¥çœ‹R4,R5çš„è·¯ç”±è¡¨ï¼Œå‘ç°ä¸‹ä¸€è·³ä¸å¯è¾¾åˆ°ï¼Œå°±æ²¡åŠæ³•åŠ å…¥åˆ°R5çš„è·¯ç”±è¡¨\n\n![image-20250322203345526](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322203345526.png)\n\nè¿™æ—¶å€™æœ‰ä¸¤ä¸ªåŠæ³•ï¼Œä¸€ä¸ªæ˜¯é…ç½®R5é…ç½®é™æ€è·¯ç”±æŒ‡å‘34.1.1.0ç½‘æ®µæˆ–è€…R4åœ¨bgpé‡Œè®¾ç½®R5çš„ä¸‹ä¸€è·³ä¸º45.1.1.2å£\n\n`ç¬¬ä¸€ç§R5`\n\n```\nip route-static 34.1.1.0 30 45.1.1.1\n```\n\nè¿™æ—¶å€™å°±èƒ½å­¦åˆ°100çš„è·¯ç”±äº†\n\n![image-20250322204241998](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322204241998.png)\n\n`ç¬¬äºŒç§R4`\n\n`R5`åˆ é™¤é™æ€è·¯ç”±\n\n```\nundo ip route-static 34.1.1.0 30 45.1.1.1\n```\n\n`R4`\n\n```\nbgp 200\npeer 45.1.1.2 next-hop-local\n```\n\n![image-20250322205004482](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322205004482.png)\n\nè¿™æ—¶å€™R5å·²ç»å­¦åˆ°100çš„è·¯ç”±äº†\n\nè¿™é‡Œå°±æœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆæˆ‘é…ç½®çš„æ˜¯å•¥45.1.1.2ä¸ºä¸‹ä¸€è·³ï¼Œè€Œè¡¨é‡Œæ˜¾ç¤ºçš„45.1.1.1\n\nå› ä¸º45.1.1.2æŒ‡çš„æ˜¯R4è¿™ä¸ªIBGPé‡Œçš„bgpå¯¹ç­‰ä½“ï¼Œå°±æ˜¯ç›´æ¥æŠŠ45.1.1.2å½“åšäº†R4ï¼Œç»è¿‡R4é…ç½®äº†`peer 45.1.1.2 next-hop-local`é‚£ä¹ˆR4åœ¨æŠŠè‡ªå·±å­¦åˆ°çš„ospfé‡Œè·¯ç”±é€šå‘Šç»™R5æ—¶ï¼Œä¼šæŠŠR5é‡Œçš„ä¸‹ä¸€è·³æ”¹æˆè‡ªå·±R4æ¥å£ï¼ˆ45.1.1.1ï¼‰\n\n### éªŒè¯pcäº’é€š\n\n![image-20250322205703235](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322205703235.png)\n\n![image-20250322210350150](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322210350150.png)\n\nå½“æˆ‘ä»¬å¯¹R1çš„g0/0/2è¿›è¡Œæ–­å¼€ä¹‹å\n\n`R1`\n\n```\nsys\nint g0/0/2\nshutdown\n```\n\n![image-20250322210533979](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250322210533979.png)\n\nè¿™æ—¶å€™å°±ä¼šå¤šäº†ä¸¤æ¡è·¯å¾„ï¼Œå°±æ˜¯èµ°çš„æ˜¯R2\n\nå®éªŒæˆåŠŸ\n\n## ç»¼åˆå®éªŒ[DHCP NAT BFD ç­–ç•¥è·¯ç”±ç­‰]\n\n![image-20250323103753645](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323103753645.png)\n\n![image-20250323103812923](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323103812923.png)\n\n### é…ç½®IPåœ°å€å’Œvlanï¼Œdhcp\n\n![image-20250323120523126](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323120523126.png)\n\n`acsw`\n\n```\nsystem-view\nsysname acse\nundo info-center enable\nvlan batch 10 20\ninterface GigabitEthernet 0/0/1\nport link-type access\nport default vlan 10\ninterface GigabitEthernet 0/0/2\nport link-type access\nport default vlan 20\ninterface GigabitEthernet 0/0/3\nport link-type trunk\nport trunk allow-pass vlan 10 20\n```\n\n`coresw`\n\n```\nsystem-view\nsysname coresw\nundo info-center enable\nvlan batch 10 20 30\ninterface GigabitEthernet 0/0/3\nport link-type trunk\ninterface GigabitEthernet 0/0/1\nport link-type access\nport default vlan 30\ninterface vlanif 10 \nip address 192.168.10.254 24\ninterface vlanif 20\nip address 192.168.20.254 24\ninterface vlanif 30\nip address 192.168.30.254 24\n```\n\n`coresw`\n\né…ç½®dhcpæœåŠ¡å™¨\n\næ’é™¤192.168.10.2-192.168.10.253ï¼Œå› ä¸ºæˆ‘ä»¬pc1åªæœ‰ä¸€å°å˜›ï¼Œæˆ‘ä»¬åªæƒ³è®©ä»–åˆ†é…ä¸€ä¸ªåœ°å€\n\n```\ndhcp enable\nip pool 10\nnetwork 192.168.10.0 mask 24\ngateway-list 192.168.10.254\ndns-list 8.8.8.8\nlease day 8\nexcluded-ip-address 192.168.10.2 192.168.10.253\ninterface vlanif10\ndhcp select global\nq\nip pool 20\nnetwork 192.168.20.0 mask 24\ngateway-list 192.168.20.254\ndns-list 114.114.114.114\nlease day 8\nexcluded-ip-address 192.168.20.2 192.168.20.253\ninterface vlanif20\ndhcp select global\n```\n\n![image-20250323122732359](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323122732359.png)\n\nä¹Ÿèƒ½äº’é€š\n\n![image-20250323122823171](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323122823171.png)\n\n\n\npc1  ping pc2çš„è¿‡ç¨‹\n\n1.é¦–å…ˆåˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€ç½‘æ®µ\n\nå¾ˆæ˜æ˜¾ä¸åœ¨åŒä¸€ç½‘æ®µï¼Œé‚£ä¹ˆacswå°±ä¼šæŠŠè·¯ç”±äº¤ç»™ç½‘å…³ï¼ˆæ ¸å¿ƒäº¤æ¢æœºcoreswï¼‰\n\n2.é‚£ä¹ˆæ ¸å¿ƒäº¤æ¢æœºå°±ä¼šæŸ¥è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œå‘ç°æœ‰ç›®çš„ç½‘æ®µï¼Œå°±ä¼šæŠŠæµé‡è½¬å‘è¿‡å»\n\n![image-20250323123728575](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323123728575.png)\n\n\n\n`route`\n\n```\nsystem-view\nsysname route\nun in en\nint g0/0/1\nip address 192.168.30.3 24\nint g0/0/0\nip address 12.1.1.3 24\nint g0/0/2\nip address 23.1.1.3 24\n```\n\n`dianxin`\n\n```\nsystem-view\nsysname dianxin\nun in en\nint g0/0/1\nip address 100.1.1.1 24\nint g0/0/0\nip address 12.1.1.1 24\n```\n\n`liantong`\n\n```\nsystem-view\nsysname liantong\nun in en\nint g0/0/1\nip address 100.1.1.2 24\nint g0/0/2\nip address 23.1.1.2 24\n```\n\n### é…ç½®é™æ€è·¯ç”±æˆ–åŠ¨æ€è·¯ç”±(ä¸‰é€‰ä¸€)\n\n`èƒŒæ™¯`\n\næ­¤æ—¶æµ‹è¯•pc1 ping route\n\n![image-20250323131210827](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323131210827.png)\n\nå› ä¸ºæµé‡è™½ç„¶èƒ½åˆ°routeä½†æ˜¯æ²¡æœ‰è¿”ç¨‹è·¯ç”±ï¼Œå°±pingä¸é€š\n\n![image-20250323131144208](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323131144208.png)\n\nä»¥ä¸‹æœ‰ä¸‰ç§æ–¹æ³•ä¸‰é€‰ä¸€\n\n#### é™æ€è·¯ç”±\n\nè¿™æ—¶å€™è¦é…ç½®é™æ€ipæŒ‡å‘10ç½‘æ®µçš„è·¯ç”±ï¼Œä¸‹ä¸€è·³æ˜¯192.168.30.254\n\n`route`\n\n```\nip route-static 192.168.10.0 24 192.168.30.254\n```\n\n![image-20250323131613744](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323131613744.png)\n\npc1èƒ½pingé€šrouteäº†\n\n![image-20250323132429655](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323132429655.png)\n\nè¿™æ˜¯pc2ä¹Ÿä¸èƒ½pingäº†\n\n![image-20250323132503313](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323132503313.png)\n\nè¿™æ—¶å€™ä¹Ÿè¦é…ä¸€ä¸ªé™æ€è·¯ç”±æŒ‡å‘20çš„ç½‘æ®µ\n\n```\nip route-static 192.168.20.0 24 192.168.30.254\n```\n\n![image-20250323132546647](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323132546647.png)\n\n#### é…ç½®Rip\n\n`route`\n\n```\nrip 1\nversion 2\nnetwork 192.168.30.0\n```\n\n`coresw`\n\n```\nrip 1\nversion 2\nnetwork 192.168.10.0\nnetwork 192.168.20.0\nnetwork 192.168.30.0\n```\n\nè¿™æ—¶å€™routeé€šè¿‡coreswå®£å‘Šçš„è·¯ç”±å­¦ä¹ åˆ°äº†10å’Œ20åˆ°ç½‘æ®µé‡Œ\n\n![image-20250323133857310](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323133857310.png)\n\n![image-20250323133935002](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323133935002.png)\n\nä¸¤ä¸ªéƒ½èƒ½pingé€š\n\n#### é…ç½®ospf\n\n`route`\n\n```\nsys\nospf 1\narea 0\nnetwork 192.168.30.0 0.0.0.255\n```\n\n`coresw`\n\n```\nsys\nospf 1\narea 0\nnetwork 192.168.10.0 0.0.0.255\nnetwork 192.168.20.0 0.0.0.255\nnetwork 192.168.30.0 0.0.0.255\n```\n\nç°åœ¨äºŒè€…å·²ç»æ„å»ºäº†é¢†å±…å…³ç³»\n\n![image-20250323134421654](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323134421654.png)\n\nè¿™æ—¶å€™routeå·²ç»é€šè¿‡ospfå­¦ä¹ åˆ°äº†è·¯ç”±\n\n![image-20250323134456759](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323134456759.png)\n\n![image-20250323134540394](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323134540394.png)\n\n\n\n### é…ç½®è¿è¥å•†ä¹‹é—´çš„åŠ¨æ€è·¯ç”±\n\nç”µä¿¡è·¯ç”±å™¨å’Œè”é€šè·¯ç”±å™¨é…ç½®ç¯å›å£ï¼Œç›¸å½“äºï¼Œå„ç§æ¥äº†ä¸€å°æœåŠ¡å™¨\n\n`dianxin`\n\n```\nsys\nint loopback 0\nip address 1.1.1.1 24\n```\n\n`liantong`\n\n```\nsys\nint loopback 0\nip address 2.2.2.2 24\n```\n\nç”±äºæˆ‘ä»¬åœ¨æµ‹è¯•ï¼Œdianxinå’Œliantongçš„è·¯ç”±å™¨é‡Œçš„å…¶ä»–è·¯ç”±ï¼Œå¦‚æœäº’pingè‚¯å®šæ˜¯ä¸é€šçš„ï¼Œç°å®ç¯å¢ƒä¸‹ï¼Œä¸¤ä¸ªè‚¯å®šäº’é€šï¼Œå› ä¸ºå¯èƒ½è¿è¡Œç€bgpç­‰åè®®ï¼Œæˆ‘ä»¬è¿™é‡Œæµ‹è¯•ï¼Œæˆ‘ä»¬å°±é…ä¸€ä¸ªåŠ¨æ€è·¯ç”±ï¼Œè®©å½¼æ­¤å­¦ä¹ åˆ°å„è‡ªçš„è·¯ç”±å°±è¡Œäº†ï¼Œå¯ä»¥é€‰æ‹©ripï¼Œospfï¼Œbgp\n\n`é…ç½®RIP`\n\n`dianxin` ç”±äºæ˜¯aç±»åœ°å€ï¼Œåªèƒ½å®£å‘Šaç±»ç½‘æ®µï¼Œè¿™æ˜¯ripçš„è§„åˆ™ï¼Œæˆ‘å‰é¢ä¸€ä¸ªå®éªŒä¹Ÿæœ‰è¯´è¿‡\n\n```\nrip 1\nversion 2\nnetwork 100.0.0.0\nnetwork 12.0.0.0\nnetwork 1.0.0.0\n```\n\n`liantong`\n\n```\nrip 1\nversion 2\nnetwork 100.0.0.0\nnetwork 23.0.0.0\nnetwork 2.0.0.0\n```\n\nå„è‡ªéƒ½å­¦åˆ°äº†è‡ªå·±çš„è·¯ç”±\n\n![image-20250323140537898](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323140537898.png)\n\n### é…ç½®nat\n\nåœ¨å‡ºå£è·¯ç”±å™¨é…ç½®natçš„easyip\n\n`route`\n\n```\nsys\nacl 2000\nrule 10 permit source 192.168.10.0 0.0.0.255\nrule 20 permit source 192.168.20.0 0.0.0.255\nq\nint g0/0/0\nnat outbound 2000\nint g0/0/2\nnat outbound 2000\n```\n\nè¿™æ—¶å€™æˆ‘ä»¬å»è·Ÿè¸ªè·¯ç”±ä¿¡æ¯ï¼Œpc ping ç”µä¿¡çš„1.1.1.1ç¯å›å£\n\n![image-20250323174936798](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323174936798.png)\n\nå‘ç°ä»–åªèƒ½åˆ°ç½‘å…³ï¼Œå› ä¸ºç½‘å…³çš„è·¯ç”±è¡¨é‡Œæ²¡æœ‰ç›®çš„1.1.1.1çš„è·¯ç”±ï¼Œåˆ°äº†ç½‘å…³è¿™é‡Œæ— è·¯å¯èµ°ï¼Œå°±ä¼šä¸¢å¼ƒï¼Œä½†æ˜¯æˆ‘ä»¬è¦è®©ä»–å¯èµ°ï¼Œå°±è¦æŠŠæµé‡ä¸¢ç»™ä»–çš„è€å¤§ä¹Ÿå°±æ˜¯å‡ºå£è·¯ç”±å™¨\n\n> ä¸€èˆ¬æˆ‘ä»¬åœ¨ç”Ÿäº§ä¸­ä¼šåœ¨ç½‘å…³é…ç½®é»˜è®¤è·¯ç”±åˆ°å‡ºå£è·¯ç”±å™¨çš„\n\n`coresw`\n\n```\nip route-static 0.0.0.0 0 192.168.30.3\n```\n\n![image-20250323175348563](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323175348563.png)\n\né…ç½®äº†ä¸é€šï¼Œä½†æ˜¯è‡³å°‘ï¼Œæˆ‘ä»¬çš„æµé‡å·²ç»åˆ°äº†å‡ºå£è·¯ç”±å™¨äº†ï¼Œä½†æ˜¯å‡ºå£è·¯ç”±å™¨çš„è·¯ç”±è¡¨ä¹Ÿæ²¡æœ‰ç›®çš„1.1.1.1çš„è·¯ç”±\n\n> è€ƒè¯•é‡ç‚¹ï¼šåœ¨å‡ºå£è·¯ç”±å™¨éƒ½è¦é…ç½®é»˜è®¤è·¯ç”±æŒ‡å‘è¿è¥å•†çš„\n\n![image-20250323182419443](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323182419443.png)\n\nè¿™æ—¶å€™æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œè¿™é‡Œçš„åœºæ™¯ä¸€ï¼Œé»˜è®¤èµ°ç”µä¿¡ï¼Œå‡ºæ•…éšœèµ°è”é€š\n\n![image-20250323182404997](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323182404997.png)\n\n### é…ç½®åœºæ™¯1\n\næ‰€ä»¥æˆ‘ä»¬è¦é…ç½®ä¸¤ä¸ªé™æ€è·¯ç”±ï¼Œåˆ™è®¾ç½®ç”µä¿¡çš„ä¼˜å…ˆçº§æœ€å°ï¼Œå› ä¸ºè¶Šå°è¶Šä¼˜å…ˆï¼Œæ™®é€šçš„é»˜è®¤è·¯ç”±ä¼˜å…ˆçº§æ˜¯60\n\n`route`\n\n```bash\n#æŒ‡å‘ç”µä¿¡çš„é»˜è®¤è·¯ç”±ï¼Œè®¾ç½®ä½äº60çš„ä¼˜å…ˆçº§\nip route-static 0.0.0.0 0 12.1.1.1 preference 50\n#æŒ‡å‘è”é€šçš„é»˜è®¤è·¯ç”±\nip route-static 0.0.0.0 0 23.1.1.2\n```\n\n![image-20250323182905866](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323182905866.png)\n\nè¿™é‡Œåªæœ‰ä¸€æ¡ï¼Œå½“è¿™æ¡æŒ‡å‘ç”µä¿¡çš„é»˜è®¤è·¯ç”±æ•…éšœäº†ï¼Œæ‰ä¼šèµ°å‘è”é€šï¼Œä½†æ˜¯è¿˜è¦é…ç½®`bfd`å»è¿›è¡Œç›‘æµ‹æ‰èƒ½å®ç°æ•…éšœè½¬ç§»\n\n`é…ç½®BFD`\n\ndianxinå’Œrouteé…ç½®bfdæ£€æµ‹å¯¹ç«¯æ¥å£æ´»åŠ¨æƒ…å†µ\n\n`route`\n\n```\nundo ip route-static 0.0.0.0 0 12.1.1.1\nbfd\nbfd dianxin bind peer-ip 12.1.1.1 source 12.1.1.3 auto\ncommit\n```\n\n`dianxin`\n\n```\nbfd\nbfd dianxin bind peer-ip 12.1.1.3 source 12.1.1.1 auto\ncommit\n```\n\nç­‰å¾…å‡ ç§’å»ºç«‹è¿æ¥\n\n```\ndis bfd session all\n```\n\n![image-20250323184218014](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323184218014.png)\n\n`routeé…ç½®bfdç­–ç•¥`\n\nå¦‚æœ BFD æ£€æµ‹åˆ°é“¾è·¯æ•…éšœä¸‹ä¸€è·³12.1.1.1ä¸å¯è¾¾ï¼Œè¿™æ¡é™æ€è·¯ç”±ä¼šè‡ªåŠ¨ä»è·¯ç”±è¡¨ä¸­ç§»é™¤ï¼Œä»è€Œé¿å…æµé‡è¢«é”™è¯¯è½¬å‘ã€‚\n\n```\nip route-static 0.0.0.0 0 12.1.1.1 preference 50 track bfd-session dianxin\n```\n\næ¨¡æ‹Ÿä¸€ä¸‹12.1.1.1  downçŠ¶æ€\n\n`dianxin`\n\n```\nint g0/0/0\nshutdown\n```\n\n`route`\n\n```\ndis ip rou\n```\n\n![image-20250323184640354](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323184640354.png)\n\nè¿™æ—¶å€™èµ°å‘ç”µä¿¡çš„é»˜è®¤è·¯ç”±å› ä¸ºå‡ºç°æ•…éšœè€Œè¢«bfdè‡ªåŠ¨åˆ é™¤ï¼Œå–è€Œä»£ä¹‹çš„å°±æ˜¯èµ°å‘è”é€šçš„è·¯ç”±\n\n### é…ç½®åœºæ™¯2\n\næ•™å­¦æ¥¼æµé‡èµ°ç”µä¿¡å‡ºå£ï¼Œå®¿èˆæ¥¼æµç¨‹èµ°è”é€šå‡ºå£ã€‚\n\nåšè¿™ä¸ªè¦åˆ æ‰å‰é¢é…ç½®çš„é™æ€è·¯ç”±å“¦ï¼Œæ¯ä¸ªåœºæ™¯éƒ½æ˜¯ç‹¬ç«‹çš„\n\n`route`\n\n```\nundo ip route-static 0.0.0.0 0 12.1.1.1\nundo ip route-static 0.0.0.0 0 23.1.1.2\n```\n\n#### é…ç½®aclï¼ŒåŒ¹é…æµé‡\n\nä»¥ä¸‹éƒ½åœ¨å‡ºå£è·¯ç”±å™¨é…ç½®\n\n```\nacl 2010\nrule 10 permit source 192.168.10.0 0.0.0.255\nacl 2020\nrule 10 permit source 192.168.20.0 0.0.0.255\n```\n\n#### æµåˆ†ç±»\n\nåˆ†ç±»å‡ºä¸¤ä¸ªæµé‡ï¼Œä¸€ä¸ªæ˜¯æ•™å­¦çš„ä¸€ä¸ªæ˜¯å®¿èˆçš„ï¼Œæ¯ä¸ªæµé‡åº”ç”¨ç›¸åº”çš„acl\n\n```\ntraffic classifier jiaoxue\nif-match acl 2010\ntraffic classifier sushe\nif-match acl 2020\n```\n\n#### æµè¡Œä¸º\n\nåˆ›å»ºä¸¤ç§ç§è¡Œä¸ºï¼Œé‡å®šå‘ç”µä¿¡çš„ä¸‹ä¸€è·³æ˜¯12.1.1.1ï¼Œé‡å®šå‘è”é€šçš„ä¸‹ä¸€è·³æ˜¯23.1.1.2\n\n```\ntraffic behavior re-dianxin\nredirect ip-nexthop 12.1.1.1\ntraffic behavior re-liantong\nredirect ip-nexthop 23.1.1.2\n```\n\n#### æµç­–ç•¥\n\næˆ‘ä»¬è¦å°†æµè¡Œä¸ºå’Œæµç­–ç•¥ç»‘å®šåœ¨ä¸€èµ·\n\n```\ntraffic policy p\nclassifier jiaoxue behavior re-dianxin\nclassifier sushe behavior re-liantong\n```\n\n#### å…¥æ¥å£åº”ç”¨ç­–ç•¥è·¯ç”±\n\n```\ninterface GigabitEthernet 0/0/1\ntraffic-policy p inbound\n```\n\n![image-20250323193303843](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323193303843.png)\n\næ€»ç»“ä¸€ä¸‹æµé‡è¿‡ç¨‹ï¼Œå‡è®¾æˆ‘ä»¬æ˜¯æ•™å­¦æ¥¼ï¼Œæˆ‘ä»¬å»pingç”µä¿¡æœåŠ¡å™¨1.1.1.1æ—¶ï¼Œæµé‡åˆ°äº†å‡ºå£è·¯ç”±å™¨çš„å…¥æ¥å£ï¼Œé‚£ä¹ˆç»è¿‡æµåˆ†ç±»ä¸­çš„æ•™å­¦é‡Œçš„aclè¯†åˆ«åˆ°æ˜¯æ•™å­¦æ¥¼10ç½‘æ®µçš„æµé‡ï¼Œå°±æˆåŠŸåŒ¹é…ï¼Œç„¶åè¿›è¡Œæµè¡Œä¸ºï¼Œé‡å®šå‘æµé‡åˆ°dianxinï¼Œä¸‹ä¸€è·³æŒ‡å‘12.1.1.1ï¼ˆç”µä¿¡æ¥å£ï¼‰ã€‚å…¶ä»–æµé‡ä¹Ÿä¸€æ ·\n\n### é…ç½®åœºæ™¯3\n\nè®¿é—®ç”µä¿¡çš„æœåŠ¡å™¨èµ°ç”µä¿¡å‡ºå£ï¼Œè®¿é—®è”é€šæœåŠ¡å™¨èµ°è”é€šå‡ºå£ã€‚\n\n`route`\n\nåˆ é™¤å‰é¢çš„é…ç½®\n\n```\ninterface GigabitEthernet 0/0/1\nundo traffic-policy inbound\nq\nundo traffic policy p\nundo traffic behavior re-dianxin\nundo traffic behavior re-liantong\nundo traffic classifier jiaoxue\nundo traffic classifier sushe\nundo acl 2010\nundo acl 2020\n```\n\nå°±å…¶å®å’Œå‰é¢é‚£ä¸ªåœºæ™¯æ˜¯å·®ä¸å¤šï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯åœ¨aclæˆ‘ä»¬åªéœ€è¦å®šä¹‰ç›®çš„åœ°å€æ˜¯è”é€šæˆ–è€…ç”µä¿¡çš„å°±è¡Œäº†ï¼Œæºæµé‡è®¾ç½®ä¸ºanyï¼Œè¿™æ ·æ•™å­¦æ¥¼å’Œå®¿èˆä¸ç®¡æºåœ°å€æ˜¯å•¥ï¼Œåªè¦pingå“ªä¸ªæœåŠ¡å™¨ï¼Œå°±ä¼šè¢«å¸¦åˆ°å“ªä¸ªè·¯ç”±å™¨\n\n```\nacl 3010\nrule 10 permit ip source any destination 1.1.1.0 0.0.0.255\nacl 3020\nrule 10 permit ip source any destination 2.2.2.2 0.0.0.255\ntraffic classifier dianxin\nif-match acl 3010\ntraffic classifier liantong\nif-match acl 3020\ntraffic behavior re-dianxin\nredirect ip-nexthop 12.1.1.1\ntraffic behavior re-liantong\nredirect ip-nexthop 23.1.1.2\ntraffic policy p\nclassifier dianxin behavior re-dianxin\nclassifier liantong behavior re-liantong\nint g0/0/1\ntraffic-policy p inbound\n\n```\n\n![image-20250323195600480](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250323195600480.png)\n\n## IPsecå®éªŒ\n\n![image-20250324174701459](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324174701459.png)\n\n![image-20250324174721230](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324174721230.png)\n\n![image-20250324174728983](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324174728983.png)\n\n![image-20250324174759521](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324174759521.png)\n\n![image-20250324174812757](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324174812757.png)\n\nçœ‹ç€ä¸Šé¢çš„è¡¨é…ï¼Œè¿™é‡Œå°±ä¸è¯´äº†\n\n### é…ç½®é™æ€è·¯ç”±å’ŒNAT\n\n> ä¸€èˆ¬å‡ºå£è·¯ç”±å™¨éƒ½è¦é…ç½®ä¸€æ¡é»˜è®¤è·¯ç”±æŒ‡å‘è¿è¥å•†\n\n`R1`\n\n```\nsys\nun in en\nip route-static 0.0.0.0 0 100.1.1.2\nacl 2000\nrule 10 permit source 192.168.10.0 0.0.0.255\nq\nint g0/0/1\nnat outbound 2000\n```\n\n`R2`\n\n```\nsys\nun in en\nip route-static 0.0.0.0 0 200.1.1.2\nacl 2000\nrule 10 permit source 192.168.20.0 0.0.0.255\nq\nint g0/0/1\nnat outbound 2000\n```\n\n![image-20250324190933618](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324190933618.png)\n\nå¯ä»¥pingé€šäº’è”ç½‘ï¼Œä½†æ˜¯ä¸èƒ½äº’é€špcï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¦é€šè¿‡é…ç½®ipsecæŠŠè¿™ä¸¤ä¸ªå†…ç½‘æ‰“é€š\n\n### æ‰‹åŠ¨é…ç½®ipsec\n\n#### é…ç½®acl\n\nå®šä¹‰éœ€è¦ä¿æŠ¤çš„æ•°æ®æµï¼Œé‚£æ¡è·¯çš„è·¯ç”±éœ€è¦ä¿æŠ¤ï¼Œå°±åœˆèµ·æ¥\n\n`R1`\n\n```\nsys\nacl 3000\nrule 10 permit ip source 192.168.10.0 0.0.0.255 destination 192.168.20.0 0.0.0.255 \n```\n\n`R2`\n\n```\nsys\nacl 3000\nrule 10 permit ip source 192.168.20.0 0.0.0.255 destination 192.168.10.0 0.0.0.255\n```\n\n#### é…ç½®ipsecæè®®\n\nå¯¹ä½ å³å°†è¦å»ºç«‹çš„éš§é“ï¼Œè®¾ç½®è®¤è¯å’ŒåŠ å¯†ç®—æ³•ï¼Œé‡‡ç”¨ä»€ä¹ˆç®—æ³•å’Œæ–¹å¼è¿›è¡Œä¿æŠ¤ï¼Œä¸€èˆ¬é»˜è®¤éƒ½æ˜¯éš§é“æ¨¡å¼ï¼ŒåŠ å¯†ç”¨çš„æ˜¯åŠ å¯†ç®—æ³•\n\n`R1`\n\nipsecæè®®åå­—cdï¼ˆæˆéƒ½ï¼‰\n\nè®¤è¯ç®—æ³•é‡‡ç”¨sha2-256\n\nåŠ å¯†ç®—æ³•é‡‡ç”¨des\n\n```\nipsec proposal cd\nesp authentication-algorithm sha2-256\nesp encryption-algorithm des\ndis ipsec proposal\n```\n\n![image-20250324202836479](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324202836479.png)\n\n`R2`\n\n```\nipsec prpoosal bj\nesp authentication-algorithm sha2-256\nesp encryption-algorithm des\ndis ipsec proposal\n```\n\n![image-20250324202817399](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324202817399.png)\n\n#### é…ç½®ipsecæ‰‹åŠ¨å®‰å…¨ç­–ç•¥\n\n![image-20250324224249409](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324224249409.png)\n\nè¿™é‡Œæ¶‰åŠä¸¤ä¸ªSAç¼–å·ï¼Œåœ¨R1çš„è§’åº¦ä¸Šå…¥æ–¹å‘æ˜¯54321ï¼Œå‡ºæ–¹å‘æ˜¯12345\n\né‚£åˆ°äº†R2ï¼Œä½ å°±ä¸èƒ½æŒ‰ç…§R1çš„æ¥äº†ï¼Œä½ è¦åç€å†™ï¼Œå…¥æ–¹å‘æ˜¯12345ï¼Œå‡ºæ–¹å‘æ˜¯54321ã€‚\n\néƒ½æ˜¯åç€æ¥ï¼Œä¸€ä¸€å¯¹åº”çš„ï¼Œåƒä¸‡åˆ«æé”™\n\n\n\n`R1`\n\n```\nsys\nipsec policy chengdu 10 manual\nsecurity acl 3000\nproposal cd\ntunnel local 100.1.1.1\ntunnel remote 200.1.1.1\nsa spi inbound esp 54321\nsa string-key inbound esp cipher qianyios\nsa spi outbound esp 12345\nsa string-key outbound esp cipher qianyios\n```\n\n//é…ç½®IPSECç­–ç•¥`chegndu`ï¼Œæ–¹å¼ä¸º`æ‰‹åŠ¨`\n\n//åŒ…å«acl`3000`çš„æµé‡\n\n//é‡‡ç”¨ipsec æè®® `cd`\n\n//é…ç½®éš§é“`æœ¬åœ°`åœ°å€100.1.1.1\n\n//é…ç½®éš§é“`è¿œç«¯`åœ°å€ 200.1.1.1\n\n//é…ç½®`å…¥æ–¹å‘`SAç¼–å·`54321`\n\n//é…ç½®`å…¥æ–¹å‘`SAçš„è®¤è¯å¯†é’¥ä¸ºqianyios\n\n//é…ç½®`å‡ºæ–¹å‘`SAç¼–å·`12345`\n\n//é…ç½®`å‡ºæ–¹å‘`SAçš„è®¤è¯å¯†é’¥ä¸ºqianyios\n\n`R2`\n\n```\nsys\nipsec policy beijing 10 manual\nsecurity acl 3000\nproposal bj\ntunnel local 200.1.1.1\ntunnel remote 100.1.1.1\nsa spi inbound esp 12345\nsa string-key inbound esp cipher qianyios\nsa spi outbound esp 54321\nsa string-key outbound esp cipher qianyios\n```\n\n//é…ç½®IPSECç­–ç•¥`beijing`ï¼Œæ–¹å¼ä¸º`æ‰‹åŠ¨`\n\n//åŒ…å«acl`3000`çš„æµé‡\n\n//é‡‡ç”¨ipsec æè®® `bj`\n\n//é…ç½®éš§é“`æœ¬åœ°`åœ°å€ 200.1.1.1\n\n//é…ç½®éš§é“`è¿œç«¯`åœ°å€ 100.1.1.1\n\n//é…ç½®`å…¥æ–¹å‘`SAç¼–å·`12345`\n\n//é…ç½®`å…¥æ–¹å‘`SAçš„è®¤è¯å¯†é’¥ä¸ºqianyios\n\n//é…ç½®`å‡ºæ–¹å‘`SAç¼–å·`54321`\n\n//é…ç½®`å‡ºæ–¹å‘`SAçš„è®¤è¯å¯†é’¥ä¸ºqianyios\n\n\n\n#### åœ¨æ¥å£ä¸Šåº”ç”¨\n\n`R1`\n\n```\nsys\nint g0/0/1\nipsec policy chengdu\n```\n\n`R2`\n\n```\nsys\nint g0/0/1\nipsec policy beijing\n```\n\néš§é“å·²ç»å»ºç«‹äº†ï¼Œå»æµ‹è¯•ä¸»æœºæ˜¯å¦äº’é€š\n\n![image-20250324225320803](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324225320803.png)\n\nå‘ç°ä¸è¡Œ\n\né—®é¢˜åˆ†æ:R1ä¸Šé…ç½®äº†ACL2000å’ŒACL3000ï¼Œå…¶ä¸­ACL2000ç”¨äºåŒ¹é…å†…éƒ¨éœ€è¦NATçš„åœ°å€ï¼ŒACL3000ç”¨äºåŒ¹é…éœ€è¦é€šè¿‡VPNéš§é“åŠ å¯†çš„æµé‡ï¼Œä¸¤æ¡ACLé‡åˆï¼Œå³ACL2000 ä¼šæŠŠéœ€è¦è¿›è¡Œ VPN ä¼ é€’çš„æµé‡åŒ¹é…å‡ºæ¥ï¼Œè¿›è¡Œ NATã€‚\n\n![image-20250324225644447](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324225644447.png)\n\n![image-20250324225936370](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324225936370.png)\n\næˆ‘ä»¬ä¸å¯èƒ½è¯´æ‰€æœ‰ç”µè„‘éƒ½è¦å»ºç«‹éš§é“ï¼Œåªæœ‰éƒ¨åˆ†ç”µè„‘æ˜¯éœ€è¦å»ºç«‹éš§é“çš„ï¼Œacl2000åœ¨å‰æœŸæœ¬èº«å°±æ˜¯ç»™æ‰€æœ‰å†…éƒ¨æµé‡å»åšnatè½¬æ¢çš„è¿™å…¶ä¸­å°±åŒ…æ‹¬è¦å»ºç«‹éš§é“çš„pc1æµé‡ï¼Œé‚£æˆ‘ä»¬å°±åº”è¯¥é‡æ–°åšaclï¼Œæ¢æˆé«˜çº§acl 3001æ¥åšnatè½¬æ¢ï¼Œå°±æ˜¯åœ¨acl 3001ï¼ŒæŠŠéœ€è¦å»ºç«‹éš§é“çš„æµé‡è®¾ç½®æˆdenyï¼Œå…¶ä»–æµé‡è¿è¡Œé€šè¿‡ï¼Œåº”ç”¨åœ¨natè½¬æ¢å°±å¥½äº†ï¼Œè¿™æ ·å­å°±ä¸ä¼šåŒ¹é…ä»–äº†ï¼Œå°±å¯ä»¥åŒ¹é…acl3000åšéš§é“è½¬æ¢äº†ï¼Œè¿™ä¸ªç†è®ºåœ¨R2ä¹Ÿè¦é‡æ–°æ¨ç¿»acl 2000å»é‡åšacl 3001\n\n`R1`\n\n```\nsys\nint g0/0/1\nundo nat outbound 2000\nq\nundo acl 2000\nacl 3001\nrule 10 deny ip source 192.168.10.0 0.0.0.255 destination 192.168.20.0 0.0.0.255\nrule 20 permit ip \nint g0/0/1\nnat outbound 3001\n```\n\nacl 3001å°±æ˜¯ç¦æ­¢192.168.10.0åˆ°192.168.20.0åˆ°æµé‡ï¼Œæ¥ç€åŒ¹é…å…¶ä»–ipå…è®¸é€šè¿‡ï¼Œç„¶ååº”ç”¨åœ¨å‡ºå£è·¯ç”±å™¨çš„natè½¬æ¢\n\nåœ¨R2ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œåˆ æ‰acl 2000ï¼Œé‡åšacl 3001\n\n`R2`\n\n```\nsys\nint g0/0/1\nundo nat outbound 2000\nq\nundo acl 2000\nacl 3001\nrule 10 deny ip source 192.168.20.0 0.0.0.255 destination 192.168.10.0 0.0.0.255\nrule 20 permit ip\nint g0/0/1\nnat outbound 3001\n```\n\nå·²ç»å¯ä»¥äº’é€šäº†\n\n![image-20250324233149530](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250324233149530.png)\n\n![image-20250325112054630](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325112054630.png)\n\næ‰‹åŠ¨é…ç½®ipsecæˆåŠŸ\n\n\n\n## é˜²ç«å¢™é…ç½®\n\n![image-20250325165001639](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325165001639.png)\n\nè¿™é‡Œçš„é˜²ç«å¢™ç”¨çš„æ˜¯USG6000Vï¼Œé¦–æ¬¡è¿è¡Œéœ€è¦é˜²ç«å¢™å¯¼å…¥åŒ…ï¼Œè¦ä¸‹è½½ä¸€ä¸ªvdi[ä¸‹è½½åœ°å€](https://pan.baidu.com/s/1LtQ-3pBOvhxXv3j2B09SUg?pwd=064b)ï¼Œä¸‹è½½å®Œå¯¼å…¥å³å¯\n\nè¿™é‡Œé¦–å…ˆè¦è¾“å…¥çš„é»˜è®¤ç”¨æˆ·åï¼šadmin\n\nç„¶åå›è½¦ï¼Œå†è¾“å…¥é»˜è®¤å¯†ç ï¼šAdmin@123\n\nå†å›è½¦ï¼Œä¼šè¯¢é—®ä½ æ˜¯å¦è¦ä¿®æ”¹å¯†ç ï¼Œè¾“å…¥â€œyâ€è¡¨ç¤ºyes\n\nå†å›è½¦ï¼Œå…ˆè¾“å…¥ä¸€éæ—§å¯†ç \n\nå†å›è½¦ï¼Œè¾“å…¥æ–°å¯†ç  qianyios@123\n\nå†å›è½¦ï¼Œå†è¾“å…¥ä¸€æ¬¡æ–°å¯†ç \n\n![image-20250325170454311](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325170454311.png)\n\n\n\né…ç½®è¦æ±‚\n\n(1)é˜²ç«å¢™æ¥å£çš„ IPåœ°å€å¦‚æ‹“æ‰‘æ‰€ç¤ºï¼Œå°†æ¥å£åˆ’å…¥ç›¸åº”çš„å®‰å…¨åŒºåŸŸã€‚\n\n(2)å†…ç½‘ä¸»æœºPC1å¯ä»¥ä¸»åŠ¨è®¿é—®Internetï¼Œä½†Internetæ— æ³•ä¸»åŠ¨è®¿é—®PC1ã€‚\n\n(3)å‡ºå£é˜²ç«å¢™è¿›è¡ŒNATï¼ŒNAT å…¬ç½‘åœ°å€æ±  100.1.1.10-100.1.1.20ã€‚\n\n(4)Internet å¯ä»¥é€šè¿‡å…¬ç½‘åœ°å€100.1.1.100/24è®¿é—®ç›®çš„åœ°å€ä¸º 192.168.2.100/24çš„å†…éƒ¨ Web æœåŠ¡ã€‚\n\n\n\n### é…ç½®IPåœ°å€\n\næœ¬æ¬¡å®éªŒå°±åªç”¨pc1åšå®éªŒï¼Œéƒ½ä¸€æ ·çš„ï¼Œpc2å°±é…ç½®ipåœ°å€äº†\n\n![image-20250325170903694](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325170903694.png)\n\n![image-20250325170932350](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325170932350.png)\n\n![image-20250325171140923](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325171140923.png)\n\n`Internet`\n\n```\nsys\nsysname Internet\nun in en\nint g0/0/0\nip add 100.1.1.2 24\n```\n\n`Firewalld`\n\nå‰é¢çš„é…ç½®é˜²ç«å¢™å¯†ç ç™»å…¥ä¹‹åï¼Œå†è¿›è¡Œä¸‹é¢çš„æ“ä½œ\n\n```\nsys\nsysname Firewall\nun in en\nint g1/0/1\nip add 192.168.1.254 24\nint g1/0/2\nip add 192.168.2.254 24\nint g1/0/3\nip add 100.1.1.1 24\n```\n\n### é˜²ç«å¢™å®‰å…¨åŸŸ\n\n`firewalld`\n\næŠŠæ¥å£åŠ å…¥åˆ°ç›¸åº”çš„åŒºåŸŸå»\n\n```\nsys\nfirewall zone trust\nadd int g1/0/1\nfirewall zone dmz\nadd int g1/0/2\nfirewall zone untrust\nadd int g1/0/3\n```\n\nå®‰å…¨ç­–ç•¥çš„é…ç½®\n\n`firewalld`\n\n```\nsys\nsecurity-policy\nrule name trust_to_untrust\nsource-zone trust\ndestination-zone untrust\nsource-address 192.168.1.0 24\ndestination-address any\naction permit\nq\nq\n```\n\nåšå®Œä¹‹åï¼Œpc1æ˜¯æ— æ³•è®¿é—®äº’è”ç½‘çš„ï¼Œå› ä¸ºå‡ºå£æ²¡æœ‰åšNAT,å¼€å¯ç«¯å£è½¬æ¢\n\n```\nnat address-group natgroup1\nmode pat\nsection 0 100.1.1.10 100.1.1.20\nq\nnat-policy\nrule name policy_nat1\nsource-zone trust\ndestination-zone untrust\nsource-address 192.168.1.0 24\ndestination-address any\naction source-nat address-group natgroup1\nq\nq\n```\n\npc1æˆåŠŸè®¿é—®äº’è”ç½‘\n\n![image-20250325194534668](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325194534668.png)\n\n![image-20250325195001312](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325195001312.png)\n\n### é…ç½®pcè®¿é—®dmz\n\n`firewall`\n\né…ç½®trustæµé‡è¿è¡Œè®¿é—®dmzåŒºåŸŸï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨åŒºåŸŸ\n\n```\nsys\nsecurity-policy\nrule name trust_to_dmz\nsource-zone trust\ndestination-zone dmz\naction permit\n```\n\n![image-20250325201753321](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325201753321.png)\n\n### é…ç½®ç«¯å£æ˜ å°„\n\n`firewall`\n\næŠŠå†…ç½‘webæœåŠ¡æ˜ å°„åˆ°å…¬ç½‘åœ°å€\n\n```\nsys\nnat server policy_web protocol tcp global 100.1.1.100 80 inside 192.168.2.100 80\n```\n\nè¿™æ—¶å€™æµ‹è¯•interneté€šè¿‡å…¬ç½‘100.1.1.100:80å»è®¿é—®æœåŠ¡å™¨çš„80ç«¯å£\n\n![image-20250325203824512](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325203824512.png)\n\nä¸è¡Œï¼Œå› ä¸ºuntrustæ²¡æœ‰æ”¾è¡Œæµé‡åˆ°dmzåŒºåŸŸ\n\n```\nsys\nsecurity-policy\nrule name untrust_to_dmz\nsource-zone untrust\ndestination-zone dmz\ndestination-address 192.168.2.100 32\naction permit\n```\n\n![image-20250325204250937](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250325204250937.png)\n\n\n\n## è·¯ç”±ç­–ç•¥\n\n![image-20250328175744571](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250328175744571.png)\n\n![image-20250328175752628](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250328175752628.png)\n\n### é…ç½®ipåœ°å€\n\n`R1`\n\n```\nsys\nsysname R1\nun in en\nint g0/0/0\nip address 12.1.1.1 30\nint LoopBack0\nip add 10.1.1.1 24\nint LoopBack1\nip add 10.1.2.1 24\nint LoopBack2\nip add 10.1.3.1 24\n```\n\n`R2`\n\n```\nsys\nsysname R2\nun in en\nint g0/0/0\nip add 12.1.1.2 30\nint g0/0/1\nip add 23.1.1.1 30\n```\n\n`R3`\n\n```\nsys\nsysname R3\nun in en\nint g0/0/1\nip add 23.1.1.2 30\nint LoopBack 0\nip add 30.1.1.1 24\nint LoopBack 1\nip add 30.1.2.1 24\nint LoopBack 2\nip add 30.1.3.1 24\n```\n\n### é…ç½®RIPå’ŒOSPF\n\n`R1`\n\n```\nrip 1\nversion 2\nnetwork 12.0.0.0\nnetwork 10.0.0.0\n```\n\n`R2`\n\n```\nrip 1\nversion 2\nnetwork 12.0.0.0\nq\nospf 1\narea 0\nnetwork 23.1.1.0 0.0.0.3\n```\n\n`R3`\n\n```\nospf 1\narea 0\nnetwork 23.1.1.0 0.0.0.3\nnetwork 30.1.1.0 0.0.0.255\nnetwork 30.1.2.0 0.0.0.255\nnetwork 30.1.3.0 0.0.0.255\n```\n\nåœ¨R2ä¸ŠæŸ¥çœ‹è·¯ç”±è¡¨ï¼Œå·²ç»é€šè¿‡RIPå’ŒOSPFåˆ†åˆ«å­¦åˆ°äº†3æ¡è·¯ç”±\n\n```\ndis ip rou\n```\n\n![image-20250328185810992](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250328185810992.png)\n\n\n\n### é…ç½®è·¯ç”±å¼•å…¥å’Œè·¯ç”±ç­–ç•¥ä»¥åŠè®¾ç½®å¼€é”€\n\n`R2`\n\n```\nacl 2000\nrule 10 permit source 30.1.1.0 0.0.0.255\nrule 20 permit source 30.1.2.0 0.0.0.255\nrule 30 permit source 30.1.3.0 0.0.0.255\nroute-policy 10 permit node 10\nif-match acl 2000\napply cost 10\nrip 1\nversion 2\nimport-route ospf 1 route-policy 10\n```\n\nR1ä¸ŠæŸ¥çœ‹ä»ä½•R2å­¦åˆ°çš„ripè·¯ç”±ï¼Œå¼€é”€æ˜¯11ï¼Œä¹Ÿå°±æ˜¯å‰é¢åœ¨R2å¼•å…¥ospfçš„è·¯ç”±ï¼Œæœ¬èº«å¼€é”€æ˜¯10ï¼Œè€ŒR2æœ¬èº«ç®—ä¸€è·³ï¼Œæ‰€ä»¥å¼€é”€å°±æ˜¯11\n\n![image-20250328192609478](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250328192609478.png)\n\nR2ä¸Šé…ç½®è·¯ç”±å¼•å…¥å’Œè·¯ç”±ç­–ç•¥ï¼Œè¿›è¡Œè·¯ç”±è¿‡æ»¤\n\n```\nacl 2001\nrule 10 permit source 10.1.2.0 0.0.0.255\nrule 20 permit source 10.1.3.0 0.0.0.255\nq\nroute-policy 20 permit node 20\nif-match acl 2001\nospf 1\nimport-route rip route-policy 20\n```\n\n\n\nR3ä¸ŠæŸ¥çœ‹è·¯ç”±å­¦ä¹ æƒ…å†µ,é€šè¿‡è·¯ç”±ç­–ç•¥è¿‡æ»¤,R3åªå­¦åˆ°äº†10.1.2.0/24å’Œ10.1.3.0/24,æ²¡æœ‰å­¦åˆ° 10.1.1.0/24ï¼Œå®éªŒæˆåŠŸ!\n\n![image-20250328193229825](../img/%E5%8D%8E%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%93%E9%A2%98/image-20250328193229825.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["ç½‘ç»œ"],"categories":["ç½‘ç»œ"]},{"title":"å®ç°ç§æœ‰Yumä»“åº“","url":"/posts/f49cc7ae/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# å®ç°ç§æœ‰Yumä»“åº“\n\n## æ¶æ„å›¾\n\n![yum](../img/%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89Yum%E4%BB%93%E5%BA%93.assets/2a5fb169729de5d58421f2d71902d64755933597.png)\n\næ¯ä¸ªç³»ç»Ÿçš„æœ€åçš„è·¯å¾„éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¦çœ‹æ¸…ï¼Œå°½é‡è·Ÿå¤§å‚è·¯å¾„å¯¹é½ï¼Œèµ·å§‹æœ€é‡è¦çš„å°±æ˜¯Packageså’Œrepodataï¼Œä½ çœ‹é˜¿é‡Œäº‘çš„è·¯å¾„ï¼Œæˆ‘ä»¬åªè¦èµ°åˆ°æœ‰repedataçš„æ–‡ä»¶å¤¹ä¸‹ï¼Œå°±è¯´æ˜èµ°å¯¹äº†ï¼Œä¸ç”¨å¾€ä¸‹èµ°äº†\n\n## ä¸»æœºæ‹“æ‰‘\n\n|   ä¸»æœºå   |       ip       |       os        |\n| :--------: | :------------: | :-------------: |\n| yum server | 192.168.48.128 |    Rocker8.9    |\n|  client1   | 192.168.48.11  | Centos Stream 8 |\n|  client2   | 192.168.48.10  |    Centos 7     |\n\nå‰æƒ…æè¦ï¼šæ‰€æœ‰è¦è¿›è¡Œä¸Šä¼ yumæºçš„æœºå­éƒ½è¦æŒ‚è½½å…‰ç›˜ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç½‘ç»œå¤‡ä»½\n\n## è‡ªåŠ¨æŒ‚è½½å…‰ç›˜\n\n```bash\n#è‡ªåŠ¨æŒ‚è½½\nyum install autofs -y\nsystemctl enable --now autofs\nsed -i '/^[[:space:]]*#.*misc.*\\/etc\\/auto.misc/ s/^#//' /etc/auto.master\nsystemctl restart autofs\nls /misc/cd\n```\n\n## éƒ¨ç½²yum server\n\næ“ä½œèŠ‚ç‚¹ï¼šã€yum serverã€‘\n\n### Rocky8\n\n```bash\nyum install -y httpd\nsystemctl disable --now firewalld.service\nsystemctl enable --now httpd.service\n\n#è‡ªå·±çœ‹å‰é¢çš„æ•™ç¨‹å®ç°rocky8çš„å…‰ç›˜è‡ªåŠ¨æŒ‚è½½\n\n#å°†æœ¬åœ°å…‰ç›˜ä¸­çš„å†…å®¹CPåˆ°webç›®å½•ä¸­ï¼Œç»™å®¢æˆ·ç«¯ä½¿ç”¨\nmkdir -p /var/www/html/rockylinux/8/{BaseOS,AppStream}\ncp -r /misc/cd/BaseOS/* /var/www/html/rockylinux/8/BaseOS\ncp -r /mnt/BaseOS/repodata /var/www/html/rockylinux/8/BaseOS/\ncp -r /misc/cd/AppStream/* /var/www/html/rockylinux/8/AppStream\ncp -r /mnt/AppStream/repodata /var/www/html/rockylinux/8/AppStream/\n#è¿™é‡Œå¯èƒ½æœ‰ç‚¹æ…¢ï¼Œå› ä¸ºè¦æ‹·è´çš„æ–‡ä»¶æœ‰ç‚¹å¤š\n```\n\nç°åœ¨ä¸€äº›åŸºæœ¬çš„æ–‡ä»¶éƒ½æ‹·è¿‡å»äº†è®¿é—®ç½‘é¡µå°±å¯ä»¥çœ‹è§äº†\n\n```bash\nhttp://192.168.48.128/rockylinux/8/\n```\n\n![image-20250711231852237](../img/%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89Yum%E4%BB%93%E5%BA%93.assets/c07c2cc67d66a746994222cc2db1833855933597.png)\n\nå‡è®¾æˆ‘è¿˜æœ‰ä¸ª`extras`æºæƒ³æ‹·è¿‡å»å‘¢ï¼Ÿå‰é¢é‚£ä¸ªæ˜¯èµ°æœ¬åœ°ï¼Œè¿™ä¸ªå¯ä»¥èµ°ç½‘ç»œï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨åˆ°`yumä»“åŒæ­¥å·¥å…·`\n\n```bash\nhttps://mirrors.aliyun.com/rockylinux/8/extras/x86_64/os/\n```\n\n![image-20250711232003433](../img/%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89Yum%E4%BB%93%E5%BA%93.assets/d3c34126c0d8cda84560441748a75a1555933597.png)\n\n```bash\n#å¤‡ä»½è‡ªå·±çš„æº\nmkdir -p repo.bak\nmv /etc/yum.repos.d/* repo.bak/\n#è¿™æ˜¯ç§ç½‘yum serverè‡ªå·±ç”¨çš„repo\ncat > /etc/yum.repos.d/qianyios.repo<<\"EOF2\"\n[AppStream]\nname=AppStream\nbaseurl=file:///var/www/html/rockylinux/8/AppStream/x86_64/os/\ngpgkey=/etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial\ngpgcheck=1\nenabled=1\n[BaseOS]\nname=BaseOS\nbaseurl=file:///var/www/html/rockylinux/8/BaseOS/x86_64/os/\ngpgkey=/etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial\ngpgcheck=1\nenabled=1\n[extras]\nname=extras\nbaseurl=file:///var/www/html/rockylinux/8/extras/x86_64/os/\ngpgkey=/etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial\ngpgcheck=1\nenabled=1\nEOF2\n#è¿™æ˜¯å…¬ç½‘ç”¨æ¥åŒæ­¥çš„çš„repo\ncat > /etc/yum.repos.d/qianyios-external-rocky8.repo<<\"EOF2\"\n[AppStream-external-rocky8]\nname=AppStream-external-rocky8\nbaseurl=https://mirrors.aliyun.com/rockylinux/8/AppStream/x86_64/os/\ngpgkey=/etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial\ngpgcheck=1\nenabled=1\n[BaseOS-external-rocky8]\nname=BaseOS-external-rocky8\nbaseurl=https://mirrors.aliyun.com/rockylinux/8/BaseOS/x86_64/os/\ngpgkey=/etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial\ngpgcheck=1\nenabled=1\n[extras-external-rocky8]\nname=extras-external-rocky8\nbaseurl=https://mirrors.aliyun.com/rockylinux/8/extras/x86_64/os/\ngpgkey=/etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial\ngpgcheck=1\nenabled=1\nEOF2\n```\n\n```bash\n#CentOS 8 dnf å·¥å…·é›†æˆ REPOIDæ˜¯é‚£ä¸ªrepoé‡Œçš„[]é‡Œçš„åå­—\ndnf reposync --repoid=REPOID --download-metadata -p /path \ndnf reposync --help #æŸ¥çœ‹å¸®åŠ©\n#CentOS 7 ä»¥å‰ç‰ˆæœ¬ï¼Œreposyncå·¥å…·æ¥è‡ªäºyum-utilsåŒ…\nreposync --repoid=REPOID --download-metadata -p /path\n```\n\n```bash\n#åˆ›å»ºå¥½å¯¹åº”çš„è·¯å¾„ï¼Œç”±äºAppStreamå’ŒBaseOSå·²ç»æ‰‹åŠ¨æ‹‰è¿‡å»äº†ï¼Œä½†æ˜¯è·¯å¾„ä¸å¯¹ï¼Œæˆ‘ä»¬å°±æ‰‹åŠ¨ç§»ä¸€ä¸‹\ncd /var/www/html/rockylinux/8\nmkdir -p AppStream/x86_64/os/\nmkdir -p BaseOS/x86_64/os/\nmv AppStream/{Packages,repodata} AppStream/x86_64/os/\nmv BaseOS/{Packages,repodata} BaseOS/x86_64/os/\n#å¼€å§‹åŒæ­¥ï¼Œè¿™é‡Œæœ€å-p è·¯å¾„çš„å°±ä¸ç”¨åŠ extras\nmkdir -p /var/www/html/rockylinux/8/\nyum reposync --repoid=extras-external-rocky8 --download-metadata -p /var/www/html/rockylinux/8/\n#ä½†æ˜¯è¿™ä¸ªæ—¶å€™ä»–çš„åå­—æ˜¯extras-external-rocky8ï¼Œæ‰€ä»¥ä½ è¦æŠŠä»–ä¸‹é¢çš„å†…å®¹ç§»åŠ¨åˆ°extraså»ï¼Œè¿˜è¦æ³¨æ„æœ‰æ²¡æœ‰x86_64/os/\nmv /var/www/html/rockylinux/8/{extras-external-rocky8,extras}\nmkdir -p extras/x86_64/os/\nmv extras/{Packages,repodata} extras/x86_64/os/\n```\n\n![image-20250712000955889](../img/%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89Yum%E4%BB%93%E5%BA%93.assets/df8dc0c90c40f5ce752128a090c3e2b655933597.png)\n\nè¿™å°±æ˜¯æˆæœ\n\næµ‹è¯•è‡ªå·±æ˜¯å¦èƒ½åˆ›å»ºç¼“å­˜æˆåŠŸ\n\n```bash\n#ç”¨çš„æ˜¯ç§æœ‰repoï¼Œè®°å¾—æŠŠå…¶ä»–çš„repoç§»èµ°\n[root@localhost 8]# yum clean all && yum makecache\n75 ä¸ªæ–‡ä»¶å·²åˆ é™¤\nAppStream                                                   410 MB/s | 8.7 MB     00:00\nBaseOS                                                      237 MB/s | 2.6 MB     00:00\nextras                                                      6.4 MB/s |  15 kB     00:00\nå…ƒæ•°æ®ç¼“å­˜å·²å»ºç«‹ã€‚\n```\n\n### Centos Strem 8\n\n#### è¿œç¨‹åŒæ­¥\n\næ“ä½œèŠ‚ç‚¹ï¼šã€Centos Strem 8ã€‘\n\nä»Centos Strem 8å¤åˆ¶åˆ°yumserverï¼Œå¦‚æœä½ æ²¡æœ‰centos stream 8çš„æœºå­ï¼Œé‚£å°±ç›´æ¥é€‰ç½‘ç»œåŒæ­¥\n\n```bash\n#è‡ªå·±çœ‹å‰é¢çš„æ•™ç¨‹å®ç°rocky8çš„å…‰ç›˜è‡ªåŠ¨æŒ‚è½½\n#å°†æœ¬åœ°å…‰ç›˜ä¸­çš„å†…å®¹CPåˆ°yum server çš„webç›®å½•ä¸­\nscp -r /misc/cd/BaseOS 192.168.48.128:/var/www/html/centos/8-stream/\nscp -r /misc/cd/AppStream 192.168.48.128:/var/www/html/centos/8-stream/\n```\n\n#### ç½‘ç»œåŒæ­¥\n\næ“ä½œèŠ‚ç‚¹ï¼šã€yum serverã€‘\n\n```bash\n#å…¬ç½‘\ncat > /etc/yum.repos.d/qianyios-external--Centos-Strem-8.repo<<\"EOF2\"\n[AppStream-external-Centos-Strem-8]\nname=AppStream-external-Centos-Strem-8\nbaseurl=https://mirrors.aliyun.com/centos/8-stream/AppStream/x86_64/os/\ngpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official\ngpgcheck=1\nenabled=1\n[BaseOS-external-Centos-Strem-8]\nname=BaseOS-external-Centos-Strem-8\nbaseurl=https://mirrors.aliyun.com/centos/8-stream/BaseOS/x86_64/os/\ngpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official\ngpgcheck=1\nenabled=1\n[extras-external-Centos-Strem-8]\nname=extras-external-Centos-Strem-8\nbaseurl=https://mirrors.aliyun.com/centos/8-stream/extras/x86_64/os/\ngpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official\ngpgcheck=1\nenabled=1\nEOF2\n```\n\n```bash\n#å‰é¢å·²ç»å¤åˆ¶è¿‡äº†AppStreamå’ŒBaseOSï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†,å¦‚æœä½ æ‰‹åŠ¨ä¹‹åè¿˜æƒ³ç½‘ç»œåŒæ­¥ï¼Œæˆ‘çš„å»ºè®®æ˜¯åˆ æ‰æ‰‹åŠ¨çš„æ–‡ä»¶å¤¹å†æ¥æ‹‰å»å–ç½‘ç»œçš„\n#AppStream\nyum reposync --repoid=AppStream-external-Centos-Strem-8 --download-metadata -p /var/www/html/centos/8-stream/\n#BaseOS\nyum reposync --repoid=BaseOS-external-Centos-Strem-8 --download-metadata -p /var/www/html/centos/8-stream/\n#extras\nyum reposync --repoid=extras-external-Centos-Strem-8 --download-metadata -p /var/www/html/centos/8-stream/\n#æ³¨æ„ä¿®æ”¹åå­—å“¦\nmv /var/www/html/centos/8-stream/{AppStream-external-Centos-Strem-8,AppStream}\nmv /var/www/html/centos/8-stream/{BaseOS-external-Centos-Strem-8,BaseOS}\nmv /var/www/html/centos/8-stream/{extras-external-Centos-Strem-8,extras}\ncd /var/www/html/centos/8-stream/extras\nmv Packages x86_64/os/\nmv repodata x86_64/os/\n```\n\n![image-20250712004912125](../img/%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89Yum%E4%BB%93%E5%BA%93.assets/9e0d6eba9193a80736495d0d8bf901b255933597.png)\n\n### centos7\n\næ‰‹åŠ¨çš„æˆ‘å°±ä¸å†™äº†ä¸€ä¸ªæ„æ€ï¼Œè¿™é‡Œæˆ‘å°±å†™ç½‘ç»œçš„\n\n```bash\n#å…¬ç½‘\ncat > /etc/yum.repos.d/qianyios-external-centos7.repo<<\"EOF2\"\n[base-external-centos7]\nname=BaseOS-external-centos7\nbaseurl=https://mirrors.aliyun.com/centos/7/os/x86_64\ngpgkey=https://mirrors.aliyun.com/centos/7/os/x86_64/RPM-GPG-KEY-CentOS-7\ngpgcheck=1\nenabled=1\n[extras-external-centos7]\nname=extras-external-centos7\nbaseurl=https://mirrors.aliyun.com/centos/7/extras/x86_64/\ngpgkey=https://mirrors.aliyun.com/centos/7/os/x86_64/RPM-GPG-KEY-CentOS-7\ngpgcheck=1\nenabled=1\nEOF2\n```\n\n```bash\nmkdir -p /var/www/html/centos/7/os/x86_64/\n#bash\nyum reposync --repoid=base-external-centos7 --download-metadata -p /var/www/html/centos/7/\n#extras\nyum reposync --repoid=extras-external-centos7 --download-metadata -p /var/www/html/centos/7/\n#æ³¨æ„ä¿®æ”¹åå­—å“¦\nmv /var/www/html/centos/7/{base-external-centos7,base}\ncd /var/www/html/centos/7\nmv base os/x86_64/\n\nmv /var/www/html/centos/7/{extras-external-centos7,extras}\ncd /var/www/html/centos/7/extras\nmv Packages x86_64/\nmv repodata x86_64/\n```\n\n![image-20250712010733973](../img/%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89Yum%E4%BB%93%E5%BA%93.assets/512888a0524d84f3de2d2685b08394e855933597.png)\n\n## å®¢æˆ·ç«¯ä½¿ç”¨\n\næ“ä½œèŠ‚ç‚¹ï¼šã€Centos Stream 8ã€‘\n\n```bash\n#å¤‡ä»½åŸæœ‰çš„repo\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\n\n#å…¬ç½‘\ncat > /etc/yum.repos.d/qianyios-external-Centos-Strem-8.repo<<\"EOF2\"\n[AppStream-external-Centos-Strem-8]\nname=AppStream-external-Centos-Strem-8\nbaseurl=http://192.168.48.128/centos/8-stream/AppStream/x86_64/os/\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial\ngpgcheck=1\nenabled=1\n[BaseOS-external-Centos-Strem-8]\nname=BaseOS-external-Centos-Strem-8\nbaseurl=http://192.168.48.128/centos/8-stream/BaseOS/x86_64/os/\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial\ngpgcheck=1\nenabled=1\n[extras-external-Centos-Strem-8]\nname=extras-external-Centos-Strem-8\nbaseurl=http://192.168.48.128/centos/8-stream/extras/x86_64/os/\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial\ngpgcheck=1\nenabled=1\nEOF2\nyum clean all && yum makecache\n#æˆåŠŸ\n[root@qianyi ~]# yum clean all && yum makecache                                             13 files removed\nAppStream-external-Centos-Strem-8                           205 MB/s | 7.9 MB     00:00\nBaseOS-external-Centos-Strem-8                              158 MB/s | 2.7 MB     00:00\nextras-external-Centos-Strem-8                              6.2 MB/s |  18 kB     00:00\nMetadata cache created.\n[root@qianyi ~]#\n\n```\n\nå¦‚æœä»–æŠ¥è¿™ä¸ªé”™ï¼Œä½ è¦ç¡®ä¿ä½ çš„extrasä¸‹çš„é‚£ä¸ªè·¯å¾„æœ‰æ²¡æœ‰repodataè¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œæˆ–è€…çœ‹çœ‹è·¯å¾„å¯¹ä¸å¯¹\n\n![image-20250712130750985](../img/%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89Yum%E4%BB%93%E5%BA%93.assets/b67970571469859a6390c591bbe3be0455933597.png)\n\n\n\n\n\næ“ä½œèŠ‚ç‚¹ï¼šã€centos7ã€‘\n\n```bash\n#å¤‡ä»½åŸæœ‰çš„repo\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\n\ncat > /etc/yum.repos.d/qianyios-external-centos7.repo<<\"EOF2\"\n[base-external-centos7]\nname=BaseOS-external-centos7\nbaseurl=http://192.168.48.128/centos/7/os/x86_64/\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\ngpgcheck=1\nenabled=1\n[extras-external-centos7]\nname=extras-external-centos7\nbaseurl=http://192.168.48.128/centos/7/extras/x86_64/\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\ngpgcheck=1\nenabled=1\nEOF2\nyum clean all && yum makecache\n\n#æˆåŠŸ\n[root@localhost ~]# yum clean all && yum makecache\nLoaded plugins: fastestmirror, langpacks\nCleaning repos: base-external-centos7 extras-external-centos7\nCleaning up list of fastest mirrors\nOther repos take up 102 M of disk space (use --verbose for details)\nLoaded plugins: fastestmirror, langpacks\nDetermining fastest mirrors\nbase-external-centos7                                                | 3.6 kB  00:00:00\nextras-external-centos7                                              | 2.9 kB  00:00:00\n(1/7): base-external-centos7/group_gz                                | 153 kB  00:00:00\n(2/7): base-external-centos7/filelists_db                            | 3.3 MB  00:00:00\n(3/7): base-external-centos7/other_db                                | 1.3 MB  00:00:00\n(4/7): base-external-centos7/primary_db                              | 3.3 MB  00:00:00\n(5/7): extras-external-centos7/primary_db                            | 253 kB  00:00:00\n(6/7): extras-external-centos7/filelists_db                          | 305 kB  00:00:00\n(7/7): extras-external-centos7/other_db                              | 154 kB  00:00:00\nMetadata Cache Created\n[root@localhost ~]#\n\n```\n\n\n\n## æ€»ç»“\n\n1.ä½ è¦ä¸‹é‚£ä¸ªæºä»“åº“ï¼Œä½ å°±èµ°åˆ°å¯¹åº”çš„è·¯å¾„ï¼Œå¦‚æœçœ‹è§`repodataæ–‡ä»¶å¤¹`ï¼Œé‚£å°±æ˜¯è¿™ä¸ªè·¯å¾„äº†\n\n![image-20250712132539806](../img/%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89Yum%E4%BB%93%E5%BA%93.assets/6c849744d3cce48161d75a0b435288c955933597.png)\n\n2.å¦‚æœä½ æ˜¯æœ¬åœ°æµ‹è¯•ï¼Œæ‹‰çš„æ–‡ä»¶å¤ªå¤šå¾ˆå¤§ï¼Œä½ ç»ˆæ­¢äº†ä½ å¯èƒ½æ‹‰ä¸åˆ°repodataï¼Œæ‰€ä»¥ä½ å¯ä»¥é€šè¿‡å…‰ç›˜é‡Œçš„scpè¿‡å»yum server\n\n3.ä¸‡äº‹éƒ½è¦ç¡®å®šå¥½è·¯å¾„å–”ï¼Œå¦‚æœrepoå†™é”™äº†ï¼Œä½ å°±çœ‹çœ‹ä»–é‚£ä¸ªæŠ¥é”™çš„è·¯å¾„ä¸‹æœ‰æ²¡æœ‰repodata\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Yum"],"categories":["äº‘åŸç”Ÿ"]},{"title":"Rancherå®¹å™¨ç®¡ç†å¹³å°","url":"/posts/e650e0d0/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Rancherå®¹å™¨ç®¡ç†å¹³å°\n\n<img style=\"border-radius:15px;max-width:350px;max-height :100%;display:block;margin:0 auto 1.5rem\" src=\"Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/image-20250707005635650-1760710340224-1.png\" />\n\nRancher ä¸­æ–‡æ–‡æ¡£: https://docs.rancher.cn/\n\n## ä»€ä¹ˆæ˜¯ Rancherï¼Ÿ\n\nRancher æ˜¯ä¸€ä¸ª `Kubernetes` ç®¡ç†å·¥å…·ï¼Œè®©ä½ èƒ½åœ¨`ä»»ä½•åœ°æ–¹`å’Œ`ä»»ä½•æä¾›å•†`ä¸Šéƒ¨ç½²å’Œè¿è¡Œé›†ç¾¤ã€‚\n\nRancher å¯ä»¥åˆ›å»ºæ¥è‡ª Kubernetes æ‰˜ç®¡æœåŠ¡æä¾›å•†çš„é›†ç¾¤ï¼Œåˆ›å»ºèŠ‚ç‚¹å¹¶å®‰è£… Kubernetesï¼Œæˆ–è€…`å¯¼å…¥`åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œçš„`ç°æœ‰ Kubernetes é›†ç¾¤`ã€‚\n\nRancher åŸºäº Kubernetes æ·»åŠ äº†æ–°çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç»Ÿä¸€æ‰€æœ‰é›†ç¾¤çš„èº«ä»½éªŒè¯å’Œ RBACï¼Œè®©ç³»ç»Ÿç®¡ç†å‘˜ä»ä¸€ä¸ªä½ç½®æ§åˆ¶å…¨éƒ¨é›†ç¾¤çš„è®¿é—®ã€‚\n\næ­¤å¤–ï¼ŒRancher å¯ä»¥ä¸ºé›†ç¾¤å’Œèµ„æºæä¾›æ›´ç²¾ç»†çš„ç›‘æ§å’Œå‘Šè­¦ï¼Œå°†æ—¥å¿—å‘é€åˆ°å¤–éƒ¨æä¾›å•†ï¼Œå¹¶é€šè¿‡åº”ç”¨å•†åº—ï¼ˆApplication Catalogï¼‰ç›´æ¥é›†æˆ  Helmã€‚å¦‚æœä½ æ‹¥æœ‰å¤–éƒ¨ CI/CD ç³»ç»Ÿï¼Œä½ å¯ä»¥å°†å…¶ä¸ Rancher å¯¹æ¥ã€‚æ²¡æœ‰çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Rancher æä¾›çš„ Fleet  è‡ªåŠ¨éƒ¨ç½²å’Œå‡çº§å·¥ä½œè´Ÿè½½ã€‚\n\nRancher æ˜¯ä¸€ä¸ª *å…¨æ ˆå¼* çš„ Kubernetes å®¹å™¨ç®¡ç†å¹³å°ï¼Œä¸ºä½ æä¾›åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½æˆåŠŸè¿è¡Œ Kubernetes çš„å·¥å…·ã€‚\n\n\n\n## Dockeréƒ¨ç½²Rancher\n\n`ä»…éœ€ä¸‰æ­¥ï¼å¼€å¯Rancherä¹‹æ—…`\n\nå‡†å¤‡ä¸€å°Linuxä¸»æœº è¦æ±‚4GBå†…å­˜ï¼Œå¹¶ä¸”å·²ç»å®‰è£…Docker\n\nå®‰è£…æ•™ç¨‹ï¼š[ä½¿ç”¨ Docker å°† Rancher å®‰è£…åˆ°å•ä¸ªèŠ‚ç‚¹ä¸­](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker)\n\n> **`Docker å®‰è£…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸æ”¯æŒã€‚`**è¿™äº›è¯´æ˜ä»…ç”¨äºæµ‹è¯•å’Œå¼€å‘ç›®çš„ã€‚è¯·ä¸è¦ä½¿ç”¨æ­¤æ–¹æ³•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®‰è£… Rancherã€‚`Rancher çš„ Docker å®‰è£…ä»…æ¨èç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­`\n\n1.åŸºç¡€é…ç½®\n\nRancher å®¹å™¨å†…éƒ¨å¯åŠ¨äº† `k3s`ï¼Œå®ƒä¾èµ–äºåº•å±‚å®¿ä¸»æœºå…·å¤‡ **iptables æ”¯æŒ**ï¼ˆç”¨äºç½‘ç»œè½¬å‘ã€å®¹å™¨é—´é€šä¿¡ç­‰ï¼‰ï¼Œå¦åˆ™ä¼šå› ä¸º **ç¼ºå°‘ iptable_nat / iptable_filter æ¨¡å—** è€Œå¯¼è‡´ï¼š\n\n```bash\nyum install -y iptables\nmodprobe iptable_nat\nmodprobe iptable_filter\nsudo tee /etc/modules-load.d/modules.conf >/dev/null <<EOF \niptable_nat\niptable_filter\nEOF\nreboot\n```\n\n1.åˆ›å»ºrancheræŒ‚åœ¨ç›®å½•å’Œå®‰è£…rancher\n\n```bash\n#åˆ é™¤æ—§å®¹å™¨\ndocker rm -f qianyios_rancher\ndocker stop qianyios_rancher &> /dev/null && docker rm qianyios_rancher &> /dev/null \n#åˆ›å»ºrancheræŒ‚åœ¨ç›®å½•\nrm -rf /data/rancher_home\nmkdir -p /data/rancher_home/rancher\nmkdir -p /data/rancher_home/auditlog\nmkdir -p /data/rancher_home/rancher/k3s/agent/images/\ndocker run --rm --entrypoint \"\" -v $(pwd):/output rancher/rancher:latest cp /var/lib/rancher/k3s/agent/images/k3s-airgap-images.tar /output/\nmv k3s-airgap-images.tar /data/rancher_home/rancher/k3s/agent/images/\n\ndocker run -d --privileged --restart=unless-stopped \\\n  -p 80:80 -p 443:443 \\\n  -e TZ=Asia/Shanghai \\\n  -e CATTLE_SYSTEM_CATALOG=bundled \\\n  -v /data/rancher_home/rancher:/var/lib/rancher \\\n  -v /data/rancher_home/auditlog:/var/log/auditlog \\\n  --name qianyios_rancher registry.cn-guangzhou.aliyuncs.com/qianyios/rancher:latest\ndocker logs -f qianyios_rancher\n```\n\n-p `80`:80   **å¤–éƒ¨ç«¯å£**ï¼š80ï¼ˆå®¿ä¸»æœºç«¯å£ï¼‰ï¼š**å†…éƒ¨ç«¯å£**ï¼š80ï¼ˆå®¹å™¨ç«¯å£ï¼‰\n\n-p `443`:443  **å¤–éƒ¨ç«¯å£**ï¼š443ï¼ˆå®¿ä¸»æœºç«¯å£ï¼‰ï¼š**å†…éƒ¨ç«¯å£**ï¼š443ï¼ˆå®¹å™¨ç«¯å£ï¼‰\n\n`registry.cn-guangzhou.aliyuncs.com/qianyios/rancher:latest`æ˜¯æˆ‘è‡ªå·±æ„å»ºçš„é•œåƒï¼ˆä¸å®šæœŸæ›´æ–°ï¼Œå¯èƒ½ä¼šè½åç‰ˆæœ¬ï¼‰ï¼Œå¦‚æœæœ‰æ¡ä»¶å¯ä»¥ä¸‹è½½åŸç‰ˆé•œåƒ `rancher/rancher:latest`\n\næˆ–è€…ç”¨å›½å†…æ„å»ºçš„å®˜æ–¹é•œåƒ`registry.cn-hangzhou.aliyuncs.com/rancher/rancher:ç‰ˆæœ¬å·`è¿™ä¸ªä½ éœ€è¦æºå¸¦ç‰ˆæœ¬å·\n\n`--privileged` æ ‡å¿—ä¼šç»™å®¹å™¨å†…çš„è¿›ç¨‹å‡ ä¹ç›¸åŒäºå®¿ä¸»æœºçš„ç‰¹æƒã€‚è¿™æ„å‘³ç€å®¹å™¨å†…çš„è¿›ç¨‹å¯ä»¥è®¿é—®å®¿ä¸»æœºçš„æ‰€æœ‰è®¾å¤‡ï¼Œå¹¶ä¸”å¯ä»¥æ‰§è¡Œä¸€äº›é€šå¸¸éœ€è¦ç‰¹æƒçš„æ“ä½œï¼Œæ¯”å¦‚åŠ è½½å†…æ ¸æ¨¡å—ç­‰\n\n> è®¿é—®åœ°å€ï¼šhttps://192.168.48.10:443\n>\n\n![image-20250620191750583](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/95b827a5e641d89cee6e0f7318a90768697559838.png)\n\næŸ¥çœ‹å¯†ç \n\n```bash\ndocker logs qianyios_rancher  2>&1 | grep \"Bootstrap Password:\"\n```\n\n`qianyios_rancher`æ˜¯æˆ‘å‰é¢åˆ›å»ºå®¹å™¨çš„ä¸€ä¸ªåå­—\n\n> Bootstrap Password: `5qnwrp6gm9q28zsqnkbd2ktjxpkqkbt9rdbpb46c5xzf5qqkr8snx7`\n>\n\nè®¾ç½®è‡ªå®šä¹‰å¯†ç \n\n![image-20251017180828585](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/7483db8bfaa6f521d9ca2eb84407827a697559838.png)\n\n![image-20251017180846186](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/b2cd43f975b239b3a084c48caeaed910697559838.png)\n\né¦–é¡µå°±è¿™æ ·äº†ï¼Œå®‰è£…æˆåŠŸ\n\nè®¾ç½®ä¸­æ–‡\n\n![image-20250630171010286](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/fc8b661dd45df42da14023fe1b578625697559838.png)\n\n## åœ¨Kubernetesä¸Šéƒ¨ç½²Rancher\n\n> å¯èƒ½éœ€è¦é­”æ³•è¿›è¡Œæœ¬æ¬¡æ­¥éª¤\n\nåœ¨æ­¤ä¹‹å‰æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰çš„server]\n\n### å…ˆå†³æ¡ä»¶\n\n- [helm3](#Helm3)\n- [Kubernetes é›†ç¾¤](#Kubernetes é›†ç¾¤)\n- [Ingress Controller](#Ingress Controller)\n- [CLI å·¥å…·](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster#cli-å·¥å…·)\n\n\n\n#### Helm3\n\n`å»ºè®®æ‰€æœ‰çš„serverèŠ‚ç‚¹éƒ½å®‰è£…`\n\nå®˜ç½‘æ•™ç¨‹ï¼š[Helm3 å®‰è£…](https://www.zhaowenyu.com/helm-doc/install/helm3-install.html)\n\næœ¬æ•™æé»˜è®¤ä½ ä½¿ç”¨çš„æ˜¯helm3ï¼Œå¦‚æœæ²¡å®‰è£…è¯·æŒ‰ç…§ä»¥ä¸‹æ•™ç¨‹å®‰è£…ï¼Œå®‰è£…äº†å°±ç•¥è¿‡\n\n```bash\nsudo curl https://qygit.qianyisky.cn/https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n```\n\n![image-20250625174201913](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/825d9a50448b8eb49f44a7f89dc37229697559838.png)\n\n#### Kubernetes é›†ç¾¤\n\nè‡ªè¡Œéƒ¨ç½²ä¸€ä¸ªKubernetesé›†ç¾¤\n\nå·²ç»æµ‹è¯•è¿‡çš„Kubernetes\n\n[åŸºäºOpenEuleréƒ¨ç½²K3S](https://blog.qianyios.top/posts/998bbc2f/)\n\n[åŸºäºCentos7éƒ¨ç½²k3s](https://blog.qianyios.top/posts/df961508/)\n\n[OpenEuler-K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå†…éƒ¨etcdï¼‰](https://blog.qianyios.top/posts/62904/)\n\n\n\n#### Ingress Controller\n\nRancher UI å’Œ API é€šè¿‡ Ingress å…¬å¼€ã€‚æ¢è¨€ä¹‹ï¼Œå®‰è£… Rancher çš„ Kubernetes é›†ç¾¤å¿…é¡»åŒ…å«ä¸€ä¸ª Ingress Controllerã€‚\n\nå¯¹äº RKEã€RKE2 å’Œ `K3s`ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨å®‰è£… Ingress Controllerï¼Œå› ä¸ºå®ƒæ˜¯é»˜è®¤å®‰è£…çš„ã€‚\n\nå¯¹äºé»˜è®¤ä¸åŒ…å« Ingress Controller çš„å‘è¡Œç‰ˆï¼ˆä¾‹å¦‚ EKSã€GKE æˆ– AKS ç­‰æ‰˜ç®¡ Kubernetes é›†ç¾¤ï¼‰ï¼Œ`ä½ å¿…é¡»å…ˆéƒ¨ç½²  Ingress Controller`ã€‚è¯·æ³¨æ„ï¼ŒRancher Helm Chart é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šåœ¨ Ingress ä¸Šè®¾ç½® `ingressClassName`ã€‚å› æ­¤ï¼Œä½ å¿…é¡»å°† Ingress Controller é…ç½®ä¸ºåœ¨æ²¡æœ‰ `ingressClassName` çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ç›‘è§† Ingressã€‚\n\nä¸Šé¢çš„ **Amazon EKS**ã€**AKS** å’Œ **GKE** æ•™ç¨‹ä¸­åŒ…å«äº†ç¤ºä¾‹ã€‚\n\n\n\nå¦‚æœä¸æ˜¯RKEã€RKE2 å’Œ `K3s`çš„Kubernetesï¼Œä½ éœ€è¦æŒ‰ç…§ä¸€ä¸‹æ•™ç¨‹å®‰è£…Ingress Controller\n\n```bash\nsudo helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nsudo helm repo update\nsudo helm search repo ingress-nginx -l\n#è¿è¡Œæˆ‘æœ€åä¸€ä¸ªä¼šè·‘å‡ºæ¥å¾ˆå¤šingress-nginx\n```\n\n### å®‰è£… Rancher Helm Chart\n\nRancher æ˜¯ä½¿ç”¨ Kubernetes çš„ [Helm](https://helm.sh/) åŒ…ç®¡ç†å™¨å®‰è£…çš„ã€‚Helm Chart ä¸º Kubernetes YAML æ¸…å•æ–‡ä»¶æä¾›äº†æ¨¡æ¿è¯­æ³•ã€‚é€šè¿‡ Helmï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºå¯é…ç½®çš„ deploymentï¼Œè€Œä¸ä»…ä»…åªèƒ½ä½¿ç”¨é™æ€æ–‡ä»¶ã€‚\n\nå¦‚æœç³»ç»Ÿæ— æ³•ç›´æ¥è®¿é—®äº’è”ç½‘ï¼Œè¯·å‚è§[ç¦»çº¿ç¯å¢ƒï¼šKubernetes å®‰è£…](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-rancher-ha)ã€‚\n\nå¦‚æœè¦æŒ‡å®šå®‰è£…çš„ Rancher ç‰ˆæœ¬ï¼Œè¯·å‚è§[é€‰æ‹© Rancher ç‰ˆæœ¬](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/resources/choose-a-rancher-version)ã€‚\n\nå¦‚æœè¦æŒ‡å®šç”¨äºå®‰è£… Rancher çš„ Helm ç‰ˆæœ¬ï¼Œè¯·å‚è§[Helm ç‰ˆæœ¬è¦æ±‚](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/resources/helm-version-requirements)ã€‚\n\n\n\n`æœ¬å®‰è£…æŒ‡å—å‡å®šä½ ä½¿ç”¨çš„æ˜¯ Helm 3ã€‚`\n\n#### æ·»åŠ  Helm Chart ä»“åº“\n\næ“ä½œèŠ‚ç‚¹ï¼š[server1]\n\nLatestï¼šå»ºè®®ç”¨äºè¯•ç”¨æœ€æ–°åŠŸèƒ½\n\n```bash\nsudo helm repo add rancher-latest https://releases.rancher.com/server-charts/latest\n```\n\nStableï¼šå»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒ(`æœ¬å®éªŒå®éªŒè¿™ä¸ª`)\n\n```bash\nsudo helm repo add rancher-stable https://releases.rancher.com/server-charts/stable\n```\n\nAlphaï¼šå³å°†å‘å¸ƒçš„å®éªŒæ€§é¢„è§ˆã€‚\n\n```bash\nsudo helm repo add rancher-alpha https://releases.rancher.com/server-charts/alpha\n```\n\n æ³¨æ„ï¼šä¸æ”¯æŒå‡çº§åˆ° Alpha ç‰ˆã€ä» Alpha ç‰ˆå‡çº§æˆ–åœ¨ Alpha ç‰ˆä¹‹é—´å‡çº§ã€‚\n\n####  ä¸º Rancher åˆ›å»ºå‘½åç©ºé—´\n\n```bash\nkubectl create namespace cattle-system\n```\n\n#### é€‰æ‹© SSL é…ç½®\n\nRancher Management Server é»˜è®¤éœ€è¦ SSL/TLS é…ç½®æ¥ä¿è¯è®¿é—®çš„å®‰å…¨æ€§ã€‚\n\nä½ å¯ä»¥ä»ä»¥ä¸‹ä¸‰ç§è¯ä¹¦æ¥æºä¸­é€‰æ‹©ä¸€ç§ï¼Œç”¨äºåœ¨ Rancher Server ä¸­è®¾ç½® TLSï¼š\n\n- **Rancher ç”Ÿæˆçš„ TLS è¯ä¹¦**ï¼šè¦æ±‚ä½ åœ¨é›†ç¾¤ä¸­å®‰è£… `cert-manager`ã€‚Rancher ä½¿ç”¨ `cert-manager` ç­¾å‘å¹¶ç»´æŠ¤è¯ä¹¦ã€‚Rancher ä¼šç”Ÿæˆè‡ªå·±çš„ CA è¯ä¹¦ï¼Œå¹¶ä½¿ç”¨è¯¥ CA ç­¾ç½²è¯ä¹¦ã€‚ç„¶å `cert-manager`è´Ÿè´£ç®¡ç†è¯¥è¯ä¹¦ã€‚\n- **Let's Encrypt**ï¼šLet's Encrypt é€‰é¡¹ä¹Ÿéœ€è¦ä½¿ç”¨ `cert-manager`ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œcert-manager ä¸ Let's Encrypt çš„ç‰¹æ®Šé¢å‘è€…ç›¸ç»“åˆï¼Œè¯¥é¢å‘è€…æ‰§è¡Œè·å– Let's Encrypt é¢å‘çš„è¯ä¹¦æ‰€éœ€çš„æ‰€æœ‰æ“ä½œï¼ˆåŒ…æ‹¬è¯·æ±‚å’ŒéªŒè¯ï¼‰ã€‚æ­¤é…ç½®ä½¿ç”¨ HTTP éªŒè¯ï¼ˆ`HTTP-01`ï¼‰ï¼Œå› æ­¤è´Ÿè½½å‡è¡¡å™¨å¿…é¡»å…·æœ‰å¯ä»¥ä»äº’è”ç½‘è®¿é—®çš„å…¬å…± DNS è®°å½•ã€‚\n- **ä½ å·²æœ‰çš„è¯ä¹¦**ï¼šä½¿ç”¨å·²æœ‰çš„ CA é¢å‘çš„å…¬æœ‰æˆ–ç§æœ‰è¯ä¹¦ã€‚Rancher å°†ä½¿ç”¨è¯¥è¯ä¹¦æ¥ä¿æŠ¤ WebSocket å’Œ HTTPS æµé‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»ä¸Šä¼ åç§°åˆ†åˆ«ä¸º `tls.crt` å’Œ `tls.key`çš„ PEM æ ¼å¼çš„è¯ä¹¦ä»¥åŠç›¸å…³çš„å¯†é’¥ã€‚å¦‚æœä½ ä½¿ç”¨ç§æœ‰ CAï¼Œåˆ™è¿˜å¿…é¡»ä¸Šä¼ è¯¥ CA è¯ä¹¦ã€‚è¿™æ˜¯ç”±äºä½ çš„èŠ‚ç‚¹å¯èƒ½ä¸ä¿¡ä»»æ­¤ç§æœ‰ CAã€‚Rancher  å°†è·å–è¯¥ CA è¯ä¹¦ï¼Œå¹¶ä»ä¸­ç”Ÿæˆä¸€ä¸ªæ ¡éªŒå’Œï¼Œå„ç§ Rancher ç»„ä»¶å°†ä½¿ç”¨è¯¥æ ¡éªŒå’Œæ¥éªŒè¯å…¶ä¸ Rancher çš„è¿æ¥ã€‚\n\n| é…ç½®                       | Helm Chart é€‰é¡¹                  | æ˜¯å¦éœ€è¦ cert-manager                                        |\n| -------------------------- | -------------------------------- | ------------------------------------------------------------ |\n| Rancher ç”Ÿæˆçš„è¯ä¹¦ï¼ˆé»˜è®¤ï¼‰ | `ingress.tls.source=rancher`     | [æ˜¯](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster#4-å®‰è£…-cert-manager) |\n| Letâ€™s Encrypt              | `ingress.tls.source=letsEncrypt` | [æ˜¯](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster#4-å®‰è£…-cert-manager) |\n| ä½ å·²æœ‰çš„è¯ä¹¦               | `ingress.tls.source=secret`      | å¦                                                           |\n\n##### å®‰è£… cert-manager\n\nå»ºè®®æå‰ä¸‹è½½è¿™ä¸ªé•œåƒ`rancher/mirrored-library-traefik:3.3.6`\n\nå¦‚æœä½ ä½¿ç”¨è‡ªå·±çš„è¯ä¹¦æ–‡ä»¶ï¼ˆ`ingress.tls.source=secret`ï¼‰æˆ–ä½¿ç”¨[å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„ TLS è®¾ç½®](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/installation-references/helm-chart-options#å¤–éƒ¨-tls-ç»ˆæ­¢)ï¼Œä½ å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚\n\nä»…åœ¨ä½¿ç”¨ Rancher ç”Ÿæˆçš„è¯ä¹¦ï¼ˆ`ingress.tls.source=rancher`ï¼‰æˆ– Let's Encrypt é¢å‘çš„è¯ä¹¦ï¼ˆ`ingress.tls.source=letsEncrypt`ï¼‰æ—¶ï¼Œæ‰éœ€è¦å®‰è£… cert-managerã€‚\n\n```bash\n# å¦‚æœä½ æ‰‹åŠ¨å®‰è£…äº†CRDï¼Œè€Œä¸æ˜¯åœ¨ Helm å®‰è£…å‘½ä»¤ï¼ˆä¸‹é¢æœ€åä¸€æ¡å®‰è£…å‘½ä»¤ï¼‰ä¸­æ·»åŠ äº† `--set installCRDs=true` é€‰é¡¹ï¼Œä½ åº”è¯¥åœ¨å‡çº§ Helm Chart ä¹‹å‰å‡çº§ CRD èµ„æºã€‚\nsudo kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/<ç‰ˆæœ¬å·>/cert-manager.crds.yaml\n\n# æ·»åŠ  Jetstack Helm ä»“åº“\nsudo helm repo add jetstack https://charts.jetstack.io\n\n# æ›´æ–°æœ¬åœ° Helm Chart ä»“åº“ç¼“å­˜\nsudo helm repo update\n\n# å®‰è£… cert-manager Helm Chart\nsudo helm install cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --create-namespace \\\n  --set installCRDs=true\n```\n\n![image-20250630155004149](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/b632a47e4af8dd65e5f07a708a856bec697559838.png)\n\nè¿™é‡Œå¯èƒ½è¦ç­‰ä¸ªä¸€ä¸¤åˆ†é’Ÿ\n\n```bash\nsudo kubectl get pods --namespace cert-manager\n```\n\n```bash\n[abc@server1 ~]$ sudo kubectl get pods --namespace cert-manager\nNAME                                       READY   STATUS    RESTARTS   AGE\ncert-manager-7ccbc46c67-w6bpt              1/1     Running   0          118s\ncert-manager-cainjector-655bb66698-gsqm6   1/1     Running   0          118s\ncert-manager-webhook-586666dcd7-mhcmn      1/1     Running   0          118s\n```\n\nå¦‚æœè¦å¸è½½å°±ç”¨ä¸‹é¢çš„å‘½ä»¤\n\n```bash\nhelm uninstall cert-manager --namespace cert-manager\nkubectl delete namespace cert-manager\n```\n\n### æ ¹æ®ä½ é€‰æ‹©çš„è¯ä¹¦é€‰é¡¹ï¼Œé€šè¿‡ Helm å®‰è£… Rancher\n\næ—¥æœŸï¼š2025å¹´6æœˆ30æ—¥\n\nç›®å‰ä»–ä¼šç”¨åˆ°çš„è¿›è¡Œè¿‡æ˜¯`rancher/rancher:v2.11.3`ä½†æ˜¯æ‹‰å»å¾ˆæ…¢ã€‚é‚£ä½ å°±ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œåé¢å¦‚æœæ›´æ–°äº†ï¼Œæˆ‘å°±ä¸çŸ¥é“äº†ï¼Œä¸‹é¢æ˜¯æˆ‘è‡ªå·±æ„å»ºçš„é•œåƒï¼Œå¦‚æœç‰ˆæœ¬å˜é‡ï¼Œä½ å°±è‡ªå·±æ„å»ºé•œåƒï¼Œç„¶åè‡ªå·±æ‰“tagå°±è¡Œäº†\n\n```bash\nsudo docker pull registry.cn-guangzhou.aliyuncs.com/qianyios/rancher:v2.11.3\nsudo docker rmi rancher/rancher:v2.11.3\nsudo docker tag registry.cn-guangzhou.aliyuncs.com/qianyios/rancher:v2.11.3 rancher/rancher:v2.11.3\n```\n\n\n\n\n\nä¸åŒçš„è¯ä¹¦é…ç½®éœ€è¦ä½¿ç”¨ä¸åŒçš„ Rancher å®‰è£…å‘½ä»¤ã€‚\n\nä½†æ˜¯ï¼Œæ— è®ºè¯ä¹¦å¦‚ä½•é…ç½®ï¼ŒRancher åœ¨ `cattle-system` å‘½åç©ºé—´ä¸­çš„å®‰è£…åç§°åº”è¯¥æ€»æ˜¯ `rancher`ã€‚\n\n> æµ‹è¯•å’Œå¼€å‘ï¼š\n>\n> è¿™ä¸ªå®‰è£… Rancher çš„æœ€ç»ˆå‘½ä»¤éœ€è¦ä¸€ä¸ªå°†æµé‡è½¬å‘åˆ° Rancher çš„åŸŸåã€‚å¦‚æœä½ ä½¿ç”¨ Helm CLI è®¾ç½®æ¦‚å¿µè¯æ˜ï¼Œåˆ™å¯ä»¥åœ¨ä¼ å…¥ `hostname` é€‰é¡¹æ—¶ä½¿ç”¨ä¼ªåŸŸåã€‚ä¼ªåŸŸåçš„ä¸€ä¸ªä¾‹å­æ˜¯ `<IP_OF_LINUX_NODE>.sslip.io`ï¼Œè¿™ä¼šæŠŠ Rancher æš´éœ²åœ¨å®ƒè¿è¡Œçš„ IP ä¸Šã€‚ç”Ÿäº§å®‰è£…ä¸­è¦æ±‚å¡«å†™çœŸå®çš„åŸŸåã€‚\n\nè¿™é‡Œå°±ç”¨`Rancher ç”Ÿæˆçš„è¯ä¹¦`çš„æ–¹å¼ï¼Œå…¶ä»–çš„æ–¹å¼éœ€è¦è‡ªè¡Œè®¿é—®å®˜ç½‘[æ ¹æ®ä½ é€‰æ‹©çš„è¯ä¹¦é€‰é¡¹ï¼Œé€šè¿‡ Helm å®‰è£… Rancher](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster#5-%E6%A0%B9%E6%8D%AE%E4%BD%A0%E9%80%89%E6%8B%A9%E7%9A%84%E8%AF%81%E4%B9%A6%E9%80%89%E9%A1%B9%E9%80%9A%E8%BF%87-helm-%E5%AE%89%E8%A3%85-rancher)\n\n```bash\n#æ·»åŠ  Rancher çš„ Helm ä»“åº“\nsudo helm uninstall rancher --namespace cattle-system\nsudo helm repo add rancher-stable https://releases.rancher.com/server-charts/stable\nsudo helm repo update\n```\n\n#### åŸŸåå®‰è£…æ–¹å¼\n\né»˜è®¤æƒ…å†µæ˜¯ä½¿ç”¨ Rancher ç”Ÿæˆ CAï¼Œå¹¶ä½¿ç”¨ `cert-manager` é¢å‘ç”¨äºè®¿é—® Rancher Server æ¥å£çš„è¯ä¹¦ã€‚\n\nç”±äº `rancher` æ˜¯ `ingress.tls.source` çš„é»˜è®¤é€‰é¡¹ï¼Œå› æ­¤åœ¨æ‰§è¡Œ `helm install` å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦æŒ‡å®š `ingress.tls.source`ã€‚\n\n- å°† `hostname` è®¾ç½®ä¸ºè§£æåˆ°ä½ çš„è´Ÿè½½å‡è¡¡å™¨çš„ DNS åç§°ã€‚\n- å°† `bootstrapPassword` è®¾ç½®ä¸º `admin` ç”¨æˆ·ç‹¬æœ‰çš„å€¼ã€‚\n- å¦‚æœä½ éœ€è¦å®‰è£…æŒ‡å®šçš„ Rancher ç‰ˆæœ¬ï¼Œä½¿ç”¨ `--version` æ ‡å¿—ï¼Œä¾‹å¦‚ `--version 2.7.0`ã€‚\n- å¯¹äº Kubernetes v1.25 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œä½¿ç”¨ Rancher v2.7.2-v2.7.4 æ—¶ï¼Œå°† `global.cattle.psp.enabled` è®¾ç½®ä¸º `false`ã€‚å¯¹äº Rancher v2.7.5 åŠæ›´é«˜ç‰ˆæœ¬æ¥è¯´ï¼Œè¿™ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†ä½ ä»ç„¶å¯ä»¥æ‰‹åŠ¨è®¾ç½®è¯¥é€‰é¡¹ã€‚\n\n`ä½ è¦è‡ªè¡Œæ›´æ”¹åŸŸå`\n\n```bash\nsudo helm install rancher rancher-stable/rancher \\\n  --namespace cattle-system \\\n  --create-namespace \\\n  --set hostname=qianyios.top \\\n  --set bootstrapPassword=admin \\\n  --set global.cattle.psp.enabled=false\n```\n\nå¦‚æœä½ å®‰è£…çš„æ˜¯ alpha ç‰ˆæœ¬ï¼ŒHelm ä¼šè¦æ±‚ä½ åœ¨å®‰è£…å‘½ä»¤ä¸­æ·»åŠ  `--devel` é€‰é¡¹ï¼š\n\n![image-20250630160806666](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/d502be1fc03d6f6bce4b8a913bfb0cfa697559838.png)\n\nå¦‚æœä½ å¸Œæœ›ä½¿ç”¨åŸŸåè®¿é—® Rancherï¼Œå¯ä»¥åœ¨å®¿ä¸»æœºä¸Šé…ç½® `hosts` æ–‡ä»¶ï¼Œå¹¶å°† Helm å®‰è£…å‘½ä»¤ä¸­çš„ `hostname` å‚æ•°æ”¹ä¸ºåŸŸåã€‚\n\n#### **NodePort**ï¼ˆæœ¬å®éªŒç”¨è¿™ä¸ªï¼‰\n\nå¦‚æœä½ ä¸æƒ³é…ç½®åŸŸåï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½® Kubernetes çš„ `NodePort` æˆ– `LoadBalancer` æ¥è®¿é—® Rancherã€‚\n\n```bash\nsudo helm install rancher rancher-stable/rancher \\\n  --namespace cattle-system \\\n  --create-namespace \\\n  --set hostname=192.168.48.200 \\\n  --set bootstrapPassword=admin \\\n  --set global.cattle.psp.enabled=false \\\n  --set ingress.enabled=false \\\n  --set service.type=NodePort\n```\n\n```\nsudo kubectl get pods,svc -n cattle-system\n```\n\n![image-20250630165640476](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/969c6fb33ba647983e63c4b0e4a3903d697559838.png)\n\nRancherçš„è®¿é—®åœ°å€å°±æ˜¯https://192.168.48.200:32684\n\n#### **LoadBalancer**\n\n- å¦‚æœä½ çš„ Kubernetes ç¯å¢ƒæ”¯æŒ `LoadBalancer`ï¼Œå¯ä»¥å°† `service.type` è®¾ç½®ä¸º `LoadBalancer`ï¼š\n\n```bash\nsudo helm install rancher rancher-stable/rancher \\\n  --namespace cattle-system \\\n  --create-namespace \\\n  --set hostname=192.168.48.200 \\\n  --set bootstrapPassword=admin \\\n  --set global.cattle.psp.enabled=false \\\n  --set ingress.enabled=false \\\n  --set service.type=LoadBalancer\n```\n\n\n\n\n\nç­‰å¾… Rancher è¿è¡Œï¼š\n\n```bash\nkubectl -n cattle-system rollout status \n```\n\n```bash\n[root@server1 ~]# kubectl -n cattle-system rollout status deploy/rancher\ndeployment \"rancher\" successfully rolled out\n[root@server1 ~]#\n```\n\nRancher Chart æœ‰è®¸å¤šé€‰é¡¹ï¼Œç”¨äºä¸ºä½ çš„å…·ä½“ç¯å¢ƒè‡ªå®šä¹‰å®‰è£…ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é«˜çº§æ–¹æ¡ˆï¼š\n\n- [HTTP ä»£ç†](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/installation-references/helm-chart-options#http-ä»£ç†)\n- [ç§æœ‰å®¹å™¨é•œåƒä»“åº“](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/installation-references/helm-chart-options#ç§æœ‰ä»“åº“å’Œç¦»çº¿å®‰è£…)\n- [å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šçš„ TLS ç»ˆæ­¢](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/installation-references/helm-chart-options#å¤–éƒ¨-tls-ç»ˆæ­¢)\n\nå¦‚éœ€è·å–å®Œæ•´çš„é€‰é¡¹åˆ—è¡¨ï¼Œè¯·å‚è§ [Chart é€‰é¡¹](https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/installation-references/helm-chart-options)ã€‚\n\n### éªŒè¯ Rancher Server æ˜¯å¦éƒ¨ç½²æˆåŠŸ\n\n```bash\nkubectl -n cattle-system get deploy rancher\n```\n\n```bash\n[root@server1 ~]# kubectl -n cattle-system get deploy rancher\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nrancher   3/3     3            3           36m\n[root@server1 ~]#\n```\n\n`DESIRED` å’Œ `AVAILABLE`çš„ä¸ªæ•°åº”è¯¥ç›¸åŒã€‚\n\n### é¡µé¢è®¿é—®\n\n![image-20250630170634387](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/3ca9272c524cce9bac3105bbca6ba66a697559838.png)\n\n![image-20250630170754565](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/a36f65f5b66b736669f5a618333015ca697559838.png)\n\nè®¾ç½®ä¸­æ–‡\n\n![image-20250630171010286](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/fc8b661dd45df42da14023fe1b578625697559838.png)\n\n\n\n## æ·»åŠ å·²æœ‰é›†ç¾¤\n\næˆ‘è¿™æ˜¯dockerå•æœºéƒ¨ç½²çš„\n\n![image-20250630171252221](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/44a3abc7382554d0d2a04e26f201149f697559838.png)\n\n![image-20250630171312088](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/93ba70d5e6cc76afd02a79e3f84e491a697559838.png)\n\n![image-20251017201955831](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/45673c8b70f3d2bac912b9cae32da248697559838.png)\n\nè¿™ä¸ªå‘½ä»¤ï¼Œå¯èƒ½è¦è¿è¡Œä¸¤æ¬¡ï¼Œpodæ‰èƒ½æ­£å¸¸å¯åŠ¨\n\n```bash\nkubectl get pod -n cattle-system\n```\n\nåº”è¯¥æ˜¯è¿™æ ·å°±è¡Œäº†\n\n```bash\nroot@master1:~# kubectl get pod -n cattle-system\nNAME                                    READY   STATUS      RESTARTS   AGE\ncattle-cluster-agent-7bf6ff696b-bjr9j   1/1     Running     0          4m25s\ncattle-cluster-agent-7bf6ff696b-jld5k   1/1     Running     0          3m1s\nhelm-operation-tmgh9                    0/2     Completed   0          2m38s\nrancher-webhook-848f5d4d8-ld2fx         1/1     Running     0          102s\nroot@master1:~#\n\n```\n\n![image-20251017212415374](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/94a64a2bf95be1bae5339ef3fea188d1697559838.png)\n\n## å¸è½½å·²æœ‰é›†ç¾¤\n\n```bash\ncurl --insecure -sfL https://192.168.48.129/v3/import/lpjc8x94xw5jr64g6qrnp248jpddd8n9wdsdksml57vw8w4w7zhp87_c-m-xngwq9z9.yaml | kubectl delete -f -\n#æ®‹ç•™è¦åˆ å¹²å‡€\nroot@master1:~# kubectl get mutatingwebhookconfigurations\nNAME                WEBHOOKS   AGE\nrancher.cattle.io   4          33m\nroot@master1:~# kubectl delete validatingwebhookconfigurations  rancher.cattle.io\nvalidatingwebhookconfiguration.admissionregistration.k8s.io \"rancher.cattle.io\" deleted\n\n```\n\n\n\n## æ·»åŠ é›†ç¾¤çº§åˆ«çš„ç›‘æ§\n\n![image-20251017212715693](../img/Rancher%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0.assets/4199d1c64f05d78d00be02cc79f7b78f697559838.png)\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["K8s","K3s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"åŸºäºCentos7éƒ¨ç½²k3s","url":"/posts/df961508/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# åŸºäºCentos7éƒ¨ç½²k3s\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå  |       ip       | CPU  | å†…å­˜  |\n| :-----: | :------------: | :--: | :---: |\n| Server1 | 192.168.48.101 |  â‰§2  |  2G   |\n| Server2 | 192.168.48.102 |  â‰§2  |  2G   |\n| Server3 | 192.168.48.103 |  â‰§2  |  2G   |\n| Agent1  | 192.168.49.104 |  â‰§1  | 512MB |\n\nå¦‚æœä½ æ˜¯åªç”¨å•serve1åªéœ€è¦åˆ›å»ºserver1å’Œè‹¥å¹²å°agentï¼Œéƒ¨ç½²æ•™ç¨‹è¯·è·³è½¬[3.åŸºç¡€k3s](#åŸºç¡€k3s)\n\nå¦‚æœä½ æ˜¯é«˜å¯ç”¨ä¸€å®šéœ€è¦ä¿ç•™â‰¥3å°çš„serverèŠ‚ç‚¹ï¼Œéƒ¨ç½²æ•™ç¨‹è¯·è·³è½¬[6.é«˜å¯ç”¨k3s](#é«˜å¯ç”¨k3s)\n\nå‰ææ˜¯è¦å®Œæˆ[2.åŸºç¡€é…ç½®](#åŸºç¡€é…ç½®)\n\n## åŸºç¡€é…ç½®\n\né«˜å¯ç”¨å’ŒåŸºç¡€k3séƒ½è¦è¿è¡Œ\n\n### ç³»ç»Ÿåˆå§‹åŒ–\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\n```\nsudo vi system_init.sh\n```\n\n```bash\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\necho \"2.æ­£åœ¨å…³é—­firewalldã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl stop firewalld\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nNAME=ens33\nUUID=53b402ff-5865-47dd-a853-7afcd6521738\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS1=192.168.48.2\nDNS2=114.114.114.114\nEOF\nnmcli c reload\nnmcli c up ens33\n\necho \"4.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\nyum clean all && yum makecache\n\necho \"5.æ·»åŠ hostsè§£æ\"\ncat > /etc/hosts <<EOF\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.101 Server1\n192.168.48.102 Server2\n192.168.48.103 Server3\n192.168.48.104 Agent1\nEOF\n\necho \"6.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet socat device-mapper-persistent-data lvm2 git gcc -y\n\necho \"7.é‡å¯ç³»ç»Ÿ\"\nreboot\n```\n\n```\nsudo chmod +x system_init.sh\n[Server1] sudo sh system_init.sh Server1 101\n[Server2] sudo sh system_init.sh Server2 102\n[Server3] sudo sh system_init.sh Server3 103\n[Agent1] sudo sh system_init.sh Agent1 104\n```\n\n### å®‰è£…å®¹å™¨å·¥å…·\n\nè¯·ä½ è€ƒè™‘å¥½ï¼Œä½ çš„é›†ç¾¤è¦ä»¥ä»€ä¹ˆä¸ºè¿è¡Œæ—¶ï¼Œä¸‹é¢æä¾›äº†ï¼Œdockerå’Œcontainerdï¼Œè‡ªè¡Œé€‰æ‹©\n\n`åªèƒ½äºŒé€‰ä¸€ï¼ï¼ï¼`\n\n`åªèƒ½äºŒé€‰ä¸€ï¼ï¼ï¼`\n\n`åªèƒ½äºŒé€‰ä¸€ï¼ï¼ï¼`\n\n#### å®‰è£…docker\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\n```bash\nsudo curl -L \"https://qygit.qianyisky.cn/https://github.com/docker/compose/releases/download/v2.35.1/docker-compose-linux-x86_64\" -o /usr/local/bin/docker-compose\n#å¸è½½æ—§ç‰ˆæœ¬\nsudo yum -y remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-selinux \\\n                  docker-engine-selinux \\\n                  docker-engine\nsudo yum remove docker-ce docker-ce-cli containerd.io docker-compose docker-machine docker-swarm -y\nsudo rm /etc/yum.repos.d/docker-ce.repo\nsudo rm -rf /var/lib/docker\n\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsudo yum install docker-ce -y\nsudo systemctl enable --now docker\nsudo chmod +x /usr/local/bin/docker-compose\nsudo tee /etc/docker/daemon.json > /dev/null <<'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.xuanyuan.me\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://docker.1panel.live\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n    \"https://docker.qianyios.top\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  },\n  \"data-root\": \"/var/lib/docker\"\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\nsudo docker-compose --version\nsudo docker version\n\n```\n\n#### å®‰è£…containerd\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\n```bash\nsudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsudo yum clean all && yum makecache\nsudo yum install -y containerd.io\n\nsudo mkdir -p /etc/containerd/certs.d/docker.io\nsudo mkdir -p /etc/containerd/certs.d/registry.k8s.io\nsudo mkdir -p /etc/containerd/certs.d/k8s.gcr.io\nsudo mkdir -p /etc/containerd/certs.d/ghcr.io\nsudo mkdir -p /etc/containerd/certs.d/gcr.io\nsudo mkdir -p /etc/containerd/certs.d/quay.io\nsudo mkdir -p /etc/containerd/certs.d/registry-1.docker.io\n\nsudo tee /etc/containerd/certs.d/docker.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://docker.io\" \n\n[host.\"https://registry.cn-hangzhou.aliyuncs.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.xuanyuan.me\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1ms.run\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1panel.live\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.qianyios.top/\"] \n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://reg-mirror.giniu.com\"] \n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/registry-1.docker.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://registry-1.docker.io\"\n\n[host.\"https://registry.cn-hangzhou.aliyuncs.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.xuanyuan.me\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1ms.run\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1panel.live\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.qianyios.top/\"] \n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://reg-mirror.giniu.com\"] \n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\n\nsudo tee /etc/containerd/certs.d/k8s.gcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://k8s.gcr.io\"\n\n[host.\"https://registry.aliyuncs.com/google_containers\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/ghcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://ghcr.io\"\n\n[host.\"https://ghcr.m.daocloud.io/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/gcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://gcr.io\"\n\n[host.\"https://gcr.m.daocloud.io/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/registry.k8s.io/hosts.toml > /dev/null <<'EOF'\nserver = \"registry.k8s.io\"\n\n[host.\"k8s.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\", \"push\"]\n[host.\"https://registry.aliyuncs.com/v2/google_containers\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/quay.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://quay.io\"\n\n[host.\"https://quay.tencentcloudcr.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo sh -c 'containerd config default > /etc/containerd/config.toml'\nsudo sed -i 's#sandbox_image = \"registry.k8s.io/pause:.*\"#sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.10\"#' /etc/containerd/config.toml\nsudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\nsed -i '/\\[plugins\\.\"io\\.containerd\\.grpc\\.v1\\.cri\"\\.registry\\]/!b;n;s/config_path = \"\"/config_path = \"\\/etc\\/containerd\\/certs.d\"/' /etc/containerd/config.toml\n# é‡å¯ containerd æœåŠ¡\nsudo systemctl daemon-reload\nsudo systemctl restart containerd.service\nsudo ctr image ls\n```\n\n### æ·»åŠ é•œåƒæº\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\n```bash\nsudo mkdir -p /etc/rancher/k3s\nsudo tee /etc/rancher/k3s/registries.yaml > /dev/null <<'EOF'\nmirrors:\n  docker.io:\n    endpoint:\n      - \"https://registry.cn-hangzhou.aliyuncs.com/\" \n      - \"https://docker.xuanyuan.me\" \n      - \"https://docker.m.daocloud.io\" \n      - \"https://docker.1ms.run\" \n      - \"https://docker.1panel.live\" \n      - \"https://hub.rat.dev\" \n      - \"https://docker-mirror.aigc2d.com\" \n      - \"https://docker.qianyios.top/\"\n  quay.io:\n    endpoint:\n      - \"https://quay.tencentcloudcr.com/\"   \n  registry.k8s.io:\n    endpoint:\n      - \"https://registry.aliyuncs.com/v2/google_containers\"   \n  gcr.io:\n    endpoint:\n      - \"https://gcr.m.daocloud.io/\"   \n  k8s.gcr.io:\n    endpoint:\n      - \"https://registry.aliyuncs.com/google_containers\"   \n  ghcr.io:\n    endpoint:\n      - \"https://ghcr.m.daocloud.io/\"   \nEOF\n```\n\nå»ºè®®åœ¨è¿™é‡Œæ‰“ä¸ªå¿«ç…§\n\n## åŸºç¡€k3s\n\nç¡®ä¿`æ‰€æœ‰èŠ‚ç‚¹`éƒ½ä¸‹è½½äº†k3så®‰è£…è„šæœ¬\n\n```bash\nsudo wget https://rancher-mirror.rancher.cn/k3s/k3s-install.sh\nsudo chmod +x k3s-install.sh\n```\n\nè¿™é‡Œç›®å‰åªéœ€è¦ç”¨åˆ°`Server1`å’Œ`Agent1`ï¼Œä¹Ÿå°±æ˜¯å•server1æƒ…å†µ\n\n### éƒ¨ç½²Server\n\næ“ä½œèŠ‚ç‚¹ï¼š[Server1]\n\nå¦‚éœ€åœ¨å•ä¸ªæœåŠ¡å™¨ä¸Šå®‰è£… K3sï¼Œå¯ä»¥åœ¨ server èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n#### åŸºäºdocker\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n`--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh --docker \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\"\n```\n\n![image-20250616205458407](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/bde1ec698699808fb7751fdde90a7dcd697559838.png)\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\"\n```\n\n![image-20250613193916684](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/12f9e6a5a1135484d1e4bc7a8ada5256697559838.png)\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n\n\n### éƒ¨ç½²AgentèŠ‚ç‚¹\n\næ“ä½œèŠ‚ç‚¹ï¼š[Server1]\n\n#### æŸ¥çœ‹token\n\n```\nsudo cat /var/lib/rancher/k3s/server/node-token\n```\n\n> K107eca1d1c601a2d308c7dd0b639ef08fa9414f729c720c0cc04337126aa966884::server:`035b03761950e59b30e9f5310b92310c`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n#### åŸºäºdocker\n\næ“ä½œèŠ‚ç‚¹ï¼š[Agent1]\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n`--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nK3S_URL=https://192.168.48.101:6443  \\\nK3S_TOKEN=035b03761950e59b30e9f5310b92310c \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh --docker\n```\n\nÂ· `035b03761950e59b30e9f5310b92310c` æ˜¯å‰é¢`server1`è·å–çš„`token`\n\nÂ· `192.168.48.101`æ˜¯`server1`çš„ip\n\n![image-20250616210407492](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/15e3404f50570f307b5dded0292238d3697559838.png)\n\nè¿™æ—¶å€™åœ¨server1æŸ¥çœ‹æ˜¯å¦æˆåŠŸåŠ å…¥é›†ç¾¤\n\n```\nsudo kubectl get nodes\n```\n\n![image-20250613194651483](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/0f97418fbf0e0118e49005e7542d0e46697559838.png)\n\nå¦‚æœéœ€è¦éƒ¨ç½²dashboardè¯·è·³è½¬[7.å®‰è£…dashboard](#å®‰è£…dashboard)\n\n#### åŸºäºcontainerd\n\næ“ä½œèŠ‚ç‚¹ï¼š[Agent1]\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nK3S_URL=https://192.168.48.101:6443  \\\nK3S_TOKEN=035b03761950e59b30e9f5310b92310c \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh \n```\n\nÂ· `035b03761950e59b30e9f5310b92310c` æ˜¯å‰é¢`server1`è·å–çš„`token`\n\nÂ· `192.168.48.101`æ˜¯`server1`çš„ip\n\n![image-20250613194635932](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/8e61bfe3289eeb8f6eddf5ac82a63dcb697559838.png)\n\nè¿™æ—¶å€™åœ¨server1æŸ¥çœ‹æ˜¯å¦æˆåŠŸåŠ å…¥é›†ç¾¤\n\n```\nsudo kubectl get nodes\n```\n\n![image-20250613194651483](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/0f97418fbf0e0118e49005e7542d0e46697559838.png)\n\nå¦‚æœéœ€è¦éƒ¨ç½²dashboardè¯·è·³è½¬[7.å®‰è£…dashboard](#å®‰è£…dashboard)\n\n\n\n## é«˜å¯ç”¨k3s\n\nç¡®ä¿`æ‰€æœ‰èŠ‚ç‚¹`éƒ½ä¸‹è½½äº†k3så®‰è£…è„šæœ¬\n\n```bash\nsudo wget https://rancher-mirror.rancher.cn/k3s/k3s-install.sh\nsudo chmod +x k3s-install.sh\n```\n\n\n\n\n\n### é…ç½®é›†ç¾¤è´Ÿè½½å‡è¡¡å™¨\n\nå®˜æ–¹æ•™ç¨‹ï¼š[é›†ç¾¤è´Ÿè½½å‡è¡¡å™¨](https://docs.k3s.io/datastore/cluster-loadbalancer)\n\næŒ‰ç†æ¥è¯´æˆ‘ä»¬éœ€è¦ä¸¤å°é¢å¤–çš„èŠ‚ç‚¹æ¥åšè´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨vipèŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥éƒ¨ç½²åœ¨\n\nserverèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç¬¬äºŒç§æ–¹æ³•\n\n![image-20250613122740304](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/b60fa286a35dc9a7d720bda96d7eafe0697559838.png)\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰çš„server]\n\n```bash\nsudo yum install -y haproxy keepalived\nsudo tee /etc/haproxy/haproxy.cfg > /dev/null <<'EOF'\nfrontend k3s-frontend\n    bind *:16443\n    mode tcp\n    option tcplog\n    default_backend k3s-backend\n\nbackend k3s-backend\n    mode tcp\n    option tcp-check\n    balance roundrobin\n    timeout connect 5s\n    timeout server 30s\n    timeout client 30s\n    default-server inter 10s downinter 5s\n    server server-1 192.168.48.101:6443 check\n    server server-2 192.168.48.102:6443 check\n    server server-3 192.168.48.103:6443 check\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹:[Server1]\n\n```bash\nsudo tee /etc/keepalived/keepalived.conf > /dev/null <<'EOF'\nglobal_defs {\n  enable_script_security\n  script_user root\n}\n\nvrrp_script chk_haproxy {\n    script 'killall -0 haproxy'\n    interval 2\n}\n\nvrrp_instance haproxy-vip {\n    interface ens33  #è¿™é‡Œè¦æ”¹ï¼Œæ˜¯ä½ çš„ç½‘å¡\n    state MASTER    #è¿™é‡Œè¦æ”¹ server1æ˜¯Master å…¶ä»–éƒ½æ˜¯Backup\n    priority 200\n\n    virtual_router_id 51\n\n    virtual_ipaddress {\n        192.168.48.200/24      #é«˜å¯ç”¨ip\n    }\n\n    track_script {\n        chk_haproxy\n    }\n}\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹:[Server2]\n\n```bash\nsudo tee /etc/keepalived/keepalived.conf > /dev/null <<'EOF'\nglobal_defs {\n  enable_script_security\n  script_user root\n}\n\nvrrp_script chk_haproxy {\n    script 'killall -0 haproxy'\n    interval 2\n}\n\nvrrp_instance haproxy-vip {\n    interface ens33  #è¿™é‡Œè¦æ”¹ï¼Œæ˜¯ä½ çš„ç½‘å¡\n    state BACKUP    #è¿™é‡Œè¦æ”¹ server1æ˜¯Master å…¶ä»–éƒ½æ˜¯Backup\n    priority 150\n\n    virtual_router_id 51\n\n    virtual_ipaddress {\n        192.168.48.200/24      #é«˜å¯ç”¨ip\n    }\n\n    track_script {\n        chk_haproxy\n    }\n}\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹:[Server3]\n\n```bash\nsudo tee /etc/keepalived/keepalived.conf > /dev/null <<'EOF'\nglobal_defs {\n  enable_script_security\n  script_user root\n}\n\nvrrp_script chk_haproxy {\n    script 'killall -0 haproxy'\n    interval 2\n}\n\nvrrp_instance haproxy-vip {\n    interface ens33  #è¿™é‡Œè¦æ”¹ï¼Œæ˜¯ä½ çš„ç½‘å¡\n    state BACKUP    #è¿™é‡Œè¦æ”¹ server1æ˜¯Master å…¶ä»–éƒ½æ˜¯Backup\n    priority 100\n\n    virtual_router_id 51\n\n    virtual_ipaddress {\n        192.168.48.200/24      #é«˜å¯ç”¨ip\n    }\n\n    track_script {\n        chk_haproxy\n    }\n}\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰çš„Server]\n\n```\nsudo systemctl restart haproxy keepalived\nsudo systemctl enable --now haproxy keepalived\n```\n\nç°åœ¨æ¥æŸ¥çœ‹vipæ˜¯å¦ç”Ÿæˆ\n\næ“ä½œèŠ‚ç‚¹ï¼š[Server1]\n\n```\nip a\n```\n\n![image-20250613123125034](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/a590e445a0e0a85df625e3bc22ed6e28697559838.png)\n\n### åˆå§‹åŒ–ç¬¬ä¸€ä¸ªserver\n\næ“ä½œèŠ‚ç‚¹:[server1]\n\n\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n\n\n#### åŸºäºdocker\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n> `--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nK3S_TOKEN=qianyiosQianyios12345 \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh --docker --cluster-init - server  \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\" \\\n--tls-san= 192.168.48.200 \n```\n\n`qianyiosQianyios12345`æ˜¯ä½œä¸ºé›†ç¾¤é—´çš„å…±äº«å¯†é’¥ï¼Œå¯è‡ªå®šä¹‰\n\n![image-20250616210830594](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/d5d187541485a0092c117127cce849d5697559838.png)\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nK3S_TOKEN=qianyiosQianyios12345 \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh  --cluster-init - server \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\" \\\n--tls-san= 192.168.48.200\n```\n\n`qianyiosQianyios12345`æ˜¯ä½œä¸ºé›†ç¾¤é—´çš„å…±äº«å¯†é’¥ï¼Œå¯è‡ªå®šä¹‰\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n\n\n\n\n### å…¶ä»–serveråŠ å…¥é›†ç¾¤\n\n#### åŸºäºdocker\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n`--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nK3S_TOKEN=qianyiosQianyios12345 \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh --docker \\\n--server https://192.168.48.101:6443  \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\" \\\n--tls-san= 192.168.48.200\n```\n\n`qianyiosQianyios12345`æ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªserver1å…±äº«å‡ºæ¥çš„å¯†é’¥\n\n--server https://192.168.48.101:6443 æ”¹æˆserve1çš„ipåœ°å€å³å¯\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nK3S_TOKEN=qianyiosQianyios12345 \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\" \\\n--server https://192.168.48.101:6443  \\\n--tls-san= 192.168.48.200\n```\n\n`qianyiosQianyios12345`æ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªserver1å…±äº«å‡ºæ¥çš„å¯†é’¥\n\n--server https://192.168.48.101:6443 æ”¹æˆserve1çš„ipåœ°å€å³å¯\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n\n\n### å…¶ä»–AgentåŠ å…¥é›†ç¾¤\n\n#### åŸºäºdocker\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n`--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nK3S_TOKEN=qianyiosQianyios12345 \\\nK3S_URL=https://192.168.48.101:6443  \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh --docker - agent \n```\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n```bash\nsudo \\\nINSTALL_K3S_MIRROR=cn \\\nK3S_TOKEN=qianyiosQianyios12345 \\\nK3S_URL=https://192.168.48.101:6443  \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\n./k3s-install.sh - agent\n```\n\n\n\nè¿™æ—¶å€™åœ¨Serverå¯ä»¥æŸ¥çœ‹nodeæƒ…å†µ\n\n```\nsudo kubectl get nodes\n```\n\n![image-20250613112245716](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/a9ccac4fb814c1504457caf23fe59a19697559838.png)\n\n\n\n## å®‰è£…dashboard\n\nåœ¨åŸºç¡€æˆ–é«˜å¯ç”¨k3séƒ½å¯ä»¥ä½¿ç”¨\n\næ“ä½œèŠ‚ç‚¹:[Server1]\n\n```bash\nsudo wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml && \\\nsudo sed -i 's/kubernetesui\\/dashboard:v2.7.0/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/dashboard:v2.7.0/g' recommended.yaml \nsleep 3\nsudo sed -i 's/kubernetesui\\/metrics-scraper:v1.0.8/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/metrics-scraper:v1.0.8/g' recommended.yaml \nsudo sed -i '/targetPort: 8443/a\\      nodePort: 30001' recommended.yaml \nsudo sed -i '/nodePort: 30001/a\\  type: NodePort' recommended.yaml\n\n```\n\nè¿è¡Œpod\n\n```bash\nsudo kubectl apply -f recommended.yaml\n```\n\nåˆ›å»ºtoken\n\n```bash\n#åˆ›å»ºservice accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜ç¾¤è§’è‰²\n#åˆ›å»ºç”¨æˆ·\nsudo kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n#ç”¨æˆ·æˆæƒ\nsudo kubectl create clusterrolebinding dashboard-admin \\\n--clusterrole=cluster-admin \\\n--serviceaccount=kubernetes-dashboard:dashboard-admin\n#ä¸´æ—¶è·å–ç”¨æˆ·Tokenï¼ˆé»˜è®¤åªæœ‰ 30 åˆ†é’Ÿ ï¼‰\nsudo kubectl create token dashboard-admin -n kubernetes-dashboard\n#æ°¸ä¹…è·å–ç”¨æˆ·Token\nsudo cat <<EOF | sudo kubectl apply -f -\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-admin-token\n  namespace: kubernetes-dashboard\n  annotations:\n    kubernetes.io/service-account.name: dashboard-admin\ntype: kubernetes.io/service-account-token\nEOF\n\nKUBECONFIG_FILE=\"dashboard-kubeconfig.yaml\"\n\n# è‡ªåŠ¨è·å– API Server åœ°å€\nAPISERVER=$(sudo kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')\n\n# è‡ªåŠ¨è·å– CA è¯ä¹¦\nCA_CERT=$(sudo kubectl config view --raw -o jsonpath='{.clusters[0].cluster.certificate-authority-data}')\n\n# è‡ªåŠ¨ä» Secret è·å– Tokenï¼ˆä½ æåˆ°çš„æ­£ç¡®æ–¹å¼ï¼‰\nTOKEN=$(sudo kubectl get secret dashboard-admin-token -n kubernetes-dashboard -o jsonpath='{.data.token}' | base64 --decode)\n\n# ç”Ÿæˆ kubeconfig æ–‡ä»¶\nsudo cat <<EOF > ${KUBECONFIG_FILE}\napiVersion: v1\nkind: Config\nclusters:\n  - name: kubernetes\n    cluster:\n      server: ${APISERVER}\n      certificate-authority-data: ${CA_CERT}\nusers:\n  - name: dashboard-admin\n    user:\n      token: ${TOKEN}\ncontexts:\n  - name: dashboard-context\n    context:\n      cluster: kubernetes\n      user: dashboard-admin\ncurrent-context: dashboard-context\nEOF\n\necho \"âœ… kubeconfig æ–‡ä»¶å·²ç”Ÿæˆï¼š${KUBECONFIG_FILE}\"\n```\n\nè¿™æ—¶å€™å°±ä¼šæç¤ºä½ \n\n`âœ… kubeconfig æ–‡ä»¶å·²ç”Ÿæˆï¼šdashboard-kubeconfig.yaml`\n\nä½ å°±æŠŠè¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°dashboardçš„kubeconfigå°±å¯ä»¥å…å¯†ç™»å…¥äº†\n\nè¿™ä¸ª192.168.48.200æ˜¯é«˜å¯ç”¨åœ°å€\n\n![image-20250613124501754](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/7d51bc1aeca562d4be1dcc3326dbb63e697559838.png)\n\n## é«˜å¯ç”¨æ¨¡æ‹Ÿå®•æœºæµ‹è¯•\n\næŸ¥çœ‹dashboardéƒ¨ç½²åœ¨å“ªä¸ªèŠ‚ç‚¹\n\n```\nsudo kubectl get pods -A -l k8s-app=kubernetes-dashboard -o wide\nsudo kubectl get nodes\n```\n\næˆ‘è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯dashboardéƒ¨ç½²åœ¨Server1\n\né‚£ä¹ˆæˆ‘ä»¬å°±å¯¹Server1è¿›è¡Œpowerofå…³æœºï¼Œæ¥æ¨¡æ‹Ÿå®•æœºçœ‹çœ‹dashboardèƒ½å¦è¢«k3sè‡ªåŠ¨è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹\n\nä½†æ˜¯æˆ‘å‘ç°podè¿˜åœ¨runningçš„çŠ¶æ€,ä¸”server1çš„çŠ¶æ€è¿˜æ˜¯ready\n\n![image-20250613125547207](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/8b9c60575353e9f37f0eaf5a1186de39697559838.png)\n\n> **server2 å·²ç»è¢«æ ‡è®°ä¸º NotReady**\n>\n> è¯´æ˜ Kubernetes å·²æ„ŸçŸ¥åˆ°å®ƒä¸å¯ç”¨ï¼ˆå¯èƒ½æ˜¯å…³æœºã€ç½‘ç»œä¸é€šæˆ– kubelet å´©æºƒç­‰ï¼‰ï¼Œä½†ï¼š\n>\n> - å¦‚æœ Pod çš„å‰¯æœ¬æ•°æ˜¯ `1`ï¼ŒKubernetes **ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ Pod** ã€‚\n> - é»˜è®¤çš„èŠ‚ç‚¹å¤±è”å®¹å¿æ—¶é—´è¾ƒé•¿ï¼ˆ5åˆ†é’Ÿï¼‰ï¼Œæ‰€ä»¥å³ä½¿èŠ‚ç‚¹ NotReadyï¼Œä¹Ÿä¸ä¼šç«‹åˆ»è§¦å‘ Pod é©±é€ã€‚\n\næ–¹æ¡ˆä¸€ ç­‰å¾…äº”åˆ†é’Ÿ\n\nç»è¿‡æ¼«é•¿ç­‰å¾…ï¼Œdashboardçš„podè¿›è¡Œäº†é‡æ–°åˆ†é…\n\n![image-20250607230458318](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/501b0e08678ce2ef780e38410057b3e4697559838.png)\n\n```\nkubectl get pods -A -l k8s-app=kubernetes-dashboard -o wide\n```\n\nç»è¿‡æŸ¥çœ‹å·²ç»è¢«è°ƒåº¦åˆ°äº†Agent1èŠ‚ç‚¹\n\n![image-20250613130344022](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/8d07a02ce5f6c91f607ccf5c03675e41697559838.png)\n\nè€Œä¸”ï¼ŒåŸæœ¬server1çš„é«˜å¯ç”¨ipï¼Œç°å·²ç»æ¼‚ç§»åˆ°äº†server2äº†ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ç”¨é«˜å¯ç”¨ipè®¿é—®k3så†…çš„æ‰€æœ‰pod\n\n![image-20250613130447595](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/08c9d6eb391eb0fa04187073fbc82ebb697559838.png)\n\n\n\nç»“è®ºï¼šé«˜å¯ç”¨å®éªŒï¼Œå®éªŒæˆåŠŸï¼Œä¸”é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®\n\n\n\næ–¹æ¡ˆäºŒ æ‰‹åŠ¨åˆ é™¤ Pod å¼ºåˆ¶é‡å»ºï¼ˆæ¨èæµ‹è¯•ï¼‰\n\nç”±äºåˆšåˆšç»è¿‡æ–¹æ¡ˆä¸€çš„æµ‹è¯•ï¼Œè¢«è°ƒåº¦åˆ°äº†Agent1ï¼Œæ‰€ä»¥è¿™æ¬¡å¯¹Agent1è¿›è¡Œæ¨¡æ‹Ÿå®•æœºï¼Œç„¶åæ‰‹åŠ¨åˆ é™¤pod\n\n```\nsudo kubectl delete pod -n kubernetes-dashboard podåå­—\n```\n\n![image-20250613130645950](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/7a94f2b88cea969d1dec856cde53ecad697559838.png)\n\nç»è¿‡æ‰‹åŠ¨åˆ é™¤ï¼Œç«‹é©¬è§¦å‘è‡ªåŠ¨è°ƒåº¦ï¼Œå·²ç»è¢«è°ƒåº¦åˆ°äº†Server3èŠ‚ç‚¹\n\nç»“è®ºï¼šé«˜å¯ç”¨å®éªŒï¼Œå®éªŒæˆåŠŸï¼Œä¸”é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®\n\n\n\næ–¹æ¡ˆä¸‰ ç¼©çŸ­èŠ‚ç‚¹å¤±è”å®¹å¿æ—¶é—´ï¼ˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰\n\nå¦‚æœä½ å¸Œæœ› Kubernetes æ›´å¿«åœ°å“åº”èŠ‚ç‚¹æ•…éšœï¼Œå¯ä»¥åœ¨ K3s å¯åŠ¨å‚æ•°ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n\n```bash\n--node-monitor-grace-period=20s \\\n--pod-eviction-timeout=30s\n```\n\nâš ï¸ æ³¨æ„ï¼šè¿™ä¼šå½±å“æ•´ä¸ªé›†ç¾¤çš„è¡Œä¸ºï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒæˆ–éœ€è¦å¿«é€Ÿæ•…éšœæ¢å¤çš„åœºæ™¯ã€‚ \n\n## ä¿®æ”¹å¯åŠ¨å‚æ•°\n\nå¦‚æœä½ åœ¨å®‰è£…çš„æ—¶å€™æœ‰äº›å‚æ•°è¾“å…¥é”™äº†ï¼Œæˆ–è€…æƒ³æ”¹ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ”¹\n\né¦–å…ˆï¼Œåœæ­¢ K3s æœåŠ¡ä»¥é¿å…åœ¨æ›´æ–°è¿‡ç¨‹ä¸­å‡ºç°å†²çªï¼š\n\n```bash\nsudo systemctl stop k3s\n```\n\nä¿®æ”¹k3så¯åŠ¨å‚æ•°\n\n```\nsudo vi /etc/systemd/system/k3s.service\n```\n\n![image-20250613170641600](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/11583dba92ff2427d6336567eb3aa384697559838.png)\n\nå‡è®¾ä½ çš„--tls-sançš„é«˜å¯ç”¨åœ°å€è¾“å…¥é”™äº†ï¼Œè¦æ”¹æˆåˆ«çš„ï¼Œä½ å°±æ”¹å®Œï¼Œè®°å¾—ä¿å­˜\n\nç„¶ååˆ é™¤æ—§è¯ä¹¦\n\n```bash\nsudo rm -f /var/lib/rancher/k3s/server/tls/serving-kube-apiserver*\nsudo rm -f /var/lib/rancher/k3s/server/tls/server*\n```\n\né‡å¯æœåŠ¡\n\n```bash\nsudo systemctl daemon-reload\nsudo systemctl start k3s\n```\n\n## å¸è½½K3S\n\nå®˜æ–¹æ•™ç¨‹ï¼š[Uninstalling K3s | K3s](https://docs.k3s.io/installation/uninstall)\n\n### å¸è½½Server\n\nè¦ä»æœåŠ¡å™¨èŠ‚ç‚¹å¸è½½ K3sï¼Œè¯·è¿è¡Œï¼š\n\n```bash\n/usr/local/bin/k3s-uninstall.sh\n```\n\n### å¸è½½Agent\n\nè¦ä»ä»£ç†èŠ‚ç‚¹å¸è½½ K3sï¼Œè¯·è¿è¡Œï¼š\n\n```bash\n/usr/local/bin/k3s-agent-uninstall.sh\n```\n\n\n\n## è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•\n\nè¿™æ—¶å€™è¿è¡ŒæŸ¥çœ‹èŠ‚ç‚¹å‘½ä»¤ï¼Œæç¤ºæ‰¾ä¸åˆ°å‘½ä»¤\n\n```\nsudo kubectl get nodes\n```\n\nä¸€çœ‹å‘ç°åªæœ‰å…·ä½“åˆ°æŒ‡å®šè·¯å¾„æ‰å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”ç”¨æˆ·å’Œæƒé™ç»„éƒ½æ˜¯root\n\n![image-20250613105655993](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/d2f6f6e28d0e9a0af95230b6e6fc77b8697559838.png)\n\nè¿™æ—¶å€™åœ¨æ™®é€šç”¨æˆ·æŸ¥çœ‹visudo\n\n```\nsudo visudo\n```\n\n![image-20250613105736470](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/21748195328130ac5fdcdaed79a8ad49697559838.png)\n\nä¸€çœ‹åœ°å€ï¼Œä»–å¹¶æ²¡æœ‰`/usr/local/bin`çš„è·¯å¾„ï¼Œæ‰€ä»¥æ™®é€šç”¨æˆ·æ˜¯æ²¡åŠæ³•ç»§æ‰¿rootçš„è·¯å¾„çš„ï¼Œæ‰€ä»¥ä½ è¦è®¾ç½®æ™®é€šç”¨æˆ·é»˜è®¤çš„ç¯å¢ƒå˜é‡ï¼ˆç”Ÿæˆç¯å¢ƒï¼Œå»ºè®®ä»”ç»†æ–Ÿé…Œè¦ä¸è¦æ·»åŠ ï¼Œä¸ç„¶å°±åªèƒ½ç”¨ç»å¯¹è·¯å¾„ï¼‰\n\n```\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n```\n\n![image-20250613110011514](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/014bcd88aadaf8de3808363bcb41677a697559838.png)\n\nè¿™æ—¶å€™å†æ¬¡è¿è¡Œk3så‘½ä»¤\n\n```\nsudo kubectl get nodes\nsudo crictl images\n```\n\n![image-20250613110125426](../img/%E5%9F%BA%E4%BA%8ECentos7%E9%83%A8%E7%BD%B2k3s.assets/ffe7d121595518b42f9147014a8558d9697559838.png)\n\n\n\n\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Centos 7","K3s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"åŸºäºOpenEuleréƒ¨ç½²K3S","url":"/posts/998bbc2f/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# åŸºäºOpenEuleréƒ¨ç½²K3S\n\n## ä»‹ç»\n\n**ä»€ä¹ˆæ˜¯K3s**\n\nK3s æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Kubernetes å‘è¡Œç‰ˆï¼Œå®ƒé’ˆå¯¹è¾¹ç¼˜è®¡ç®—ã€ç‰©è”ç½‘ç­‰åœºæ™¯è¿›è¡Œäº†é«˜åº¦ä¼˜åŒ–ã€‚K3s æœ‰ä»¥ä¸‹å¢å¼ºåŠŸèƒ½ï¼š\n\n- æ‰“åŒ…ä¸ºå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚\n- ä½¿ç”¨åŸºäº sqlite3 çš„è½»é‡çº§å­˜å‚¨åç«¯ä½œä¸ºé»˜è®¤å­˜å‚¨æœºåˆ¶ã€‚åŒæ—¶æ”¯æŒä½¿ç”¨ etcd3ã€MySQL å’Œ PostgreSQL ä½œä¸ºå­˜å‚¨æœºåˆ¶ã€‚\n- å°è£…åœ¨ç®€å•çš„å¯åŠ¨ç¨‹åºä¸­ï¼Œé€šè¿‡è¯¥å¯åŠ¨ç¨‹åºå¤„ç†å¾ˆå¤šå¤æ‚çš„ TLS å’Œé€‰é¡¹ã€‚\n- é»˜è®¤æƒ…å†µä¸‹æ˜¯å®‰å…¨çš„ï¼Œå¯¹è½»é‡çº§ç¯å¢ƒæœ‰åˆç†çš„é»˜è®¤å€¼ã€‚\n- æ·»åŠ äº†ç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„batteries-includedåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šæœ¬åœ°å­˜å‚¨æä¾›ç¨‹åºï¼ŒæœåŠ¡è´Ÿè½½å‡è¡¡å™¨ï¼ŒHelm controller å’Œ Traefik Ingress controllerã€‚\n- æ‰€æœ‰ Kubernetes control-plane ç»„ä»¶çš„æ“ä½œéƒ½å°è£…åœ¨å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å’Œè¿›ç¨‹ä¸­ï¼Œä½¿ K3s å…·æœ‰è‡ªåŠ¨åŒ–å’Œç®¡ç†åŒ…æ‹¬è¯ä¹¦åˆ†å‘åœ¨å†…çš„å¤æ‚é›†ç¾¤æ“ä½œçš„èƒ½åŠ›ã€‚\n- æœ€å¤§ç¨‹åº¦å‡è½»äº†å¤–éƒ¨ä¾èµ–æ€§ï¼ŒK3s ä»…éœ€è¦ kernel å’Œ cgroup æŒ‚è½½ã€‚\n\nopeneulerç¤¾åŒºæ•™ç¨‹ï¼š[K3séƒ¨ç½²æŒ‡å— | openEulerç¤¾åŒº | v24.03_LTS](https://docs.openeuler.openatom.cn/zh/docs/24.03_LTS/docs/K3s/K3séƒ¨ç½²æŒ‡å—.html#)\n\nK3sçš„æ›´å¤šç”¨æ³•å¯ä»¥å‚è€ƒK3så®˜ç½‘\n\nhttps://rancher.com/docs/k3s/latest/en/ \n\nhttps://docs.rancher.cn/k3s/\n\nK3så®˜ç½‘é‡‡ç”¨ä¸‹è½½å¯¹åº”æ¶æ„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ï¼Œé€šè¿‡install.shè„šæœ¬è¿›è¡Œç¦»çº¿å®‰è£…ï¼ŒopenEulerç¤¾åŒºå°†è¯¥äºŒè¿›åˆ¶æ–‡ä»¶çš„ç¼–è¯‘è¿‡ç¨‹ç§»æ¤åˆ°ç¤¾åŒºä¸­ï¼Œå¹¶ç¼–è¯‘å‡ºRPMåŒ…ã€‚æ­¤å¤„å¯é€šè¿‡yumå‘½ä»¤ç›´æ¥è¿›è¡Œä¸‹è½½å®‰è£…ã€‚\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå  |       ip       | CPU  | å†…å­˜  |\n| :-----: | :------------: | :--: | :---: |\n| Server1 | 192.168.48.101 |  â‰§2  |  2G   |\n| Server2 | 192.168.48.102 |  â‰§2  |  2G   |\n| Server3 | 192.168.48.103 |  â‰§2  |  2G   |\n| Agent1  | 192.168.49.104 |  â‰§1  | 512MB |\n\nå¦‚æœä½ æ˜¯åªç”¨å•serve1åªéœ€è¦åˆ›å»ºserver1å’Œè‹¥å¹²å°agentï¼Œéƒ¨ç½²æ•™ç¨‹è¯·è·³è½¬[4.åŸºç¡€k3s](#åŸºç¡€K3S)\n\nå¦‚æœä½ æ˜¯é«˜å¯ç”¨ä¸€å®šéœ€è¦`â‰¥3`å°çš„serverèŠ‚ç‚¹ï¼Œéƒ¨ç½²æ•™ç¨‹è¯·è·³è½¬[5.é«˜å¯ç”¨K3Sï¼ˆå†…éƒ¨etcdï¼‰](#é«˜å¯ç”¨K3Sï¼ˆå†…éƒ¨etcdï¼‰)\n\nå‰ææ˜¯è¦å®Œæˆ[3.åŸºç¡€é…ç½®](#åŸºç¡€é…ç½®)\n\n## åŸºç¡€é…ç½®\n\n### ç³»ç»Ÿåˆå§‹åŒ–\n\nç¡®ä¿serverèŠ‚ç‚¹åŠagentèŠ‚ç‚¹ä¸»æœºåä¸ä¸€è‡´\n\n```bash\nvi system_init.sh\n```\n\n```bash\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\necho \"2.æ­£åœ¨å…³é—­firewalldã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl stop firewalld\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nNAME=ens33\nUUID=53b402ff-5865-47dd-a853-7afcd6521738\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS1=192.168.48.2\nDNS2=114.114.114.114\nEOF\nnmcli c reload\nnmcli c up ens33\n\necho \"4.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\nyum clean all && yum makecache\n\necho \"5.æ·»åŠ hostsè§£æ\"\ncat > /etc/hosts <<EOF\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.101 Server1\n192.168.48.102 Agent1\nEOF\n\necho \"6.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet socat device-mapper-persistent-data lvm2 git gcc -y\n\necho \"7.é‡å¯ç³»ç»Ÿ\"\nreboot\n```\n\n```bash\nsh system_init.sh ä¸»æœºå  ä¸»æœºä½\n\n[Server1] sh system_init.sh Server1 101\n[Agent1] sh system_init.sh Agent1 102\n```\n\n### å®‰è£…å®¹å™¨å·¥å…·\n\nè¯·ä½ è€ƒè™‘å¥½ï¼Œä½ çš„é›†ç¾¤è¦ä»¥ä»€ä¹ˆä¸ºè¿è¡Œæ—¶ï¼Œä¸‹é¢æä¾›äº†ï¼Œdockerå’Œcontainerdï¼Œè‡ªè¡Œé€‰æ‹©\n\n`åªèƒ½äºŒé€‰ä¸€ï¼ï¼ï¼`\n\n`åªèƒ½äºŒé€‰ä¸€ï¼ï¼ï¼`\n\n`åªèƒ½äºŒé€‰ä¸€ï¼ï¼ï¼`\n\n#### å®‰è£…docker\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\n```bash\nsudo curl -L \"https://qygit.qianyisky.cn/https://github.com/docker/compose/releases/download/v2.35.1/docker-compose-linux-x86_64\" -o /usr/local/bin/docker-compose\n#å¸è½½æ—§ç‰ˆæœ¬\nsudo yum -y remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-selinux \\\n                  docker-engine-selinux \\\n                  docker-engine\nsudo yum remove docker-ce docker-ce-cli containerd.io docker-compose docker-machine docker-swarm -y\nsudo rm /etc/yum.repos.d/docker-ce.repo\nsudo rm -rf /var/lib/docker\n\nsudo yum install -y device-mapper-persistent-data lvm2\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nsudo sed -i 's/\\$releasever/8/g' /etc/yum.repos.d/docker-ce.repo\nsudo yum install docker-ce docker-ce-cli containerd.io -y\nsudo systemctl enable --now docker\nsudo chmod +x /usr/local/bin/docker-compose\nsudo tee /etc/docker/daemon.json > /dev/null <<'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.xuanyuan.me\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://docker.1panel.live\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n    \"https://docker.qianyios.top\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  },\n  \"data-root\": \"/var/lib/docker\"\n}\nEOF\nsystemctl daemon-reload\nsystemctl restart docker\ndocker-compose --version\ndocker version\n```\n\n#### å®‰è£…containerd\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\n```bash\nsudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsudo yum clean all && yum makecache\nsudo yum install -y containerd.io\n\nsudo mkdir -p /etc/containerd/certs.d/docker.io\nsudo mkdir -p /etc/containerd/certs.d/registry.k8s.io\nsudo mkdir -p /etc/containerd/certs.d/k8s.gcr.io\nsudo mkdir -p /etc/containerd/certs.d/ghcr.io\nsudo mkdir -p /etc/containerd/certs.d/gcr.io\nsudo mkdir -p /etc/containerd/certs.d/quay.io\nsudo mkdir -p /etc/containerd/certs.d/registry-1.docker.io\n\nsudo tee /etc/containerd/certs.d/docker.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://docker.io\" \n\n[host.\"https://registry.cn-hangzhou.aliyuncs.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.xuanyuan.me\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1ms.run\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1panel.live\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.qianyios.top/\"] \n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://reg-mirror.giniu.com\"] \n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/registry-1.docker.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://registry-1.docker.io\"\n\n[host.\"https://registry.cn-hangzhou.aliyuncs.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.xuanyuan.me\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1ms.run\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1panel.live\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.qianyios.top/\"] \n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://reg-mirror.giniu.com\"] \n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\n\nsudo tee /etc/containerd/certs.d/k8s.gcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://k8s.gcr.io\"\n\n[host.\"https://registry.aliyuncs.com/google_containers\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/ghcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://ghcr.io\"\n\n[host.\"https://ghcr.m.daocloud.io/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/gcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://gcr.io\"\n\n[host.\"https://gcr.m.daocloud.io/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/registry.k8s.io/hosts.toml > /dev/null <<'EOF'\nserver = \"registry.k8s.io\"\n\n[host.\"k8s.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\", \"push\"]\n[host.\"https://registry.aliyuncs.com/v2/google_containers\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/quay.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://quay.io\"\n\n[host.\"https://quay.tencentcloudcr.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo sh -c 'containerd config default > /etc/containerd/config.toml'\nsudo sed -i 's#sandbox_image = \"registry.k8s.io/pause:.*\"#sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.10\"#' /etc/containerd/config.toml\nsudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\nsed -i '/\\[plugins\\.\"io\\.containerd\\.grpc\\.v1\\.cri\"\\.registry\\]/!b;n;s/config_path = \"\"/config_path = \"\\/etc\\/containerd\\/certs.d\"/' /etc/containerd/config.toml\n# é‡å¯ containerd æœåŠ¡\nsudo systemctl daemon-reload\nsudo systemctl restart containerd.service\nsudo ctr image ls\n```\n\n### æ·»åŠ é•œåƒæº\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\n```bash\nsudo mkdir -p /etc/rancher/k3s\nsudo tee /etc/rancher/k3s/registries.yaml > /dev/null <<'EOF'\nmirrors:\n  docker.io:\n    endpoint:\n      - \"https://registry.cn-hangzhou.aliyuncs.com/\" \n      - \"https://docker.xuanyuan.me\" \n      - \"https://docker.m.daocloud.io\" \n      - \"https://docker.1ms.run\" \n      - \"https://docker.1panel.live\" \n      - \"https://hub.rat.dev\" \n      - \"https://docker-mirror.aigc2d.com\" \n      - \"https://docker.qianyios.top/\"\n  quay.io:\n    endpoint:\n      - \"https://quay.tencentcloudcr.com/\"   \n  registry.k8s.io:\n    endpoint:\n      - \"https://registry.aliyuncs.com/v2/google_containers\"   \n  gcr.io:\n    endpoint:\n      - \"https://gcr.m.daocloud.io/\"   \n  k8s.gcr.io:\n    endpoint:\n      - \"https://registry.aliyuncs.com/google_containers\"   \n  ghcr.io:\n    endpoint:\n      - \"https://ghcr.m.daocloud.io/\"   \nEOF\n```\n\nå»ºè®®åœ¨è¿™é‡Œæ‰“ä¸ªå¿«ç…§\n\n## åŸºç¡€K3S\n\n### éƒ¨ç½²K3s\n\nç”±äºOpenEulerå·²ç»ç¼–è¯‘å¥½RPMçš„åŒ…äº†ï¼Œå¯ä»¥ç›´æ¥å®‰è£…\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰èŠ‚ç‚¹]\n\n```bash\nyum install -y k3s\n```\n\n### éƒ¨ç½²serverèŠ‚ç‚¹\n\næ“ä½œèŠ‚ç‚¹ï¼š[Server1]\n\nå¦‚éœ€åœ¨å•ä¸ªæœåŠ¡å™¨ä¸Šå®‰è£… K3sï¼Œå¯ä»¥åœ¨ server èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n#### åŸºäºdocker\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n`--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh --docker \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\"\n```\n\n![image-20250617004334000](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/017af539defa578bc8bedea1df41f8bd697559838.png)\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n```bash\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\"\n```\n\n![image-20250604204942034](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/fbf400a017791c185a32a25b434a3161697559838.png)\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n\n\næŸ¥çœ‹é•œåƒåˆ—è¡¨å’Œpodæƒ…å†µ\n\n```\ncrictl images\nkubectl get pod -A\n```\n\n![image-20250606143307535](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/f96abc979e77c4b83c1d1cec8f91eacb697559838.png)\n\n\n\n\n\n### éƒ¨ç½²AgentèŠ‚ç‚¹\n\næ“ä½œèŠ‚ç‚¹ï¼š[Server1]\n\n#### æŸ¥çœ‹token\n\n```\ncat /var/lib/rancher/k3s/server/node-token\n```\n\n> `K10ed18fcd528981577fe508d419bd28fefeef1c372ccc246a79fff1fa4b371e5e1::server:a02d22a5169cdc2465bd989360029283`\n\n\n\n#### åŸºäºdocker\n\næ“ä½œèŠ‚ç‚¹ï¼š[Agent1]\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n`--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nK3S_URL=https://192.168.48.101:6443  \\\nK3S_TOKEN=a02d22a5169cdc2465bd989360029283 \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh --docker\n```\n\nÂ· `a02d22a5169cdc2465bd989360029283` æ˜¯å‰é¢`server1`è·å–çš„`token`\n\nÂ· `192.168.48.101`æ˜¯`server1`çš„ip\n\n![image-20250616210407492](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/72eee756fcd019a4745d92de0ce1cabd697559838.png)\n\nè¿™æ—¶å€™åœ¨server1æŸ¥çœ‹æ˜¯å¦æˆåŠŸåŠ å…¥é›†ç¾¤\n\n```\nsudo kubectl get nodes\n```\n\n![image-20250613194651483](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/2057ac475b9b1a5e9b472e91218e1bd4697559838.png)\n\nå¦‚æœéœ€è¦éƒ¨ç½²dashboardè¯·è·³è½¬[6.å®‰è£…dashboard](#å®‰è£…dashboard)\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\næ“ä½œèŠ‚ç‚¹ï¼š[Agent1]\n\n```bash\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nK3S_URL=https://192.168.48.101:6443  \\\nK3S_TOKEN=a02d22a5169cdc2465bd989360029283 \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh \n```\n\nÂ· `a02d22a5169cdc2465bd989360029283` æ˜¯å‰é¢`server1`è·å–çš„`token`\n\nÂ· `192.168.48.101`æ˜¯`server1`çš„ip\n\n![image-20250607175545654](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/6e765ea6a7006123a9773425ad9ab34d697559838.png)\n\nå¦‚æœéœ€è¦éƒ¨ç½²dashboardè¯·è·³è½¬[6.å®‰è£…dashboard](#å®‰è£…dashboard)\n\n## é«˜å¯ç”¨K3Sï¼ˆå†…éƒ¨etcdï¼‰\n\nå®˜æ–¹æ•™ç¨‹ï¼š[é«˜å¯ç”¨åµŒå…¥å¼ etcd](https://docs.k3s.io/zh/datastore/ha-embedded)\n\nå…·æœ‰åµŒå…¥å¼ etcd çš„ HA K3s é›†ç¾¤ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š\n\n- `ä¸‰ä¸ªæˆ–å¤šä¸ª` **Server èŠ‚ç‚¹**ä¸º Kubernetes API æä¾›æœåŠ¡å¹¶è¿è¡Œå…¶ä»– control plane æœåŠ¡ï¼Œä»¥åŠæ‰˜ç®¡åµŒå…¥å¼ etcd æ•°æ®å­˜å‚¨ã€‚\n- å¯é€‰ï¼šé›¶ä¸ªæˆ–å¤šä¸ª **Agent èŠ‚ç‚¹**ï¼Œç”¨äºè¿è¡Œä½ çš„åº”ç”¨å’ŒæœåŠ¡\n- å¯é€‰ï¼š**å›ºå®šæ³¨å†Œåœ°å€**ï¼Œä¾› Agent èŠ‚ç‚¹æ³¨å†Œåˆ°é›†ç¾¤\n\n### ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå  | ip             | CPU  | å†…å­˜  |\n| ------- | -------------- | ---- | ----- |\n| Server1 | 192.168.48.101 | â‰§2   | 2G    |\n| Server2 | 192.168.48.102 | â‰§2   | 2G    |\n| Server3 | 192.168.48.103 | â‰§2   | 2G    |\n| Agent1  | 192.168.49.104 | â‰§1   | 512MB |\n\nç°åœ¨æ‰€æœ‰çš„æœºå­éƒ½ä»[5.1éƒ¨ç½²K3s](#éƒ¨ç½²K3s)å…‹éš†è¿™ä¸ª`éƒ¨ç½²å¥½K3s`çš„å¿«ç…§ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨æ‰€æœ‰æœºå­çš„èµ·ç‚¹éƒ½åœ¨`5.1éƒ¨ç½²K3s`\n\nè®°å¾—ç»™agentæ”¹ipå“ˆ\n\n\n\n### é…ç½®é›†ç¾¤è´Ÿè½½å‡è¡¡å™¨\n\nå®˜æ–¹æ•™ç¨‹ï¼š[é›†ç¾¤è´Ÿè½½å‡è¡¡å™¨](https://docs.k3s.io/datastore/cluster-loadbalancer)\n\næŒ‰ç†æ¥è¯´æˆ‘ä»¬éœ€è¦ä¸¤å°é¢å¤–çš„èŠ‚ç‚¹æ¥åšè´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨vipèŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥éƒ¨ç½²åœ¨\n\nserverèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç¬¬äºŒç§æ–¹æ³•\n\n![image-20250607223109712](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/d8de9881adf5274324638bc7a40eadc3697559838.png)\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰çš„server]\n\n```bash\nyum install -y haproxy keepalived\ncat > /etc/haproxy/haproxy.cfg <<\"EOF\"\nfrontend k3s-frontend\n    bind *:16443\n    mode tcp\n    option tcplog\n    default_backend k3s-backend\n\nbackend k3s-backend\n    mode tcp\n    option tcp-check\n    balance roundrobin\n    timeout connect 5s\n    timeout server 30s\n    timeout client 30s\n    default-server inter 10s downinter 5s\n    server server-1 192.168.48.101:6443 check\n    server server-2 192.168.48.102:6443 check\n    server server-3 192.168.48.103:6443 check\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹:[Server1]\n\n```bash\ncat > /etc/keepalived/keepalived.conf <<\"EOF\"\nglobal_defs {\n  enable_script_security\n  script_user root\n}\n\nvrrp_script chk_haproxy {\n    script 'killall -0 haproxy'\n    interval 2\n}\n\nvrrp_instance haproxy-vip {\n    interface ens33  #è¿™é‡Œè¦æ”¹ï¼Œæ˜¯ä½ çš„ç½‘å¡\n    state MASTER    #è¿™é‡Œè¦æ”¹ server1æ˜¯Master å…¶ä»–éƒ½æ˜¯Backup\n    priority 200\n\n    virtual_router_id 51\n\n    virtual_ipaddress {\n        192.168.48.200/24      #é«˜å¯ç”¨ip\n    }\n\n    track_script {\n        chk_haproxy\n    }\n}\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹:[Server2]\n\n```bash\ncat > /etc/keepalived/keepalived.conf <<\"EOF\"\nglobal_defs {\n  enable_script_security\n  script_user root\n}\n\nvrrp_script chk_haproxy {\n    script 'killall -0 haproxy'\n    interval 2\n}\n\nvrrp_instance haproxy-vip {\n    interface ens33  #è¿™é‡Œè¦æ”¹ï¼Œæ˜¯ä½ çš„ç½‘å¡\n    state BACKUP    #è¿™é‡Œè¦æ”¹ server1æ˜¯Master å…¶ä»–éƒ½æ˜¯Backup\n    priority 150\n\n    virtual_router_id 51\n\n    virtual_ipaddress {\n        192.168.48.200/24      #é«˜å¯ç”¨ip\n    }\n\n    track_script {\n        chk_haproxy\n    }\n}\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹:[Server3]\n\n```bash\ncat > /etc/keepalived/keepalived.conf <<\"EOF\"\nglobal_defs {\n  enable_script_security\n  script_user root\n}\n\nvrrp_script chk_haproxy {\n    script 'killall -0 haproxy'\n    interval 2\n}\n\nvrrp_instance haproxy-vip {\n    interface ens33  #è¿™é‡Œè¦æ”¹ï¼Œæ˜¯ä½ çš„ç½‘å¡\n    state BACKUP    #è¿™é‡Œè¦æ”¹ server1æ˜¯Master å…¶ä»–éƒ½æ˜¯Backup\n    priority 100\n\n    virtual_router_id 51\n\n    virtual_ipaddress {\n        192.168.48.200/24      #é«˜å¯ç”¨ip\n    }\n\n    track_script {\n        chk_haproxy\n    }\n}\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰çš„Server]\n\n```\nsudo systemctl restart haproxy keepalived\nsudo systemctl enable --now haproxy keepalived\n```\n\nç°åœ¨æ¥æŸ¥çœ‹vipæ˜¯å¦ç”Ÿæˆ\n\næ“ä½œèŠ‚ç‚¹ï¼š[Server1]\n\n```\nip a\n```\n\n![image-20250607224346215](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/48f086e351e415726ecaf07f8dc5a5ee697559838.png)\n\n\n\n\n\n### åˆå§‹åŒ–ç¬¬ä¸€ä¸ªServer1\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n`è¦æ³¨æ„ä½ é€‰çš„æ˜¯å“ªä¸ªå®¹å™¨å·¥å…·å“ˆ`\n\n\n\n#### åŸºäºdocker\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n> `--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nK3S_TOKEN=qianyiosQianyios12345 \\\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh --docker --cluster-init - server \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\" \\\n--tls-san= 192.168.48.200\n```\n\n`qianyiosQianyios12345`æ˜¯ä½œä¸ºé›†ç¾¤é—´çš„å…±äº«å¯†é’¥ï¼Œå¯è‡ªå®šä¹‰\n\n![image-20250616210830594](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/18e4d4da483660fb0d9d40c2aaf7f90b697559838.png)\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\næ“ä½œèŠ‚ç‚¹ï¼š[Server1]\n\n```bash\nK3S_TOKEN=qianyiosQianyios12345 \\\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh --cluster-init - server \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\" \\\n--tls-san= 192.168.48.200\n```\n\n`qianyiosQianyios12345`æ˜¯ä½œä¸ºé›†ç¾¤é—´çš„å…±äº«å¯†é’¥ï¼Œå¯è‡ªå®šä¹‰\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\næ›´å¤šå‚æ•°ï¼š[K3s Server é…ç½®å‚è€ƒ](https://docs.rancher.cn/docs/k3s/installation/install-options/server-config/_index/)\n\n### å…¶ä»–serveråŠ å…¥é›†ç¾¤\n\n#### åŸºäºdocker\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n`--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nK3S_TOKEN=qianyiosQianyios12345 \\\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh --docker - server \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\" \\\n--server https://192.168.48.101:6443  \\\n--tls-san= 192.168.48.200\n```\n\n`qianyiosQianyios12345`æ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªserver1å…±äº«å‡ºæ¥çš„å¯†é’¥\n\n--server https://192.168.48.101:6443 æ”¹æˆserve1çš„ipåœ°å€å³å¯\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n```bash\nK3S_TOKEN=qianyiosQianyios12345 \\\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh - server \\\n--system-default-registry \"registry.cn-hangzhou.aliyuncs.com\" \\\n--server https://192.168.48.101:6443  \\\n--tls-san= 192.168.48.200\n```\n\n`qianyiosQianyios12345`æ˜¯ä½œä¸ºç¬¬ä¸€ä¸ªserver1å…±äº«å‡ºæ¥çš„å¯†é’¥\n\n--server https://192.168.48.101:6443 æ”¹æˆserve1çš„ipåœ°å€å³å¯\n\nè‡ªè¡Œå®Œæˆ [9.è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•](#è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•)\n\n### å…¶ä»–AgentåŠ å…¥é›†ç¾¤\n\n#### åŸºäºdocker\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n`--docke`ä¸€å®šè¦æ”¾åœ¨æ‰€æœ‰å‚æ•°çš„æœ€å‰é¢\n\n```bash\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nK3S_TOKEN=qianyiosQianyios12345 \\\nK3S_URL=https://192.168.48.101:6443  \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh --docker - agent\n```\n\n#### åŸºäºcontainerd\n\n`å¦‚æœæœ‰å‚æ•°çš„å€¼æ•°é”™äº†ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œç„¶åé‡æ–°è¿è¡Œå‘½ä»¤å³å¯`\n\n```bash\nINSTALL_K3S_SKIP_DOWNLOAD=true \\\nK3S_TOKEN=qianyiosQianyios12345 \\\nK3S_URL=https://192.168.48.101:6443  \\\nINSTALL_K3S_REGISTRIES=\"https://registry.cn-hangzhou.aliyuncs.com,https://registry.aliyuncs.com/google_containers\" \\\nk3s-install.sh - agent\n```\n\nè¿™æ—¶å€™åœ¨Serverå¯ä»¥æŸ¥çœ‹nodeæƒ…å†µ\n\n```\nkubectl get nodes\n```\n\n![image-20250607215850489](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/19f51d407f84c8024c11c09db25b905a697559838.png)\n\n`è‡ªè¡Œéƒ¨ç½²dashboardä¹‹å`,æŸ¥çœ‹ä»–åœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œéƒ¨ç½²æ•™ç¨‹[6.å®‰è£…dashboard](#å®‰è£…dashboard)\n\n```\nhttps://192.168.48.200:30001/\n```\n\nç°åœ¨ä¸æ˜¯æœ‰é«˜å¯ç”¨çš„vipå—ã€‚é‚£ä¹ˆæ­£å¥½å¯ä»¥ç”¨vipè®¿é—®ï¼Œç«¯å£ä¸å˜\n\n![image-20250607224828394](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/d3f4ac9e7c3b1b1b9905e4a842eb9793697559838.png)\n\n### é«˜å¯ç”¨æ¨¡æ‹Ÿå®•æœºæµ‹è¯•\n\næŸ¥çœ‹dashboardéƒ¨ç½²åœ¨å“ªä¸ªèŠ‚ç‚¹\n\n```\nkubectl get pods -A -l k8s-app=kubernetes-dashboard -o wide\n```\n\næˆ‘è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯dashboardéƒ¨ç½²åœ¨Server2\n\né‚£ä¹ˆæˆ‘ä»¬å°±å¯¹Server2è¿›è¡Œpowerofå…³æœºï¼Œæ¥æ¨¡æ‹Ÿå®•æœºçœ‹çœ‹dashboardèƒ½å¦è¢«k3sè‡ªåŠ¨è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹\n\nä½†æ˜¯æˆ‘å‘ç°podè¿˜åœ¨runningçš„çŠ¶æ€\n\n```bash\n[root@Server3 ~]# kubectl get pods -A\nNAMESPACE              NAME                                        READY   STATUS      RESTARTS   AGE\nkubernetes-dashboard   kubernetes-dashboard-668679b698-nlpqc       1/1     Running     0          15m\n\n[root@Server3 ~]# kubectl get nodes\nNAME      STATUS     ROLES                       AGE   VERSION\nagent1    Ready      <none>                      35m   v1.24.2+k3s-\nserver1   Ready      control-plane,etcd,master   36m   v1.24.2+k3s-\nserver2   NotReady   control-plane,etcd,master   36m   v1.24.2+k3s-\nserver3   Ready      control-plane,etcd,master   36m   v1.24.2+k3s-\n[root@Server3 ~]#\n\n```\n\n> **server2 å·²ç»è¢«æ ‡è®°ä¸º NotReady**\n>\n> è¯´æ˜ Kubernetes å·²æ„ŸçŸ¥åˆ°å®ƒä¸å¯ç”¨ï¼ˆå¯èƒ½æ˜¯å…³æœºã€ç½‘ç»œä¸é€šæˆ– kubelet å´©æºƒç­‰ï¼‰ï¼Œä½†ï¼š\n>\n> - å¦‚æœ Pod çš„å‰¯æœ¬æ•°æ˜¯ `1`ï¼ŒKubernetes **ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ Pod** ã€‚\n> - é»˜è®¤çš„èŠ‚ç‚¹å¤±è”å®¹å¿æ—¶é—´è¾ƒé•¿ï¼ˆ5åˆ†é’Ÿï¼‰ï¼Œæ‰€ä»¥å³ä½¿èŠ‚ç‚¹ NotReadyï¼Œä¹Ÿä¸ä¼šç«‹åˆ»è§¦å‘ Pod é©±é€ã€‚\n\næ–¹æ¡ˆä¸€ ç­‰å¾…äº”åˆ†é’Ÿ\n\nç»è¿‡æ¼«é•¿ç­‰å¾…ï¼Œdashboardçš„podè¿›è¡Œäº†é‡æ–°åˆ†é…\n\n![image-20250607230458318](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/8faee28140365b53f596aec16897afa6697559838.png)\n\n```\nkubectl get pods -A -l k8s-app=kubernetes-dashboard -o wide\n```\n\nç»è¿‡æŸ¥çœ‹å·²ç»è¢«è°ƒåº¦åˆ°äº†Server3èŠ‚ç‚¹\n\nç»“è®ºï¼šé«˜å¯ç”¨å®éªŒï¼Œå®éªŒæˆåŠŸï¼Œä¸”é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®\n\n\n\næ–¹æ¡ˆäºŒ æ‰‹åŠ¨åˆ é™¤ Pod å¼ºåˆ¶é‡å»ºï¼ˆæ¨èæµ‹è¯•ï¼‰\n\nç”±äºåˆšåˆšç»è¿‡æ–¹æ¡ˆä¸€çš„æµ‹è¯•ï¼Œè¢«è°ƒåº¦åˆ°äº†server3ï¼Œæ‰€ä»¥è¿™æ¬¡å¯¹server3è¿›è¡Œæ¨¡æ‹Ÿå®•æœºï¼Œç„¶åæ‰‹åŠ¨åˆ é™¤pod\n\n```\nkubectl delete pod -n kubernetes-dashboard podåå­—\n```\n\n![image-20250607231149105](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/cde631359f4f45e5a0d73c12ee05c0aa697559838.png)\n\nç»è¿‡æ‰‹åŠ¨åˆ é™¤ï¼Œç«‹é©¬è§¦å‘è‡ªåŠ¨è°ƒåº¦ï¼Œå·²ç»è¢«è°ƒåº¦åˆ°äº†Server2èŠ‚ç‚¹\n\nç»“è®ºï¼šé«˜å¯ç”¨å®éªŒï¼Œå®éªŒæˆåŠŸï¼Œä¸”é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®\n\n\n\næ–¹æ¡ˆä¸‰ ç¼©çŸ­èŠ‚ç‚¹å¤±è”å®¹å¿æ—¶é—´ï¼ˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰\n\nå¦‚æœä½ å¸Œæœ› Kubernetes æ›´å¿«åœ°å“åº”èŠ‚ç‚¹æ•…éšœï¼Œå¯ä»¥åœ¨ K3s å¯åŠ¨å‚æ•°ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n\n```bash\n--node-monitor-grace-period=20s \\\n--pod-eviction-timeout=30s\n```\n\nâš ï¸ æ³¨æ„ï¼šè¿™ä¼šå½±å“æ•´ä¸ªé›†ç¾¤çš„è¡Œä¸ºï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒæˆ–éœ€è¦å¿«é€Ÿæ•…éšœæ¢å¤çš„åœºæ™¯ã€‚ \n\n\n\n## å®‰è£…dashboard\n\næ“ä½œèŠ‚ç‚¹:[Server1]\n\n```bash\nsudo wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml && \\\nsudo sed -i 's/kubernetesui\\/dashboard:v2.7.0/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/dashboard:v2.7.0/g' recommended.yaml \nsleep 3\nsudo sed -i 's/kubernetesui\\/metrics-scraper:v1.0.8/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/metrics-scraper:v1.0.8/g' recommended.yaml \nsudo sed -i '/targetPort: 8443/a\\      nodePort: 30001' recommended.yaml \nsudo sed -i '/nodePort: 30001/a\\  type: NodePort' recommended.yaml\n\n```\n\nè¿è¡Œpod\n\n```bash\nkubectl apply -f recommended.yaml\n```\n\nåˆ›å»ºtoken\n\n```bash\n#åˆ›å»ºservice accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜ç¾¤è§’è‰²\n#åˆ›å»ºç”¨æˆ·\nkubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n#ç”¨æˆ·æˆæƒ\nkubectl create clusterrolebinding dashboard-admin \\\n--clusterrole=cluster-admin \\\n--serviceaccount=kubernetes-dashboard:dashboard-admin\n#ä¸´æ—¶è·å–ç”¨æˆ·Tokenï¼ˆé»˜è®¤åªæœ‰ 30 åˆ†é’Ÿ ï¼‰\nkubectl create token dashboard-admin -n kubernetes-dashboard\n#æ°¸ä¹…è·å–ç”¨æˆ·Token\ncat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-admin-token\n  namespace: kubernetes-dashboard\n  annotations:\n    kubernetes.io/service-account.name: dashboard-admin\ntype: kubernetes.io/service-account-token\nEOF\n\nKUBECONFIG_FILE=\"dashboard-kubeconfig.yaml\"\n\n# è‡ªåŠ¨è·å– API Server åœ°å€\nAPISERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')\n\n# è‡ªåŠ¨è·å– CA è¯ä¹¦\nCA_CERT=$(kubectl config view --raw -o jsonpath='{.clusters[0].cluster.certificate-authority-data}')\n\n# è‡ªåŠ¨ä» Secret è·å– Tokenï¼ˆä½ æåˆ°çš„æ­£ç¡®æ–¹å¼ï¼‰\nTOKEN=$(kubectl get secret dashboard-admin-token -n kubernetes-dashboard -o jsonpath='{.data.token}' | base64 --decode)\n\n# ç”Ÿæˆ kubeconfig æ–‡ä»¶\ncat <<EOF > ${KUBECONFIG_FILE}\napiVersion: v1\nkind: Config\nclusters:\n  - name: kubernetes\n    cluster:\n      server: ${APISERVER}\n      certificate-authority-data: ${CA_CERT}\nusers:\n  - name: dashboard-admin\n    user:\n      token: ${TOKEN}\ncontexts:\n  - name: dashboard-context\n    context:\n      cluster: kubernetes\n      user: dashboard-admin\ncurrent-context: dashboard-context\nEOF\n\necho \"âœ… kubeconfig æ–‡ä»¶å·²ç”Ÿæˆï¼š${KUBECONFIG_FILE}\"\n```\n\nè¿™æ—¶å€™å°±ä¼šæç¤ºä½ \n\n`âœ… kubeconfig æ–‡ä»¶å·²ç”Ÿæˆï¼šdashboard-kubeconfig.yaml`\n\nä½ å°±æŠŠè¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°dashboardçš„kubeconfigå°±å¯ä»¥å…å¯†ç™»å…¥äº†\n\n![image-20250607185120057](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/4c366c033e40fec33feac1b2784fc2e7697559838.png)\n\n## ä¿®æ”¹å¯åŠ¨å‚æ•°\n\nå¦‚æœä½ åœ¨å®‰è£…çš„æ—¶å€™æœ‰äº›å‚æ•°è¾“å…¥é”™äº†ï¼Œæˆ–è€…æƒ³æ”¹ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ”¹\n\né¦–å…ˆï¼Œåœæ­¢ K3s æœåŠ¡ä»¥é¿å…åœ¨æ›´æ–°è¿‡ç¨‹ä¸­å‡ºç°å†²çªï¼š\n\n```bash\nsudo systemctl stop k3s\n```\n\nä¿®æ”¹k3så¯åŠ¨å‚æ•°\n\n```\nsudo vi /etc/systemd/system/k3s.service\n```\n\n![image-20250613170641600](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/897c7de67c6720e2980294251b60693e697559838.png)\n\nå‡è®¾ä½ çš„--tls-sançš„é«˜å¯ç”¨åœ°å€è¾“å…¥é”™äº†ï¼Œè¦æ”¹æˆåˆ«çš„ï¼Œä½ å°±æ”¹å®Œï¼Œè®°å¾—ä¿å­˜\n\nç„¶ååˆ é™¤æ—§è¯ä¹¦\n\n```bash\nsudo rm -f /var/lib/rancher/k3s/server/tls/serving-kube-apiserver*\nsudo rm -f /var/lib/rancher/k3s/server/tls/server*\n```\n\né‡å¯æœåŠ¡\n\n```bash\nsudo systemctl daemon-reload\nsudo systemctl start k3s\n```\n\n## å¸è½½K3S\n\nå®˜æ–¹æ•™ç¨‹ï¼š[Uninstalling K3s | K3s](https://docs.k3s.io/installation/uninstall)\n\n### å¸è½½Server\n\nè¦ä»æœåŠ¡å™¨èŠ‚ç‚¹å¸è½½ K3sï¼Œè¯·è¿è¡Œï¼š\n\n```bash\n/usr/local/bin/k3s-uninstall.sh\n```\n\n### å¸è½½Agent\n\nè¦ä»ä»£ç†èŠ‚ç‚¹å¸è½½ K3sï¼Œè¯·è¿è¡Œï¼š\n\n```bash\n/usr/local/bin/k3s-agent-uninstall.sh\n```\n\n## è§£å†³érootç”¨æˆ·ä½¿ç”¨kubectlç­‰å‘½ä»¤æ˜¾ç¤ºæ— å‘½ä»¤çš„åŠæ³•\n\nè¿™æ—¶å€™è¿è¡ŒæŸ¥çœ‹èŠ‚ç‚¹å‘½ä»¤ï¼Œæç¤ºæ‰¾ä¸åˆ°å‘½ä»¤\n\n```\nsudo kubectl get nodes\n```\n\nä¸€çœ‹å‘ç°åªæœ‰å…·ä½“åˆ°æŒ‡å®šè·¯å¾„æ‰å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”ç”¨æˆ·å’Œæƒé™ç»„éƒ½æ˜¯root\n\n![image-20250613105655993](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/5d8026809ba73cc92f004f8d04ed49a7697559838.png)\n\nè¿™æ—¶å€™åœ¨æ™®é€šç”¨æˆ·æŸ¥çœ‹visudo\n\n```\nsudo visudo\n```\n\n![image-20250613105736470](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/9f47e5b52a2a68bdb37bfa8d683a59fd697559838.png)\n\nä¸€çœ‹åœ°å€ï¼Œä»–å¹¶æ²¡æœ‰`/usr/local/bin`çš„è·¯å¾„ï¼Œæ‰€ä»¥æ™®é€šç”¨æˆ·æ˜¯æ²¡åŠæ³•ç»§æ‰¿rootçš„è·¯å¾„çš„ï¼Œæ‰€ä»¥ä½ è¦è®¾ç½®æ™®é€šç”¨æˆ·é»˜è®¤çš„ç¯å¢ƒå˜é‡ï¼ˆç”Ÿæˆç¯å¢ƒï¼Œå»ºè®®ä»”ç»†æ–Ÿé…Œè¦ä¸è¦æ·»åŠ ï¼Œä¸ç„¶å°±åªèƒ½ç”¨ç»å¯¹è·¯å¾„ï¼‰\n\n```\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n```\n\n![image-20250613110011514](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/41f098932d33d303fd6a689a9149d6ad697559838.png)\n\nè¿™æ—¶å€™å†æ¬¡è¿è¡Œk3så‘½ä»¤\n\n```\nsudo kubectl get nodes\nsudo crictl images\n```\n\n![image-20250613110125426](../img/%E5%9F%BA%E4%BA%8EOpenEuler%E5%AE%89%E8%A3%85K3S.assets/a818473ded0724b8015ec0e7c4c95042697559838.png)\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["OpenEuler","K3s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"è¿ç»´å¿…å¤‡å·¥å…·å®‰è£…","url":"/posts/1b1a13ed/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# è¿ç»´å¿…å¤‡å·¥å…·å®‰è£…\n\nç³»ç»Ÿæµ‹è¯•ï¼šOpenEuler24.03LTSï¼ŒCentos 8 stream\n\nç†è®ºä¸Šä¸é™åˆ¶ç³»ç»Ÿï¼Œå…¶ä»–ç³»ç»Ÿå¯å¯¹ä¸€äº›å‘½ä»¤è‡ªè¡Œåšä¿®æ”¹å³å¯\n\n## Nginxï¼ˆRPMå®‰è£…ï¼‰\n\nèµ„æ–™æ¥æºï¼š[Nginxå…¥é—¨ç¬”è®° | ä¸¥åƒå±¹åšå®¢](https://blog.qianyios.top/posts/c0d89ad/)\n\nå®˜æ–¹æ–‡æ¡£ï¼š[nginxï¼šLinux è½¯ä»¶åŒ…](https://nginx.org/en/linux_packages.html)\n\næˆªæ­¢2025å¹´4æœˆ20æ—¥ç›®å‰ï¼šnginxæœ€æ–°ç‰ˆæœ¬ï¼š1.26.3\n\n![image-20250420132345655](https://i0.hdslb.com/bfs/article/a772145aab4c5d5fd10c6270f4236f4955933597.png)\n\n`centos7æˆ–centos8`\n\n```bash\nsudo yum install -y tar gcc make pcre pcre-devel zlib zlib-devel openssl openssl-devel\nsudo yum install yum-utils -y\n#æ·»åŠ nginxæº\nsudo cat >/etc/yum.repos.d/nginx.repo << \"EOF\"\n[nginx-stable]\nname=nginx stable repo\nbaseurl=http://nginx.org/packages/centos/$releasever/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n\n[nginx-mainline]\nname=nginx mainline repo\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\nEOF\nsudo yum install nginx -y\nsudo systemctl enable nginx --now\nnginx -v\n```\n\nå› ä¸ºæ²¡æœ‰é€‚é…openeulerçš„ç‰ˆæœ¬ï¼Œè¿™é‡Œç›´æ¥ç”¨centos8çš„æ¥ä»£æ›¿ï¼Œå…¼å®¹çš„æ²¡å…³ç³»ï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿå»è‡ªè¡Œæ›¿æ¢\n\nåŸæœ¬æ˜¯$releaseverçš„ï¼Œä½†æ˜¯æ²¡æœ‰openeulerçš„ç‰ˆæœ¬ç›´æ¥ç”¨8æ¥ä»£æ›¿ä¹Ÿå°±æ˜¯centos8ï¼Œ`openeulerå…¼å®¹centos`\n\n```bash\nsudo yum install -y tar gcc make pcre pcre-devel zlib zlib-devel openssl openssl-devel\nsudo cat >/etc/yum.repos.d/nginx.repo << \"EOF\"\n[nginx-stable]\nname=nginx stable repo\n#baseurl=http://nginx.org/packages/centos/$releasever/$basearch/\nbaseurl=http://nginx.org/packages/centos/8/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n[nginx-mainline]\nname=nginx mainline repo\n#baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\nbaseurl=http://nginx.org/packages/mainline/centos/8/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\nEOF\nsudo yum install nginx -y\nsudo systemctl enable nginx --now\nnginx -v\n```\n\n## Docker\n\næˆªæ­¢2025å¹´4æœˆ20æ—¥ç›®å‰ï¼š\n\ndocker-composeæœ€æ–°ç‰ˆ[2.35.1 ç‰ˆ](https://github.com/docker/compose/releases/tag/v2.35.1)\n\ndocker-ceæœ€æ–°ç‰ˆï¼š[Docker æ–‡æ¡£ 26.1.3](https://docs.docker.com/engine/install/centos/)\n\n\n\n`centos7æˆ–centos8`\n\n```bash\nsudo curl -L \"https://qygit.qianyisky.cn/https://github.com/docker/compose/releases/download/v2.35.1/docker-compose-linux-x86_64\" -o /usr/local/bin/docker-compose\n#å¸è½½æ—§ç‰ˆæœ¬\nsudo yum -y remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-selinux \\\n                  docker-engine-selinux \\\n                  docker-engine\nsudo yum remove docker-ce docker-ce-cli containerd.io docker-compose docker-machine docker-swarm -y\nsudo rm /etc/yum.repos.d/docker-ce.repo\nsudo rm -rf /var/lib/docker\n\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsudo yum install docker-ce -y\nsudo systemctl enable --now docker\nsudo chmod +x /usr/local/bin/docker-compose\nsudo tee /etc/docker/daemon.json > /dev/null <<'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.xuanyuan.me\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://run-docker.cn\",\n    \"https://docker.sunzishaokao.com\",\n    \"https://docker.1panel.live\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n    \"https://docker.qianyios.top\",\n    \"https://registry.aliyuncs.com\",\n    \"https://ghcr.nju.edu.cn\",\n    \"https://k8s.nju.edu.cn\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  },\n  \"data-root\": \"/var/lib/docker\"\n}\nEOF\nsystemctl daemon-reload\nsystemctl restart docker\ndocker-compose --version\ndocker version\n```\n\n`openeuler`\n\n```bash\nsudo curl -L \"https://qygit.qianyisky.cn/https://github.com/docker/compose/releases/download/v2.35.1/docker-compose-linux-x86_64\" -o /usr/local/bin/docker-compose\n#å¸è½½æ—§ç‰ˆæœ¬\nsudo yum -y remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-selinux \\\n                  docker-engine-selinux \\\n                  docker-engine\nsudo yum remove docker-ce docker-ce-cli containerd.io docker-compose docker-machine docker-swarm -y\nsudo rm /etc/yum.repos.d/docker-ce.repo\nsudo rm -rf /var/lib/docker\n\nsudo yum install -y device-mapper-persistent-data lvm2\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nsudo sed -i 's/\\$releasever/8/g' /etc/yum.repos.d/docker-ce.repo\nsudo yum install docker-ce docker-ce-cli containerd.io -y\nsudo systemctl enable --now docker\nsudo chmod +x /usr/local/bin/docker-compose\nsudo tee /etc/docker/daemon.json > /dev/null <<'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.xuanyuan.me\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://run-docker.cn\",\n    \"https://docker.sunzishaokao.com\",\n    \"https://docker.1panel.live\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n    \"https://docker.qianyios.top\",\n    \"https://registry.aliyuncs.com\",\n    \"https://ghcr.nju.edu.cn\",\n    \"https://k8s.nju.edu.cn\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  },\n  \"data-root\": \"/var/lib/docker\"\n}\nsystemctl daemon-reload\nsystemctl restart docker\ndocker-compose --version\ndocker version\n```\n\n## PHP(RPM)\n\næˆªæ­¢2025å¹´4æœˆ20æ—¥ç›®å‰ï¼šPHPæœ€æ–°ç‰ˆ8.4.6\n\n`centos 8 stream`\n\né»˜è®¤å®‰è£…æœ€æ–°ç‰ˆ8.3.19\n\n```bash\nyum update -y\nyum install yum-utils -y\nrpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\nyum install -y php php-fpm php-cli php-common php-devel php-gd php-pdo php-mbstring php-bcmath php-xml php-process php-intl php-soap php-ldap php-opcache \n```\n\n\n\n`openeuler24.03lts`\n\næ¬§æ‹‰ç³»ç»Ÿæœ‰è‡ªå·±çš„ä»“åº“,é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆ8.3.19\n\n```\nyum update -y\nyum install -y php php-fpm php-cli php-common php-devel php-gd php-pdo php-mbstring php-bcmath php-xml php-process php-intl php-soap php-ldap php-opcache \nphp -v\n```\n\n\n\n## Mysql LTS\n\næˆªæ­¢2025å¹´4æœˆ20æ—¥ç›®å‰ï¼šMysql LTSæœ€æ–°ç‰ˆ8.4.5\n\nèµ„æ–™æ¥æºï¼š[Linuxå®‰è£…Mysql8.4.2 LTS | ä¸¥åƒå±¹åšå®¢](https://blog.qianyios.top/posts/32ce47c9/?highlight=mysql)\n\n![image-20250420154015199](https://i0.hdslb.com/bfs/article/d07fe2c6eb9006156708495fb008233e55933597.png)\n\n![image-20250420154554656](https://i0.hdslb.com/bfs/article/05ff82f410aa71ba18458610a657434055933597.png)\n\nè¿™æ˜¯åœ¨rootç›®å½•ä¸‹,è‡ªè¡Œå»åˆ°rootç›®å½•ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰è·¯å¾„\n\næ³¨æ„ï¼šå¦‚æœéœ€è¦æ­è½½phpä½¿ç”¨ï¼Œéœ€è¦å®‰è£…php7.2ï¼Œå› ä¸ºrpm -ivh mysql-community-libs-compatæ˜¯phpçš„ä¾èµ–ã€‚ï¼›å¦‚æœä¸å®‰è£…phpï¼Œåˆ™æ— éœ€å®‰è£…php7.2çš„ä¾èµ–ã€‚\n\nè¿™é‡Œå°±æ¼”ç¤ºéœ€è¦phpï¼Œç‰ˆæœ¬7.2ä»¥ä¸Šï¼Œ[å®‰è£…æ•™ç¨‹](#PHP(RPM))\n\n`centos 8 stream,openeuler`\n\n```bash\nmkdir mysql-install\ntar -xvf mysql-8.4*.rpm-bundle.tar -C mysql-install\ncd mysql-install\n\n# å¸è½½ mariadb ç›¸å…³çš„åŒ…\nyum remove mariadb mariadb-config mariadb-libs -y\n# å¦‚æœä¹‹å‰å®‰è£…è¿‡ MySQL ç¤¾åŒºç‰ˆï¼Œä¹Ÿéœ€è¦ä¸€å¹¶ç§»é™¤\nyum remove mysql-community-common mysql-community-icu-data-files mysql-community-client-plugins mysql-community-libs mysql-community-client mysql-community-server mysql-community-libs-compat -y\n# æœ€å¥½æŒ‰ç…§ä»¥ä¸‹é¡ºåºæŒ‰ç…§ï¼Œä¸ç„¶ä¼šæŠ¥é”™\n#å…¨å±€çš„ä¾èµ–ï¼ˆcommonï¼‰\nrpm -ivh mysql-community-common-8.4.5-1.el8.x86_64.rpm\nrpm -ivh mysql-community-icu-data-files-8.4.5-1.el8.x86_64.rpm\nrpm -ivh mysql-community-client-plugins-8.4.5-1.el8.x86_64.rpm\nrpm -ivh mysql-community-libs-8.4.5-1.el8.x86_64.rpm\nrpm -ivh mysql-community-client-8.4.5-1.el8.x86_64.rpm\nrpm -ivh mysql-community-server-8.4.5-1.el8.x86_64.rpm\n#phpä¾èµ–æ–‡ä»¶\nrpm -ivh mysql-community-libs-compat-8.4.5-1.el8.x86_64.rpm\nsystemctl enable mysqld --now\nmysqlpasswd=$(awk '/temporary password/ {print $NF}' /var/log/mysqld.log)\nmysql -u root -p\"$mysqlpasswd\"\n#Qianyios@007æ˜¯ä¿®æ”¹åçš„å¯†ç \nALTER USER 'root'@'localhost' IDENTIFIED BY 'Qianyios@007';\nFLUSH PRIVILEGES;\nexit\nmysql -uroot -pQianyios@007\n```\n\n\n\nä¾‹å­1ï¼šå¯ä»¥è®¾ç½®123456ä¸ºå¯†ç \n\n```bash\nmysql -uroot -pQianyios@007\nALTER USER 'root'@'localhost' IDENTIFIED BY 'Qianyios@007';\nSHOW VARIABLES LIKE 'validate_password%';\nSET GLOBAL validate_password.policy = LOW;\nSET GLOBAL validate_password.length = 6;\nALTER USER 'root'@'localhost' IDENTIFIED BY '123456';\nFLUSH PRIVILEGES;\nexit\nmysql -uroot -p123456\n```\n\n\n\n## containerd\n\n```bash\nsudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsudo yum clean all && yum makecache\nsudo yum install -y containerd.io\n\nsudo mkdir -p /etc/containerd/certs.d/docker.io\nsudo mkdir -p /etc/containerd/certs.d/registry.k8s.io\nsudo mkdir -p /etc/containerd/certs.d/k8s.gcr.io\nsudo mkdir -p /etc/containerd/certs.d/ghcr.io\nsudo mkdir -p /etc/containerd/certs.d/gcr.io\nsudo mkdir -p /etc/containerd/certs.d/quay.io\nsudo mkdir -p /etc/containerd/certs.d/registry-1.docker.io\n\nsudo tee /etc/containerd/certs.d/docker.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://docker.io\" \n\n[host.\"https://registry.cn-hangzhou.aliyuncs.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.xuanyuan.me\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1ms.run\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1panel.live\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.qianyios.top/\"] \n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://reg-mirror.giniu.com\"] \n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/registry-1.docker.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://registry-1.docker.io\"\n\n[host.\"https://registry.cn-hangzhou.aliyuncs.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.xuanyuan.me\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1ms.run\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.1panel.live\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://docker.qianyios.top/\"] \n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://reg-mirror.giniu.com\"] \n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\n\nsudo tee /etc/containerd/certs.d/k8s.gcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://k8s.gcr.io\"\n\n[host.\"https://registry.aliyuncs.com/google_containers\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/ghcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://ghcr.io\"\n\n[host.\"https://ghcr.m.daocloud.io/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/gcr.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://gcr.io\"\n\n[host.\"https://gcr.m.daocloud.io/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/registry.k8s.io/hosts.toml > /dev/null <<'EOF'\nserver = \"registry.k8s.io\"\n\n[host.\"k8s.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\", \"push\"]\n[host.\"https://registry.aliyuncs.com/v2/google_containers\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo tee /etc/containerd/certs.d/quay.io/hosts.toml > /dev/null <<'EOF'\nserver = \"https://quay.io\"\n\n[host.\"https://quay.tencentcloudcr.com/\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\nsudo sh -c 'containerd config default > /etc/containerd/config.toml'\nsudo sed -i 's#sandbox_image = \"registry.k8s.io/pause:.*\"#sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.10\"#' /etc/containerd/config.toml\nsudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\nsed -i '/\\[plugins\\.\"io\\.containerd\\.grpc\\.v1\\.cri\"\\.registry\\]/!b;n;s/config_path = \"\"/config_path = \"\\/etc\\/containerd\\/certs.d\"/' /etc/containerd/config.toml\n# é‡å¯ containerd æœåŠ¡\nsudo systemctl daemon-reload\nsudo systemctl restart containerd.service\nsudo ctr image ls\n```\n\n## ç³»ç»Ÿæ›´æ¢YumæºåŠæ³•\n\né˜¿é‡Œç½‘ç«™ï¼š[repoå®‰è£…åŒ…ä¸‹è½½_å¼€æºé•œåƒç«™-é˜¿é‡Œäº‘ (aliyun.com)](https://mirrors.aliyun.com/repo/)\n\nCentos Stream 8\n\n```bash\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\nwget -O /etc/yum.repos.d/CentOS-Stream-AppStream.repo https://mirrors.aliyun.com/repo/centos-stream/8/CentOS-Stream-AppStream.repo\nwget -O /etc/yum.repos.d/CentOS-Stream-BaseOS.repo https://mirrors.aliyun.com/repo/centos-stream/8/CentOS-Stream-BaseOS.repo\ndnf clean all && dnf makecache\n```\n\nCentos 7\n\n```bahs\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\nwget -O /etc/yum.repos.d/Centos-7.repo https://mirrors.aliyun.com/repo/Centos-7.repo\nyum clean all && yum makecache\n```\n\nCentos 8\n\n```bash\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\ncurl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo\nyum clean all && yum makecache\n```\n\nRocky ç³»åˆ—\n\n```bash\nsed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n    -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g' \\\n    -e\n's|^#baseurl=http://mirrors.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g' \\\n    -i.bak \\\n    /etc/yum.repos.d/Rocky-*.repo\n\nyum clean all && yum makecache\n```\n\n## è¿ç»´è„šæœ¬ï¼ˆæ›´æ–°ingï¼‰\n\n```bash\nwget https://blog.qianyios.top/file/qy-yunwei.sh\nbash qy-yunwei.sh\n```\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Centos 8","Docker","Centos 7","OpenEuler","Mysql","Nginx","Php"],"categories":["è¿ç»´"]},{"title":"Linuxé…ç½®DNSæœåŠ¡","url":"/posts/b29b8cd3/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Linuxé…ç½®DNSæœåŠ¡\n\n## DNS ç®€ä»‹\n\n**- ä»€ä¹ˆæ˜¯åŸŸå**\n\n> åŸŸå(DomainName)ï¼Œç®€ç§°åŸŸåã€ç½‘åŸŸï¼Œæ˜¯ç”±ä¸€ä¸²ç”¨ç‚¹åˆ†éš”çš„åå­—ç»„æˆçš„Internetä¸ŠæŸä¸€å°è®¡ç®—æœºæˆ–è®¡ç®—æœºç»„çš„åç§°ï¼Œç”¨äºåœ¨æ•°æ®ä¼ è¾“æ—¶æ ‡è¯†è®¡ç®—æœºçš„ç”µå­æ–¹ä½ã€‚å…·æœ‰ç‹¬ä¸€æ— äºŒï¼Œä¸å¯é‡å¤çš„ç‰¹æ€§ã€‚\n\n**- åŸŸåçš„å…³ç³»å’Œç»„æˆ**\n\nå¸¸è§åŸŸåï¼šwww.baidu.com\nå®Œæ•´åŸŸåï¼šwww.baidu.com.\n\næ³¨æ„com åé¢æœ‰ä¸€ç‚¹\n\n```\n. ï¼šæ ¹åŸŸï¼Œå¯çœç•¥ä¸å†™ã€‚\n```\n\n```\ncomï¼šé¡¶çº§åŸŸï¼Œç”±ICANNç»„ç»‡æŒ‡å®šå’Œç®¡ç†ã€‚\n```\n\n```\nåˆ†ç±»ï¼š\n1ã€å›½å®¶åœ°åŒºåŸŸå: (cn(ä¸­å›½)ã€hk(é¦™æ¸¯)ã€sg (æ–°åŠ å¡)ç­‰ã€‚\n2ã€é€šç”¨é¡¹çº§åŸŸå: com (å•†ä¸šæœºæ„)ã€org (éè¥åˆ©ç»„ç»‡)ã€edu (æ•™è‚²æœºæ„)ç­‰ã€‚\n3ã€æ–°é€šç”¨é¡¶çº§åŸŸå: red (çº¢è‰²ã€çƒ­æƒ…)ã€top (é¡¶çº§ã€é«˜ç«¯)ç­‰ã€‚\n4ã€com.cnå±äºâ€œäºŒçº§åŸŸåâ€ï¼Œæ˜¯cné¡¹çº§åŸŸçš„å­åŸŸã€‚\n```\n\n```\nbaiduï¼šçº§åŸŸ(æ³¨å†ŒåŸŸ) ï¼Œå¯ç”±Â·ä¸ªäººæˆ–ç»„ç»‡ç”³è¯·æ³¨å†Œã€‚\n```\n\n```\nwwwï¼šä¸‰çº§åŸŸ(å­åŸŸ)ï¼ŒæœåŠ¡å™¨ç½‘ç«™åä»£è¡¨ã€‚ï¼ˆwww.baidu.comï¼‰\n```\n\n![image-20250402083329281](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/592a8a1b152ea046411104676551a775697559838.png)\n\n**- ä»€ä¹ˆæ˜¯DNS?**\n\nåŸŸåç³»ç»Ÿ(Domain Name System,ç¼©å†™: DNS)æ˜¯äº’è”ç½‘çš„ä¸€é¡¹æœåŠ¡ã€‚åŸŸåè§£ææ˜¯æŠŠåŸŸåæŒ‡å‘ç½‘ç«™ç©ºé—´IP,è®©äººä»¬é€šè¿‡æ³¨å†Œçš„åŸŸåå¯ä»¥æ–¹ä¾¿åœ°è®¿é—®åˆ°ç½‘ç«™çš„ä¸€ç§æœåŠ¡ã€‚IPåœ°å€æ˜¯ç½‘ç»œä¸Šæ ‡è¯†ç«™ç‚¹çš„æ•°å­—åœ°å€ï¼Œä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œé‡‡ç”¨åŸŸåæ¥ä»£æ›¿IPåœ°å€æ ‡è¯†ç«™ç‚¹åœ°å€ã€‚åŸŸåè§£æå°±æ˜¯åŸŸååˆ°IPåœ°å€çš„è½¬æ¢è¿‡ç¨‹ã€‚åŸŸåçš„è§£æå·¥ä½œç”±DNSæœåŠ¡å™¨å®Œæˆã€‚å¯ä»¥ç†è§£ä¸ºDNSå°±æ˜¯ç¿»è¯‘å®˜ã€‚\n\næ­£å‘è§£æï¼šåŸŸå --> IPåœ°å€ã€‚\nåå‘è§£æï¼šIPåœ°å€ --> åŸŸåã€‚\n\n## DNS å·¥ä½œè¿‡ç¨‹\n\n![image-20250402084707783](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/35dacb674713ba04f14ae710ceb9479f697559838.png)\n\n> å®¢æˆ·ç«¯åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªåŸŸåï¼šwww.baidu.comï¼Œæµè§ˆå™¨è‡ªåŠ¨è¡¥å……åŸŸåï¼šwww.baidu.comï¼š80ã€‚80ç«¯å£æ˜¯webæœåŠ¡å™¨çš„ç«¯å£\n\n1.åœ¨ä»è‡ªå·±æœ¬æœºä¸­æŸ¥è¯¢hostæ–‡ä»¶ï¼Œæ˜¯å¦æœ‰æ­¤åŸŸåçš„è§£æè®°å½•ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ç»™æµè§ˆå™¨\n\n2.å¦‚æœhostæ–‡ä»¶æ²¡æœ‰åŸŸåçš„è§£æè®°å½•ï¼Œåˆ™ä¼šåœ¨æœ¬æœºä¸Šç»§ç»­æŸ¥è¯¢æ˜¯å¦æœ‰DNSçš„è§£æç¼“å­˜ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ç»™æµè§ˆå™¨\n\n3.å¦‚æœæœ¬æœºæ²¡æœ‰DNSçš„è§£æè®°å½•ï¼Œåˆ™ä¼šåœ¨ç½‘å¡è®¾ç½®çš„DNSæœåŠ¡å™¨ä¸Šï¼ŒæŸ¥è¯¢åŸŸåçš„è§£æç»“æœ\n\n4.å¦‚æœDNSæœåŠ¡å™¨ä¸Šä¹Ÿæ²¡æœ‰æŸ¥è¯¢åˆ°ï¼Œåˆ™ä¼šä»åˆ«äººè¯¢é—®çš„ç»“æœçš„ç¼“å­˜ä¸­æŸ¥æ‰¾\n\n5.å°±è¿­ä»£æŸ¥è¯¢ï¼Œé¡¶çº§åŸŸåï¼ŒäºŒçº§åŸŸåï¼Œä¸‰çº§åŸŸå\n\n## DNS é…ç½®æ–‡ä»¶\n\n- **/ etc / named.conf ï¼šä¸»é…ç½®æ–‡ä»¶**\n\n![image-20250402090006154](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/286aaaa2e3629b6b269d79a2542567f7697559838.png)\n\n- / **etc / named.rfc1912.zonesï¼šåŒºåŸŸé…ç½®æ–‡ä»¶**\n\n![image-20250402090420936](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/dbcb4a72adc07c0e32de312e8602ddb5697559838.png)\n\n- **/ var / named / ï¼šæ•°æ®é…ç½®æ–‡ä»¶**\n\nnamed.caï¼šè®°å½•äº†13å°æ ¹åŸŸæœåŠ¡å™¨çš„ä½ç½®\nnamed.localhostï¼šæ­£å‘ä»£ç†\nnamed.loopbackï¼šåå‘ä»£ç†\n\n![image-20250402092142493](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/928244e90164866e60cec0222ee7ce7c697559838.png)\n\n`serial`ï¼šä¸»DNSæ¯æ¬¡æ”¹å®Œzoneå¿…é¡»åŠ 1ï¼Œè§¦å‘slaveæ¥åŒæ­¥ï¼›å¯å¡«ï¼šçº¯æ•°å­—ã€YYYYMMDDnnã€Unixæ—¶é—´æˆ³ã€‚\n`refresh`ï¼šslaveéš”å¤šä¹…å»æŸ¥ä¸€æ¬¡serialæ˜¯å¦æ›´æ–°ï¼›å¯å¡«ï¼šç§’æ•°æˆ–å¸¦å•ä½çš„æ—¶é—´ï¼ˆå¦‚3600ã€1Hã€1Dï¼‰ã€‚\n`retry`ï¼šrefreshå¤±è´¥åéš”å¤šä¹…å†è¯•ï¼›å¯å¡«ï¼šåŒä¸Šï¼ˆå¦‚1800ã€30Mï¼‰ã€‚\n`expire`ï¼šå¤šä¹…æ‹‰ä¸åˆ°æ•°æ®å°±æŠŠzoneè§†ä¸ºå¤±æ•ˆï¼›å¯å¡«ï¼šåŒä¸Šï¼ˆå¦‚604800ã€1Wï¼‰ã€‚\n`minimum`ï¼šå¦å®š/æ— è®°å½•ç»“æœåœ¨ç¼“å­˜é‡Œçš„æœ€çŸ­ç”Ÿå­˜æ—¶é—´ï¼›å¯å¡«ï¼šåŒä¸Šï¼ˆå¦‚10800ã€3Hï¼‰ã€‚\n\n| ç±»å‹  | æè¿°                                                         |\n| ----- | ------------------------------------------------------------ |\n| A     | åœ°å€è®°å½•ï¼Œç”¨æ¥æŒ‡å®šåŸŸåçš„ IPv4 åœ°å€çš„è®°å½•ã€‚                   |\n| CNAME | å°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼Œå†ç”±å¦ä¸€ä¸ªåŸŸåæä¾› ip åœ°å€ï¼Œå°±éœ€è¦æ·»åŠ  CNAME è®°å½•ã€‚ |\n| TXT   | å¯å¡«å†™ä»»ä½•ä¸œè¥¿ï¼Œé•¿åº¦é™åˆ¶ 255ã€‚ç»å¤§å¤šæ•°çš„ TXT è®°å½•æ˜¯ç”¨æ¥åš SPF çš„ï¼ˆååƒåœ¾é‚®ä»¶ï¼‰ã€‚ |\n| NS    | åŸŸåæœåŠ¡å™¨è®°å½•ï¼Œå¦‚æœéœ€è¦æŠŠå­åŸŸåäº¤ç»™å…¶ä»– DNS æœåŠ¡å•†è§£æï¼Œå°±éœ€è¦æ·»åŠ  NS è®°å½•ã€‚ |\n| AAAA  | åœ°å€è®°å½•ï¼Œç”¨æ¥æŒ‡å®šåŸŸåçš„ IPv6 åœ°å€çš„è®°å½•ã€‚                   |\n| MX    | é‚®ä»¶äº¤æ¢è®°å½•ï¼Œå¦‚æœéœ€è¦è®¾ç½®é‚®ç®±ï¼Œè®©é‚®ç®±èƒ½æ”¶åˆ°é‚®ä»¶ï¼Œå°±éœ€è¦æ·»åŠ  MX è®°å½•ã€‚ |\n| PTR   | PoinTeRï¼ŒIP --> FQDN                                         |\n\n- **è½¯ä»¶åç§°ï¼šbind**\n- **æœåŠ¡åç§°ï¼šnamed**\n- **è½¯ä»¶ç«¯å£ï¼š**\n\n> UDP 53 æ•°æ®é€šä¿¡(åŸŸåè§£æ)\n> TCP 53 æ•°æ®åŒæ­¥(ä¸»ä»åŒæ­¥)\n\n## DNS æœåŠ¡æ­å»º\n\n`é…ç½®DNSåœ°å€ï¼š/etc/resolv.conf`\n\n| ä¸»æœºå |       ip       | å†…å­˜ | ç¡¬ç›˜ | cpu  | OS      |\n| :----: | :------------: | :--: | :--: | :--: | ------- |\n| master | 192.168.48.101 |  2g  | 100g |  2v  | Centos7 |\n| slave  | 192.168.48.102 |  2g  | 100g |  2v  | Centos7 |\n| client | 192.168.48.103 |  2g  | 100g |  2v  | Centos7 |\n\n> å‰æƒ…æè¦ï¼šä»¥ä¸‹æ˜¯ä¸‰å°æœºçš„ç½‘å¡dnsé…ç½®,è‡ªè¡Œè®¾ç½®\n>\n> matser: DNS1=192.168.48.101\n>\n> slave: DNS1=192.168.48.102\n>\n> client: DNS1=192.168.48.101 , DNS2=192.168.48.102\n\n### æœåŠ¡ç«¯é…ç½®\n\nä¸€ã€å®‰è£…\n\n```bash\nyum install -y bind bind-utils\n```\n\näºŒã€é…ç½®æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š[master]\n\n1.é…ç½®ä¸»æ–‡ä»¶ vim /etc/named.conf\n\n```bash\n// listen-on port 53 { 127.0.0.1; };\n// allow-query     { localhost; };\n```\n\n`listen-on port 53 { 192.168.48.101; };`\nâ†’ åªåœ¨ 192.168.48.101 è¿™å°æœºå™¨çš„ 53 ç«¯å£ä¸Šæä¾› DNS æœåŠ¡ã€‚å¦‚è‹¥æ³¨é‡Šæ‰ï¼šBIND ä¸å†é™å®šç›‘å¬åœ°å€ï¼Œä¼šåœ¨æœåŠ¡å™¨**æ‰€æœ‰å¯ç”¨ IP** çš„ 53 ç«¯å£ä¸Šæä¾› DNS æœåŠ¡ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å¤šipåœ°å€ä¸‹è¿›è¡Œdnsäº†\n\n`allow-query { any; };`\nâ†’ å…è®¸ä»»ä½•æ¥æºå‘è¿™å° DNS æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢è¯·æ±‚ã€‚å¦‚æœä¸æ³¨é‡Šæ‰ï¼Œåªè¦ç½‘ç»œå¯è¾¾ï¼ˆæ²¡æœ‰é˜²ç«å¢™ã€è·¯ç”±ç­‰é™åˆ¶ï¼‰ï¼Œ**ä»»ä½• IP åœ°å€ï¼ˆå…¬ç½‘ã€ç§ç½‘ã€æœ¬æœºï¼‰**ï¼Œè¿™äº›è®¾å¤‡æŠŠ DNS æŒ‡å‘ä½ çš„æœåŠ¡å™¨ IP éƒ½å¯ä»¥å‘è¿™å° DNS æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ï¼Œå¦‚æœæ³¨é‡Šæ‰äº†ï¼Œä»–åªä¼šå…è®¸è¿™å°æœºåŒç½‘æ®µä¸‹å±€åŸŸç½‘å†…çš„æœºå­å¯ä»¥å‘è¿™å°dnsæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢\n\n`è¿™æ¬¡å®éªŒä¸»è¦æ˜¯å®ç°ä¼ä¸šå†…ç½‘dnsï¼Œæ‰€ä»¥è¿™ä¸¤é¡¹æˆ‘éƒ½æ³¨é‡Šæ‰`\n\n`è¿™æ¬¡å®éªŒä¸»è¦æ˜¯å®ç°ä¼ä¸šå†…ç½‘dnsï¼Œæ‰€ä»¥è¿™ä¸¤é¡¹æˆ‘éƒ½æ³¨é‡Šæ‰`\n\n`è¿™æ¬¡å®éªŒä¸»è¦æ˜¯å®ç°ä¼ä¸šå†…ç½‘dnsï¼Œæ‰€ä»¥è¿™ä¸¤é¡¹æˆ‘éƒ½æ³¨é‡Šæ‰`\n\n2ã€é…ç½®åŒºåŸŸæ–‡ä»¶ vim /etc/named.rfc1912.zones\n\n```bash\ncat >> /etc/named.rfc1912.zones <<\"EOF2\"\nzone \"aaa.com\" IN {\n        type master;\n        file \"aaa.com.zone\";\n};\nzone \"48.168.192.in-addr.arpa\" IN {\n        type master;\n        file \"aaa.loopback\";\n};\nEOF2\n```\n\n3ã€ç¼–è¾‘æ­£å‘è§£ææ•°æ®æ–‡ä»¶ vim /var/named/aaa.com.zone\n\n```\ncat > /var/named/aaa.com.zone <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 0 1D 1H 1W 3H )\n        NS      master\nmaster  A       192.168.48.101\nwww     A       192.168.48.128\nEOF\n```\n\n`@`ï¼šä»£è¡¨æœ¬åŸŸåçš„**æ ¹åŸŸï¼ˆzone æœ¬èº«ï¼‰**ï¼›\n\n`IN`ï¼šè®°å½•ç±»åˆ«ä¸º**Internetï¼ˆæ ‡å‡† TCP/IPï¼‰**ï¼›\n\n`SOA`ï¼šè¿™æ˜¯ä¸€æ¡**èµ·å§‹æˆæƒè®°å½•**ï¼ˆStart of Authorityï¼‰ï¼›\n\n`aaa.com.`ï¼šè¯¥åŸŸçš„**ä¸» DNS æœåŠ¡å™¨ï¼ˆprimary nameserverï¼‰**ä¸»æœºåï¼›ï¼ˆ`åªæ˜¯æè¿°ä¿¡æ¯`ï¼‰\n\n`admin@qianyios.top.`ï¼šç®¡ç†å‘˜é‚®ç®±åœ°å€ï¼ˆæŠŠç¬¬ä¸€ä¸ªç‚¹æ¢æˆ @ï¼‰ï¼Œå¦‚æœä¸éœ€è¦åˆ™ç”¨ `.invalid` è¡¨ç¤º**ç¤ºä¾‹/æ— æ•ˆåœ°å€**ã€‚ï¼ˆ`åªæ˜¯æè¿°ä¿¡æ¯`ï¼‰\n\n`NS  master`ï¼šå£°æ˜æœ¬åŸŸçš„**æƒå¨ DNS æœåŠ¡å™¨åå­—å« master**ï¼ˆç›¸å¯¹åï¼Œå®é™…å…¨åæ˜¯ master.aaa.com.ï¼‰ã€‚\n\n`master A  192.168.48.101`ï¼šç»™NSçš„åå­—ä¸º master ç»‘å®š**çœŸå® IP 192.168.48.101**ï¼Œè®©åˆ«äººèƒ½è§£æåˆ°è¿™å°æƒå¨æœåŠ¡å™¨ã€‚\n\n> æ£€æŸ¥zoneæ–‡ä»¶è¯­æ³•ç”¨ï¼š\n>\n> [root@master ~]# named-checkzone aaa.com /var/named/aaa.com.zone\n> zone aaa.com/IN: loaded serial 0\n> OK\n\n4ã€ç¼–è¾‘åå‘è§£ææ•°æ®æ–‡ä»¶ vim /var/named/aaa.loopback\n\nä¸¾ä¾‹äº†ä¸¤æ¡åå‘è®°å½•\n\n```\ncat > /var/named/aaa.loopback <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 0 1D 1H 1W 3H )\n        NS      master.aaa.com.\n129     PTR     www1.aaa.com.\n128     PTR     www.aaa.com.\nEOF\n```\n\n`NS master.aaa.com.`:åœ¨æ­£å‘zoneä¸æ˜¯é…ç½®äº†`NS  master`å—ï¼Œé‚£åå‘è¿™é‡Œå°±è¦å†™å…¨ç§°åŸŸååé¢è¦åŠ å°æ•°ç‚¹\n\n\n\n5.å¯åŠ¨namedæœåŠ¡\n\n```\nsystemctl enable --now named \nsystemctl restart named\n```\n\né‡å¯æ— æŠ¥é”™\n\n### **å®¢æˆ·ç«¯é…ç½®**\n\næ“ä½œèŠ‚ç‚¹ï¼š[client]\n\nä¸€ã€å®‰è£…\n\n```bash\nyum install -y bind bind-utils\n```\n\näºŒã€é…ç½®ç½‘å¡dns\n\nè¿™æ˜¯æˆ‘çš„ç½‘å¡åç§°æ˜¯ens33ä½ è‡ªå·±æŒ‰ä½ è‡ªå·±çš„æ”¹\n\n```\nvim /etc/sysconfig/network-scripts/ifcfg-ens33\n```\n\n```\nDNS1=192.168.48.101\n```\n\n![image-20250402093721868](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/96325875a1ad1541dc52551a257c3f4a697559838.png)\n\né‡å¯ç½‘å¡\n\n```\nsystemctl restart network\n```\n\næŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸ\n\n```bash\n[root@client ~]# cat /etc/resolv.conf\n# Generated by NetworkManager\nnameserver 192.168.48.101\n```\n\n\n\n**ä¸‰ã€ æµ‹è¯• nslookup**\n\n- æ­£å‘è§£ææµ‹è¯•\n\n```bash\n[root@client ~]# nslookup www.aaa.com\nServer:         192.168.48.101\nAddress:        192.168.48.101#53\n\nName:   www.aaa.com\nAddress: 192.168.48.128  #è‡ªå·±æŸ¥çœ‹æ­£å‘è§£ææ–‡ä»¶\n```\n\n- åå‘è§£ææµ‹è¯•\n\n```bash\n[root@client ~]# host 192.168.48.128 && host 192.168.48.129\n128.48.168.192.in-addr.arpa domain name pointer www.aaa.com.\n129.48.168.192.in-addr.arpa domain name pointer www1.aaa.com.\n#è‡ªè¡ŒæŸ¥çœ‹åå‘è§£ææ–‡ä»¶\n```\n\næˆåŠŸ\n\n## ä¸»ä»DNSæœåŠ¡å™¨æ­å»º\n\nå‡è½»ä¸»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæ•°æ®ä» ä¸»æœåŠ¡å™¨ä¸Šå¤åˆ¶åˆ° ä»æœåŠ¡å™¨ä¸Š\n\n### ä¸»æœåŠ¡å™¨é…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master]\n\n1.é…ç½®ä¸»æ–‡ä»¶ vim /etc/named.conf\n\n```bash\nlisten-on port 53 { 192.168.48.101; }; //masterIP\nallow-query     { any; };\n```\n\n`listen-on port 53 { 192.168.48.101; };`\nâ†’ åªåœ¨ 192.168.48.101 è¿™å°æœºå™¨çš„ 53 ç«¯å£ä¸Šæä¾› DNS æœåŠ¡ã€‚å¦‚è‹¥æ³¨é‡Šæ‰ï¼šBIND ä¸å†é™å®šç›‘å¬åœ°å€ï¼Œä¼šåœ¨æœåŠ¡å™¨**æ‰€æœ‰å¯ç”¨ IP** çš„ 53 ç«¯å£ä¸Šæä¾› DNS æœåŠ¡ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å¤šipåœ°å€ä¸‹è¿›è¡Œdnsäº†\n\n`allow-query { any; };`\nâ†’ å…è®¸ä»»ä½•æ¥æºå‘è¿™å° DNS æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢è¯·æ±‚ã€‚å¦‚æœä¸æ³¨é‡Šæ‰ï¼Œåªè¦ç½‘ç»œå¯è¾¾ï¼ˆæ²¡æœ‰é˜²ç«å¢™ã€è·¯ç”±ç­‰é™åˆ¶ï¼‰ï¼Œ**ä»»ä½• IP åœ°å€ï¼ˆå…¬ç½‘ã€ç§ç½‘ã€æœ¬æœºï¼‰**ï¼Œè¿™äº›è®¾å¤‡æŠŠ DNS æŒ‡å‘ä½ çš„æœåŠ¡å™¨ IP éƒ½å¯ä»¥å‘è¿™å° DNS æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ï¼Œå¦‚æœæ³¨é‡Šæ‰äº†ï¼Œä»–åªä¼šå…è®¸è¿™å°æœºåŒç½‘æ®µä¸‹å±€åŸŸç½‘å†…çš„æœºå­å¯ä»¥å‘è¿™å°dnsæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢\n\n`è¿™æ¬¡å®éªŒä¸»è¦æ˜¯å®ç°ä¼ä¸šå†…ç½‘dnsï¼Œæ‰€ä»¥è¿™ä¸¤é¡¹æˆ‘éƒ½æ³¨é‡Šæ‰`\n\n`è¿™æ¬¡å®éªŒä¸»è¦æ˜¯å®ç°ä¼ä¸šå†…ç½‘dnsï¼Œæ‰€ä»¥è¿™ä¸¤é¡¹æˆ‘éƒ½æ³¨é‡Šæ‰`\n\n`è¿™æ¬¡å®éªŒä¸»è¦æ˜¯å®ç°ä¼ä¸šå†…ç½‘dnsï¼Œæ‰€ä»¥è¿™ä¸¤é¡¹æˆ‘éƒ½æ³¨é‡Šæ‰`\n\n\n\n2ã€é…ç½®åŒºåŸŸæ–‡ä»¶ vim /etc/named.rfc1912.zones\n\n`allow-updateï¼ˆå¯é€‰ï¼‰ï¼šåªå…è®¸ 192.168.48.102 è¿™å°ä¸»æœºå‘æœ¬ DNS æœåŠ¡å™¨å‘é€åŠ¨æ€æ›´æ–°`\n\n`allow-update { any; };`å«ä¹‰ï¼šå…è®¸**ä»»ä½•ä¸»æœº**å‘æœ¬ DNS æœåŠ¡å™¨æäº¤åŠ¨æ€æ›´æ–°è¯·æ±‚ï¼Œå³è°éƒ½å¯ä»¥å¢åˆ æ”¹è¯¥åŒºåŸŸçš„èµ„æºè®°å½•ã€‚å®‰å…¨é£é™©æå¤§ï¼Œç”Ÿäº§ç¯å¢ƒåŠ¡å¿…æ”¹æˆ `{ none; }` æˆ–åªåˆ—å‡ºå¯ä¿¡ IP/å¯†é’¥ï¼Œå¦åˆ™ä»»ä½•äººéƒ½èƒ½ç¯¡æ”¹ä½ çš„åŸŸåè§£æã€‚\n\n```bash\nzone \"aaa.com\" IN {\n        type master;\n        file \"aaa.com.zone\";\n        allow-update { none; };\n};\nzone \"48.168.192.in-addr.arpa\" IN {\n        type master;\n        file \"aaa.loopback\";\n        allow-update { none; };\n};\n```\n\n\n\n3ã€ç¼–è¾‘æ­£å‘è§£ææ•°æ®æ–‡ä»¶ vim /var/named/aaa.com.zone\n\n```\ncat > /var/named/aaa.com.zone <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 0 1D 1H 1W 3H )\n        NS      master\nmaster  A       192.168.48.101\nwww     A       192.168.48.128\nEOF\n```\n\n4ã€ç¼–è¾‘åå‘è§£ææ•°æ®æ–‡ä»¶ vim /var/named/aaa.loopback\n\n```\ncat > /var/named/aaa.loopback <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 0 1D 1H 1W 3H )\n        NS      master.aaa.com.\n129     PTR     www1.aaa.com.\n128     PTR     www.aaa.com.\nEOF\n```\n\n### ä»æœåŠ¡å™¨é…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[slave]\n\n```bash\n#å®‰è£…\nyum install -y bind bind-utils\n```\n\n1.é…ç½®ä¸»æ–‡ä»¶ vim /etc/named.conf\n\n```bash\n#æ³¨é‡Šæ‰\n// listen-on port 53 { 127.0.0.1; };\n// allow-query     { localhost; };\n```\n\n2ã€é…ç½®åŒºåŸŸæ–‡ä»¶ vim /etc/named.rfc1912.zones\n\n```bash\ncat >> /etc/named.rfc1912.zones << \"EOF\"\nzone \"aaa.com\" IN {\n        type slave;\n        file \"slaves/aaa.com.zone\";\n        masters { 192.168.48.101; }; //ä¸»æœåŠ¡å™¨çš„IP\n};\nzone \"48.168.192.in-addr.arpa\" IN {\n        type slave;\n        file \"slaves/aaa.loopback\";\n        masters { 192.168.48.101; }; //ä¸»æœåŠ¡å™¨çš„IP\n};\nEOF\n```\n\n![image-20250402100911225](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/d8f9ea5b9a7b623600b556488384c1cb697559838.png)\n\nå¦‚æœä¸»ä»åŒæ­¥ä¹‹ååŒºåŸŸæ•°æ®æ–‡ä»¶ä¼šåŒæ­¥åˆ°/var/named/slavesè¿™ä¸ªç›®å½•ä¸‹ï¼Œç°åœ¨è¿˜æ˜¯ç©ºçš„\n\n```\n[root@slave ~]# ll /var/named/slaves\ntotal 0\n[root@slave ~]#\n```\n\n\n\nä¸¤å°é‡å¯namedæœåŠ¡\n\n`æ“ä½œèŠ‚ç‚¹ï¼š[master,slave]`\n\n```\nsystemctl restart named\n```\n\nè¿™æ—¶å€™ç»è¿‡ä¸¤å°æœåŠ¡å™¨é‡å¯namedä¹‹åï¼Œmasteré‡Œçš„ä¸¤ä¸ªæ–‡ä»¶å°±å·²ç»åŒæ­¥åˆ°slaveçš„/var/named/slavesè¿™ä¸ªç›®å½•ä¸‹\n\n![image-20250402100935884](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/b57be7ae78d86f84846a90f26a54fad8697559838.png)\n\n\n\n### å®¢æˆ·ç«¯é…ç½®å¹¶æµ‹è¯•æ­£åå‘è§£æ\n\næ“ä½œèŠ‚ç‚¹ï¼š[client]\n\nè®¾ç½®dnsæ·»åŠ slaveçš„IPåœ°å€\n\n`DNS2=192.168.48.102` ç„¶åé‡å¯ç½‘å¡\n\nä¿®æ”¹ç½‘å¡dnsæ·»åŠ ä¸€ä¸ªä»æœåŠ¡å™¨çš„ip\n\n```\nvim /etc/sysconfig/network-scripts/ifcfg-ens33\n```\n\n![image-20250402101403809](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/9bc79f056a1f76dc2bbed9981b63c028697559838.png)\n\né‡å¯ç½‘å¡\n\n```\nsystemctl restart network\n```\n\n```bash\n#æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ\n[root@client ~]# cat /etc/resolv.conf\n# Generated by NetworkManager\nnameserver 192.168.48.101\nnameserver 192.168.48.102\n```\n\n\n\n### æµ‹è¯•ä¸»ä»æœåŠ¡\n\nå½“æˆ‘ä»¬ç»™masteræ¨¡æ‹ŸnamedæœåŠ¡æ•…éšœæ—¶ï¼Œç”±ä»æœåŠ¡å™¨è¿›è¡Œæ¥ç®¡\n\næµ‹è¯•å‰ï¼Œæ˜¯ç”±masteræä¾›æœåŠ¡\n\n```\n[root@client ~]# nslookup www.aaa.com\nServer:         192.168.48.101\nAddress:        192.168.48.101#53\n\nName:   www.aaa.com\nAddress: 192.168.48.128\n\n[root@client ~]# host 192.168.48.128 && host 192.168.48.129\n128.48.168.192.in-addr.arpa domain name pointer www.aaa.com.\n129.48.168.192.in-addr.arpa domain name pointer www1.aaa.com.\n```\n\n\n\næ–­å¼€masterçš„namedçš„æœåŠ¡\n\n```\n[root@master ~]# systemctl stop named\n[root@master ~]#\n```\n\nå†æ¬¡è¿›è¡Œæµ‹è¯•\n\n```\nnslookup www.aaa.com\nhost 192.168.48.128 && host 192.168.48.129\n```\n\n![image-20250722003316519](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/1279247eaf7b775c4c7f513266b8ffbd697559838.png)\n\nè¿™æ—¶é‡å¯masterçš„namedï¼Œå®¢æˆ·æœºåˆä»ä¸»æœåŠ¡å™¨æŸ¥è¯¢åŸŸåäº†\n\n```\nsystemctl start named\n```\n\n```bash\n[root@client ~]# host 192.168.48.128 && host 192.168.48.129\n128.48.168.192.in-addr.arpa domain name pointer www.aaa.com.\n129.48.168.192.in-addr.arpa domain name pointer www1.aaa.com.\n[root@client ~]# nslookup www.aaa.com\nServer:         192.168.48.101\nAddress:        192.168.48.101#53\n\nName:   www.aaa.com\nAddress: 192.168.48.128\n```\n\n## è‡ªåŠ¨ä¸»ä»åŒæ­¥\n\næˆ‘ä»¬å·²ç»é…ç½®äº†ä¸»ä»æœåŠ¡å™¨äº†ï¼Œå¦‚æœè¿™æ—¶ä¸»æœåŠ¡å™¨çš„åŒºåŸŸæ•°æ®æ–‡ä»¶ä¸­åˆæ·»åŠ äº†æ–°çš„è§£ææ¡ç›®ï¼Œæ€ä¹ˆå®ç°ä»æœåŠ¡å™¨ä¹Ÿèƒ½è‡ªåŠ¨åŒæ­¥è¿™ä¸ªæ•°æ®å‘¢ï¼Ÿå¾ˆç®€å•\n\næ“ä½œèŠ‚ç‚¹ï¼š[matser]\n\n1.é…ç½®æ­£å‘åŒºåŸŸæ–‡ä»¶\n\n```bash\ncat > /var/named/aaa.com.zone <<\"EOF\"\n$TTL 1D                                   \n@       IN SOA  aaa.com. admin@qianyios.top. ( 1 1D 1H 1W 3H )\n        NS      master\n        NS      slave\nmaster  A       192.168.48.101\nslave   A       192.168.48.102    ;å¢åŠ slaveè§£æè®°å½•\nwww     A       192.168.48.128\nabc     A       192.168.48.130\nEOF\n```\n\n`( 1 1D 1H 1W 3H )`;ç¬¬ä¸€ä¸ªæ•°å­—ï¼ŒåŸå…ˆæ˜¯0è¦å¢åŠ åˆ°1ï¼Œå°±æ˜¯è¯´dnsè¦ç¡®å®šè¿™ä¸ªæ–‡ä»¶å·²ç»æ›´æ–°è¿‡äº†ï¼Œé è¿™ä¸ªæ•°å­—æ¥åˆ¤æ–­çš„ï¼Œé€’å¢ä¸€æ¬¡å°±æ˜¯æ›´æ–°ä¸€æ¬¡äº†ï¼Œæ‰å¯ä»¥è¿›è¡ŒåŒæ­¥\n\n2.é…ç½®åå‘è§£ææ–‡ä»¶\n\n```bash\ncat > /var/named/aaa.loopback <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 1 1D 1H 1W 3H )\n        NS      master.aaa.com.\n        NS      slave.aaa.com.\n129     PTR     www1.aaa.com.\n128     PTR     www.aaa.com.\n130     PTR     abc.aaa.com.\nEOF\n```\n\n`( 1 1D 1H 1W 3H )`;ç¬¬ä¸€ä¸ªæ•°å­—ï¼ŒåŸå…ˆæ˜¯0è¦å¢åŠ åˆ°1ï¼Œå°±æ˜¯è¯´dnsè¦ç¡®å®šè¿™ä¸ªæ–‡ä»¶å·²ç»æ›´æ–°è¿‡äº†ï¼Œé è¿™ä¸ªæ•°å­—æ¥åˆ¤æ–­çš„ï¼Œé€’å¢ä¸€æ¬¡å°±æ˜¯æ›´æ–°ä¸€æ¬¡äº†ï¼Œæ‰å¯ä»¥è¿›è¡ŒåŒæ­¥\n\n\n\n> å¦‚æœè¯´ä½ ä¸æƒ³åŠ `NS   slave.aaa.com.`\n>\n> ä½ å°±è¦åœ¨vim /etc/named.rfc1912.zonesé‡Œé…ç½®è¯¥åŸŸåä¸‹çš„æ·»åŠ \n>\n> `notify yes;`,`also-notify { 192.168.48.102; }`\n>\n> - `notify yes;`\n>   ä¸» DNS å˜æ›´åè‡ªåŠ¨ç»™ NS åˆ—è¡¨é‡Œçš„è¾… DNS å‘â€œå¿«æ›´æ–°â€é€šçŸ¥ã€‚\n> - `also-notify { 192.168.48.102; }`\n>   åœ¨â€œè‡ªåŠ¨æ¨å¯¼çš„ NS åˆ—è¡¨â€ä¹‹å¤–ï¼Œ**é¢å¤–å†é€šçŸ¥ä¸€ä¸ª/ä¸€æ‰¹ IP**ã€‚å°±æ˜¯è¯´å¦‚æœä½ æ²¡åŠ `NS   slave.aaa.com.`ï¼Œé‚£ä¹ˆä»–ä¼šé¢å¤–å†é€šçŸ¥192.168.48.102;\n>\n> å¦‚ä¸‹å›¾\n>\n> ![image-20250402102940010](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/084a5542cae70c5d3c1039927ba66ac2697559838.png)\n\n\n\n3ã€æµ‹è¯•\n\næµ‹è¯•å‰æŸ¥çœ‹slaveæ•°æ®çš„æ–‡ä»¶æ—¶é—´\n\n![image-20250402103413907](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/e704cf864aceca78b60f03d6937e6acc697559838.png)\n\né‡å¯masterçš„namedçš„æœåŠ¡\n\n```\nsystemctl restart named\n```\n\n![image-20250402103830941](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/f5af415135f8749d47d51e646e55a3cc697559838.png)\n\nè¿™æ—¶å€™å·²ç»æ›´æ–°äº†ï¼Œå†æ¬¡åœ¨å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•\n\n```\n[root@client ~]# nslookup abc.aaa.com\nServer:         192.168.48.101\nAddress:        192.168.48.101#53\n\nName:   abc.aaa.com\nAddress: 192.168.48.130\n\n[root@client ~]# host 192.168.48.130\n130.48.168.192.in-addr.arpa domain name pointer abc.aaa.com.\n```\n\néƒ½èƒ½æˆåŠŸè¿›è¡Œè§£æï¼Œä¸»ä»è‡ªåŠ¨åŒæ­¥æˆåŠŸ\n\n\n\nå¤±è´¥æ¡ˆä¾‹\n\n`æˆ‘æœ‰æµ‹è¯•æ²¡æœ‰ä¿®æ”¹åºå·å°±æ·»åŠ æ•°æ®é¡ºä¾¿é‡å¯ï¼Œæ˜¯æ²¡æœ‰åŒæ­¥æˆåŠŸçš„`\n\nåºå·ä¸º1ï¼Œæ²¡å¢åŠ 1ï¼Œæœ¬èº«åº”è¯¥æ˜¯2çš„\n\n```bash\ncat > /var/named/aaa.loopback <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 1 1D 1H 1W 3H )\n        NS      master.aaa.com.\n        NS      slave.aaa.com.\n129     PTR     www1.aaa.com.\n128     PTR     www.aaa.com.\n130     PTR     abc.aaa.com.\n131     PTR     qy.aaa.com.\nEOF\ncat > /var/named/aaa.com.zone <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 1 1D 1H 1W 3H )\n        NS      master\n        NS      slave\nmaster  A       192.168.48.101\nslave   A       192.168.48.102\nwww     A       192.168.48.128\nabc     A       192.168.48.130\nqy      A       192.168.48.131\nEOF\n```\n\né‡å¯ä¹‹å‰æŸ¥çœ‹æ—¶é—´\n\n```bash\n[root@slave ~]# ll /var/named/slaves/\ntotal 8\n-rw-r--r-- 1 named named 329 Jul 22 08:46 aaa.com.zone\n-rw-r--r-- 1 named named 393 Jul 22 08:46 aaa.loopback\n\n```\n\né‡å¯ä¹‹å\n\n```\n[root@master ~]# systemctl restart named\n[root@master ~]#\n```\n\nslaveä¸‹çš„æ–‡ä»¶è¿˜æ˜¯å’ŒåŸæ¥ä¸€æ ·\n\n```\n[root@slave ~]# ll /var/named/slaves/\ntotal 8\n-rw-r--r-- 1 named named 329 Jul 22 08:46 aaa.com.zone\n-rw-r--r-- 1 named named 393 Jul 22 08:46 aaa.loopback\n```\n\nå¹¶ä¸”å®¢æˆ·ç«¯è§£æä¸åˆ°æˆ‘æ–°æ·»åŠ çš„æ•°æ®\n\n```bash\n[root@client ~]# host 192.168.48.131\n131.48.168.192.in-addr.arpa domain name pointer qy.aaa.com.\n[root@client ~]# nslookup qy.aaa.com\nServer:         192.168.48.101\nAddress:        192.168.48.101#53\n\nName:   qy.aaa.com\nAddress: 192.168.48.131\n#å¥½å¥‡æ€ªè¿™ä¸æ˜¯è§£æåˆ°äº†å—ï¼Œå› ä¸ºdnsé‡Œä¸æ˜¯è®¾ç½®äº†ä¸¤ä¸ªdnså—ï¼Œæˆ‘ä»¬åˆ æ‰masterçš„dnsï¼Œé‡å¯ç½‘å¡\n[root@client ~]# cat /etc/resolv.conf\n# Generated by NetworkManager\nnameserver 192.168.48.102\n#å†æ¬¡è¿›è¡Œè§£æ\n[root@client ~]# host 192.168.48.131\nHost 131.48.168.192.in-addr.arpa. not found: 3(NXDOMAIN)\n[root@client ~]# nslookup qy.aaa.com\nServer:         192.168.48.102\nAddress:        192.168.48.102#53\n\n** server can't find qy.aaa.com: NXDOMAIN\n#å°±è¯´æ˜192.168.48.102å¹¶æ²¡æœ‰å®ç°åŒæ­¥\n```\n\n\n\nåªæœ‰å½“æˆ‘`ä¿®æ”¹åºå·ä¸º2`æ—¶ï¼Œå†è¿›è¡Œé‡å¯ï¼Œæ‰èƒ½è¿›è¡ŒåŒæ­¥\n\n```bash\ncat > /var/named/aaa.loopback <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 2 1D 1H 1W 3H )\n        NS      master.aaa.com.\n        NS      slave.aaa.com.\n129     PTR     www1.aaa.com.\n128     PTR     www.aaa.com.\n130     PTR     abc.aaa.com.\n131     PTR     qy.aaa.com.\nEOF\ncat > /var/named/aaa.com.zone <<\"EOF\"\n$TTL 1D\n@       IN SOA  aaa.com. admin@qianyios.top. ( 2 1D 1H 1W 3H )\n        NS      master\n        NS      slave\nmaster  A       192.168.48.101\nslave   A       192.168.48.102\nwww     A       192.168.48.128\nabc     A       192.168.48.130\nqy      A       192.168.48.131\nEOF\nsystemctl\trestart named\n```\n\nslaveæŸ¥çœ‹æ˜¯å¦æ›´æ–°\n\n```bash\n[root@slave ~]# ll /var/named/slaves/\ntotal 8\n-rw-r--r-- 1 named named 367 Jul 22 08:56 aaa.com.zone\n-rw-r--r-- 1 named named 456 Jul 22 08:56 aaa.loopback\n#ä¹‹å‰æ˜¯8:46çš„ï¼Œæ›´æ–°ä¹‹åå°±æ˜¯8:56\n```\n\nclientæŸ¥çœ‹è§£æ\n\n```bash\n[root@client ~]# host 192.168.48.131\n131.48.168.192.in-addr.arpa domain name pointer qy.aaa.com.\n[root@client ~]# nslookup qy.aaa.com\nServer:         192.168.48.102    #slaveæˆåŠŸè§£æ\nAddress:        192.168.48.102#53\n\nName:   qy.aaa.com\nAddress: 192.168.48.131\n```\n\n## sshå…å¯†\n\næ­¤æ­¥éª¤æ˜¯ä¸ºäº†æ–¹ä¾¿ä»¥ä¸‹è‡ªåŠ¨è„šæœ¬\n\næ“ä½œèŠ‚ç‚¹ï¼šã€ä¸‰å°æœåŠ¡å™¨ã€‘\n\nè¿™æ˜¯æˆ‘çš„ipå’Œä¸»æœºåï¼Œä½ æ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹\n\n```\ncat >> /etc/hosts << \"EOF\"\n192.168.48.101 master\n192.168.48.102 slave\n192.168.48.103 client\nEOF\n```\n\næ“ä½œèŠ‚ç‚¹ï¼šã€masterã€‘\n\n> è„šæœ¬é‡Œ`password=\"123456\"`æ˜¯æˆ‘ä¸‰å°æœºçš„å¯†ç ï¼Œæˆ‘ä¸‰å°éƒ½ä¸€æ ·ï¼Œå¦‚ä½•ä½ æ˜¯ä¸ä¸€æ ·ï¼Œä½ è‡ªå·±è‡ªè¡Œè¿›è¡Œæ‰‹åŠ¨å…å¯†äº†\n>\n> [master] yum install -y sshpass \n>\n> [master] ssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n>\n> ä»¥ä¸‹è¿™ä¸ªå‘½ä»¤çš„ä¸»æœºåï¼Œä¸‰ä¸ªä¸»æœºåéƒ½è¦è¾“ä¸€éï¼Œä¹Ÿå°±æ˜¯ä¸‰æ¡å‘½ä»¤äº†\n>\n> [master] sshpass -p \"å¯†ç \" ssh-copy-id -o StrictHostKeyChecking=no \"ä¸»æœºå\"\n>\n> æµ‹è¯•å…å¯†ï¼Œä¸‰ä¸ªä¸»æœºåéƒ½è¦è¾“ä¸€éï¼Œä¹Ÿå°±æ˜¯ä¸‰æ¡å‘½ä»¤äº†\n>\n> [master] sshpass -p \"å¯†ç \" ssh -o StrictHostKeyChecking=no \"ä¸»æœºå\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\n\n```bash\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"master\" \"slave\" \"client\")\n# å¯†ç \npassword=\"123456\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## è‡ªåŠ¨æ·»åŠ è§£æè„šæœ¬\n\nä½ è¦åšçš„å°±æ˜¯ä¿®æ”¹è„šæœ¬ä¸­çš„`SLAVE_IP=\"192.168.48.102\"`è¿™æ˜¯æˆ‘çš„ä»èŠ‚ç‚¹çš„ip\n\nä½ è¦æŠŠä½ çš„ä¸»ä»èŠ‚ç‚¹åšå¥½`å…å¯†`ä¹‹åï¼Œæ‰å¯ä»¥è¿›è¡Œä»¥ä¸‹æ“ä½œ\n\næ“ä½œèŠ‚ç‚¹:[master]\n\n```\nvim jx.sh\n```\n\n```bash\n#!/bin/bash\n\n# æ£€æŸ¥å‚æ•°æ•°é‡\nif [ \"$#\" -ne 2 ]; then\n    echo \"Usage: $0 <IP_ADDRESS> <DOMAIN>\"\n    exit 1\nfi\n\nIP=\"$1\"\nDOMAIN=\"$2\"\n# è·å–æœ¬æœº IP åœ°å€ï¼ˆå‡è®¾ä¸»æœºåªæœ‰ä¸€ä¸ªæœ‰æ•ˆ IPï¼‰\nMASTER_IP=$(hostname -I | awk '{print $1}')\n# ä»æœåŠ¡å™¨çš„ IP åœ°å€\nSLAVE_IP=\"192.168.48.102\"\n\n# è§£æåŸŸåå’Œåå‘ IP\nBASE_DOMAIN=$(echo \"$DOMAIN\" | awk -F. '{print $(NF-1)\".\"$NF}')\nZONE_FILE=\"/var/named/$BASE_DOMAIN.zone\"\nREV_ZONE_FILE=\"/var/named/$(echo $IP | awk -F. '{print $3\".\"$2\".\"$1\".in-addr.arpa\"}').zone\"\nZONE_CONFIG=\"/etc/named.rfc1912.zones\"\n\n# è§£æåå‘ IP å’Œä¸»æœºå\nREV_IP=$(echo $IP | awk -F. '{print $3\".\"$2\".\"$1}')\nREV_HOST=$(echo $IP | awk -F. '{print $4}')\nSHORT_NAME=$(echo \"$DOMAIN\" | awk -F. '{print $1}')\n\n# ç¡®ä¿ /var/named ç›®å½•å­˜åœ¨\nmkdir -p /var/named/\ntouch \"$ZONE_FILE\" \"$REV_ZONE_FILE\"\nchown named:named \"$ZONE_FILE\" \"$REV_ZONE_FILE\"\nchmod 644 \"$ZONE_FILE\" \"$REV_ZONE_FILE\"\n\n# æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„è§£æè®°å½•\nif grep -q \"^$SHORT_NAME[[:space:]]*A[[:space:]]*$IP\" \"$ZONE_FILE\"; then\n    echo \"è®°å½• $DOMAIN -> $IP å·²å­˜åœ¨ï¼Œæ— éœ€æ·»åŠ \"\n    exit 0\nfi\n\n# **é€’å¢ serial å·**\nincrement_serial() {\n    # æå–å½“å‰ serial å€¼\n    current_serial=$(awk '/serial/{print $1}' \"$1\")\n    \n    if [[ -z \"$current_serial\" ]]; then\n        # å¦‚æœæ²¡æœ‰æ‰¾åˆ° serialï¼ˆç©ºï¼‰ï¼Œåˆå§‹åŒ–ä¸º 1\n        current_serial=1\n    fi\n\n    # é€’å¢ serial\n    new_serial=$((current_serial + 1))\n\n    # æ›¿æ¢ serial è¡Œï¼Œä¿ç•™å‰å¯¼ç©ºæ ¼å’Œæ³¨é‡Š\n    sed -i \"s/\\([[:space:]]*\\)\\([0-9]\\+\\)\\([[:space:]]*; serial\\)/\\1$new_serial\\3/\" \"$1\"\n}\n\n\n\n# æ·»åŠ æ­£å‘è§£æåŒºåŸŸé…ç½®ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰\nif ! grep -q \"zone \\\"$BASE_DOMAIN\\\" IN\" \"$ZONE_CONFIG\"; then\n    cat >> \"$ZONE_CONFIG\" <<EOF\nzone \"$BASE_DOMAIN\" IN {\n        type master;\n        file \"$ZONE_FILE\";\n        notify yes;\n        also-notify { $SLAVE_IP; };\n        allow-update { $SLAVE_IP; };\n};\nEOF\nfi\n\n# æ·»åŠ åå‘è§£æåŒºåŸŸé…ç½®ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰\nif ! grep -q \"zone \\\"$REV_IP.in-addr.arpa\\\" IN\" \"$ZONE_CONFIG\"; then\n    cat >> \"$ZONE_CONFIG\" <<EOF\nzone \"$REV_IP.in-addr.arpa\" IN {\n        type master;\n        file \"$REV_ZONE_FILE\";\n        notify yes;\n        also-notify { $SLAVE_IP; };\n        allow-update { $SLAVE_IP; };\n};\nEOF\nfi\n\n# **åˆå§‹åŒ– Zone æ–‡ä»¶ï¼ˆæ­£å‘è§£æï¼‰**\nif [ ! -s \"$ZONE_FILE\" ]; then\n    cat > \"$ZONE_FILE\" <<EOF\n\\$TTL 1D\n@       IN SOA  $BASE_DOMAIN rname.invalid. (\n                                        1       ; serial\n                                        1D      ; refresh\n                                        1H      ; retry\n                                        1W      ; expire\n                                        3H )    ; minimum\n        NS      $BASE_DOMAIN\n$BASE_DOMAIN     A   $MASTER_IP\n\nEOF\n    increment_serial \"$ZONE_FILE\"  # åˆå§‹åŒ–æ—¶é€’å¢ serial\nfi\n\n# **è¿½åŠ  A è®°å½•ï¼ˆä½¿ç”¨çŸ­åï¼‰**\nif ! grep -q \"^$SHORT_NAME[[:space:]]*A[[:space:]]*$IP\" \"$ZONE_FILE\"; then\n    echo \"$SHORT_NAME    A       $IP\" >> \"$ZONE_FILE\"\n    increment_serial \"$ZONE_FILE\"  # è¿½åŠ è®°å½•åé€’å¢ serial\nfi\n\n# **åˆå§‹åŒ– Zone æ–‡ä»¶ï¼ˆåå‘è§£æï¼‰**\nif [ ! -s \"$REV_ZONE_FILE\" ]; then\n    cat > \"$REV_ZONE_FILE\" <<EOF\n\\$TTL 1D\n@       IN SOA  $BASE_DOMAIN rname.invalid. (\n                                        1       ; serial\n                                        1D      ; refresh\n                                        1H      ; retry\n                                        1W      ; expire\n                                        3H )    ; minimum\n        NS      $BASE_DOMAIN\n$BASE_DOMAIN     A   $MASTER_IP        \n\nEOF\n    increment_serial \"$REV_ZONE_FILE\"  # åˆå§‹åŒ–æ—¶é€’å¢ serial\nfi\n\n# **è¿½åŠ  PTR è®°å½•**\nif ! grep -q \"^$REV_HOST[[:space:]]*PTR[[:space:]]*$SHORT_NAME.$BASE_DOMAIN.\" \"$REV_ZONE_FILE\"; then\n    echo \"$REV_HOST     PTR     $SHORT_NAME.$BASE_DOMAIN.\" >> \"$REV_ZONE_FILE\"\n    increment_serial \"$REV_ZONE_FILE\"  # è¿½åŠ è®°å½•åé€’å¢ serial\nfi\n\n# åœ¨ä»æœåŠ¡å™¨ä¸Šè¿½åŠ ä¸»ä»åŒæ­¥é…ç½®\nssh -T root@$SLAVE_IP <<EOF\n# æ£€æŸ¥ä»æœåŠ¡å™¨é…ç½®æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨ä¸»ä»åŒæ­¥åŒºåŸŸ\nif ! grep -q \"zone \\\"$BASE_DOMAIN\\\" IN\" \"$ZONE_CONFIG\"; then\n    cat >> \"$ZONE_CONFIG\" <<EOT\nzone \"$BASE_DOMAIN\" IN { \n    type slave;\n    file \"slaves/$BASE_DOMAIN.zone\"; \n    masters { $MASTER_IP; }; # ä¸»æœåŠ¡å™¨çš„IP\n};\nEOT\nfi\n\n# æ£€æŸ¥åå‘è§£æçš„ä»æœåŠ¡å™¨é…ç½®\nif ! grep -q \"zone \\\"$REV_IP.in-addr.arpa\\\" IN\" \"$ZONE_CONFIG\"; then\n    cat >> \"$ZONE_CONFIG\" <<EOT\nzone \"$REV_IP.in-addr.arpa\" IN { \n    type slave;\n    file \"slaves/$REV_IP.loopback\";\n    masters { $MASTER_IP; }; # ä¸»æœåŠ¡å™¨çš„IP\n};\nEOT\nfi\nEOF\n\n# é‡æ–°åŠ è½½ä¸»æœåŠ¡å™¨çš„ Bind é…ç½®\nsystemctl restart named\necho \"âœ… DNS è®°å½•å·²æ·»åŠ å¹¶é‡æ–°åŠ è½½ Bind æœåŠ¡\"\n\n# é‡æ–°åŠ è½½ä»æœåŠ¡å™¨ä¸Šçš„ Bind é…ç½®\nssh -T root@$SLAVE_IP <<EOF\nsystemctl restart named\necho \"âœ… ä»æœåŠ¡å™¨ $SLAVE_IP é…ç½®å·²æ›´æ–°å¹¶é‡æ–°åŠ è½½ Bind æœåŠ¡\"\nEOF\n\necho \"âœ… ä¸»ä»åŒæ­¥é…ç½®å·²æˆåŠŸæ·»åŠ åˆ°ä»æœåŠ¡å™¨ $SLAVE_IP\"\n\n\nsystemctl restart named\n```\n\n```\nbash jx.sh 192.168.111.201 bs.qianyios12.top\nbash jx.sh 192.168.123.202 bs1.qianyios1245.top\nbash jx.sh 192.168.236.203 bs3.qianyios22224.top\n```\n\n![image-20250402132308000](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/8060dd7bda99a6f95fe8286cc34b9459697559838.png)\n\næ¥ä¸‹æ¥è¿›è¡Œæµ‹è¯•ï¼Œä¸‰å°æœºéƒ½å¯ä»¥è¿›è¡Œæµ‹è¯•\n\n```\nnslookup bs.qianyios12.top\nnslookup bs1.qianyios1245.top\nnslookup bs3.qianyios22224.top\nhost 192.168.111.201\nhost 192.168.123.202\nhost 192.168.236.203\n```\n\nmaster\n\n![image-20250402132443227](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/7cbc35d7f7388eae23363b926a74a381697559838.png)\n\nslave\n\n![image-20250402132517976](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/1f5ecab61cb544dcdc3bb63333188d2e697559838.png)\n\nclient\n\n![image-20250402132543331](../img/Linux%E9%85%8D%E7%BD%AEDNS%E6%9C%8D%E5%8A%A1/77e50dd6896f3c3d4990522ed860a2d1697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["OpenEuler","Linux","Dns"],"categories":["è¿ç»´"]},{"title":"å·¨å®Œç¾çš„Dockeré•œåƒåŠ é€Ÿæ–¹æ¡ˆ","url":"/posts/69efb119/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# æœ€å®Œç¾çš„Dockeré•œåƒåŠ é€Ÿæ–¹æ¡ˆ\n\n## æ³¨å†Œè´¦å·\n\nç°åœ¨è¿™æ³¨å†Œä¸€ä¸ªè´¦å· [CNB - Cloud Native Build](https://cnb.cool/)\n\n## åˆ›å»ºç»„ç»‡\n\n![image-20250312130512416](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/c9126180e0ef22f54ca024b9292ec590697559838.png)\n\n## vscodeå®‰è£…cnbæ’ä»¶\n\n![image-20250312130900409](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/c80b8a70c8142239c5f6fa1feacb1b36697559838.png)\n\n![image-20250312130921303](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/17427482007f50fb1fdd42e170a3ac45697559838.png)\n\n## åˆ›å»ºä»¤ç‰Œ\n\næŒ‰ç…§ä¸Šé¢çš„éœ€è¦å»æƒé™è¿›è¡Œåˆ›å»ºä»¤ç‰Œ\n\n![image-20250312130749592](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/d24343adbc6f9ff43662ca43d4d1a4f4697559838.png)\n\n![image-20250312131157890](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/2ce45e76b807c4077cf16ac2a7ee3693697559838.png)\n\n![image-20250312131213531](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/d7b0bad8ca361ed79bf0c53aa593c898697559838.png)\n\ncvXpcpkmqiNQA1c77TZOR5ke1EG\n\n## åˆ›å»ºä»“åº“\n\nä¸€å®šè¦æ˜¯å…¬å¼€çš„\n\n![image-20250312131922242](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/655ab6a23a75c35bdea1964a76078c71697559838.png)\n\nè¿™æ—¶å€™è¿™é‡Œå°±ä¼šè¯»å–åˆ°\n\n![image-20250312133043835](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/21635cda0c0e6ca8d7cfad3c7ababafe697559838.png)\n\n## å¼€å§‹åŒæ­¥\n\nå‡è®¾æœ‰ä¸ªé•œåƒï¼Œæ˜¯æ‹‰å–ä¸åˆ°çš„\n\n```\nk8s.gcr.io/pause:3.1\n```\n\n![image-20250312133649822](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/76757b489123e5f11cb3fdc008b1bbe1697559838.png)\n\n![image-20250312133929159](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/6ee75ebd2e40f65097e1ecee90dcaafc697559838.png)\n\nå› ä¸ºé•œåƒæœ‰æ ‡ç­¾ï¼Œæ‰€ä»¥åœ¨æœ€ä¸‹é¢æœ‰ä¸ªå¸¦æ ‡ç­¾çš„åœ°å€\n\n![image-20250312134258046](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/331860787d18274e68ce0f1f0e412dba697559838.png)\n\n![image-20250312143032690](../img/Docker%E5%8A%A0%E9%80%9F%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/1d893daf57b348db8625114a1a28b9f6697559838.png)\n\nä¸‹è½½æˆåŠŸï¼","tags":["Docker"],"categories":["Docker"]},{"title":"å¤§æ•°æ®hadoopå®éªŒ","url":"/posts/d721e715/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# å¤§æ•°æ®hadoopå®éªŒ\n\né•œåƒä¸‹è½½ï¼š[ubuntu-18.04.6-desktop-amd64.iso](https://mirrors.aliyun.com/ubuntu-releases/18.04.6/ubuntu-18.04.6-desktop-amd64.iso)\n\n## å¤§ä½œä¸š\n\nä¸‹é¢ä¸¤ä¸ªæ–‡æ¡£ï¼Œè‡ªå·±é€‰ä¸€ä¸ªï¼Œé‚£ä¸ªä½ ä¼šç”¨ä½ å°±ç”¨ï¼Œæ›¿æ¢é€»è¾‘æ˜¯ä¸€æ ·çš„\n\nwordæ–‡æ¡£ï¼š[å¤§ä½œä¸šæ–‡æ¡£](https://alist.qianyios.top/d/%E6%B8%B8%E5%AE%A2/R2/%E4%BD%9C%E4%B8%9A/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%9F%BA%E4%BA%8E%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0%E7%9A%84%E9%A1%BE%E5%AE%A2%E8%B4%AD%E4%B9%B0%E8%A1%8C%E4%B8%BA%E8%B6%8B%E5%8A%BF%E5%88%86%E6%9E%90.docx?sign=WsZ6ay6lABomcaX8-x1_5j9nMcyrQp2Iz8stQ0d_4xw=:0)\n\nmarkdownæ–‡æ¡£ï¼š[markdownæ–‡æ¡£](https://alist.qianyios.top/d/%E6%B8%B8%E5%AE%A2/R2/%E4%BD%9C%E4%B8%9A/%E5%A4%A7%E6%95%B0%E6%8D%AE/markdowan%E5%A4%A7%E4%BD%9C%E4%B8%9A.7z?sign=4bhGZRq7XPtT7js_60e_OdpqaULHor-N2iQ3lQ1ladk=:0)\n\nä¸‹è½½ä¹‹åï¼Œæ‰“å¼€æŒ‰Ctrl+Hè¿›è¡Œæ›¿æ¢å†…å®¹\n\næŸ¥æ‰¾å†…å®¹ï¼š`student/202206150540/yanjiaxi`\n\næ›¿æ¢ä¸ºï¼š`student/ä½ çš„å­¦å·/ä½ çš„åå­—`\n\næ³¨æ„ï¼š`å‰åæ²¡æœ‰æ–œæ `\n\nç¡®å®šä¹‹åä½ å°±å¯ä»¥è‡ªå·±å¤åˆ¶ä»£ç è¿è¡Œäº†\n\nå…ˆç»™è‡ªå·±çš„è™šæ‹Ÿæœºæ‰“å¿«ç…§ï¼Œåœ¨åšå¤§ä½œä¸š\n\n![Snipaste_2025-06-03_21-46-51](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/Snipaste_2025-06-03_21-46-51-1749470495094-1.png)\n\n## å®‰è£…ubuntuç³»ç»Ÿ\n\n![image-20250306172718280](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/ee3dfc4019e734c65139f7592b3d1047697559838-1743071004579-155-1746692007775-376-1747299497349-1-1747900721328-1-1749470495094-2.png)\n\n![image-20250306172858685](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/f90c48f1768517a761ac0b29e7f1cbd4697559838-1743071004579-156-1746692007776-377-1747299497349-2-1747900721328-2-1749470495094-3.png)\n\n![image-20250306172955435](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/2ffdc69cf1e6c8963b9d74ebf13149f8697559838-1743071004579-157-1746692007776-378-1747299497349-3-1747900721328-4-1749470495095-4.png)\n\nä¸€è·¯ç¡®å®šå°±è¡Œäº†\n\n![image-20250306173133874](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b9783bd5efab7f47366d1971be6de07b697559838-1743071004579-158-1746692007776-379-1747299497349-4-1747900721328-3-1749470495095-5.png)\n\nè®¾ç½®dhcpæ¨¡å¼å¦åˆ™æ— æ³•è”ç½‘å®‰è£…\n\n#dhcpæœåŠ¡\n\n![image-20250306181204335](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/dfd278fb04265d5ea96ea487ce74d285697559838-1743071004579-159-1746692007776-380-1747299497349-5-1747900721328-5-1749470495095-6.png)\n\nç„¶åå¼€æœºï¼Œç„¶åé€‰æ‹©==ä¸­æ–‡==,ç„¶åæŒ‰æç¤ºå®‰è£…\n\n![image-20250306173400725](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/1f98e04ec2b7adf765c360075093adc1697559838-1743071004579-160-1746692007776-381-1747299497349-6-1747900721328-6-1749470495095-8.png)\n\n![image-20250306173436631](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/831b0baf3cb357789b20cbcee155f03b697559838-1743071004579-161-1746692007776-382-1747299497349-7-1747900721328-7-1749470495095-7.png)\n\nç„¶åå°±å¼€å§‹å®‰è£…å°±è¡Œäº†,åˆ°åé¢é‡å¯ä¹‹åï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªç•Œé¢\n\n![image-20250308211726292](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/a1b540626e2a073bffee678729200d3c697559838-1743071004579-162-1746692007776-383-1747299497349-8-1747900721328-8-1749470495095-9.png)\n\nè§£å†³åŠæ³•\n\n![image-20250308211858778](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/001e630863c1f4c32a7f77e9f76eb2a1697559838-1743071004580-163-1746692007776-384-1747299497349-9-1747900721328-9-1749470495095-10.png)\n\nç„¶åä½ å†å¼€æœºå°±è¡Œäº†\n\nåˆ‡æ¢é˜¿é‡Œäº‘é•œåƒæº\n\n![image-20250306182430499](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/07352662ff84d9dc914cdd6e0a2a749d697559838-1743071004580-164-1746692007776-385-1747299497349-11-1747900721328-10-1749470495095-12.png)\n\n![image-20250306212359634](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/dd8381e4110babef193c865e99493d03697559838-1743071004580-165-1746692007776-386-1747299497349-10-1747900721328-11-1749470495095-11.png)\n\nç­‰å¾…æ›´æ–°ç¼“å­˜\n\n\n\nåˆ°æ¡Œé¢åå³é”®æ¡Œé¢ç©ºç™½å¤„æ‰“å¼€ç»ˆç«¯è¿›è¡Œè¾“å…¥ä¸‹é¢æŒ‡ä»¤\n\n`ä¸€é”®å®‰è£…vm-toolså¯ä»¥å®ç°è·¨ç«¯å¤åˆ¶ç²˜è´´`\n\n```bash\nsudo apt-get install -y wget\nsudo wget https://resource.qianyios.top/init.sh\nsudo chmod +x init.sh\nbash init.sh \n```\n\næ¥ä¸‹æ¥é‡å¯ç­‰å¾…è½¯ä»¶ç”Ÿæ•ˆä¹‹åï¼Œä½ å°±`å…³æœº`ï¼Œè¿™æ—¶å€™ä½ è¦`æ‰“ä¸ªå¿«ç…§`ï¼Œä»¥ä¾¿åé¢åšé¡¹ç›®å‡ºé”™å¯ä»¥æ¢å¤ï¼Œç„¶åå¼€æœº\n\n![image-20250306174127049](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/c91e76a873ad6af429f3fdc1edae8237697559838-1743071004580-166-1746692007776-387-1747299497349-12-1747900721328-12-1749470495095-13.png)\n\n\n\n## åˆ›å»ºhadoopç”¨æˆ·\n\nåˆ›å»ºhadoopç”¨æˆ·å¹¶ä¸”è®¾ç½®å¯†ç \n\n```\nsudo useradd -m hadoop -s /bin/bash\nsudo passwd hadoop\n```\n\n![image-20250306180546505](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/8aa05cb5a1b5dc9bf6af23d990b507ca697559838-1743071004580-167-1746692007776-388-1747299497349-13-1747900721328-13-1749470495095-14.png)\n\nç»™hadoopç”¨æˆ·æ·»åŠ sudoæƒé™\n\n```\nsudo adduser hadoop sudo\n```\n\n![image-20250306180700866](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/51d052125ddfbbe9a9005e2a7e8e5dcf697559838-1743071004580-168-1746692007776-389-1747299497349-17-1747900721328-14-1749470495095-18.png)\n\nè¿™æ—¶å€™æ¡Œé¢å³ä¸Šè§’æ³¨é”€è´¦å·åˆ‡æ¢æˆhadoop\n\n![image-20250306182143578](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/387107b5560e971a6f550b631041a66d697559838-1743071004580-169-1746692007776-390-1747299497349-15-1747900721328-15-1749470495095-15.png)\n\n## è®¾ç½®sshå…å¯†\n\nä¸€é”®å…¨éƒ¨å¤åˆ¶ï¼Œç„¶åç²˜è´´å›è½¦å°±ä¼šè‡ªåŠ¨è¿›è¡Œå…å¯†\n\n> ä»£ç ä¸­æœ‰password=\"123456\",è®°å¾—æ”¹æˆä½ çš„hadoopç”¨æˆ·çš„å¯†ç \n\n```bash\nsudo cat >ssh.sh<<\"EOF\"\n#!/bin/bash\nsudo apt-get install openssh-server -y\nsudo systemctl disable ufw --now\n# ç¡®ä¿ PasswordAuthentication è®¾ç½®ä¸º yes\necho \"æ­£åœ¨æ›´æ–° SSH é…ç½®...\"\nsudo sed -i 's/^#*PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config\nsudo systemctl restart ssh\n\n# å®‰è£… sshpass\necho \"æ­£åœ¨å®‰è£… sshpass...\"\nsudo apt update\nsudo apt install -y sshpass || { echo \"å®‰è£… sshpass å¤±è´¥\"; exit 1; }\necho \"sshpass å®‰è£…å®Œæˆã€‚\"\n\n# åˆ›å»º .ssh ç›®å½•å¹¶è®¾ç½®æƒé™\necho \"æ­£åœ¨æ£€æŸ¥ .ssh ç›®å½•...\"\nif [ ! -d ~/.ssh ]; then\n    sudo mkdir -p ~/.ssh\nfi\nsudo chmod 700 ~/.ssh\nsudo chown -R hadoop:hadoop ~/.ssh\n\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"localhost\")\n# å¯†ç \npassword=\"123456\"\n\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\necho \"æ­£åœ¨ç”Ÿæˆ SSH å¯†é’¥å¯¹...\"\nif [ ! -f ~/.ssh/id_rsa ]; then\n    ssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa || { echo \"ç”Ÿæˆ SSH å¯†é’¥å¯¹å¤±è´¥\"; exit 1; }\nfi\nchmod 600 ~/.ssh/id_rsa\nchmod 644 ~/.ssh/id_rsa.pub\necho \"SSH å¯†é’¥å¯¹å·²ç”Ÿæˆã€‚\"\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    echo \"æ­£åœ¨ä¸º $host é…ç½®å…å¯†ç™»å½•...\"\n    \n    # ç¡®ä¿ç›®æ ‡ä¸»æœºçš„ .ssh ç›®å½•å­˜åœ¨\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"mkdir -p ~/.ssh && chmod 700 ~/.ssh\"\n    \n    # å°†å…¬é’¥å¤åˆ¶åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -i ~/.ssh/id_rsa.pub -o StrictHostKeyChecking=no \"$host\" || { echo \"å¤åˆ¶å…¬é’¥åˆ° $host å¤±è´¥\"; exit 1; }\n    \n    # éªŒè¯å…å¯†ç™»å½•æ˜¯å¦æˆåŠŸ\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\" || { echo \"éªŒè¯å…å¯†ç™»å½•å¤±è´¥\"; exit 1; }\ndone\n\necho \"æ‰€æœ‰é…ç½®å·²å®Œæˆã€‚\"\nEOF\n\n```\n\nè¿è¡Œè„šæœ¬\n\n```\nbash ssh.sh\n```\n\næµ‹è¯•ç™»å…¥localhostæ˜¯å¦å¯ä»¥å®ç°æ— å¯†ç ç™»å…¥\n\n```\nssh localhost\n```\n\n![image-20250306185319755](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/f6a283afd9c710caa08e8d0647868159697559838-1743071004580-170-1746692007776-391-1747299497349-14-1747900721328-16-1749470495095-16.png)\n\næˆåŠŸ\n\n## å®‰è£…javaå’Œhadoop\n\nå°†ä¸¤ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°ä¸‹è½½çš„ç›®å½•å»\n\n![image-20250306190055853](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/bf8992440f0c82cf90da81b76c08e388697559838-1743071004580-171-1746692007776-392-1747299497349-16-1747900721328-17-1749470495095-17.png)\n\nç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œç©ºç™½å¤„å³é”®ï¼Œæ‰“å¼€ç»ˆç«¯\n\n![image-20250306190200797](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/0efdb8f2156ff61db6acdd5f3d8bc9af697559838-1743071004580-172-1746692007776-393-1747299497349-18-1747900721328-18-1749470495095-19.png)\n\n```\nç¡®è®¤ä¸€ä¸‹å½“å‰æ–‡ä»¶å¤¹æ˜¯ä¸æ˜¯æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶\n```\n\n```\nls\n```\n\n![image-20250306190237227](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/91661da6fad3b2b9fcc742360031d354697559838-1743071004580-173-1746692007776-394-1747299497349-19-1747900721328-20-1749470495095-20.png)\n\nä»¥ä¸‹çš„å…¨éƒ¨å¤åˆ¶è¿è¡Œ\n\n```bash\nsudo mkdir /usr/lib/jvm\n#å®‰è£…java8\nsudo tar -xf jdk-8u162-linux-x64.tar.gz  -C /usr/lib/jvm\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162\" >> ~/.bashrc\necho \"export PATH=\\$JAVA_HOME/bin:\\$PATH\" >> ~/.bashrc\nsource ~/.bashrc\njava -version\n\n#å®‰è£…hadoop-3.1.3\nsudo tar -zxf hadoop-3.1.3.tar.gz -C /usr/local\nsudo mv /usr/local/hadoop-3.1.3/ /usr/local/hadoop\necho \"export HADOOP_HOME=/usr/local/hadoop\" >> ~/.bashrc\necho \"export PATH=\\$HADOOP_HOME/bin/:\\$HADOOP_HOME/sbin/:\\$PATH\" >> ~/.bashrc\nsource ~/.bashrc\nsudo chown -R hadoop /usr/local/hadoop\nhadoop version\n```\n\n> è¿™é‡Œæ˜¯ä½œä¸šè¦æˆªå›¾çš„åœ°æ–¹\n\n![image-20250306191054386](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/a160c95403711706a1f827c8e4b2c908697559838-1743071004580-174-1746692007776-395-1747299497350-20-1747900721328-19-1749470495095-22.png)\n\n![image-20250306191150354](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/1af756c5bb618a59a99925f484d38ba1697559838-1743071004580-175-1746692007776-396-1747299497350-22-1747900721328-21-1749470495095-21.png)\n\nè¿™æ—¶å€™å…³æœºæ‰“ä¸ª`å¿«ç…§`ï¼Œå‘½åä¸ºåŸºç¡€\n\n## ä¼ªåˆ†å¸ƒå®‰è£…\n\n### ç¼–å†™cort-site.yamlæ–‡ä»¶\n\nä»¥ä¸‹çš„å…¨éƒ¨å¤åˆ¶è¿è¡Œ\n\n```\ncat > /usr/local/hadoop/etc/hadoop/core-site.xml<< \"EOF\"\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?>\n<configuration>\n    <property>\n        <name>hadoop.tmp.dir</name>\n        <value>file:/usr/local/hadoop/tmp</value>\n        <description>Abase for other temporary directories.</description>\n    </property>\n    <property>\n        <name>fs.defaultFS</name>\n        <value>hdfs://localhost:9000</value>\n    </property>\n</configuration>\nEOF\n```\n\n### ç¼–å†™hdfs-site.xml\n\nä»¥ä¸‹çš„å…¨éƒ¨å¤åˆ¶è¿è¡Œ\n\n```\ncat >/usr/local/hadoop/etc/hadoop/hdfs-site.xml<<\"EOF\"\n<configuration>\n    <property>\n        <name>dfs.replication</name>\n        <value>1</value>\n    </property>\n    <property>\n        <name>dfs.namenode.name.dir</name>\n        <value>file:/usr/local/hadoop/tmp/dfs/name</value>\n    </property>\n    <property>\n        <name>dfs.datanode.data.dir</name>\n        <value>file:/usr/local/hadoop/tmp/dfs/data</value>\n    </property>\n</configuration>\nEOF\n\n```\n\n### å¯åŠ¨hhdfsæœåŠ¡\n\n`hdfsåˆå§‹åŒ–`\n\n`è¿™æ¡å‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡ï¼Œä»¥åéƒ½ä¸è¦å†è¿è¡Œäº†ï¼ï¼ï¼ï¼ï¼ï¼`\n\n`è¿™æ¡å‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡ï¼Œä»¥åéƒ½ä¸è¦å†è¿è¡Œäº†ï¼ï¼ï¼ï¼ï¼ï¼`\n\n`è¿™æ¡å‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡ï¼Œä»¥åéƒ½ä¸è¦å†è¿è¡Œäº†ï¼ï¼ï¼ï¼ï¼ï¼`\n\n```\nhdfs namenode -format\n```\n\n![image-20250306191818068](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/00af8b3b067332eed696bb3557ba8acf697559838-1743071004580-176-1746692007776-397-1747299497350-21-1747900721328-22-1749470495095-23.png)\n\nå‡ºç°è¿™ä¸ªè¯´æ˜åˆå§‹åŒ–æˆåŠŸ\n\n### æ·»åŠ hdfs yarnçš„ç¯å¢ƒå˜é‡\n\nä»¥ä¸‹çš„å…¨éƒ¨å¤åˆ¶è¿è¡Œ\n\n```bash\necho \"export HDFS_NAMENODE_USER=hadoop\" >> ~/.bashrc\necho \"export HDFS_DATANODE_USER=hadoop\" >> ~/.bashrc\necho \"export HDFS_SECONDARYNAMENODE_USER=hadoop\" >> ~/.bashrc\necho \"export YARN_RESOURCEMANAGER_USER=hadoop\" >> ~/.bashrc\necho \"export YARN_NODEMANAGER_USER=hadoop\" >> ~/.bashrc\nsource ~/.bashrc\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162\" >> /usr/local/hadoop/etc/hadoop/hadoop-env.sh\n```\n\n```bash\n#å¼€å¯hadoopçš„å‘½ä»¤\nstart-all.sh\n#å½“ä½ è¦å…³æœºçš„æ—¶å€™å…ˆè¿è¡Œä¸‹é¢çš„å‘½ä»¤å…³æ‰hadoopå…ˆï¼Œå†å…³æœº\nstop-all.sh\n```\n\n> è¿™é‡Œæ˜¯ä½œä¸šè¦æˆªå›¾çš„åœ°æ–¹\n\n![image-20250306192423176](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6598318c96d7150998b697814614cbe5697559838-1743071004580-177-1746692007776-398-1747299497350-23-1747900721328-23-1749470495095-24.png)\n\njpså‘½ä»¤ç”¨æ¥æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å¯åŠ¨ï¼Œä»¥ä¸Šæ˜¯hadoopæ­£å¸¸å¯åŠ¨çš„è¿›ç¨‹ï¼Œæ€»å…±æœ‰6ä¸ª\n\n### è®¿é—®hadoopç½‘é¡µ\n\nçœ‹çœ‹ä½ çš„ip\n\n```\nip a\n```\n\n![image-20250306192632197](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/5bdaab2f886644715fb131d56b9cc239697559838-1743071004580-178-1746692007776-399-1747299497350-24-1747900721328-24-1749470495095-25.png)\n\nå¦‚æœä½ è¿™é‡Œæ²¡æœ‰ipè¯´æ˜ä½ æ²¡æœ‰å¼€å¯dhcpæœåŠ¡ï¼Œè‡ªè¡Œå›åˆ°æœ€å¼€å§‹ï¼Œæ‰¾å¼€å¯dhcpçš„æ–¹æ³•ï¼Œå…³æœºå¼€å¯dhcpï¼Œç„¶åå¼€æœºå°±ä¼šæœ‰ipäº†\n\n> è¿™é‡Œæ˜¯ä½œä¸šè¦æˆªå›¾çš„åœ°æ–¹\n\nhttp://ip:9870\n\n```\nhttp://192.168.48.132:9870/\n```\n\n![image-20250306192915923](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/4dfc296f2ec13a6dfafc20a8f5891d1d697559838-1743071004580-179-1746692007776-400-1747299497350-25-1747900721328-25-1749470495095-27.png)\n\nhttp://ip:8088\n\n![image-20250306193032219](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/19c347205dca343973b7ee126ce96a6b697559838-1743071004580-180-1746692007777-401-1747299497350-26-1747900721328-26-1749470495095-26.png)\n\n### å…³æœºæ­¥éª¤\n\nè¿™æ—¶å€™å…³é—­hadoopé›†ç¾¤\n\n```\nstop-all.sh\n```\n\nç„¶åå…³æœºæ‰“å¿«ç…§ï¼Œå‘½åä¼ªåˆ†å¸ƒ\n\n```\nsudo poweroff\n```\n\nç„¶ååœ¨è¿™é‡Œæ‰“ä¸ªå¿«ç…§ï¼Œå‘½åä¸ºä¼ªåˆ†å¸ƒå®‰è£…æˆåŠŸï¼Œç­‰ä½ å“ªå¤©æœºå­åäº†ï¼Œä½ å°±å¯ä»¥æ¢å¤å¿«ç…§\n\n![image-20250318173513618](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/2da7a916c9744aa69041f71f45d21ddc697559838-1743071004580-181-1746692007777-402-1747299497350-27-1747900721328-27-1749470495095-28.png)\n\n> ä¸¥è‚ƒå‘ŠçŸ¥ï¼Œåˆ«è¯´æˆ‘æ²¡æé†’ä½ ï¼Œä¸è¦ç›´æ¥å…³æœºï¼Œä¹Ÿä¸è¦æŒ‚èµ·è™šæ‹Ÿæœºï¼Œå¦åˆ™ä½ çš„è™šæ‹Ÿæœºå’Œhadoopåäº†ï¼Œä½ å°±é‡è£…å§\n>\n> ![image-20250318173348088](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/7327d43e46ac634be9f37da89e6d4241697559838-1743071004580-182-1746692007777-403-1747299497350-28-1747900721328-28-1749470495095-29.png)\n\n## ç¬¬ä¸€æ¬¡å®éªŒ\n\n### ç†Ÿæ‚‰å¸¸ç”¨çš„Linuxæ“ä½œ\n\n1ï¼‰cdå‘½ä»¤ï¼šåˆ‡æ¢ç›®å½•\n\nï¼ˆ1ï¼‰ åˆ‡æ¢åˆ°ç›®å½•â€œ/usr/localâ€\n\n```\ncd /usr/local\n```\n\nï¼ˆ2ï¼‰ åˆ‡æ¢åˆ°å½“å‰ç›®å½•çš„ä¸Šä¸€çº§ç›®å½•\n\n```\ncd ..\n```\n\nï¼ˆ3ï¼‰ åˆ‡æ¢åˆ°å½“å‰ç™»å½•Linuxç³»ç»Ÿçš„ç”¨æˆ·çš„è‡ªå·±çš„ä¸»æ–‡ä»¶å¤¹\n\n```\ncd ~\n```\n\n![image-20250313143132503](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/c7feb6b1c838be089bc0415e2fee14aa697559838-1743071004581-183-1746692007777-404-1747299497350-29-1747900721328-29-1749470495095-30.png)\n\n2ï¼‰lså‘½ä»¤ï¼šæŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•\n\næŸ¥çœ‹ç›®å½•â€œ/usrâ€ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•\n\n```\ncd /usr\nls -al\n```\n\n![image-20250313143140661](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/207e580ee326e3c1ac36d020bb5f9107697559838-1743071004581-184-1746692007777-405-1747299497350-30-1747900721328-30-1749470495095-31.png)\n\n3ï¼‰mkdirå‘½ä»¤ï¼šæ–°å»ºç›®å½•\n\nï¼ˆ1ï¼‰è¿›å…¥â€œ/tmpâ€ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºâ€œaâ€çš„ç›®å½•ï¼Œå¹¶æŸ¥çœ‹â€œ/tmpâ€ç›®å½•ä¸‹å·²ç»å­˜åœ¨å“ªäº›ç›®å½•\n\n```\ncd /tmp\nmkdir a\nls -al\n```\n\n![image-20250313143206832](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/2c3bd5c36f9ab9cef9fd9d0757b816ca697559838-1743071004581-185-1746692007777-406-1747299497350-31-1747900721328-31-1749470495095-32.png)\n\nï¼ˆ2ï¼‰è¿›å…¥â€œ/tmpâ€ç›®å½•ï¼Œåˆ›å»ºç›®å½•â€œa1/a2/a3/a4â€ \n\n```\ncd /tmp\nmkdir -p a1/a2/a3/a4\n```\n\n![image-20250313143217857](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/620d448824dba651c9bd4949647ee72a697559838-1743071004581-186-1746692007777-407-1747299497350-32-1747900721328-32-1749470495095-33.png)\n\n4ï¼‰rmdirå‘½ä»¤ï¼šåˆ é™¤ç©ºçš„ç›®å½•\n\nï¼ˆ1ï¼‰å°†ä¸Šé¢åˆ›å»ºçš„ç›®å½•aï¼ˆåœ¨â€œ/tmpâ€ç›®å½•ä¸‹é¢ï¼‰åˆ é™¤\n\nï¼ˆ2ï¼‰åˆ é™¤ä¸Šé¢åˆ›å»ºçš„ç›®å½•â€œa1/a2/a3/a4â€ ï¼ˆåœ¨â€œ/tmpâ€ç›®å½•ä¸‹é¢ï¼‰ï¼Œç„¶åæŸ¥çœ‹â€œ/tmpâ€ç›®å½•ä¸‹é¢å­˜åœ¨å“ªäº›ç›®å½•\n\n```\ncd /tmp\nrmdir a\ncd /tmp\nrmdir -p a1/a2/a3/a4\nls -al\n```\n\n![image-20250313150519301](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/d02274363f08a488d8901ebe00e25cca697559838-1743071004581-187-1746692007777-408-1747299497350-33-1747900721328-34-1749470495095-34.png)\n\n5ï¼‰cpå‘½ä»¤ï¼šå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•\n\nï¼ˆ1ï¼‰å°†å½“å‰ç”¨æˆ·çš„ä¸»æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶.bashrcå¤åˆ¶åˆ°ç›®å½•â€œ/usrâ€ä¸‹ï¼Œå¹¶é‡å‘½åä¸ºbashrc1\n\n```\nsudo cp ~/.bashrc /usr/bashrc1\n```\n\n![image-20250313150547907](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/97f3fb32f45eb9fc11150ca1cd003f07697559838-1743071004581-188-1746692007777-409-1747299497350-34-1747900721328-33-1749470495095-35.png)\n\nï¼ˆ2ï¼‰åœ¨ç›®å½•â€œ/tmpâ€ä¸‹æ–°å»ºç›®å½•testï¼Œå†æŠŠè¿™ä¸ªç›®å½•å¤åˆ¶åˆ°â€œ/usrâ€ç›®å½•ä¸‹\n\n```\ncd /tmp\nmkdir test\nsudo cp -r /tmp/test /usr\n```\n\n![image-20250313150608722](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/315577abf317204a01afe6ded7293d3c697559838-1743071004581-189-1746692007777-410-1747299497350-35-1747900721328-35-1749470495095-36.png)\n\n6ï¼‰mvå‘½ä»¤ï¼šç§»åŠ¨æ–‡ä»¶ä¸ç›®å½•ï¼Œæˆ–æ›´å\n\nï¼ˆ1ï¼‰å°†â€œ/usrâ€ç›®å½•ä¸‹çš„æ–‡ä»¶bashrc1ç§»åŠ¨åˆ°â€œ/usr/testâ€ç›®å½•ä¸‹\n\n```\nsudo mv /usr/bashrc1 /usr/test\n```\n\nï¼ˆ2ï¼‰å°†â€œ/usrâ€ç›®å½•ä¸‹çš„testç›®å½•é‡å‘½åä¸ºtest2\n\n```\nsudo mv /usr/test /usr/test2\n```\n\n![image-20250313150650543](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b8275a3ec6d53feebd7380e0248c75f0697559838-1743071004581-190-1746692007777-411-1747299497350-36-1747900721328-36-1749470495095-38.png)\n\n7ï¼‰rmå‘½ä»¤ï¼šç§»é™¤æ–‡ä»¶æˆ–ç›®å½•\n\nï¼ˆ1ï¼‰å°†â€œ/usr/test2â€ç›®å½•ä¸‹çš„bashrc1æ–‡ä»¶åˆ é™¤\n\n```\nsudo rm /usr/test2/bashrc1\n```\n\nï¼ˆ2ï¼‰å°†â€œ/usrâ€ç›®å½•ä¸‹çš„test2ç›®å½•åˆ é™¤\n\n```\nsudo rm -r /usr/test2\n```\n\n![image-20250313150701498](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b447cf3a45829d5e43aaf9a5a59ec0db697559838-1743071004581-191-1746692007777-412-1747299497350-37-1747900721328-37-1749470495095-37.png)\n\n8ï¼‰catå‘½ä»¤ï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹\n\næŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹ä¸‹çš„.bashrcæ–‡ä»¶å†…å®¹\n\n```\ncat ~/.bashrc\n```\n\n![image-20250313150717805](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/a4d6640a8ea734665621d6d9e566704c697559838-1743071004581-192-1746692007777-413-1747299497350-38-1747900721328-38-1749470495095-40.png)\n\n9ï¼‰tacå‘½ä»¤ï¼šåå‘æŸ¥çœ‹æ–‡ä»¶å†…å®¹\n\nåå‘æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹ä¸‹çš„.bashrcæ–‡ä»¶çš„å†…å®¹\n\n```\ntac ~/.bashrc\n```\n\n![image-20250313150727016](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b6dc096b152e74428be417550aebca41697559838-1743071004581-193-1746692007777-414-1747299497350-39-1747900721329-39-1749470495095-39.png)\n\n10ï¼‰moreå‘½ä»¤ï¼šä¸€é¡µä¸€é¡µç¿»åŠ¨æŸ¥çœ‹\n\nç¿»é¡µæŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹ä¸‹çš„.bashrcæ–‡ä»¶çš„å†…å®¹\n\n```\nmore ~/.bashrc\n```\n\n![image-20250313150745391](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/2b4378e6085504a1a609dab7af2fc4a9697559838-1743071004581-194-1746692007777-415-1747299497350-41-1747900721329-40-1749470495095-41.png)\n\n11ï¼‰headå‘½ä»¤ï¼šå–å‡ºå‰é¢å‡ è¡Œ\n\nï¼ˆ1ï¼‰æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹ä¸‹.bashrcæ–‡ä»¶å†…å®¹å‰20è¡Œ\n\n```\nhead -n 20 ~/.bashrc\n```\n\nï¼ˆ2ï¼‰æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹ä¸‹.bashrcæ–‡ä»¶å†…å®¹ï¼Œåé¢50è¡Œä¸æ˜¾ç¤ºï¼Œåªæ˜¾ç¤ºå‰é¢å‡ è¡Œ\n\n```\nhead -n -50 ~/.bashrc\n```\n\n![image-20250313150813349](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b8ff8645a0dc3e3577aa7b11982f22c5697559838-1743071004581-195-1746692007777-416-1747299497350-42-1747900721329-41-1749470495095-42.png)\n\n12ï¼‰tailå‘½ä»¤ï¼šå–å‡ºåé¢å‡ è¡Œ\n\nï¼ˆ1ï¼‰æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹ä¸‹.bashrcæ–‡ä»¶å†…å®¹æœ€å20è¡Œ\n\n```\ntail -n 20 ~/.bashrc\n```\n\nï¼ˆ2ï¼‰æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹ä¸‹.bashrcæ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¸”åªåˆ—å‡º50è¡Œä»¥åçš„æ•°æ®\n\n```\ntail -n +50 ~/.bashrc\n```\n\n![image-20250313150837188](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/c641803b61a67b7b189d1e43dc559178697559838-1743071004581-196-1746692007777-417-1747299497350-40-1747900721329-42-1749470495095-45.png)\n\n13ï¼‰touchå‘½ä»¤ï¼šä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ–åˆ›å»ºæ–°æ–‡ä»¶\n\nï¼ˆ1ï¼‰åœ¨â€œ/tmpâ€ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶helloï¼Œå¹¶æŸ¥çœ‹æ–‡ä»¶æ—¶é—´\n\n```\ncd /tmp\ntouch hello\nls -l hello\n```\n\n![image-20250313150847348](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/fd031b0f26eb4125f30a4c76b01693fb697559838-1743071004581-197-1746692007777-418-1747299497350-43-1747900721329-43-1749470495095-43.png)\n\nï¼ˆ2ï¼‰ä¿®æ”¹helloæ–‡ä»¶ï¼Œå°†æ–‡ä»¶æ—¶é—´æ•´ä¸º5å¤©å‰\n\n```\ntouch -d \"5 days ago\" hello\n```\n\n![image-20250313150952003](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/c894c82b4795e434fece04c38b09ecc1697559838-1743071004581-198-1746692007777-419-1747299497350-44-1747900721329-44-1749470495095-44.png)\n\n14ï¼‰chownå‘½ä»¤ï¼šä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…æƒé™\n\nå°†helloæ–‡ä»¶æ‰€æœ‰è€…æ”¹ä¸ºrootå¸å·ï¼Œå¹¶æŸ¥çœ‹å±æ€§\n\n```\nsudo chown root /tmp/hello\nls -l /tmp/hello\n```\n\n![image-20250313151030899](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/c200b410e0e05a4003ed9d47529f27f8697559838-1743071004581-199-1746692007777-420-1747299497350-47-1747900721329-46-1749470495095-46.png)\n\n15ï¼‰findå‘½ä»¤ï¼šæ–‡ä»¶æŸ¥æ‰¾\n\næ‰¾å‡ºä¸»æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶åä¸º.bashrcçš„æ–‡ä»¶\n\n```\n find ~ -name .bashrc\n```\n\n![image-20250313151052617](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/243db7fb68b2a78a621793f52cf33633697559838-1743071004581-200-1746692007777-421-1747299497350-45-1747900721329-45-1749470495095-48.png)\n\n16ï¼‰tarå‘½ä»¤ï¼šå‹ç¼©å‘½ä»¤\n\nï¼ˆ1ï¼‰åœ¨æ ¹ç›®å½•â€œ/â€ä¸‹æ–°å»ºæ–‡ä»¶å¤¹testï¼Œç„¶ååœ¨æ ¹ç›®å½•â€œ/â€ä¸‹æ‰“åŒ…æˆtest.tar.gz\n\n```\nsudo mkdir /test\nsudo tar -zcv -f /test.tar.gz test\n```\n\nï¼ˆ2ï¼‰æŠŠä¸Šé¢çš„test.tar.gzå‹ç¼©åŒ…ï¼Œè§£å‹ç¼©åˆ°â€œ/tmpâ€ç›®å½•\n\n```\nsudo tar -zxv -f /test.tar.gz -C /tmp\n```\n\n![image-20250313151121057](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/9a20e406ed55d0e2c113cba8d4e81b5f697559838-1743071004581-201-1746692007778-422-1747299497350-46-1747900721329-47-1749470495095-47.png)\n\n17ï¼‰grepå‘½ä»¤ï¼šæŸ¥æ‰¾å­—ç¬¦ä¸²\n\nä»â€œï½/.bashrcâ€æ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²'examples'\n\n```\n grep -n 'examples' ~/.bashrc\n```\n\n![image-20250313151133044](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b4e5f49fa570987ddb3a1a6e32876c11697559838-1743071004581-202-1746692007778-423-1747299497350-48-1747900721329-48-1749470495095-49.png)\n\n18ï¼‰é…ç½®ç¯å¢ƒå˜é‡\n\nï¼ˆ1ï¼‰è¯·åœ¨â€œï½/.bashrcâ€ä¸­è®¾ç½®ï¼Œé…ç½®Javaç¯å¢ƒå˜é‡\n\n```\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162\" >> ~/.bashrc\necho \"export PATH=\\$JAVA_HOME/bin:\\$PATH\" >> ~/.bashrc\nsource ~/.bashrc\njava -version\n```\n\nï¼ˆ2ï¼‰æŸ¥çœ‹JAVA_HOMEå˜é‡çš„å€¼\n\n```\necho $JAVA_HOME\n```\n\n![image-20250313143109134](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/deef51d65ab888223594404f2c673de1697559838-1743071004581-203-1746692007778-424-1747299497350-49-1747900721329-49-1749470495095-50.png)\n\n### ç†Ÿæ‚‰å¸¸ç”¨çš„Hadoopæ“ä½œ\n\nï¼ˆ1ï¼‰ä½¿ç”¨hadoopç”¨æˆ·ç™»å½•Linuxç³»ç»Ÿï¼Œå¯åŠ¨Hadoopï¼ˆHadoopçš„å®‰è£…ç›®å½•ä¸ºâ€œ/usr/local/hadoopâ€ï¼‰ï¼Œä¸ºhadoopç”¨æˆ·åœ¨HDFSä¸­åˆ›å»ºç”¨æˆ·ç›®å½•â€œ/user/hadoopâ€\n\n```\nstart-dfs.sh\nhdfs dfs -mkdir -p /user/hadoop \n```\n\n![image-20250313151220243](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/eb9da7727cc112475cfc9c45fb585741697559838-1743071004581-204-1746692007778-425-1747299497350-51-1747900721329-50-1749470495095-51.png)\n\nï¼ˆ2ï¼‰æ¥ç€åœ¨HDFSçš„ç›®å½•â€œ/user/hadoopâ€ä¸‹ï¼Œåˆ›å»ºtestæ–‡ä»¶å¤¹ï¼Œå¹¶æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨\n\n```\nhdfs dfs -mkdir test\nhdfs dfs -ls .\n```\n\n![image-20250313151235040](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/5b6ce4bdc15610c9f4039ef8f7dbfc91697559838-1743071004581-205-1746692007778-426-1747299497350-50-1747900721329-51-1749470495095-52.png)\n\nï¼ˆ3ï¼‰å°†Linuxç³»ç»Ÿæœ¬åœ°çš„â€œï½/.bashrcâ€æ–‡ä»¶ä¸Šä¼ åˆ°HDFSçš„testæ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶æŸ¥çœ‹test\n\n```\nhdfs dfs -put ~/.bashrc test\nhdfs dfs -ls test\n```\n\n![image-20250313151248871](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/e501c2993fa20ae4dfefc77cbf50a513697559838-1743071004581-206-1746692007778-427-1747299497350-53-1747900721329-52-1749470495095-54.png)\n\nï¼ˆ4ï¼‰å°†HDFSæ–‡ä»¶å¤¹testå¤åˆ¶åˆ°Linuxç³»ç»Ÿæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„â€œ/usr/local/hadoopâ€ç›®å½•ä¸‹\n\n```\nhdfs dfs -get test ./\n```\n\n![image-20250313151433060](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/33754f23d00e296f81fd3c3eae2b70f1697559838-1743071004581-207-1746692007778-428-1747299497350-52-1747900721329-53-1749470495095-53.png)\n\n## ï¼ˆ3.7.3ï¼‰å®éªŒ\n\n### å®‰è£…eclipse\n\nä¸ºäº†æé«˜ç¨‹åºç¼–å†™å’Œè°ƒè¯•æ•ˆç‡ï¼Œæœ¬æ•™ç¨‹é‡‡ç”¨Eclipseå·¥å…·ç¼–å†™Javaç¨‹åºã€‚\nç°åœ¨è¦æ‰§è¡Œçš„ä»»åŠ¡æ˜¯ï¼šå‡è®¾åœ¨ç›®å½•`hdfs://localhost:9000/user/hadoop`ä¸‹é¢æœ‰å‡ ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯file1.txtã€file2.txtã€file3.txtã€file4.abcå’Œfile5.abcï¼Œè¿™é‡Œéœ€è¦ä»è¯¥ç›®å½•ä¸­è¿‡æ»¤å‡ºæ‰€æœ‰åç¼€åä¸ä¸º`.abc`çš„æ–‡ä»¶ï¼Œå¯¹è¿‡æ»¤ä¹‹åçš„æ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œå¹¶å°†è¿™äº›æ–‡ä»¶çš„å†…å®¹åˆå¹¶åˆ°æ–‡ä»¶`hdfs://localhost:9000/user/hadoop/merge.txt`ä¸­ã€‚\n\nè¦ç¡®ä¿HDFSçš„`/user/hadoop`ç›®å½•ä¸‹å·²ç»å­˜åœ¨file1.txtã€file2.txtã€file3.txtã€file4.abcå’Œfile5.abcï¼Œæ¯ä¸ªæ–‡ä»¶é‡Œé¢æœ‰å†…å®¹ã€‚è¿™é‡Œï¼Œå‡è®¾æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nfile1.txtçš„å†…å®¹æ˜¯ï¼š this is file1.txt\nfile2.txtçš„å†…å®¹æ˜¯ï¼š this is file2.txt\nfile3.txtçš„å†…å®¹æ˜¯ï¼š this is file3.txt\nfile4.abcçš„å†…å®¹æ˜¯ï¼š this is file4.abc\nfile5.abcçš„å†…å®¹æ˜¯ï¼š this is file5.abc\n\n> åé¢æˆ‘ä¼šç»™å‘½ä»¤ï¼Œä¸Šé¢çš„å†…å®¹å°±å…ˆçœ‹çœ‹\n\n\n\nç™»å…¥`hadoopç”¨æˆ·`ä¸å¤šè¯´äº†ï¼Œå¯åŠ¨hadoopé›†ç¾¤\n\n```\nstart-all.sh\n```\n\nä¸‹è½½eclipseå®‰è£…åŒ…åˆ°ubuntuçš„ä¸‹è½½ç›®å½•,ç„¶ååœ¨ç©ºç™½å¤„å³é”®æ‰“å¼€ç»ˆç«¯\n\n![image-20250318155038350](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/60c162a765d08e3803ca119480baef99697559838-1743071004582-208-1746692007778-429-1747299497350-54-1747900721329-54-1749470495095-55.png)\n\n```\nsudo ls\n```\n\n```bash\nsudo tar -zxvf eclipse-4.7.0-linux.gtk.x86_64.tar.gz -C /usr/local \nsudo chown -R hadoop /usr/local/eclipse\necho \"export ECLIPSE_HOME=/usr/local/eclipse\" >> ~/.bashrc\necho \"export PATH=\\$ECLIPSE_HOME/:\\$PATH\" >> ~/.bashrc\nsource ~/.bashrc\n```\n\nå¯åŠ¨eclipse\n\n```\neclipse\n```\n\n### åœ¨Eclipseä¸­åˆ›å»ºé¡¹ç›®\n\nå¯åŠ¨Eclipseã€‚å½“Eclipseå¯åŠ¨ä»¥åï¼Œä¼šå¼¹å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºç•Œé¢ï¼Œæç¤ºè®¾ç½®å·¥ä½œç©ºé—´ï¼ˆworkspaceï¼‰ã€‚\n\n![image-20250318160051796](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/87b70fbcc1e51f170156e90437e1c0ec697559838-1743071004582-209-1746692007778-430-1747299497350-55-1747900721329-55-1749470495095-56.png)\n\n![image-20250318160340954](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/065dc77c668bee8eb9fa31623a0bee83697559838-1743071004582-210-1746692007778-431-1747299497350-56-1747900721329-56-1749470495096-57.png)\n\né€‰æ‹©`File-->New-->Java Project`èœå•ï¼Œå¼€å§‹åˆ›å»ºä¸€ä¸ªJavaå·¥ç¨‹ï¼Œä¼šå¼¹å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºç•Œé¢ã€‚åœ¨`Project name`åé¢è¾“å…¥å·¥ç¨‹åç§°`HDFSExample`ï¼Œé€‰ä¸­`Use default location`ï¼Œè®©è¿™ä¸ªJavaå·¥ç¨‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¿å­˜åˆ°`/home/hadoop/workspace/HDFSExample`ç›®å½•ä¸‹ã€‚åœ¨`JRE`è¿™ä¸ªé€‰é¡¹å¡ä¸­ï¼Œå¯ä»¥é€‰æ‹©å½“å‰çš„Linuxç³»ç»Ÿä¸­å·²ç»å®‰è£…å¥½çš„JDKï¼Œæ¯”å¦‚jdk1.8.0_162ã€‚ç„¶åï¼Œç‚¹å‡»ç•Œé¢åº•éƒ¨çš„`Next>`æŒ‰é’®ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥çš„è®¾ç½®ã€‚\n\n![image-20250318160434807](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/8c4984aa63dd56f996b36b84bc95eabf697559838-1743071004582-211-1746692007778-432-1747299497350-57-1747900721329-57-1749470495096-58.png)\n\n### ä¸ºé¡¹ç›®æ·»åŠ éœ€è¦ç”¨åˆ°çš„JARåŒ…\n\nä¸ºäº†èƒ½å¤Ÿè¿è¡Œç¨‹åºï¼Œæˆ‘ä»¬æœ‰`å››ä¸ªç›®å½•`çš„`jaråŒ…`è¦æ·»åŠ åˆ°å·¥ç¨‹å»\n\n> (1)`/usr/local/hadoop/share/hadoop/common`ç›®å½•ä¸‹çš„æ‰€æœ‰JARåŒ…ï¼ŒåŒ…æ‹¬\n>\n> `hadoop-common-3.1.3.jar`ã€`hadoop-kms-3.1.3.jar`\n> `hadoop-common-3.1.3-tests.jar`ã€`hadoop-nfs-3.1.3.jar`\n>\n> æ³¨æ„ï¼Œä¸åŒ…æ‹¬ç›®å½•jdiffã€libã€sourceså’Œwebappsï¼›\n>\n> ---\n>\n> (2)`/usr/local/hadoop/share/hadoop/common/lib`ç›®å½•ä¸‹çš„æ‰€æœ‰JARåŒ…ï¼›\n> (3)`/usr/local/hadoop/share/hadoop/hdfs`ç›®å½•ä¸‹çš„æ‰€æœ‰JARåŒ…ï¼Œæ³¨æ„ï¼Œä¸åŒ…æ‹¬ç›®å½•jdiffã€libã€sourceså’Œwebappsï¼›\n> (4)`/usr/local/hadoop/share/hadoop/hdfs/lib`ç›®å½•ä¸‹çš„æ‰€æœ‰JARåŒ…ã€‚\n\n---\n\n`ä»¥ä¸‹æˆ‘åªæ¼”ç¤ºç¬¬ä¸€ç§å’Œç¬¬äºŒç§!!!!!!!!!`\n\n`ä»¥ä¸‹æˆ‘åªæ¼”ç¤ºç¬¬ä¸€ç§å’Œç¬¬äºŒç§!!!!!!!!!`\n\n``ä»¥ä¸‹æˆ‘åªæ¼”ç¤ºç¬¬ä¸€ç§å’Œç¬¬äºŒç§!!!!!!!!!``\n\n`ä»¥ä¸‹æˆ‘åªæ¼”ç¤ºç¬¬ä¸€ç§å’Œç¬¬äºŒç§!!!!!!!!!`\n\n---\n\n`ç¬¬ä¸€ç§`\n\n`/usr/local/hadoop/share/hadoop/common`ç›®å½•ä¸‹çš„æ‰€æœ‰JARåŒ…\n\nç‚¹å‡»`Add External JARsâ€¦`æŒ‰é’®ï¼Œç‚¹å‡»å…¶ä»–ä½ç½®ï¼Œè‡ªå·±çœ‹è¿™ä¸ªè·¯å¾„å®šä½åˆ°è¿™`/usr/local/hadoop/share/hadoop/common`,é€‰æ‹©ä¸‹é¢çš„å››ä¸ªåŒ…ï¼Œç„¶åç‚¹å‡»ok\n\n![image-20250318161304973](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/2472a090934284d0ff7605267cb1e469697559838-1743071004582-212-1746692007778-433-1747299497350-58-1747900721329-58-1749470495096-59.png)\n\n\n\n`ç¬¬äºŒç§`\n\n`/usr/local/hadoop/share/hadoop/common/lib`ç›®å½•ä¸‹çš„æ‰€æœ‰JARåŒ…ï¼›\n\n![image-20250318170347078](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/279304c9eac49aaeaeb836fec1d1b792697559838-1743071004582-213-1746692007778-434-1747299497350-59-1747900721329-59-1749470495096-60.png)\n\n\n\n> ä»¥ä¸‹ä¸¤ä¸ªç›®å½•ï¼Œæˆ‘å°±ä¸æ¼”ç¤ºäº†ï¼Œå¦‚æœæœ‰æ–‡ä»¶å¤¹è¢«å…¨é€‰ä¸­ï¼Œä½ å°±æŒ‰ä½ctrlç„¶åç‚¹å‡»æ–‡ä»¶å¤¹ï¼Œå°±å¯ä»¥å–æ¶ˆé€‰ä¸­äº†ï¼Œæˆ‘ä»¬åªæ·»åŠ æ‰€æœ‰åç¼€åä¸º`.jar`çš„åŒ…\n>\n> (3)`/usr/local/hadoop/share/hadoop/hdfs`ç›®å½•ä¸‹çš„æ‰€æœ‰JARåŒ…ï¼Œæ³¨æ„ï¼Œä¸åŒ…æ‹¬ç›®å½•jdiffã€libã€sourceså’Œwebappsï¼›\n> (4)`/usr/local/hadoop/share/hadoop/hdfs/lib`ç›®å½•ä¸‹çš„æ‰€æœ‰JARåŒ…ã€‚\n\n\n\næœ€åæ˜¯è¿™æ ·çš„\n\n![image-20250318170435251](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6d79a5d1e0a3158a375e0dced25a97bb697559838-1743071004582-214-1746692007778-435-1747299497350-60-1747900721329-60-1749470495096-61.png)\n\n![image-20250318161735778](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/ea01a0f0daf799e542dd562b75bdbb9c697559838-1743071004582-215-1746692007778-436-1747299497350-61-1747900721329-61-1749470495096-62.png)\n\n### ç¼–å†™Javaåº”ç”¨ç¨‹åº\n\n![image-20250318162034984](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/569602ed23795682d3d79612712be1d3697559838-1743071004582-216-1746692007778-437-1747299497350-62-1747900721329-62-1749470495096-63.png)\n\nåœ¨è¯¥ç•Œé¢ä¸­ï¼Œåªéœ€è¦åœ¨`Name`åé¢è¾“å…¥æ–°å»ºçš„Javaç±»æ–‡ä»¶çš„åç§°ï¼Œè¿™é‡Œé‡‡ç”¨ç§°`MergeFile`ï¼Œå…¶ä»–éƒ½å¯ä»¥é‡‡ç”¨é»˜è®¤è®¾ç½®ï¼Œç„¶åï¼Œç‚¹å‡»ç•Œé¢å³ä¸‹è§’`Finish`æŒ‰é’®ã€‚\n\n![image-20250318162134278](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/4168e9160a7c8a3163955e0234b253f1697559838-1743071004582-217-1746692007778-438-1747299497350-63-1747900721329-63-1749470495096-64.png)\n\n![image-20250318162458949](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/0f62d55c83b9297b9ca10da5e0b8a411697559838-1743071004582-218-1746692007778-439-1747299497350-64-1747900721329-64-1749470495096-65.png)\n\n\n\næŠŠä¸‹é¢çš„ä»£ç ç›´æ¥å†™åˆ°MergeFile.java,`å…¨é€‰å¤åˆ¶ç²˜è´´`ï¼Œè¿™å°±ä¸å¤šè¯´äº†ï¼Œç„¶åè®°å¾—`Ctrl+Sä¿å­˜`\n\n```java\nimport java.io.IOException;\nimport java.io.PrintStream;\nimport java.net.URI;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.*;\n/**\n * è¿‡æ»¤æ‰æ–‡ä»¶åæ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡ä»¶ \n */\nclass MyPathFilter implements PathFilter {\n     String reg = null; \n     MyPathFilter(String reg) {\n          this.reg = reg;\n     }\n     public boolean accept(Path path) {\n        if (!(path.toString().matches(reg)))\n            return true;\n        return false;\n    }\n}\n/***\n * åˆ©ç”¨FSDataOutputStreamå’ŒFSDataInputStreamåˆå¹¶HDFSä¸­çš„æ–‡ä»¶\n */\npublic class MergeFile {\n    Path inputPath = null; //å¾…åˆå¹¶çš„æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•çš„è·¯å¾„\n    Path outputPath = null; //è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„\n    public MergeFile(String input, String output) {\n        this.inputPath = new Path(input);\n        this.outputPath = new Path(output);\n    }\n    public void doMerge() throws IOException {\n        Configuration conf = new Configuration();\n        conf.set(\"fs.defaultFS\",\"hdfs://localhost:9000\");\n          conf.set(\"fs.hdfs.impl\",\"org.apache.hadoop.hdfs.DistributedFileSystem\");\n        FileSystem fsSource = FileSystem.get(URI.create(inputPath.toString()), conf);\n        FileSystem fsDst = FileSystem.get(URI.create(outputPath.toString()), conf);\n                //ä¸‹é¢è¿‡æ»¤æ‰è¾“å…¥ç›®å½•ä¸­åç¼€ä¸º.abcçš„æ–‡ä»¶\n        FileStatus[] sourceStatus = fsSource.listStatus(inputPath,\n                new MyPathFilter(\".*\\\\.abc\")); \n        FSDataOutputStream fsdos = fsDst.create(outputPath);\n        PrintStream ps = new PrintStream(System.out);\n        //ä¸‹é¢åˆ†åˆ«è¯»å–è¿‡æ»¤ä¹‹åçš„æ¯ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶è¾“å‡ºåˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­\n        for (FileStatus sta : sourceStatus) {\n            //ä¸‹é¢æ‰“å°åç¼€ä¸ä¸º.abcçš„æ–‡ä»¶çš„è·¯å¾„ã€æ–‡ä»¶å¤§å°\n            System.out.print(\"è·¯å¾„ï¼š\" + sta.getPath() + \"    æ–‡ä»¶å¤§å°ï¼š\" + sta.getLen()\n                    + \"   æƒé™ï¼š\" + sta.getPermission() + \"   å†…å®¹ï¼š\");\n            FSDataInputStream fsdis = fsSource.open(sta.getPath());\n            byte[] data = new byte[1024];\n            int read = -1;\n            while ((read = fsdis.read(data)) > 0) {\n                ps.write(data, 0, read);\n                fsdos.write(data, 0, read);\n            }\n            fsdis.close();\n        }\n        ps.close();\n        fsdos.close();\n    }\n    public static void main(String[] args) throws IOException {\n        MergeFile merge = new MergeFile(\n                \"hdfs://localhost:9000/user/hadoop/\",\n                \"hdfs://localhost:9000/user/hadoop/merge.txt\");\n        merge.doMerge();\n    }\n}\n```\n\n### ç¼–è¯‘è¿è¡Œç¨‹åº\n\nåœ¨è¿™é‡Œ`å¼ºè°ƒä¸€ä¸‹`ï¼Œå¦‚æœä½ æ²¡å¯åŠ¨hadoopè‡ªè¡Œå¯åŠ¨ï¼Œæˆ‘æ—©å·²åœ¨7.1å‘ŠçŸ¥å¯åŠ¨äº†\n\nç¼–å†™æµ‹è¯•æ–‡ä»¶\n\n```bash\necho \"this is file1.txt\" > file1.txt\necho \"this is file2.txt\" > file2.txt\necho \"this is file3.txt\" > file3.txt\necho \"this is file4.abc\" > file4.abc\necho \"this is file5.abc\" > file5.abc\nhdfs dfs -mkdir -p /user/hadoop\nhdfs dfs -put file1.txt /user/hadoop/\nhdfs dfs -put file2.txt /user/hadoop/\nhdfs dfs -put file3.txt /user/hadoop/\nhdfs dfs -put file4.abc /user/hadoop/\nhdfs dfs -put file5.abc /user/hadoop/\nhdfs dfs -ls /user/hadoop\n```\n\n![image-20250318163431895](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/0acb5d22e3cf68f2eacbdb853adfe764697559838-1743071004582-219-1746692007778-440-1747299497350-65-1747900721329-65-1749470495096-67.png)\n\n![image-20250318163620255](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/2cb7b57a21bf6cd3bab2afc16a205a93697559838-1743071004582-220-1746692007778-441-1747299497350-66-1747900721329-66-1749470495096-66.png)\n\n![image-20250318163921782](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/1182eb47d5e3c245b7df9084abc2895e697559838-1743071004582-221-1746692007778-442-1747299497350-67-1747900721329-67-1749470495096-68.png)\n\n![image-20250318171657423](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/e3d397b4d237e9a0dfec9cd2640d508d697559838-1743071004582-222-1746692007778-443-1747299497350-68-1747900721329-68-1749470495096-69.png)\n\næœ€åéªŒè¯æ˜¯å¦æˆåŠŸ\n\n```\nhdfs dfs -cat /user/hadoop/merge.txt\n```\n\n![image-20250318171722425](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/3e1303434798e633dcc66a8275b770ab697559838-1743071004582-223-1746692007778-444-1747299497350-69-1747900721329-69-1749470495096-70.png)\n\n### åº”ç”¨ç¨‹åºçš„éƒ¨ç½²\n\nå› ä¸ºå‰é¢åªæ˜¯åœ¨eclipseè¿è¡Œjavaé¡¹ç›®æ‰ä¼šç”Ÿæˆmerge.txtï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯é€šè¿‡hadoopå»æ‰§è¡Œè¿™ä¸ªjavaé¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹å·¥ç¨‹æ‰“åŒ…\n\n#### åˆ›å»ºmyappç›®å½•\n\nç›®çš„ï¼šç”¨æ¥å­˜æ”¾hadoopåº”ç”¨ç¨‹åºç›®å½•\n\n```\nmkdir /usr/local/hadoop/myapp\n```\n\n#### å¼€å§‹æ‰“åŒ…ç¨‹åº\n\n![image-20250318172258928](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6d30b10a743fb22c9d0e7afd672e8659697559838-1743071004582-224-1746692007778-445-1747299497350-70-1747900721329-70-1749470495096-71.png)\n\n`Launch configuration`ä¸‹æ‹‰é€‰æ‹©`MergeFile-HDFSExample`\n\n`Export destination`å¡«å†™ `/usr/local/hadoop/myapp/HDFSExample.jar`\n\n![image-20250318172440560](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/129b3ca17345b0a0ecf4ab263615f4a0697559838-1743071004582-225-1746692007778-446-1747299497350-71-1747900721329-71-1749470495096-72.png)\n\n![image-20250318172512532](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/3df4894053094c4a47afb06635f77dd8697559838-1743071004582-226-1746692007779-447-1747299497350-72-1747900721329-72-1749470495096-73.png)\n\n![image-20250318172626710](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/0d99df2fda8b868a9e76ed3af1bd857b697559838-1743071004582-227-1746692007779-448-1747299497350-73-1747900721329-73-1749470495096-75.png)\n\n#### æŸ¥çœ‹æ˜¯å¦ç”Ÿæˆ\n\n```\nls /usr/local/hadoop/myapp\n```\n\n![image-20250318172709040](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/1e58d1e9952a02b14a00561e3e864bce697559838-1743071004582-228-1746692007779-449-1747299497350-74-1747900721329-74-1749470495096-74.png)\n\n#### é‡æ–°éªŒè¯é¡¹ç›®çš„è¿è¡Œ\n\nç”±äºæˆ‘ä»¬åœ¨eclipseæµ‹è¯•è¿‡äº†é¡¹ç›®ï¼Œä¹‹å‰å°±åœ¨hdfsç›®å½•ç”Ÿæˆäº†`/user/hadoop/merge.txt`ï¼Œä¸ºäº†éªŒè¯åˆšåˆšæ‰“åŒ…çš„é¡¹ç›®ï¼Œæˆ‘ä»¬è¦åˆ æ‰è¿™ä¸ª`/user/hadoop/merge.txt`ï¼Œç­‰ç­‰é‡æ–°è¿è¡Œé¡¹ç›®\n\n```bash\nhdfs dfs -rm /user/hadoop/merge.txt\nhadoop jar /usr/local/hadoop/myapp/HDFSExample.jar\nhdfs dfs -cat /user/hadoop/merge.txt\n```\n\n![image-20250318173057716](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/656a8305fac65693562adc40133628e3697559838-1743071004582-229-1746692007779-450-1747299497350-76-1747900721329-75-1749470495096-76.png)\n\n![image-20250318173128692](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/4af0f6cf14aa25ff8f53493639441fda697559838-1743071004582-230-1746692007779-451-1747299497350-75-1747900721329-76-1749470495096-77.png)\n\nå¦‚æœä½ æ²¡äº‹äº†ï¼Œè¦å…³æœºäº†å°±å›åˆ°è¿™é‡Œ[5.6 å…³æœºæ­¥éª¤](#å…³æœºæ­¥éª¤),å»æ‰§è¡Œå…³æœº\n\né¡ºä¾¿æŠŠ`eclipse`çš„çª—å£å…³æ‰\n\n> ä¸¥è‚ƒå‘ŠçŸ¥ï¼Œåˆ«è¯´æˆ‘æ²¡æé†’ä½ ï¼Œä¸è¦ç›´æ¥å…³æœºï¼Œä¹Ÿä¸è¦æŒ‚èµ·è™šæ‹Ÿæœºï¼Œå¦åˆ™ä½ çš„è™šæ‹Ÿæœºå’Œä½ çš„hadoopåäº†ï¼Œä½ å°±é‡è£…ï¼Œå¦‚æœä½ åäº†ä½ ä¹Ÿå¯ä»¥æ¢å¤å¿«ç…§åˆ°`ä¼ªåˆ†å¸ƒå®‰è£…æˆåŠŸ`ï¼Œä½†æ˜¯ä½ åªæ˜¯è¦é‡æ–°åšè¿™å‘¨çš„å®éªŒ\n>\n> ![image-20250318173348088](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/7327d43e46ac634be9f37da89e6d4241697559838-1743071004580-182-1746692007777-403-1747299497350-28-1747900721328-28-1749470495095-29.png)\n\n### ç»ƒä¹ æ–‡ä»¶\n\nå†™å…¥æ–‡ä»¶\n\n```\n        import org.apache.hadoop.conf.Configuration;  \n        import org.apache.hadoop.fs.FileSystem;\n        import org.apache.hadoop.fs.FSDataOutputStream;\n        import org.apache.hadoop.fs.Path;\n \n        public class write {    \n                public static void main(String[] args) { \n                        try {\n                                Configuration conf = new Configuration();  \n                                conf.set(\"fs.defaultFS\",\"hdfs://localhost:9000\");\n                                conf.set(\"fs.hdfs.impl\",\"org.apache.hadoop.hdfs.DistributedFileSystem\");\n                                FileSystem fs = FileSystem.get(conf);\n                                byte[] buff = \"Hello world\".getBytes(); // è¦å†™å…¥çš„å†…å®¹\n                                String filename = \"gcc-test\"; //è¦å†™å…¥çš„æ–‡ä»¶å\n                                FSDataOutputStream os = fs.create(new Path(filename));\n                                os.write(buff,0,buff.length);\n                                System.out.println(\"Create:\"+ filename);\n                                os.close();\n                                fs.close();\n                        } catch (Exception e) {  \n                                e.printStackTrace();  \n                        }  \n                }  \n        }\n```\n\n![image-20250327152823953](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/f81d8f19db69bf635b50027d05f3589a697559838-1743071004582-231-1746692007779-452-1747299497350-77-1747900721329-77-1749470495096-78.png)\n\n```\nhdfs dfs -ls /user/hadoop\nhdfs dfs -cat /user/hadoop/gcc-test\n```\n\n![image-20250327153115107](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/f70dd011c699b1830f5b92f1229327a0697559838-1746692007779-453-1747299497350-78-1747900721329-78-1749470495096-79.png)\n\nåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨\n\n```\n        import org.apache.hadoop.conf.Configuration;\n        import org.apache.hadoop.fs.FileSystem;\n        import org.apache.hadoop.fs.Path;\n \n        public class panduan {\n                public static void main(String[] args) {\n                            try {\n                                    String filename = \"gcc-test\";\n \n                                    Configuration conf = new Configuration();\n                                    conf.set(\"fs.defaultFS\",\"hdfs://localhost:9000\");\n                                    conf.set(\"fs.hdfs.impl\",\"org.apache.hadoop.hdfs.DistributedFileSystem\");\n                                    FileSystem fs = FileSystem.get(conf);\n                                    if(fs.exists(new Path(filename))){\n                                            System.out.println(\"æ–‡ä»¶å­˜åœ¨\");\n                                    }else{\n                                            System.out.println(\"æ–‡ä»¶ä¸å­˜åœ¨\");\n                                    }\n                                    fs.close();\n                        } catch (Exception e) {\n                                e.printStackTrace();\n                        }\n                }\n        } \n```\n\n![image-20250327153328234](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/8d1bc9f2d385b1e188e920816c1bb7f3697559838-1746692007779-454-1747299497350-79-1747900721329-79-1749470495096-80.png)\n\n\n\nè¯»å–æ–‡ä»¶\n\n```\n        import java.io.BufferedReader;\n        import java.io.InputStreamReader;\n \n        import org.apache.hadoop.conf.Configuration;\n        import org.apache.hadoop.fs.FileSystem;\n        import org.apache.hadoop.fs.Path;\n        import org.apache.hadoop.fs.FSDataInputStream;\n \n        public class read {\n                public static void main(String[] args) {\n                        try {\n                                Configuration conf = new Configuration();\n                                conf.set(\"fs.defaultFS\",\"hdfs://localhost:9000\");\n                                conf.set(\"fs.hdfs.impl\",\"org.apache.hadoop.hdfs.DistributedFileSystem\");\n                                FileSystem fs = FileSystem.get(conf);\n                                Path file = new Path(\"gcc-test\"); \n                                FSDataInputStream getIt = fs.open(file);\n                                BufferedReader d = new BufferedReader(new InputStreamReader(getIt));\n                                String content = d.readLine(); //è¯»å–æ–‡ä»¶ä¸€è¡Œ\n                                System.out.println(content);\n                                d.close(); //å…³é—­æ–‡ä»¶\n                                fs.close(); //å…³é—­hdfs\n                        } catch (Exception e) {\n                                e.printStackTrace();\n                        }\n                }\n        }\n```\n\n![image-20250327153426275](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/30c4144922fa2e7c0d12ecce042a9174697559838-1746692007779-455-1747299497350-80-1747900721329-80-1749470495096-81.png)\n\n## ç¬¬äºŒæ¬¡å®éªŒ\n\nç¼–ç¨‹å®ç°ä»¥ä¸‹æŒ‡å®šåŠŸèƒ½ï¼Œå¹¶åˆ©ç”¨Hadoopæä¾›çš„Shellå‘½ä»¤å®Œæˆç›¸åŒçš„ä»»åŠ¡ã€‚\n\n`â‘  å‘HDFSä¸­ä¸Šä¼ ä»»æ„æ–‡æœ¬æ–‡ä»¶ï¼Œå¦‚æœæŒ‡å®šçš„æ–‡ä»¶åœ¨HDFSä¸­å·²ç»å­˜åœ¨ï¼Œç”±ç”¨æˆ·æŒ‡å®šæ˜¯è¿½åŠ åˆ°åŸæœ‰æ–‡ä»¶æœ«å°¾è¿˜æ˜¯è¦†ç›–åŸæœ‰çš„æ–‡ä»¶ã€‚`\n\n==shell==\n\næ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:  \n\n```bash\necho \"gcc-text\" > /home/hadoop/text.txt\nhdfs dfs -put /home/hadoop/text.txt /user/hadoop/text.txt\nhdfs dfs -test -e text.txt\necho $?\n```\n\n![image-20250327163611055](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/732a232a618c74f52551daf4d3d15857697559838-1746692007779-456-1747299497350-81-1747900721329-81-1749470495096-82.png)\n\nè¿”å› `0` è¡¨ç¤ºæ–‡ä»¶å­˜åœ¨ã€‚\n\nè¿”å› `1` è¡¨ç¤ºæ–‡ä»¶ä¸å­˜åœ¨ã€‚\n\n å¦‚æœç»“æœæ˜¾ç¤ºæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ç”¨æˆ·å¯ä»¥é€‰æ‹©è¿½åŠ åˆ°åŸæ¥æ–‡ä»¶æœ«å°¾æˆ–è€…è¦†ç›–åŸæ¥æ–‡ä»¶ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š\n\n```bash\necho \"gcc-local\" > /home/hadoop/local.txt\n```\n\n**`local.txt`** æ˜¯æœ¬åœ°æ–‡ä»¶çš„è·¯å¾„ã€‚\n\n**`/text.txt`** æ˜¯ HDFS ä¸­çš„æ–‡ä»¶è·¯å¾„ã€‚\n\n```bash\n#è¿½åŠ åˆ°åŸæ–‡ä»¶æœ«å°¾\nhdfs dfs -appendToFile local.txt text.txt\nhdfs dfs -cat text.txt\n#è¦†ç›–åŸæ¥æ–‡ä»¶ï¼Œç¬¬ä¸€ç§å‘½ä»¤å½¢å¼\nhdfs dfs -copyFromLocal -f  local.txt text.txt\nhdfs dfs -cat text.txt\n#è¦†ç›–åŸæ¥æ–‡ä»¶ï¼Œç¬¬äºŒç§å‘½ä»¤å½¢å¼\nhdfs dfs -cp -f  file:///home/hadoop/local.txt text.txt\nhdfs dfs -cat text.txt\n```\n\n![image-20250327163724735](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/206dd11b8882e95f80f28b4e5b01e072697559838-1746692007779-457-1747299497350-82-1747900721329-82-1749470495096-83.png)\n\n![image-20250327163755158](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/bd4b3da872ab219749c41ad650c87c4c697559838-1746692007779-458-1747299497350-83-1747900721329-83-1749470495096-84.png)\n\n![image-20250327163824318](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/abb97e6170286bca4dc7942d1e5327b1697559838-1746692007779-459-1747299497350-84-1747900721329-84-1749470495096-85.png)\n\n å®é™…ä¸Šï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ä¸Šè¿°æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨**å¦‚ä¸‹å‘½ä»¤**æ¥å®ç°ï¼š\n\n```bash\nhdfs dfs -rm text.txt\nhdfs dfs -put text.txt \nhdfs dfs -cat text.txt\nif $(hdfs dfs -test -e text.txt);\nthen $(hdfs dfs -appendToFile local.txt text.txt);\nelse $(hdfs dfs -copyFromLocal -f local.txt text.txt);\nfi\nhdfs dfs -cat text.txt\n```\n\n![image-20250327163953466](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/967e82c7f298e509d654c5a019137183697559838-1746692007779-460-1747299497350-86-1747900721329-85-1749470495096-87.png)\n\n==Java==\n\n> `æˆ‘è¿™é‡Œåªè¯´ä¸€æ¬¡ï¼Œè‡ªå·±åˆ›å»ºå¥½HDFSApi.javaåé¢çš„æ¯ä¸ªå®éªŒï¼Œéƒ½ä¼šè¦†ç›–å‰é¢ä¸€ä¸ªå®éªŒçš„ä»£ç `\n>\n> `ä½ å°±ä¸è¦æ‰‹æ¬ ï¼Œå»åˆ›å»ºåˆ«çš„ï¼Œä½ è¦æ˜¯è‡ªå·±ä¼šä¹Ÿè¡Œ`\n>\n> `åé¢å°±ä¸ä¼šå†è¯´äº†`\n>\n> ![image-20250327173112868](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b526634908c47bc47e94463cb3eaf0fa697559838-1746692007779-461-1747299497350-85-1747900721329-86-1749470495096-86.png)\n\n\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\npublic class HDFSApi {\n    /**\n     * åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨\n     */\n    public static boolean test(Configuration  conf, String path) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        return fs.exists(new Path(path));\n    }\n    /**\n     * å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„\n     * è‹¥è·¯å¾„å·²å­˜åœ¨ï¼Œåˆ™è¿›è¡Œè¦†ç›–\n     */\n    public static void  copyFromLocalFile(Configuration conf, String localFilePath, String  remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path localPath = new  Path(localFilePath);\n        Path remotePath = new  Path(remoteFilePath);\n        /* fs.copyFromLocalFile ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆ é™¤æºæ–‡ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦è¦†ç›– */\n        fs.copyFromLocalFile(false, true,  localPath, remotePath);\n        fs.close();\n    }\n    /**\n     * è¿½åŠ æ–‡ä»¶å†…å®¹\n     */\n    public static void  appendToFile(Configuration conf, String localFilePath, String remoteFilePath)  throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        /* åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¯»å…¥æµ */\n        FileInputStream in = new  FileInputStream(localFilePath);\n        /* åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼Œè¾“å‡ºçš„å†…å®¹å°†è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ */\n        FSDataOutputStream out =  fs.append(remotePath);\n        /* è¯»å†™æ–‡ä»¶å†…å®¹ */\n        byte[] data = new byte[1024];\n        int read = -1;\n        while ( (read = in.read(data)) > 0  ) {\n            out.write(data,  0, read);\n        }\n        out.close();\n        in.close();\n        fs.close();\n    }\n    /**\n     * ä¸»å‡½æ•°\n     */\n    public static void main(String[] args)  {\n        Configuration conf = new  Configuration();\n        conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n        String localFilePath =  \"/home/hadoop/text.txt\";     // æœ¬åœ°è·¯å¾„\n        String remoteFilePath =  \"/user/hadoop/text.txt\";     // HDFSè·¯å¾„\n        String choice =  \"append\";    // è‹¥æ–‡ä»¶å­˜åœ¨åˆ™è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾\n//            String choice =  \"overwrite\";    // è‹¥æ–‡ä»¶å­˜åœ¨åˆ™è¦†ç›–\n        try {\n            /* åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ */\n            Boolean fileExists =  false;\n            if (HDFSApi.test(conf,  remoteFilePath)) {\n                fileExists = true;\n                System.out.println(remoteFilePath  + \" å·²å­˜åœ¨.\");\n            } else {\n                System.out.println(remoteFilePath  + \" ä¸å­˜åœ¨.\");\n            }\n            /* è¿›è¡Œå¤„ç† */\n            if ( !fileExists) { // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¸Šä¼ \n                HDFSApi.copyFromLocalFile(conf,  localFilePath, remoteFilePath);\n                System.out.println(localFilePath  + \" å·²ä¸Šä¼ è‡³ \" + remoteFilePath);\n            } else if (  choice.equals(\"overwrite\") ) {     // é€‰æ‹©è¦†ç›–\n                HDFSApi.copyFromLocalFile(conf,  localFilePath, remoteFilePath);\n                System.out.println(localFilePath  + \" å·²è¦†ç›– \" + remoteFilePath);\n            } else if (  choice.equals(\"append\") ) {    // é€‰æ‹©è¿½åŠ \n                HDFSApi.appendToFile(conf,  localFilePath, remoteFilePath);\n                System.out.println(localFilePath  + \" å·²è¿½åŠ è‡³ \" + remoteFilePath);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n![image-20250327160802735](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/31ec101590ca24d894bca6f0f11f6d42697559838-1746692007779-462-1747299497350-87-1747900721329-88-1749470495096-88.png)\n\néªŒè¯\n\n```\nhdfs dfs -cat text.txt\n```\n\n![image-20250327173741220](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/9574b088a46b592d385e083bc26be07e697559838-1746692007779-463-1747299497350-88-1747900721329-87-1749470495096-89.png)\n\n\n\n\n\n`â‘¡ ä»HDFSä¸­ä¸‹è½½æŒ‡å®šæ–‡ä»¶ï¼Œå¦‚æœæœ¬åœ°æ–‡ä»¶ä¸è¦ä¸‹è½½çš„æ–‡ä»¶åç§°ç›¸åŒï¼Œåˆ™è‡ªåŠ¨å¯¹ä¸‹è½½çš„æ–‡ä»¶é‡å‘½åã€‚`\n\n==shell==\n\n```bash\nls | grep text\nif $(hdfs dfs -test -e  file:///home/hadoop/text.txt);\nthen $(hdfs dfs -copyToLocal text.txt ./text2.txt); \nelse $(hdfs dfs -copyToLocal text.txt ./text.txt); \nfi\nls | grep text\n```\n\n![image-20250327161545345](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/eade1ac0f8ce42ebc36ce74160f7f708697559838-1746692007779-464-1747299497350-89-1747900721329-89-1749470495096-91.png)\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\npublic class HDFSApi {\n    /**\n     * ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°\n     * åˆ¤æ–­æœ¬åœ°è·¯å¾„æ˜¯å¦å·²å­˜åœ¨ï¼Œè‹¥å·²å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨è¿›è¡Œé‡å‘½å\n     */\n    public static void  copyToLocal(Configuration conf, String remoteFilePath, String localFilePath)  throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        File f = new File(localFilePath);\n        /* å¦‚æœæ–‡ä»¶åå­˜åœ¨ï¼Œè‡ªåŠ¨é‡å‘½å(åœ¨æ–‡ä»¶ååé¢åŠ ä¸Š _0, _1  ...) */\n        if (f.exists()) {\n               System.out.println(localFilePath  + \" å·²å­˜åœ¨.\");\n               Integer  i = 0;\n               while  (true) {\n                      f  = new File(localFilePath + \"_\" + i.toString());\n                      if  (!f.exists()) {\n                             localFilePath  = localFilePath + \"_\" + i.toString();\n                             break;\n                      }\n               }\n               System.out.println(\"å°†é‡æ–°å‘½åä¸º: \" +  localFilePath);\n        }\n        // ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°\n       Path localPath = new  Path(localFilePath);\n       fs.copyToLocalFile(remotePath,  localPath);\n       fs.close();\n    }\n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String localFilePath =  \"/home/hadoop/text.txt\";     // æœ¬åœ°è·¯å¾„\n              String remoteFilePath =  \"/user/hadoop/text.txt\";     // HDFSè·¯å¾„\n              try {\n                     HDFSApi.copyToLocal(conf,  remoteFilePath, localFilePath);\n                     System.out.println(\"ä¸‹è½½å®Œæˆ\");\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327173448075](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/d0d2c5b5dd466df087017b7f20645a78697559838-1746692007779-465-1747299497350-90-1747900721329-90-1749470495096-92.png)\n\néªŒè¯ï¼š\n\n```bash\nls | grep text\n```\n\n![image-20250327162206125](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/5fe0e7c436df931dbaac91c05446504c697559838-1746692007779-466-1747299497351-91-1747900721329-91-1749470495096-90.png)\n\n`â‘¢ å°†HDFSä¸­æŒ‡å®šæ–‡ä»¶çš„å†…å®¹è¾“å‡ºåˆ°ç»ˆç«¯ã€‚`\n\n==shell==\n\n```bash\nhdfs dfs -cat text.txt\n```\n\n![image-20250327173824043](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/73e2b739dcc8316d62aa83730edf0503697559838-1746692007779-467-1747299497351-92-1747900721329-92-1749470495096-93.png)\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\npublic class HDFSApi {\n    /**\n     * è¯»å–æ–‡ä»¶å†…å®¹\n     */\n    public static void cat(Configuration  conf, String remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        FSDataInputStream in =  fs.open(remotePath);\n        BufferedReader d = new  BufferedReader(new InputStreamReader(in));\n        String line = null;\n        while ( (line = d.readLine()) != null  ) {\n              System.out.println(line);\n        }\n       d.close();\n       in.close();\n       fs.close();\n    }\n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteFilePath =  \"/user/hadoop/text.txt\";     // HDFSè·¯å¾„ \n              try {\n                     System.out.println(\"è¯»å–æ–‡ä»¶: \" +  remoteFilePath);\n                     HDFSApi.cat(conf,  remoteFilePath);\n                     System.out.println(\"\\nè¯»å–å®Œæˆ\");\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327173919281](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/ff9dc32429797c7ca63268995b6f23d9697559838-1746692007779-468-1747299497351-93-1747900721329-93-1749470495096-94.png)\n\nâ‘£ æ˜¾ç¤ºHDFSä¸­æŒ‡å®šçš„æ–‡ä»¶è¯»å†™æƒé™ã€å¤§å°ã€åˆ›å»ºæ—¶é—´ã€è·¯å¾„ç­‰ä¿¡æ¯ã€‚\n\n==shell==\n\n```\nhdfs dfs -ls -h text.txt\n```\n\n![image-20250327174107993](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/378b994b1f5bc5db0e9634c4de77d316697559838-1746692007779-469-1747299497351-94-1747900721329-94-1749470495096-95.png)\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\nimport  java.text.SimpleDateFormat;\npublic class HDFSApi {\n    /**\n     * æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„ä¿¡æ¯\n     */\n    public static void ls(Configuration conf,  String remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        FileStatus[] fileStatuses =  fs.listStatus(remotePath);\n        for (FileStatus s : fileStatuses) {\n               System.out.println(\"è·¯å¾„: \" +  s.getPath().toString());\n               System.out.println(\"æƒé™: \" +  s.getPermission().toString());\n               System.out.println(\"å¤§å°: \" +  s.getLen());\n               /*  è¿”å›çš„æ˜¯æ—¶é—´æˆ³,è½¬åŒ–ä¸ºæ—¶é—´æ—¥æœŸæ ¼å¼ */\n               Long  timeStamp = s.getModificationTime();\n               SimpleDateFormat  format =  new  SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n               String  date = format.format(timeStamp);  \n               System.out.println(\"æ—¶é—´: \" +  date);\n        }\n        fs.close();\n    }\n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteFilePath =  \"/user/hadoop/text.txt\";     // HDFSè·¯å¾„\n              try {\n                     System.out.println(\"è¯»å–æ–‡ä»¶ä¿¡æ¯: \" +  remoteFilePath);\n                     HDFSApi.ls(conf,  remoteFilePath);\n                     System.out.println(\"\\nè¯»å–å®Œæˆ\");\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327174122828](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6e738a4c04440e31fd73f64e1e292fb4697559838-1746692007779-470-1747299497351-95-1747900721329-95-1749470495096-96.png)\n\nâ‘¤ ç»™å®šHDFSä¸­æŸä¸€ä¸ªç›®å½•ï¼Œè¾“å‡ºè¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶çš„è¯»å†™æƒé™ã€å¤§å°ã€åˆ›å»ºæ—¶é—´ã€è·¯å¾„ç­‰ä¿¡æ¯ï¼Œå¦‚æœè¯¥æ–‡ä»¶æ˜¯ç›®å½•ï¼Œåˆ™é€’å½’è¾“å‡ºè¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ç›¸å…³ä¿¡æ¯ã€‚\n\n==shell==\n\n```\nhdfs dfs -ls -R -h /user/hadoop\n```\n\n![image-20250327174252672](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/a01e0de8bc2984748005fa2d1735be70697559838-1746692007779-471-1747299497351-96-1747900721329-96-1749470495097-97.png)\n\n`åˆ«ç®¡æˆ‘è¿™é‡Œæœ‰ä»€ä¹ˆæ–‡ä»¶ï¼Œä½ èƒ½æ˜¾ç¤ºå‡ºæ¥å°±è¡Œ`\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\nimport  java.text.SimpleDateFormat;\npublic class HDFSApi {\n    /**\n     * æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ä¿¡æ¯ï¼ˆé€’å½’ï¼‰\n     */\n    public static void lsDir(Configuration  conf, String remoteDir) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path dirPath = new Path(remoteDir);\n        /* é€’å½’è·å–ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ */\n         RemoteIterator<LocatedFileStatus> remoteIterator =  fs.listFiles(dirPath, true);\n        /* è¾“å‡ºæ¯ä¸ªæ–‡ä»¶çš„ä¿¡æ¯ */\n        while (remoteIterator.hasNext()) {\n               FileStatus  s = remoteIterator.next();\n            System.out.println(\"è·¯å¾„: \" +  s.getPath().toString());\n            System.out.println(\"æƒé™: \" +  s.getPermission().toString());\n            System.out.println(\"å¤§å°: \" +  s.getLen());\n               /*  è¿”å›çš„æ˜¯æ—¶é—´æˆ³,è½¬åŒ–ä¸ºæ—¶é—´æ—¥æœŸæ ¼å¼ */\n               Long  timeStamp = s.getModificationTime();\n               SimpleDateFormat  format =  new  SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n               String  date = format.format(timeStamp);  \n               System.out.println(\"æ—¶é—´: \" +  date);\n               System.out.println();\n        }\n        fs.close();\n    }     \n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteDir =  \"/user/hadoop\";    // HDFSè·¯å¾„\n              try {\n                     System.out.println(\"(é€’å½’)è¯»å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ä¿¡æ¯: \" +  remoteDir);\n                     HDFSApi.lsDir(conf,  remoteDir);\n                     System.out.println(\"è¯»å–å®Œæˆ\");\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327174420260](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/64970cdb69adf4ff023608eca537ba91697559838-1746692007780-472-1747299497351-97-1747900721329-97-1749470495097-98.png)\n\nâ‘¥ æä¾›ä¸€ä¸ªHDFSä¸­çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œå¯¹è¯¥æ–‡ä»¶è¿›è¡Œåˆ›å»ºå’Œåˆ é™¤æ“ä½œã€‚å¦‚æœæ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºç›®å½•ã€‚\n\n==shell==\n\n```bash\nif $(hdfs dfs -test -d dir1/dir2);\nthen $(hdfs dfs -touchz  dir1/dir2/filename);\nelse $(hdfs dfs -mkdir -p dir1/dir2  && hdfs dfs -touchz dir1/dir2/filename); \nfi\nhdfs dfs -rm dir1/dir2/filename\n```\n\n![image-20250327175606597](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/f80ef99809ede779b9cb3f1af2335b64697559838-1746692007780-473-1747299497351-98-1747900721329-98-1749470495097-100.png)\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\npublic class HDFSApi {\n    /**\n     * åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨\n     */\n    public static boolean test(Configuration  conf, String path) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        return fs.exists(new Path(path));\n    }\n    /**\n     * åˆ›å»ºç›®å½•\n     */\n    public static boolean mkdir(Configuration  conf, String remoteDir) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path dirPath = new Path(remoteDir);\n        boolean result = fs.mkdirs(dirPath);\n        fs.close();\n        return result;\n    }\n    /**\n     * åˆ›å»ºæ–‡ä»¶\n     */\n    public static void touchz(Configuration  conf, String remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        FSDataOutputStream outputStream =  fs.create(remotePath);\n        outputStream.close();\n        fs.close();\n    }\n    /**\n     * åˆ é™¤æ–‡ä»¶\n     */\n    public static boolean rm(Configuration  conf, String remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        boolean result =  fs.delete(remotePath, false);\n        fs.close();\n        return result;\n    }\n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteFilePath =  \"/user/hadoop/input/text.txt\";     // HDFSè·¯å¾„\n              String remoteDir =  \"/user/hadoop/input\";    //  HDFSè·¯å¾„å¯¹åº”çš„ç›®å½•           \n              try {\n                     /* åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™åˆ é™¤ï¼Œå¦åˆ™è¿›è¡Œåˆ›å»º */\n                     if ( HDFSApi.test(conf,  remoteFilePath) ) {\n                            HDFSApi.rm(conf,  remoteFilePath); // åˆ é™¤\n                            System.out.println(\"åˆ é™¤è·¯å¾„: \" +  remoteFilePath);\n                     } else {\n                            if (  !HDFSApi.test(conf, remoteDir) ) { // è‹¥ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œåˆ›å»º\n                                   HDFSApi.mkdir(conf,  remoteDir);\n                                   System.out.println(\"åˆ›å»ºæ–‡ä»¶å¤¹: \" +  remoteDir);\n                            }\n                            HDFSApi.touchz(conf,  remoteFilePath);\n                            System.out.println(\"åˆ›å»ºè·¯å¾„: \" +  remoteFilePath);\n                     }\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327175819965](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/a9509597a505b1052be048905290387d697559838-1746692007780-474-1747299497351-99-1747900721329-99-1749470495097-99.png)\n\n\n\nâ‘¦ æä¾›ä¸€ä¸ªHDFSçš„ç›®å½•çš„è·¯å¾„ï¼Œå¯¹è¯¥ç›®å½•è¿›è¡Œåˆ›å»ºå’Œåˆ é™¤æ“ä½œã€‚åˆ›å»ºç›®å½•æ—¶ï¼Œå¦‚æœç›®å½•æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºç›¸åº”ç›®å½•ï¼›åˆ é™¤ç›®å½•æ—¶ï¼Œç”±ç”¨æˆ·æŒ‡å®šå½“è¯¥ç›®å½•ä¸ä¸ºç©ºæ—¶æ˜¯å¦è¿˜åˆ é™¤è¯¥ç›®å½•ã€‚\n\n==shell==\n\n```bash\nhdfs dfs -mkdir -p dir1/dir2\nhdfs dfs -rmdir dir1/dir2\n#ä¸Šè¿°å‘½ä»¤æ‰§è¡Œä»¥åï¼Œå¦‚æœç›®å½•éç©ºï¼Œåˆ™ä¼šæç¤ºnot emptyï¼Œåˆ é™¤æ“ä½œä¸ä¼šæ‰§è¡Œã€‚å¦‚æœè¦å¼ºåˆ¶åˆ é™¤ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\nhdfs dfs -rm -R dir1/dir2\n```\n\n![image-20250327175958011](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250327175958011-1746692007780-475-1747299497351-100-1747900721330-100-1749470495097-102.png)\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\npublic class HDFSApi {\n    /**\n     * åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨\n     */\n    public static boolean test(Configuration  conf, String path) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        return fs.exists(new Path(path));\n    }\n    /**\n     * åˆ¤æ–­ç›®å½•æ˜¯å¦ä¸ºç©º\n     * true: ç©ºï¼Œfalse: éç©º\n     */\n    public static boolean  isDirEmpty(Configuration conf, String remoteDir) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path dirPath = new Path(remoteDir);\n         RemoteIterator<LocatedFileStatus> remoteIterator =  fs.listFiles(dirPath, true);\n        return !remoteIterator.hasNext();\n    }      \n    /**\n     * åˆ›å»ºç›®å½•\n     */\n    public static boolean mkdir(Configuration  conf, String remoteDir) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path dirPath = new Path(remoteDir);\n        boolean result = fs.mkdirs(dirPath);\n        fs.close();\n        return result;\n    }\n    /**\n     * åˆ é™¤ç›®å½•\n     */\n    public static boolean rmDir(Configuration  conf, String remoteDir) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path dirPath = new Path(remoteDir);\n        /* ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦é€’å½’åˆ é™¤æ‰€æœ‰æ–‡ä»¶ */\n        boolean result = fs.delete(dirPath,  true);\n        fs.close();\n        return result;\n    }\n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteDir =  \"/user/hadoop/input\";    //  HDFSç›®å½•\n              Boolean forceDelete =  false;  // æ˜¯å¦å¼ºåˆ¶åˆ é™¤\n              try {\n                     /* åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™åˆ é™¤ */\n                     if ( !HDFSApi.test(conf,  remoteDir) ) {\n                            HDFSApi.mkdir(conf,  remoteDir); // åˆ›å»ºç›®å½•\n                            System.out.println(\"åˆ›å»ºç›®å½•: \" +  remoteDir);\n                     } else {\n                            if (  HDFSApi.isDirEmpty(conf, remoteDir) || forceDelete ) { // ç›®å½•ä¸ºç©ºæˆ–å¼ºåˆ¶åˆ é™¤\n                                   HDFSApi.rmDir(conf,  remoteDir);\n                                   System.out.println(\"åˆ é™¤ç›®å½•: \" +  remoteDir);\n                            } else  { // ç›®å½•ä¸ä¸ºç©º\n                                   System.out.println(\"ç›®å½•ä¸ä¸ºç©ºï¼Œä¸åˆ é™¤: \" +  remoteDir);\n                            }\n                     }\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327180216959](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/aa3dca52f3b01284a8ad8ba28db79349697559838-1746692007780-476-1747299497351-101-1747900721330-101-1749470495097-101.png)\n\nâ‘§ å‘HDFSä¸­æŒ‡å®šçš„æ–‡ä»¶è¿½åŠ å†…å®¹ï¼Œç”±ç”¨æˆ·æŒ‡å®šå°†å†…å®¹è¿½åŠ åˆ°åŸæœ‰æ–‡ä»¶çš„å¼€å¤´æˆ–ç»“å°¾ã€‚\n\n==shell==\n\n```\nrm -rf text.txt\nhdfs dfs -appendToFile local.txt text.txt\nhdfs dfs -get text.txt\ncat text.txt >> local.txt\nhdfs dfs -copyFromLocal -f text.txt text.txt\nhdfs dfs -cat text.txt\n```\n\n![image-20250327180622881](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/7cdd5e339904c6b2048dec92da1dfc73697559838-1746692007780-477-1747299497351-102-1747900721330-102-1749470495097-103.png)\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\npublic class HDFSApi {\n    /**\n     * åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨\n     */\n    public static boolean test(Configuration  conf, String path) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        return fs.exists(new Path(path));\n    }\n    /**\n     * è¿½åŠ æ–‡æœ¬å†…å®¹\n     */\n    public static void  appendContentToFile(Configuration conf, String content, String  remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        /* åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼Œè¾“å‡ºçš„å†…å®¹å°†è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ */\n        FSDataOutputStream out =  fs.append(remotePath);\n        out.write(content.getBytes());\n        out.close();\n        fs.close();\n}\n    /**\n     * è¿½åŠ æ–‡ä»¶å†…å®¹\n     */\n    public static void  appendToFile(Configuration conf, String localFilePath, String remoteFilePath)  throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        /* åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¯»å…¥æµ */\n        FileInputStream in = new  FileInputStream(localFilePath);\n        /* åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼Œè¾“å‡ºçš„å†…å®¹å°†è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ */\n        FSDataOutputStream out =  fs.append(remotePath);\n        /* è¯»å†™æ–‡ä»¶å†…å®¹ */\n        byte[] data = new byte[1024];\n        int read = -1;\n        while ( (read = in.read(data)) > 0  ) {\n               out.write(data,  0, read);\n        }\n        out.close();\n        in.close();\n        fs.close();\n    }\n    /**\n     * ç§»åŠ¨æ–‡ä»¶åˆ°æœ¬åœ°\n     * ç§»åŠ¨åï¼Œåˆ é™¤æºæ–‡ä»¶\n     */\n    public static void  moveToLocalFile(Configuration conf, String remoteFilePath, String  localFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        Path localPath = new  Path(localFilePath);\n        fs.moveToLocalFile(remotePath,  localPath);\n    }\n    /**\n     * åˆ›å»ºæ–‡ä»¶\n     */\n    public static void touchz(Configuration  conf, String remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        FSDataOutputStream outputStream =  fs.create(remotePath);\n        outputStream.close();\n        fs.close();\n    }\n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteFilePath =  \"/user/hadoop/text.txt\";     // HDFSæ–‡ä»¶\n              String content = \"æ–°è¿½åŠ çš„å†…å®¹\\n\";\n              String choice =  \"after\";         //è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾\n//            String choice =  \"before\";    // è¿½åŠ åˆ°æ–‡ä»¶å¼€å¤´\n              try {\n                     /* åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ */\n                     if ( !HDFSApi.test(conf,  remoteFilePath) ) {\n                            System.out.println(\"æ–‡ä»¶ä¸å­˜åœ¨: \" +  remoteFilePath);\n                     } else {\n                            if (  choice.equals(\"after\") ) { // è¿½åŠ åœ¨æ–‡ä»¶æœ«å°¾\n                                   HDFSApi.appendContentToFile(conf,  content, remoteFilePath);\n                                   System.out.println(\"å·²è¿½åŠ å†…å®¹åˆ°æ–‡ä»¶æœ«å°¾\" +  remoteFilePath);\n                            } else if (  choice.equals(\"before\") )  {  // è¿½åŠ åˆ°æ–‡ä»¶å¼€å¤´\n                                   /* æ²¡æœ‰ç›¸åº”çš„apiå¯ä»¥ç›´æ¥æ“ä½œï¼Œå› æ­¤å…ˆæŠŠæ–‡ä»¶ç§»åŠ¨åˆ°æœ¬åœ°*/\n/*åˆ›å»ºä¸€ä¸ªæ–°çš„HDFSï¼Œå†æŒ‰é¡ºåºè¿½åŠ å†…å®¹ */\n                                   String  localTmpPath = \"/user/hadoop/tmp.txt\";\n                                   // ç§»åŠ¨åˆ°æœ¬åœ°\nHDFSApi.moveToLocalFile(conf, remoteFilePath,  localTmpPath);\n   // åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶\n                          HDFSApi.touchz(conf,  remoteFilePath); \n                    // å…ˆå†™å…¥æ–°å†…å®¹\n                          HDFSApi.appendContentToFile(conf,  content, remoteFilePath);\n                    // å†å†™å…¥åŸæ¥å†…å®¹\n                           HDFSApi.appendToFile(conf,  localTmpPath, remoteFilePath); \n                           System.out.println(\"å·²è¿½åŠ å†…å®¹åˆ°æ–‡ä»¶å¼€å¤´: \" +  remoteFilePath);\n                            }\n                     }\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327180721307](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/710a090fa1c394fe6e2808329cda4dc2697559838-1746692007780-478-1747299497351-103-1747900721330-103-1749470495097-105.png)\n\n```\nhdfs dfs -cat text.txt\n```\n\n![image-20250327180742432](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/9f8d75e4b88732f54a55451338533fe6697559838-1746692007780-479-1747299497351-104-1747900721330-104-1749470495097-104.png)\n\n\n\nâ‘¨ åˆ é™¤HDFSä¸­æŒ‡å®šçš„æ–‡ä»¶ã€‚\n\n==shell==\n\n```\nrm text.txt\nhdfs dfs -get text.txt\nhdfs dfs -rm text.txt\n```\n\n![image-20250327180918344](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/0a49740aa72800dd9f780cd6e02db10d697559838-1746692007780-480-1747299497351-105-1747900721330-105-1749470495097-106.png)\n\n```\nhdfs dfs -put text.txt\n```\n\n\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.*;\nimport java.io.*;\npublic class HDFSApi {\n    /**\n     * åˆ é™¤æ–‡ä»¶\n     */\n    public static boolean rm(Configuration  conf, String remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        boolean result =  fs.delete(remotePath, false);\n        fs.close();\n        return result;\n    }\n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteFilePath =  \"/user/hadoop/text.txt\";     // HDFSæ–‡ä»¶         \n              try {\n                     if ( HDFSApi.rm(conf,  remoteFilePath) ) {\n                            System.out.println(\"æ–‡ä»¶åˆ é™¤: \" +  remoteFilePath);\n                     } else {\n                            System.out.println(\"æ“ä½œå¤±è´¥ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨æˆ–åˆ é™¤å¤±è´¥ï¼‰\");\n                     }\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327181030978](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/08a6b2fb485de0b4a274d3ec647ad025697559838-1746692007780-481-1747299497351-106-1747900721330-106-1749470495097-107.png)\n\nâ‘© åœ¨HDFSä¸­å°†æ–‡ä»¶ä»æºè·¯å¾„ç§»åŠ¨åˆ°ç›®çš„è·¯å¾„ã€‚\n\n==shell==\n\n```\nhdfs dfs -put text.txt\nhdfs dfs -mv text.txt text2.txt\nhdfs dfs -ls\n```\n\n![image-20250327181119936](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/78098652ed313c1aaf03bc4ad865abb0697559838-1746692007780-482-1747299497351-107-1747900721330-107-1749470495097-108.png)\n\n```\nhdfs dfs -put text.txt\n```\n\n\n\n==Java==\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.*;\nimport java.io.*;\npublic class HDFSApi {\n    /**\n     * ç§»åŠ¨æ–‡ä»¶\n     */\n    public static boolean mv(Configuration  conf, String remoteFilePath, String remoteToFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path srcPath = new  Path(remoteFilePath);\n        Path dstPath = new  Path(remoteToFilePath);\n        boolean result = fs.rename(srcPath,  dstPath);\n        fs.close();\n        return result;\n    }\n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args) {\n              Configuration conf = new Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteFilePath =  \"hdfs:///user/hadoop/text.txt\";     // æºæ–‡ä»¶HDFSè·¯å¾„\n              String remoteToFilePath =  \"hdfs:///user/hadoop/new.txt\";     // ç›®çš„HDFSè·¯å¾„\n              try {\n                     if ( HDFSApi.mv(conf, remoteFilePath,  remoteToFilePath) ) {\n                            System.out.println(\"å°†æ–‡ä»¶ \" +  remoteFilePath + \" ç§»åŠ¨åˆ° \" + remoteToFilePath);\n                     } else {\n                                   System.out.println(\"æ“ä½œå¤±è´¥(æºæ–‡ä»¶ä¸å­˜åœ¨æˆ–ç§»åŠ¨å¤±è´¥)\");\n                     }\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327181230298](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/3ef11dae7bf3e355fb37a037de122b87697559838-1746692007780-483-1747299497351-108-1747900721330-108-1749470495097-109.png)\n\n```\nhdfs dfs -ls | grep new\n```\n\n![image-20250327181334769](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/e943e8ea612d9c03d72de2eb33a9270f697559838-1746692007780-484-1747299497351-109-1747900721330-109-1749470495097-110.png)\n\n\n\nï¼ˆ2ï¼‰ç¼–ç¨‹å®ç°ä¸€ä¸ªç±»â€œMyFSDataInputStreamâ€ï¼Œè¯¥ç±»ç»§æ‰¿â€œorg.apache.hadoop.fs.FSDataInput Streamâ€ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š å®ç°æŒ‰è¡Œè¯»å–HDFSä¸­æŒ‡å®šæ–‡ä»¶çš„æ–¹æ³•â€œreadLine()â€ï¼Œå¦‚æœè¯»åˆ°æ–‡ä»¶æœ«å°¾ï¼Œåˆ™è¿”å›ç©ºï¼Œå¦åˆ™è¿”å›æ–‡ä»¶ä¸€è¡Œçš„æ–‡æœ¬ã€‚\n\n==shell==\n\n```\nhdfs dfs -put text.txt\n```\n\n==Java==\n\n> `è‡ªå·±åˆ›å»ºå¥½MyFSDataInputStream.java`\n\n```java\nimport  org.apache.hadoop.conf.Configuration;\nimport  org.apache.hadoop.fs.FSDataInputStream;\nimport  org.apache.hadoop.fs.FileSystem;\nimport  org.apache.hadoop.fs.Path;\nimport  java.io.*;\npublic  class MyFSDataInputStream extends FSDataInputStream {\n       public MyFSDataInputStream(InputStream  in) {\n              super(in);\n       }\n       /**\n     * å®ç°æŒ‰è¡Œè¯»å–\n     * æ¯æ¬¡è¯»å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œé‡åˆ°\"\\n\"ç»“æŸï¼Œè¿”å›ä¸€è¡Œå†…å®¹\n     */\n       public static String  readline(BufferedReader br) throws IOException {\n              char[] data = new char[1024];\n              int read = -1;\n              int off = 0; \n// å¾ªç¯æ‰§è¡Œæ—¶ï¼Œbr æ¯æ¬¡ä¼šä»ä¸Šä¸€æ¬¡è¯»å–ç»“æŸçš„ä½ç½®ç»§ç»­è¯»å–\n//å› æ­¤è¯¥å‡½æ•°é‡Œï¼Œoff æ¯æ¬¡éƒ½ä»0å¼€å§‹\n              while ( (read = br.read(data,  off, 1)) != -1 ) {\n                     if  (String.valueOf(data[off].equals(\"\\n\") ) {\n                            off += 1;\n                            break;\n                     }\n                     off += 1;\n              }          \n              if (off > 0) {\n                     return  String.valueOf(data);\n              } else {\n                     return null;\n              }\n       }\n       /**\n     * è¯»å–æ–‡ä»¶å†…å®¹\n     */\n    public static void cat(Configuration  conf, String remoteFilePath) throws IOException {\n        FileSystem fs = FileSystem.get(conf);\n        Path remotePath = new  Path(remoteFilePath);\n        FSDataInputStream in =  fs.open(remotePath);\n        BufferedReader br = new  BufferedReader(new InputStreamReader(in));\n        String line = null;\n        while ( (line =  MyFSDataInputStream.readline(br)) != null ) {\n               System.out.println(line);\n        }\n        br.close();\n        in.close();\n        fs.close();\n    }   \n       /**\n        * ä¸»å‡½æ•°\n        */\n       public static void main(String[] args)  {\n              Configuration conf = new  Configuration();\n    conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n              String remoteFilePath =  \"/user/hadoop/text.txt\";     // HDFSè·¯å¾„\n              try {\n                     MyFSDataInputStream.cat(conf,  remoteFilePath);\n              } catch (Exception e) {\n                     e.printStackTrace();\n              }\n       }\n}\n\n```\n\n![image-20250327181734199](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/4d9c8b1a54195c6a3ce4f8a9d1162065697559838-1746692007780-485-1747299497351-110-1747900721330-110-1749470495097-111.png)\n\nï¼ˆ3ï¼‰æŸ¥çœ‹Javaå¸®åŠ©æ‰‹å†Œæˆ–å…¶ä»–èµ„æ–™ï¼Œç”¨â€œjava.net.URLâ€å’Œâ€œorg.apache.hadoop.fs.FsURLStream HandlerFactoryâ€ç¼–ç¨‹æ¥è¾“å‡ºHDFSä¸­æŒ‡å®šæ–‡ä»¶çš„æ–‡æœ¬åˆ°ç»ˆç«¯ä¸­ã€‚\n\n==Java==\n\nç”¨å›`HDFSApi`\n\n```java\nimport org.apache.hadoop.fs.*;\nimport org.apache.hadoop.io.IOUtils;\nimport java.io.*;\nimport java.net.URL;\n\npublic class HDFSApi {\n    static {\n        URL.setURLStreamHandlerFactory(new FsUrlStreamHandlerFactory());\n    }\n\n    /**\n     * ä¸»å‡½æ•°\n     */\n    public static void main(String[] args) throws Exception {\n        // HDFSæ–‡ä»¶è·¯å¾„ï¼Œéœ€åŒ…å«ä¸»æœºåå’Œç«¯å£å·\n        String remoteFilePath = \"hdfs://localhost:9000/user/hadoop/text.txt\"; // ä¿®æ”¹ä¸ºæ­£ç¡®çš„HDFS URI\n        InputStream in = null;\n\n        try {\n            /* é€šè¿‡URLå¯¹è±¡æ‰“å¼€æ•°æ®æµï¼Œä»ä¸­è¯»å–æ•°æ® */\n            in = new URL(remoteFilePath).openStream();\n            IOUtils.copyBytes(in, System.out, 4096, false); // å°†æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°\n        } finally {\n            IOUtils.closeStream(in); // å…³é—­è¾“å…¥æµ\n        }\n    }\n}\n```\n\n![image-20250327182240291](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/224356211e87ed627058fbdf9d557f92697559838-1746692007780-486-1747299497351-111-1747900721330-111-1749470495097-113.png)\n\n## Hbaseå®‰è£…(4.6.1)\n\nè¿™é‡Œæœ‰ä¸¤ä¸ªé¢˜ï¼Œå°±æ˜¯è¦äº¤ä¸¤ä¸ªæˆªå›¾ï¼Œæˆ‘ä¼šæ³¨æ˜\n\n`è¿›hadoopç”¨æˆ·`\n\n![image-20250408162058097](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/21494f461a2bcfa10ef3533188e26bff55933597-1746692007780-487-1747299497351-112-1747900721330-112-1749470495097-112.png)\n\n`è‡ªè¡Œå¯åŠ¨hadoop`\n\n### å®‰è£…hbase\n\n```\nsudo ls\n```\n\n![image-20250408162139854](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/76c9277a9bea6c8f5f60a0bce8b5de3a55933597-1746692007780-488-1747299497351-113-1747900721330-113-1749470495097-114.png)\n\n```bash\nsudo tar -xf hbase-2.5.4-bin.tar.gz -C /usr/local/\nsudo mv /usr/local/hbase-2.5.4 /usr/local/hbase\nsudo chown -R hadoop:hadoop /usr/local/hbase\necho \"export HBASE_HOME=/usr/local/hbase\" >> ~/.bashrc\necho \"export PATH=\\$PATH:\\$HBASE_HOME/bin\" >> ~/.bashrc\nsource ~/.bashrc\nsudo sed -i \"s/CLASSPATH=\\${CLASSPATH}:\\$JAVA_HOME\\/lib\\/tools.jar/CLASSPATH=\\${CLASSPATH}:\\$JAVA_HOME\\/lib\\/tools.jar:\\/usr\\/local\\/hbase\\/lib\\/*/g\" /usr/local/hbase/bin/hbase\n\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162\" >> $HBASE_HOME/conf/hbase-env.sh\necho \"export HBASE_CLASSPATH=/usr/local/hbase/conf\" >> $HBASE_HOME/conf/hbase-env.sh\necho \"export HBASE_MANAGES_ZK=true\" >> $HBASE_HOME/conf/hbase-env.sh\necho \"export HBASE_DISABLE_HADOOP_CLASSPATH_LOOKUP=true\" >> $HBASE_HOME/conf/hbase-env.sh\n\ncat >$HBASE_HOME/conf/hbase-site.xml<<\"EOF\"\n<configuration>\n        <property>\n                <name>hbase.rootdir</name>\n                <value>hdfs://localhost:9000/hbase</value>\n        </property>\n        <property>\n                <name>hbase.cluster.distributed</name>\n                <value>true</value>\n        </property>\n        <property>\n                <name>hbase.unsafe.stream.capability.enforce</name>\n                <value>false</value>\n        </property>\n</configuration>\nEOF\nhbase version\n```\n\n> `è¿™ä¸ªæˆªå›¾äº¤åˆ°4.6.1å¼€å¤´ç¬¬ä¸€ä¸ªä½œä¸š`\n\n![image-20250408162305665](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/91151a2feff536bb833551d46297998855933597-1746692007780-489-1747299497351-114-1747900721330-114-1749470495097-115.png)\n\n### å¯åŠ¨hbase\n\n`å¼€æœºé¡ºåºï¼šä¸€å®šæ˜¯å…ˆå¯åŠ¨hadoopï¼ˆå¤§ï¼‰åœ¨å¯åŠ¨hbaseï¼ˆå°ï¼‰`\n\n`å¼€æœºé¡ºåºï¼šä¸€å®šæ˜¯å…ˆå¯åŠ¨hadoopï¼ˆå¤§ï¼‰åœ¨å¯åŠ¨hbaseï¼ˆå°ï¼‰`\n\n`å¼€æœºé¡ºåºï¼šä¸€å®šæ˜¯å…ˆå¯åŠ¨hadoopï¼ˆå¤§ï¼‰åœ¨å¯åŠ¨hbaseï¼ˆå°ï¼‰`\n\n```\nstart-all.sh\nstart-hbase.sh\n```\n\nç„¶åè¾“å…¥jps,æœ‰ä»¥ä¸‹ä¸‰ä¸ªä¸ªå°±å®‰è£…æˆåŠŸ\n\n> `è¿™æ˜¯4.6.1é‡Œæœ€ä¸‹é¢çš„ç¬¬äºŒä¸ªä½œä¸šæˆªå›¾`\n\n![image-20250408162520533](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/eac0cd31a5b01c64eef55ab24e277f8555933597-1746692007780-490-1747299497351-115-1747900721330-115-1749470495097-116.png)\n\næµ‹è¯•hbase\n\n```\nhbase shell\nlist\n```\n\n![image-20250408162546768](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/c8239e3d81e133e56e4209d0e451523755933597-1746692007780-491-1747299497351-116-1747900721330-116-1749470495097-117.png)\n\nèƒ½è¿è¡Œæ²¡æŠ¥é”™å°±è¡Œ\n\né€€å‡ºhbaseæ•°æ®åº“ç”¨`exit`\n\n![image-20250401165245612](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/66ed6e4c766ea1fc194a4657f260987d55933597-1746692007780-492-1747299497351-117-1747900721330-117-1749470495097-118.png)\n\nè®¿é—®hbaseç½‘é¡µ\n\nhttp://ip:16010/\n\n![image-20250408162639789](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/fba67e9070ac30030461dd890b011fa955933597-1746692007780-493-1747299497351-118-1747900721330-118-1749470495097-119.png)\n\n### å…³é—­hbase\n\n`å…³æœºé¡ºåºï¼šå…ˆå…³habse(å°)å†å…³hadoopï¼ˆå¤§ï¼‰`\n\n`å…³æœºé¡ºåºï¼šå…ˆå…³habse(å°)å†å…³hadoopï¼ˆå¤§ï¼‰`\n\n`å…³æœºé¡ºåºï¼šå…ˆå…³habse(å°)å†å…³hadoopï¼ˆå¤§ï¼‰`\n\n`å…³æœºé¡ºåºï¼šå…ˆå…³habse(å°)å†å…³hadoopï¼ˆå¤§ï¼‰`\n\nä¸æŒ‰æ“ä½œæ¥ï¼Œæœºå™¨åäº†ï¼Œè‡ªå·±é‡è£…å§\n\n```\nstop-hbase.sh\nstop-all.sh\nsudo poweroff\n```\n\n`å…³æœºåè‡ªå·±æ‰“ä¸ªhabseçš„å¿«ç…§`\n\n## ï¼ˆ4.6.2ï¼‰å®éªŒ\n\n### å¯åŠ¨eclipse\n\n```\neclipse\n```\n\n![image-20250408164622803](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/1923b4c74871006064488c96e58ca45855933597-1746692007780-494-1747299497351-120-1747900721330-119-1749470495097-120.png)\n\n![image-20250408164638364](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/9a4ecb36e968a02b73e7623a8fda4f8a55933597-1746692007780-495-1747299497351-119-1747900721330-120-1749470495097-121.png)\n\n### æ–°å»ºé¡¹ç›®\n\nåä¸º`HBaseExample`\n\n![image-20250408164919609](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/636129eb6dee23242d4e2d6c8081873f55933597-1746692007781-496-1747299497351-121-1747900721330-121-1749470495097-122.png)\n\n![image-20250408164950280](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6e3bb9833a72d6546944cbae664a474455933597-1746692007781-497-1747299497351-122-1747900721330-122-1749470495097-123.png)\n\n`ç°åœ¨æœ‰å‡ ä¸ªç›®å½•è¦æ·»åŠ æ³¨æ„äº†ï¼ï¼ï¼`\n\n`ç°åœ¨æœ‰å‡ ä¸ªç›®å½•è¦æ·»åŠ æ³¨æ„äº†ï¼ï¼ï¼`\n\n`ç°åœ¨æœ‰å‡ ä¸ªç›®å½•è¦æ·»åŠ æ³¨æ„äº†ï¼ï¼ï¼`\n\n`ç°åœ¨æœ‰å‡ ä¸ªç›®å½•è¦æ·»åŠ æ³¨æ„äº†ï¼ï¼ï¼`\n\n> `/usr/local/hbase/lib`ä¸‹æ‰€æœ‰çš„jaråŒ…\n>\n> `/usr/local/hbase/lib/client-facing-thirdparty`ä¸‹æ‰€æœ‰çš„jaråŒ…\n\n![image-20250408165300706](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/2b2dbcc5dcd4b9bead17749b9df213fa55933597-1746692007781-498-1747299497351-123-1747900721330-123-1749470495097-124.png)\n\n![image-20250408165316864](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/a3fc6310f34a3ef1daa99b09452f0a7455933597-1746692007781-499-1747299497351-124-1747900721330-124-1749470495097-125.png)\n\n![image-20250408165342189](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/4c79bcd883e1303d5997906eef903d0155933597-1746692007781-500-1747299497351-125-1747900721330-125-1749470495097-126.png)\n\næœ€åç›´æ¥ç‚¹å‡»finishå®Œæˆåˆ›å»º\n\n\n\n### æ–°å»ºclass\n\n![image-20250408165715828](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/f6137b4051dab5c88e26d29ce588847e55933597-1746692007781-501-1747299497351-126-1747900721330-126-1749470495097-127.png)\n\nç„¶ååœ¨ä½ åˆ›å»ºçš„è¿™ä¸ªjavaæ–‡ä»¶è¾“å…¥ï¼Œåˆ«è¿è¡Œ\n\n```java\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.*;\nimport org.apache.hadoop.hbase.client.*;\nimport org.apache.hadoop.hbase.util.Bytes;\n \nimport java.io.IOException;\npublic class ExampleForHBase {\n    public static Configuration configuration;\n    public static Connection connection;\n    public static Admin admin;\n    public static void main(String[] args)throws IOException{\n        init();\n        createTable(\"student\",new String[]{\"score\"});\n        insertData(\"student\",\"zhangsan\",\"score\",\"English\",\"69\");\n        insertData(\"student\",\"zhangsan\",\"score\",\"Math\",\"86\");\n        insertData(\"student\",\"zhangsan\",\"score\",\"Computer\",\"77\");\n        getData(\"student\", \"zhangsan\", \"score\",\"English\");\n        close();\n    }\n \n    public static void init(){\n        configuration  = HBaseConfiguration.create();\n        configuration.set(\"hbase.rootdir\",\"hdfs://localhost:9000/hbase\");\n        try{\n            connection = ConnectionFactory.createConnection(configuration);\n            admin = connection.getAdmin();\n        }catch (IOException e){\n            e.printStackTrace();\n        }\n    }\n \n    public static void close(){\n        try{\n            if(admin != null){\n                admin.close();\n            }\n            if(null != connection){\n                connection.close();\n            }\n        }catch (IOException e){\n            e.printStackTrace();\n        }\n    }\n \n    public static void createTable(String myTableName,String[] colFamily) throws IOException {\n        TableName tableName = TableName.valueOf(myTableName);\n        if(admin.tableExists(tableName)){\n            System.out.println(\"talbe is exists!\");\n        }else {\n            TableDescriptorBuilder tableDescriptor = TableDescriptorBuilder.newBuilder(tableName);\n            for(String str:colFamily){\n                ColumnFamilyDescriptor family = \nColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(str)).build();\n                tableDescriptor.setColumnFamily(family);\n            }\n            admin.createTable(tableDescriptor.build());\n        } \n    }\n \n    public static void insertData(String tableName,String rowKey,String colFamily,String col,String val) throws IOException { \n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Put put = new Put(rowKey.getBytes());\n        put.addColumn(colFamily.getBytes(),col.getBytes(), val.getBytes());\n        table.put(put);\n        table.close(); \n    }\n \n    public static void getData(String tableName,String rowKey,String colFamily, String col)throws  IOException{ \n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Get get = new Get(rowKey.getBytes());\n        get.addColumn(colFamily.getBytes(),col.getBytes());\n        Result result = table.get(get);\n        System.out.println(new String(result.getValue(colFamily.getBytes(),col==null?null:col.getBytes())));\n        table.close(); \n    }\n}\n```\n\nè‡ªè¡Œå¯åŠ¨hadoopå’Œhbaseï¼Œä¸è®°å¾—äº†å›å»ç¿»è®°å½•ï¼Œæˆ‘æœ‰å†™å¯åŠ¨é¡ºåºï¼Œåˆ«æé”™äº†ï¼Œ`æé”™äº†å°±æ¢å¤å¿«ç…§å§`ï¼Œä¸‹é¢æ˜¯å…³é—­å’Œå¯åŠ¨çš„é¡ºåº\n\n[9.2 å¯åŠ¨hbase](#å¯åŠ¨hbase)\n\n[9.3 å…³é—­hbase](#å…³é—­hbase)\n\n`æ²¡å¯åŠ¨å°±ä¸è¦åšä¸‹é¢çš„å†…å®¹ï¼ï¼ï¼`\n\n`æ²¡å¯åŠ¨å°±ä¸è¦åšä¸‹é¢çš„å†…å®¹ï¼ï¼ï¼`\n\n`æ²¡å¯åŠ¨å°±ä¸è¦åšä¸‹é¢çš„å†…å®¹ï¼ï¼ï¼`\n\n`æ²¡å¯åŠ¨å°±ä¸è¦åšä¸‹é¢çš„å†…å®¹ï¼ï¼ï¼`\n\nè¿è¡Œä»£ç \n\n![image-20250408170354469](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/617bb420d0196e81f2eb7cd73664bc9455933597-1746692007781-502-1747299497351-127-1747900721330-127-1749470495097-128.png)\n\nå°±ä¼šå‡ºç°è¿™æ ·çš„ç»“æœ\n\n> `4.6.2å®éªŒè¦äº¤çš„æˆªå›¾1`\n\n![image-20250408170422533](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/8fb2b2bdc0962691f05c04c233375a1c55933597-1746692007781-503-1747299497351-128-1747900721330-128-1749470495097-129.png)\n\nè¿™æ—¶å€™è¿›å…¥hbaseæ•°æ®åº“æŸ¥çœ‹æœ‰æ²¡æœ‰studentè¡¨\n\n```\nhbase shell\n```\n\n`è¿™æ˜¯è¿›å…¥hbaseæ•°æ®åº“çš„å‘½ä»¤ï¼Œæˆ‘å‰é¢ä¹Ÿæœ‰å†™åé¢ä¸ä¼šå†è¯´äº†ï¼Œè®°ä¸ä½å°±è‡ªå·±æ‰¾åŠæ³•`\n\n```\nlist\nscan 'student'\n```\n\n> `4.6.2å®éªŒè¦äº¤çš„æˆªå›¾2`\n\n![image-20250408170549890](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/ffffe943d8c41a3fe1565a88efe89ae755933597-1746692007781-504-1747299497351-130-1747900721330-129-1749470495097-131.png)\n\n## (4.8å®éªŒ3)\n\n`å¦‚æœè¿™é‡Œä½ è¾“å…¥ç¬¬ä¸€æ¡å’Œç¬¬äºŒæ¡å‘½ä»¤å°±æŠ¥é”™ï¼Œè‡ªå·±æ‰¾æ‰¾åŸå› ï¼Œæˆ‘ä¸æƒ³è¯´äº†`\n\n---\n\n### ç¬¬ä¸€é¢˜\n\n`ï¼ˆ1ï¼‰ç¼–ç¨‹å®ç°ä»¥ä¸‹æŒ‡å®šåŠŸèƒ½ï¼Œå¹¶ç”¨Hadoopæä¾›çš„HBaseShellå‘½ä»¤å®Œæˆç›¸åŒçš„ä»»åŠ¡ã€‚`\n\n  â‘ åˆ—å‡ºHBaseæ‰€æœ‰è¡¨çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¡¨åã€åˆ›å»ºæ—¶é—´ç­‰ã€‚\n\n==shell==\n\n```\nhbase shell\nlist\n```\n\n![image-20250408172837610](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/d7c69d7997f40d717b95e140a09c8cd855933597-1746692007781-505-1747299497351-129-1747900721330-130-1749470495097-130.png)\n\n==java==\n\nè‡ªå·±åˆ›å»ºä¸€ä¸ª`test.java`,è¦åœ¨`HBaseExample`çš„é¡¹ç›®ä¸‹,åé¢ä¸€ç›´éƒ½ä¼šç”¨è¿™ä¸ªjava\n\n```java\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.*;\nimport org.apache.hadoop.hbase.client.*;\nimport org.apache.hadoop.hbase.util.Bytes;\nimport java.util.List;\nimport java.io.IOException;\npublic class test {\n    public static Configuration configuration;\n    public static Connection connection;\n    public static Admin admin;\n    public static void main(String[] args)throws IOException{\n        init();\n        List<TableDescriptor>  tableDescriptors = admin.listTableDescriptors();\n        for(TableDescriptor tableDescriptor :  tableDescriptors){ \n        TableName tableName =  tableDescriptor.getTableName(); \n        System.out.println(\"Table:\" + tableName);\n        }\n        close();\n    }\n\n    public static void init() {\n        configuration = HBaseConfiguration.create();\n        configuration.set(\"hbase.rootdir\", \"hbase://localhost:9000/hbase\");\n        try {\n            connection = ConnectionFactory.createConnection(configuration);\n            if (connection == null) {\n                System.err.println(\"Failed to create HBase connection.\");\n            } else {\n                System.out.println(\"HBase connection created successfully.\");\n            }\n            admin = connection.getAdmin();\n            if (admin == null) {\n                System.err.println(\"Failed to get HBase Admin.\");\n            } else {\n                System.out.println(\"HBase Admin initialized successfully.\");\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n \n    public static void close(){\n        try{\n            if(admin != null){\n                admin.close();\n            }\n            if(null != connection){\n                connection.close();\n            }\n        }catch (IOException e){\n            e.printStackTrace();\n        }\n    }\n \n    public static void createTable(String myTableName,String[] colFamily) throws IOException {\n        TableName tableName = TableName.valueOf(myTableName);\n        if(admin.tableExists(tableName)){\n            System.out.println(\"talbe is exists!\");\n        }else {\n            TableDescriptorBuilder tableDescriptor = TableDescriptorBuilder.newBuilder(tableName);\n            for(String str:colFamily){\n                ColumnFamilyDescriptor family = \nColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(str)).build();\n                tableDescriptor.setColumnFamily(family);\n            }\n            admin.createTable(tableDescriptor.build());\n        } \n    }\n \n    public static void insertData(String tableName,String rowKey,String colFamily,String col,String val) throws IOException { \n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Put put = new Put(rowKey.getBytes());\n        put.addColumn(colFamily.getBytes(),col.getBytes(), val.getBytes());\n        table.put(put);\n        table.close(); \n    }\n \n    public static void getData(String tableName,String rowKey,String colFamily, String col)throws  IOException{ \n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Get get = new Get(rowKey.getBytes());\n        get.addColumn(colFamily.getBytes(),col.getBytes());\n        Result result = table.get(get);\n        System.out.println(new String(result.getValue(colFamily.getBytes(),col==null?null:col.getBytes())));\n        table.close(); \n    }\n}\n```\n\n![image-20250408180910551](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/661b8bf5388c32a8028982d7495d41eb55933597-1746692007781-506-1747299497351-131-1747900721330-131-1749470495097-133.png)\n\n\n\n\n\n  â‘¡åœ¨ç»ˆç«¯è¾“å‡ºæŒ‡å®šè¡¨çš„æ‰€æœ‰è®°å½•æ•°æ®ã€‚\n\n==shell==\n\n```\nscan 'student'\n```\n\n![image-20250408175605631](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/a9bf5f6896beb92e8720ba6cb643bfcd55933597-1746692007781-507-1747299497351-132-1747900721330-133-1749470495097-134.png)\n\n==java==\n\n```java\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.*;\nimport org.apache.hadoop.hbase.client.*;\nimport org.apache.hadoop.hbase.util.Bytes;\nimport java.util.List;\nimport java.io.IOException;\npublic class test {\n    public static Configuration configuration;\n    public static Connection connection;\n    public static Admin admin;\n    public static void main(String[] args) throws IOException {\n    \t  // æŒ‡å®šè¡¨å \"student\" å¹¶è·å–æ‰€æœ‰è®°å½•\n    \t  String tableName = \"student\";\n    \t  getData(tableName);\n    \t }\n    \t // åœ¨ç»ˆç«¯æ‰“å°å‡ºæŒ‡å®šè¡¨çš„æ‰€æœ‰è®°å½•æ•°æ®\n    \t public static void getData(String tableName) throws IOException {\n    \t  init(); // åˆå§‹åŒ–è¿æ¥\n    \t  Table table = connection.getTable(TableName.valueOf(tableName)); // è·å–è¡¨å¯¹è±¡\n    \t  Scan scan = new Scan(); // åˆ›å»ºæ‰«æå™¨\n    \t  ResultScanner scanner = table.getScanner(scan); // è·å–æ‰«æç»“æœ\n    \t  System.out.println(\"è¡¨ \" + tableName + \" çš„æ‰€æœ‰è®°å½•å¦‚ä¸‹ï¼š\");\n    \t  for (Result result : scanner) { // éå†æ¯ä¸€è¡Œæ•°æ®\n    \tprintRecoder(result); // æ‰“å°æ¯æ¡è®°å½•çš„è¯¦æƒ…\n    \t  }\n    \t  close(); // å…³é—­è¿æ¥\n    \t }\n    \t // æ‰“å°ä¸€æ¡è®°å½•çš„è¯¦æƒ…\n    \t public static void printRecoder(Result result) throws IOException {\n    \t  for (Cell cell : result.rawCells()) { // éå†æ¯ä¸ªå•å…ƒæ ¼\n    \tSystem.out.print(\"è¡Œé”®: \" + new String(Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength())));\n    \tSystem.out.print(\" åˆ—ç°‡: \" + new String(Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength())));\n    \tSystem.out.print(\" åˆ—: \" + new String(Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength())));\n    \tSystem.out.print(\" å€¼: \" + new String(Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength())));\n    \tSystem.out.println(\" æ—¶é—´æˆ³: \" + cell.getTimestamp());\n    \t  }\n    \t }\n\n\n    public static void init() {\n        configuration = HBaseConfiguration.create();\n        configuration.set(\"hbase.rootdir\", \"hbase://localhost:9000/hbase\");\n        try {\n            connection = ConnectionFactory.createConnection(configuration);\n            if (connection == null) {\n                System.err.println(\"Failed to create HBase connection.\");\n            } else {\n                System.out.println(\"HBase connection created successfully.\");\n            }\n            admin = connection.getAdmin();\n            if (admin == null) {\n                System.err.println(\"Failed to get HBase Admin.\");\n            } else {\n                System.out.println(\"HBase Admin initialized successfully.\");\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n \n    public static void close(){\n        try{\n            if(admin != null){\n                admin.close();\n            }\n            if(null != connection){\n                connection.close();\n            }\n        }catch (IOException e){\n            e.printStackTrace();\n        }\n    }\n \n    public static void createTable(String myTableName,String[] colFamily) throws IOException {\n        TableName tableName = TableName.valueOf(myTableName);\n        if(admin.tableExists(tableName)){\n            System.out.println(\"talbe is exists!\");\n        }else {\n            TableDescriptorBuilder tableDescriptor = TableDescriptorBuilder.newBuilder(tableName);\n            for(String str:colFamily){\n                ColumnFamilyDescriptor family = \nColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(str)).build();\n                tableDescriptor.setColumnFamily(family);\n            }\n            admin.createTable(tableDescriptor.build());\n        } \n    }\n \n    public static void insertData(String tableName,String rowKey,String colFamily,String col,String val) throws IOException { \n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Put put = new Put(rowKey.getBytes());\n        put.addColumn(colFamily.getBytes(),col.getBytes(), val.getBytes());\n        table.put(put);\n        table.close(); \n    }\n \n    public static void getData(String tableName,String rowKey,String colFamily, String col)throws  IOException{ \n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Get get = new Get(rowKey.getBytes());\n        get.addColumn(colFamily.getBytes(),col.getBytes());\n        Result result = table.get(get);\n        System.out.println(new String(result.getValue(colFamily.getBytes(),col==null?null:col.getBytes())));\n        table.close(); \n    }\n}\n```\n\nè¿è¡Œç»“æœå¦‚ä¸‹\n\n![image-20250408180840552](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/f5f936356529f42ce9823d1a641abb3e55933597-1746692007781-508-1747299497351-133-1747900721330-132-1749470495097-132.png)\n\n  â‘¢å‘å·²ç»åˆ›å»ºå¥½çš„è¡¨æ·»åŠ å’Œåˆ é™¤æŒ‡å®šçš„åˆ—æ—æˆ–åˆ—ã€‚\n\n==shell==\n\n```\ncreate 's1','score'\nput 's1','zhangsan','score:Math','69'\ndelete 's1','zhangsan','score:Math'\n```\n\n![image-20250408175944024](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/2e51321547d302cea1a9024b5bb2f1ad55933597-1746692007781-509-1747299497351-134-1747900721330-134-1749470495098-135.png)\n\n==JAVA==\n\n```java\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.*;\nimport org.apache.hadoop.hbase.client.*;\nimport org.apache.hadoop.hbase.util.Bytes;\n\nimport java.io.IOException;\n\npublic class test {\n    public static Configuration configuration;\n    public static Connection connection;\n    public static Admin admin;\n\n    public static void main(String[] args) throws IOException {\n        init(); // åˆå§‹åŒ–è¿æ¥\n\n        String tableName = \"s1\"; // è¡¨å\n        String[] columnFamilies = {\"score\"}; // åˆ—ç°‡\n        String rowKey = \"zhangsan\"; // è¡Œé”®\n        String colFamily = \"score\"; // åˆ—ç°‡\n        String col = \"Math\"; // åˆ—å\n        String val = \"69\"; // å€¼\n\n        // åˆ›å»ºè¡¨\n        System.out.println(\"å¼€å§‹åˆ›å»ºè¡¨...\");\n        createTable(tableName, columnFamilies);\n\n        // æ’å…¥æ•°æ®\n        System.out.println(\"å¼€å§‹æ’å…¥æ•°æ®...\");\n        insertRow(tableName, rowKey, colFamily, col, val);\n\n        // æŸ¥è¯¢æ•°æ®\n        System.out.println(\"éªŒè¯æ’å…¥çš„æ•°æ®...\");\n        getData(tableName, rowKey, colFamily, col);\n\n        // åˆ é™¤æ•°æ®\n        System.out.println(\"å¼€å§‹åˆ é™¤æ•°æ®...\");\n        deleteRow(tableName, rowKey, colFamily, col);\n\n        // éªŒè¯åˆ é™¤\n        System.out.println(\"éªŒè¯åˆ é™¤åçš„æ•°æ®...\");\n        getData(tableName, rowKey, colFamily, col);\n\n        close(); // å…³é—­è¿æ¥\n    }\n\n    public static void init() {\n        configuration = HBaseConfiguration.create();\n        configuration.set(\"hbase.rootdir\", \"hdfs://localhost:9000/hbase\"); // æ³¨æ„è¿™é‡Œç”¨çš„æ˜¯ hdfs\n        configuration.set(\"hbase.zookeeper.quorum\", \"localhost\"); // æŒ‡å®š zookeeper åœ°å€\n        try {\n            connection = ConnectionFactory.createConnection(configuration);\n            admin = connection.getAdmin();\n            System.out.println(\"HBase connection and Admin initialized successfully.\");\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static void close() {\n        try {\n            if (admin != null) {\n                admin.close();\n            }\n            if (connection != null) {\n                connection.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static void createTable(String myTableName, String[] colFamilies) throws IOException {\n        TableName tableName = TableName.valueOf(myTableName);\n        if (admin.tableExists(tableName)) {\n            System.out.println(\"è¡¨å·²å­˜åœ¨ï¼\");\n        } else {\n            TableDescriptorBuilder tableDescriptor = TableDescriptorBuilder.newBuilder(tableName);\n            for (String cf : colFamilies) {\n                ColumnFamilyDescriptor family =\n                        ColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(cf)).build();\n                tableDescriptor.setColumnFamily(family);\n            }\n            admin.createTable(tableDescriptor.build());\n            System.out.println(\"è¡¨ \" + myTableName + \" åˆ›å»ºæˆåŠŸï¼\");\n        }\n    }\n\n    public static void insertRow(String tableName, String rowKey, String colFamily, String col, String val) throws IOException {\n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Put put = new Put(Bytes.toBytes(rowKey));\n        put.addColumn(Bytes.toBytes(colFamily), Bytes.toBytes(col), Bytes.toBytes(val));\n        table.put(put);\n        table.close();\n        System.out.println(\"æ•°æ®æ’å…¥æˆåŠŸï¼\");\n    }\n\n    public static void getData(String tableName, String rowKey, String colFamily, String col) throws IOException {\n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Get get = new Get(Bytes.toBytes(rowKey));\n        get.addColumn(Bytes.toBytes(colFamily), Bytes.toBytes(col));\n        Result result = table.get(get);\n        byte[] value = result.getValue(Bytes.toBytes(colFamily), Bytes.toBytes(col));\n        if (value != null) {\n            System.out.println(\"è·å–åˆ°æ•°æ®: \" + new String(value));\n        } else {\n            System.out.println(\"æœªæ‰¾åˆ°æ•°æ®ã€‚\");\n        }\n        table.close();\n    }\n\n    public static void deleteRow(String tableName, String rowKey, String colFamily, String col) throws IOException {\n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Delete delete = new Delete(Bytes.toBytes(rowKey));\n        delete.addColumn(Bytes.toBytes(colFamily), Bytes.toBytes(col));\n        table.delete(delete);\n        table.close();\n        System.out.println(\"æ•°æ®åˆ é™¤æˆåŠŸï¼\");\n    }\n}\n\n```\n\n![image-20250408181938555](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/4952ac8d1d540a6e277b0582297fbf2055933597-1746692007781-510-1747299497351-136-1747900721330-135-1749470495098-136.png)\n\n---\n\nâ‘£æ¸…ç©ºæŒ‡å®šè¡¨çš„æ‰€æœ‰è®°å½•æ•°æ®ã€‚\n\n==shell==\n\n```\ncreate 's1','score'\nput 's1','zhangsan','score:Math','69'\ntruncate 's1'\nscan 's1'\n```\n\n![image-20250408182046843](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/7afb99cf0df777c1ef237f2b838b508a55933597-1746692007781-511-1747299497351-135-1747900721330-136-1749470495098-137.png)\n\n```\nput 's1','zhangsan','score:Math','69'\n```\n\n==java==\n\næ•™æä¸­çš„ä»£ç \n\n`clearRows()` æ–¹æ³•ç¼ºäº†ä¸€ä¸ª **å…³é”®ç‚¹**ï¼š\n\n> åœ¨åˆ é™¤è¡¨ä¹‹åé‡æ–°åˆ›å»ºæ—¶ï¼Œéœ€è¦é‡æ–°æ·»åŠ åŸæ¥çš„åˆ—ç°‡ï¼ˆå¦åˆ™å»ºå‡ºæ¥çš„è¡¨æ˜¯ç©ºç»“æ„ï¼‰ã€‚\n\næ‰€ä»¥æˆ‘ç”¨æ–°çš„\n\n```java\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.HBaseConfiguration;\nimport org.apache.hadoop.hbase.TableName;\nimport org.apache.hadoop.hbase.client.*;\nimport org.apache.hadoop.hbase.util.Bytes;\nimport java.io.IOException;\npublic class test {\n    public static Configuration configuration;\n    public static Connection connection;\n    public static Admin admin;\n    public static void main(String[] args) throws IOException {\n        String tableName = \"s1\"; // ä½ è¦æ¸…ç©ºçš„è¡¨å\n        clearRows(tableName);\n    }\n    // åˆå§‹åŒ– HBase è¿æ¥\n    public static void init() throws IOException {\n        configuration = HBaseConfiguration.create();\n        configuration.set(\"hbase.rootdir\", \"hdfs://localhost:9000/hbase\");\n        configuration.set(\"hbase.zookeeper.quorum\", \"localhost\");\n        connection = ConnectionFactory.createConnection(configuration);\n        admin = connection.getAdmin();\n    }\n    // å…³é—­ HBase è¿æ¥\n    public static void close() throws IOException {\n        if (admin != null) admin.close();\n        if (connection != null) connection.close();\n    }\n    // æ¸…ç©ºæŒ‡å®šè¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œä¿ç•™åˆ—ç°‡ç»“æ„\n    public static void clearRows(String tableNameStr) throws IOException {\n        init(); // åˆå§‹åŒ–è¿æ¥\n        TableName tableName = TableName.valueOf(tableNameStr);\n        if (!admin.tableExists(tableName)) {\n            System.out.println(\"è¡¨ä¸å­˜åœ¨ï¼Œæ— æ³•æ¸…ç©ºï¼\");\n            close();\n            return;\n        }\n        // è·å–åŸå§‹è¡¨ç»“æ„\n        TableDescriptor descriptor = admin.getDescriptor(tableName);\n        // ç¦ç”¨è¡¨\n        if (!admin.isTableDisabled(tableName)) {\n            admin.disableTable(tableName);\n        }\n        // åˆ é™¤è¡¨\n        admin.deleteTable(tableName);\n        // é‡æ–°åˆ›å»ºè¡¨ï¼ˆä½¿ç”¨åŸç»“æ„ï¼‰\n        admin.createTable(descriptor);\n        System.out.println(\"è¡¨ [\" + tableNameStr + \"] å·²æ¸…ç©ºï¼ˆä¿ç•™åˆ—ç°‡ç»“æ„ï¼‰\");\n        close(); // å…³é—­è¿æ¥\n    }\n}\n\n```\n\n![image-20250408182815289](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/073c2af343c85961acffe8bcfe440c1855933597-1746692007781-512-1747299497351-137-1747900721330-137-1749470495098-138.png)\n\nè¿™æ—¶å€™å†å»æŸ¥è¡¨\n\n![image-20250408182848140](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/af59211330068025067a668b71a2da5b55933597-1746692007781-513-1747299497351-138-1747900721330-138-1749470495098-139.png)\n\n---\n\nâ‘¤ç»Ÿè®¡è¡¨çš„è¡Œæ•°ã€‚\n\n==shell==\n\n```\nput 's1','zhangsan','score:Math','69'\ncount  's1'\n```\n\n![image-20250408182937568](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/981c0e0a9e8be7f01f8de72ca3ddb26555933597-1746692007781-514-1747299497351-139-1747900721330-139-1749470495098-140.png)\n\n==java==\n\n```\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.HBaseConfiguration;\nimport org.apache.hadoop.hbase.TableName;\nimport org.apache.hadoop.hbase.client.*;\n\nimport java.io.IOException;\n\npublic class test {\n    public static Configuration configuration;\n    public static Connection connection;\n    public static Admin admin;\n\n    public static void main(String[] args) throws IOException {\n        String tableName = \"s1\"; // ä½ è¦ç»Ÿè®¡çš„è¡¨å\n        countRows(tableName);\n    }\n\n    // åˆå§‹åŒ– HBase è¿æ¥\n    public static void init() throws IOException {\n        configuration = HBaseConfiguration.create();\n        configuration.set(\"hbase.rootdir\", \"hdfs://localhost:9000/hbase\");\n        configuration.set(\"hbase.zookeeper.quorum\", \"localhost\");\n        connection = ConnectionFactory.createConnection(configuration);\n        admin = connection.getAdmin();\n    }\n\n    // å…³é—­ HBase è¿æ¥\n    public static void close() throws IOException {\n        if (admin != null) admin.close();\n        if (connection != null) connection.close();\n    }\n\n    // ç»Ÿè®¡è¡¨çš„è¡Œæ•°\n    public static void countRows(String tableName) throws IOException {\n        init(); // åˆå§‹åŒ–è¿æ¥\n\n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Scan scan = new Scan();\n        scan.setCaching(500); // å¯é€‰ä¼˜åŒ–ï¼ŒåŠ å¿«æ‰«æé€Ÿåº¦\n\n        ResultScanner scanner = table.getScanner(scan);\n\n        int num = 0;\n        for (Result result = scanner.next(); result != null; result = scanner.next()) {\n            num++;\n        }\n\n        System.out.println(\"è¡¨ [\" + tableName + \"] çš„æ€»è¡Œæ•°ä¸º: \" + num);\n\n        scanner.close();\n        table.close(); // å…³é—­ Table å¯¹è±¡\n        close();       // å…³é—­è¿æ¥\n    }\n}\n\n```\n\n![image-20250408183057896](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6a04692ff70305b199bc63ac2b63d60b55933597-1746692007781-515-1747299497351-140-1747900721330-140-1749470495098-141.png)\n\n### ç¬¬äºŒé¢˜\n\n ï¼ˆ2ï¼‰ç°æœ‰ä»¥ä¸‹å…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ï¼ˆè§è¡¨4-21ã€è¡¨4-22å’Œè¡¨4-23ï¼‰ï¼Œè¦æ±‚å°†å…¶è½¬æ¢ä¸ºé€‚åˆHBaseå­˜å‚¨çš„è¡¨å¹¶æ’å…¥æ•°æ®ã€‚\n\nè¡¨4-21 å­¦ç”Ÿï¼ˆStudentï¼‰è¡¨      \n\n| å­¦å·ï¼ˆS_Noï¼‰ | å§“åï¼ˆS_Nameï¼‰ | æ€§åˆ«ï¼ˆS_Sexï¼‰ | å¹´é¾„ï¼ˆS_Ageï¼‰ |\n| ------------ | -------------- | ------------- | ------------- |\n| 2015001      | Zhangsan       | male          | 23            |\n| 2015002      | Mary           | female        | 22            |\n| 2015003      | Lisi           | male          | 24            |\n\nè¡¨4-22 è¯¾ç¨‹ï¼ˆCourseï¼‰è¡¨         \n\n| è¯¾ç¨‹å·ï¼ˆC_Noï¼‰ | è¯¾ç¨‹åï¼ˆC_Nameï¼‰ | å­¦åˆ†ï¼ˆC_Creditï¼‰ |\n| -------------- | ---------------- | ---------------- |\n| 123001         | Math             | 2.0              |\n| 123002         | Computer Science | 5.0              |\n| 123003         | English          | 3.0              |\n\nè¡¨4-23  é€‰è¯¾ï¼ˆSCï¼‰è¡¨                  \n\n| å­¦å·ï¼ˆSC_Snoï¼‰ | è¯¾ç¨‹å·ï¼ˆSC_Cnoï¼‰ | æˆç»©ï¼ˆSC_Scoreï¼‰ |\n| -------------- | ---------------- | ---------------- |\n| 2015001        | 123001           | 86               |\n| 2015001        | 123003           | 69               |\n| 2015002        | 123002           | 77               |\n| 2015002        | 123003           | 99               |\n| 2015003        | 123001           | 98               |\n| 2015003        | 123002           | 95               |\n\n==shell==\n\n```\ndisable 'student'\ndrop 'student'\n```\n\nåˆ›å»ºå­¦ç”Ÿ studentè¡¨\n\n```\ncreate 'Student','S_No','S_Name','S_Sex','S_Age'\nput 'Student','s001','S_No','2015001'\nput 'Student','s001','S_Name','Zhangsan'\nput 'Student','s001','S_Sex','male'\nput 'Student','s001','S_Age','23'\nput 'Student','s002','S_No','2015002'\nput 'Student','s002','S_Name','Mary'\nput 'Student','s002','S_Sex','female'\nput 'Student','s002','S_Age','22'\nput 'Student','s003','S_No','2015003'\nput 'Student','s003','S_Name','Lisi'\nput 'Student','s003','S_Sex','male'\nput 'Student','s003','S_Age','24'\n\n```\n\n![image-20250408183744904](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/5e31a2708e11baa119c76ecde299ab6355933597-1746692007781-516-1747299497351-141-1747900721330-141-1749470495098-142.png)\n\nåˆ›å»ºè¯¾ç¨‹ Course è¡¨\n\n```\ncreate 'Course','C_No','C_Name','C_Credit'\nput 'Course','c001','C_No','123001'\nput 'Course','c001','C_Name','Math'\nput 'Course','c001','C_Credit','2.0'\nput 'Course','c002','C_No','123002'\nput 'Course','c002','C_Name','Computer'\nput 'Course','c002','C_Credit','5.0'\nput 'Course','c003','C_No','123003'\nput 'Course','c003','C_Name','English'\nput 'Course','c003','C_Credit','3.0'\n```\n\n![image-20250408183801194](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b90f6dce4ae75d8d6aae1ff094bbddb455933597-1746692007781-517-1747299497351-142-1747900721330-142-1749470495098-144.png)\n\nåˆ›å»ºé€‰è¯¾ SC è¡¨\n\n```\ncreate 'SC','SC_Sno','SC_Cno','SC_Score'\nput 'SC','sc001','SC_Sno','2015001'\nput 'SC','sc001','SC_Cno','123001'\nput 'SC','sc001','SC_Score','86'\nput 'SC','sc002','SC_Sno','2015001'\nput 'SC','sc002','SC_Cno','123003'\nput 'SC','sc002','SC_Score','69'\nput 'SC','sc003','SC_Sno','2015002'\nput 'SC','sc003','SC_Cno','123002'\nput 'SC','sc003','SC_Score','77'\nput 'SC','sc004','SC_Sno','2015002'\nput 'SC','sc004','SC_Cno','123003'\nput 'SC','sc004','SC_Score','99'\nput 'SC','sc005','SC_Sno','2015003'\nput 'SC','sc005','SC_Cno','123001'\nput 'SC','sc005','SC_Score','98'\nput 'SC','sc006','SC_Sno','2015003'\nput 'SC','sc006','SC_Cno','123002'\nput 'SC','sc006','SC_Score','95'\n```\n\n![image-20250408183820490](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/5c7e6e07073a4fc9aaab422f5d7ea6ff55933597-1746692007781-518-1747299497351-144-1747900721330-143-1749470495098-143.png)\n\néªŒè¯\n\n```\nscan 'Student'\nscan 'Course'\nscan 'SC'\n```\n\n![image-20250408184041557](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/32917960477379ca6d005534185fbfd555933597-1746692007781-519-1747299497351-143-1747900721330-144-1749470495098-145.png)\n\n```\ndisable 'Student'\ndrop 'Student'\ndisable 'Course'\ndrop 'Course'\ndisable 'SC'\ndrop 'SC'\n```\n\n\n\n==java==\n\nâ‘  createTable(String tableName, String[] fields)ã€‚\n\nâ‘¡ addRecord(String tableName, String row, String[] fields, String[]values)ã€‚\n\nâ‘¢ scanColumn(String tableName, String column)ã€‚\n\nâ‘£ modifyData(String tableName, String row, String column)ã€‚\n\nâ‘¤ deleteRow(String tableName, String row)ã€‚\n\n```java\nimport java.io.IOException;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.*;\nimport org.apache.hadoop.hbase.client.*;\nimport org.apache.hadoop.hbase.util.Bytes;\n\npublic class test {\n    static Connection connection;\n    static Admin admin;\n\n    public static void init() throws IOException {\n        Configuration conf = HBaseConfiguration.create();\n        conf.set(\"hbase.zookeeper.quorum\", \"localhost\");\n        connection = ConnectionFactory.createConnection(conf);\n        admin = connection.getAdmin();\n    }\n\n    public static void close() throws IOException {\n        if (admin != null) admin.close();\n        if (connection != null) connection.close();\n    }\n\n    public static void createTable(String tableName, String[] fields) throws IOException {\n        init();\n        TableName tablename = TableName.valueOf(tableName);\n        if (admin.tableExists(tablename)) {\n            System.out.println(\"è¡¨ \" + tableName + \" å·²å­˜åœ¨ï¼Œæ­£åœ¨åˆ é™¤...\");\n            admin.disableTable(tablename);\n            admin.deleteTable(tablename);\n        }\n        TableDescriptorBuilder tableDescriptor = TableDescriptorBuilder.newBuilder(tablename);\n        for (String str : fields) {\n            tableDescriptor.setColumnFamily(ColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(str)).build());\n        }\n        admin.createTable(tableDescriptor.build());\n        System.out.println(\"è¡¨ \" + tableName + \" åˆ›å»ºæˆåŠŸ\");\n        close();\n    }\n\n    public static void addRecord(String tableName, String row, String[] fields, String[] values) throws IOException {\n        init();\n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Put put = new Put(Bytes.toBytes(row));\n        for (int i = 0; i < fields.length; i++) {\n            String[] parts = fields[i].split(\":\");\n            put.addColumn(Bytes.toBytes(parts[0], Bytes.toBytes(parts[1], Bytes.toBytes(values[i]);\n        }\n        table.put(put);\n        table.close();\n        close();\n    }\n\n    public static void scanColumn(String tableName, String column) throws IOException {\n        init();\n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Scan scan = new Scan();\n        if (column.contains(\":\")) {\n            String[] parts = column.split(\":\");\n            scan.addColumn(Bytes.toBytes(parts[0], Bytes.toBytes(parts[1]);\n        } else {\n            scan.addFamily(Bytes.toBytes(column));\n        }\n        ResultScanner scanner = table.getScanner(scan);\n        for (Result result = scanner.next(); result != null; result = scanner.next()) {\n            showCell(result);\n        }\n        scanner.close();\n        table.close();\n        close();\n    }\n\n    public static void showCell(Result result) {\n        for (Cell cell : result.rawCells()) {\n            System.out.println(\"RowName: \" + Bytes.toString(CellUtil.cloneRow(cell)));\n            System.out.println(\"Timestamp: \" + cell.getTimestamp());\n            System.out.println(\"ColumnFamily: \" + Bytes.toString(CellUtil.cloneFamily(cell)));\n            System.out.println(\"Column: \" + Bytes.toString(CellUtil.cloneQualifier(cell)));\n            System.out.println(\"Value: \" + Bytes.toString(CellUtil.cloneValue(cell)));\n            System.out.println(\"----------------------------------------\");\n        }\n    }\n\n    public static void modifyData(String tableName, String row, String column, String val) throws IOException {\n        init();\n        Table table = connection.getTable(TableName.valueOf(tableName));\n        String[] parts = column.split(\":\");\n        Put put = new Put(Bytes.toBytes(row));\n        put.addColumn(Bytes.toBytes(parts[0], Bytes.toBytes(parts[1], Bytes.toBytes(val));\n        table.put(put);\n        System.out.println(\"ä¿®æ”¹è¡¨ \" + tableName + \" ä¸­ \" + row + \" è¡Œçš„åˆ— \" + column + \" ä¸º \" + val);\n        table.close();\n        close();\n    }\n\n    public static void deleteRow(String tableName, String row) throws IOException {\n        init();\n        Table table = connection.getTable(TableName.valueOf(tableName));\n        Delete delete = new Delete(Bytes.toBytes(row));\n        table.delete(delete);\n        System.out.println(\"åˆ é™¤è¡¨ \" + tableName + \" ä¸­çš„è¡Œ \" + row);\n        table.close();\n        close();\n    }\n\n    public static void main(String[] args) throws IOException {\n        // Student è¡¨\n        createTable(\"Student\", new String[]{\"S_No\", \"S_Name\", \"S_Sex\", \"S_Age\"});\n        addRecord(\"Student\", \"s001\", new String[]{\"S_No:S_No\", \"S_Name:S_Name\", \"S_Sex:S_Sex\", \"S_Age:S_Age\"},\n                new String[]{\"2015001\", \"Zhangsan\", \"male\", \"23\"});\n        addRecord(\"Student\", \"s002\", new String[]{\"S_No:S_No\", \"S_Name:S_Name\", \"S_Sex:S_Sex\", \"S_Age:S_Age\"},\n                new String[]{\"2015002\", \"Mary\", \"female\", \"22\"});\n        addRecord(\"Student\", \"s003\", new String[]{\"S_No:S_No\", \"S_Name:S_Name\", \"S_Sex:S_Sex\", \"S_Age:S_Age\"},\n                new String[]{\"2015003\", \"Lisi\", \"male\", \"24\"});\n        System.out.println(\"Student è¡¨æ’å…¥æ•°æ®æˆåŠŸ\");\n\n        // Course è¡¨\n        createTable(\"Course\", new String[]{\"C_No\", \"C_Name\", \"C_Credit\"});\n        addRecord(\"Course\", \"c001\", new String[]{\"C_No:C_No\", \"C_Name:C_Name\", \"C_Credit:C_Credit\"},\n                new String[]{\"123001\", \"Math\", \"2.0\"});\n        addRecord(\"Course\", \"c002\", new String[]{\"C_No:C_No\", \"C_Name:C_Name\", \"C_Credit:C_Credit\"},\n                new String[]{\"123002\", \"Computer\", \"5.0\"});\n        addRecord(\"Course\", \"c003\", new String[]{\"C_No:C_No\", \"C_Name:C_Name\", \"C_Credit:C_Credit\"},\n                new String[]{\"123003\", \"English\", \"3.0\"});\n        System.out.println(\"Course è¡¨æ’å…¥æ•°æ®æˆåŠŸ\");\n\n        // SC è¡¨\n        createTable(\"SC\", new String[]{\"SC_Sno\", \"SC_Cno\", \"SC_Score\"});\n        addRecord(\"SC\", \"sc001\", new String[]{\"SC_Sno:SC_Sno\", \"SC_Cno:SC_Cno\", \"SC_Score:SC_Score\"},\n                new String[]{\"2015001\", \"123001\", \"86\"});\n        addRecord(\"SC\", \"sc002\", new String[]{\"SC_Sno:SC_Sno\", \"SC_Cno:SC_Cno\", \"SC_Score:SC_Score\"},\n                new String[]{\"2015001\", \"123003\", \"69\"});\n        addRecord(\"SC\", \"sc003\", new String[]{\"SC_Sno:SC_Sno\", \"SC_Cno:SC_Cno\", \"SC_Score:SC_Score\"},\n                new String[]{\"2015002\", \"123002\", \"77\"});\n        addRecord(\"SC\", \"sc004\", new String[]{\"SC_Sno:SC_Sno\", \"SC_Cno:SC_Cno\", \"SC_Score:SC_Score\"},\n                new String[]{\"2015002\", \"123003\", \"99\"});\n        addRecord(\"SC\", \"sc005\", new String[]{\"SC_Sno:SC_Sno\", \"SC_Cno:SC_Cno\", \"SC_Score:SC_Score\"},\n                new String[]{\"2015003\", \"123001\", \"98\"});\n        addRecord(\"SC\", \"sc006\", new String[]{\"SC_Sno:SC_Sno\", \"SC_Cno:SC_Cno\", \"SC_Score:SC_Score\"},\n                new String[]{\"2015003\", \"123002\", \"95\"});\n        System.out.println(\"SC è¡¨æ’å…¥æ•°æ®æˆåŠŸ\");\n\n        // ç¤ºä¾‹è¾“å‡º\n        System.out.println(\"===== æµè§ˆ Student è¡¨çš„å…¨éƒ¨ S_Name åˆ—æ— =====\");\n        scanColumn(\"Student\", \"S_Name\");\n\n        System.out.println(\"===== ä¿®æ”¹ Student è¡¨ä¸­ s002 çš„ S_Age ä¸º 25 =====\");\n        modifyData(\"Student\", \"s002\", \"S_Age:S_Age\", \"25\");\n\n        System.out.println(\"===== åˆ é™¤ Student è¡¨ä¸­çš„ s003 =====\");\n        deleteRow(\"Student\", \"s003\");\n    }\n}\n\n```\n\n![image-20250408190024787](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6558a1532abdadb376905f6513ac10ce55933597-1746692007782-520-1747299497351-145-1747900721330-145-1749470495098-146.png)\n\n## ï¼ˆ7.5.5ï¼‰\n\n### åŸºç¡€\n\nè‡ªè¡Œå¼€å¯hadoopé›†ç¾¤å’Œhbase\n\n```\ncd\ncat > wordfile1.txt<<\"EOF\"\nI love Spark\nI love Hadoop\nEOF\ncat > wordfile2.txt<<\"EOF\"\nHadoop is good\nSpark is fast\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put wordfile1.txt input\nhdfs dfs -put wordfile2.txt input\n```\n\n![image-20250508151954700](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b7c6ae4b33cc17a2deb9057b404fe7a655933597-1746692007782-521-1747299497351-146-1747900721330-146-1749470495098-147.png)\n\n### åœ¨eclipseåˆ›å»ºé¡¹ç›®\n\nå¯åŠ¨eclipse\n\n```\neclipse\n```\n\nåˆ›å»ºé¡¹ç›®\n\nFile-new-project\n\nåå­—ï¼š`WordCount`\n\n![image-20250508152019222](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/ee7d820cccc370c09b7e12965ac9f30655933597-1746692007782-522-1747299497351-147-1747900721330-147-1749470495098-149.png)\n\nä¸ºäº†ç¼–å†™ä¸€ä¸ªMapReduceç¨‹åºï¼Œä¸€èˆ¬éœ€è¦å‘Javaå·¥ç¨‹ä¸­æ·»åŠ ä»¥ä¸‹JARåŒ…ï¼š\nï¼ˆ1)`/usr/local/hadoop/share/hadoop/common`ç›®å½•ä¸‹çš„`hadoop-common-3.1.3.jar`å’Œ`haoop-nfs-3.1.3.jar`ï¼›\nï¼ˆ2)`/usr/local/hadoop/share/hadoop/common/lib`ç›®å½•ä¸‹çš„`æ‰€æœ‰JARåŒ…`ï¼›\nï¼ˆ3)`/usr/local/hadoop/share/hadoop/mapreduce`ç›®å½•ä¸‹çš„`æ‰€æœ‰JARåŒ…`ï¼Œä½†æ˜¯ï¼Œ`ä¸åŒ…æ‹¬jdiffã€lib-exampleså’Œsourcesç›®å½•`.\n\n![image-20250508152028054](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6e5dba872fef1b72dcb96aa60032bcaa55933597-1746692007782-523-1747299497351-148-1747900721330-148-1749470495098-148.png)\n\næ·»åŠ å®Œæˆå°±finishå°±è¡Œ\n\n### ç¼–å†™Javaåº”ç”¨ç¨‹åº\n\nåˆ›å»º`WordCount.java`,è‡ªå·±çœ‹å¥½ï¼Œä»¥åä¸ä¼šå†è¯´äº†\n\n![image-20250508152037946](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/d12d00e0e59333d347ab4f14c335af9d55933597-1746692007782-524-1747299497351-149-1747900721330-149-1749470495098-150.png)\n\næ·»åŠ ä»£ç \n\n```java\nimport java.io.IOException;\nimport java.util.Iterator;\nimport java.util.StringTokenizer;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\nimport org.apache.hadoop.util.GenericOptionsParser;\npublic class WordCount {\n    public WordCount() {\n    }\n     public static void main(String[] args) throws Exception {\n        Configuration conf = new Configuration();\n        String[] otherArgs = (new GenericOptionsParser(conf, args)).getRemainingArgs();\n        if(otherArgs.length < 2) {\n            System.err.println(\"Usage: wordcount <in> [<in>...] <out>\");\n            System.exit(2);\n        }\n        Job job = Job.getInstance(conf, \"word count\");\n        job.setJarByClass(WordCount.class);\n        job.setMapperClass(WordCount.TokenizerMapper.class);\n        job.setCombinerClass(WordCount.IntSumReducer.class);\n        job.setReducerClass(WordCount.IntSumReducer.class);\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(IntWritable.class); \n        for(int i = 0; i < otherArgs.length - 1; ++i) {\n            FileInputFormat.addInputPath(job, new Path(otherArgs[i]);\n        }\n        FileOutputFormat.setOutputPath(job, new Path(otherArgs[otherArgs.length - 1]);\n        System.exit(job.waitForCompletion(true)?0:1);\n    }\n    public static class TokenizerMapper extends Mapper<Object, Text, Text, IntWritable> {\n        private static final IntWritable one = new IntWritable(1);\n        private Text word = new Text();\n        public TokenizerMapper() {\n        }\n        public void map(Object key, Text value, Mapper<Object, Text, Text, IntWritable>.Context context) throws IOException, InterruptedException {\n            StringTokenizer itr = new StringTokenizer(value.toString()); \n            while(itr.hasMoreTokens()) {\n                this.word.set(itr.nextToken());\n                context.write(this.word, one);\n            }\n        }\n    }\npublic static class IntSumReducer extends Reducer<Text, IntWritable, Text, IntWritable> {\n        private IntWritable result = new IntWritable();\n        public IntSumReducer() {\n        }\n        public void reduce(Text key, Iterable<IntWritable> values, Reducer<Text, IntWritable, Text, IntWritable>.Context context) throws IOException, InterruptedException {\n            int sum = 0;\n            IntWritable val;\n            for(Iterator i$ = values.iterator(); i$.hasNext(); sum += val.get()) {\n                val = (IntWritable)i$.next();\n            }\n            this.result.set(sum);\n            context.write(key, this.result);\n        }\n    }\n}\n```\n\nè¿è¡Œä¸€ä¸‹\n\n![image-20250508152047998](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/ed5660e7f99bf786444e3ca5dc01aeca55933597-1746692007782-525-1747299497351-151-1747900721330-150-1749470495098-151.png)\n\n> 7.5.5æˆªå›¾1\n\n### ç¼–è¯‘æ‰“åŒ…ç¨‹åº\n\nå¦‚æœä½ æ²¡æœ‰myappæ–‡ä»¶å¤¹ä½ å°±è‡ªå·±åˆ›å»ºï¼Œæˆ‘çš„æ˜¯æœ‰çš„\n\n![image-20250508152056980](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/61642003432b78f55cab6505fa1742ac55933597-1746692007782-526-1747299497351-150-1747900721330-151-1749470495098-152.png)\n\n![image-20250508152109370](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/248cd9a79f38735b1cd8594baf84d9d555933597-1746692007782-527-1747299497351-152-1747900721330-153-1749470495098-153.png)\n\n\n\n![image-20250508152443407](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/d5da5d88e74e5be4a0209559bbeefad455933597-1746692007782-528-1747299497351-153-1747900721330-152-1749470495098-155.png)\n\né€‰æ‹©`WordCount`é¡¹ç›®\n\nå¡«å†™è·¯å¾„`/usr/local/hadoop/myapp/WordCount.jar`\n\nç„¶å`finish`\n\nè¿™æ—¶å€™ä¼šæœ‰å¼¹çª—ï¼Œä¸€è·¯`okä¸‹æ¥`å°±è¡Œäº†\n\n```\nll  /usr/local/hadoop/myapp\n```\n\n![image-20250508152129030](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/c37f9d8706aaf5419770baf2a840253755933597-1746692007782-529-1747299497352-154-1747900721330-154-1749470495098-154.png)\n\n### è¿è¡Œç¨‹åº\n\n```\nhadoop jar /usr/local/hadoop/myapp/WordCount.jar input output\nhdfs dfs -cat output/*\n```\n\n![image-20250508152139398](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/4136c00c46c5a26bf1daef363b79467455933597-1746692007782-530-1747299497352-155-1747900721330-155-1749470495098-156.png)\n\n![image-20250508152151659](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/0e03c562f7b2919d9a19b3be3a0d176255933597-1746692007782-531-1747299497352-156-1747900721330-156-1749470495098-158.png)\n\n> 7.5.5 æˆªå›¾2å’Œ3\n\n\n\n## ï¼ˆ7.3.4ï¼‰\n\n==ç¬¬å››é¢˜==\n\n==shell==\n\n```\ncat > avg.txt <<\"EOF\"\nmath 80\nmath 90\nenglish 70\nenglish 100\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put avg.txt input\n```\n\nåˆ›å»º`AverageCalculator.java`\n\n```java\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\n\npublic class AverageCalculator {\n\n    public static class AvgMapper extends Mapper<LongWritable, Text, Text, IntWritable> {\n        private Text keyOut = new Text();\n        private IntWritable valOut = new IntWritable();\n\n        @Override\n        protected void map(LongWritable key, Text value, Context context)\n                throws IOException, InterruptedException {\n            String[] parts = value.toString().split(\"\\\\s+\");\n            if (parts.length == 2) {\n                keyOut.set(parts[0];\n                valOut.set(Integer.parseInt(parts[1]);\n                context.write(keyOut, valOut);\n            }\n        }\n    }\n\n    public static class AvgReducer extends Reducer<Text, IntWritable, Text, IntWritable> {\n        private IntWritable result = new IntWritable();\n\n        @Override\n        protected void reduce(Text key, Iterable<IntWritable> values, Context context)\n                throws IOException, InterruptedException {\n            int sum = 0;\n            int count = 0;\n            for (IntWritable val : values) {\n                sum += val.get();\n                count++;\n            }\n            if (count != 0) {\n                result.set(sum / count);\n                context.write(key, result);\n            }\n        }\n    }\n\n    public static void main(String[] args) throws Exception {\n        if (args.length != 2) {\n            System.err.println(\"Usage: AverageCalculator <input path> <output path>\");\n            System.exit(-1);\n        }\n\n        Configuration conf = new Configuration();\n        Job job = Job.getInstance(conf, \"Average Calculator\");\n        job.setJarByClass(AverageCalculator.class);\n\n        job.setMapperClass(AvgMapper.class);\n        job.setReducerClass(AvgReducer.class);\n\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(IntWritable.class);\n\n        FileInputFormat.setInputPaths(job, new Path(args[0]);\n        FileOutputFormat.setOutputPath(job, new Path(args[1]);\n\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n\n```\n\nè‡ªå·±è¿è¡Œä¸€ä¸‹ï¼Œä¸ç„¶ä¸‹é¢æ‰“åŒ…ç¨‹åºå‡ºç°ä¸äº†ï¼Œè¿è¡ŒæŠ¥é”™åˆ«ç®¡ï¼Œè¿è¡Œå°±å¯¹äº†ï¼Œåˆ«é—®\n\nè‡ªå·±è¿è¡Œä¸€ä¸‹ï¼Œä¸ç„¶ä¸‹é¢æ‰“åŒ…ç¨‹åºå‡ºç°ä¸äº†ï¼Œè¿è¡ŒæŠ¥é”™åˆ«ç®¡ï¼Œè¿è¡Œå°±å¯¹äº†ï¼Œåˆ«é—®\n\nè‡ªå·±è¿è¡Œä¸€ä¸‹ï¼Œä¸ç„¶ä¸‹é¢æ‰“åŒ…ç¨‹åºå‡ºç°ä¸äº†ï¼Œè¿è¡ŒæŠ¥é”™åˆ«ç®¡ï¼Œè¿è¡Œå°±å¯¹äº†ï¼Œåˆ«é—®\n\nè‡ªå·±è¿è¡Œä¸€ä¸‹ï¼Œä¸ç„¶ä¸‹é¢æ‰“åŒ…ç¨‹åºå‡ºç°ä¸äº†ï¼Œè¿è¡ŒæŠ¥é”™åˆ«ç®¡ï¼Œè¿è¡Œå°±å¯¹äº†ï¼Œåˆ«é—®\n\n==æ‰“åŒ…é¡¹ç›®==\n\nè¿™æ˜¯æ‰“åŒ…javaé¡¹ç›®çš„è·¯å¾„æ•™ç¨‹ï¼Œè‡ªå·±çœ‹ï¼Œåé¢è¿˜ä¼šæœ‰å„ç§javaè¦æ‰“åŒ…ï¼Œåé¢ä¸ä¼šå†è¯´äº†\n\n![image-20250508152109370](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/248cd9a79f38735b1cd8594baf84d9d555933597-1746692007782-527-1747299497351-152-1747900721330-153-1749470495098-153.png)\n\n![image-20250508144848815](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/6097eb929713ca7dc7077f72409911b455933597-1746692007782-533-1747299497352-157-1747900721330-158-1749470495098-157.png)\n\nä¸€è·¯ok\n\n```\nhadoop jar /usr/local/hadoop/myapp/AverageCalculator.jar input output\nhadoop dfs -cat output/*\n```\n\n![image-20250508145036243](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/88ceb627c2201a1dbb32a8372e649e6355933597-1746692007782-534-1747299497352-158-1747900721330-157-1749470495098-160.png)\n\n> è¿™ä¸ªæ˜¯ç¬¬å››é¢˜çš„å›¾ç‰‡\n\n\n\n\n\n==ç¬¬å…«é¢˜å’Œç¬¬ä¹é¢˜==\n\n```\ncat > maxmin.txt <<\"EOF\"\n23\n45\n12\n67\n89\n34\n56\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put maxmin.txt input\n```\n\nåˆ›å»º`MaxMinValue.java`\n\n```java\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\n\npublic class MaxMinValue {\n\n    public static class MaxMinMapper extends Mapper<LongWritable, Text, Text, IntWritable> {\n        private IntWritable valueOut = new IntWritable();\n\n        @Override\n        protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n            int num = Integer.parseInt(value.toString());\n            valueOut.set(num);\n            context.write(new Text(\"max\"), valueOut);\n            context.write(new Text(\"min\"), valueOut);\n        }\n    }\n\n    public static class MaxMinReducer extends Reducer<Text, IntWritable, Text, IntWritable> {\n        private IntWritable result = new IntWritable();\n\n        @Override\n        protected void reduce(Text key, Iterable<IntWritable> values, Context context)\n                throws IOException, InterruptedException {\n            int finalValue = key.toString().equals(\"max\") ? Integer.MIN_VALUE : Integer.MAX_VALUE;\n\n            for (IntWritable val : values) {\n                if (key.toString().equals(\"max\")) {\n                    finalValue = Math.max(finalValue, val.get());\n                } else if (key.toString().equals(\"min\")) {\n                    finalValue = Math.min(finalValue, val.get());\n                }\n            }\n\n            result.set(finalValue);\n            context.write(key, result);\n        }\n    }\n\n    public static void main(String[] args) throws Exception {\n        Configuration conf = new Configuration();\n        Job job = Job.getInstance(conf, \"Max and Min Values\");\n\n        job.setJarByClass(MaxMinValue.class);\n        job.setMapperClass(MaxMinMapper.class);\n        job.setReducerClass(MaxMinReducer.class);\n\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(IntWritable.class);\n\n        FileInputFormat.setInputPaths(job, new Path(args[0]);\n        FileOutputFormat.setOutputPath(job, new Path(args[1]);\n\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n\n```\n\nç„¶åè‡ªå·±`æ‰“åŒ…ç¨‹åº`ï¼Œä¸ä¼šå°±å»ç¿»å‰é¢ï¼Œå‰é¢æœ‰è¯´\n\n![image-20250508150606591](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b790a45036594ee7a01ec92264eae17455933597-1746692007782-535-1747299497352-159-1747900721330-159-1749470495098-159.png)\n\n```\nhadoop jar /usr/local/hadoop/myapp/MaxMinValue.jar input output\nhadoop dfs -cat output/*\n```\n\n![image-20250508150707867](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/e226581c924c43648f17a029be07dd7a55933597-1746692007782-536-1747299497352-160-1747900721330-160-1749470495098-161.png)\n\n> è¿™ä¸ªæ˜¯ç¬¬å…«é¢˜å’Œç¬¬ä¹é¢˜çš„å›¾ç‰‡\n\næ¥ä¸‹æ¥çš„åˆ›å»ºjavaæ‰“åŒ…ç¨‹åºä¸è¯´äº†ï¼Œè‡ªå·±ç¿»å‰é¢çš„\n\n\n\n\n\n==ç¬¬åé¢˜==\n\n```\ncat > SalesVolume.txt <<\"EOF\"\n2025-01-01 200\n2025-01-15 150\n2025-02-10 300\n2025-02-25 250\n2025-03-05 400\n2025-03-15 350\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put SalesVolume.txt input\n```\n\nåˆ›å»º`SalesByMonth.java`\n\n```java\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\n\npublic class SalesByMonth {\n\n    public static class SalesMapper extends Mapper<LongWritable, Text, Text, IntWritable> {\n        private Text month = new Text();\n        private IntWritable salesAmount = new IntWritable();\n\n        @Override\n        protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n            String[] parts = value.toString().split(\"\\\\s+\");\n            String date = parts[0];  // æ—¥æœŸæ ¼å¼ä¸º YYYY-MM-DD\n            int amount = Integer.parseInt(parts[1];  // é”€å”®é‡‘é¢\n\n            // æå–æœˆä»½ï¼ˆæ ¼å¼ä¸º YYYY-MMï¼‰\n            String yearMonth = date.substring(0, 7);\n            month.set(yearMonth);\n            salesAmount.set(amount);\n\n            context.write(month, salesAmount);\n        }\n    }\n\n    public static class SalesReducer extends Reducer<Text, IntWritable, Text, IntWritable> {\n        private IntWritable result = new IntWritable();\n\n        @Override\n        protected void reduce(Text key, Iterable<IntWritable> values, Context context)\n                throws IOException, InterruptedException {\n            int totalSales = 0;\n\n            for (IntWritable val : values) {\n                totalSales += val.get();\n            }\n\n            result.set(totalSales);\n            context.write(key, result);\n        }\n    }\n\n    public static void main(String[] args) throws Exception {\n        Configuration conf = new Configuration();\n        Job job = Job.getInstance(conf, \"Sales by Month\");\n\n        job.setJarByClass(SalesByMonth.class);\n        job.setMapperClass(SalesMapper.class);\n        job.setReducerClass(SalesReducer.class);\n\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(IntWritable.class);\n\n        FileInputFormat.setInputPaths(job, new Path(args[0]);\n        FileOutputFormat.setOutputPath(job, new Path(args[1]);\n\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n\n```\n\nè‡ªå·±æ‰“åŒ…ç¨‹åºï¼Œç„¶åè¿è¡Œç¨‹åº\n\n```\nhadoop jar /usr/local/hadoop/myapp/SalesByMonth.jar input output\nhadoop dfs -cat output/*\n```\n\n![image-20250508151430701](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/b139c3b6ed2dd067a6205773a6886d8555933597-1746692007782-537-1747299497352-161-1747900721330-161-1749470495098-162.png)\n\n> è¿™æ˜¯ç¬¬åé¢˜çš„å›¾ç‰‡\n\n## å®éªŒå››\n\n### ç¬¬ä¸€é¢˜\n\n#### shell\n\n1ï¼ç¼–ç¨‹å®ç°æ–‡ä»¶åˆå¹¶å’Œå»é‡æ“ä½œ\n\n==shell==\n\nå¯¹äºä¸¤ä¸ªè¾“å…¥æ–‡ä»¶ï¼Œå³æ–‡ä»¶Aå’Œæ–‡ä»¶Bï¼Œè¯·ç¼–å†™MapReduceç¨‹åºï¼Œå¯¹ä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œå¹¶å‰”é™¤å…¶ä¸­é‡å¤çš„å†…å®¹ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„è¾“å‡ºæ–‡ä»¶Cã€‚ä¸‹é¢æ˜¯è¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶çš„ä¸€ä¸ªæ ·ä¾‹ï¼Œä»¥ä¾›å‚è€ƒã€‚\n\n```\ncat >a.txt<<\"EOF\"\n20150101    x\n20150102    y\n20150103    x\n20150104    y\n20150105    z\n20150106    x\nEOF\ncat >b.txt<<\"EOF\"\n20150101     y\n20150102     y\n20150103     x\n20150104     z\n20150105     y\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put a.txt input\nhdfs dfs -put b.txt input\n```\n\n![image-20250508155455652](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/ae79fafc4e921a8b98dc0a3ca1b7a7e155933597-1747299497352-162-1747900721330-162-1749470495098-163.png)\n\nåˆ›å»º`Merge.java`\n\n```java\n\nimport java.io.IOException;\nimport java.util.StringTokenizer;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class Merge {\n\n    /**\n     * å¯¹A,Bä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œå¹¶å‰”é™¤å…¶ä¸­é‡å¤çš„å†…å®¹ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„è¾“å‡ºæ–‡ä»¶C\n     */\n\n    // Mapper: æ¸…ç†æ¯è¡Œå¤šä½™çš„ç©ºç™½ï¼Œå¹¶ä½œä¸º key è¾“å‡º\n    public static class Map extends Mapper<Object, Text, Text, Text> {\n        private Text outKey = new Text();\n\n        public void map(Object key, Text value, Context context) throws IOException, InterruptedException {\n            String line = value.toString().trim(); // å»é™¤é¦–å°¾ç©ºæ ¼\n            StringTokenizer tokenizer = new StringTokenizer(line);\n            StringBuilder sb = new StringBuilder();\n            while (tokenizer.hasMoreTokens()) {\n                sb.append(tokenizer.nextToken()).append(\" \"); // ç”¨å•ç©ºæ ¼è¿æ¥\n            }\n            if (sb.length() > 0) sb.setLength(sb.length() - 1); // å»æ‰æœ€åä¸€ä¸ªç©ºæ ¼\n            outKey.set(sb.toString());\n            context.write(outKey, new Text(\"\"));\n        }\n    }\n\n    // Reducer: æ¯ä¸ª key å†™å‡ºä¸€æ¬¡ï¼Œè¾¾åˆ°å»é‡ç›®çš„\n    public static class Reduce extends Reducer<Text, Text, Text, Text> {\n        public void reduce(Text key, Iterable<Text> values, Context context) throws IOException, InterruptedException {\n            context.write(key, new Text(\"\"));\n        }\n    }\n\n    public static void main(String[] args) throws Exception {\n        Configuration conf = new Configuration();\n        conf.set(\"fs.default.name\", \"hdfs://localhost:9000\");\n\n        String[] otherArgs = new String[]{\"input\", \"output\"};\n        if (otherArgs.length != 2) {\n            System.err.println(\"Usage: Merge <in> <out>\");\n            System.exit(2);\n        }\n\n        Job job = Job.getInstance(conf, \"Merge and Deduplicate\");\n        job.setJarByClass(Merge.class);\n        job.setMapperClass(Map.class);\n        job.setCombinerClass(Reduce.class);\n        job.setReducerClass(Reduce.class);\n\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(Text.class);\n\n        FileInputFormat.addInputPath(job, new Path(otherArgs[0]);\n        FileOutputFormat.setOutputPath(job, new Path(otherArgs[1]);\n\n        // å¼ºåˆ¶ä½¿ç”¨ä¸€ä¸ª reducerï¼Œç¡®ä¿å…¨å±€å»é‡\n        job.setNumReduceTasks(1);\n\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n```\n\næ‰“åŒ…ç¨‹åºï¼Œç„¶åè¿è¡Œ\n\n```\nhadoop jar /usr/local/hadoop/myapp/Merge.jar input output\nhadoop dfs -cat output/*\n```\n\n![image-20250508160448250](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/90c8bbd767dd5de11bd41dc9d22bd7bc55933597-1747299497352-163-1747900721330-163-1749470495098-165.png)\n\n#### java\n\n==java==\n\nå¯¼å…¥hdfsåŒ…\n\n![image-20250515163900774](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250515163900774-1747900721330-164-1749470495098-164.png)\n\n![image-20250515163913862](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250515163913862-1747900721330-165-1749470495099-166.png)\n\n`/usr/local/hadoop/share/hadoop/yarn/lib`ä¸‹çš„`æ‰€æœ‰jaråŒ…`\n\n`/usr/local/hadoop/share/hadoop/yarn`ä¸‹çš„`æ‰€æœ‰jaråŒ…`\n\n`/usr/local/hadoop/share/hadoop/hdfs`ä¸‹çš„è¿™ä¸¤ä¸ªåŒ…ä¹Ÿè¦æ·»åŠ \n\n![image-20250517182949447](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/1265942a61b2a35512e94d2e86d7b6f7697559838-1747900721330-166-1749470495099-167.png)\n\næµ‹è¯•æ–‡ä»¶\n\n```\ncat >a.txt<<\"EOF\"\n20150101    x\n20150102    y\n20150103    x\n20150104    y\n20150105    z\n20150106    x\nEOF\ncat >b.txt<<\"EOF\"\n20150101     y\n20150102     y\n20150103     x\n20150104     z\n20150105     y\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put a.txt input\nhdfs dfs -put b.txt input\n```\n\næ›´æ–°`Merge.java`ä»£ç \n\n```java\nimport java.io.IOException;\nimport java.util.StringTokenizer;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class Merge {\n\n    /**\n     * å¯¹A,Bä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œå¹¶å‰”é™¤å…¶ä¸­é‡å¤çš„å†…å®¹ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„è¾“å‡ºæ–‡ä»¶C\n     */\n\n    // Mapper: æ¸…ç†æ¯è¡Œå¤šä½™çš„ç©ºç™½ï¼Œå¹¶ä½œä¸º key è¾“å‡º\n    public static class Map extends Mapper<Object, Text, Text, Text> {\n        private Text outKey = new Text();\n\n        public void map(Object key, Text value, Context context) throws IOException, InterruptedException {\n            String line = value.toString().trim(); // å»é™¤é¦–å°¾ç©ºæ ¼\n            StringTokenizer tokenizer = new StringTokenizer(line);\n            StringBuilder sb = new StringBuilder();\n            while (tokenizer.hasMoreTokens()) {\n                sb.append(tokenizer.nextToken()).append(\" \"); // ç”¨å•ç©ºæ ¼è¿æ¥\n            }\n            if (sb.length() > 0) sb.setLength(sb.length() - 1); // å»æ‰æœ€åä¸€ä¸ªç©ºæ ¼\n            outKey.set(sb.toString());\n            context.write(outKey, new Text(\"\"));\n        }\n    }\n\n    // Reducer: æ¯ä¸ª key å†™å‡ºä¸€æ¬¡ï¼Œè¾¾åˆ°å»é‡ç›®çš„\n    public static class Reduce extends Reducer<Text, Text, Text, Text> {\n        public void reduce(Text key, Iterable<Text> values, Context context) throws IOException, InterruptedException {\n            context.write(key, new Text(\"\"));\n        }\n    }\n\n    public static void main(String[] args) throws Exception {\n        Configuration conf = new Configuration();\n        conf.set(\"fs.default.name\", \"hdfs://localhost:9000\");\n\n        // å†™æ­»è¾“å…¥è¾“å‡ºè·¯å¾„\n        String inputPath = \"hdfs://localhost:9000/user/hadoop/input\";\n        String outputPath = \"hdfs://localhost:9000/user/hadoop/output\";\n\n        Job job = Job.getInstance(conf, \"Merge and Deduplicate\");\n        job.setJarByClass(Merge.class);\n        job.setMapperClass(Map.class);\n        job.setCombinerClass(Reduce.class);\n        job.setReducerClass(Reduce.class);\n\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(Text.class);\n\n        FileInputFormat.addInputPath(job, new Path(inputPath));\n        FileOutputFormat.setOutputPath(job, new Path(outputPath));\n\n        // å¼ºåˆ¶ä½¿ç”¨ä¸€ä¸ª reducerï¼Œç¡®ä¿å…¨å±€å»é‡\n        job.setNumReduceTasks(1);\n\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n```\n\n![image-20250515164951693](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250515164951693-1747900721330-167-1749470495099-168.png)\n\næŸ¥çœ‹ç»“æœ\n\n```\nhadoop dfs -cat output/*\n```\n\n![image-20250515165032947](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250515165032947-1747900721330-168-1749470495099-169.png)\n\n### ç¬¬äºŒé¢˜\n\n#### shell\n\n2ï¼ç¼–ç¨‹å®ç°å¯¹è¾“å…¥æ–‡ä»¶çš„æ’åº\n\nç°åœ¨æœ‰å¤šä¸ªè¾“å…¥æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­çš„æ¯è¡Œå†…å®¹å‡ä¸ºä¸€ä¸ªæ•´æ•°ã€‚è¦æ±‚è¯»å–æ‰€æœ‰æ–‡ä»¶ä¸­çš„æ•´æ•°ï¼Œè¿›è¡Œå‡åºæ’åˆ—åï¼Œå°†å…¶è¾“å‡ºåˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ï¼Œè¾“å‡ºçš„æ•°æ®æ ¼å¼ä¸ºæ¯è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œç¬¬ä¸€ä¸ªæ•´æ•°ä¸ºç¬¬äºŒä¸ªæ•´æ•°çš„æ’åºä½æ¬¡ï¼Œç¬¬äºŒä¸ªæ•´æ•°ä¸ºåŸå¾…æ’åˆ—çš„æ•´æ•°ã€‚ä¸‹é¢æ˜¯è¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶çš„ä¸€ä¸ªæ ·ä¾‹ï¼Œä»¥ä¾›å‚è€ƒã€‚\n\n==shell==\n\n```\ncat >a.txt<<\"EOF\"\n33\n37\n12\n40\nEOF\ncat >b.txt<<\"EOF\"\n4\n16\n39\n5\nEOF\ncat >c.txt<<\"EOF\"\n1\n45\n25\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put a.txt input\nhdfs dfs -put b.txt input\nhdfs dfs -put c.txt input\n```\n\nåˆ›å»º`MergeSort.java`\n\n```java\nimport java.io.IOException;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Partitioner;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\nimport org.apache.hadoop.util.GenericOptionsParser;\npublic class MergeSort {\n    /**\n     * @param args\n     * è¾“å…¥å¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­çš„æ¯è¡Œå†…å®¹å‡ä¸ºä¸€ä¸ªæ•´æ•°\n     * è¾“å‡ºåˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ï¼Œè¾“å‡ºçš„æ•°æ®æ ¼å¼ä¸ºæ¯è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œç¬¬ä¸€ä¸ªæ•°å­—ä¸ºç¬¬äºŒä¸ªæ•´æ•°çš„æ’åºä½æ¬¡ï¼Œç¬¬äºŒä¸ªæ•´æ•°ä¸ºåŸå¾…æ’åˆ—çš„æ•´æ•°\n     */\n    //mapå‡½æ•°è¯»å–è¾“å…¥ä¸­çš„valueï¼Œå°†å…¶è½¬åŒ–æˆIntWritableç±»å‹ï¼Œæœ€åä½œä¸ºè¾“å‡ºkey\n    public static class Map extends Mapper<Object, Text, IntWritable, IntWritable>{\n        private static IntWritable data = new IntWritable();\n        public void map(Object key, Text value, Context context) throws IOException,InterruptedException{\n            String text = value.toString();\n            data.set(Integer.parseInt(text));\n            context.write(data, new IntWritable(1));\n        }\n    }\n    //reduceå‡½æ•°å°†mapè¾“å…¥çš„keyå¤åˆ¶åˆ°è¾“å‡ºçš„valueä¸Šï¼Œç„¶åæ ¹æ®è¾“å…¥çš„value-listä¸­å…ƒç´ çš„ä¸ªæ•°å†³å®škeyçš„è¾“å‡ºæ¬¡æ•°,å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡line_numæ¥ä»£è¡¨keyçš„ä½æ¬¡\n    public static class Reduce extends Reducer<IntWritable, IntWritable, IntWritable,  IntWritable>{\n        private static IntWritable line_num = new IntWritable(1);       \n        public void reduce(IntWritable key, Iterable<IntWritable> values, Context  context) throws IOException,InterruptedException{\n            for(IntWritable val : values){ \n                context.write(line_num, key);\n                line_num = new IntWritable(line_num.get() + 1);\n            }\n        }\n    }\n    //è‡ªå®šä¹‰Partitionå‡½æ•°ï¼Œæ­¤å‡½æ•°æ ¹æ®è¾“å…¥æ•°æ®çš„æœ€å¤§å€¼å’ŒMapReduceæ¡†æ¶ä¸­Partitionçš„æ•°é‡è·å–å°†è¾“å…¥æ•°æ®æŒ‰ç…§å¤§å°åˆ†å—çš„è¾¹ç•Œï¼Œç„¶åæ ¹æ®è¾“å…¥æ•°å€¼å’Œè¾¹ç•Œçš„å…³ç³»è¿”å›å¯¹åº”çš„Partiton ID\n    public static class Partition extends Partitioner<IntWritable, IntWritable>{\n        public int getPartition(IntWritable key, IntWritable value, int num_Partition){\n            int Maxnumber = 65223;//intå‹çš„æœ€å¤§æ•°å€¼\n            int bound = Maxnumber/num_Partition+1;\n            int keynumber = key.get();\n            for (int i = 0; i<num_Partition; i++){\n                if(keynumber<bound * (i+1) && keynumber>=bound * i){ \n                   return i;\n                }\n            }\n            return -1;\n        }\n    }\n    public static  void main(String[] args) throws Exception{ \n        // TODO  Auto-generated method stub\n        Configuration  conf = new Configuration();\n               conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n        String[] otherArgs = new String[]{\"input\",\"output\"}; /* ç›´æ¥è®¾ç½®è¾“å…¥å‚æ•° */\n        if (otherArgs.length != 2) {\n            System.err.println(\"Usage: wordcount <in><out>\");\n            System.exit(2);\n            }\n               Job job = Job.getInstance(conf,\"Merge and sort\");\n        job.setJarByClass(MergeSort.class);\n        job.setMapperClass(Map.class); \n        job.setReducerClass(Reduce.class);\n        job.setPartitionerClass(Partition.class);\n        job.setOutputKeyClass(IntWritable.class); \n        job.setOutputValueClass(IntWritable.class); \n        FileInputFormat.addInputPath(job, new Path(otherArgs[0]);\n        FileOutputFormat.setOutputPath(job, new Path(otherArgs[1]);\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n\n```\n\nè‡ªå·±æ‰“åŒ…é¡¹ç›®\n\n```\nhadoop jar /usr/local/hadoop/myapp/MergeSort.jar input output\nhadoop dfs -cat output/*\n```\n\n![image-20250508160625143](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/7564f49802db8df0e5e5de4a1c96222c55933597-1747299497352-164-1747900721330-169-1749470495099-171.png)\n\n#### java\n\n==java==\n\nå†™å…¥æµ‹è¯•æ–‡ä»¶\n\n```\ncat >a.txt<<\"EOF\"\n33\n37\n12\n40\nEOF\ncat >b.txt<<\"EOF\"\n4\n16\n39\n5\nEOF\ncat >c.txt<<\"EOF\"\n1\n45\n25\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put a.txt input\nhdfs dfs -put b.txt input\nhdfs dfs -put c.txt input\n```\n\næ›´æ–°ä»£ç \n\n`MergeSort.java`\n\n```java\nimport java.io.IOException;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Partitioner;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class MergeSort {\n\n    /**\n     * @param args\n     * è¾“å…¥å¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­çš„æ¯è¡Œå†…å®¹å‡ä¸ºä¸€ä¸ªæ•´æ•°\n     * è¾“å‡ºåˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ï¼Œè¾“å‡ºçš„æ•°æ®æ ¼å¼ä¸ºæ¯è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œ\n     * ç¬¬ä¸€ä¸ªæ•°å­—ä¸ºç¬¬äºŒä¸ªæ•´æ•°çš„æ’åºä½æ¬¡ï¼ˆä»1å¼€å§‹ï¼‰ï¼Œç¬¬äºŒä¸ªæ•´æ•°ä¸ºåŸå¾…æ’åˆ—çš„æ•´æ•°\n     */\n\n    // Mapperï¼šè¯»å–æ¯è¡Œæ•´æ•°ï¼Œä½œä¸º key è¾“å‡º\n    public static class Map extends Mapper<Object, Text, IntWritable, IntWritable> {\n        private static final IntWritable data = new IntWritable();\n\n        public void map(Object key, Text value, Context context) throws IOException, InterruptedException {\n            String text = value.toString().trim();\n            if (!text.isEmpty()) {\n                data.set(Integer.parseInt(text));\n                context.write(data, new IntWritable(1));\n            }\n        }\n    }\n\n    // Reducerï¼šæ ¹æ® key çš„é¡ºåºè¾“å‡ºæ’åå’Œå¯¹åº”çš„æ•´æ•°\n    public static class Reduce extends Reducer<IntWritable, IntWritable, IntWritable, IntWritable> {\n        private static IntWritable line_num = new IntWritable(1);\n\n        public void reduce(IntWritable key, Iterable<IntWritable> values, Context context)\n                throws IOException, InterruptedException {\n            for (IntWritable val : values) {\n                context.write(line_num, key);\n                line_num = new IntWritable(line_num.get() + 1);\n            }\n        }\n    }\n\n    // è‡ªå®šä¹‰ Partitionerï¼šæŒ‰æ•°å€¼å¤§å°åˆ†å—ï¼Œæå‡å¹¶è¡Œæ•ˆç‡\n    public static class Partition extends Partitioner<IntWritable, IntWritable> {\n        public int getPartition(IntWritable key, IntWritable value, int num_Partition) {\n            int Maxnumber = 65223; // å¯ä»¥æ ¹æ®æ•°æ®èŒƒå›´è°ƒæ•´\n            int bound = Maxnumber / num_Partition + 1;\n            int keynumber = key.get();\n            for (int i = 0; i < num_Partition; i++) {\n                if (keynumber < bound * (i + 1) && keynumber >= bound * i) {\n                    return i;\n                }\n            }\n            return -1;\n        }\n    }\n\n    public static void main(String[] args) throws Exception {\n        Configuration conf = new Configuration();\n\n        // è®¾ç½®æ–°çš„ fs.defaultFSï¼Œå¹¶è®¾ç½®æœ¬åœ°æ‰§è¡Œæ¨¡å¼\n        conf.set(\"fs.defaultFS\", \"hdfs://localhost:9000\");\n        conf.set(\"mapreduce.framework.name\", \"local\");\n        conf.set(\"mapreduce.jobtracker.address\", \"local\");\n\n        // å†™æ­»è¾“å…¥è¾“å‡ºè·¯å¾„\n        String inputPath = \"hdfs://localhost:9000/user/hadoop/input\";\n        String outputPath = \"hdfs://localhost:9000/user/hadoop/output\";\n\n        Job job = Job.getInstance(conf, \"Merge and Sort\");\n        job.setJarByClass(MergeSort.class);\n        job.setMapperClass(Map.class);\n        job.setReducerClass(Reduce.class);\n        job.setPartitionerClass(Partition.class);\n\n        job.setOutputKeyClass(IntWritable.class);\n        job.setOutputValueClass(IntWritable.class);\n\n        FileInputFormat.addInputPath(job, new Path(inputPath));\n        FileOutputFormat.setOutputPath(job, new Path(outputPath));\n\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n```\n\n![image-20250515165402525](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250515165402525-1747900721330-170-1749470495099-170.png)\n\n```\nhadoop dfs -cat output/*\n```\n\n![image-20250515165432143](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250515165432143-1747900721330-171-1749470495099-172.png)\n\n### ç¬¬ä¸‰é¢˜\n\n#### shell\n\n3ï¼å¯¹ç»™å®šçš„è¡¨æ ¼è¿›è¡Œä¿¡æ¯æŒ–æ˜\n\nä¸‹é¢ç»™å‡ºä¸€ä¸ªchild-parentçš„è¡¨æ ¼ï¼Œè¦æ±‚æŒ–æ˜å…¶ä¸­çš„çˆ¶å­å…³ç³»ï¼Œç»™å‡ºç¥–å­™å…³ç³»çš„è¡¨æ ¼ã€‚\n\n```\ncat >a.txt<<\"EOF\"\nchild parent\nSteven Lucy\nSteven Jack\nJone Lucy\nJone Jack\nLucy Mary\nLucy Frank\nJack Alice\nJack Jesse\nDavid Alice\nDavid Jesse\nPhilip David\nPhilip Alma\nMark David\nMark Alma\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put a.txt input\n```\n\nåˆ›å»º`simple_data_mining.java`\n\n```java\nimport java.io.IOException;\nimport java.util.*;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\nimport org.apache.hadoop.util.GenericOptionsParser;\npublic class simple_data_mining { \n    public static int time = 0;\n    /**\n     * @param args \n     * è¾“å…¥ä¸€ä¸ªchild-parentçš„è¡¨æ ¼\n     * è¾“å‡ºä¸€ä¸ªä½“ç°grandchild-grandparentå…³ç³»çš„è¡¨æ ¼\n     */\n    //Mapå°†è¾“å…¥æ–‡ä»¶æŒ‰ç…§ç©ºæ ¼åˆ†å‰²æˆchildå’Œparentï¼Œç„¶åæ­£åºè¾“å‡ºä¸€æ¬¡ä½œä¸ºå³è¡¨ï¼Œååºè¾“å‡ºä¸€æ¬¡ä½œä¸ºå·¦è¡¨ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¾“å‡ºçš„valueä¸­å¿…é¡»åŠ ä¸Šå·¦å³è¡¨åŒºåˆ«æ ‡å¿—\n    public static class Map extends Mapper<Object, Text, Text, Text>{\n        public void map(Object key, Text value, Context context) throws IOException,InterruptedException{\n            String child_name = new String();\n            String parent_name = new String();\n            String relation_type = new String();\n            String line = value.toString();\n            int i = 0;\n            while(line.charAt(i)!= ' '){\n                i++;\n            }\n            String[] values = {line.substring(0,i),line.substring(i+1)}; \n            if(values[0].compareTo(\"child\")!= 0){\n                child_name = values[0];\n                parent_name = values[1];\n                relation_type = \"1\";//å·¦å³è¡¨åŒºåˆ†æ ‡å¿—\n                context.write(new Text(values[1], new Text(relation_type+\"+\"+child_name+\"+\"+parent_name));\n                //å·¦è¡¨\n                relation_type = \"2\";\n                context.write(new Text(values[0], new Text(relation_type+\"+\"+child_name+\"+\"+parent_name));\n                //å³è¡¨\n            }\n        }\n    }\n    public static class Reduce extends Reducer<Text, Text, Text, Text>{\n        public void reduce(Text key, Iterable<Text> values,Context context) throws IOException,InterruptedException{\n            if(time == 0){   //è¾“å‡ºè¡¨å¤´\n                context.write(new Text(\"grand_child\"), new Text(\"grand_parent\"));\n                time++;\n            }\n            int grand_child_num = 0; \n            String grand_child[] = new String[10];\n            int grand_parent_num = 0;\n            String grand_parent[]= new String[10];\n            Iterator ite = values.iterator();\n            while(ite.hasNext()){\n                String record = ite.next().toString();\n                int len = record.length();\n                int i = 2;\n                if(len == 0) continue;\n                char relation_type = record.charAt(0);\n                String child_name = new String();\n                String parent_name = new String();\n                //è·å–value-listä¸­valueçš„child\n                while(record.charAt(i)!= '+'){\n                   child_name = child_name + record.charAt(i);\n                   i++;\n                }\n                i=i+1;\n                //è·å–value-listä¸­valueçš„parent\n                while(i<len){\n                   parent_name = parent_name+record.charAt(i);\n                   i++;\n                } \n                //å·¦è¡¨ï¼Œå–å‡ºchildæ”¾å…¥grand_child\n                if(relation_type  == '1'){\n                   grand_child[grand_child_num]  = child_name; \n                   grand_child_num++;\n                }\n                else{//å³è¡¨ï¼Œå–å‡ºparentæ”¾å…¥grand_parent\n                   grand_parent[grand_parent_num]  = parent_name;\n                   grand_parent_num++;\n                }\n            } \n            if(grand_parent_num != 0 && grand_child_num != 0 ){\n                for(int m = 0;m<grand_child_num;m++){\n                  for(int n=0;n<grand_parent_num;n++){\n                                                                        context.write(new  Text(grand_child[m], new Text(grand_parent[n]);\n                       //è¾“å‡ºç»“æœ\n                   }\n                } \n            }\n        } \n    }\n    public static void main(String[] args) throws Exception{\n        //  TODO Auto-generated method stub \n        Configuration conf = new Configuration();\n               conf.set(\"fs.default.name\",\"hdfs://localhost:9000\");\n        String[] otherArgs = new String[]{\"input\",\"output\"}; /* ç›´æ¥è®¾ç½®è¾“å…¥å‚æ•° */\n        if (otherArgs.length != 2) {\n            System.err.println(\"Usage: wordcount <in><out>\");\n            System.exit(2);\n            }\n               Job job =  Job.getInstance(conf,\"Single table join\");\n        job.setJarByClass(simple_data_mining.class);\n        job.setMapperClass(Map.class); \n        job.setReducerClass(Reduce.class); \n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(Text.class);\n        FileInputFormat.addInputPath(job, new Path(otherArgs[0]);\n        FileOutputFormat.setOutputPath(job, new Path(otherArgs[1]);\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n\n```\n\nè‡ªå·±æ‰“åŒ…æ–‡ä»¶\n\n```\nhadoop jar /usr/local/hadoop/myapp/simple_data_mining.jar input output\nhadoop dfs -cat output/*\n```\n\n![image-20250508160923581](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/a1126764960165978203787b9ae638c355933597-1747299497352-165-1747900721330-172-1749470495099-173.png)\n\n#### java\n\n==java==\n\næ›´æ–°æµ‹è¯•æ–‡ä»¶\n\n```\ncat >a.txt<<\"EOF\"\nchild parent\nSteven Lucy\nSteven Jack\nJone Lucy\nJone Jack\nLucy Mary\nLucy Frank\nJack Alice\nJack Jesse\nDavid Alice\nDavid Jesse\nPhilip David\nPhilip Alma\nMark David\nMark Alma\nEOF\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nhdfs dfs -put a.txt input\n```\n\næ›´æ–°`simple_data_mining.java`\n\n```java\nimport java.io.IOException;\nimport java.util.*;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class simple_data_mining {\n\n    public static int time = 0; // æ§åˆ¶è¡¨å¤´åªè¾“å‡ºä¸€æ¬¡\n\n    /**\n     * è¾“å…¥ï¼šæ¯è¡Œä¸¤ä¸ªå­—æ®µ child parent\n     * è¾“å‡ºï¼šgrand_child grand_parent\n     */\n\n    // Mapperï¼šå°†æ¯æ¡è®°å½•æ­£åºå’Œé€†åºåˆ†åˆ«è¾“å‡ºï¼Œæ ‡è¯†å·¦è¡¨å’Œå³è¡¨\n    public static class Map extends Mapper<Object, Text, Text, Text> {\n        public void map(Object key, Text value, Context context) throws IOException, InterruptedException {\n            String line = value.toString().trim();\n            if (line.isEmpty() || line.startsWith(\"child\")) return;\n\n            String[] parts = line.split(\"\\\\s+\");\n            if (parts.length < 2) return;\n\n            String child = parts[0];\n            String parent = parts[1];\n\n            // å·¦è¡¨è¾“å‡ºï¼šparent -> left+child+parent\n            context.write(new Text(parent), new Text(\"1+\" + child + \"+\" + parent));\n            // å³è¡¨è¾“å‡ºï¼šchild -> right+child+parent\n            context.write(new Text(child), new Text(\"2+\" + child + \"+\" + parent));\n        }\n    }\n\n    // Reducerï¼šå°†åŒä¸€keyä¸‹çš„å·¦å³è¡¨æ•°æ®ç»„åˆï¼Œæ‰¾å‡ºæ‰€æœ‰ç¥–å­™å…³ç³»\n    public static class Reduce extends Reducer<Text, Text, Text, Text> {\n        public void reduce(Text key, Iterable<Text> values, Context context)\n                throws IOException, InterruptedException {\n\n            List<String> leftList = new ArrayList<>();\n            List<String> rightList = new ArrayList<>();\n\n            for (Text val : values) {\n                String record = val.toString();\n                if (record.isEmpty()) continue;\n\n                char relationType = record.charAt(0);\n                String[] fields = record.substring(2).split(\"\\\\+\");\n                if (fields.length < 2) continue;\n\n                String child = fields[0];\n                String parent = fields[1];\n\n                if (relationType == '1') {\n                    leftList.add(child); // å·¦è¡¨ï¼šchild æ˜¯å­™å­\n                } else {\n                    rightList.add(parent); // å³è¡¨ï¼šparent æ˜¯ç¥–çˆ¶\n                }\n            }\n\n            // è¾“å‡ºæ‰€æœ‰å¯èƒ½çš„ç¥–å­™ç»„åˆ\n            if (time == 0) {\n                context.write(new Text(\"grand_child\"), new Text(\"grand_parent\"));\n                time++;\n            }\n\n            for (String lc : leftList) {\n                for (String rp : rightList) {\n                    context.write(new Text(lc), new Text(rp));\n                }\n            }\n        }\n    }\n\n    public static void main(String[] args) throws Exception {\n        Configuration conf = new Configuration();\n\n        // è®¾ç½®æ–°çš„ fs.defaultFSï¼Œå¹¶è®¾ç½®æœ¬åœ°æ‰§è¡Œæ¨¡å¼\n        conf.set(\"fs.defaultFS\", \"hdfs://localhost:9000\");\n        conf.set(\"mapreduce.framework.name\", \"local\");\n        conf.set(\"mapreduce.jobtracker.address\", \"local\");\n\n        // å†™æ­»è¾“å…¥è¾“å‡ºè·¯å¾„\n        String inputPath = \"hdfs://localhost:9000/user/hadoop/input\";\n        String outputPath = \"hdfs://localhost:9000/user/hadoop/output\";\n\n        Job job = Job.getInstance(conf, \"Simple Data Mining - Grandchild to Grandparent\");\n        job.setJarByClass(simple_data_mining.class);\n\n        job.setMapperClass(Map.class);\n        job.setReducerClass(Reduce.class);\n\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(Text.class);\n\n        FileInputFormat.addInputPath(job, new Path(inputPath));\n        FileOutputFormat.setOutputPath(job, new Path(outputPath));\n\n        System.exit(job.waitForCompletion(true) ? 0 : 1);\n    }\n}\n```\n\n![image-20250515165610418](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250515165610418-1747900721330-173-1749470495099-174.png)\n\n```\nhadoop dfs -cat output/*\n```\n\n![image-20250515165632038](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250515165632038-1747900721330-174-1749470495099-175.png)\n\n\n\n## Hive\n\n![image-20250522140819106](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522140819106-1749470495099-176.png)\n\nå°±åœ¨ä¸‹è½½é¡µé¢ç©ºç™½å¤„ï¼Œå³é”®æ‰“å¼€ç»ˆç«¯\n\n```\nsudo ls\n```\n\n![image-20250522141330178](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522141330178-1749470495099-177.png)\n\n```bash\nsudo tar -xf apache-hive-3.1.3-bin.tar.gz\nsudo mv apache-hive-3.1.3-bin /usr/local/hive\necho \"export HIVE_HOME=/usr/local/hive\" >> ~/.bashrc\necho \"export PATH=\\$HIVE_HOME/bin:\\$PATH\" >> ~/.bashrc\nsource ~/.bashrc\nsudo tee /usr/local/hive/conf/hive-site.xml > /dev/null <<'EOF'\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?>\n<configuration>\n  <property>\n    <name>javax.jdo.option.ConnectionURL</name>\n    <value>jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true&amp;useSSL=false</value>\n    <description>JDBC connect string for a JDBC metastore</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionDriverName</name>\n    <value>com.mysql.jdbc.Driver</value>\n    <description>Driver class name for a JDBC metastore</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionUserName</name>\n    <value>hive</value>\n    <description>username to use against metastore database</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionPassword</name>\n    <value>hive</value>\n    <description>password to use against metastore database</description>\n  </property>\n  <property>\n    <name>hive.exec.mode.local.auto</name>\n    <value>true</value>\n  </property>\n</configuration>\nEOF\nsudo mv mysql-connector-java-5.1.46.tar{\\(2\\).gz,.gz}\nsudo tar -xf mysql-connector-java-5.1.46*.tar.gz\n\nsudo mv mysql-connector-java-5.1.46/mysql-connector-java-5.1.46.jar /usr/local/hive/lib/\nsudo chown hadoop:hadoop /usr/local/hive/lib/mysql-connector-java-5.1.46.jar\nsudo chmod 644 /usr/local/hive/lib/mysql-connector-java-5.1.46.jar\n```\n\nå®‰è£…mysql\n\n```bash\nsudo apt remove mariadb* -y\n#ä¸Šé¢æŠ¥é”™ä¸ç”¨ç®¡\nsudo apt install -y net-tools wget mysql-server\nsudo systemctl enable --now mysql\n```\n\nè¿›å…¥mysqlåˆå§‹åŒ–\n\n```\nsudo mysql_secure_installation\n```\n\nä¸‹é¢å¼€å§‹è¦æ‰‹åŠ¨è¾“å…¥äº†ï¼Œè¾“å…¥yesæˆ–no\n\nä¸‹é¢å¼€å§‹è¦æ‰‹åŠ¨è¾“å…¥äº†ï¼Œè¾“å…¥yesæˆ–no\n\nä¸‹é¢å¼€å§‹è¦æ‰‹åŠ¨è¾“å…¥äº†ï¼Œè¾“å…¥yesæˆ–no\n\nä¸‹é¢å¼€å§‹è¦æ‰‹åŠ¨è¾“å…¥äº†ï¼Œè¾“å…¥yesæˆ–no\n\n```bash\n1. Press y|Y for Yes, any other key for No:   no\nPlease set the password for root here.\n\nNew password:                 è¾“å…¥å¯†ç 123456\nRe-enter new password:        è¾“å…¥å¯†ç 123456\n....\n\n2. Remove anonymous users?  :   yes\n....\n3.Disallow root login remotely?  : no\n....\n4.Remove test database and access to it?: yes\n ....\n5.Reload privilege tables now? : yes\n```\n\nç™»å…¥æ•°æ®åº“åºŠåˆ›å»ºç”¨æˆ·\n\n```\ncd\nsudo mysql -uroot -p123456\nUNINSTALL PLUGIN validate_password;\ncreate database hive;\ngrant all on *.* to hive@localhost identified by 'hive';\nflush privileges; \nexit\nsudo sed -i 's/^bind-address\\s*=\\s*127.0.0.1/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf\nsudo sed -i 's/^mysqlx-bind-address\\s*=\\s*127.0.0.1/mysqlx-bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf\nsudo systemctl restart mysql\n\n```\n\n![image-20250522144324814](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522144324814-1749470495099-178.png)\n\n\n\nå‡çº§å…ƒæ•°æ®\n\n```\nsudo rm -rf /usr/local/hive/lib/guava*.jar\nsudo cp /usr/local/hadoop/share/hadoop/common/lib/guava-*.jar /usr/local/hive/lib/\nsudo cp /home/hadoop/ä¸‹è½½/mysql-connector-java-5.1.46.tar* /usr/local/hive/lib/\nsudo cp /home/hadoop/Downloads/mysql-connector-java-5.1.46.tar* /usr/local/hive/lib/\nstart-all.sh\n\n\n#hiveåˆå§‹åŒ–ï¼Œè¿™ä¸ªå‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡\nschematool -dbType mysql -initSchema\n```\n\n![image-20250522150929161](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522150929161-1749470495099-180.png)\n\nè¿™ä¸ªæ˜¯æˆåŠŸçš„æ„æ€\n\nå¯åŠ¨hiveï¼Œè¦å¯åŠ¨hadoop\n\n```\nhive\nshow databases;\nexit;\n```\n\n![image-20250522151212300](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522151212300-1749470495099-179.png)\n\nè¿™ä¸ªå›¾ç‰‡äº¤åˆ°9.9å»\n\n## å®éªŒäº”\n\n![image-20250522152320297](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522152320297-1749470495099-181.png)\n\nè‡ªå·±å¯åŠ¨hadoopï¼Œåœ¨ä¸‹è½½æ–‡ä»¶å¤¹ç©ºç™½å¤„å³é”®\n\n```\nsudo mv data ../\ncd\nls | grep data\n```\n\n![image-20250522152519618](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522152519618-1749470495099-182.png)\n\nå¯åŠ¨hive\n\n```\nhive\n```\n\nï¼ˆ1ï¼‰åˆ›å»ºå†…éƒ¨è¡¨ `stocks`\n\nè¡¨A-6 stocksè¡¨ç»“æ„\n\n| col_name        | data_type |\n| --------------- | --------- |\n| exchange        | string    |\n| symbol          | string    |\n| ymd             | string    |\n| price_open      | float     |\n| price_high      | float     |\n| price_low       | float     |\n| price_close     | float     |\n| volume          | int       |\n| price_adj_close | float     |\n\n\n\n```\ncreate table if not exists stocks\n(\n`exchange` string,\n`symbol` string,\n`ymd` string,\n`price_open` float,\n`price_high` float,\n`price_low` float,\n`price_close` float,\n`volume` int,\n`price_adj_close` float\n)\nrow format delimited fields terminated by ',';\n```\n\n![image-20250522152934167](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522152934167-1749470495099-183.png)\n\nï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªå¤–éƒ¨åˆ†åŒºè¡¨dividendsï¼ˆåˆ†åŒºå­—æ®µä¸ºexchangeå’Œsymbolï¼‰\n\n è¡¨A-7 dividendsè¡¨ç»“æ„\n\n| col_name | data_type |\n| -------- | --------- |\n| ymd      | string    |\n| dividend | float     |\n| exchange | string    |\n| symbol   | string    |\n\n```\ncreate external table if not exists dividends\n(\n`ymd` string,\n`dividend` float\n)\npartitioned by(`exchange` string ,`symbol` string)\nrow format delimited fields terminated by ',';\n```\n\n![image-20250522153028622](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522153028622-1749470495099-184.png)\n\nï¼ˆ3ï¼‰ä»stocks.csvæ–‡ä»¶å‘stocksè¡¨ä¸­å¯¼å…¥æ•°æ®ã€‚\n\n```\nload data local inpath '/home/hadoop/data/stocks/stocks.csv' overwrite into table stocks;\n```\n\n![image-20250522153255569](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522153255569-1749470495099-185.png)\n\nï¼ˆ4ï¼‰ åˆ›å»ºä¸€ä¸ªæœªåˆ†åŒºçš„å¤–éƒ¨è¡¨dividends_unpartitionedï¼Œå¹¶ä»dividends.csvå‘å…¶ä¸­å¯¼å…¥æ•°æ®ï¼Œè¡¨ç»“æ„å¦‚è¡¨A-8æ‰€ç¤ºã€‚\n\nâ€‹    è¡¨A-8 dividends_unpartitionedè¡¨ç»“æ„\n\n| col_name | data_type |\n| -------- | --------- |\n| ymd      | string    |\n| dividend | float     |\n| exchange | string    |\n| symbol   | string    |\n\n```\ncreate external table if not exists dividends_unpartitioned\n(\n`exchange` string ,\n`symbol` string,\n`ymd` string,\n`dividend` float\n)\nrow format delimited fields terminated by ',';\nload data local inpath '/home/hadoop/data/dividends/dividends.csv' overwrite into table dividends_unpartitioned;\n```\n\n![image-20250522153350030](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522153350030-1749470495099-186.png)\n\nï¼ˆ5ï¼‰é€šè¿‡å¯¹dividends_unpartitionedçš„æŸ¥è¯¢è¯­å¥ï¼Œåˆ©ç”¨Hiveè‡ªåŠ¨åˆ†åŒºç‰¹æ€§å‘åˆ†åŒºè¡¨dividendså„ä¸ªåˆ†åŒºä¸­æ’å…¥å¯¹åº”æ•°æ®ã€‚\n\n```\nset hive.exec.dynamic.partition=true;\nset hive.exec.dynamic.partition.mode=nonstrict;\nset hive.exec.max.dynamic.partitions.pernode=1000;\ninsert overwrite table dividends partition(`exchange`,`symbol`) select `ymd`,`dividend`,`exchange`,`symbol` from dividends_unpartitioned;\n```\n\nè¿è¡Œä¸€åˆ†é’Ÿï¼Œæœ‰ç‚¹æ…¢\n\n![image-20250522153604286](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522153604286-1749470495099-187.png)\n\nï¼ˆ6ï¼‰æŸ¥è¯¢IBMå…¬å¸(symbol=IBM)ä»2000å¹´èµ·æ‰€æœ‰æ”¯ä»˜è‚¡æ¯çš„äº¤æ˜“æ—¥(dividendsè¡¨ä¸­æœ‰å¯¹åº”è®°å½•)çš„æ”¶ç›˜ä»·(price_close)ã€‚\n\n```\nselect s.ymd,s.symbol,s.price_close\nfrom stocks s \nLEFT SEMI JOIN \ndividends d\nON s.ymd=d.ymd and s.symbol=d.symbol\nwhere s.symbol='IBM' and year(ymd)>=2000;\n```\n\n![image-20250522153702090](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522153702090-1749470495099-188.png)\n\nï¼ˆ7ï¼‰æŸ¥è¯¢è‹¹æœå…¬å¸(symbol=AAPL)2008å¹´10æœˆæ¯ä¸ªäº¤æ˜“æ—¥çš„æ¶¨è·Œæƒ…å†µï¼Œæ¶¨æ˜¾ç¤ºriseï¼Œè·Œæ˜¾ç¤ºfall,ä¸å˜æ˜¾ç¤ºunchangeã€‚\n\n```\nselect ymd,\ncase\n    when price_close-price_open>0 then 'rise'\n    when price_close-price_open<0 then 'fall'\n    else 'unchanged'\nend as situation\nfrom stocks\nwhere symbol='AAPL' and substring(ymd,0,7)='2008-10';\n```\n\n![image-20250522153845775](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522153845775-1749470495099-189.png)\n\nï¼ˆ8ï¼‰æŸ¥è¯¢stocksè¡¨ä¸­æ”¶ç›˜ä»·(price_close)æ¯”å¼€ç›˜ä»·(price_open)é«˜å¾—æœ€å¤šçš„é‚£æ¡è®°å½•çš„äº¤æ˜“æ‰€(exchange)ã€è‚¡ç¥¨ä»£ç (symbol)ã€æ—¥æœŸ(ymd)ã€æ”¶ç›˜ä»·ã€å¼€ç›˜ä»·åŠäºŒè€…å·®ä»·ã€‚\n\n```\nselect `exchange`,symbol,ymd,price_close-price_open as `diff`\nfrom\n(\n    select *\n    from stocks\n    order by price_close-price_open desc\n    limit 1\n)t;\n```\n\n![image-20250522153914410](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522153914410-1749470495099-190.png)\n\nï¼ˆ9ï¼‰ä»stocksè¡¨ä¸­æŸ¥è¯¢è‹¹æœå…¬å¸ï¼ˆsymbol=AAPLï¼‰å¹´å¹³å‡è°ƒæ•´åæ”¶ç›˜ä»·(price_adj_close) å¤§äº50ç¾å…ƒçš„å¹´ä»½åŠå¹´å¹³å‡è°ƒæ•´åæ”¶ç›˜ä»·ã€‚\n\n```\nselect\n    year(ymd) as `year`,\n    avg(price_adj_close) as avg_price from stocks\nwhere `exchange`='NASDAQ' and symbol='AAPL'\ngroup by year(ymd)\nhaving avg_price > 50;\n```\n\n![image-20250522154025370](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522154025370-1749470495099-191.png)\n\nï¼ˆ10ï¼‰æŸ¥è¯¢æ¯å¹´å¹´å¹³å‡è°ƒæ•´åæ”¶ç›˜ä»·(price_adj_close)å‰ä¸‰åçš„å…¬å¸çš„è‚¡ç¥¨ä»£ç åŠå¹´å¹³å‡è°ƒæ•´åæ”¶ç›˜ä»·ã€‚\n\n```\nSET mapreduce.job.reduces=2;\nselect t2.year, t2.symbol, t2.avg_price\nfrom (\n    select *,\n           row_number() over (partition by year order by avg_price desc) as rn\n    from (\n        select\n            year(ymd) as year,\n            symbol,\n            avg(price_adj_close) as avg_price\n        from stocks\n        group by year(ymd), symbol\n    ) t1\n) t2\nwhere t2.rn <= 3;\n```\n\n![image-20250522161403513](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250522161403513-1749470495099-192.png)\n\n## (9.9.3)\n\n1.åˆ©ç”¨mapreduceå®ç°è¯é¢‘ç»Ÿè®¡\n\n```\nsudo ls && start-all.sh\n```\n\n```bash\ncd\nhdfs dfs -rm -r input\nhdfs dfs -rm -r output\nhdfs dfs -mkdir input\nrm -rf input\nmkdir input\necho \"hello world\" > input/file1.txt\necho \"hello hadoop\" > input/file2.txt\nhdfs dfs -put input/* input/\nhadoop jar $HADOOP_HOME/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount input output\nhdfs dfs -cat output/*\n```\n\n![image-20250609195315190](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250609195315190.png)\n\n2.åˆ©ç”¨hiveå®ç°è¯é¢‘ç»Ÿè®¡\n\n```\nhive\n```\n\n```sql\ncreate table docs(line string);\nload data inpath 'file:///home/hadoop/input' overwrite into table docs;\ncreate table word_count as \nselect word, count(1) as count from\n(select explode(split(line,' '))as word from docs) w\ngroup by word\norder by word;\n```\n\nå¯¹æ–‡æœ¬è¿›è¡Œâ€œåˆ†è¯ + ç‚¸è£‚â€ï¼Œå¾—åˆ°æ‰€æœ‰å•è¯åˆ—è¡¨\n\n```sql\nSELECT explode(split(line, ' ')) AS word FROM docs;\n```\n\n![image-20250609195635791](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250609195635791.png)\n\nå¯¹å•è¯è¿›è¡Œåˆ†ç»„å¹¶è®¡æ•°\n\n```sql\nSELECT word, COUNT(*) AS count\nFROM (\n  SELECT explode(split(line, ' ')) AS word FROM docs\n) w\nGROUP BY word;\n```\n\n![image-20250609195734111](../img/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E9%AA%8C/image-20250609195734111.png)\n\n\n\n> `ä¸‰å¼ å›¾ç‰‡éƒ½äº¤åˆ°9.9.3`\n"},{"title":"ZeroTierå…è´¹è¿œæ§å·¥å…·","url":"/posts/a735afbd/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# ZeroTierå…è´¹è¿œæ§å·¥å…·\n\n[ZeroTier](https://www.zerotier.com/)ï¼Œåˆ†åˆ†é’Ÿå¼‚åœ°å®ç°ç»„ç½‘çš„è¿œæ§å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·æœ‰å…è´¹è®¡åˆ’çš„\n\nå…è´¹è®¡åˆ’é‡Œæœ‰3ä¸ªç½‘ç»œå’Œ10ä¸ªè®¾å¤‡ã€‚\n\nä¾‹å­ï¼šåœ¨ZeroTierç½‘é¡µåå°æ·»åŠ ä¸€ä¸ªç½‘ç»œï¼Œå°±æ˜¯åœ¨ä¸¤ä¸ªè®¾å¤‡ä¸‹è½½ZeroTierå®¢æˆ·ç«¯ï¼Œä¸¤ä¸ªè®¾å¤‡éƒ½åŠ å…¥åˆ°ç½‘ç»œï¼Œå°±å½¢æˆäº†ä¸€ä¸ªå±€åŸŸç½‘ï¼Œæœ€ååœ¨ç½‘é¡µåå°è¿›è¡Œè®¾å¤‡åŠ å…¥çš„æˆæƒåŠ å…¥ï¼Œå°±ä¼šå½¢æˆä¸€ä¸ªipï¼Œåªéœ€è¦è¾“å…¥è¿™ä¸ªipå°±å¯ä»¥å®ç°è¿œæ§äº†ã€‚\n\nè¿™ä¸ªç½‘ç»œï¼Œç›¸å½“äºä¸€ä¸ªå·¨å‹çš„å±€åŸŸç½‘ï¼Œåœ¨å…è´¹è®¡åˆ’é‡Œå¯ä»¥åŠ å…¥10ä¸ªè®¾å¤‡ã€‚\n\n![image-20250227100506316](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/5982fd2823f00f4099c8de6c52dcfba155933597.png)\n\n## æ³¨å†ŒZeroTier\n\nåœ¨[Sign in to ZeroTier](https://accounts.zerotier.com/realms/zerotier/protocol/openid-connect/auth?client_id=zt-central&redirect_uri=https%3A%2F%2Fmy.zerotier.com%2Fauth%2Fcallback&response_type=code&scope=openid+profile+email+offline_access&state=a3c0bc038dac41e0a0c8e32f298a1e6f&code_challenge=1Y9O_eh9aN4HK6anc1W22JgfiFil_uv-aJM_qhWIm1w&code_challenge_method=S256&response_mode=query)æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œæœ‰å¾ˆå¤šæ–¹å¼ï¼Œè‡ªå·±é€‰ä¸€ä¸ªå°±è¡Œäº†\n![image-20250227091906232](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/2fbef4b369295cc784ec2cf1dd9b2e9955933597.png)\n\n## åˆ›å»ºç½‘ç»œ\n\nç‚¹å‡»åˆ›å»ºç½‘ç»œï¼Œä¸‹é¢å°±ä¼šæœ‰ä¸€ä¸ªç½‘ç»œidï¼Œè¿™ä¸ªidæ˜¯æ‰€æœ‰è®¾å¤‡åŠ å…¥ç½‘ç»œéœ€è¦çš„è¾“å…¥çš„id\n\n![image-20250227092054437](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/46a731bc8b11ac8e53aad0fbf2bd3de555933597.png)\n\n## å„ä¸ªè®¾å¤‡ä¸‹è½½å®¢æˆ·ç«¯\n\nåœ¨ä½ éœ€è¦è¿œæ§çš„==å„ä¸ª==è®¾å¤‡ï¼Œä¸‹è½½å®¢æˆ·ç«¯[Download - ZeroTier](https://www.zerotier.com/download/)\n\nä½ çš„è®¾å¤‡æ˜¯ä»€ä¹ˆç³»ç»Ÿï¼Œä½ å°±ä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„è½¯ä»¶\n\n![image-20250227093209263](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/9a0b675a61f723646c57fd7c12e80e7355933597.png)\n\næˆ‘è¿™é‡ŒåŒæ–¹éƒ½æ˜¯windowsï¼Œlinuxæœ‰æ•™ç¨‹ï¼Œä½ å¯ä»¥è‡ªå·±çœ‹çœ‹\n\nwindowså®‰è£…ä¹‹åæ˜¯æ²¡æœ‰æ¡Œé¢å›¾æ ‡çš„ï¼Œä½ è¦åœ¨å¼€å§‹èœå•é‡Œæ‰èƒ½çœ‹è§\n\n![image-20250227095049175](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/bcd2a8644d6fd55b399b1b65e09cbf8055933597.png)        ![image-20250227095115621](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/9a6bad75cc80e55dc9425cc6c7140ba155933597.png)    \n\næ‰“å¼€ä¹‹åå†å°æ‰˜ç›˜é‡Œå°±å¯ä»¥çœ‹è§äº†\n\n## å®¢æˆ·ç«¯åŠ å…¥ç½‘ç»œ\n\nå¤åˆ¶è¿™ä¸ªç½‘ç»œidï¼Œç„¶ååœ¨å°æ‰˜ç›˜å³é”®ZeroTierï¼Œç‚¹å‡»Join New Networkè¾“å…¥ç½‘ç»œidå°±å¯ä»¥æˆåŠŸåŠ å…¥ç½‘ç»œï¼Œå„ä¸ªéœ€è¦è¿œæ§çš„è®¾å¤‡éƒ½è¦å®‰è£…ZeroTierå’Œè¾“å…¥ç½‘ç»œidï¼Œæ‰èƒ½æˆåŠŸåŠ å…¥è¿™ä¸ªç½‘ç»œ\n\n![image-20250227095220088](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/56a336a5ba60fd5a6e7d19f0dd44566255933597.png)\n\n![image-20250227095257254](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/8b77ff2da2d1a651d164e2bfe81f3b4355933597.png)\n\n![image-20250227095303750](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/afaef8b899a41d4afd9955a2aea5a85055933597.png)\n\n## æˆæƒè®¾å¤‡\n\n![](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/88496a5df443cc0f031ca96be8d6286d55933597.png)\n\n## è¿›è¡Œè¿œæ§\n\næŒ‰win+rè¾“å…¥mstsc\n\n![image-20250227095724804](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/52a07de2fcbff7b19f25541276867a4255933597.png)\n\nç„¶åè¾“å…¥ä½ è¦æ§åˆ¶å¯¹æ–¹çš„æ‰˜ç®¡ipå³å¯è¿œæ§\n\n![image-20250227095945162](../img/ZeroTier%E5%85%8D%E8%B4%B9%E8%BF%9C%E6%8E%A7%E5%B7%A5%E5%85%B7/6400eb59d5203331dcd6382f58edcc8e55933597.png)\n\nç™»å…¥ä¸€ä¸‹å°±å¯ä»¥äº†\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","categories":["ç»„ç½‘"]},{"title":"Hadoop 3.3.5éƒ¨ç½²","url":"/posts/cbb23bdb/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Hadoop 3.3.5éƒ¨ç½²\n\n## å‰æƒ…æè¦\n\næœ¬æ¬¡å®éªŒé‡‡ç”¨Ubuntu 24.04LTSï¼Œè‡ªè¡Œå®‰è£…\n\n[Ubuntu 24.04.02 LTS åˆå§‹åŒ–å®‰è£… | ä¸¥åƒå±¹åšå®¢](https://blog.qianyios.top/posts/14363/)\n\n\n\næœ¬ç¬”è®°åˆ†`ä¼ªåˆ†å¸ƒ`å’Œ`åˆ†å¸ƒå¼`ä¸¤å¤§å—ï¼Œä½†å»ºè®®ä»å¤´å¼€å§‹è§‚çœ‹\n\næ–‡ç« æ‰€éœ€èµ„æºå¯[ç‚¹å‡»è¿™é‡Œ](https://www.alipan.com/s/wtajKBGvPuh)ä¸‹è½½\n\n1. ä¼ªåˆ†å¸ƒä¸»æœºæ‹“æ‰‘\n\n|  ä¸»æœºå  |   ipï¼ˆNATï¼‰    | å†…å­˜ | ç¡¬ç›˜ |\n| :------: | :------------: | :--: | :--: |\n| qianyios | 192.168.48.128 |  7G  | 100G |\n\n2. åˆ†å¸ƒå¼ä¸»æœºæ‹“æ‰‘\n\n|  æœºå  |   ipï¼ˆNATï¼‰    | å†…å­˜ | ç¡¬ç›˜ |\n| :----: | :------------: | :--: | :--: |\n| master | 192.168.48.128 |  6G  | 100G |\n| slave  | 192.168.48.129 |  6G  | 100G |\n\n## åŸºç¡€åˆå§‹åŒ–\n\nç®€å•éƒ¨ç½²ä¸€ä¸ªå•èŠ‚ç‚¹çš„hadoopï¼Œç„¶åæ‰“å¿«ç…§ï¼Œåç»­ç»™ä¼ªåˆ†å¸ƒå’Œåˆ†å¸ƒå¼åšåŸºç¡€åº•åº§\n\nç”±äºæœ¬ç³»ç»Ÿåœ¨[Ubuntu 24.04.02 LTS åˆå§‹åŒ–å®‰è£… | ä¸¥åƒå±¹åšå®¢](https://blog.qianyios.top/posts/14363/)å·²ç»è¿›è¡Œäº†è®¾ç½®é˜¿é‡Œæºå’Œå…³é—­é˜²ç«å¢™ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†\n\n`åˆ‡æ¢rootç”¨æˆ·`\n\n```\nqianyios@qianyios:~$ su -  root\nå¯†ç ï¼š\nroot@qianyios:~#\n```\n\n`åŸºç¡€é…ç½®`\n\n```shell\ncat >init.sh<<\"EOF\"\n#!/bin/bash\nsed -i 's/^#*PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config\nsed -i 's/^#*PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config\nsystemctl restart ssh\n# æ·»åŠ  hosts\necho \"192.168.48.128 qianyios\" >> /etc/hosts\necho \"å·²æ·»åŠ  hosts æ¡ç›®ã€‚\"\n\n# è®¾ç½®ä¸»æœºå\nhostnamectl set-hostname qianyios\necho \"ä¸»æœºåå·²è®¾ç½®ä¸º qianyiosã€‚\"\n\n# å®‰è£… sshpass\napt install -y sshpass || { echo \"å®‰è£… sshpass å¤±è´¥\"; exit 1; }\necho \"sshpass å®‰è£…å®Œæˆã€‚\"\n\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"qianyios\")\n# å¯†ç \npassword=\"123456\"\n\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\necho \"SSH å¯†é’¥å¯¹å·²ç”Ÿæˆã€‚\"\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    echo \"æ­£åœ¨ä¸º $host é…ç½®å…å¯†ç™»å½•...\"\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\" || { echo \"å¤åˆ¶å…¬é’¥åˆ° $host å¤±è´¥\"; exit 1; }\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\" || { echo \"éªŒè¯å…å¯†ç™»å½•å¤±è´¥\"; exit 1; }\ndone\nreboot\nEOF\nbash init.sh\n```\n\næµ‹è¯•å…å¯†ç™»å…¥\n\n```\nroot@qianyios:~# ssh qianyios\nWelcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.11.0-17-generic x86_64)\n\n......\n\nLast login: Tue Feb 25 00:02:32 2025 from 127.0.0.1\nroot@qianyios:~#\n```\n\n\n\nä¸‹è½½[æ‰€éœ€èµ„æº](https://www.alipan.com/s/wtajKBGvPuh)å¹¶è§£å‹åˆ°/root/hadoop/ä¸‹ï¼Œå¦‚ä¸‹å›¾\n\n![image-20250225001010678](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/f38ec4a925111c05a235fe8dd79f402f55933597-1741134057016-7.png)\n\n`å®‰è£…javaç¯å¢ƒå’Œhadoop`\n\n```bash\ncd /root/hadoop\nmkdir /usr/lib/jvm\n#å®‰è£…java8\ntar -xf /root/hadoop/jdk-8u371-linux-x64.tar.gz  -C /usr/lib/jvm\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_371\" >> /etc/profile\necho \"export PATH=\\$JAVA_HOME/bin:\\$PATH\" >> /etc/profile\nsource /etc/profile\njava -version\n\n#å®‰è£…hadoop3.3.5\ntar -zxf hadoop-3.3.5.tar.gz -C /usr/local\nmv /usr/local/hadoop-3.3.5/ /usr/local/hadoop\necho \"export HADOOP_HOME=/usr/local/hadoop\" >> /etc/profile\necho \"export PATH=\\$HADOOP_HOME/bin/:\\$HADOOP_HOME/sbin/:\\$PATH\" >> /etc/profile\nsource /etc/profile\nhadoop version\n```\n\næˆåŠŸå›¾\n\n![image-20250225001421609](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/95f74daa7de0699880c670c1a060a69855933597-1741134057016-8.png)\n\nè¿™æ—¶å€™å…³æœº\n\n```\npoweroff\n```\n\n`æ‰“ä¸ªå¿«ç…§ï¼Œæ–¹ä¾¿åšåˆ†å¸ƒå¼éƒ¨ç½²,å¦‚æœä½ è¦åšåˆ†å¸ƒå¼çš„ç›´æ¥è·³åˆ°`[4.åˆ†å¸ƒå¼](#åˆ†å¸ƒå¼)\n\n![image-20250225001553286](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/3d9ba6fb30ae5bcc47e82a27598e96e355933597-1741134057016-9.png)\n\n## ä¼ªåˆ†å¸ƒ\n\nå¼€æœºå§ï¼\n\n### ç¼–å†™é…ç½®æ–‡ä»¶\n\n#### ç¼–å†™cort-site.yamlæ–‡ä»¶\n\nä¿®æ”¹ä¸‹é¢hdfs://qianyios:9000ä¸­çš„qianyiosä¸ºä½ çš„ä¸»æœºå\n\n```bash\ncat > /usr/local/hadoop/etc/hadoop/core-site.xml<< \"EOF\"\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?>\n<configuration>\n    <property>\n        <name>hadoop.tmp.dir</name>\n        <value>file:/usr/local/hadoop/tmp</value>\n        <description>Abase for other temporary directories.</description>\n    </property>\n    <property>\n        <name>fs.defaultFS</name>\n        <value>hdfs://qianyios:9000</value>\n    </property>\n</configuration>\n\nEOF\n```\n\n#### ç¼–å†™hdfs-site.xml\n\n```bash\ncat >/usr/local/hadoop/etc/hadoop/hdfs-site.xml<<\"EOF\"\n<configuration>\n    <property>\n        <name>dfs.replication</name>\n        <value>1</value>\n    </property>\n    <property>\n        <name>dfs.namenode.name.dir</name>\n        <value>file:/usr/local/hadoop/tmp/dfs/name</value>\n    </property>\n    <property>\n        <name>dfs.datanode.data.dir</name>\n        <value>file:/usr/local/hadoop/tmp/dfs/data</value>\n    </property>\n</configuration>\nEOF\n```\n\n### å¯åŠ¨hdfsæœåŠ¡\n\nhadoopåˆå§‹åŒ–\n\n```\nhdfs namenode -format\n```\n\n`è¿™æ¡å‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡ï¼Œä»¥åéƒ½ä¸è¦å†è¿è¡Œäº†ï¼ï¼ï¼ï¼ï¼ï¼`\n\n`è¿™æ¡å‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡ï¼Œä»¥åéƒ½ä¸è¦å†è¿è¡Œäº†ï¼ï¼ï¼ï¼ï¼ï¼`\n\n`è¿™æ¡å‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡ï¼Œä»¥åéƒ½ä¸è¦å†è¿è¡Œäº†ï¼ï¼ï¼ï¼ï¼ï¼`\n\n![image-20250225002137864](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/01a33f64e78e68f25feafd136cc8ee1355933597-1741134057016-10.png)\n\n### æ·»åŠ ç¯å¢ƒå˜é‡\n\n```bash\necho \"export HDFS_NAMENODE_USER=root\" >> /etc/profile\necho \"export HDFS_DATANODE_USER=root\" >> /etc/profile\necho \"export HDFS_SECONDARYNAMENODE_USER=root\" >> /etc/profile\necho \"export YARN_RESOURCEMANAGER_USER=root\" >> /etc/profile\necho \"export YARN_NODEMANAGER_USER=root\" >> /etc/profile\nsource /etc/profile\n```\n\n### ä¿®æ”¹hadoopé…ç½®æ–‡ä»¶\n\n```bash\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_371\" >> /usr/local/hadoop/etc/hadoop/hadoop-env.sh\n```\n\n### å¯åŠ¨hadoop\n\n```bash\n#å¯åŠ¨æœåŠ¡\nstart-all.sh\n```\n\n```bash\n#å…³é—­æœåŠ¡\nstop-all.sh\n```\n\n![image-20250225002639543](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/8109ed6221eb8f3800d456ddfd600f6455933597-1741134057016-11.png)\n\n\n\n> `localhost: Warning: Permanently added 'localhost' (ED25519) to the list of known hosts.`\n>\n> - è¿™æ˜¯ä¸€ä¸ª SSH çš„è­¦å‘Šä¿¡æ¯ï¼Œè¡¨æ˜ SSH å®¢æˆ·ç«¯é¦–æ¬¡è¿æ¥åˆ° `localhost` æ—¶ï¼Œå°† `localhost` çš„ä¸»æœºå¯†é’¥ï¼ˆä½¿ç”¨ ED25519 ç®—æ³•ç”Ÿæˆï¼‰æ·»åŠ åˆ°äº† `known_hosts` æ–‡ä»¶ä¸­ã€‚\n> - è¿™æ˜¯ SSH çš„æ­£å¸¸è¡Œä¸ºï¼Œç”¨äºé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚æ¯æ¬¡ SSH å®¢æˆ·ç«¯è¿æ¥åˆ°ä¸€ä¸ªæ–°ä¸»æœºæ—¶ï¼Œéƒ½ä¼šå°†ä¸»æœºçš„å¯†é’¥è®°å½•ä¸‹æ¥ã€‚\n\n### å¯åŠ¨historyserveræœåŠ¡\n\n```bash\n#å¯åŠ¨hadoop\nstart-all.sh\nmapred --daemon start historyserver\n```\n\nå…³é—­ç”¨\n\n```\nmapred --daemon stop historyserver\n```\n\næ­£å¸¸å¯åŠ¨hadoopä½ ä¼šçœ‹åˆ°å¦‚ä¸‹æœåŠ¡\n\n```\nroot@qianyios:~# jps\n14050 NodeManager\n10245 JobHistoryServer\n13894 ResourceManager\n13255 NameNode\n13449 DataNode\n13673 SecondaryNameNode\n14606 Jps\n```\n\n### è®¿é—®ç½‘é¡µip:9870æŸ¥çœ‹hdfs\n\n![image-20250225003504886](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/ca5e881a499f56ea8a2f0ed7ea8dd51955933597-1741134057016-12.png)\n\n#### è®¿é—®ç½‘é¡µip:8088æŸ¥çœ‹hadoop\n\n![image-20250225003534036](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/3fc9b78167b7990fb02a5d0922ec21f055933597-1741134057016-13.png)\n\nè‡³æ­¤ä¼ªåˆ†å¸ƒhadoopå°±æå®šäº†ï¼Œè¿™æ—¶å€™ä½ è¦åœ¨ä½ è¿™é‡Œæ‰“ä¸Šä¸€ä¸ªä¼ªåˆ†å¸ƒçš„å¿«ç…§\n\n## åˆ†å¸ƒå¼\n\n### å‰æƒ…æè¦\n\n|  æœºå  |   ipï¼ˆNATï¼‰    | å†…å­˜ | ç¡¬ç›˜ |\n| :----: | :------------: | :--: | :--: |\n| master | 192.168.48.128 |  6G  | 100G |\n| slave  | 192.168.48.129 |  6G  | 100G |\n\nç”±äºå‰é¢ä¸æ˜¯åšäº†ä¸€ä¸ªhadoopçš„ä¸€ä¸ªåŸºç¡€å¿«ç…§å—ï¼Œè¿™æ—¶å€™ä½ å°±å¯¹é‚£ä¸ªåŸºç¡€å¿«ç…§è¿›è¡Œå®Œæ•´å…‹éš†ä¸¤ä¸ªå‡ºæ¥ï¼Œåˆ†åˆ«å‘½åä¸ºmasterå’Œslave\n\n![image-20250225114203260](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/a7b2efe8888a00a01f7cc90caa3eefbe55933597-1741134057016-14.png)\n\n![image-20250225114415054](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/a72ba0ad11eb21ca08c4f57fa1cd700c55933597-1741134057016-15.png)\n\nè¿™æ—¶å€™å…ˆå¼€slaveï¼Œmasterä¸è¦å¼€\n\n```\nvim /etc/netplan/01-network-manager-all.yaml\n```\n\nipæ”¹æˆ192.168.48.129\n\n```\n# Let NetworkManager manage all devices on this system\nnetwork:\n  ethernets:\n    ens33:\n      addresses: [192.168.48.129/24]\n      dhcp4: false\n      nameservers:\n          addresses: [192.168.48.2, 114.114.114.114]\n      routes:\n        - to: default\n          via: 192.168.48.2\n  version: 2\n  renderer: NetworkManager\n```\n\né‡å¯ç½‘å¡\n\n```\nnetplan apply\n```\n\nè¿™æ—¶å€™å†æŠŠmasterå¼€æœºï¼Œæ¥ç€å°±å¯ä»¥è¿›è¡ŒåŸºç¡€æ“ä½œäº†\n\n### åŸºç¡€æ“ä½œ\n\nä»¥ä¸‹æˆ‘ä¼šæå‰å‘Šè¯‰ä½ å“ªäº›æ˜¯å“ªä¸ªèŠ‚ç‚¹è¦æ“ä½œçš„å‘½ä»¤\n\næ“ä½œèŠ‚ç‚¹ï¼š===masterå’Œslave===\n\n```shell\ncat >fbsnit.sh <<\"EOF\"\n#!/bin/bash\nif [ $# -eq 1 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå\"\n  exit 2\nfi\nsudo sed -i '/qianyios/d' /etc/hosts\n#è¿™é‡Œä½ è¦æ”¹æˆä½ çš„ip\ngrep -q \"^192\\.168\\.48\\.128\\s\\+master\" /etc/hosts || echo \"192.168.48.128 master\" >> /etc/hosts\ngrep -q \"^192\\.168\\.48\\.129\\s\\+slave\" /etc/hosts || echo \"192.168.48.129 slave\" >> /etc/hosts\nhostnamectl set-hostname $1\n#è®¾ç½®å…å¯†\napt install -y sshpass || { echo \"å®‰è£… sshpass å¤±è´¥\"; exit 1; }\necho \"sshpass å®‰è£…å®Œæˆã€‚\"\n\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"master\" \"slave\")\n# å¯†ç \npassword=\"123456\"\n\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\necho \"SSH å¯†é’¥å¯¹å·²ç”Ÿæˆã€‚\"\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    echo \"æ­£åœ¨ä¸º $host é…ç½®å…å¯†ç™»å½•...\"\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\" || { echo \"å¤åˆ¶å…¬é’¥åˆ° $host å¤±è´¥\"; exit 1; }\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\" || { echo \"éªŒè¯å…å¯†ç™»å½•å¤±è´¥\"; exit 1; }\ndone\nreboot\nEOF\n```\n\n```shell\n#masteræ‰§è¡Œè¿™ä¸ª\nbash fbsnit.sh master\n```\n\n```bash\n#slaveæ‰§è¡Œè¿™ä¸ª\nbash fbsnit.sh slave\n```\n\n### ä¿®æ”¹é…ç½®æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\n1.ä¿®æ”¹workersæ–‡ä»¶\n\nåœ¨Hadoopé›†ç¾¤ä¸­ï¼Œ`workers`æ–‡ä»¶æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒç”¨äºæŒ‡å®šHadoopé›†ç¾¤ä¸­æ‰€æœ‰**ä»èŠ‚ç‚¹ï¼ˆDataNodeå’ŒTaskTracker/NodeManagerï¼‰çš„ä¸»æœºåæˆ–IPåœ°å€**\n\nå°†slaveä¿®æ”¹æˆä½ è‡ªå·±çš„ä»èŠ‚ç‚¹çš„ä¸»æœºå\n\n```shell\ncat> /usr/local/hadoop/etc/hadoop/workers <<\"EOF\"\nslave\nEOF\n```\n\n2.ä¿®æ”¹core-site.xml\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\nå°†masterä¿®æ”¹æˆä½ è‡ªå·±çš„ä¸»èŠ‚ç‚¹çš„ä¸»æœºå\n\n> - **ä½œç”¨**ï¼šé…ç½®Hadoopçš„æ ¸å¿ƒå‚æ•°ï¼Œä¸»è¦æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®å’Œä¸´æ—¶ç›®å½•çš„è®¾ç½®ã€‚\n>   - **`fs.defaultFS`**ï¼šæŒ‡å®šHDFSçš„é»˜è®¤è®¿é—®è·¯å¾„ï¼Œæ ¼å¼ä¸º`hdfs://<namenode-host>:<port>`ã€‚è¿™æ˜¯Hadoopå®¢æˆ·ç«¯è®¿é—®HDFSçš„å…¥å£ã€‚\n>   - **`hadoop.tmp.dir`**ï¼šæŒ‡å®šHadoopçš„ä¸´æ—¶ç›®å½•ï¼Œç”¨äºå­˜å‚¨è¿è¡Œæ—¶çš„ä¸´æ—¶æ–‡ä»¶ã€‚\n\n```bash\ncat> /usr/local/hadoop/etc/hadoop/core-site.xml<<\"EOF\"\n<configuration>\n        <property>\n                <name>fs.defaultFS</name>\n                <value>hdfs://master:9000</value>\n        </property>\n        <property>\n                <name>hadoop.tmp.dir</name>\n                <value>file:/usr/local/hadoop/tmp</value>\n                <description>Abase for other temporary directories.</description>\n        </property>\n</configuration>\nEOF\n```\n\n3.ä¿®æ”¹hdfs-site.xml\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\nå°†masterä¿®æ”¹æˆä½ è‡ªå·±çš„ä¸»èŠ‚ç‚¹çš„ä¸»æœºå\n\n> - **ä½œç”¨**ï¼šé…ç½®HDFSï¼ˆHadoop Distributed File Systemï¼‰çš„é«˜çº§å‚æ•°ã€‚\n>   - **`dfs.namenode.secondary.http-address`**ï¼šæŒ‡å®šSecondary NameNodeçš„HTTPåœ°å€ã€‚\n>   - **`dfs.replication`**ï¼šè®¾ç½®HDFSæ•°æ®å—çš„å‰¯æœ¬æ•°é‡ï¼Œé»˜è®¤ä¸º3ï¼Œè¿™é‡Œè®¾ç½®ä¸º1ï¼ˆé€‚åˆå•èŠ‚ç‚¹æµ‹è¯•ç¯å¢ƒï¼‰ã€‚\n>   - **`dfs.namenode.name.dir`**ï¼šæŒ‡å®šNameNodeå­˜å‚¨å…ƒæ•°æ®çš„ç›®å½•ã€‚\n>   - **`dfs.datanode.data.dir`**ï¼šæŒ‡å®šDataNodeå­˜å‚¨æ•°æ®å—çš„ç›®å½•ã€‚\n\n```\ncat> /usr/local/hadoop/etc/hadoop/hdfs-site.xml<<\"EOF\"\n<configuration>\n        <property>\n                <name>dfs.namenode.secondary.http-address</name>\n                <value>master:50090</value>\n        </property>\n        <property>\n                <name>dfs.replication</name>\n                <value>1</value>\n        </property>\n        <property>\n                <name>dfs.namenode.name.dir</name>\n                <value>file:/usr/local/hadoop/tmp/dfs/name</value>\n        </property>\n        <property>\n                <name>dfs.datanode.data.dir</name>\n                <value>file:/usr/local/hadoop/tmp/dfs/data</value>\n        </property>\n</configuration>\n\nEOF\n```\n\n4.ä¿®æ”¹mapred-site.xmlé…ç½®æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\nå°†masterä¿®æ”¹æˆä½ è‡ªå·±çš„ä¸»èŠ‚ç‚¹çš„ä¸»æœºå\n\n> - **ä½œç”¨**ï¼šé…ç½®MapReduceä½œä¸šçš„è¿è¡Œå‚æ•°ã€‚\n>   - **`mapreduce.framework.name`**ï¼šæŒ‡å®šMapReduceä½œä¸šè¿è¡Œçš„æ¡†æ¶ï¼ˆè¿™é‡Œæ˜¯YARNï¼‰ã€‚\n>   - **`mapreduce.jobhistory.address`** å’Œ **`mapreduce.jobhistory.webapp.address`**ï¼šæŒ‡å®šMapReduceä½œä¸šå†å²æœåŠ¡å™¨çš„åœ°å€å’ŒWebç•Œé¢åœ°å€ã€‚\n>   - **ç¯å¢ƒå˜é‡é…ç½®**ï¼šè®¾ç½®MapReduceä½œä¸šè¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚`HADOOP_MAPRED_HOME`ã€‚\n\n```bash\ncat> /usr/local/hadoop/etc/hadoop/mapred-site.xml<<\"EOF\"\n<configuration>\n        <property>\n                <name>mapreduce.framework.name</name>\n                <value>yarn</value>\n        </property>\n        <property>\n                <name>mapreduce.jobhistory.address</name>\n                <value>master:10020</value>\n        </property>\n        <property>\n                <name>mapreduce.jobhistory.webapp.address</name>\n                <value>master:19888</value>\n        </property>\n        <property>\n<name>yarn.app.mapreduce.am.env</name>\n<value>HADOOP_MAPRED_HOME=/usr/local/hadoop</value>\n</property>\n<property>\n<name>mapreduce.map.env</name>\n<value>HADOOP_MAPRED_HOME=/usr/local/hadoop</value>\n</property>\n<property>\n<name>mapreduce.reduce.env</name>\n<value>HADOOP_MAPRED_HOME=/usr/local/hadoop</value>\n</property>\n</configuration>\nEOF\n```\n\n5.ä¿®æ”¹yarn-site.xmlæ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\nå°†masterä¿®æ”¹æˆä½ è‡ªå·±çš„ä¸»èŠ‚ç‚¹çš„ä¸»æœºå\n\n> - **ä½œç”¨**ï¼šé…ç½®YARNï¼ˆYet Another Resource Negotiatorï¼‰çš„å‚æ•°ã€‚\n>   - **`yarn.resourcemanager.hostname`**ï¼šæŒ‡å®šResourceManagerçš„ä¸»æœºåï¼Œç”¨äºèµ„æºç®¡ç†å’Œä½œä¸šè°ƒåº¦ã€‚\n>   - **`yarn.nodemanager.aux-services`**ï¼šå¯ç”¨MapReduceçš„ShuffleæœåŠ¡ï¼Œè¿™æ˜¯MapReduceä½œä¸šè¿è¡Œçš„å¿…è¦é…ç½®ã€‚\n\n```bash\ncat> /usr/local/hadoop/etc/hadoop/yarn-site.xml<<\"EOF\"\n<configuration>\n        <property>\n                <name>yarn.resourcemanager.hostname</name>\n                <value>master</value>\n        </property>\n        <property>\n                <name>yarn.nodemanager.aux-services</name>\n                <value>mapreduce_shuffle</value>\n        </property>\n</configuration>\nEOF\n```\n\n### å°†ä¸Šè¿°é…ç½®æ‹·è´åˆ°slave\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\n```bash\ncd /usr/local/hadoop/etc/hadoop/\nscp core-site.xml slave:/usr/local/hadoop/etc/hadoop/\nscp hdfs-site.xml slave:/usr/local/hadoop/etc/hadoop/\nscp mapred-site.xml slave:/usr/local/hadoop/etc/hadoop/\nscp workers slave:/usr/local/hadoop/etc/hadoop/\nscp yarn-site.xml slave:/usr/local/hadoop/etc/hadoop/\ncd\n```\n\nè¿™é‡Œæ˜¯ä¸ç”¨è¾“å…¥å¯†ç ï¼Œå¦‚æœæç¤ºä½ è¦è¾“å…¥å¯†ç ï¼Œè¯´æ˜ä½ å‰é¢4.2çš„sshå…å¯†æ²¡åšå¥½\n\n### ä¿®æ”¹ç¯å¢ƒå˜é‡æ‹·è´åˆ°slave\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\n```\necho \"export HDFS_NAMENODE_USER=root\" >> /etc/profile\necho \"export HDFS_DATANODE_USER=root\" >> /etc/profile\necho \"export HDFS_SECONDARYNAMENODE_USER=root\" >> /etc/profile\necho \"export YARN_RESOURCEMANAGER_USER=root\" >> /etc/profile\necho \"export YARN_NODEMANAGER_USER=root\" >> /etc/profile\nsource /etc/profile\nscp /etc/profile slave:/etc/profile\nsource /etc/profile\n```\n\n### ä¿®æ”¹hadoopç¯å¢ƒé…ç½®æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\nå¹¶å°†é…ç½®æ–‡ä»¶æ‹·è´åˆ°slave\n\n```bash\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_371\" >> /usr/local/hadoop/etc/hadoop/hadoop-env.sh\nscp /usr/local/hadoop/etc/hadoop/hadoop-env.sh slave:/usr/local/hadoop/etc/hadoop/hadoop-env.sh\n```\n\n### é›†ç¾¤å¯åŠ¨\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\nmasteråˆå§‹åŒ–\n\n```\nhdfs namenode -format\n```\n\n![image-20250225125251009](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/e8c49f492e15de26ce81ca9487713dbb55933597-1741134057016-16.png)\n\n### å¯åŠ¨hadoop\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\n```bash\n#å¯åŠ¨hadoop\nstart-all.sh\n```\n\n```bash\n#å…³é—­æœåŠ¡\nstop-all.sh\n```\n\nå¯åŠ¨çš„æ—¶å€™å¦‚æœæœ‰è¿™äº›æ²¡å…³ç³»\n\n![image-20250225125953364](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/8e557859aed91345e878f5e726d390ee55933597-1741134057016-17.png)\n\n### å¯åŠ¨historyserver\n\næ“ä½œèŠ‚ç‚¹ï¼š==master==\n\n```\nmapred --daemon start historyserver\n```\n\nå…³é—­ç”¨\n\n```\nmapred --daemon stop historyserver\n```\n\n### æŸ¥çœ‹è¿›ç¨‹\n\nä¸¤ä¸ªèŠ‚ç‚¹è¯´è¿è¡Œçš„æœåŠ¡å¦‚ä¸‹\n\n```\nroot@master:~# jps\n31364 ResourceManager\n31140 SecondaryNameNode\n30856 NameNode\n32282 Jps\n28046 JobHistoryServer\n\nroot@slave:~# jps\n6304 DataNode\n6444 NodeManager\n6605 Jps\n```\n\nè®¿é—®hadoopé¡µé¢\n\nhttp://192.168.48.128:8088/\n\n![image-20250225130356821](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/801acdadb2295edd013381fb66aaea4655933597-1741134057016-18.png)\n\nhttp://192.168.48.128:9870/\n\n![image-20250225130422951](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/c26d8e695f06b81ea7e275862eb8566f55933597-1741134057016-19.png)\n\nè‡³æ­¤åˆ†å¸ƒå¼hadoopé›†ç¾¤æ„å»ºæˆåŠŸ\n\nè¿™æ—¶å€™å°±ä½ è¦ç»™ä½ è¿™ä¸¤å°æœºï¼Œæ‰“ä¸Šhadoopé›†ç¾¤éƒ¨ç½²æˆåŠŸçš„å¿«ç…§ï¼Œä»¥ä¾¿ä½ åæœŸåšé¡¹ç›®ä¸æŠ¥é”™å¯ä»¥æ¢å¤\n\n\n\n## HBase\n\n   HBase æ˜¯ä¸€ä¸ªé¢å‘åˆ—å¼å­˜å‚¨çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå…¶è®¾è®¡æ€æƒ³æ¥æºäº Google çš„ BigTable è®ºæ–‡ã€‚HBase åº•å±‚å­˜å‚¨åŸºäº HDFS å®ç°ï¼Œé›†ç¾¤çš„ç®¡ç†åŸºäº ZooKeeper å®ç°ã€‚HBase è‰¯å¥½çš„åˆ†å¸ƒå¼æ¶æ„è®¾è®¡ä¸ºæµ·é‡æ•°æ®çš„å¿«é€Ÿå­˜å‚¨ã€éšæœºè®¿é—®æä¾›äº†å¯èƒ½ï¼ŒåŸºäºæ•°æ®å‰¯æœ¬æœºåˆ¶å’Œåˆ†åŒºæœºåˆ¶å¯ä»¥è½»æ¾å®ç°åœ¨çº¿æ‰©å®¹ã€ç¼©å®¹å’Œæ•°æ®å®¹ç¾ï¼Œæ˜¯å¤§æ•°æ®é¢†åŸŸä¸­ Key-Value æ•°æ®ç»“æ„å­˜å‚¨æœ€å¸¸ç”¨çš„æ•°æ®åº“æ–¹æ¡ˆã€‚\n\næœ¬å®éªŒéƒ¨ç½²åœ¨ä¼ªåˆ†å¸ƒæœºå­ä¸Š\n\n### å®‰è£…\n\n```bash\ntar -xf /root/hadoop/hbase-2.5.4-bin.tar.gz -C /usr/local/\nmv /usr/local/hbase-2.5.4 /usr/local/hbase\necho \"export HBASE_HOME=/usr/local/hbase\" >> /etc/profile\necho \"export PATH=\\$PATH:\\$HBASE_HOME/bin\" >> /etc/profile\nsource /etc/profile\nsed -i \"s/CLASSPATH=\\${CLASSPATH}:\\$JAVA_HOME\\/lib\\/tools.jar/CLASSPATH=\\${CLASSPATH}:\\$JAVA_HOME\\/lib\\/tools.jar:\\/usr\\/local\\/hbase\\/lib\\/*/g\" /usr/local/hbase/bin/hbase\nhbase version\n```\n\n![image-20250228150312197](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/0dfefd758a4032f713df8045df6fc03c55933597-1741134057016-20.png)\n\n### HBaseé…ç½®\n\næ–‡ä»¶é‡Œçš„qianyiosè¦æ”¹æˆä½ çš„ä¸»æœºå,è¿è¡Œ HDFS NameNode çš„ä¸»æœºåã€‚\n\n`hbase.cluster.distributed`\n\n- è®¾ç½®ä¸º `true` è¡¨ç¤º HBase ä»¥åˆ†å¸ƒå¼æ¨¡å¼è¿è¡Œã€‚\n- å¦‚æœè®¾ç½®ä¸º `false`ï¼ŒHBase å°†ä»¥å•æœºæ¨¡å¼è¿è¡Œï¼ˆé€šå¸¸ç”¨äºæµ‹è¯•ï¼‰ã€‚\n\n==HBASE_MANAGES_ZK=true==\n\n- **`HBASE_MANAGES_ZK=true`** ï¼š\n  - è¡¨ç¤º HBase å°†å¯åŠ¨å¹¶ç®¡ç†è‡ªå·±çš„åµŒå…¥å¼ ZooKeeper å®ä¾‹ã€‚\n  - è¿™ç§æ¨¡å¼é€šå¸¸ç”¨äºå•æœºç¯å¢ƒæˆ–å°å‹æµ‹è¯•ç¯å¢ƒï¼Œç®€åŒ–äº†é…ç½®å’Œç®¡ç†ã€‚\n- **`HBASE_MANAGES_ZK=false`** ï¼š\n  - è¡¨ç¤º HBase ä¸ä¼šå¯åŠ¨è‡ªå·±çš„ ZooKeeper å®ä¾‹ï¼Œè€Œæ˜¯ä¾èµ–å¤–éƒ¨ç‹¬ç«‹çš„ ZooKeeper é›†ç¾¤ã€‚\n  - è¿™ç§æ¨¡å¼é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œæ¨èä½¿ç”¨ç‹¬ç«‹çš„ ZooKeeper é›†ç¾¤ä»¥æé«˜ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚\n\n```bash\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_371\" >> $HBASE_HOME/conf/hbase-env.sh\necho \"export HBASE_CLASSPATH=/usr/local/hbase/conf\" >> $HBASE_HOME/conf/hbase-env.sh\necho \"export HBASE_MANAGES_ZK=true\" >> $HBASE_HOME/conf/hbase-env.sh\necho \"export HBASE_DISABLE_HADOOP_CLASSPATH_LOOKUP=true\" >> $HBASE_HOME/conf/hbase-env.sh\n\ncat >$HBASE_HOME/conf/hbase-site.xml<<\"EOF\"\n<configuration>\n        <property>\n                <name>hbase.rootdir</name>\n                <value>hdfs://qianyios:9000/hbase</value>\n        </property>\n        <property>\n                <name>hbase.cluster.distributed</name>\n                <value>true</value>\n        </property>\n        <property>\n                <name>hbase.unsafe.stream.capability.enforce</name>\n                <value>false</value>\n        </property>\n</configuration>\nEOF\n```\n\n### å¯åŠ¨hbase\n\n```\nstart-all.sh \nstart-hbase.sh\n```\n\nç„¶åè¾“å…¥jps,æœ‰ä»¥ä¸‹ä¸‰ä¸ªä¸ªå°±å®‰è£…æˆåŠŸ\n\n![image-20250228160532991](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/c04c2e13c89c8eae6005dd6e22745bb755933597-1741134057017-21.png)\n\n\n\næµ‹è¯•hbase\n\n```\nhbase shell\nlist\n```\n\nèƒ½è¿è¡Œæ²¡æŠ¥é”™å°±è¡Œ\n\n![image-20250228163520364](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/4672fe19c429bef2f4168e3d93aec7a755933597-1741134057017-22.png)\n\nè®¿é—®hbaseç½‘é¡µ\n\nhttp://192.168.48.128:16010/\n\n![image-20250228163637109](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/00cc2038142a72aa0874e4455578118e55933597-1741134057017-24.png)\n\nå…³æœºå¤‡ä»½æ‰“å¿«ç…§\n\nå…³æœºé¡ºåº\n\n```\nstop-hbase.sh\nstop-all.sh\npoweroff\n```\n\nå¼€æœºé¡ºåº\n\n```\nstart-all.sh\nstart-hbase.sh\n```\n\n\n\n### å®ä¾‹æµ‹è¯•1\n\n| å­¦å·ï¼ˆS_Noï¼‰ | å§“åï¼ˆS_Nameï¼‰ | æ€§åˆ«ï¼ˆS_Sexï¼‰ | å¹´é¾„ï¼ˆS_Ageï¼‰ |\n| :----------: | :------------: | :-----------: | :-----------: |\n|   2015001    |    zhangsan    |     male      |      23       |\n|   2015002    |      Mary      |    female     |      22       |\n|   2015003    |      Lisi      |     male      |      24       |\n\n#### åˆ›å»ºå­¦ç”Ÿè¡¨\n\n```bash\nhbase shell\ncreate 'student','no','name','sex','age'\n#æŸ¥çœ‹è¡¨ç»“æ„\ndescribe 'student'\n```\n\n![image-20250228164331731](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/6e83288fecfc08b2f279113720320c1655933597-1741134057017-23.png)\n\n#### æ·»åŠ æ•°æ®\n\ns001ä¸ºè¡Œé”®,è¡Œé”®å¯ä»¥è‡ªå®šä¹‰,ä½†æ˜¯è¦æ³¨æ„åŒºåˆ«,æŒ‰ç…§å‰é¢çš„å­¦ç”Ÿè¡¨,è¾“å…¥ç¬¬ä¸€è¡Œs001çš„å­¦ç”Ÿä¿¡æ¯,æˆ‘è¿™é‡Œå°±ç®€å•è¾“å…¥ä¸€äº›ä¿¡æ¯ï¼Œåšä¾‹å­ç”¨\n\n```bash\n#æŸ¥çœ‹è¡¨çš„ä¿¡æ¯\nscan 'student'\nput 'student','s001','no','2015001'\nput 'student','s001','name','zhangsan'\nscan 'student'\n```\n\n![image-20250228164715165](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/dd0085f6d72cad5865ce4b8bdcb9f4df55933597-1741134057017-25.png)\n\n#### æŸ¥çœ‹æ•´è¡Œ\n\n```\nget 'student','s001'\n```\n\n![image-20250228164802747](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/a8025f688a510221d5ecdf2bd7b8893e55933597-1741134057017-26.png)\n\n#### æŸ¥çœ‹å•å…ƒæ ¼\n\n```\nget 'student','s001','name'\n```\n\n![image-20250228164900943](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/7a69cf09647e40bb019fb4d60df91a2055933597-1741134057017-27.png)\n\n### å®ä¾‹æµ‹è¯•2\n\nè¿™æ˜¯ä¸€ä¸ªè®¢å•è¡¨\n\n![image-20250228165126371](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/badb58d81d015ee7018a5b064a0f479455933597-1741134057017-28.png)\n\n#### åˆ›å»ºorderè¡¨\n\nåˆ›å»ºä¸€ä¸ªorderè¡¨ï¼Œå‡ºç°ä¸¤åˆ—æ—==userinfo,orderinfo==\n\nä½ çœ‹è¿™æ¬¡çš„è¡Œæ˜¯1å°±å’Œä¸Šä¸ªå®ä¾‹çš„s001ï¼Œæ˜¯ä¸ä¸€æ ·ï¼Œéƒ½æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„\n\nç„¶ååœ¨åˆ—æ—ä¸‹åˆ›å»ºåˆ—==userinfo:nameï¼Œuserinfo:ageï¼Œorderinfo:idï¼Œorderinfo:money==\n\nåœ¨åˆ›å»ºåˆ—çš„åŒæ—¶é™„å¸¦å€¼\n\n```\ncreate 'order','userinfo','orderinfo'\nlist\nput 'order','1','userinfo:name','sw'\nput 'order','1','userinfo:age','24'\nput 'order','1','orderinfo:id','23333'\nput 'order','1','orderinfo:money','30'\nscan 'order'\n```\n\n![image-20250228165243544](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/62c035ec5ebac17f0447343741ae78d955933597-1741134057017-30.png)\n\n#### ä¿®æ”¹æ•°æ®\n\n```\nput 'order','1','userinfo:name','zhangxiaosan'\nget 'order','1','userinfo:name'\nscan 'order'\n```\n\n![image-20250228170258943](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/6669ad4bc556d790e2d969f8b120630a55933597-1741134057017-29.png)\n\n#### æ—¶é—´æˆ³\n\næ•°æ®æ·»åŠ åˆ°HBaseçš„æ—¶å€™éƒ½ä¼šè¢«è®°å½•ä¸€ä¸ª`æ—¶é—´æˆ³`ï¼Œè¿™ä¸ªæ—¶é—´æˆ³è¢«æˆ‘ä»¬å½“åšä¸€ä¸ªç‰ˆæœ¬ã€‚\n\nå½“ä¿®æ”¹æŸä¸€æ¡çš„æ—¶å€™ï¼Œæœ¬è´¨ä¸Šæ˜¯å¾€é‡Œè¾¹æ–°å¢ä¸€æ¡æ•°æ®ï¼Œè®°å½•çš„ç‰ˆæœ¬åŠ ä¸€ã€‚\n\n![image-20250228170428084](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/060968af7f2b968e0e4d854cd0b9573455933597-1741134057017-31.png)\n\nç°åœ¨è¦æŠŠè¿™æ¡è®°å½•çš„å€¼æ”¹ä¸º40ï¼Œå®é™…ä¸Šå°±æ˜¯å¤šæ·»åŠ ä¸€æ¡è®°å½•ï¼Œåœ¨è¯»çš„æ—¶å€™æŒ‰ç…§æ—¶é—´æˆ³è¯»æœ€æ–°çš„è®°å½•\n\n![image-20250228170509622](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/52de916bf5cca1f325f94acc901d6e4355933597-1741134057017-32.png)\n\n```\nget 'order','1','orderinfo:money'\nput 'order','1','orderinfo:money','40'\nget 'order','1','orderinfo:money'\n```\n\n![image-20250228170922948](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/f497d628fd03b1287fdb9e46d1e1f20d55933597-1741134057017-33.png)\n\n#### åˆ é™¤æ•°æ®\n\nnameåä¸€å®šè¦åŠ ä¸ª`:`\n\n```\nscan 'student'\ndelete 'student','s001','name:'\nget 'student','s001','name'\n```\n\n![image-20250228171143117](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/35ff5d39e108ce3201e476b35bceb36855933597-1741134057017-34.png)\n\n#### åˆ é™¤è¡¨\n\n```\ndisable 'student'\ndescribe 'student'\ndrop 'student'\n```\n\n![image-20250228171228570](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/edef5233300dc9dc8be699628ed9ce8355933597-1741134057017-35.png)\n\n## Hive\n\nhive æ˜¯ä¸€ç§åº•å±‚å°è£…äº†Hadoop çš„æ•°æ®ä»“åº“å¤„ç†å·¥å…·ï¼Œä½¿ç”¨ç±»SQL çš„hiveSQL è¯­è¨€å®ç°æ•°æ®æŸ¥è¯¢ï¼Œæ‰€æœ‰hive çš„æ•°æ®éƒ½å­˜å‚¨åœ¨Hadoop å…¼å®¹çš„æ–‡ä»¶ç³»ç»Ÿã€(ä¾‹å¦‚ï¼Œ[Amazon S3](https://baike.baidu.com/item/Amazon S3/10809744)ã€HDFS)ä¸­ã€‚hive åœ¨åŠ è½½æ•°æ®è¿‡ç¨‹ä¸­ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œä»»ä½•çš„ä¿®æ”¹ï¼Œåªæ˜¯å°†æ•°æ®ç§»åŠ¨åˆ°HDFS ä¸­hive è®¾å®šçš„ç›®å½•ä¸‹ï¼Œå› æ­¤ï¼Œhive ä¸æ”¯æŒå¯¹æ•°æ®çš„æ”¹å†™å’Œæ·»åŠ ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯åœ¨åŠ è½½çš„æ—¶å€™ç¡®å®šçš„ã€‚\n\n**ç”¨æˆ·æ¥å£Client**\n\nç”¨æˆ·æ¥å£ä¸»è¦æœ‰ä¸‰ä¸ªï¼šCLIï¼ŒClient å’Œ WUIã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ Cliï¼ŒCliå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåŒæ—¶å¯åŠ¨ä¸€ä¸ª hive å‰¯æœ¬ã€‚Client æ˜¯ hive çš„å®¢æˆ·ç«¯ï¼Œç”¨æˆ·è¿æ¥è‡³ hive Serverã€‚åœ¨å¯åŠ¨ Client æ¨¡å¼çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å‡º hive Server æ‰€åœ¨èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨è¯¥èŠ‚ç‚¹å¯åŠ¨ hive Serverã€‚ WUI æ˜¯é€šè¿‡æµè§ˆå™¨è®¿é—® hiveã€‚\n\n**å…ƒæ•°æ®å­˜å‚¨ Metastore**\n\nhive å°†å…ƒæ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚ mysqlã€derbyã€‚hive ä¸­çš„å…ƒæ•°æ®åŒ…æ‹¬è¡¨çš„åå­—ï¼Œè¡¨çš„åˆ—å’Œåˆ†åŒºåŠå…¶å±æ€§ï¼Œè¡¨çš„å±æ€§ï¼ˆæ˜¯å¦ä¸ºå¤–éƒ¨è¡¨ç­‰ï¼‰ï¼Œè¡¨çš„æ•°æ®æ‰€åœ¨ç›®å½•ç­‰ã€‚\n\n**é©±åŠ¨å™¨ï¼šDriver è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨**\n\nè§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å®Œæˆ HQL æŸ¥è¯¢è¯­å¥ä»è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ç¼–è¯‘ã€ä¼˜åŒ–ä»¥åŠæŸ¥è¯¢è®¡åˆ’çš„ç”Ÿæˆã€‚ç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¹¶åœ¨éšåç”± MapReduce è°ƒç”¨æ‰§è¡Œã€‚\n\n**Hadoop**\n\nhive çš„æ•°æ®å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¤§éƒ¨åˆ†çš„æŸ¥è¯¢ç”± MapReduce å®Œæˆï¼ˆä¸åŒ…å« * çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚ select * from tbl ä¸ä¼šç”Ÿæˆ MapReduce ä»»åŠ¡ï¼‰ã€‚\n\n![image-20250304164524876](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/4f81535914ee466bb896c99825fc8a5455933597.png)\n\n![image-20250304164530902](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/e70302cba6a69ea06f90990acefe1fa655933597.png)\n\n### å®‰è£…hive\n\n`qianyios:3306`è¿™é‡Œè¦æ”¹æˆä½ çš„ä¸»æœºå\n\n`root`æ˜¯æ•°æ®åº“çš„rootç”¨æˆ·\n\n`qianyios666`æ˜¯æ•°æ®åº“å¯†ç \n\n```bash\ntar -xf /root/hadoop/apache-hive-3.1.3-bin.tar.gz\nmv apache-hive-3.1.3-bin /usr/local/hive\necho \"export HIVE_HOME=/usr/local/hive\" >> /etc/profile\necho \"export PATH=\\$HIVE_HOME/bin:\\$PATH\" >> /etc/profile\nsource /etc/profile\ncat >/usr/local/hive/conf/hive-site.xml<<\"EOF\"\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?>\n<configuration>\n  <property>\n    <name>javax.jdo.option.ConnectionURL</name>\n    <value>jdbc:mysql://qianyios:3306/hive?createDatabaseIfNotExist=true&amp;useSSL=false</value>\n    <description>JDBC connect string for a JDBC metastore</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionDriverName</name>\n    <value>com.mysql.cj.jdbc.Driver</value>\n    <description>Driver class name for a JDBC metastore</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionUserName</name>\n    <value>root</value>\n    <description>username to use against metastore database</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionPassword</name>\n    <value>qianyios666</value>\n    <description>password to use against metastore database</description>\n  </property>\n \t<property>\n    <name>hive.exec.mode.local.auto</name>\n    <value>true</value>\n  </property>\n</configuration>\nEOF\n```\n\n### å®‰è£…mysql\n\n```bash\napt remove mariadb* -y\napt install -y net-tools wget mysql-server\nsystemctl enable --now mysql\n#mysqlåˆå§‹åŒ–\nmysql_secure_installation\n```\n\n```bash\n#è¾“å…¥no\nPress y|Y for Yes, any other key for No: no\nRemove anonymous users?: yes\nDisallow root login remotely?: no\nRemove test database and access to it?: yes\nReload privilege tables now?: yes\n```\n\n```bash\nmysql -uroot\n#åˆ›å»ºç”¨æˆ· 'root'@'localhost'\nCREATE USER IF NOT EXISTS 'root'@'localhost' IDENTIFIED BY 'qianyios666';\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION;\n#å°† 'root'@'localhost' çš„è®¤è¯æ’ä»¶åˆ‡æ¢ä¸º mysql_native_password\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'qianyios666';\n#åˆ›å»ºç”¨æˆ· 'root'@'qianyios'\nCREATE USER IF NOT EXISTS 'root'@'qianyios' IDENTIFIED BY 'qianyios666';\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'qianyios' WITH GRANT OPTION;\nFLUSH PRIVILEGES;\ncreate database hive;\nexit\nsudo sed -i 's/^bind-address\\s*=\\s*127.0.0.1/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf\nsudo sed -i 's/^mysqlx-bind-address\\s*=\\s*127.0.0.1/mysqlx-bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf\nsystemctl restart mysql\n```\n\n### å¯åŠ¨hive\n\n```bash\ncd\nwget -P /root/hadoop/ https://downloads.mysql.com/archives/get/p/3/file/mysql-connector-java-8.0.11.tar.gz\ntar -xf /root/hadoop/mysql-connector-java-8.0.11.tar.gz\ncp mysql-connector-java-8.0.11/mysql-connector-java-8.0.11.jar /usr/local/hive/lib/\nmv /usr/local/hive/lib/guava-19.0.jar{,.bak}\ncp /usr/local/hadoop/share/hadoop/common/lib/guava-27.0-jre.jar  /usr/local/hive/lib\nstart-all.sh \n#hiveåˆå§‹åŒ–ï¼Œè¿™ä¸ªå‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡\nschematool -dbType mysql -initSchema\n#å¯åŠ¨hive\nhive\n```\n\nhiveåˆå§‹åŒ–æœ‰è¿™ä¸ªè¯´æ˜æˆåŠŸåˆå§‹åŒ–å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥ä¸€ä¸‹é…ç½®æ–‡ä»¶æˆ–è€…æ•°æ®åº“\n\n![image-20250304193132330](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/f4659243f9cf16b7b00f826f5273851b55933597.png)\n\n![image-20250304193255320](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/8461b4121e001687243685b5b4d9382c55933597.png)\n\nè¦é€€å‡ºå°±æŒ‰ä¸¤ä¸‹ctrl+C\n\n### Hiveæ•°æ®ç±»å‹\n\n|          ç±»å‹          |                 æè¿°                  |     ç¤ºä¾‹     |\n| :--------------------: | :-----------------------------------: | :----------: |\n|   TINYINTï¼ˆtinyintï¼‰   | ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰æœ‰ç¬¦å·æ•´æ•°ï¼Œ  -128~127 |      1       |\n|  SMALLINTï¼ˆsmallintï¼‰  | 2å­—èŠ‚ï¼ˆ16ä½ï¼‰æœ‰ç¬¦å·æ•´æ•°ï¼Œ-32768~32767 |      1       |\n|       INTï¼ˆintï¼‰       |        4å­—èŠ‚ï¼ˆ32ä½ï¼‰æœ‰ç¬¦å·æ•´æ•°        |      1       |\n|    BIGINTï¼ˆbigintï¼‰    |        8å­—èŠ‚ï¼ˆ64ä½ï¼‰æœ‰ç¬¦å·æ•´æ•°        |      1       |\n|     FLOATï¼ˆfloatï¼‰     |       4å­—èŠ‚ï¼ˆ32ä½ï¼‰å•ç²¾åº¦æµ®ç‚¹æ•°       |      1       |\n|    DOUBLEï¼ˆdoubleï¼‰    |       8å­—èŠ‚ï¼ˆ64ä½ï¼‰åŒç²¾åº¦æµ®ç‚¹æ•°       |      1       |\n|    DECIMAL(decimal)    |         ä»»æ„ç²¾åº¦çš„å¸¦ç¬¦å·å°æ•°          |      1       |\n|   BOOLEANï¼ˆbooleanï¼‰   |              true/false               |  true/false  |\n|    STRINGï¼ˆstringï¼‰    |             å­—ç¬¦ä¸²ï¼Œå˜é•¿              | â€˜aâ€™,â€˜bâ€™,â€˜1â€™  |\n|   VARCHARï¼ˆvarcharï¼‰   |              å˜é•¿å­—ç¬¦ä¸²               |     â€˜aâ€™      |\n|      CHARï¼ˆcharï¼‰      |            å›ºå®šé•¿åº¦å­—ç¬¦ä¸²             |     â€˜aâ€™      |\n|    BINANYï¼ˆbinanyï¼‰    |               å­—èŠ‚æ•°ç»„                |   æ— æ³•è¡¨ç¤º   |\n| TIMESTAMPï¼ˆtimestampï¼‰ |           æ—¶é—´æˆ³ï¼Œçº³ç§’ç²¾åº¦            | 1.22327E+11  |\n|      DATEï¼ˆdateï¼‰      |                 æ—¥æœŸ                  | â€˜2016-03-29â€™ |\n\n### hiveçš„é›†åˆæ•°æ®ç±»å‹\n\n|  ç±»å‹  |                             æè¿°                             |       ç¤ºä¾‹        |\n| :----: | :----------------------------------------------------------: | :---------------: |\n| ARRAY  |                 æœ‰åºæ•°ç»„ï¼Œå­—æ®µçš„ç±»å‹å¿…é¡»ç›¸åŒ                 |   Arrayï¼ˆ1ï¼Œ2ï¼‰   |\n|  MAP   | ä¸€ç»„æ— åºçš„é”®å€¼å¯¹ï¼Œé”®çš„ç±»å‹å¿…é¡»æ˜¯åŸå§‹æ•°æ®ç±»å‹ï¼Œä»–çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ŒåŒä¸€ä¸ªæ˜ å°„çš„é”®çš„ç±»å‹å¿…é¡»ç›¸åŒï¼Œå€¼å¾—ç±»å‹ä¹Ÿå¿…é¡»ç›¸åŒ |   Mapï¼ˆâ€˜aâ€™,1ï¼‰    |\n| STRUCT |               ä¸€ç»„å‘½åçš„å­—æ®µ,å­—æ®µç±»å‹å¯ä»¥ä¸åŒ                | Structï¼ˆâ€˜aâ€™,1,2.0 |\n| UNION  | UNIONåˆ™ç±»ä¼¼äºCè¯­è¨€ä¸­çš„UNIONç»“æ„ï¼Œåœ¨ç»™å®šçš„ä»»ä½•ä¸€ä¸ªæ—¶é—´ç‚¹ï¼ŒUNIONç±»å‹å¯ä»¥ä¿å­˜æŒ‡å®šæ•°æ®ç±»å‹ä¸­çš„ä»»æ„ä¸€ç§ |                   |\n\n### åŸºæœ¬å‘½ä»¤\n\nä»¥ä¸‹åœ¨hiveæ•°æ®ä»“åº“äº†è¿è¡Œ,è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›å…¥ï¼Œå¯èƒ½å¯åŠ¨æœ‰ç‚¹æ…¢\n\n```\nhive\n```\n\n\n\n#### åˆ›å»ºæ•°æ®åº“å’Œè¡¨\n\n```\ncreate database hive;\nuse hive;\ncreate table usr(id int,name string,age int);\n```\n\n#### æŸ¥çœ‹å’Œæè¿°æ•°æ®åº“å’Œè¡¨\n\n```\nshow databases;\nshow tables;\nUSE hive;\ndescribe database hive;\ndescribe hive.usr;\n```\n\n![image-20250304195510092](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/523e2a71150e1d8d4964e4a3a0dcffc455933597.png)\n\n#### å‘è¡¨ä¸­è£…è½½æ•°æ®\n\n```bash\ninsert into usr values(1,'sina',20);\n\n#ä»linuxè¯»å–æ•°æ®\n[root@qianyios555 ~]# echo \"2,zhangsan,22\" >> /opt/data\n#ä»hiveå¯¼å…¥æ•°æ®\nhive> use hive;\ncreate table usr1(id int,name string,age int) row format delimited fields terminated by \",\";\nload data local inpath '/opt/data' overwrite into table usr1;\n```\n\n#### ä»hdfsä¸­è¯»å–æ•°æ®\n\n```\n#ä»linuxè¯»å–æ•°æ®\necho \"3,lisi,25\" > /opt/test.txt\nhdfs dfs -put /opt/test.txt /\nhive\nuse hive;\nload data inpath 'hdfs://qianyios:9000/test.txt' overwrite into table usr1;\n```\n\n#### ä»åˆ«çš„è¡¨ä¸­è¯»å–æ•°æ®\n\n```\nhive> select * from usr;\nOK\n1       sina    20\n\nhive> select * from usr1;\nOK\n3       lisi    25\n#è¯»å–usr1çš„id=3çš„æ•°æ®åˆ°usr\ninsert overwrite table usr select * from usr1 where id=3;\n\nhive> select * from usr;\nOK\n3       lisi    25\n```\n\n#### æŸ¥è¯¢è¡¨ä¸­æ•°æ®\n\n```\nselect * from usr1;\n```\n\n### Hiveå®éªŒï¼šè¯é¢‘ç»Ÿè®¡\n\n#### åœ¨linuxä¸Šåˆ›å»ºè¾“å…¥ç›®å½•ï¼š/opt/inputï¼›\n\n```\nmkdir /opt/input\n```\n\n#### åœ¨ä»¥ä¸Šè¾“å…¥ç›®å½•ä¸­æ·»åŠ å¤šä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­æ–‡ä»¶ä¸­åŒ…å«å•è¯ï¼šå§“åå­¦å·ï¼Œä¾‹å¦‚ï¼šqianyios555ï¼›\n\n```\necho \"hello1 qianyios555\" > /opt/input/text1.txt\necho \"hello2 qianyios555\" > /opt/input/text2.txt\necho \"hello3 qianyios555\" > /opt/input/text3.txt\n```\n\n#### åœ¨Hiveä¸­åˆ›å»ºè¡¨â€œdocsâ€ï¼Œå¹¶æŠŠè¾“å…¥ç›®å½•çš„æ–‡ä»¶æ•°æ®åŠ è½½åˆ°è¯¥è¡¨ä¸­ï¼›\n\n```\nhive\nuse hive;\ncreate table docs(line string);\nload data local inpath '/opt/input' overwrite into table docs;\nselect * from docs;\n```\n\n#### ç¼–å†™HiveQLè¯­å¥å¯¹è¾“å…¥ç›®å½•çš„æ–‡æœ¬è¿›è¡Œè¯é¢‘ç»Ÿè®¡ï¼Œç»Ÿè®¡å•è¯â€œå§“åå­¦å·â€å‡ºç°çš„æ¬¡æ•°ã€‚\n\n```\ncreate table word_count as\nselect word,count(1) as count from\n(select explode(split(line,' ')) as word from docs) w\ngroup by word\norder by word;\n\nselect * from word_count;\ndescribe word_count;\n```\n\n![image-20250304200653584](../img/Hadoop%203.3.5%E9%83%A8%E7%BD%B2/ad87efeb56e56016026c6c3ac559b93755933597.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Hadoop","Ubuntu"],"categories":["è¿ç»´"]},{"title":"è®¡ç®—æœºç½‘ç»œæŠ€æœ¯è¯¾ç¨‹ç»¼åˆå®éªŒ","url":"/posts/f5e08620/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# è®¡ç®—æœºç½‘ç»œæŠ€æœ¯è¯¾ç¨‹ç»¼åˆå®éªŒ\n\nç©ºæ‹“æ‰‘ä¸‹è½½ï¼š[ç©ºæ‹“æ‰‘](https://resource.qianyios.top/%E7%BD%91%E7%BB%9C/%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%28%E7%A9%BA%E6%8B%93%E6%89%91%EF%BC%89.zip)\n\n## å‰æƒ…æè¦\n\nè‡ªè¡Œå®‰è£…enspè½¯ä»¶ï¼Œç»“åˆæ•™ç¨‹æ¥å®‰è£…\n\n[åä¸ºenspæ¨¡æ‹Ÿå™¨å®‰è£…æ•™ç¨‹ | ä¸¥åƒå±¹åšå®¢](https://blog.qianyios.top/posts/f8bb3dfe/)\n\n\n\næ‰“å¼€æ˜¾ç¤ºç«¯å£\n\n![image-20250224122453035](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/1718e9303bc216f086f248ec3d5bd5db55933597-1748227909929-1.png)\n\n\n\nç®€å•è¯´ä¸€ä¸‹ä¸€äº›å¸¸è¯†\n\n1.ç”¨æˆ·è§†å›¾`<Huawei>`ï¼š - è¿™æ˜¯ç™»å½•åçš„åˆå§‹ç•Œé¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥æ‰§è¡Œä¸€äº›åŸºæœ¬ä¿¡æ¯æŸ¥çœ‹å’Œç®€å•çš„å‘½ä»¤ã€‚\n2.ç³»ç»Ÿè§†å›¾ï¼š`[Huawei]` - è¾“å…¥`system-view`æˆ–è€…`sys`è¿›å…¥æ­¤æ¨¡å¼ï¼Œç”¨äºå…¨å±€æ€§çš„è®¾å¤‡é…ç½®ã€‚\n3.æ¥å£è§†å›¾ï¼š`[Huawei-GigabitEthernet0/0/1]` - ä½¿ç”¨`interface`æˆ–`int`å‘½ä»¤è¿›å…¥ç‰¹å®šæ¥å£è¿›è¡Œé…ç½®ã€‚\n4.åè®®è§†å›¾ï¼š`[Huawei-ospf-1]` - å¯¹åº”äºè·¯ç”±åè®®ç­‰é«˜çº§åŠŸèƒ½çš„é…ç½®ã€‚\n\n\n\n> ä»¥åçš„æ¯ä¸€æ­¥å®éªŒéƒ½ä¼šä»`<Huawei>`å¼€å§‹ï¼Œå¦‚æœä½ æ˜¯ç³»ç»Ÿè§†å›¾ï¼Œè‡ªè¡Œè¾“å…¥qé€€å›ç”¨æˆ·è¯•å›¾\n\n## åŸºç¡€é…ç½®\n\n`è¦æ±‚ï¼š`\n\n1ã€ç»™6ä¸ªè·¯ç”±å™¨AR1åˆ°AR6ï¼Œ6ä¸ªäº¤æ¢æœºLSW1åˆ°LSW6å…¨éƒ¨æ”¹å¥½è®¾å¤‡åå­—ï¼Œè®¾å¤‡åç§°ä¿®æ”¹ä¸ºè‡ªå·±åå­—é¦–å­—æ¯ç¼©å†™+è®¾å¤‡åã€‚æ¯”å¦‚æœ€å·¦è¾¹çš„AR1è·¯ç”±å™¨ï¼Œå­¦ç”Ÿåå­—ä¸ºå¼ ä¸‰ï¼Œåˆ™è®¾å¤‡åç§°æ”¹ä¸º yjxAR1\n\n![image-20250224123713290](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/f7fdb0de23e0278c1b01ca3ff187836255933597-1748227909930-2.png)\n\n2ã€ç»™ç¬¬ä¸€è¡Œçš„AR1ã€AR2ã€AR3ã€AR4ã€AR5å…±5ä¸ªè·¯ç”±å™¨çš„æ¥å£ï¼Œé…ç½®å¥½IPåœ°å€ã€‚åœ¨ç½‘ç»œæ‹“æ‰‘å›¾æ˜ç¡®ç»™å‡ºæ¥çš„ï¼ŒæŒ‰å›¾ç¤ºçš„é…ç½®ã€‚æ²¡æœ‰æ˜ç¡®ç»™å‡ºæ¥çš„ï¼Œåˆ™ç»Ÿä¸€é»˜è®¤è§„åˆ™ï¼šå·¦å³å¹¶æ’è¿æ¥çš„ï¼Œå·¦è¾¹æ¥å£æœ€å1ä¸ªå­—èŠ‚é…1ï¼Œå³è¾¹æ¥å£é…2ï¼› ä¸Šä¸‹è¿æ¥çš„ï¼Œä¸‹è¾¹æ¥å£é…1ï¼Œä¸Šè¾¹æ¥å£é…2.\n\n![image-20250224124132783](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/9f934a357f640fec95736ec78e1d17db55933597-1748227909930-3.png)\n\n\n\nå¦‚æœåˆšå¼€å§‹æ˜¯`<Huawei>`ä¹Ÿå«ç”¨æˆ·è§†å›¾å°±å¯ä»¥ç›´æ¥è¾“å…¥ä¸‹é¢çš„æŒ‡ä»¤ï¼Œå¦‚æœæ˜¯`[Huawei]`ä¹Ÿå«ç³»ç»Ÿè§†å›¾ï¼Œè¦è¾“å…¥ä¸€ä¸ª`quit`æˆ–`q`è¿›è¡Œé€€å‡ºã€‚è¿™æ ·æ˜¯ä¸ºäº†æ–¹ä¾¿ç»Ÿä¸€å¤§å®¶çš„è¾“å…¥ï¼Œæˆ‘ä»¬å…¨éƒ¨é€€å›åˆ°ç”¨æˆ·è§†å›¾ï¼Œè¿™æ ·å°±å¯ä»¥å…¨éƒ¨è¾“å…¥æŒ‡ä»¤äº†\n\n![image-20250224123518605](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/5b10c95c98cf4999fd454d59e7e156d055933597-1748227909930-4.png)\n\nä»¥ä¸‹ç®€å†™çš„å‘½ä»¤ï¼Œå›åˆ°[å‰æƒ…æè¦](#å‰æƒ…æè¦)è‡ªå·±çœ‹\n\n### è·¯ç”±å™¨é…ç½®\n\n> ä¸»æœºä½æ²¡æœ‰æ˜ç¡®ç»™å‡ºæ¥çš„ï¼Œåˆ™ç»Ÿä¸€é»˜è®¤è§„åˆ™ï¼šå·¦å³å¹¶æ’è¿æ¥çš„ï¼Œå·¦è¾¹æ¥å£æœ€å1ä¸ªå­—èŠ‚é…1ï¼Œå³è¾¹æ¥å£é…2ï¼› ä¸Šä¸‹è¿æ¥çš„ï¼Œä¸‹è¾¹æ¥å£é…1ï¼Œä¸Šè¾¹æ¥å£é…2.\n\n`yjxAR1`\n\n```\nsys\nsysname yjxAR1\nint g0/0/2\nip address 10.1.3.2 30\nq\nint g0/0/1\nip address 10.1.1.2 30\nq\nint g0/0/0\nip address 10.1.2.2 30\nq\nint g4/0/0\nip address 10.12.100.10 24\nq\nq\n\n```\n\nå¤åˆ¶å…¨éƒ¨ï¼Œç²˜è´´å…¨éƒ¨ä¸€æ­¥åˆ°ä½\n\n![image-20250224125827919](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/10753fea0befbf3b2745d5276541e1fa55933597-1748227909930-5.png)\n\n\n\n`yjxAR2`\n\n```\nsys\nsysname yjxAR2\nint g0/0/0\nip address 10.12.100.20 24\nq\nint s4/0/0\nip address 23.1.1.1 24\nq\nq\n\n```\n\n![image-20250224125845081](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/5b34d4c9820d0a3b3d50358ea2b57afa55933597-1748227909930-6.png)\n\n\n\n`yjxAR3`\n\n```\nsys\nsysname yjxAR3\nint s4/0/0\nip address 23.1.1.2 24\nq\nint g0/0/0\nip address 34.1.1.1 30\nq\nq\n\n```\n\n![image-20250224125908801](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/73f1d9e264bfe1f6638d58709f807bf255933597-1748227909930-7.png)\n\n\n\n`yjxAR4`\n\n```\nsys\nsysname yjxAR4\nint g0/0/0\nip address 34.1.1.2 30\nq\nint g0/0/1\nip address 45.1.1.1 30\nq\nq\n\n```\n\n![image-20250224130105066](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/8c430ea28f8ef87e89f680950c0ec76655933597-1748227909930-8.png)\n\n\n\n`yjxAR5`\n\n```\nun te mo\nsys\nsysname yjxAR5\nint g0/0/0\nip address 45.1.1.2 30\nq\n\n```\n\n![image-20250224142354111](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/89b46c60d80f7307b736096a82c3144f55933597-1748227909930-9.png)\n\n\n\n3ã€é‡è¦æé†’ï¼šæ‰€æœ‰ç½‘ç»œè®¾å¤‡çš„é…ç½®ï¼Œè®°å¾—æœ€åç”¨saveå‘½ä»¤ä¿å­˜ã€‚å¦åˆ™è½¯ä»¶å…³é—­åå°†ä¸ä¿ç•™ã€‚\n\n![image-20250224142529913](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/9be01986830f8d0539d350518d5ebfe255933597-1748227909930-10.png)\n\n### pcé…ç½®é™æ€ip\n\n4ã€ç»™ç½‘ç»œæ‹“æ‰‘å›¾æœ€åº•ä¸‹çš„PCï¼ŒæŒ‰å›¾é…ç½®å¥½é™æ€IPåœ°å€ã€‚\n\n![image-20250224142725509](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/6f7915a7f301266a9b9d781e8e686ef055933597-1748227909930-11.png)\n\n![image-20250224143251395](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/b8888eb23ea01f87a44e45e73a854ef555933597-1748227909930-12.png)\n\n![image-20250224144907420](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/4488aa1240c8b280ef748987e07024dd55933597-1748227909930-13.png)\n\n![image-20250224144935595](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/246c8a59b4599db4ff3e948d643f65c455933597-1748227909930-14.png)\n\n![image-20250224144952698](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/1afebce5e4f6f7cd14600a992bca012a55933597-1748227909930-15.png)\n\n![image-20250224145236193](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/b778665ff793aaeed3716740802e980355933597-1748227909930-16.png)\n\n![image-20250226121259570](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/04a1b74208276139418875b04dec413e55933597-1748227909930-18.png)\n\n![image-20250226121328616](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/d31d5b7242f80df2ba08e7585b8ac0da55933597-1748227909930-17.png)\n\n![image-20250224145315321](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/97be91a109d7e8f94162d318f6e128a455933597-1748227909930-19.png)\n\n![image-20250224145344081](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/b56545ab02e861e492a5cfdfd013697c55933597-1748227909930-20.png)\n\n\n\n### ARè·¯ç”±è¡¨å±•ç¤º\n\n![image-20250226125730431](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/757c033c0e73430b05812873c6505a5c55933597-1748227909930-21.png)\n\n![image-20250226130016385](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/f301994aa24b62948ad2d4706992593755933597-1748227909930-22.png)\n\n![image-20250226122050939](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/82ee192e32b93ed85009f89cd216ae9a55933597-1748227909930-23.png)\n\n![image-20250226122224080](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/c2d838f32ee8720bda779c6cdecfd35b55933597-1748227909930-24.png)\n\n![image-20250226122250938](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/7c8f88c9d8bc3a471473f3a04229bbee55933597-1748227909930-26.png)\n\n## ç¬¬äºŒå‘¨\n\n### é…ç½®vlan\n\nå¼€å¯LSW1ã€LSW3ã€LSW4ï¼Œå…³é—­LSW2é¿å…å½¢æˆç¯è·¯ï¼Œé…ç½®VLANåº“ï¼Œé…ç½®äº¤æ¢æœºç«¯å£å±æ€§ï¼Œé…ç½®äº¤æ¢æœºç«¯å£å½’å±å“ªäº›VLAN\n\n`yjxLSW3`\n\n```\nsys\nsysname yjxLSW3\n#é…ç½®VLANåº“\nvlan batch 10 20\n#é…ç½®äº¤æ¢æœºç«¯å£å±æ€§\nint g0/0/1\nport link-type access\nint g0/0/2\nport link-type access\nint g0/0/5\nport link-type access\nint g0/0/3\nport link-type trunk\n#é…ç½®äº¤æ¢æœºç«¯å£å½’å±å“ªäº›VLANæˆ–å“ªäº›VLANèƒ½é€šè¿‡\nint g0/0/1\nport default vlan 10\nint g0/0/2\nport default vlan 20\nint g0/0/5\nport default vlan 10\nint g0/0/3\nport trunk allow-pass vlan 10 20 \n#æŸ¥çœ‹é…ç½®ä¿¡æ¯\ndisplay vlan\n```\n\n![image-20250303102338703](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/bce9e60b19478316a16fe0bf497c0bcd55933597-1748227909930-25.png)\n\n`yjxLSW4`\n\n```\nun te mo\nsys\nsysname yjxLSW4\nvlan batch 10 20\nint g0/0/1\nport link-type access\nint g0/0/2\nport link-type access\nint g0/0/3\nport link-type trunk\nint g0/0/1\nport default vlan 10\nint g0/0/2\nport default vlan 20\nint g0/0/3\nport trunk allow-pass vlan 10 20\ndisplay vlan\n```\n\n![image-20250303102746287](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/6ce0aa8f70b427dd28f65216c9718d0655933597-1748227909930-27.png)\n\n### é…ç½®ç½‘å…³\n\nåœ¨LSW1äº¤æ¢æœºä¸Šï¼Œé…ç½®VLANçš„è™šæ‹Ÿæ¥å£SVIï¼Œé…ç½®SVIçš„IPåœ°å€ï¼Œä»è€Œå®ç°å„VLANçš„è¿é€šã€‚ä¸€èˆ¬é…ç½®VLANæ¥å£ï¼Œæ˜¯åœ¨æ ¸å¿ƒäº¤æ¢æœºä¸Šï¼Œæœ¬æ‹“æ‰‘å›¾å³ä¸ºLSW1ã€‚PC1åˆ°PC4è¡¥å……ä¸Šå¯¹åº”çš„ç½‘å…³ï¼Œå³SVIçš„IPåœ°å€\n\nåœ¨`yjxLSW1`é…ç½®ç½‘å…³\n\n`yjxLSW1`\n\n```\nun te mo\nsys\nsysname yjxLSW1\nvlan batch 10 20\nint vlan 10\nip address 192.168.1.254 24\nint vlan 20\nip address 192.168.2.254 24\ndis ip int br\n```\n\n![image-20250303103425485](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/bf638dda0a427599b7facbeafef84f1d55933597-1748227909930-28.png)\n\n\n\næœ€åLSW1,3,4å…¨éƒ¨é€€å›åˆ°ç”¨æˆ·è§†å›¾ï¼Œä¿å­˜\n\n```\nsave\n```\n\n\n\n### ç»™pc1-pc4é…ç½®ç½‘å…³\n\n![image-20250303103611183](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/6f0f66b5e080e4081007e5b622467be455933597-1748227909930-30.png)\n\n## ç¬¬ä¸‰å‘¨\n\nå¼€å¯è¿™ä¸¤å°æœº\n\n![image-20250310103803318](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/6c69495e42ae2701c2136512119c754255933597-1748227909930-31.png)\n\né…ç½®é“¾è·¯èšåˆ\n\n==yjxLSW1==\n\n```\nun te mo\nsys\nsysname yjxLSW1\nint Eth-Trunk 1\nport link-type trunk\nport trunk allow-pass vlan 10 20\nint Eth-Trunk 1\nmode lacp-static\nmax active-linknumber 2\ntrunkport g0/0/3\ntrunkport g0/0/4\ntrunkport g0/0/6\n```\n\n==yjxLSW2==\n\n```\nun te mo\nsys\nsysname yjxLSW2\nint Eth-Trunk 1\nport link-type trunk\nport trunk allow-pass vlan 10 20\nint Eth-Trunk 1\nmode lacp-static\nmax active-linknumber 2\ntrunkport g0/0/3\ntrunkport g0/0/4\ntrunkport g0/0/6\n```\n\nä¸¤ä¸ªäº¤æ¢æœºä¸€èµ·æ‰“\n\n```\ndis eth-trunk\n```\n\n![image-20250310104555440](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/bc704ac9cc58aec6dce362f34840875355933597-1748227909930-29.png)\n\n\n\nå½“è¿æ¥GE0/0/3çš„çº¿è·¯å‡ºç°é—®é¢˜æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä½¿ç”¨GE0/0/4å’ŒGE0/0/6ç«¯å£çš„çº¿è·¯ã€‚\n\nåœ¨æ­¤å®éªŒä¸­ï¼Œæ‰‹å·¥å°†GE0/0/3çš„çº¿è·¯åˆ é™¤ï¼Œå†æ˜¾ç¤ºé“¾è·¯èšåˆçš„çŠ¶æ€ä¿¡æ¯\n\n`å³é”®çº¿è·¯åˆ é™¤ï¼Œæ³¨æ„å¦‚æœ3å£è¿˜åœ¨è¯´æ˜ä½ åˆ é”™äº†ï¼Œè¿å›æ¥`\n\n<video src='https://blog.qianyios.top/video/1.mov ' type='video/mp4' controls='controls'  width='100%' height='100%'>\n</video>\n\nä½ æµ‹è¯•å®Œè®°å¾—åŠ å›æ¥\n\n![image-20250310110704741](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/98a5e41d80168d04ae163c297dc1b50955933597-1748227909930-32.png)\n\nç„¶åä¿å­˜å…³æœº\n\n![image-20250310110857985](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/1e54448afa4040e50d14e3b2420f20bf55933597-1748227909930-33.png)\n\n## ç¬¬å››å‘¨\n\næœ¬å®éªŒé€šè¿‡é…ç½®åŠ¨æ€è·¯ç”±RIPåè®®ï¼Œå®ç°å†…ç½‘å…¨ç½‘äº’é€šã€‚\n\nåˆ é™¤ä¸‰æ¡é“¾è·¯èšåˆçš„çº¿ï¼Œå¹¶ä¸”å¼€èµ·åœˆå†…çš„æœºå­\n\n![image-20250317102313698](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/199e1ddf3594a387342b2665bd8f998d697559838-1748227909930-34.png)\n\nå¼€å¯å†…ç½‘çš„æ‰€æœ‰è®¾å¤‡ï¼šR1ã€LSW1ã€LSW2ã€LSW3ã€LSW4ï¼ŒServe1åŠå†…ç½‘PCã€‚ä¸ºé¿å…ç¯è·¯å½±å“ï¼Œæœ¬æ¬¡å®éªŒå°†è¿æ¥LSW1ä¸LSW2çš„èšåˆé“¾è·¯ï¼ˆå³å¿ƒè·³çº¿ï¼‰å…ˆåˆ é™¤æ–­å¼€ã€‚\n\n### ä»»åŠ¡1 \n\n é…ç½®LSW1ã€LSW2ã€LSW3ã€LSW4çš„VLANåº“ï¼Œç«¯å£å±æ€§ï¼Œç«¯å£å½’å±ã€‚å…¶ä¸­\n`yjxLSW1`çš„VLANåº“æœ‰VLAN 10ï¼ŒVLAN 20ï¼ŒVLAN 110\n\n```\nun te mo\nsys\nvlan 110\ndis vlan\n```\n\n![image-20250317103437160](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/13af7aeb9df6c4d47710e89177640318697559838-1748227909930-35.png)\n\n`yjxLSW2`çš„VLANåº“æœ‰VLAN 10ï¼ŒVLAN 20ï¼ŒVLAN 120\n\n```\nun te mo\nsys\nvlan 120\ndis vlan\n```\n\n![image-20250317103545921](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/1ad09c4c23dfc6ab63a267e9460ed349697559838-1748227909930-36.png)\n\n`yjxLSW3`çš„VLANåº“æœ‰VLAN 10ï¼ŒVLAN 20 ï¼ˆä¹‹å‰å·²é…ç½®ï¼‰\n\n![image-20250317103613515](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/3bdf78890a9e3d96b5e50831fc952176697559838-1748227909930-37.png)\n\n`yjxLSW4`çš„VLANåº“æœ‰VLAN 10ï¼ŒVLAN 20 ï¼ˆä¹‹å‰å·²é…ç½®ï¼‰\n\n![image-20250317103646879](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/fa904e9f3edc24644d9313c5579ea1a8697559838-1748227909930-38.png)\n\n`yjxLSW1`ä¸­ï¼ŒGE0/0/1å£å’ŒGE0/0/2å£ä¸ºTrunkå£ï¼Œå…è®¸VLAN 10å’ŒVLAN 20é€šè¿‡\n         GE0/0/5å£ä¸ºAccesså£ï¼Œå½’å±VLAN 110\n         Eth-Trunk1ä¸ºTrunkå£ï¼Œå…è®¸VLAN 10å’ŒVLAN 20é€šè¿‡ï¼ˆä¹‹å‰å·²é…ç½®ï¼‰\n\n```\nun te mo\nsys\nvlan batch 10 20\nint g0/0/1\nport link-type trunk\nport trunk allow-pass vlan 10 20\nint g0/0/2\nport link-type trunk\nport trunk allow-pass vlan 10 20\nint g0/0/5\nport link-type access\nport default vlan 110\ndis vlan\n```\n\n![image-20250317104212732](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/0bab0c3793163cea4ed239b3ddc9ce57697559838-1748227909930-39.png)\n\n`yjxLSW2`ä¸­ï¼ŒGE0/0/1å£å’ŒGE0/0/2å£ä¸ºTrunkå£ï¼Œå…è®¸VLAN 10å’ŒVLAN 20é€šè¿‡\n         GE0/0/5å£ä¸ºAccesså£ï¼Œå½’å±VLAN 120\n         Eth-Trunk1ä¸ºTrunkå£ï¼Œå…è®¸VLAN 10å’ŒVLAN 20é€šè¿‡\n\n```\nun te mo\nsys\nvlan batch 10 20\nint g0/0/1\nport link-type trunk\nport trunk allow-pass vlan 10 20\nint g0/0/2\nport link-type trunk\nport trunk allow-pass vlan 10 20\nint g0/0/5\nport link-type access\nport default vlan 120\ndis vlan\n```\n\n![image-20250317104415034](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/312ef1450dccb3a950c8ac0a0102ce54697559838-1748227909930-40.png)\n\n`yjxLSW3`ä¸­ï¼ŒGE0/0/3å£å’ŒGE0/0/4å£ä¸ºTrunkå£ï¼Œå…è®¸VLAN 10å’ŒVLAN 20é€šè¿‡ï¼ˆ3å£ä¹‹å‰å·²é…ç½®ï¼‰\n         GE0/0/1å£å’ŒGE0/0/5å£ä¸ºAccesså£ï¼Œå½’å±VLAN 10ï¼ˆä¹‹å‰å·²é…ç½®ï¼‰\n         GE0/0/2å£ä¸ºAccesså£ï¼Œå½’å±VLAN 20ï¼ˆä¹‹å‰å·²é…ç½®ï¼‰\n\n```\nun te mo\nsys\nint g0/0/4\nport link-type trunk\nport trunk allow-pass vlan 10 20\ndis vlan\n```\n\n![image-20250317104629802](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/43db48908c9fce2b2f0050f3f310541b697559838-1748227909930-41.png)\n\n`yjxLSW4`ä¸­ï¼ŒGE0/0/3å£å’ŒGE0/0/4å£ä¸ºTrunkå£ï¼Œå…è®¸VLAN 10å’ŒVLAN 20é€šè¿‡ï¼ˆ3å£ä¹‹å‰å·²é…ç½®ï¼‰\n         GE0/0/1å£ä¸ºAccesså£ï¼Œå½’å±VLAN 10ï¼ˆä¹‹å‰å·²é…ç½®ï¼‰\n         GE0/0/2å£ä¸ºAccesså£ï¼Œå½’å±VLAN 20ï¼ˆä¹‹å‰å·²é…ç½®ï¼‰\n\n```\nun te mo\nsys\nint g0/0/4\nport link-type trunk\nport trunk allow-pass vlan 10 20\ndis vlan\n```\n\n![image-20250317104723213](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/e67b5ae75a921f30bac119318015fea5697559838-1748227909930-42.png)\n\n### ä»»åŠ¡2\n\nç»™AR1è·¯ç”±å™¨çš„4ä¸ªç«¯å£é…ç½®IPåœ°å€ï¼›ç»™LSW1çš„VLAN10ã€VLAN20ã€VLAN110é…ç½®IPåœ°å€ï¼›ç»™LSW2çš„VLAN10ã€VLANã€VLAN120é…ç½®IPåœ°å€ã€‚éµè¡Œæœªæ˜ç¡®æŒ‡ç¤ºçš„æƒ…å†µä¸‹ï¼ŒIPåœ°å€æœ€åä¸€ä¸ªå­—èŠ‚ï¼šå·¦è¾¹ä¸º1ï¼Œå³è¾¹ä¸º2ï¼›ä¸‹é¢ä¸º1ï¼Œä¸Šé¢ä¸º2ã€‚\n\n`yjxAR1`\n\n```\nun te mo\nsys\nsysname yjxAR1\nint g0/0/2\nip address 10.1.3.2 30\nint g0/0/1\nip address 10.1.1.2 30\nint g0/0/0\nip address 10.1.2.2 30\nint g4/0/0\nip address 10.12.100.10 24\ndis ip in br\n```\n\n![image-20250317110002377](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/e52ea8b0d1fff544edcfc8e48e6cadb6697559838-1748227909930-43.png)\n\n`yjxLSW1`\n\n```\nun te mo\nsys\nint vlan 10\nip address 192.168.1.253 24\nint vlan 20\nip address 192.168.2.253 24\nint vlan 110\nip address 10.1.1.1 30\ndis ip in br\n```\n\n![image-20250317110135608](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/cc84ec15f041f03a7c2feb6c48e7ff63697559838-1748227909930-44.png)\n\n`yjxLSW2`\n\n```\nun te mo\nsys\nint vlan 10\nip address 192.168.1.252 24\nint vlan 20\nip address 192.168.2.252 24\nint vlan 120\nip address 10.1.2.1 30\ndis ip in br\n```\n\n![image-20250317110421476](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/a33c55496075f7ff29d9bbfb6d8af6e4697559838-1748227909930-45.png)\n\n### ä»»åŠ¡3\n\nç»™AR1ã€LSW1ã€LSW2é…ç½®ä½¿ç”¨åŠ¨æ€è·¯ç”±åè®®RIPv2ï¼Œ\n\nserver1é…ç½®IPåœ°å€10.1.3.1  ç½‘å…³10.1.3.2\n\nå¤„äºVLAN 10çš„PCæ‰‹åŠ¨åˆ‡æ¢ç½‘å…³ä¸º 1.253æˆ–è€…1.252\n\nå¤„äºVLAN 20çš„PCæ‰‹åŠ¨åˆ‡æ¢ç½‘å…³ä¸º 2.253æˆ–è€…2.252\n\né…ç½®å®Œæˆåï¼Œå†…ç½‘å…¨ç½‘äº’ç›¸èƒ½Pingé€šï¼Œé€šè¿‡æ˜¾ç¤ºè·¯ç”±è¡¨ä¿¡æ¯ç¡®å®šç»“æœã€‚\n\n![image-20250317110843239](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/c22b2b11bf3dcfc102f44b9b9282cb6f697559838-1748227909930-46.png)\n\n![image-20250317111117963](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/a58004bc5bb3ca6cfd2814dbaf6a1f9c697559838-1748227909930-47.png)\n\nè¦ç‚¹ä¿å­˜å“ˆ\n\n![image-20250317111255584](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/334cfe7f15a68519abb00b38abcddef3697559838-1748227909930-49.png)\n\né…ç½®ripåè®®\n\n`yjxAR1`\n\né…ç½®AR1è·¯ç”±å™¨ä½¿ç”¨RIPåè®®ï¼Œå¦‚æœç›´æ¥æŒ‰ç…§æ‹“æ‰‘å›¾ç»™çš„ç½‘ç»œåœ°å€é…ç½®ï¼Œå¦‚æ­¤å‘½ä»¤[yjxAR1-rip-1]network 10.1.1.0å°†ä¼šæç¤ºå‡ºé”™\n\nåŸå› æ˜¯Error: The network address is invalid, and the specified address must be major-net address without any subnets.  \n\né”™è¯¯ï¼šç½‘ç»œåœ°å€æ— æ•ˆï¼ŒæŒ‡å®šçš„åœ°å€å¿…é¡»æ˜¯ä¸»ç½‘åœ°å€ï¼Œä¸èƒ½åŒ…å«ä»»ä½•å­ç½‘ã€‚\n\n```\nsys\nrip 1\nversion 2\nnetwork 10.0.0.0\n```\n\n`yjxLSW1`\n\n```\nsys\nrip 1\nversion 2\nnetwork 10.0.0.0\nnetwork 192.168.1.0\nnetwork 192.168.2.0\n```\n\n`yjxLSW2`\n\n```\nsys\nrip 1\nversion 2\nnetwork 10.0.0.0\nnetwork 192.168.1.0\nnetwork 192.168.2.0\n```\n\n\n\n`yjxAR1`\n\n```\ndis ip rou\n```\n\n![image-20250317111850525](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/7142e9524bb82c8b5a526e211107c8a0697559838-1748227909930-48.png)\n\n`yjxLSW1`\n\n```\ndis ip rou\n```\n\n![image-20250317112027035](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/ab21cd00346ece309bea350c734a0537697559838-1748227909930-51.png)\n\n`yjxLSW2`\n\n```\ndis ip rou\n```\n\n![image-20250317112233934](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/e4d61fcff663719063e949ff82c079d6697559838-1748227909930-50.png)\n\n### æµ‹è¯•äº’é€š\n\npc1 ping pc3å’Œpc4\n\n![image-20250317112619242](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/89ea3a8cf4c69db7dbe5b3c2bbe8ba0c697559838-1748227909930-52.png)\n\npc1 ping client1å’Œpc2\n\n![image-20250317112707434](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/076261b7976e1a3ced0ee4545019cf06697559838-1748227909930-53.png)\n\npc1 ping `yjxAR1`å’Œserver\n\n![image-20250317112818902](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/b648c5fdc74797c5c46fec89099e6869697559838-1748227909930-54.png)\n\npc2 ping `yjxAR1`å’Œserver\n\n![image-20250317112900397](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/d09fe38558bd7918d34d3fd820b9aa9d697559838-1748227909930-55.png)\n\npc3 ping `yjxAR1`å’Œserver\n\n![image-20250317112934357](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/611b3c80f83600476fbc6f7800c4fac3697559838-1748227909930-56.png)\n\npc4 ping `yjxAR1`å’Œserver\n\n![image-20250317113014981](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/64c90e343dfe2b5509014d5618bd92cc697559838-1748227909930-57.png)\n\né…ç½®ä¿å­˜ï¼Œç»™ä½ æ‰€æœ‰çš„äº¤æ¢æœºè·¯ç”±å™¨è¾“å…¥saveï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†\n\n## ç¬¬äº”å‘¨\n\nå¼€è¿™å‡ å°\n\n![image-20250324114250347](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/6c0319418d8dcd3eade76e9a03347d65697559838-1748227909930-58.png)\n\n\n\nç›®çš„ï¼šç»™LSW1å’ŒLSW2é…ç½®VRRPï¼Œç»™VLAN 10å’ŒVLAN 20é…ç½®ä¸åŒçš„è™šæ‹Ÿè·¯ç”±å¤‡ä»½ç»„ï¼Œæ—¢æœ‰ä¸»å¤‡å¤‡ä»½åŠŸèƒ½ï¼Œåˆæœ‰è´Ÿè½½åˆ†æ‹…åŠŸèƒ½ã€‚\n\n![image-20250324114656727](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/227efaaa2be816d1cbacf2c413e31952697559838-1748227909930-59.png)\n\nå¯ä»¥è¿˜å¾ˆæ¸…æ™°çš„çœ‹å‡ºï¼Œä¸¤ä¸ªåŒºåŸŸçš„pcèµ°çš„æ˜¯å„è‡ªçš„ç½‘å…³\n\n`yjxLSW1`\n\n```\nsys\nun in en\nint vlan 10\nvrrp vrid 10 virtual-ip 192.168.1.254\nvrrp vrid 10 priority 120\nvrrp vrid 10 preempt-mode time delay 20\nint vlan 20\nvrrp vrid 20 virtual-ip 192.168.2.254\nvrrp vrid 20 preempt-mode time delay 20\n```\n\n`yjxLSW2`\n\n```\nsys\nun in en\nint vlan 10\nvrrp vrid 10 virtual-ip 192.168.1.254\nvrrp vrid 10 preempt-mode time delay 20\nint vlan 20\nvrrp vrid 20 virtual-ip 192.168.2.254\nvrrp vrid 20 priority 120\nvrrp vrid 20 preempt-mode time delay 20\n```\n\n\n\n`yjxLSW1`\n\n```\ndisplay vrrp interface Vlanif 10\ndisplay vrrp interface Vlanif 20\n```\n\n![image-20250324115420322](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/ac098a8faf3cd39e3e4a5113834e671e697559838-1748227909930-60.png)\n\n`yjxLSW2`\n\n```\ndisplay vrrp interface Vlanif 10\ndisplay vrrp interface Vlanif 20\n```\n\n![image-20250324115448980](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/577d9161784eac9d970f75abdd672d2c697559838-1748227909930-61.png)\n\næ‰€æœ‰PCä¿®æ”¹ç½‘å…³ï¼Œè®°å¾—ç‚¹å‡»`åº”ç”¨å’Œä¿å­˜`\n\n![image-20250324115802110](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/c4255a301b81e38c189a206a6a8b208a697559838-1748227909930-62.png)\n\néªŒè¯pc\n\n![image-20250324120346164](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/bb6437d87baf30e3cfd173ad093e0548697559838-1748227909930-63.png)\n\nå®éªŒå¯çŸ¥é€šè¿‡é…ç½®vrrpå®ç°`yjxLSW1`å’Œ`yjxLSW2`ä¹‹é—´æ„å»ºè™šæ‹Ÿipï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿç½‘å…³ï¼Œç„¶åpcè®¾ç½®è¿™ä¸ªè™šæ‹Ÿç½‘å…³ï¼Œè¾¾åˆ°è´Ÿè½½å‡è¡¡ï¼Œä¸”æœ‰ä¸»å¤‡-å¤‡ä»½åŠŸèƒ½ã€‚å°±æ˜¯åŸæœ¬æœ‰ä¸¤ä¸ªç½‘å…³çš„ï¼Œ192.168.1.253å’Œ192.168.2.252,å¦‚æœ`yjxLSW1`å’Œ`yjxLSW2`ä¹‹é—´ä¸€å°æŒ‚äº†ï¼Œå°±æ²¡åŠæ³•ä¸æœåŠ¡å™¨é€šä¿¡äº†ï¼Œè¿™æ—¶å€™é€šè¿‡vrrpæ„å»ºè™šæ‹Ÿip192.168.1.254å’Œ192.168.2.254å®ç°äº†ä¸»å¤‡å®¹ç¾\n\n\n\nç„¶åç»™`yjxLSW1`å’Œ`yjxLSW2`è¿›è¡Œsaveä¿å­˜\n\n## ç¬¬å…­å‘¨\n\n![image-20250331100556696](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/0bc526d53bcd4b037ce3ce144536658b55933597-1748227909930-64.png)\n\nå¼€è¿™å‡ å°\n\n==ä»»åŠ¡1==ï¼šä½¿ç”¨display stp brief å‘½ä»¤æŸ¥çœ‹LSW1ã€LSW2ã€LSW3ã€LSW4äº¤æ¢æœºå„ç«¯å£åœ¨ç”Ÿæˆæ ‘ä¸­çš„è§’è‰²ã€‚ç”»å‡ºå¤„äºå·¥ä½œçŠ¶æ€çš„ç”Ÿæˆæ ‘çš„ç»“æ„å›¾ï¼Œæç¤ºï¼šä¿ç•™æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£å³å¯å¾—åˆ°ã€‚\n\n==ä»»åŠ¡2==ï¼šç»™LSW1ä¸LSW2çš„3æ ¹è¿çº¿ï¼ˆå¿ƒè·³çº¿ï¼‰æ¥ä¸Šï¼Œå†ä½¿ç”¨display stp brief å‘½ä»¤æŸ¥çœ‹LSW1ã€LSW2ã€LSW3ã€LSW4äº¤æ¢æœºå„ç«¯å£åœ¨ç”Ÿæˆæ ‘ä¸­çš„è§’è‰²ã€‚ç”»å‡ºå¤„äºå·¥ä½œçŠ¶æ€çš„ç”Ÿæˆæ ‘çš„ç»“æ„å›¾ï¼Œæç¤ºï¼šä¿ç•™æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£å³å¯å¾—åˆ°ã€‚\n\n```\ndis stp br\n```\n\n![image-20250331110550315](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/3851243db001df69c80dee646e88b9ef55933597-1748227909930-65.png)\n\n==ä»»åŠ¡3==ï¼šé…ç½®å¤šç”Ÿæˆæ ‘åè®®(MSTP)ã€‚å®ä¾‹1çš„æ ¹æ¡¥ä¸ºLSW1ï¼Œå¤‡ä»½æ ¹æ¡¥ä¸ºLSW2ï¼›å®ä¾‹2çš„æ ¹æ¡¥ä¸ºLSW2ï¼Œå¤‡ä»½æ ¹æ¡¥ä¸ºLSW1ã€‚å°†VLAN 10æ˜ å°„åˆ°å®ä¾‹1ï¼›å°†VLAN 20æ˜ å°„åˆ°å®ä¾‹2ã€‚æœ€åæŸ¥çœ‹å®ä¾‹0ã€å®ä¾‹1ã€å®ä¾‹2å„è‡ªå·¥ä½œçŠ¶æ€ä¸­æ„æˆçš„ç”Ÿæˆæ ‘ã€‚æ–¹æ³•ï¼šæŸ¥çœ‹å„äº¤æ¢æœºå„å®ä¾‹å„ç«¯å£çš„è§’è‰²ï¼Œä¿ç•™æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£å³å¯å¾—åˆ°ã€‚\n\n\n\n![image-20250331110647682](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/d9cf06474ee52145d1bc6102b456a5dc55933597-1748227909930-66.png)\n\n`yjxLSW1`\n\n`region-name yanjiaxi`æ”¹æˆä½ çš„åå­—\n\n```\nsys\nun in en\nstp mode mstp\nstp region-configuration\nregion-name yanjiaxi\ninstance 1 vlan 10\ninstance 2 vlan 20\nactive region-configuration\nstp instance 1 root primary\nstp instance 2 root secondary\n```\n\n`yjxLSW2`\n\n`region-name yanjiaxi`æ”¹æˆä½ çš„åå­—\n\n```\nsys\nun in en\nstp region-configuration\nregion-name yanjiaxi\ninstance 1 vlan 10\ninstance 2 vlan 20\nactive region-configuration\nstp instance 1 root secondary\nstp instance 2 root primary\n```\n\n`yjxLSW3`\n\n`region-name yanjiaxi`æ”¹æˆä½ çš„åå­—\n\n```\nsys\nun in en\nstp region-configuration\nregion-name yanjiaxi\ninstance 1 vlan 10\ninstance 2 vlan 20\nactive region-configuration\n```\n\n`yjxLSW4`\n\n`region-name yanjiaxi`æ”¹æˆä½ çš„åå­—\n\n```\nsys\nun in en\nstp region-configuration\nregion-name yanjiaxi\ninstance 1 vlan 10\ninstance 2 vlan 20\nactive region-configuration\n```\n\n`yjxLSW1`\n\n```\ndisplay stp region-configuration\n```\n\n![image-20250331111445105](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/58529292e4ca556b132bc3dca22b4fe455933597-1748227909930-67.png)\n\n```\ndis stp br\n```\n\n![image-20250331111904934](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/dc73c6294bdb9b96453bdfc1cff9920055933597-1748227909930-68.png)\n\nå››ä¸ªäº¤æ¢æœºä¿å­˜é…ç½®\n\n## ç¬¬ä¸ƒå‘¨\n\nå¼€è¿™å‡ å°\n\n![image-20250407103733464](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/38f262d0c2921ed04155f0cf1fbafee755933597-1748227909930-69.png)\n\n`ä»»åŠ¡1ï¼šç½‘ç»œæ‹“æ‰‘å›¾ä¸­ï¼ŒAR2ä¸ºå‡ºå£è·¯ç”±å™¨ï¼ŒAR1ä¸AR2ä¹‹é—´çš„ç½‘ç»œå±äºå†…ç½‘ã€‚é…ç½®AR2ä½¿ç”¨RIPåè®®å…¬å‘Šä¸AR1ç›¸è¿çš„ç½‘æ®µï¼Œæ³¨æ„ä¸è¦å…¬å‘Šå¤–ç½‘ã€‚`\n\n`yjxAR2`\n\n```\nsys\nun in en\nrip 1\nversion 2\nnetwork 10.0.0.0\n```\n\npc1  ping 10.12.100.20\n\n![image-20250407103152119](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/d9a53e47a3c3e02401c3d6cd3bcfefee55933597-1748227909931-70.png)\n\n`ä»»åŠ¡2ï¼šAR2ä¸Šé…ç½®SSHæœåŠ¡ç«¯ï¼ŒAR1ä¸Šé…ç½®SSHå®¢æˆ·ç«¯`\n\n`è¯´æ˜ï¼šAAAä¸º3Aè®¤è¯ï¼Œå³ï¼šè®¤è¯(Authentication)ï¼›æˆæƒ(Authorization)ï¼›è®¡å¸(Accounting)ã€‚`\n\n`yjxAR2`\n\n```\n#ç”Ÿæˆæœ¬åœ°å¯†é’¥å¯¹ï¼ŒSSHéœ€è¦ä½¿ç”¨å¯†é’¥å¯¹è¿›è¡ŒåŠ å¯†é€šä¿¡\nsys\nun in en\nrsa local-key-pair create\n\n```\n\n![image-20250407103357952](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/ad32c5d84133d18ebc988e0edc7b3be555933597-1748227909931-71.png)\n\n`ssh040`æ˜¯æˆ‘çš„å­¦å·ï¼Œè‡ªå·±æ”¹\n\n```\nstelnet server enable\naaa\nlocal-user ssh040 password cipher 123456\nlocal-user ssh040 privilege level 15\nlocal-user ssh040 service-type ssh\n#è¿™é‡Œç”¨allå’Œpasswordå¯ä»¥ï¼Œç”¨å…¶ä»–ä¸¤ç§ä¸å¯ä»¥ã€‚å› ä¸ºå¦‚æœä½¿ç”¨å¯†é’¥éªŒè¯ï¼Œéœ€è¦åœ¨PCæœºä¸Šç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶å°†å…¬é’¥æ‹·è´è‡³ç½‘ç»œè®¾å¤‡ã€‚\nssh user ssh040 authentication-type password   \n#é…ç½®VTYæ¥å£ï¼ŒVTYæ¥å£ç”¨äºç®¡ç†è¿œç¨‹ç™»å½•ã€‚é…ç½®VTYæ¥å£æ”¯æŒSSHåè®®ï¼š\nuser-interface vty 0 4\nauthentication-mode aaa\nprotocol inbound ssh\n```\n\n`yjxAR1`\n\n```\nsys\nun in en\nssh client first-time enable \nstelnet 10.12.100.20\n#è¾“å…¥ç”¨æˆ·åï¼Œç„¶åæŒ‰ä¸¤æ¬¡yï¼Œç„¶åè¾“å…¥å¯†ç \n```\n\n![image-20250414183853166](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/d94a5feda7347f5ed51033e9dd64d85455933597-1748227909931-72.png)\n\nåœ¨AR1ç™»å…¥ä¹‹åå˜æˆAR2å°±è¡Œ\n\n\n\næœ€åä¸¤ä¸ªè·¯ç”±å™¨ä¿å­˜é…ç½®\n\n\n\n## ç¬¬å…«å‘¨\n\nå¼€è¿™å‡ å°\n\n![image-20250414103345248](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/37c0f9851b3c01a4163f399ab4075cc555933597-1748227909931-73.png)\n\n==ä»»åŠ¡1==ï¼š åœ¨LSW1ä¸LSW2åˆ†åˆ«é…ç½®é»˜è®¤è·¯ç”±æŒ‡å‘AR1,AR1é…ç½®é»˜è®¤è·¯ç”±æŒ‡å‘AR2,AR2é…ç½®é»˜è®¤è·¯ç”±æŒ‡å‘AR3ã€‚\n\n`yjxAR1`\n\n```\nsys\nun in en\nip route-static 0.0.0.0 0 10.12.100.20\n```\n\n`yjxLSW1`\n\n```\nsys\nun in en\nip route-static 0.0.0.0 0 10.1.1.2\n```\n\n`yjxLSW2`\n\n```\nsys\nun in en\nip route-static 0.0.0.0 0 10.1.2.2\n```\n\n`yjxAR2`\n\n```\nsys\nun in en\nip route-static 0.0.0.0 0 23.1.1.2\n```\n\n\n\n\n\n==ä»»åŠ¡2==ï¼šåœ¨AR2é…ç½®é™æ€NAT,æŠŠæœåŠ¡å™¨Server1 10.1.3.1æ˜ å°„ä¸ºå…¬ç½‘çš„23.1.1.5ï¼Œç”¨äºå…¬ç½‘èƒ½è®¿é—®ã€‚\n\næœªé…ç½®å‰å…ˆæµ‹è¯•ï¼ŒAR1è·¯ç”±å™¨ã€Server1éƒ½æ— æ³•Pingé€šå¤–ç½‘\n\n![image-20250414101431253](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/edc583974c8b4db839232ff53f627e5955933597-1748227909931-74.png)\n\nåŒç† Server1ä¸èƒ½Pingé€š23.1.1.2\n\n\n\n`yjxAR2`\n\né…ç½®é™æ€NATæ˜ å°„ï¼šå°†å†…ç½‘IPåœ°å€æ˜ å°„åˆ°å¤–ç½‘IPåœ°å€\n\n```\nsys\nun in en\nnat static global 23.1.1.5 inside 10.1.3.1\ninterface Serial 4/0/0\nnat static enable \n```\n\né…ç½®åå†æµ‹è¯•ï¼ŒAR1è·¯ç”±å™¨ä¸å¤–ç½‘æ˜¯ä¸é€šçš„ï¼Œä½†æ˜¯Server1èƒ½Pingé€šå¤–ç½‘\n\n<yjxAR1>ping 23.1.1.2\n\n<yjxAR3>ping 23.1.1.5\n\n![image-20250414101859678](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/e187118cd657a55c044e1a1c5aa2cc6a55933597-1748227909931-76.png)\n\n```\nsys\nun in en\ndisplay nat static \n```\n\n![image-20250414101928655](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/3d787accfcd680a59d99b745d0d177e355933597-1748227909931-75.png)\n\n==ä»»åŠ¡3==ï¼šé…ç½®PATæŠŠå†…ç½‘IPæ˜ å°„åˆ°ç«¯å£S4/0/0ï¼Œå®ç°å†…ç½‘èƒ½å¤Ÿè®¿é—®å¤–ç½‘ã€‚\n\næœªé…ç½®å‰ï¼Œå…ˆæµ‹è¯•\n\n<yjxAR1>ping 23.1.1.2\n\n![image-20250414102011547](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/9305d5d2365a01c247d319c57dd05aca55933597-1748227909931-77.png)\n\nåŒç† PC1ä¸èƒ½Pingé€š23.1.1.2\n\n\n\né…ç½®ACL\n\n`yjxAR2`\n\n```\nsys\nun in en\nacl number 2000\nrule 0 permit source 192.168.1.0 0.0.0.255\nrule 1 permit source 192.168.2.0 0.0.0.255\n```\n\né…ç½®NAT Outbound\n\n`yjxAR2`\n\nåœ¨å¤–ç½‘æ¥å£ä¸Šåº”ç”¨ACLï¼Œå¹¶å¯ç”¨NAT OutboundåŠŸèƒ½ã€‚\n\n```\ninterface Serial 4/0/0\nnat outbound 2000\n```\n\n\n\né…ç½®åï¼ŒAR1è·¯ç”±å™¨æ˜¯ä¸èƒ½è®¿é—®å¤–ç½‘çš„ï¼Œè¡¨æ˜å†…ç½‘ä¸å¤–ç½‘æ˜¯åˆ†éš”å¼€çš„ã€‚ä½†æ˜¯PCæœºå·²ç»èƒ½è®¿é—®å¤–ç½‘ï¼Œè¡¨æ˜NATé…ç½®æˆåŠŸã€‚\n\n<yjxAR1>ping 23.1.1.2\n\n![image-20250414102208876](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/1663d5a1656c84cac8eb783c99511b9d55933597-1748227909931-78.png)\n\nä½†æ˜¯ï¼š PC1èƒ½Pingé€š23.1.1.2\n\n![image-20250414102242346](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/4026746463c770655de27416a2933aa855933597-1748227909931-79.png)\n\n\n\n`yjxAR2`\n\n```\ndisplay acl 2000\ndisplay nat outbound\n```\n\n![image-20250414102335893](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/42a43afce15b74266e4f73bf91e4d9d955933597-1748227909931-80.png)\n\n\n\n==ä»»åŠ¡4==ï¼šç”¨Server1å¯¹AR3çš„Serial4/0/0å£è¿›è¡ŒPingæµ‹è¯•ï¼ŒæŠ“åŒ…æŸ»çœ‹NATåœ°å€æ˜¯å¦è½¬æ¢æˆåŠŸï¼Ÿ\n\nåœ¨AR2çš„Serial4/0/0å£ä¸ŠæŠ“å–çš„PingåŒ…å¦‚ä¸‹ï¼š\n\n![image-20250414102417955](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/bc727a4ba8b9c4577019e514ad8b7c8a55933597-1748227909931-82.png)\n\n![image-20250414102721815](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/ad21d63e84f00e71a6ad681bde3eb6ac55933597-1748227909931-81.png)\n\n![image-20250414102655443](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/8366964d05e63a3f667f43e74b6a491955933597-1748227909931-83.png)\n\nAR3  ping 23.1.1.5\n\n\n\n\n\nåœ¨AR1çš„GE4/0/0å£æˆ–è€…AR2çš„GE0/0/0å£ï¼ŒæŠ“å–çš„PingåŒ…å¦‚ä¸‹ï¼š\n\nä¸¤ä¸ªæ¥å£äºŒé€‰ä¸€ï¼Œç„¶åæŠ“åŒ…ï¼Œä¸ä¼šæ‰“å¼€å°±å»çœ‹å‰é¢............\n\nAR3  ping 23.1.1.5\n\n![image-20250414103205695](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/efff7ceba08d8882b2685a8b724ae94d55933597-1748227909931-84.png)\n\n\n\næœ€åæ‰€æœ‰é…ç½®è¿‡çš„äº¤æ¢æœºè·¯ç”±å™¨ä¿å­˜\n\n## ç¬¬ä¹å‘¨\n\n![image-20250421102200269](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/63b6113642ad6df3203a4c31b31b5c8055933597-1748227909931-85.png)\n\n==ä»»åŠ¡0==ï¼šæŒæ¡å•è‡‚è·¯ç”±çš„åŸç†ï¼Œé…ç½®æ–¹æ³•ä»¥åŠåº”ç”¨åœºåˆã€‚é…ç½®å‰ï¼šæµ‹è¯•ä¸åŒVLANçš„è¿é€šæƒ…å†µï¼Œä¾‹å¦‚PC7ä¸PC8çš„è¿é€šæƒ…å†µã€‚\n\n![image-20250421102219871](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/713ea5804f461930b64247f00eb4885055933597-1748227909931-86.png)\n\n==ä»»åŠ¡1==ï¼šåœ¨äº¤æ¢æœºLSW6ä¸Šé…ç½®VLANï¼ŒVLANåº“æœ‰VLAN50ä¸VLAN60ã€‚GE0/0/1å£ä¸ºTrunkå£ï¼ŒGE0/0/2ä¸GE0/0/3ä¸ºAccesså£ã€‚\n\n`yjxLSW6`\n\n```\nsys\nsysname yjxLSW6\nun in en\nvlan batch 50 60\ninterface GigabitEthernet 0/0/1\nport link-type trunk \nport trunk allow-pass vlan 50 60\ninterface GigabitEthernet 0/0/2\nport link-type access \nport default vlan 50\ninterface GigabitEthernet 0/0/3\nport link-type access \nport default vlan 60\n```\n\n==ä»»åŠ¡2==ï¼šåœ¨è·¯ç”±å™¨AR5ä¸Šé…ç½®å­æ¥å£ï¼Œå­æ¥å£é€šè¿‡ä½¿ç”¨802.1qåè®®ä¸å¯¹åº”çš„VLANè¿›è¡Œè¯†åˆ«ç»‘å®šï¼Œç»™å­æ¥å£é…ç½®IPåœ°å€ã€‚æ­¤åœ°å€ä½œä¸ºå¯¹åº”VLANç½‘æ®µçš„ç½‘å…³ã€‚\n\n`yjxAR5`\n\n```\nsys\nun in en\nint g0/0/2.5\ndot1q termination vid 50\nip add 192.168.8.1 24\narp broadcast enable\nint g0/0/2.6\ndot1q termination vid 60\nip add 192.168.9.1 24\narp broadcast enable\n```\n\n![image-20250421102649709](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/f2ee1855fe464bb889f5834e1712624255933597-1748227909931-87.png)\n\n\n\nè‡ªå·±ä¿å­˜é…ç½®\n\n## ç¬¬åå‘¨\n\n![image-20250421102200269](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/63b6113642ad6df3203a4c31b31b5c8055933597-1748227909931-85.png)\n\n==ä»»åŠ¡1==ï¼šå‚è€ƒä¸Šä¸€å‘¨çš„å•è‡‚è·¯ç”±å®éªŒï¼Œåœ¨äº¤æ¢æœºLSW5ä¸€ä¾§çš„ç½‘ç»œï¼Œé…ç½®å•è‡‚è·¯ç”±ã€‚\n\n1ï¼‰åœ¨äº¤æ¢æœºLSW5ä¸Šé…ç½®VLANï¼ŒVLANåº“æœ‰VLAN30ä¸VLAN40ã€‚GE0/0/1å£ä¸ºTrunkå£ï¼ŒGE0/0/2ã€GE0/0/3ä¸GE0/0/5ä¸ºAccesså£ã€‚åŒæ—¶é…ç½®ç«¯å£åŠ å…¥åˆ°ç›¸åº”çš„VLANä¸­ã€‚\n\n`yjxLSW5`\n\n```\nsys\nsysname yjxLSW5\nun in en\nvlan batch 30 40\ninterface GigabitEthernet 0/0/1\nport link-type trunk \nport trunk allow-pass vlan 30 40\ninterface GigabitEthernet 0/0/2\t\nport link-type access \nport default vlan 30\ninterface GigabitEthernet 0/0/3\nport link-type access \nport default vlan 40\ninterface GigabitEthernet 0/0/5\t\nport link-type access \nport default vlan 40\n```\n\n2ï¼‰åœ¨AR5ä¸Šé…ç½®å•è‡‚è·¯ç”±ï¼Œåœ¨è·¯ç”±å™¨AR5ä¸Šé…ç½®å­æ¥å£ï¼Œå­æ¥å£é€šè¿‡ä½¿ç”¨802.1qåè®®ä¸å¯¹åº”çš„VLANè¿›è¡Œè¯†åˆ«ç»‘å®šï¼Œç»™å­æ¥å£é…ç½®IPåœ°å€ã€‚æ­¤åœ°å€ä½œä¸ºå¯¹åº”VLANç½‘æ®µçš„ç½‘å…³ã€‚\n\n`yjxAR5`\n\n```\nsys\nun in en\ninterface GigabitEthernet 0/0/1.30\ndot1q termination vid 30\nip address 172.16.1.254 24\narp broadcast enable \ninterface GigabitEthernet 0/0/1.40\ndot1q termination vid 40\nip address 172.16.2.254 24\narp broadcast enable \n```\n\n\n\n==ä»»åŠ¡2==ï¼šåœ¨AR5è·¯ç”±å™¨ä¸Šé…ç½®DHCPæœåŠ¡ã€‚\n\n`AR5`\n\n1. å¯ç”¨ DHCP åŠŸèƒ½ ï¼Œå…¨å±€å¯ç”¨ DHCP æœåŠ¡ï¼š\n\n```\nsys\ndhcp enable \n```\n\n2. é…ç½® DHCP åœ°å€æ± ï¼Œä¸ºæ¯ä¸ª VLAN åˆ›å»º DHCP åœ°å€æ± ï¼Œé…ç½®ç½‘å…³ã€DNS å’Œ IP åœ°å€èŒƒå›´\n   é…ç½® VLAN30 çš„ DHCP åœ°å€æ± \n\n```\nip pool vlan30\nnetwork 172.16.1.0 mask 24 \ngateway-list 172.16.1.254\ndns-list 8.8.8.8 \nip pool vlan40\nnetwork 172.16.2.0 mask 255.255.255.0\ngateway-list 172.16.2.254\ndns-list 8.8.8.8\nexcluded-ip-address 172.16.2.2\n```\n\n#excluded-ip-address 172.16.2.2   //æ­¤å¤„æ’é™¤çš„IPï¼Œæ˜¯ç•™ç»™ç»ˆç«¯Client2\n\n3. åœ¨å­æ¥å£ä¸Šå¯ç”¨ DHCP æœåŠ¡ï¼Œåœ¨æ¯ä¸ªå­æ¥å£ä¸Šå¯ç”¨ DHCP æœåŠ¡ï¼Œé€‰æ‹©ä½¿ç”¨å…¨å±€åœ°å€æ± \n\n```\ninterface GigabitEthernet 0/0/1.30\ndhcp select global\ninterface GigabitEthernet 0/0/1.40\ndhcp select global \n```\n\n\n\n==ä»»åŠ¡3==ï¼š åœ¨LSW5äº¤æ¢æœºä¸Šé…ç½®DHCP SnoopingåŠŸèƒ½      // snoop v. ç›‘å¬ã€ç›‘æ§\n\n`yjxLSW5`\n\n1ï¼‰åœ¨LSW5äº¤æ¢æœºä¸Šå¼€å¯å…¨å±€DHCP ä»¥åŠDHCP Snooping\n\n```\nsys\ndhcp enable\ndhcp snooping enable\n```\n\n![image-20250427102650308](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/6d4bfe11fcb054b7ac3b5a6225998af855933597-1748227909931-88.png)\n\n2ï¼‰LSW5äº¤æ¢æœºGE0/0/1ã€GE0/0/2ã€GE0/0/3æ¥å£å¼€å¯ dhcp snoopingï¼Œæ­¤æ—¶é»˜è®¤æƒ…å†µä¸‹æ¥å£ä¸ºéä¿¡ä»»æ¥å£ï¼Œåªèƒ½å‘é€DHCPè¯·æ±‚åŒ…ï¼Œæ— æ³•æ¥æ”¶DHCPåº”ç­”åŒ…\n\n```\ninterface GigabitEthernet 0/0/1\ndhcp snooping enable \ninterface GigabitEthernet 0/0/2\ndhcp snooping enable \ninterface GigabitEthernet 0/0/3\ndhcp snooping enable\n```\n\nPC å…ˆæ‰§è¡ŒPC>ipconfig /releaseï¼Œå†æ‰§è¡ŒPC>ipconfig /renewå‘ç°æ— æ³•è·å–åˆ°IPåœ°å€ã€‚\n\n![image-20250427102822305](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/add194f389af8566cbe231ded1b6e7ba55933597-1748227909931-89.png)\n\n![image-20250427102858111](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/9de3ff00b9bdf131d48152afcb3b657355933597-1748227909931-90.png)\n\n![image-20250427103528337](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/84ea0d61deab47db75837fcf824ac44455933597-1748227909931-91.png)\n\n![image-20250427103013064](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/5dcdfb53206487e103d71b142eaa0ec755933597-1748227909931-92.png)\n\n3ï¼‰é…ç½®äº¤æ¢æœºGE0/0/1å£ä¸ºä¿¡ä»»æ¥å£\n\n```\ninterface GigabitEthernet 0/0/1\ndhcp snooping trusted \n```\n\n![image-20250427103043056](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/9d989beb946c73400534bd0360d7930455933597-1748227909931-93.png)\n\nPC5   æ‰§è¡ŒPC>ipconfig /renewå‘ç°ç°åœ¨å¯ä»¥è·å–åˆ°IPåœ°å€ã€‚\n\n![image-20250427103102411](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/b2b4c4f730a00c3d44d745f46e9a731455933597-1748227909931-94.png)\n\n![image-20250427103230620](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/c75df24325f4c418697322a59204e48355933597-1748227909931-95.png)\n\n4ï¼‰æŸ¥çœ‹ç¡®è®¤dhcp snoopingçš„é…ç½®\n\n`yjxLSW5`\n\n```\ndisplay dhcp snooping configuration \n```\n\n![image-20250427103309370](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/0c8fcaf5489a912da4b169991628804655933597-1748227909931-96.png)\n\næµ‹è¯•pc5  ping å…¶ä»–æœºå­\n\n![image-20250427103738557](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/a2af960ecdffbd25a58101580bc06e3855933597-1748227909931-97.png)\n\nç„¶åäº¤æ¢æœºï¼Œè·¯ç”±å™¨ä¿å­˜é…ç½®\n\n## ç¬¬åä¸€å‘¨\n\nå¼€AR3å’ŒAR2å°±è¡Œ\n\n### ä»»åŠ¡ä¸€\n\n==ä»»åŠ¡1==ï¼šåœ¨AR3è·¯ç”±å™¨ä¸Šé…ç½®PPPè®¤è¯ï¼ŒAR3ä¸ºè®¤è¯æ–¹ï¼ŒAR2ä¸ºè¢«è®¤è¯æ–¹ã€‚\n\n`yjxAR3`\n\n1. åœ¨AR3è·¯ç”±å™¨çš„Serial 4/0/0å£é…ç½®PPPè®¤è¯çš„æ–¹å¼ä¸ºPAP\n\n```\nsys\nun in en\ninterface Serial 4/0/0\nppp authentication-mode pap\nq\n```\n\n2. åœ¨AR3è·¯ç”±å™¨çš„aaaè§†å›¾ä¸‹ï¼Œåˆ›å»ºç”¨æˆ·R2ï¼ŒæœåŠ¡ç±»å‹ä¸ºpppã€‚\n\n```\naaa\nlocal-user R2 password cipher 123456\nlocal-user R2 service-type ppp\nq\n```\n\n3. æ£€æŸ¥AR2è·¯ç”±å™¨çš„æ¥å£çŠ¶æ€ï¼Œç‰¹åˆ«ç•™æ„Serial4/0/0å£çš„ç‰©ç†çŠ¶æ€å’Œåè®®çŠ¶æ€ã€‚\n\n`yjxAR2`\n\n```\ndisplay ip interface brief\n```\n\n![image-20250428101132391](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/ab5af551e88ae5f314835e92fef1d3b055933597-1748227909931-98.png)\n\n4. åœ¨AR3è·¯ç”±å™¨ä¸Šï¼Œé‡å¯Serial4/0/0å£ã€‚\n\n`yjxAR3`\n\n```\nsys\nun in en\ninterface Serial 4/0/0\nshutdown\nundo shutdown\n```\n\n5. å†æ¬¡æ£€æŸ¥AR2è·¯ç”±å™¨çš„æ¥å£çŠ¶æ€ï¼Œç‰¹åˆ«ç•™æ„Serial4/0/0å£çš„ç‰©ç†çŠ¶æ€å’Œåè®®çŠ¶æ€ã€‚\n\n`yjxAR2`\n\n```\ndisplay ip interface brief\n```\n\n![image-20250428101229218](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/b60622f21dd8b05fd2b4e8649fcef14255933597-1748227909931-99.png)\n\n**è§‚å¯Ÿç»“æœ** ï¼šAR2ä¸AR3æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œé“¾è·¯ç‰©ç†çŠ¶æ€æ­£å¸¸ï¼Œä½†é“¾è·¯å±‚åè®®çŠ¶æ€ä¸æ­£å¸¸ï¼ŒPingå‘½ä»¤æ— æ³•é€šè¿‡ã€‚è¿™æ˜¯å› ä¸ºPPPé“¾è·¯ä¸Šçš„PAPè®¤è¯æœªé€šè¿‡ï¼Œéœ€è¦åœ¨è¢«è®¤è¯æ–¹AR2ä¸Šé…ç½®ç›¸å…³PAPè®¤è¯å‚æ•°ã€‚\n\n\n\n6. åœ¨AR2ä¸Šçš„S4/0/0æ¥å£ä¸‹ï¼Œä½¿ç”¨PPP pap local-userå‘½ä»¤é…ç½®æœ¬ç«¯è¢«å¯¹ç«¯ä»¥PAPæ–¹å¼éªŒè¯æ—¶æœ¬åœ°å‘é€çš„PAPç”¨æˆ·åå’Œå¯†ç ã€‚\n\n`yjxAR2`\n\n```\nsys\nun in en\ninterface Serial 4/0/0\nppp pap local-user R2 password cipher 123456\n```\n\n7. é…ç½®å®Œæˆåï¼Œç­‰å¾…`20ç§’ä»¥ä¸Š`ï¼Œå†æ¬¡æŸ¥çœ‹é“¾è·¯çŠ¶æ€å¹¶æµ‹è¯•è¿é€šæ€§ã€‚ç‰¹åˆ«ç•™æ„Serial4/0/0å£çš„ç‰©ç†çŠ¶æ€å’Œåè®®çŠ¶æ€ã€‚\n\n`yjxAR2`\n\n```\ndisplay ip interface brief\n```\n\nè¾“å‡ºç¤ºä¾‹ï¼š\n\n![image-20250428101908555](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/d510f3e962c3f661dca8f551e744a21855933597-1748227909931-100.png)\n\n### ä»»åŠ¡äºŒ\n\nä»»åŠ¡2ï¼šç½‘ç»œç®¡ç†å‘˜å‘ç°ç½‘ç»œé¢‘ç¹é­å—æ”»å‡»ï¼Œå› ä¸ºPAPè®¤è¯çš„å¯†ç ä¸ºæ˜æ–‡çš„ï¼Œå¯†ç ç»å¸¸è¢«ç›—ç”¨ï¼Œé‚å°†PPPè®¤è¯çš„æ–¹å¼ç”±PAPæ”¹ä¸ºCHAPã€‚\n\n1ï¼‰é¦–å…ˆï¼Œåˆ é™¤åŸæœ‰çš„PAPè®¤è¯é…ç½®\n\n`yjxAR3`\n\n```\ninterface Serial 4/0/0\nundo ppp authentication-mode\n```\n\n\n\n`yjxAR2`\n\n```\ninterface Serial 4/0/0\nundo ppp pap local-user\n```\n\n2ï¼‰å†é‡æ–°é…ç½®CHAPè®¤è¯é…ç½®\n\n`yjxAR3`\n\n```\ninterface Serial 4/0/0\nppp authentication-mode chap\n```\n\n[ä¿ç•™ç»§ç»­ä½¿ç”¨ä»»åŠ¡1](../img/) åœ¨aaaè§†å›¾ä¸‹é…ç½®çš„ç”¨æˆ·åR1ä¸å¯†ç ã€‚æ­¤æ—¶å¯ä¸ç”¨é‡å¤é…ç½®ã€‚\n\n \n\n3ï¼‰åœ¨AR3è·¯ç”±å™¨ä¸Šï¼Œé‡å¯Serial4/0/0å£ã€‚\n\n`yjxAR3`\n\n```\ninterface Serial 4/0/0\nshutdown\nundo shutdown\n```\n\n4ï¼‰æ£€æŸ¥AR2è·¯ç”±å™¨çš„æ¥å£çŠ¶æ€ï¼Œç‰¹åˆ«ç•™æ„Serial4/0/0å£çš„ç‰©ç†çŠ¶æ€å’Œåè®®çŠ¶æ€ã€‚\n\n `yjxAR2`\n\n```\ndisplay ip interface brief\n```\n\nå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œç°åœ¨AR2ä¸AR3æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œé“¾è·¯ç‰©ç†çŠ¶æ€æ­£å¸¸ï¼Œä½†æ˜¯é“¾è·¯å±‚åè®®çŠ¶æ€ä¸æ­£å¸¸ï¼Œç”¨Pingå‘½ä»¤å°†æ— æ³•Pingé€šã€‚è¿™æ˜¯å› ä¸ºæ­¤æ—¶PPPé“¾è·¯ä¸Šçš„CHAPè®¤è¯æœªé€šè¿‡ï¼Œç°åœ¨ä»…ä»…é…ç½®äº†è®¤è¯æ–¹è®¾å¤‡AR3ï¼Œè¿˜éœ€è¦åœ¨è¢«è®¤è¯æ–¹AR2ä¸Šé…ç½®ç›¸å…³CHAPè®¤è¯å‚æ•°ã€‚\n\n![image-20250428102011262](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/1e3b1f43d0adfa2b60bd6eabdb17278c55933597-1748227909931-101.png)\n\n\n\n5)åœ¨AR2ä¸Šçš„S4/0/0æ¥å£ä¸‹ï¼Œä½¿ç”¨PPP chap å‘½ä»¤é…ç½®æœ¬ç«¯è¢«å¯¹ç«¯ä»¥CHAPæ–¹å¼éªŒè¯æ—¶æœ¬åœ°å‘é€çš„ç”¨æˆ·åå’Œå¯†ç ã€‚\n\n`yjxAR2`\n\n```\ninterface Serial 4/0/0\nppp chap user R2\nppp chap password cipher 123456\n```\n\né…ç½®å®Œæˆåï¼Œç­‰å¾…20ç§’ä»¥ä¸Š\n\n6)å†æ¬¡æŸ¥çœ‹é“¾è·¯çŠ¶æ€å¹¶æµ‹è¯•è¿é€šæ€§ã€‚ç‰¹åˆ«ç•™æ„Serial4/0/0å£çš„ç‰©ç†çŠ¶æ€å’Œåè®®çŠ¶æ€ã€‚\n\n`yjxAR2`\n\n```\ndisplay ip interface brief\n```\n\n![image-20250428102159442](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/d47dcb807cd1a9982fd296c2d37d711555933597-1748227909931-102.png)\n\n ä¸¤ä¸ªè·¯ç”±å™¨ä¿å­˜é…ç½®\n\n## ç¬¬åäºŒå‘¨\n\nå…¨å¼€\n\nä»»åŠ¡1ï¼šå¯¹ç½‘æ®µ AR2-AR3ã€AR3-AR4ã€AR4-AR5 é…ç½® OSPF è·¯ç”±åè®®å®ç°äº’é€š\n`yjxAR2 é…ç½®`\n\nå‡ºå£è·¯ç”±å™¨éœ€è¦é…ç½®é»˜è®¤è·¯ç”±æŒ‡å‘äº’è”ç½‘\n\n```\nsys\nun in en\nip route-static 0.0.0.0 0.0.0.0 23.1.1.2\n```\n\n`yjxAR3 é…ç½®`\n\n```\nsys\nun in en\nospf 1\narea 0\nnetwork 23.1.1.0 0.0.0.255\nnetwork 34.1.1.0 0.0.0.3\n```\n\n`yjxAR4 é…ç½®`\n\n```\nsys\nun in en\nospf 1\narea 0\nnetwork 34.1.1.0 0.0.0.3\nnetwork 45.1.1.0 0.0.0.3\n```\n\n`yjxAR5 é…ç½®`\n\n```\nsys\nun in en\nospf 1\narea 0\nnetwork 45.1.1.0 0.0.0.3\n```\n\næ£€æŸ¥`å„è·¯ç”±å™¨`é…ç½®\n\n```\nsys\nun in en\ndis ip rou\n```\n\n![image-20250512164824056](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/14ff46ce283aaf3e1319151b271f7b8855933597-1747040057649-109-1748227909931-103.png)\n\n![image-20250512164845058](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/5ea16826f96ebadfffdab74ea8e0148255933597-1747040057649-110-1748227909931-104.png)\n\n![image-20250512164908759](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/efb652fb44d7aea10338c878f5a67c3655933597-1747040057649-111-1748227909931-105.png)\n\nä»»åŠ¡2ï¼šå¯¹ç½‘æ®µ AR3-AR6 é…ç½® OSPF è·¯ç”±åè®®è¿›è¡Œé€šå‘Šç½‘æ®µï¼Œå¹¶åˆ’åˆ†åˆ°åŒºåŸŸ 1\n`yjxAR3 é…ç½®`\n\n```\nsys\nun in en\ninterface GigabitEthernet 0/0/1\nip address 36.1.1.2 30\n\nospf 1\narea 1\nnetwork 36.1.1.0 0.0.0.3\n```\n\n`yjxAR6 é…ç½®`\n\n```\nsys\nun in en\nsysname yjxAR6\ninterface GigabitEthernet 0/0/0\nip address 36.1.1.1 30\n\ninterface GigabitEthernet 0/0/1\nip address 10.10.2.2 30\n\nospf 1\narea 1\nnetwork 36.1.1.0 0.0.0.3\n```\n\næ£€æŸ¥`AR5`èƒ½å¦å­¦ä¹ åˆ°area1çš„è·¯ç”±\n\n```\nsys\nun in en\ndis ip rou\n```\n\n![image-20250512164926169](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/d8451f011e397106446f84f0565a689b55933597-1747040057649-112-1748227909931-106.png)\n\n\n\nä»»åŠ¡3ï¼šAR3 ä¸ AR6 ä¹‹é—´é…ç½® OSPF è®¤è¯\n\nåœ¨ AR3ã€AR6 ä¹‹é—´é…ç½® OSPFçš„æ¥å£è®¤è¯ï¼Œè®¤è¯æ¨¡å¼ä¸º MD5 è®¤è¯ã€‚æµ‹è¯•è®¤è¯å‰åç½‘ç»œçš„è¿é€šæ€§ã€‚AR3 å’Œ AR6 çš„é…ç½®å®Œå…¨ä¸€æ ·ã€‚åŒä¸€ç½‘æ®µçš„æ¥å£è®¤è¯æ¨¡å¼å’Œå£ä»¤å¿…é¡»ç›¸åŒï¼Œä¸åŒç½‘æ®µå¯ä»¥ä¸åŒã€‚ç¼ºçœæƒ…å†µä¸‹ï¼ŒOSPFæ¥å£æ²¡æœ‰é…ç½®è®¤è¯æ–¹å¼ã€‚å»ºè®®é…ç½®è®¤è¯æ–¹å¼ï¼Œå¦åˆ™ç³»ç»Ÿå¯èƒ½ä¸å®‰å…¨ã€‚\n\n`yjxAR3 é…ç½®`\n\n```\nsys\nun in en\ninterface GigabitEthernet 0/0/1\nospf authentication-mode md5 1 cipher jwk\nshutdown\nundo shutdown\n```\n\n`yjxAR6 é…ç½®`\n\n```\nsys\nun in en\ninterface GigabitEthernet 0/0/0\nospf authentication-mode md5 1 cipher jwk\n```\n\n\n\næµ‹è¯•ä¸å¤–ç½‘äº’é€š\n\n`AR6`å’Œ`pc1`  ping   AR5\n\n```\nping 45.1.1.2\n```\n\n![image-20250512165005600](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/dfd1ae7d984f9fac529039dcf63cfb1255933597-1747040057649-113-1748227909931-107.png)\n\n![image-20250512165024885](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/59b1fa49d189894b5d548e45b34f1b5955933597-1747040057649-114-1748227909931-108.png)\n\nä¿å­˜é…ç½®ï¼Œæ¶‰åŠå•¥è·¯ç”±å™¨è‡ªå·±ä¿å­˜\n\n\n\n## ç¬¬åä¸‰å‘¨\n\nå…¨å¼€\n\n\n\n`ä»»åŠ¡ 0`: ç†è§£ NAT é…ç½®ç›¸å…³çŸ¥è¯†(`ä¸ç”¨åš`)\n\n- **nat outbound** â€”â€” é…ç½®æº NAT (SNAT)ï¼Œç”¨äºå†…ç½‘ç”¨æˆ·è®¿é—®å¤–ç½‘ï¼ˆé€šå¸¸ç»“åˆ ACL æˆ–åœ°å€æ± ä½¿ç”¨ï¼‰ã€‚\n- **nat server** â€”â€” é…ç½®ç›®çš„ NATï¼ˆç«¯å£æ˜ å°„ï¼‰ï¼Œå…è®¸å¤–ç½‘è®¿é—®å†…ç½‘æœåŠ¡å™¨ï¼ˆå¦‚ Webã€FTP ç­‰ï¼‰ã€‚\n- **nat static** â€”â€” é…ç½®é™æ€ NATï¼ˆä¸€å¯¹ä¸€æ˜ å°„ï¼‰ï¼Œå°†å…¬ç½‘ IP ç›´æ¥æ˜ å°„åˆ°å†…ç½‘ IPï¼ŒåŒå‘å¯è¾¾ã€‚\n\n```plaintext\n[zsAR6-GigabitEthernet0/0/0]nat ?\n    outbound      Specify net address translation\n    server        Specify NAT server\n    static        Specify static NAT\n```\n\næ³¨æ„äº‹é¡¹\næ¥å£ç±»å‹:nat outbound å’Œnatserver éœ€é…ç½®åœ¨è¿æ¥å…¬ç½‘çš„æ¥å£ã€‚\n\nACL æ§åˆ¶:å»ºè®®ç”¨ ACLé™åˆ¶ natserver çš„è®¿é—®æ¥æºï¼Œé¿å…æš´éœ²å†…ç½‘æœåŠ¡ã€‚\n\nALG å…¼å®¹æ€§:FTPã€SIP ç­‰åè®®ä¾èµ– ALGï¼Œè‹¥å¼‚å¸¸å¯å°è¯• nat alg ftp disable å…³é—­è°ƒè¯•\n\nä¼˜å…ˆçº§:nat static>na tserver>nat outboundï¼Œå†²çªæ—¶æŒ‰ä¼˜å…ˆçº§ç”Ÿæ•ˆã€‚\n\n\n\n`ä»»åŠ¡ 1: é…ç½®è·¯ç”±å™¨ç«¯å£ä¸æœåŠ¡å™¨çš„ IP åœ°å€`\n\n- AR6 è·¯ç”±å™¨è¡¥é½å…¨ç«¯å£ IP åœ°å€ GE0/0/1 çš„ IP åœ°å€ä¸º 10.10.2.2\n\n`yjxAR6`\n\n```\nint g0/0/1\nip address 10.10.2.2 30\n```\n\n- Server2 é…ä¸Š IP åœ°å€ï¼š10.10.2.1 255.255.255.252 å…³è”å¯¹ç«¯è·¯ç”±å™¨ç«¯å£åœ°å€ 10.10.2.2\n\n`Server2`\n\n![image-20250519100213703](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250519100213703-1748227909931-109.png)\n\n\n\n`ä»»åŠ¡ 2: åœ¨ AR5 å’Œ AR6 é…ç½® PAT æŠŠå†…ç½‘ IP æ˜ å°„åˆ°è·¯ç”±å™¨çš„å¤–ç½‘ç«¯å£ GE0/0/0ï¼Œå®ç°å†…ç½‘èƒ½å¤Ÿè®¿é—®å¤–ç½‘ã€‚`\n\n1) é…ç½®è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰\n\n`yjxAR6`\n\n```\nsys\nun in en\nacl 2000\nrule 0 permit source 10.10.20.0 0.0.0.3\n```\n\n2) å¯ç”¨ NAT Outbound åŠŸèƒ½ï¼Œå¹¶å…³è”ç›¸åº”çš„ ACL\n\n`yjxAR6`\n\n```\nint g0/0/0\nnat outbound 2000\n```\n\n3) é…ç½®æ¨¡å— 2 çš„å‡ºå£è·¯ç”±å™¨ AR5\n\n`yjxAR5`\n\n```\nsys\nun in en\nacl 2000\nrule 0 permit source 192.168.8.0 0.0.0.255\nrule 2 permit source 192.168.9.0 0.0.0.255\nrule 3 permit source 172.16.1.0 0.0.0.255\nrule 4 permit source 172.16.2.0 0.0.0.255\nint g0/0/0\nnat outbound 2000\n```\n\npc5  ping  ï¼ˆpc8 ï¼ŒAR2ï¼Œar6ï¼‰\n\n![image-20250519102747669](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250519102747669-1748227909931-111.png)\n\n`ä»»åŠ¡ 3: Server2 å¼€å¯ HTTPã€FTP æœåŠ¡ã€‚æ¨¡å—äºŒçš„å®¢æˆ·ç«¯å¯ä»¥è·å–åˆ° Server2 çš„å…±äº«æ–‡ä»¶ã€‚`\n1.é…ç½®ç«¯å£æ˜ å°„\n\n`yjxAR6`\n\n```\nint g0/0/0\nnat server protocol tcp global current-interface ftp inside 10.10.2.1 ftp\nè¾“å…¥y\nnat server protocol tcp global current-interface www inside 10.10.2.1 www\nè¾“å…¥y\n```\n\n2.å¯ç”¨ FTP åè®®ä¾èµ–çš„ NAT ALG\n\n`yjxAR6`\n\n```\nq\nnat alg ftp enable\n```\n\nåœ¨æœåŠ¡å™¨ Server2 ä¸Šå°† HttpServerå’Œ FtpServer å¯åŠ¨ï¼Œç›®å½•æ–‡ä»¶å¤¹æ”¾å…¥æ–‡ä»¶ã€‚ ç„¶ååœ¨æ¨¡å— 2ä¸­ï¼Œç”¨å®¢æˆ·ç«¯è¿›è¡Œ HTTP å’Œ FTP çš„è®¿é—®æµ‹è¯•ã€‚\n\nåœ¨ä½ ç”µè„‘æ‰¾ä¸ªä½ç½®åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å’Œæµ‹è¯•æ–‡ä»¶\n\n![image-20250519101727675](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250519101727675-1748227909931-110.png)\n\nåœ¨server2å¼€å¯ä¸¤ä¸ªæœåŠ¡\n\n![image-20250519101755684](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250519101755684-1748227909931-112.png)\n\n![image-20250519101815459](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250519101815459-1748227909931-113.png)\n\nåœ¨client2è¿›è¡Œæµ‹è¯•\n\n![image-20250519102958121](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250519102958121-1748227909931-114.png)\n\n![image-20250519103024881](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250519103024881-1748227909931-115.png)\n\nar5å’Œar6è¿›è¡Œä¿å­˜\n\n## ç¬¬åå››å‘¨\n\nä»»åŠ¡ 1:é…ç½®è®¿é—®æ§åˆ¶åˆ—è¡¨ACLï¼Œåªå…è®¸client2å¯ä»¥è®¿é—®æœåŠ¡å™¨server 2ï¼Œæ‹’ç»å…¶å®ƒç½‘ç»œè®¿é—®\n\n1)åœ¨è·¯ç”±å™¨ AR6 é…ç½® ACL,åªå…è®¸æ¥è‡ªç½‘æ®µ 45.1.1.0,ä¹Ÿå°±æ˜¯ AR4-AR5 ç½‘æ®µçš„æ•°æ®æµé‡é€šè¿‡åº”ç”¨åœ¨GE0/0/0å£ï¼Œåœ¨è¿™é‡Œæ˜¯ä½œä¸ºæµé‡äººå£inboundæ–¹å‘ï¼Œåœ¨è¿™é‡Œæ³¨æ„ï¼Œåº”ç”¨åœ¨è·¯ç”±å™¨ä¸åŒçš„æ¥å£(ç«¯å£)ï¼Œéœ€è¦æ ¹æ®æ•°æ®æµé‡çš„æµåŠ¨æ–¹å‘ï¼Œæ¥åˆ¤æ–­æ­¤æ¥å£çš„æµé‡æ–¹å‘æ˜¯æµå…¥inboundè¿˜æ˜¯æµå‡º outbound.\n\n`yjxAR6`\n\n```\nsys\nun in en\nacl number 3000\nrule 5 permit tcp source 45.1.1.0 0.0.0.3 destination 36.1.1.0 0.0.0.3\nrule 10 deny tcp\nrule 15 permit ip\ninterface GigabitEthernet 0/0/0\ntraffic-filter inbound acl 3000\n```\n\n2)åœ¨è·¯ç”±å™¨ AR5é…ç½® ACL,åªå…è®¸æºIPä¸º 172.16.2.2çš„ç»ˆç«¯è®¿é—®ç›®æ ‡IPä¸º36.1.1.1çš„ç»ˆç«¯\n\n`yjxAR5`\n\n```\nsys\nun in en\nacl number 3000\nrule 5 permit tcp source 172.16.2.2 0 destination 36.1.1.1 0\nrule 10 deny tcp destination 36.1.1.1 0\nrule 15 permit ip\ninterface GigabitEthernet 0/0/1\ntraffic-filter inbound acl 3000\ninterface GigabitEthernet 0/0/2\ntraffic-filter inbound acl 3000\n```\n\n\n\næµ‹è¯•client2å¯ä»¥è®¿é—®server2\n\nè‡ªå·±å¼€å¯server2çš„æœåŠ¡\n\n![image-20250526102622981](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250526102622981.png)\n\n![image-20250526102830610](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250526102830610.png)\n\næµ‹è¯•client1è®¿é—®\n\n![image-20250526102848298](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250526102848298.png)\n\n![image-20250526103300144](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250526103300144.png)\n\næµ‹è¯•æ›´æ”¹pc7ä¸ºclient3ï¼Œçœ‹çœ‹æ˜¯å¦å¯è®¿é—®server2\n\næŠŠpc7åˆ é™¤æ›´æ¢ä¸ºclien3ï¼Œç„¶åé…ç½®å¥½ipåœ°å€ï¼Œç„¶åpc8è¿›è¡Œping  client3\n\n![image-20250526104644555](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250526104644555.png)\n\næµ‹è¯•clent3èƒ½å¦è®¿é—®server2\n\n![image-20250526105018859](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250526105018859.png)\n\n![image-20250526104747783](../img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E8%AF%BE%E7%A8%8B%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/image-20250526104747783.png)\n\nar6å’Œar5  save\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n","tags":["ensp"],"categories":["ç½‘ç»œ"]},{"title":"Ubuntu 24.04.02 LTS åˆå§‹åŒ–å®‰è£…","url":"/posts/14363/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Ubuntu 24.04.02 LTS åˆå§‹åŒ–å®‰è£…\n\né•œåƒä¸‹è½½\n\næ¡Œé¢ç‰ˆï¼š[ubuntu-24.04.2-desktop-amd64.iso](https://mirrors.aliyun.com/ubuntu-releases/24.04/ubuntu-24.04.2-desktop-amd64.iso)\n\næœ¬æ¬¡å®éªŒé€‰ç”¨çš„æ˜¯æ¡Œé¢ç‰ˆ\n\nä½¿ç”¨çš„è™šæ‹ŸåŒ–è½¯ä»¶ VMware Workstation\n\n## åˆ›å»ºè™šæ‹Ÿæœº\n\n![image-20250216234621886](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/dadbab8c4c0cd3456b6c645fb4c1833555933597.png)\n\n![image-20250216235038829](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/d367806b668c6e5502c83fd4ce3067b555933597.png)\n\n![image-20250216235127444](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/454ecb479c2bd7f4e8740b076a0d50a855933597.png)\n\n## åŠ è£…é•œåƒ\n\n![image-20250224102123784](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/a74d2ce5dd1c6ac9f5abffd2fbc9c1d255933597.png)\n\nå…ˆåˆ«å¯åŠ¨ï¼Œæ¥ä¸‹æ¥è®¾ç½®ç½‘ç»œ\n\n## é…ç½®NATç½‘å¡\n\n![image-20250216235854241](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/fc8a5b8aeacd7411d89b44e8a2ee1e0155933597.png)\n\n## å¼€å¯è™šæ‹Ÿæœºå®‰è£…ç³»ç»Ÿ\n\nå¯åŠ¨ä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªé»‘è‰²ç•Œé¢æœ‰ä¸€ä¸ªé€‰é¡¹æ˜¯`Try or install ubuntu`é»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªï¼Œç›´æ¥å›è½¦å°±è¡Œäº†\n\n![image-20250224102809642](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/94c3fe8b5e49032453ea0563dc70b1de55933597.png)\n\n![image-20250224103157744](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/75b18d3749fdd1d0c5d81327e5d9f8af55933597.png)\n\n![image-20250224103723948](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/ff2ddeda14b36431a5cf6ee96638707a55933597.png)\n\n![image-20250224103729945](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/73ec52b77cf17a109f5cee9b3e62ea6355933597.png)\n\n![image-20250224104437818](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/f8bdf6930bcd44484020de13e5260cf255933597.png)\n\n![image-20250224104653496](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/24b3172940a9f6704695ca7f2e2d342255933597.png)\n\n![image-20250224104755600](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/75a21f681d88045ca885e0203596338355933597.png)\n\nè¿™æ˜¯ä¸€ä¸ªç»ˆç«¯å·¥å…·ï¼Œæ¥ä¸‹æ¥æˆ‘å°±ä¸åœ¨è¿™é‡Œè¿è¡Œäº†ï¼Œæˆ‘ä¼šç»™å‡ºä»£ç ï¼Œä½ ç…§ç€åœ¨ä¸Šé¢é‚£å¼ å›¾è¿è¡Œå°±è¡Œäº†\n\n## è®¾ç½®rootç”¨æˆ·å¯†ç \n\n![image-20250224111329361](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/cff00927fb797792a6338ec46f2dca3155933597.png)\n\n```bash\n#å…è®¸rootç”¨æˆ·è¿œç¨‹ç™»å…¥\nsed -i '/^#PermitRootLogin prohibit-password/s/^#//' /etc/ssh/sshd_config\nsed -i '/^PermitRootLogin/s/prohibit-password/yes/' /etc/ssh/sshd_config\n```\n\n## é…ç½®é™æ€ip\n\nç›´æ¥å»é‚£ä¸ªç»ˆç«¯è¿è¡Œå°±è¡Œäº†ï¼Œæˆ‘ä¸æˆªå›¾äº†\n\nå®‰è£…å¿…è¦å·¥å…·\n\n```\nsudo apt-get install network-manager openssh-server vim inetutils-ping net-tools -y\n```\n\n\n\næŸ¥çœ‹éœ€è¦é…ç½®çš„ç½‘å¡ï¼Œè¾“å…¥\n\n```\nip a\n```\n\n![image-20250224111556813](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/59a6c999a44cc9d61bea086a707eac7055933597.png)\n\n```\nvim /etc/netplan/01-network-manager-all.yaml\n```\n\n```\n# Let NetworkManager manage all devices on this system\nnetwork:\n  ethernets:\n    ens33:\n      addresses: [192.168.48.128/24]\n      dhcp4: false\n      nameservers:\n          addresses: [192.168.48.2, 114.114.114.114]\n      routes:\n        - to: default\n          via: 192.168.48.2\n  version: 2\n  renderer: NetworkManager\n```\n\n![image-20250224111831503](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/897d5841d95db60479d7cb123aa3bc9d55933597.png)\n\nè¿™ä¸ªip`192.168.48.128`æœ€åä¸€ä½128ä½ éšæ„è®¾ç½®ï¼Œ192.168.48.è¿™æ˜¯ç½‘æ®µå¯¹åº”å‰é¢[é…ç½®NATç½‘å¡](#é…ç½®NATç½‘å¡)ä½ çš„ç½‘æ®µï¼Œè‡ªè¡Œä¿®æ”¹ï¼Œç½‘å…³ï¼ˆroutesï¼‰ä¹Ÿæ˜¯\n\næœ€åæŒ‰escï¼Œç„¶åæŒ‰shift+å†’å·é”®ï¼Œè¾“å…¥wqä¿å­˜é€€å‡º\n\n```\nnetplan apply\n```\n\n![image-20250224112149255](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/7c086b072f20d76608e5d8582385efae55933597.png)\n\né™æ€ipå·²ç»é…ç½®å¥½äº†\n\n## å…³é—­é˜²ç«å¢™\n\n**1. æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ï¼š**\n\nè¦æŸ¥çœ‹ Ubuntu ä¸­ `ufw` é˜²ç«å¢™çš„çŠ¶æ€ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\nsudo ufw status\n```\n\nè¿™å°†æ˜¾ç¤ºå½“å‰é˜²ç«å¢™è§„åˆ™çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æ˜¯å¦å¯ç”¨å’Œå…è®¸çš„è§„åˆ™ã€‚\n\n**2. å¼€å¯é˜²ç«å¢™ï¼š**\n\nå¦‚æœé˜²ç«å¢™æ²¡æœ‰å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯ç”¨ `ufw` é˜²ç«å¢™ï¼š\n\n```\nsudo ufw enable\n```\n\nå¯ç”¨é˜²ç«å¢™åï¼Œå®ƒå°†æŒ‰ç…§é»˜è®¤è§„åˆ™å¼€å§‹å·¥ä½œï¼Œé€šå¸¸ä¼šæ‹’ç»æ‰€æœ‰ä¼ å…¥è¿æ¥ï¼Œä½†å…è®¸æ‰€æœ‰ä¼ å‡ºè¿æ¥ã€‚\n\n**3. å…³é—­é˜²ç«å¢™ï¼š**\n\nè¦å…³é—­ `ufw` é˜²ç«å¢™ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\nsudo ufw disable\n```\n\n[å…³é—­é˜²ç«å¢™](https://so.csdn.net/so/search?q=å…³é—­é˜²ç«å¢™&spm=1001.2101.3001.7020)åï¼Œæ‰€æœ‰ä¼ å…¥å’Œä¼ å‡ºçš„è¿æ¥å°†è¢«å…è®¸ï¼Œä¸å†å—åˆ°é˜²ç«å¢™çš„é™åˆ¶ã€‚\n\n**4. æ°¸ä¹…å…³é—­é˜²ç«å¢™ï¼š**\n\nå¦‚æœæƒ³æ°¸ä¹…å…³é—­ `ufw` é˜²ç«å¢™ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n\n- åœæ­¢ `ufw` æœåŠ¡ï¼š\n\n  `sudo systemctl stop ufw`\n\n- ç¦ç”¨ `ufw` æœåŠ¡çš„è‡ªåŠ¨å¯åŠ¨ï¼š\n\n  `sudo systemctl disable ufw --now`\n\n- é‡å¯ç³»ç»Ÿï¼Œä»¥ç¡®ä¿é˜²ç«å¢™ä¸ä¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶é‡æ–°å¯ç”¨ã€‚\n\n## è®¾ç½®é˜¿é‡Œæº\n\nå…¨éƒ¨å¤åˆ¶ç²˜è´´å°±è¡Œäº†\n\n```\ncat >/etc/apt/sources.list<<\"EOF\"\ndeb https://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse\ndeb-src https://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse\n\ndeb https://mirrors.aliyun.com/ubuntu/ noble-security main restricted universe multiverse\ndeb-src https://mirrors.aliyun.com/ubuntu/ noble-security main restricted universe multiverse\n\ndeb https://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse\ndeb-src https://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse\n\n# deb https://mirrors.aliyun.com/ubuntu/ noble-proposed main restricted universe multiverse\n# deb-src https://mirrors.aliyun.com/ubuntu/ noble-proposed main restricted universe multiverse\n\ndeb https://mirrors.aliyun.com/ubuntu/ noble-backports main restricted universe multiverse\ndeb-src https://mirrors.aliyun.com/ubuntu/ noble-backports main restricted universe multiverse\nEOF\nsudo apt-get update\n```\n\n## è®¾ç½®æ¨¡æ¿\n\nè¿›è¡Œå…³æœº\n\n```\nsudo poweroff\n```\n\n![image-20250224114254416](../img/Ubuntu%2024.04%20LTS%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85/858eff2f17599b734b0922a961a3099d55933597.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n","tags":["Ubuntu"],"categories":["è¿ç»´"]},{"title":"ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ","url":"/posts/aaddb3d/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿï¼ˆCloudflare R2 + WebP Cloud + å›¾åºŠå·¥å…·ï¼‰\n\næ–‡ç« æ¥æºè‡ªï¼š[ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿï¼ˆCloudflare R2 + WebP Cloud + PicGoï¼‰ Â· Pseudoyu](https://www.pseudoyu.com/zh/2024/06/30/free_image_hosting_system_using_r2_webp_cloud_and_picgo/)\n\n## èƒŒæ™¯\n\né™†é™†ç»­ç»­ä¸¤ä¸‰å¹´äº†ï¼Œå»ºç«‹åšå®¢è‡³ä»Šä¹Ÿæœ‰è¯¸å¤šæ–‡ç« äº†ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å›¾ç‰‡å¦‚æœæ”¾åœ¨æœ¬åœ°æ˜¾ç¤ºä¼šå¾ˆæ…¢ï¼Œç‰¹åˆ«æ˜¯æ”¾åœ¨æœåŠ¡å™¨ï¼Œå¦‚æœæ²¡æœ‰cdnçš„è¯ï¼Œå°±æ²¡æœ‰å¦‚ä»Šçš„æ•ˆæœï¼Œæˆ‘ç°åœ¨çš„æ¨¡å¼å°±æ˜¯hexoï¼ˆgithub page+å…¬ç›Šcdnï¼‰ï¼Œåè¯äº†ï¼Œå…ˆå›åˆ°è¿™è¿™é‡Œï¼Œç”±äºå›¾ç‰‡ä¸€å¤šï¼Œé€ æˆå‘é€å›¾ç‰‡æºä½ç½®ç§»åŠ¨çš„è¯ï¼Œè¿˜è¦é‡æ–°æ‰¾ï¼Œç‰¹åˆ«æ˜¯æˆ‘åœ¨hexoé‡Œstaticä¸‹çš„imgæ–‡ä»¶å¤¹ï¼Œæœ¬èº«markdownæ˜¾ç¤ºçš„éƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç®¡ç†èµ·æ¥å¾ˆéº»çƒ¦ï¼Œå¦‚ä»Šæˆ‘äº†è§£åˆ°å›¾åºŠçš„æ¦‚å¿µï¼Œä¸ä½†å¯ä»¥ç»Ÿä¸€è¿›è¡Œç®¡ç†ï¼Œè¿˜èƒ½å‡å°‘åšå®¢ä»“åº“çš„ä½“ç§¯ï¼Œæå‡ç½‘ç«™é€Ÿåº¦ï¼Œï¼ˆè™½ç„¶æˆ‘ç°åœ¨ä¾ç„¶ä¿æŒç€ï¼Œæºå›¾å’Œæ–‡æ¡£åœ¨ä¸€èµ·ï¼Œæºå›¾ç‰‡ç›´æ¥ä¸Šä¼ åˆ°githubï¼Œæ¯•ç«Ÿä¸Šä¼ åˆ°åˆ«äººæœåŠ¡å™¨çš„æ•°æ®ï¼Œå°±æ€•çªç„¶æœ‰ä¸€å¤©å€’é—­äº†ï¼Œå°±æ²¡äº†ï¼Œæ‰€ä»¥æˆ‘ä¾ç„¶æœ‰ç€å¤‡ä»½åŸå›¾ç‰‡åœ¨æœ¬åœ°çš„ä¹ æƒ¯ï¼‰ï¼Œæ‰€ä»¥æˆ‘æ¥ä¸‹æ¥è®²çš„ï¼Œåªæ˜¯é€‚ç”¨äºï¼Œä¸é‚£ä¹ˆé‡è¦çš„é¡¹ç›®\n\n\n\n### é˜¿é‡Œäº‘OSS+Picgo\n\né˜¿é‡Œäº‘ossï¼Œæˆ‘ä¸ªäººä½¿ç”¨æ¥è¯´ï¼Œå¾ˆæ–¹ä¾¿ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œç»“åˆå›¾åºŠæ¥ä½¿ç”¨ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå°±æ˜¯å”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯å¤§å¤šéƒ½æ˜¯æŒ‰é‡ä»˜è´¹ï¼Œå¦‚æœå†…å®¹ä¸€å¤šï¼Œå¯¹äºæœ¬èº«å°±æ˜¯éç›ˆåˆ©æ€§çš„æˆ‘æ¥è¯´ï¼Œå°±å¾ˆä¸å¦¥å½“ï¼Œé€šè¿‡picgoæˆ–å…°ç©ºå›¾åºŠè¿›è¡Œä¸Šä¼ å›¾ç‰‡åˆ°é˜¿é‡Œäº‘ossï¼Œè®¿é—®é€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œé’ˆå¯¹å›½å†…ç”¨æˆ·çš„è®¿é—®é€Ÿåº¦æ˜æ˜¾æå‡ï¼ˆ`è´¹ç”¨ï¼šå­˜å‚¨åŠ å…¬ç½‘è®¿é—®æµé‡è´¹ç”¨`ï¼‰\n\nè¿˜æœ‰ä¸€ä¸ªåŠæ³•å°±æ˜¯è®¾ç½®åå‘ä»£ç†ï¼Œä½ éœ€è¦è´­ä¹°ä¸€å°åŒåŒºåŸŸçš„escï¼Œä¿æŒå’Œä½ å­˜å‚¨æ¡¶æ˜¯ä¸€ä¸ªåŒºåŸŸçš„ï¼Œè¿™æ ·ç»è¿‡çš„æµé‡å°±æ˜¯å†…ç½‘æµé‡ï¼Œä¸ä¼šè®¡è´¹ï¼Œä½†æ˜¯ä¼šè®¡ç®—å­˜å‚¨è´¹ç”¨\n\n## å›¾åºŠæ­å»ºè¯´æ˜\n\nCloudflare R2 + WebP Cloud + å›¾åºŠå·¥å…· çš„æ–¹æ¡ˆå°½ç®¡ç‰µæ‰¯åˆ°äº†å¤šä¸ªç»„ä»¶å’Œå¹³å°ï¼Œä½†æ‰€æœ‰æ“ä½œéƒ½åœ¨ Free Plan ä¸­ï¼Œä¹Ÿæ˜¯æˆ‘æœ€ç»ˆé€‰å®šçš„æ–¹æ¡ˆï¼Œä¸‹é¢å°†ä»é›¶å¼€å§‹ä»‹ç»å¦‚ä½•æ­å»ºè¿™ä¸ªå…è´¹å›¾åºŠç³»ç»Ÿã€‚\n\n### Cloudflare R2\n\nR2 æ˜¯ Cloudflare æ¨å‡ºçš„å…è´¹å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œéœ€è¦å…è´¹æ³¨å†Œä¸€ä¸ª [Cloudflare è´¦å·](https://www.cloudflare.com/zh-cn/)æ‰èƒ½ä½¿ç”¨ï¼Œæ³¨å†Œç™»å½•åï¼Œç‚¹å‡»å·¦ä¾§è¾¹æ çš„ R2 è®¿é—®æœåŠ¡ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯å¼€é€š R2 æœåŠ¡éœ€è¦ç»‘å®šä¿¡ç”¨å¡ï¼ˆå›½å†…å¤–ä¸»æµä¿¡ç”¨å¡çš†å¯ï¼‰ï¼Œä½†å¹¶ä¸ä¼šæ‰£è´¹ï¼Œä¸»è¦æ˜¯ä¸ºäº†éªŒè¯ç”¨æˆ·èº«ä»½ä½¿ç”¨ã€‚`ä½†æ˜¯æˆ‘æœ€è¿‘å‘ç°ä»–æœ‰äº†paypaléªŒè¯æ–¹å¼ï¼Œæœ‰äº†paypalï¼Œå¯ä»¥ç›´æ¥ç»‘å®šå›½å†…å‚¨è“„å¡ï¼Œå°±å¯ä»¥é€šè¿‡R2éªŒè¯çš„é“¶è¡Œå¡éªŒè¯äº†`\n\n![image-20250212151333273](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252131.png)\n\n### åˆ›å»ºå­˜å‚¨æ¡¶\n\nå¼€é€š R2 æœåŠ¡åï¼Œç‚¹å‡»å³ä¸Šè§’ã€Œåˆ›å»ºå­˜å‚¨æ¡¶ã€æŒ‰é’®è¿›è¡Œåˆ›å»ºã€‚\n\n![image-20250212151607908](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252132.png)\n\nè¿›å…¥åˆ›å»ºé…ç½®ç•Œé¢åï¼Œéœ€è¦å¡«å†™å­˜å‚¨æ¡¶ï¼ˆBucketï¼‰åç§°ï¼Œå»ºè®®æœ‰ä¸€äº›è¾¨è¯†åº¦ï¼Œåç»­åœ¨é…ç½®ä¸Šä¼ æ—¶ä¼šç”¨åˆ°ã€‚\n\nä½ç½®åˆ™é€‰æ‹©ã€Œè‡ªåŠ¨ã€ï¼Œä½†å¯ä»¥é¢å¤–å¤šé…ç½®ä¸€ä¸ªä½ç½®æç¤ºï¼Œç”±äºæˆ‘åç»­è¿˜å°†ä½¿ç”¨ã€Œ[WebP Cloud](https://webp.se/)ã€æœåŠ¡çš„ç¾è¥¿æœºæˆ¿è¿›è¡Œå›¾ç‰‡ä»£ç†ä¼˜åŒ–ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„é€‰æ‹©çš„æ˜¯ã€ŒåŒ—ç¾æ´²è¥¿éƒ¨ï¼ˆWNAMï¼‰ã€ï¼Œæ ¹æ®éœ€æ±‚é€‰å…¶ä»–åŒºåŸŸä¹Ÿå¯ä»¥ï¼Œä½† Cloudflare å¹¶ä¸ä¿è¯ä¸€å®šä¼šåˆ†é…åˆ°æ‰€æŒ‡å®šçš„åŒºåŸŸã€‚\n\n![image-20250212151725856](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252133.png)\n\nè¿›å…¥è®¾ç½®\n\n![image-20250212152030774](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252134.png)\n\né¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰“å¼€ã€ŒR2.dev å­åŸŸã€ï¼Œè¿™æ˜¯ä¸ºäº†åç»­è®¿é—®å›¾ç‰‡æ—¶éœ€è¦çš„å…¬ç½‘åœ°å€ï¼Œç‚¹å‡»ã€Œå…è®¸è®¿é—®ã€ï¼Œå¹¶æŒ‰ç…§æç¤ºè¾“å…¥ã€Œallowã€å³å¯å¼€å¯ã€‚\n\n![image-20250212152203901](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252135.png)\n\nå®Œæˆåä¼šæ˜¾ç¤ºä¸€ä¸ªä»¥ `r2.dev` ç»“å°¾çš„å…¬ç½‘ç½‘å€ï¼Œå³æˆ‘ä»¬åç»­è®¿é—®å›¾ç‰‡çš„ç½‘å€ã€‚\n\n\n\n`è‡ªå®šä¹‰å›¾åºŠåŸŸåï¼ˆå¯é€‰ï¼‰`\n\nä½†æ˜¯åˆ†é…çš„ç½‘å€æ¯”è¾ƒé•¿ï¼Œä¸æ˜“äºè®°å¿†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ã€Œè‡ªå®šä¹‰åŸŸã€æ¥ç»‘å®šæˆ‘ä»¬çš„ä¸“å±åŸŸåï¼Œç‚¹å‡»ã€Œè¿æ¥åŸŸã€æŒ‰é’®ï¼Œå¡«å…¥æƒ³è¦è®¿é—®çš„åŸŸå\n\n![image-20250212152355336](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252136.png)\n\nç„¶ååœ¨ä½ åŸŸåæœåŠ¡å•†é‚£æ·»åŠ dnsè§£æï¼Œç”±äºæˆ‘æ˜¯å°†åŸŸåæ‰˜ç®¡åˆ°äº†cloudflareï¼Œç›´æ¥è‡ªåŠ¨æ·»åŠ è§£æäº†\n\n![image-20250212152448801](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252137.png)\n\næ•ˆæœå°±æ˜¯è¿™æ ·äº†\n\n![image-20250212152555125](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252138.png)\n\n![image-20250212152616008](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252139.png)\n\n### é…ç½®å­˜å‚¨æ¡¶è®¿é—®api\n\nå½“æˆ‘ä»¬å›åˆ°å¯¹è±¡é¡µé¢ï¼Œä¸Šä¼ ä¸€å¼ æµ‹è¯•å›¾ç‰‡\n\n![image-20250212155704337](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252140.png)\n\nå°±æœ‰é“¾æ¥å¯ä»¥è¿›è¡Œè®¿é—®äº†\n\n![image-20250212155745302](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252141.png)\n\nä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½æ‰“å¼€cloudflareæ‰‹åŠ¨ä¸Šä¼ å›¾ç‰‡çš„è¯éƒ½ä¼šå¾ˆéº»çƒ¦ã€‚R2 æä¾›äº† S3 å…¼å®¹çš„ APIï¼Œå¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ä¸€äº›å®¢æˆ·ç«¯/å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œä¸Šä¼ ã€åˆ é™¤ç­‰æ“ä½œã€‚\n\n![image-20250212160118209](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252142.png)\n\n![image-20250212160150594](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252143.png)\n\n![image-20250212160306528](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252144.png)\n\nè¿™æ—¶å€™å°±ä¼šæœ‰apiä»¤ç‰Œä¿¡æ¯ï¼Œè¿™é‡Œçš„å†…å®¹åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œå¯ä»¥è®°ä¸‹æ¥ï¼Œä½†æ˜¯ä¸è¦ç»™åˆ«äººå“¦\n\n![image-20250212160435719](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252145.png)\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Cloudflare R2 ä¸Šé…ç½®çš„éƒ¨åˆ†å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦é…ç½®å›¾åºŠå·¥å…·å§ã€‚\n\n### PicGoï¼ˆå¯é€‰ï¼Œæ— éœ€æœåŠ¡å™¨ï¼‰\n\nPicGo æ˜¯ä¸€ä¸ªç”¨äºå¿«é€Ÿä¸Šä¼ å¹¶è·å–å›¾ç‰‡ URL çš„å·¥å…·è½¯ä»¶ï¼Œæœ‰ç€è¾ƒä¸ºä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ï¼Œæ”¯æŒå¤šç§å›¾åºŠæœåŠ¡ï¼Œå…¶ GitHub ä»“åº“ä¸ºã€Œ[GitHub - Molunerfinn/PicGo](https://github.com/Molunerfinn/PicGo)ã€ï¼Œå¯ä»¥ä¸‹è½½å¯¹åº”å¹³å°å®¢æˆ·ç«¯ä½¿ç”¨ã€‚\n\n#### é…ç½® R2 å›¾åºŠ\n\nPicGo æœ¬ä½“å¹¶ä¸åŒ…æ‹¬ S3 å›¾åºŠï¼Œä½†å¯ä»¥é€šè¿‡ã€Œ[GitHub - wayjam/picgo-plugin-s3](https://github.com/wayjam/picgo-plugin-s3)ã€æ’ä»¶æ¥æ”¯æŒã€‚\n\nwindowsä¸‹çš„ç¨³å®šç‰ˆ2.3.1ä¼šå‡ºç°æœç´¢ä¸åˆ°æ’ä»¶çš„æƒ…å†µ,ä¸‹è½½é‡Œé¢çš„betaç‰ˆæœ¬å°±è¡Œäº†\n\n[Bug: æ’ä»¶è®¾ç½®é¡µæ— æ³•æœç´¢åˆ°æ’ä»¶ Â· Issue #1297 Â· Molunerfinn/PicGo](https://github.com/Molunerfinn/PicGo/issues/1297)\n\næˆ‘åªèƒ½å®‰è£…1.0.2çš„ï¼Œç¬¬ä¸€ä¸ªå®‰è£…ä¸äº†ï¼Œæ— å…³ç´§è¦\n\n![image-20250212160806906](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252146.png)\n\nç„¶åå¡«å†™ä¿¡æ¯\n\n![image-20250212161619415](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252147.png)\n\nè¿™é‡Œæœ‰å‡ é¡¹é…ç½®éœ€è¦å°¤å…¶æ³¨æ„ã€‚\n\n- **åº”ç”¨å¯†é’¥ ID**ï¼Œå¡«å†™ R2 API ä¸­çš„ Access Key IDï¼ˆè®¿é—®å¯†é’¥ IDï¼‰\n- **åº”ç”¨å¯†é’¥**ï¼Œå¡«å†™ R2 API ä¸­çš„ Secret Access Keyï¼ˆæœºå¯†è®¿é—®å¯†é’¥ï¼‰\n- **æ¡¶å**ï¼Œå¡«å†™ R2 ä¸­åˆ›å»ºçš„ Bucket åç§°ï¼Œå¦‚æˆ‘ä¸Šæ–‡çš„ `blog-r2`\n- **æ–‡ä»¶è·¯å¾„**ï¼Œä¸Šä¼ åˆ° R2 ä¸­çš„æ–‡ä»¶è·¯å¾„ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨ `{fileName}.{extName}` æ¥ä¿ç•™åŸæ–‡ä»¶çš„æ–‡ä»¶åå’Œæ‰©å±•åã€‚\n- **è‡ªå®šä¹‰èŠ‚ç‚¹**ï¼Œå¡«å†™ R2 API ä¸­çš„ã€Œä¸º S3 å®¢æˆ·ç«¯ä½¿ç”¨ç®¡è¾–æƒåœ°ç‰¹å®šçš„ç»ˆç»“ç‚¹ã€ï¼Œå³ `xxx.r2.cloudflarestorage.com` æ ¼å¼çš„ S3 Endpoint\n- **è‡ªå®šä¹‰åŸŸå**ï¼Œå¡«å†™ä¸Šæ–‡ç”Ÿæˆçš„ `xxx.r2.dev` æ ¼å¼çš„åŸŸåæˆ–è‡ªå®šä¹‰åŸŸåï¼Œå¦‚æˆ‘é…ç½®çš„ `image.qianyisky.cn`\n\n![image-20250212162350766](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252148.png)\n\nå…¶ä»–é…ç½®ä¿æŒé»˜è®¤å³å¯ï¼Œç¡®è®¤å‚æ•°æ— è¯¯åç‚¹å‡»ã€Œç¡®å®šã€ä¸ã€Œè®¾ç½®ä¸ºé»˜è®¤å›¾åºŠã€å³å¯ã€‚\n\n#### å›¾ç‰‡ä¸Šä¼ \n\n![image-20250212162515699](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252149.png)\n\nå®Œæˆä¸Šè¿°é…ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ã€Œä¸Šä¼ åŒºã€ç›´æ¥æ‹–å…¥æ–‡ä»¶è¿›è¡Œå›¾ç‰‡ä¸Šä¼ äº†ï¼Œå¦‚ä¸Šä¼ åæ˜¾ç¤ºæ— è¯¯åˆ™ä¸ºé…ç½®æˆåŠŸï¼Œç”Ÿæˆçš„é“¾æ¥ä¼šè‡ªåŠ¨åœ¨ç³»ç»Ÿå‰ªè´´æ¿ä¸­ï¼Œç›´æ¥åœ¨éœ€è¦çš„åœ°æ–¹ç²˜è´´å³å¯ã€‚\n\næ ¹æ®ä½ æƒ³è¦çš„é“¾æ¥æ ¼å¼ï¼Œæˆ‘è¿™é‡Œæ˜¯markdownï¼Œå°±é€‰æ‹©markdownæ ¼å¼ï¼Œç„¶ååœ¨ç›¸å†Œé‡Œå¤åˆ¶é“¾æ¥ï¼Œåœ¨markdownæ–‡æ¡£çœ‹çœ‹\n\n![image-20250212162638990](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252150.png)\n\n![image-20250212162708601](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252151.png)\n\n### Lsky Proå›¾åºŠï¼ˆå¯é€‰ï¼Œéœ€è¦æœåŠ¡å™¨ï¼‰\n\nå®˜ç½‘ï¼š[Lsky Pro+ - å±äºæ‚¨è‡ªå·±çš„äº‘ä¸Šç›¸å†Œã€‚](https://www.lsky.pro/)\n\néƒ¨ç½²æ•™ç¨‹ï¼š[Lsky Proå›¾åºŠ | ä¸¥åƒå±¹åšå®¢](https://blog.qianyios.top/posts/6726/?highlight=å…°)\n\næˆ‘è¿™é‡Œå°±å±•ç¤ºè‡ªå·±æ­å»ºå¥½lsky proå›¾åºŠè¿›è¡Œæ¼”ç¤ºäº†\n\n#### åˆ›å»ºå­˜å‚¨ç­–ç•¥\n\n![image-20250212163327404](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252152.png)\n\n![image-20250212163547700](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252153.png)\n\nç¡®è®¤å³å¯\n\n#### å›¾ç‰‡ä¸Šä¼ \n\nè®¾ç½®ä¸Šä¼ å›¾ç‰‡çš„é™åˆ¶å¤§å°ä¸º10M\n\n![image-20250212164032388](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252155.png)\n\n![image-20250212164200929](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252156.png)\n\nç‚¹å‡»ä¿å­˜å³å¯\n\n![image-20250212164344718](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252157.png)\n\n![image-20250212164600963](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252158.png)\n\n### ä¸¤è€…è·¯å¾„ä¿®æ”¹ä½ç½®\n\n![image-20250212164651932](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252159.png)\n\nè¿™å°±æ˜¯ç»Ÿä¸€ç®¡ç†çš„æ–¹ä¾¿æ€§\n\n`è¿™æ˜¯lsky proè®¾ç½®ä¸Šä¼ è·¯å¾„çš„ä½ç½®`\n\n![image-20250212164754562](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252160.png)\n\n`è¿™æ˜¯PicGoè®¾ç½®ä¸Šä¼ è·¯å¾„çš„ä½ç½®`\n\n![image-20250212165842910](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252161.png)\n\nå†å»æµ‹è¯•ä¸Šä¼ çœ‹çœ‹\n\n![image-20250212165247121](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252162.png)\n\næ•ˆæœ\n\n![image-20250212170129233](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252163.png)\n\nå½“ç„¶ä½ å¯ä»¥åœ¨è®¾ç½®é‡Œé€‰æ‹©è¿™ä¸¤ä¸ª\n\n![image-20250212170221106](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252164.png)\n\n![image-20250212170422951](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252165.png)\n\n![image-20250212170625037](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252166.png)\n\n## WebP Cloud å›¾ç‰‡ä¼˜åŒ–\n\nè‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæˆäº†æ•´ä¸ªå›¾åºŠçš„æ­å»ºã€é…ç½®å’Œä¸Šä¼ ï¼Œä½†é€šå¸¸æˆ‘ä»¬æœ¬åœ°æˆªå›¾æˆ–æ˜¯ç›¸æœºæ‹æ‘„çš„å›¾ç‰‡ä½“ç§¯è¾ƒå¤§ï¼Œå¯¹äºè®¿å®¢æ¥è¯´åŠ è½½æ—¶é—´ä¼šè¾ƒé•¿ï¼Œå¹¶ä¸ç›´æ¥é€‚åˆäº’è”ç½‘å‘å¸ƒã€‚\n\næ ¹æ®[ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿï¼ˆCloudflare R2 + WebP Cloud + PicGoï¼‰ Â· Pseudoyu](https://www.pseudoyu.com/zh/2024/06/30/free_image_hosting_system_using_r2_webp_cloud_and_picgo/)å†™åˆ°[WebP Cloud](https://webp.se/)çš„æ–¹æ³•\n\nå®ƒå¯ä»¥å®ç°å›¾ç‰‡çš„å‹ç¼©ï¼ŒåŠ å¿«é¡µé¢æ˜¾ç¤ºçš„é€Ÿåº¦\n\n![image-20250212171017681](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252167.png)\n\nç®€å•æ¥è¯´è¿™æ˜¯ä¸€ä¸ªç±» CDN çš„å›¾ç‰‡ä»£ç† SaaS æœåŠ¡ï¼Œå¯ä»¥åœ¨å‡ ä¹ä¸æ”¹å˜ç”»è´¨çš„æƒ…å†µä¸‹å¤§å¹…ç¼©å°å›¾ç‰‡ä½“ç§¯ï¼ŒåŠ å¿«æ•´ä½“ç«™ç‚¹åŠ è½½é€Ÿåº¦ã€‚å‘å±•åˆ°ç°åœ¨é™¤äº†å›¾ç‰‡ä½“ç§¯å‡å°‘å¤–ï¼Œè¿˜æä¾›äº†ç¼“å­˜ã€æ·»åŠ æ°´å°ã€å›¾ç‰‡æ»¤é•œç­‰æ›´å¤šå®ç”¨çš„åŠŸèƒ½ï¼Œå¹¶æä¾›äº†è‡ªå®šä¹‰ Header ç­‰é…ç½®é€‰é¡¹ã€‚\n\n### é…ç½®webp cloud\n\né¦–å…ˆé€šè¿‡ GitHub æˆæƒç™»å½• [WebP Cloud](https://dashboard.webp.se/) å¹³å°ã€‚\n\n![image-20250212171123527](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252168.png)\n\n![image-20250212171355857](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252169.png)\n\nå›åˆ°ä¸»é¡µï¼Œç‚¹å‡»åˆ›å»ºä»£ç†\n\n![image-20250212171450450](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252170.png)\n\n- ä¸ºäº†ä¼˜åŒ–å›½å†…è®¿é—®ï¼Œæˆ‘ã€ŒProxy Regionã€é€‰æ‹©çš„æ˜¯ç¾è¥¿ã€ŒHillsboro, ORã€åŒºåŸŸ\n- ã€ŒProxy Nameã€å¡«å†™ä¸€ä¸ªè‡ªå®šä¹‰åç§°å³å¯\n- ã€ŒProxy Origin URLã€ï¼Œæ¯”è¾ƒé‡è¦ï¼Œéœ€è¦å¡«å†™ä¸Šæ–‡æˆ‘ä»¬é…ç½®å¥½çš„ R2 è‡ªå®šä¹‰åŸŸåï¼Œå¦‚æˆ‘å¡«å†™çš„æ˜¯ `image.qianyisky.cn`ï¼Œå¦‚æœæ²¡é…ç½®è‡ªå®šä¹‰åŸŸååˆ™å¡«å†™ R2 æä¾›çš„ `xxx.r2.dev` æ ¼å¼çš„åŸŸå\n\n![image-20250212171624454](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252171.png)\n\nä¹‹åç‚¹å‡»ä½ åˆ›å»ºçš„ä»£ç†ï¼Œå°†ä»£ç†åœ°å€æ›´æ–°åˆ°å­˜å‚¨ç­–ç•¥çš„é…ç½®é‡Œ\n\n`PicGoé…ç½®`\n\n![image-20250212171949706](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252172.png)\n\n`Lsky Proé…ç½®`\n\n![image-20250212172255953](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252173.png)\n\nå†è¿›è¡Œä¸Šä¼ å›¾ç‰‡çš„æµ‹è¯•\n\n![image-20250212172515404](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252174.png)\n\nå°±æ˜¯æˆ‘ä»¬é€šè¿‡å›¾åºŠå·¥å…·ä¸Šä¼ çš„å›¾ç‰‡ä¸Šä¼ äº†ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ª[**WebP Cloud Services**](https://webp.se/)æä¾›çš„ä»£ç†èŠ‚ç‚¹è¿›è¡Œè®¿é—®\n\nå¦‚æœè§‰å¾—é»˜è®¤ä»£ç†åœ°å€ä¸å¥½çœ‹ï¼Œå¯ä»¥è¿›è¡Œè®¾ç½®è‡ªå®šä¹‰åŸŸå\n\n![image-20250212172818032](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252175.png)\n\n![image-20250212172832000](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252176.png)\n\n![image-20250212173135188](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252177.png)\n\næœ€åç¡®è®¤ï¼Œç­‰å¾…ååˆ†é’Ÿè¿™æ ·å­ï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼Œå°±ä¼šæ›´æ–°ä»£ç†åœ°å€äº†ï¼Œç„¶åç‚¹å‡»å¯ç”¨\n\n![image-20250212173324239](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252178.png)\n\n![image-20250212173345988](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252179.png)\n\nè¿™æ—¶å€™ä½ å°±å¯ä»¥å»ä¿®æ”¹ä¹‹å‰çš„å›¾åºŠå·¥å…·çš„ä»£ç†åœ°å€äº†\n\nhttps://images.qianyisky.cn/PicGo/test.png\n\n### WebP Cloud ç”¨é‡\n\nå…è´¹ç”¨æˆ·æ¯å¤©æœ‰ 3000 Free Quotaï¼Œå³èƒ½å¤Ÿä»£ç† 3000 æ¬¡å›¾ç‰‡è®¿é—®è¯·æ±‚ï¼Œå¹¶æä¾› 200M çš„å›¾ç‰‡ç¼“å­˜ï¼Œå¯¹äºä¸€èˆ¬ç”¨æˆ·æ¥è¯´å®Œå…¨å¤Ÿç”¨ï¼Œå¦‚æœ‰ä¸€äº›æµé‡è¾ƒå¤§çš„ç‰¹å®šæ—¶æœŸä¹Ÿå¯ä»¥è´­ä¹°é¢å¤– Quotaï¼Œä»·æ ¼å¾ˆä¾¿å®œã€‚\n\nå¦‚è¶…è¿‡äº† Quotaï¼Œè®¿é—®åˆ™ä¼šè¢« 301 è½¬å‘åˆ°æºç«™å›¾ç‰‡åœ°å€ï¼Œä¸ç» WebP Cloud æœåŠ¡å‹ç¼©ï¼Œä½†ä¾ç„¶å¯ç”¨ï¼›è¶…è¿‡ 200M çš„ç¼“å­˜åˆ™ä¼šæŒ‰ç…§ LRU ç®—æ³•æ¸…ç†ï¼Œæ‰€ä»¥ä¾ç„¶èƒ½å¤Ÿä¿éšœä¸€äº›é«˜é¢‘è¯·æ±‚çš„å›¾ç‰‡èƒ½å¤Ÿæœ‰è¾ƒå¥½çš„è®¿é—®ä½“éªŒã€‚\n\n## æ€»ç»“\n\nä»¥ä¸Šå°±æ˜¯[Pseudoyu](https://www.pseudoyu.com/zh/)çš„å›¾åºŠç³»ç»Ÿæ­å»ºæ–¹æ¡ˆï¼Œå¦‚æœä½ çš„é¡¹ç›®æ˜¯åœ¨å›½å†…çš„æœåŠ¡å™¨ä¸Šï¼Œç”¨è¿™ä¸ªæ–¹æ³•å‹‰å¼ºå¤Ÿç”¨å“¦ï¼ŒåŸºæœ¬éƒ½æ˜¯å…è´¹è®¢é˜…çš„\n\n\n\n\n\né‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦è®²åˆ°å®‰å…¨è¿™å‡ å—äº†\n\nä»¥ä¸‹å†…å®¹æ¥è‡ª[ä½¿ç”¨ WebP Cloud ä¸ Cloudflare WAF ä¸ºä½ çš„å›¾åºŠæ·»åŠ éšç§å’Œç‰ˆæƒä¿æŠ¤ Â· Pseudoyu](https://www.pseudoyu.com/zh/2024/07/02/protect_your_image_using_webp_and_cloudflare_waf/)\n\nå¯ä»¥çœ‹çœ‹ä½œè€…çš„ä¸€ä¸ªå›¾ç‰‡è¢«ç›—ç”¨çš„ç»å†ï¼Œå°±å¯ä»¥çŸ¥é“éšç§ä¿æŠ¤çš„é‡è¦æ€§\n\n# ä½¿ç”¨ WebP Cloud ä¸ Cloudflare WAF ä¸ºä½ çš„å›¾åºŠæ·»åŠ éšç§å’Œç‰ˆæƒä¿æŠ¤\n\nåœ¨ä½¿ç”¨ WebP Cloud çš„è¿‡ç¨‹ä¸­ï¼ŒPseudoyuå‘ç°å®ƒè¿˜æä¾›äº†è‡ªå®šä¹‰ Proxy User Agentã€æ°´å°ç­‰åŠŸèƒ½ï¼Œäºæ˜¯èŒç”Ÿäº†ä¸€ä¸ªæƒ³æ³•ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡ WebP Cloud å¯¹Pseudoyuçš„å›¾åºŠæºç«™é“¾æ¥è¿›è¡Œä¿æŠ¤ï¼Œä½¿ WebP Cloud çš„ä»£ç†é“¾æ¥æˆä¸ºè®¿é—®æˆ‘æ‰€æœ‰å›¾ç‰‡çš„å”¯ä¸€å…¥å£ï¼Œå¹¶ç»Ÿä¸€æ·»åŠ Pseudoyuçš„ä¸“å±ç‰ˆæƒæ°´å°ã€‚\n\næœ¬æ–‡æ˜¯å¯¹è¿™ä¸€å®è·µçš„è®°å½•ï¼Œä¹Ÿç®—æ˜¯å›¾åºŠæ­å»ºç•ªå¤–ç¯‡äº†ã€‚\n\n## éœ€æ±‚åˆ†æ\n\n![image-20250212175038678](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252180.png)\n\nç†è®ºä¸Šä¸¤ä¸ªåœ°å€éƒ½å¯ä»¥è¿›è¡Œè®¿é—®åˆ°æˆ‘å›¾åºŠé‡Œçš„å›¾ç‰‡ï¼Œä½†æ˜¯å‰è€…æ˜¯ä»£ç†åç»è¿‡å¤„ç†çš„å›¾ï¼Œåè€…æ˜¯ç›´æ¥è®¿é—®cloudflare R2çš„åŸå›¾\n\n### éšç§ä¿æŠ¤\n\näº‹å®ä¸Šæˆ‘ä»¬é€šè¿‡æ‰‹æœºã€æ•°ç ç›¸æœºç­‰è®¾å¤‡æ‹æ‘„çš„ç…§ç‰‡éƒ½ä¼šæºå¸¦ EXIF(EXchangeable Image File Format) ä¿¡æ¯ï¼Œé€šå¸¸ä¼šåŒ…å«æ‹æ‘„è®¾å¤‡ã€æ—¶é—´å’Œåœ°ç‚¹ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æŠ€æœ¯æ–¹å¼æ‰‹åŠ¨å»é™¤è¿™äº›å…ƒæ•°æ®ï¼Œä½†æ“ä½œååˆ†ç¹çä¸”å®¹æ˜“é—æ¼ã€‚\n\nPseudoyuæŸ¥é˜…äº†ä¸€ä¸‹ WebP Cloud çš„æ–‡æ¡£ï¼Œå‘ç°å®ƒæœç„¶æä¾›è‡ªåŠ¨æ“¦é™¤ EXIF ä¿¡æ¯çš„åŠŸèƒ½ï¼Œæ— é¡»é¢å¤–é…ç½®æ“ä½œï¼Œä½†å…¶å®è®¿å®¢ä¾ç„¶å¯ä»¥å¯ä»¥é€šè¿‡ Cloudflare R2 æš´éœ²å‡ºçš„æºç«™ä¿¡æ¯è®¿é—®åˆ°åŸå›¾ï¼Œä¸ºäº†é¿å…è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é™åˆ¶ç”¨æˆ·åªèƒ½é€šè¿‡ WebP Cloud ä»£ç†é“¾æ¥è¿›è¡Œè¯·æ±‚ï¼Œè®¿é—® Cloudflare R2 æºç«™é“¾æ¥æ—¶è·å–ä¸åˆ°ä»»ä½•æœ‰ç”¨ä¿¡æ¯ã€‚\n\n### ç‰ˆæƒä¿æŠ¤\n\nè¿™æ˜¯ä½œè€…å›¾ç‰‡è¢«ç›—ç”¨çš„ç»å†\n\n![image-20250212180156079](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252181.png)\n\n## å®ç°æ–¹æ¡ˆ\n\néœ€æ±‚æ¸…æ™°äº†ï¼Œå…¶å®ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š\n\n1. è®©ç”¨æˆ·åªèƒ½é€šè¿‡ WebP Cloud ä»£ç†é“¾æ¥è®¿é—®åˆ°æˆ‘çš„å›¾ç‰‡ï¼Œç¦æ­¢ç›´æ¥è®¿é—®åŸå›¾é“¾æ¥\n2. åœ¨ WebP Cloud ä»£ç†å±‚é¢ä¸ºæ‰€æœ‰çš„å›¾ç‰‡ç»Ÿä¸€è‡ªåŠ¨æ·»åŠ è‡ªå·±çš„ç‰ˆæƒæ°´å°ï¼Œæ— é¡»æ‰‹åŠ¨æ“ä½œ\n\nä»¥ä¸‹æ˜¯æˆ‘çš„å®ç°æ–¹æ¡ˆä¸è¯¦ç»†æ­¥éª¤ã€‚\n\n### WebP è‡ªå®šä¹‰ User Agent + Cloudflare WAF\n\n#### WebP Cloud é…ç½®\n\nå½“æˆ‘ä»¬è®¿é—®äº’è”ç½‘ä¸Šçš„ç½‘é¡µæˆ–å›¾ç‰‡é“¾æ¥æ—¶ï¼Œè¯·æ±‚é€šå¸¸ä¼šåŒ…å«ä¸€ä¸ª User Agent å­—æ®µï¼Œä¸€èˆ¬åŒ…å«æµè§ˆå™¨ç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œç½‘ç«™å¯é’ˆå¯¹ä¸åŒçš„ User Agent è¿›è¡Œä¸€äº›ç‰¹å®šé€»è¾‘å¤„ç†ã€‚\n\nWebP Cloud é»˜è®¤ä¼šä½¿ç”¨ `WebP Cloud Services/1.0` ä½œä¸ºå€¼ï¼Œä¹Ÿå°±æ˜¯ä¸è®ºç”¨æˆ·è®¿é—®å›¾ç‰‡æ—¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç»ˆç«¯è®¾å¤‡å’Œæµè§ˆå™¨ï¼Œè¯·æ±‚åˆ° Cloudflare R2 æ—¶éƒ½ä¼šè¢«ç»Ÿä¸€ä¸º WebP Cloud å®šä¹‰çš„ User Agent å€¼ï¼Œè€Œè¿™ä¸ªå€¼åˆæ˜¯ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰çš„ã€‚\n\n![image-20250212180323061](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252182.png)\n\nå› æ­¤ï¼Œæˆ‘ä»¬ç™»å½• WebP Cloud çš„æ§åˆ¶å°ï¼Œå°†ã€ŒProxy User Agentã€å­—æ®µè®¾ç½®ä¸ºä¸€ä¸ªè‡ªå®šä¹‰å€¼ï¼Œå¦‚ `ABC.com/1.0`ã€‚\n\néšåæ›´æ–°ä»£ç†\n\n#### Cloudflare WAF é…ç½®\n\n[WAFï¼ˆWeb Application Firewallï¼‰](https://developers.cloudflare.com/waf) æ˜¯ Cloudflare æä¾›çš„ä¸€ä¸ªé˜²ç«å¢™æœåŠ¡ï¼Œå¯ä»¥è‡ªå®šä¹‰è§„åˆ™æ¥é™åˆ¶ç‰¹å®šè¯·æ±‚ä»¥ä¿æŠ¤ç½‘ç«™å®‰å…¨ï¼Œç™»å½• Cloudflare ååœ¨å·¦ä¾§è¾¹æ ç‚¹å‡»ã€Œç½‘ç«™ã€ï¼Œç‚¹å‡»è¿›å…¥éœ€è¦ä¿æŠ¤çš„åŸŸåï¼Œé€‰æ‹©ä¾§è¾¹æ ã€Œå®‰å…¨æ€§ã€ - ã€ŒWAFã€å³å¯å…è´¹ä½¿ç”¨ï¼ˆæ³¨ï¼šä¸æ˜¯æœ€å¤–å±‚çš„è´¦æˆ·çº§ WAFï¼‰ï¼Œå…è´¹è´¦æˆ·å¯è®¾å®šäº”ä¸ªè‡ªå®šä¹‰è§„åˆ™ã€‚\n\n![image-20250212180818002](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252183.png)\n\n![image-20250212180925777](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252184.png)\n\nç‚¹å‡»å³ä¾§çš„ã€Œç¼–è¾‘è¡¨è¾¾å¼ã€ï¼Œå¡«å…¥ä»¥ä¸‹è§„åˆ™ï¼š\n\n```\n(http.user_agent ne \"ABC.com/1.0\") and (http.host eq \"image.qianyisky.cn\")\n```\n\n![image-20250212181107490](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252185.png)\n\nå…¶ä»–é»˜è®¤ï¼Œç„¶åç‚¹å‡»ä¿å­˜\n\n> æ–¹ä¾¿ç†è§£ï¼š\n>\n> 1.ä»£ç†é“¾æ¥çš„User Agentä¼šåŒ…å«åœ¨ç½‘ç»œè¯·æ±‚é‡Œï¼Œä¹Ÿå°±æ˜¯è®¾ç½®äº†`ABC.com/1.0`ï¼ˆ`Aé’¥åŒ™`ï¼‰\n>\n> 2.cloudflare WAFï¼šè®¾ç½®äº†åªæœ‰`Aé’¥åŒ™`æ‰å¯ä»¥è®¿é—®\n>\n> 3.ä¸€èˆ¬ç”¨æˆ·æµè§ˆç½‘é¡µçš„User Agentæ˜¯è¿™æ ·çš„\n>\n> ```perl6\n> User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\n> ```\n>\n> ä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰Aé’¥åŒ™ï¼Œæ˜¯è®¿é—®ä¸äº†çš„\n>\n> 4.æ‰€ä»¥åœ¨ä»£ç†é“¾æ¥è®¾ç½®äº†Aé’¥åŒ™ï¼Œé‚£ä¹ˆä»–ä¼šæŠŠè®¿é—®åŸåœ°å€çš„æµé‡è¯·æ±‚åŠ å…¥Aé’¥åŒ™ï¼Œè¾¾åˆ°è®¿é—®çš„ç›®çš„ï¼Œå¦‚æœæ²¡æœ‰Aé’¥åŒ™ç›´æ¥è®¿é—®åŸåœ°å€å°±ä¼šå‡ºç°å¦‚ä¸‹å›¾\n\n![image-20250212181942387](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252186.png)\n\næ‰€ä»¥å®Œæˆé…ç½®åï¼Œå½“æˆ‘ä»¬å†æ¬¡è®¿é—®åŸåœ°å€image.qianyisky.cnçš„æ—¶å€™å°±ä¼šè¢«æ‹¦æˆªï¼Œä¾‹å¦‚ï¼š\n\nåŸåœ°å€ï¼šhttps://image.qianyisky.cn/PicGo/test.png\n\nä»£ç†åœ°å€ï¼šhttps://images.qianyisky.cn/PicGo/test.png\n\nå®Œç¾å®ç°äº†æˆ‘ä»¬çš„éœ€æ±‚ã€‚\n\n### è®¾ç½®æ°´å°\n\næˆ‘è¿™é‡Œå°±è®¾ç½®äº†ä¸€ä¸ªç°è‰²çš„æ°´å°\n\n![image-20250212182258376](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252187.png)\n\n![image-20250212182308863](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252188.png)\n\nè®¾ç½®å¥½åä¿å­˜\n\n![image-20250212182443427](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252189.png)\n\nç”±äºï¼Œåˆšè®¾ç½®ï¼Œåªä¼šå¯¹æ–°ä¸Šä¼ çš„å›¾ç‰‡æ·»åŠ æ°´å°ï¼Œå¦‚æœä½ è¦ä¹‹å‰ä¸Šä¼ çš„å›¾ç‰‡éƒ½è¦æ‰“ä¸Šæ°´å°ï¼Œä½ å°±è¦æ¸…é™¤ç¼“å­˜ï¼Œæœ€åé‡æ–°è®¿é—®å›¾ç‰‡å°±ä¼šæœ‰æ°´å°äº†\n\n![image-20250212182549468](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252190.png)\n\nç¼“å­˜çš„è§„åˆ™ï¼š`ç›®å‰æ‰€æœ‰ä»£ç†éƒ½ä¼šæœ‰ 200.00 MiB ç¼“å­˜ï¼Œå¦‚æœè¶…å‡ºè¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨â€œæœ€è¿‘æœ€å°‘ä½¿ç”¨â€ï¼ˆLRUï¼‰ç®—æ³•è¿›è¡Œé©±é€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å°‘è¯·æ±‚çš„å†…å®¹å°†ä»ç¼“å­˜ä¸­é©±é€ã€‚`\n\nä»£ç†åœ°å€ï¼šhttps://images.qianyisky.cn/PicGo/test.png\n\n![image-20250212182812682](https://images.qianyisky.cn/boke/ä»é›¶å¼€å§‹æ­å»ºä½ çš„å…è´¹å›¾åºŠç³»ç»Ÿ/20250212184252191.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","categories":["æ‚é¡¹"]},{"title":"OpenStack Antelope","url":"/posts/8c5be7b9/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# OpenStack Antelope\n\næœ¬æ–‡æ¡£æ˜¯åŸºäº openEuler 24.03 LTS çš„ OpenStack éƒ¨ç½²æŒ‡å—\n\né•œåƒä¸‹è½½ï¼š [openEuler 24.03 LTS](https://repo.openeuler.org/openEuler-24.03-LTS/ISO/)\n\n## ä¸»æœºæ‹“æ‰‘\n\n|   ä¸»æœºå   |       ip       | ç¡¬ç›˜1 | ç¡¬ç›˜2 | cpu  | å†…å­˜ |\n| :--------: | :------------: | ----- | :---: | :--: | :--: |\n| controller | 192.168.48.101 | 100G  |       |  4   |  7G  |\n|  compute   | 192.168.48.102 | 100G  |       |  4   |  4G  |\n|  storage   | 192.168.48.103 | 100G  | 100G  |  4   |  2G  |\n\nå…·ä½“å®‰è£…çš„æœåŠ¡å¦‚ä¸‹ï¼š\n\n| èŠ‚ç‚¹åç§°   | OpenStack æœåŠ¡                                               |\n| ---------- | ------------------------------------------------------------ |\n| æ§åˆ¶èŠ‚ç‚¹   | MariaDB RabbitMQ Memcache Keystone Placement Glance Nova Neutron Cinder Horizon Heat |\n| è®¡ç®—èŠ‚ç‚¹   | Nova Neutron                                                 |\n| å—å­˜å‚¨èŠ‚ç‚¹ | Cinder Swift                                                 |\n\n## å‰æƒ…æè¦\n\ncomputeå¯åŠ¨è™šæ‹Ÿæœºç¡¬ä»¶åŠ é€Ÿï¼ˆx86_64ï¼‰\n\n![image-20241209211221288](https://i0.hdslb.com/bfs/article/9a9672ea7201e5d7b4904110548a7e97697559838.png)\n\næ‰€æœ‰èŠ‚ç‚¹çš„å†…å­˜å’Œç¡¬ç›˜èŠ¯ç‰‡éƒ½è¦æŒ‰ç…§æˆ‘çš„æ¥\n\n![image-20241209211140929](https://i0.hdslb.com/bfs/article/d87c419047278445f660cd46aec74eac697559838.png)\n\n## å®‰å…¨æ€§\n\n### ç‰©ç†èŠ‚ç‚¹å…³é—­é¡ºåº\n\nç»™æ¯å°æœºéƒ½åŠ ä¸Šä¸¤ä¸ªè„šæœ¬\n\n```\ncat >> stop.sh << EOF\n#!/bin/bash\n# å…³é—­æ‰€æœ‰ OpenStack èŠ‚ç‚¹\n# ä¾æ¬¡å…³é—­è®¡ç®—èŠ‚ç‚¹ã€ç½‘ç»œèŠ‚ç‚¹ã€æ§åˆ¶èŠ‚ç‚¹\nfor server in \\$(openstack server list -f value -c ID); do\n    openstack server stop \\$server\ndone\n# å…³é—­è®¡ç®—èŠ‚ç‚¹\necho \"Stopping compute services...\"\nsystemctl stop openstack-nova-compute.service\nsystemctl stop libvirtd.service\n# å…³é—­ç½‘ç»œèŠ‚ç‚¹\necho \"Stopping network services...\"\nsystemctl stop openvswitch.service\nsystemctl stop neutron-server.service\nsystemctl stop neutron-linuxbridge-agent.service\nsystemctl stop neutron-dhcp-agent.service\nsystemctl stop neutron-metadata-agent.service\nsystemctl stop neutron-l3-agent.service\n# å…³é—­æ§åˆ¶èŠ‚ç‚¹\necho \"Stopping control services...\"\nsystemctl stop mariadb.service\nsystemctl stop rabbitmq-server.service\nsystemctl stop memcached.service\nsystemctl stop httpd.service\nsystemctl stop openstack-glance-api.service\nsystemctl stop openstack-glance-registry.service\nsystemctl stop openstack-cinder-api.service\nsystemctl stop openstack-cinder-scheduler.service\nsystemctl stop openstack-cinder-volume.service\nsystemctl stop openstack-nova-api.service\nsystemctl stop openstack-nova-scheduler.service\nsystemctl stop openstack-nova-conductor.service\nsystemctl stop openstack-nova-novncproxy.service\nsystemctl stop openstack-nova-consoleauth.service\nsystemctl stop openstack-keystone.service\nsystemctl stop openstack-heat-api.service\nsystemctl stop openstack-heat-api-cfn.service\nsystemctl stop openstack-heat-engine.service\nsystemctl stop openstack-swift-proxy.service\nsystemctl stop openstack-swift-account.service\nsystemctl stop openstack-swift-container.service\nsystemctl stop openstack-swift-object.service\necho \"Stopping all services...\"\nsystemctl stop --all\n# å…³é—­ç”µæº\necho \"Shutting down the system...\"\npoweroff\nEOF\n\ncat >> start.sh << EOF\n#!/bin/bash\n# é‡æ–°å¯åŠ¨ OpenStack æœåŠ¡\n# ä¾æ¬¡å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹ã€ç½‘ç»œèŠ‚ç‚¹ã€è®¡ç®—èŠ‚ç‚¹\n# å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹\necho \"Starting control services...\"\nsystemctl start mariadb.service\nsystemctl start rabbitmq-server.service\nsystemctl start memcached.service\nsystemctl start httpd.service\nsystemctl start openstack-glance-api.service\nsystemctl start openstack-glance-registry.service\nsystemctl start openstack-cinder-api.service\nsystemctl start openstack-cinder-scheduler.service\nsystemctl start openstack-cinder-volume.service\nsystemctl start openstack-nova-api.service\nsystemctl start openstack-nova-scheduler.service\nsystemctl start openstack-nova-conductor.service\nsystemctl start openstack-nova-novncproxy.service\nsystemctl start openstack-nova-consoleauth.service\nsystemctl start openstack-keystone.service\nsystemctl start openstack-heat-api.service\nsystemctl start openstack-heat-api-cfn.service\nsystemctl start openstack-heat-engine.service\nsystemctl start openstack-swift-proxy.service\nsystemctl start openstack-swift-account.service\nsystemctl start openstack-swift-container.service\nsystemctl start openstack-swift-object.service\n# å¯åŠ¨ç½‘ç»œèŠ‚ç‚¹\necho \"Starting network services...\"\nsystemctl start openvswitch.service\nsystemctl start neutron-server.service\nsystemctl start neutron-linuxbridge-agent.service\nsystemctl start neutron-dhcp-agent.service\nsystemctl start neutron-metadata-agent.service\nsystemctl start neutron-l3-agent.service\n# å¯åŠ¨è®¡ç®—èŠ‚ç‚¹\necho \"Starting compute services...\"\nsystemctl start libvirtd.service\nsystemctl start openstack-nova-compute.service\nEOF\n```\n\n<font color='red'>ï¼ˆå…ˆç»™coomputeå’ŒstorageèŠ‚ç‚¹æ‰§è¡Œ-æœ€åç­‰è¿™ä¸¤ä¸ªèŠ‚ç‚¹å®Œå…¨å…³é—­ï¼Œå†ç»™æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰</font>\n\n```\nå…³é—­ç‰©ç†æœºçš„æ—¶å€™è¿è¡Œ\nsh stop.sh\n(è¿è¡Œçš„æ—¶å€™å¯èƒ½ä¼šæç¤ºä½ æœ‰äº›æœåŠ¡æ‰¾ä¸åˆ°ï¼ŒæŠ¥é”™ï¼Œè¿™ä¸ªæ²¡å…³ç³»ï¼Œä½†æ˜¯è¦æ˜¯å‘Šè¯‰ä½ æœ‰äº›æœåŠ¡èµ·ä¸æ¥ï¼Œè¦ä½ è‡ªå·±å»æ‰¾æŠ¥é”™äº†)ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ²¡é—®é¢˜çš„\n```\n\n### ç‰©ç†èŠ‚ç‚¹å¼€å¯é¡ºåº\n\n> <font color='red'>å…ˆå¼€controllerå†å¼€å‰©ä¸‹çš„è®¡ç®—èŠ‚ç‚¹</font>\n\n### åŸºæœ¬ç”¨æˆ·ä¿¡æ¯\n\nOpenStack å„ç»„ä»¶éƒ½éœ€è¦åœ¨æ§åˆ¶èŠ‚ç‚¹æ•°æ®åº“ä¸­æ³¨å†Œä¸“å±è´¦æˆ·ä»¥å­˜æ”¾æ•°æ®ä¿¡æ¯ï¼Œæ•…éœ€è¦è®¾ç½®å¯†ç ï¼Œå¼ºçƒˆå»ºè®®å„ç»„ä»¶çš„å¯†ç ä»¥åŠå®¿ä¸»æœºå¯†ç å„ä¸ç›¸åŒã€‚\n\n|    OpenStack ç»„ä»¶     |         å¯†ç           |\n| :-------------------: | :-------------------: |\n|     æ§åˆ¶èŠ‚ç‚¹ root     |       Lj201840.       |\n|     è®¡ç®—èŠ‚ç‚¹ root     |       Lj201840.       |\n|  Metadata å…ƒæ•°æ®å¯†é’¥  |    METADATA_SECRET    |\n|   Mariadb root è´¦æˆ·   |     MARIADB_PASS      |\n|     RabbitMQ æœåŠ¡     |      RABBIT_PASS      |\n|    OpenStack admin    |      ADMIN_PASS       |\n|    Placement æœåŠ¡     |    PLACEMENT_PASS     |\n|    Keystone æ•°æ®åº“    |    KEYSTONE_DBPASS    |\n|      Glance æœåŠ¡      |      GLANCE_PASS      |\n|     Glance æ•°æ®åº“     |     GLANCE_DBPASS     |\n|       Nova æœåŠ¡       |       NOVA_PASS       |\n|      Nova æ•°æ®åº“      |      NOVA_DBPASS      |\n|     Neutron æœåŠ¡      |     NEUTRON_PASS      |\n|    Neutron æ•°æ®åº“     |    NEUTRON_DBPASS     |\n|      Cinder æœåŠ¡      |      CINDER_PASS      |\n|     Cinder æ•°æ®åº“     |     CINDER_DBPASS     |\n|    Horizon æ•°æ®åº“     |      DASH_DBPASS      |\n|       SwiftæœåŠ¡       |      SWIFT_PASS       |\n|       HeatæœåŠ¡        |       HEAT_PASS       |\n|    Heatæ•°æ®åº“æœåŠ¡     |      HEAT_DBPASS      |\n| heat_domain_adminç”¨æˆ· | HEAT_DOMAIN_USER_PASS |\n\n### æµ‹è¯•ç”¨æˆ·\n\n| ç”¨æˆ·    | å¯†ç    |\n| ------- | ------ |\n| admin   | 123456 |\n| use_dog | 123456 |\n\n## åŸºç¡€é…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰èŠ‚ç‚¹]\n\nä¸è¦ä¸€è‚¡è„‘çš„å¤åˆ¶ï¼Œæ³¨æ„ä¿®æ”¹ç½‘å¡çš„åå­—ï¼Œæˆ‘è¿™é‡Œæ˜¯`ens33`ï¼Œä¿®æ”¹æˆä½ çš„ç½‘å¡åå­—ï¼ŒåŒ…æ‹¬ä¿®æ”¹ipæ®µï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯`192.168.48.`ä½ å°±è¦ä¿®æ”¹æˆä½ çš„`172.8.3.`æœ€åé‚£ä¸€ä¸ªä¸»æœºä½å°±ä¸ç”¨ç®¡ï¼Œå…¶ä»–ä¸å˜\n\n```\nvi init.sh\n```\n\n```bash\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\necho \"2.æ­£åœ¨å…³é—­firewalldã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl stop firewalld\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nNAME=ens33\nUUID=53b402ff-5865-47dd-a853-7afcd6521738\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS1=192.168.48.2\nDNS2=114.114.114.114\nEOF\nnmcli c reload\nnmcli c up ens33\necho \"4.æ–°å¢åä¸ºäº‘æº\"\nmkdir /etc/yum.repos.d/bak/\ncp /etc/yum.repos.d/* /etc/yum.repos.d/bak/\n#åˆ‡æ¢ä¸ºåä¸ºäº‘ï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿«\nsed -i 's/\\$basearch/x86_64/g' /etc/yum.repos.d/openEuler.repo\nsed -i 's/http\\:\\/\\/repo.openeuler.org/https\\:\\/\\/mirrors.huaweicloud.com\\/openeuler/g' /etc/yum.repos.d/openEuler.repo\n\necho \"5.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\nyum clean all && yum makecache\n\necho \"6.æ·»åŠ hostsè§£æ\"\ncat > /etc/hosts <<EOF\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.101   controller\n192.168.48.102   compute\n192.168.48.103   storage\nEOF\n\necho \"7.å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\"\nyum install chrony -y\nsystemctl enable chronyd --now\ntimedatectl set-timezone Asia/Shanghai\ntimedatectl set-local-rtc 1\ntimedatectl set-ntp yes\nchronyc -a makestep\nchronyc tracking\nchronyc sources\n\necho \"8.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet socat device-mapper-persistent-data lvm2 git -y\n\necho \"9.å®‰è£…openstack\"\n#æ–°è£…çš„ç³»ç»Ÿï¼Œé»˜è®¤å¯ç”¨ EPOL ï¼Œè‹¥æ²¡æœ‰å¯åŠ¨ï¼Œè‡ªè¡Œå¯ç”¨ EPOL è½¯ä»¶ä»“ä»¥æ”¯æŒ OpenStack\nyum update -y\nyum install openstack-release-antelope -y\n\necho \"10.é‡å¯\"\nreboot\n```\n\nè¿è¡Œ\n\n```\nsh system_init.sh ä¸»æœºå  ä¸»æœºä½\n\n[controller] sh init.sh controller 101\n\n[compute] sh init.sh compute 102\n\n[storage] sh init.sh storage 103\n```\n\nSSHå…å¯†\n\n```bash\n#å„èŠ‚ç‚¹\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"controller\" \"compute\" \"storage\")\n# å¯†ç ï¼ˆæ³¨æ„ä¿®æ”¹ï¼‰!!!!!!!!!!!!!!!!!!!!!!!\npassword=\"Lj201840.\"\n# SSH é…ç½®æ–‡ä»¶\nssh_config=\"$HOME/.ssh/config\"\n\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# ç¡®ä¿ SSH é…ç½®æ–‡ä»¶å­˜åœ¨\nmkdir -p \"$HOME/.ssh\"\ntouch \"$ssh_config\"\nchmod 600 \"$ssh_config\"\n\n# æ·»åŠ  SSH é…ç½®\n{\n    echo \"Host *\"\n    echo \"    StrictHostKeyChecking no\"\n    echo \"    UserKnownHostsFile /dev/null\"\n} >> \"$ssh_config\"\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## ä¾èµ–ç»„ä»¶\n\n### æ—¶é—´åŒæ­¥\n\né›†ç¾¤ç¯å¢ƒæ—¶åˆ»è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹çš„æ—¶é—´ä¸€è‡´ï¼Œä¸€èˆ¬ç”±æ—¶é’ŸåŒæ­¥è½¯ä»¶ä¿è¯ã€‚æœ¬æ–‡ä½¿ç”¨`chrony`è½¯ä»¶\n\nç”±äºå‰é¢åŸºç¡€é…ç½®å·²ç»å®‰è£…chronyï¼Œè¿™é‡Œå°±ä¸å†å®‰è£…äº†\n\næ“ä½œèŠ‚ç‚¹ï¼š[controller]\n\n```bash\necho \"allow 192.168.48.0/24\" | sudo tee -a /etc/chrony.conf > /dev/null\nsystemctl restart chronyd\n```\n\næ“ä½œèŠ‚ç‚¹ï¼š[compute,storage]\n\n```bash\n# 192.168.48.101æ˜¯controller IPï¼Œè¡¨ç¤ºä»è¿™ä¸ªæœºå™¨è·å–æ—¶é—´ï¼Œè¿™é‡Œæˆ‘ä»¬å¡«192.168.48.101ï¼Œæˆ–è€…åœ¨`/etc/hosts`é‡Œé…ç½®å¥½çš„controlleråå­—å³å¯ã€‚\necho \"server 192.168.48.101 iburst\" | sudo tee -a /etc/chrony.conf > /dev/null\nsystemctl restart chronyd\n```\n\né…ç½®å®Œæˆåï¼Œæ£€æŸ¥ä¸€ä¸‹ç»“æœï¼Œåœ¨å…¶ä»–écontrollerèŠ‚ç‚¹æ‰§è¡Œ`chronyc sources`ï¼Œè¿”å›ç»“æœç±»ä¼¼å¦‚ä¸‹å†…å®¹ï¼Œè¡¨ç¤ºæˆåŠŸä»controlleråŒæ­¥æ—¶é’Ÿ\n\n![image-20241208163055470](https://i0.hdslb.com/bfs/article/c135552306af01075d91d08c382bc31b697559838.png)\n\n![image-20241208163141045](https://i0.hdslb.com/bfs/article/90c9558b91a9a0e76a0727b19666bd51697559838.png)\n\n### å®‰è£…æ•°æ®åº“\n\næ“ä½œèŠ‚ç‚¹:[controller]\n\n```bash\ndnf install mysql-config mariadb mariadb-server python3-PyMySQL -y\ncat > /etc/my.cnf.d/openstack.cnf << \"EOF\"\n[mysqld]\nbind-address = 192.168.48.101\ndefault-storage-engine = innodb\ninnodb_file_per_table = on\nmax_connections = 4096\ncollation-server = utf8_general_ci\ncharacter-set-server = utf8\nEOF\nsystemctl enable --now mariadb\n#åˆå§‹åŒ–æ•°æ®åº“\nmysql_secure_installation\nEnter current password for root (enter for none): å›è½¦\nSwitch to unix_socket authentication [Y/n] n\nChange the root password? [Y/n] y\n# å°†è¦æ±‚è¾“å…¥æ•°æ®åº“ root è´¦æˆ·å¯†ç  MARIADB_PASS\nRemove anonymous users? [Y/n] y\nDisallow root login remotely? [Y/n] Y\nRemove test database and access to it? [Y/n] y\nReload privilege tables now? [Y/n] y\n# éªŒè¯\nmysql -u root -pMARIADB_PASS\n```\n\n### å®‰è£…æ¶ˆæ¯é˜Ÿåˆ—\n\næ“ä½œèŠ‚ç‚¹:[controller]\n\n```bash\ndnf install rabbitmq-server -y\nsystemctl enable --now rabbitmq-server\nrabbitmqctl add_user openstack RABBIT_PASS\nrabbitmqctl set_permissions openstack \".*\" \".*\" \".*\"\n```\n\n### å®‰è£…ç¼“å­˜æœåŠ¡\n\næ“ä½œèŠ‚ç‚¹:[controller]\n\ncontrolleræ˜¯æˆ‘çš„ä¸»æœºåï¼Œä½ è¦æ”¹æˆä½ çš„ä¸»æœºå\n\n```bash\ndnf install memcached python3-memcached -y\nsed -i \"s/OPTIONS=\\\"-l 127.0.0.1,::1\\\"/OPTIONS=\\\"-l 127.0.0.1,::1,controller\\\"/g\" /etc/sysconfig/memcached\nsystemctl enable memcached --now\n```\n\n## Keystone\n\nKeystoneæ˜¯OpenStackæä¾›çš„é‰´æƒæœåŠ¡ï¼Œæ˜¯æ•´ä¸ªOpenStackçš„å…¥å£ï¼Œæä¾›äº†ç§Ÿæˆ·éš”ç¦»ã€ç”¨æˆ·è®¤è¯ã€æœåŠ¡å‘ç°ç­‰åŠŸèƒ½ï¼Œå¿…é¡»å®‰è£…ã€‚\n\nå»ºç«‹ä¸€ä¸ªè„šæœ¬  (`åç»­æˆ‘éƒ½ä¸åšè§£é‡Šäº†ï¼Œè‡ªè¡Œæ·»åŠ è„šæœ¬ï¼Œç„¶åè¿è¡Œï¼Œè¦æ³¨æ„è„šæœ¬é‡Œçš„å¯†ç å•¥çš„ï¼Œæ”¹æˆè‡ªå·±éœ€è¦çš„`)\n\n```\nmkdir openstack-install\ncd openstack-install\nvim keystone.sh\n```\n\næ·»åŠ ä»¥ä¸‹å†…å®¹\n\n```bash\n#!/bin/bash\n# åˆ›å»ºæ•°æ®åº“å¹¶æˆæƒ\n#æ›¿æ¢ KEYSTONE_DBPASSï¼Œä¸º keystone æ•°æ®åº“è®¾ç½®å¯†ç \necho \"CREATE DATABASE keystone;\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'KEYSTONE_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'KEYSTONE_DBPASS';\" | mysql -u root -pMARIADB_PASS\nmysql -u root -pMARIADB_PASS -e \"FLUSH PRIVILEGES;\"\nsleep 3\n# å®‰è£…OpenStack Keystoneå’Œç›¸å…³ä¾èµ–\ndnf install openstack-keystone httpd mod_wsgi -y\n\n# å¤‡ä»½å¹¶é…ç½®keystoneé…ç½®æ–‡ä»¶\nmv /etc/keystone/keystone.conf{,.bak}\ncat > /etc/keystone/keystone.conf <<EOF\n[database]\nconnection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone\n[token]\nprovider = fernet\nEOF\n\n# åŒæ­¥æ•°æ®åº“\nsu -s /bin/sh -c \"keystone-manage db_sync\" keystone\necho \"use keystone; show tables;\" | mysql -u root -pMARIADB_PASS\n# åˆå§‹åŒ–Fernetå¯†é’¥ä»“åº“å’Œå‡­è¯\nkeystone-manage fernet_setup --keystone-user keystone --keystone-group keystone\nkeystone-manage credential_setup --keystone-user keystone --keystone-group keystone\n\n# å¯åŠ¨æœåŠ¡\nkeystone-manage bootstrap --bootstrap-password 123456 \\\n--bootstrap-admin-url http://controller:5000/v3/ \\\n--bootstrap-internal-url http://controller:5000/v3/ \\\n--bootstrap-public-url http://controller:5000/v3/ \\\n--bootstrap-region-id RegionOne\n\n# é…ç½®Apache HTTP server\ncp /etc/httpd/conf/httpd.conf{,.bak}\nsed -i \"s/#ServerName www.example.com:80/ServerName controller/g\" /etc/httpd/conf/httpd.conf\nln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/\nsystemctl enable httpd --now\n\n# åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·é…ç½®æ–‡ä»¶\ncat << EOF > /root/admin-openrc\nexport OS_PROJECT_DOMAIN_NAME=Default\nexport OS_USER_DOMAIN_NAME=Default\nexport OS_PROJECT_NAME=admin\nexport OS_USERNAME=admin\nexport OS_PASSWORD=123456\nexport OS_AUTH_URL=http://controller:5000/v3\nexport OS_IDENTITY_API_VERSION=3\nexport OS_IMAGE_API_VERSION=2\nEOF\n\n# åˆ›å»ºæµ‹è¯•ç”¨æˆ·é…ç½®æ–‡ä»¶\ncat << EOF > /root/user_dog-openrc\nexport OS_USERNAME=user_dog\nexport OS_PASSWORD=123456\nexport OS_PROJECT_NAME=Demo\nexport OS_USER_DOMAIN_NAME=RegionOne\nexport OS_PROJECT_DOMAIN_NAME=RegionOne\nexport OS_AUTH_URL=http://controller:5000/v3\nexport OS_IDENTITY_API_VERSION=3\nexport OS_IMAGE_API_VERSION=2\nEOF\n\n# å®‰è£…python3-openstackclient\ndnf install python3-openstackclient -y\n\n# ä¾æ¬¡åˆ›å»ºdomain, projects, users, roles\nsource /root/admin-openrc\nopenstack domain create --description \"An RegionOne Domain\" RegionOne\nopenstack project create --domain default --description \"Service Project\" service\n# åœ¨ RegionOne åŸŸä¸­åˆ›å»ºä¸€ä¸ª Demo é¡¹ç›®\nopenstack project create --domain RegionOne --description \"Demo Project\" Demo\nopenstack user create --domain RegionOne --password 123456 user_dog\nopenstack role create user_dog_role\nopenstack role add --project Demo --user user_dog user_dog_role\n\n# åˆ—ä¸¾å½“å‰æ‰€æœ‰åŸŸå\nopenstack domain list\n```\n\nè¿è¡Œkeystoneè„šæœ¬\n\n```\nsh keystone.sh\n```\n\n![image-20241208171053281](https://i0.hdslb.com/bfs/article/428afc30bba203734ca51ab85629d399697559838.png)\n\n## Glance\n\n```\ncd openstack-install\nvim glance.sh\n```\n\n```shell\n#!/bin/bash\n#æ›¿æ¢ GLANCE_DBPASSï¼Œä¸º glance æ•°æ®åº“è®¾ç½®å¯†ç \necho \"CREATE DATABASE glance;\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'GLANCE_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' IDENTIFIED BY 'GLANCE_DBPASS';\" | mysql -u root -pMARIADB_PASS\nmysql -u root -pMARIADB_PASS -e \"FLUSH PRIVILEGES;\"\nsource /root/admin-openrc\n#åˆ›å»ºglanceç”¨æˆ·å¹¶è®¾ç½®å¯†ç \nopenstack user create --domain default --password GLANCE_PASS glance\n#æ·»åŠ glanceç”¨æˆ·åˆ°service projectå¹¶æŒ‡å®šadminè§’è‰²\nopenstack role add --project service --user glance admin\n#åˆ›å»ºglanceæœåŠ¡å®ä½“\nopenstack service create --name glance --description \"OpenStack Image\" image\n#åˆ›å»ºglance APIæœåŠ¡\nopenstack endpoint create --region RegionOne image public http://controller:9292\nopenstack endpoint create --region RegionOne image internal http://controller:9292\nopenstack endpoint create --region RegionOne image admin http://controller:9292\n#å®‰è£…è½¯ä»¶åŒ…\ndnf install openstack-glance -y\n#ä¿®æ”¹é…ç½®æ–‡ä»¶\nmv /etc/glance/glance-api.conf{,.bak}\ncat >/etc/glance/glance-api.conf << \"EOF\"\n[database]\nconnection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance\n\n[keystone_authtoken]\nwww_authenticate_uri  = http://controller:5000\nauth_url = http://controller:5000\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = glance\npassword = GLANCE_PASS\n\n[paste_deploy]\nflavor = keystone\n\n[glance_store]\nstores = file,http\ndefault_store = file\nfilesystem_store_datadir = /var/lib/glance/images/\nEOF\n#åŒæ­¥æ•°æ®åº“\nsu -s /bin/sh -c \"glance-manage db_sync\" glance\n#å¯åŠ¨æœåŠ¡\nsystemctl enable openstack-glance-api.service --now\nsource /root/admin-openrc\nmkdir /root/openstack-install/iso/\n#ä¸‹è½½é•œåƒ\nwget -P /root/openstack-install/iso/ https://resource.qianyios.top/cloud/iso/cirros-0.4.0-x86_64-disk.img\n#å‘ImageæœåŠ¡ä¸Šä¼ é•œåƒ\nsource /root/admin-openrc\nopenstack image create --disk-format qcow2 --container-format bare \\\n   --file /root/openstack-install/iso/cirros-0.4.0-x86_64-disk.img --public cirros\n#éªŒè¯æ˜¯å¦ä¸Šä¼ \nopenstack image list\n```\n\n```\nsh glance.sh\n```\n\n![image-20241208192109265](https://i0.hdslb.com/bfs/article/8a1a635b624d1796e0c129eb506f87fd697559838.png)\n\n## Placement\n\nPlacementæ˜¯OpenStackæä¾›çš„èµ„æºè°ƒåº¦ç»„ä»¶ï¼Œä¸€èˆ¬ä¸é¢å‘ç”¨æˆ·ï¼Œç”±Novaç­‰ç»„ä»¶è°ƒç”¨ï¼Œå®‰è£…åœ¨æ§åˆ¶èŠ‚ç‚¹ã€‚\n\nå®‰è£…ã€é…ç½®PlacementæœåŠ¡å‰ï¼Œéœ€è¦å…ˆåˆ›å»ºç›¸åº”çš„æ•°æ®åº“ã€æœåŠ¡å‡­è¯å’ŒAPI endpointsã€‚\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\ncd openstack-install\nvim placement.sh\n```\n\n```shell\n#!/bin/bash\n#åˆ›å»ºæ•°æ®åº“å¹¶æˆæƒ\n#æ›¿æ¢PLACEMENT_DBPASSä¸ºplacementæ•°æ®åº“è®¿é—®å¯†ç ã€‚\necho \"CREATE DATABASE placement;\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON placement.* TO 'placement'@'localhost' IDENTIFIED BY 'PLACEMENT_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON placement.* TO 'placement'@'%' IDENTIFIED BY 'PLACEMENT_DBPASS';\" | mysql -u root -pMARIADB_PASS\nmysql -u root -pMARIADB_PASS -e \"FLUSH PRIVILEGES;\"\n\nsource /root/admin-openrc\n#åˆ›å»ºplacementç”¨æˆ·å¹¶è®¾ç½®å¯†ç \nopenstack user create --domain default --password PLACEMENT_PASS placement\n#æ·»åŠ placementç”¨æˆ·åˆ°service projectå¹¶æŒ‡å®šadminè§’è‰²\nopenstack role add --project service --user placement admin\n#åˆ›å»ºplacementæœåŠ¡å®ä½“\nopenstack service create --name placement \\\n  --description \"Placement API\" placement\n#åˆ›å»ºPlacement APIæœåŠ¡endpoints\nopenstack endpoint create --region RegionOne \\\n  placement public http://controller:8778\nopenstack endpoint create --region RegionOne \\\n  placement internal http://controller:8778\nopenstack endpoint create --region RegionOne \\\n  placement admin http://controller:8778\n\n#å®‰è£…placement\ndnf install openstack-placement-api -y\n#é…ç½®placement\nmv /etc/placement/placement.conf{,.bak}\n#PLACEMENT_DBPASSä¸ºplacementæœåŠ¡çš„æ•°æ®åº“è´¦æˆ·å¯†ç \n#PLACEMENT_PASSä¸ºplacementæœåŠ¡çš„å¯†ç \n#ä»¥ä¸‹çš„placement.confæ–‡ä»¶ä¸è¦æœ‰ä»»ä½•çš„æ³¨é‡Šï¼Œä¸ç„¶åé¢ä¼šæŠ¥é”™\ncat > /etc/placement/placement.conf << \"EOF\"\n[placement_database]\nconnection = mysql+pymysql://placement:PLACEMENT_DBPASS@controller/placement\n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nauth_url = http://controller:5000/v3\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = placement\npassword = PLACEMENT_PASS\nEOF\nsu -s /bin/sh -c \"placement-manage db sync\" placement\noslopolicy-convert-json-to-yaml  --namespace placement \\\n  --policy-file /etc/placement/policy.json \\\n  --output-file /etc/placement/policy.yaml\nmv /etc/placement/policy.json{,.bak}\nsystemctl restart httpd\ndnf install python3-osc-placement -y\nplacement-status upgrade check\n```\n\n```\nsh placement.sh\n```\n\n![image-20241208193522497](https://i0.hdslb.com/bfs/article/35c73ecebfb9526be12acd1316ce239f697559838.png)\n\néªŒè¯æœåŠ¡ï¼Œåˆ—å‡ºå¯ç”¨çš„èµ„æºç±»åˆ«åŠç‰¹æ€§\n\n```\nsource /root/admin-openrc\nopenstack --os-placement-api-version 1.2 resource class list --sort-column name\nopenstack --os-placement-api-version 1.6 trait list --sort-column name\n```\n\n![image-20241208202746969](https://i0.hdslb.com/bfs/article/a1ef3888e4f1a721cb8a928469fafd92697559838.png)\n\n![image-20241208202805822](https://i0.hdslb.com/bfs/article/d8e6c1cfa2c178d3a062a88c1d1ac97b697559838.png)\n\n## Nova\n\nNovaæ˜¯OpenStackçš„è®¡ç®—æœåŠ¡ï¼Œè´Ÿè´£è™šæ‹Ÿæœºçš„åˆ›å»ºã€å‘æ”¾ç­‰åŠŸèƒ½ã€‚\n\n### controller\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\ncd openstack-install\nvim nova-controller.sh\n```\n\n```shell\n#åˆ›å»ºæ•°æ®åº“å¹¶æˆæƒ\n#åˆ›å»ºnova_apiã€novaå’Œnova_cell0æ•°æ®åº“ï¼š\necho \"CREATE DATABASE nova_api;\" | mysql -u root -pMARIADB_PASS\necho \"CREATE DATABASE nova;\" | mysql -u root -pMARIADB_PASS\necho \"CREATE DATABASE nova_cell0;\" | mysql -u root -pMARIADB_PASS\n#æˆæƒ\necho \"GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';\" | mysql -u root -pMARIADB_PASS\nmysql -u root -pMARIADB_PASS -e \"FLUSH PRIVILEGES;\"\n\nsource /root/admin-openrc\n#åˆ›å»ºnovaç”¨æˆ·å¹¶è®¾ç½®ç”¨æˆ·å¯†ç \nopenstack user create --domain default --password NOVA_PASS nova\n#æ·»åŠ novaç”¨æˆ·åˆ°service projectå¹¶æŒ‡å®šadminè§’è‰²\nopenstack role add --project service --user nova admin\n#åˆ›å»ºnovaæœåŠ¡å®ä½“\nopenstack service create --name nova \\\n  --description \"OpenStack Compute\" compute\n#åˆ›å»ºNova APIæœåŠ¡endpointsï¼š\nopenstack endpoint create --region RegionOne \\\n  compute public http://controller:8774/v2.1\nopenstack endpoint create --region RegionOne \\\n  compute internal http://controller:8774/v2.1\nopenstack endpoint create --region RegionOne \\\n  compute admin http://controller:8774/v2.1\ndnf install openstack-nova-api openstack-nova-conductor \\\n  openstack-nova-novncproxy openstack-nova-scheduler -y\n\nmv /etc/nova/nova.conf{,.bak}\ncat > /etc/nova/nova.conf <<EOF\n[DEFAULT]\nenabled_apis = osapi_compute,metadata\ntransport_url = rabbit://openstack:RABBIT_PASS@controller:5672/\n# RABBIT_PASSä¸º rabbitmq å¯†ç \nmy_ip = 192.168.48.101\n# æ§åˆ¶èŠ‚ç‚¹çš„ IP\nlog_dir = /var/log/nova\nstate_path = /var/lib/nova\n[api_database]\nconnection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api\n# NOVA_DBPASS ä¸ºæ•°æ®åº“ Nova è´¦æˆ·å¯†ç \n[database]\nconnection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova\n# NOVA_DBPASS ä¸ºæ•°æ®åº“ Nova è´¦æˆ·å¯†ç \n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nauth_url = http://controller:5000/v3\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = nova\npassword = NOVA_PASS\n# NOVA_PASS ä¸º Nova æœåŠ¡çš„å¯†ç \n[vnc]\nenabled = true\nserver_listen = \\$my_ip\nserver_proxyclient_address = \\$my_ip\n[glance]\napi_servers = http://controller:9292\n[oslo_concurrency]\nlock_path = /var/lib/nova/tmp\n[placement]\nregion_name = RegionOne\nproject_domain_name = Default\nproject_name = service\nauth_type = password\nuser_domain_name = Default\nauth_url = http://controller:5000/v3\nusername = placement\npassword = PLACEMENT_PASS\n# PLACEMENT_PASS ä¸º placement æœåŠ¡çš„å¯†ç \nEOF\n#åŒæ­¥æ•°æ®åº“\nsu -s /bin/sh -c \"nova-manage api_db sync\" nova\nsu -s /bin/sh -c \"nova-manage cell_v2 map_cell0\" nova\nsu -s /bin/sh -c \"nova-manage cell_v2 create_cell --name=cell1 --verbose\" nova\nsu -s /bin/sh -c \"nova-manage db sync\" nova\n#éªŒè¯cell0å’Œcell1æ³¨å†Œæ­£ç¡®\nsu -s /bin/sh -c \"nova-manage cell_v2 list_cells\" nova\n\n#å¯åŠ¨æœåŠ¡\nsystemctl enable \\\n  openstack-nova-api.service \\\n  openstack-nova-scheduler.service \\\n  openstack-nova-conductor.service \\\n  openstack-nova-novncproxy.service --now\n```\n\n```\nsh nova-controller.sh\n```\n\n![image-20241208204427484](https://i0.hdslb.com/bfs/article/8a6b800069b36d39f2da32d097bcc531697559838.png)\n\n### compute\n\næ“ä½œèŠ‚ç‚¹[compute]\n\nç¡®è®¤è®¡ç®—èŠ‚ç‚¹æ˜¯å¦æ”¯æŒè™šæ‹Ÿæœºç¡¬ä»¶åŠ é€Ÿï¼ˆx86_64ï¼‰\n\n```\negrep -c '(vmx|svm)' /proc/cpuinfo\n```\n\nå¦‚æœè¿”å›å€¼ä¸º0åˆ™ä¸æ”¯æŒç¡¬ä»¶åŠ é€Ÿã€‚\n\n`è¿™æ—¶å€™è¯·å›åˆ°æ–‡ç« å¼€å¤´å‰æƒ…æè¦éƒ¨åˆ†ï¼Œè®¤çœŸçœ‹çœ‹å¦‚ä½•å¼€å¯ç¡¬ä»¶åŠ é€Ÿ`\n\nä¸å¥½å¥½çœ‹æ–‡ç« ï¼Œä½ å°±è¦å›åˆ°å¼€å¤´å‘—ï¼Œç´¯å§ï¼Ÿ\n\n```\nmkdir openstack-install && cd openstack-install\nvim nova-compute.sh\n```\n\n```shell\n#!/bin/bash\ndnf install openstack-nova-compute -y\nmv /etc/nova/nova.conf{,.bak}\ncat > /etc/nova/nova.conf <<EOF\n[DEFAULT]\nenabled_apis = osapi_compute,metadata\ntransport_url = rabbit://openstack:RABBIT_PASS@controller:5672/\n#æ›¿æ¢RABBIT_PASSä¸ºRabbitMQä¸­openstackè´¦æˆ·çš„å¯†ç ã€‚\nmy_ip = 192.168.48.102\ncompute_driver = libvirt.LibvirtDriver\ninstances_path = /var/lib/nova/instances\nlog_dir = /var/log/nova\nlock_path = /var/lock/nova\nstate_path = /var/lib/nova\n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nauth_url = http://controller:5000/v3\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = nova\npassword = NOVA_PASS\n#æ›¿æ¢NOVA_PASSä¸ºnovaç”¨æˆ·çš„å¯†ç ã€‚\n[vnc]\nenabled = true\nserver_listen = \\$my_ip\nserver_proxyclient_address = \\$my_ip\nnovncproxy_base_url = http://192.168.48.101:6080/vnc_auto.html\n#å»ºè®®è®¾ç½®æˆ192.168.48.101ï¼Œä¹Ÿå°±æ˜¯controllerï¼Œè¿™ä¸ªå†³å®šä½ åœ¨é¡µé¢è®¿é—®å®ä¾‹æ§åˆ¶å°çš„åœ°å€ï¼Œå¦‚æœä½ æ˜¯è‡ªå·±çš„ç”µè„‘è®¿é—®ï¼Œç„¶åä½ åˆæ²¡æœ‰è®¾ç½®hostsæ˜ å°„åˆ°controllerï¼Œä½ ä¼šè®¿é—®ä¸åˆ°çš„ï¼Œæ”¹æˆipå¯ä»¥è®¿é—®\n[glance]\napi_servers = http://controller:9292\n[oslo_concurrency]\nlock_path = /var/lib/nova/tmp\n[placement]\nregion_name = RegionOne\nproject_domain_name = Default\nproject_name = service\nauth_type = password\nuser_domain_name = Default\nauth_url = http://controller:5000/v3\nusername = placement\npassword = PLACEMENT_PASS\n#PLACEMENT_PASS ä¸º Placement æœåŠ¡å¯†ç \nEOF\nsystemctl enable libvirtd.service openstack-nova-compute.service --now\n```\n\n```\nsh nova-compute.sh\n```\n\n### éªŒè¯æœåŠ¡\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```bash\nsource /root/admin-openrc\nopenstack compute service list --service nova-compute\n#å½“ä½ å‘ç¯å¢ƒä¸­æ·»åŠ æ–°çš„è®¡ç®—èŠ‚ç‚¹æ—¶ï¼Œç¡®ä¿è¿™äº›æ–°èŠ‚ç‚¹è¢«åŠ å…¥åˆ°æ­£ç¡®çš„Cellä¸­\nsu -s /bin/sh -c \"nova-manage cell_v2 discover_hosts --verbose\" nova\n#åˆ—å‡ºæœåŠ¡ç»„ä»¶ï¼ŒéªŒè¯æ¯ä¸ªæµç¨‹éƒ½æˆåŠŸå¯åŠ¨å’Œæ³¨å†Œï¼š\nopenstack compute service list\n#åˆ—å‡ºèº«ä»½æœåŠ¡ä¸­çš„APIç«¯ç‚¹ï¼ŒéªŒè¯ä¸èº«ä»½æœåŠ¡çš„è¿æ¥ï¼š\nopenstack catalog list\n#åˆ—å‡ºé•œåƒæœåŠ¡ä¸­çš„é•œåƒï¼ŒéªŒè¯ä¸é•œåƒæœåŠ¡çš„è¿æ¥ï¼š\nopenstack image list\n#æ£€æŸ¥cellsæ˜¯å¦è¿ä½œæˆåŠŸï¼Œä»¥åŠå…¶ä»–å¿…è¦æ¡ä»¶æ˜¯å¦å·²å…·å¤‡ã€‚\nnova-status upgrade check\n```\n\n![image-20241208214423919](https://i0.hdslb.com/bfs/article/16727e56c1c7a2a3e209419f940f5fcf697559838.png)\n\n![image-20241208215425973](https://i0.hdslb.com/bfs/article/cdf477ca098924d427b6d7a9380b2976697559838.png)\n\n![image-20241208215352075](https://i0.hdslb.com/bfs/article/7f18164303fde4980f34307fb17b39ed697559838.png)\n\n## Neutron\n\nNeutronæ˜¯OpenStackçš„ç½‘ç»œæœåŠ¡ï¼Œæä¾›è™šæ‹Ÿäº¤æ¢æœºã€IPè·¯ç”±ã€DHCPç­‰åŠŸèƒ½ã€‚\n\n### controller\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\ncd openstack-install\nvim neutron-controller.sh\n```\n\n```bash\n#!/bin/bash\n#åˆ›å»ºæ•°æ®åº“å¹¶æˆæƒ\necho \"CREATE DATABASE neutron;\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' IDENTIFIED BY 'NEUTRON_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' IDENTIFIED BY 'NEUTRON_DBPASS';\" | mysql -u root -pMARIADB_PASS\nmysql -u root -pMARIADB_PASS -e \"FLUSH PRIVILEGES;\"\n#åˆ›å»ºneutronç”¨æˆ·å’ŒæœåŠ¡\nsource /root/admin-openrc\nopenstack user create --domain default --password NEUTRON_PASS neutron\nopenstack role add --project service --user neutron admin\nopenstack service create --name neutron \\\n  --description \"OpenStack Networking\" network\n#éƒ¨ç½² Neutron API æœåŠ¡\nopenstack endpoint create --region RegionOne \\\n  network public http://controller:9696\nopenstack endpoint create --region RegionOne \\\n  network internal http://controller:9696\nopenstack endpoint create --region RegionOne \\\n  network admin http://controller:9696\n#å®‰è£…è½¯ä»¶åŒ…\ndnf install -y openstack-neutron openstack-neutron-linuxbridge ebtables ipset openstack-neutron-ml2\n#é…ç½®Neutron\nmv /etc/neutron/neutron.conf{,.bak}\ncat >/etc/neutron/neutron.conf<<\"EOF\"\n[database]\nconnection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron\n\n[DEFAULT]\ncore_plugin = ml2\nservice_plugins = router\nallow_overlapping_ips = true\ntransport_url = rabbit://openstack:RABBIT_PASS@controller\nauth_strategy = keystone\nnotify_nova_on_port_status_changes = true\nnotify_nova_on_port_data_changes = true\n\n[keystone_authtoken]\nwww_authenticate_uri = http://controller:5000\nauth_url = http://controller:5000\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\n\n[nova]\nauth_url = http://controller:5000\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nregion_name = RegionOne\nproject_name = service\nusername = nova\npassword = NOVA_PASS\n\n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\n\n[experimental]\nlinuxbridge = true\nEOF\n#é…ç½®ML2ï¼ŒML2å…·ä½“é…ç½®å¯ä»¥æ ¹æ®ç”¨æˆ·éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯provider network + linuxbridge**\nmv /etc/neutron/plugins/ml2/ml2_conf.ini{,.bak}\n#ä¿®æ”¹/etc/neutron/plugins/ml2/ml2_conf.ini\ncat > /etc/neutron/plugins/ml2/ml2_conf.ini << EOF\n[ml2]\ntype_drivers = flat,vlan,vxlan\ntenant_network_types = vxlan\nmechanism_drivers = linuxbridge,l2population\nextension_drivers = port_security\n\n[ml2_type_flat]\nflat_networks = provider\n\n[ml2_type_vxlan]\nvni_ranges = 1:1000\n\n[securitygroup]\nenable_ipset = true\nEOF\n\n#ä¿®æ”¹/etc/neutron/plugins/ml2/linuxbridge_agent.ini\ncat > /etc/neutron/plugins/ml2/linuxbridge_agent.ini <<EOF\n\n[linux_bridge]\nphysical_interface_mappings = provider:ens33\n# ens33 ä¸ºç¬¬ä¸€å—ç½‘å¡åç§°\n[vxlan]\nenable_vxlan = true\nlocal_ip = 192.168.48.101\nl2_population = true\n# 192.168.48.101 ä¸ºæ§åˆ¶èŠ‚ç‚¹çš„ IP\n[securitygroup]\nenable_security_group = true\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\nEOF\n#é…ç½®Layer-3ä»£ç†\nmv /etc/neutron/l3_agent.ini{,.bak}\ncat > /etc/neutron/l3_agent.ini << EOF\n[DEFAULT]\ninterface_driver = linuxbridge\nEOF\n#é…ç½®DHCPä»£ç† \nmv /etc/neutron/dhcp_agent.ini{,.bak}\ncat > /etc/neutron/dhcp_agent.ini << EOF\n[DEFAULT]\ninterface_driver = linuxbridge\ndhcp_driver = neutron.agent.linux.dhcp.Dnsmasq\nenable_isolated_metadata = true\nEOF\n#é…ç½®metadataä»£ç†\nmv /etc/neutron/metadata_agent.ini{,.bak}\ncat >> /etc/neutron/metadata_agent.ini << EOF\n[DEFAULT]\nnova_metadata_host = controller\nmetadata_proxy_shared_secret = METADATA_SECRET\n# METADATA_SECRET ä¸º å…ƒæ•°æ® çš„å¯†é’¥\nEOF\n\ncat >> /etc/nova/nova.conf << EOF\n#è¿½åŠ åœ¨æœ«å°¾\n[neutron]\nauth_url = http://controller:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\nservice_metadata_proxy = true\nmetadata_proxy_shared_secret = METADATA_SECRET\n#NEUTRON_PASS  ä¸º neutron æœåŠ¡çš„å¯†ç \n#METADATA_SECRET ä¸ºä¸Šè¾¹è®¾ç½®çš„å…ƒæ•°æ®å¯†é’¥\nEOF\n#åˆ›å»º/etc/neutron/plugin.iniçš„ç¬¦å·é“¾æ¥\nln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini\nsu -s /bin/sh -c \"neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head\" neutron\nsystemctl restart openstack-nova-api\nsystemctl enable neutron-server.service neutron-linuxbridge-agent.service \\\nneutron-dhcp-agent.service neutron-metadata-agent.service neutron-l3-agent.service --now\n```\n\n```\nsh neutron-controller.sh\n```\n\n### compute\n\næ“ä½œèŠ‚ç‚¹[compute]\n\n```\ncd openstack-install\nvim neutron-compute.sh\n```\n\n```shell\n#!/bin/bash\ndnf install openstack-neutron-linuxbridge ebtables ipset -y\n#é…ç½®neutron\ncat >/etc/neutron/neutron.conf << \"EOF\"\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller\nauth_strategy = keystone\n\n[keystone_authtoken]\nwww_authenticate_uri = http://controller:5000\nauth_url = http://controller:5000\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\n\n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\nEOF\n#ä¿®æ”¹/etc/neutron/plugins/ml2/linuxbridge_agent.ini\ncat > /etc/neutron/plugins/ml2/linuxbridge_agent.ini <<EOF\n\n[linux_bridge]\nphysical_interface_mappings = provider:ens33\n# ens33 ä¸ºç¬¬ä¸€å—ç½‘å¡åç§°\n[vxlan]\nenable_vxlan = true\nlocal_ip = 192.168.48.102\nl2_population = true\n# 192.168.48.102 ä¸ºè®¡ç®—èŠ‚ç‚¹çš„ IP\n[securitygroup]\nenable_security_group = true\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\nEOF\n#é…ç½®nova computeæœåŠ¡ä½¿ç”¨neutron\ncat >> /etc/nova/nova.conf << EOF\n#è¿½åŠ åœ¨æœ«å°¾\n[neutron]\nauth_url = http://controller:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\nservice_metadata_proxy = true\nmetadata_proxy_shared_secret = METADATA_SECRET\n#NEUTRON_PASS  ä¸º neutron æœåŠ¡çš„å¯†ç \n#METADATA_SECRET ä¸ºä¸Šè¾¹è®¾ç½®çš„å…ƒæ•°æ®å¯†é’¥\nEOF\nsystemctl restart openstack-nova-compute.service\nsystemctl enable neutron-linuxbridge-agent --now\n```\n\n```\nsh neutron-compute.sh\n```\n\n### éªŒè¯æœåŠ¡\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\nsource admin-openrc\nopenstack network agent list\n```\n\nç¡®ä¿äº”ä¸ªéƒ½æ˜¯upä½ å†åšä¸‹ä¸€æ­¥\n\n![image-20241208222944410](https://i0.hdslb.com/bfs/article/a3a30d77f9e5abafb5b929f7010f1877697559838.png)\n\n## Cinder\n\nCinderæ˜¯OpenStackçš„å­˜å‚¨æœåŠ¡ï¼Œæä¾›å—è®¾å¤‡çš„åˆ›å»ºã€å‘æ”¾ã€å¤‡ä»½ç­‰åŠŸèƒ½ã€‚\n\n### controller\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\ncd openstack-install\nvim cinder-controller.sh\n```\n\n`my_ip = 192.168.48.101ä¸ºæ§åˆ¶èŠ‚ç‚¹ip`\n\n```bash\n#!/bin/bash\necho \"CREATE DATABASE cinder;\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' IDENTIFIED BY 'CINDER_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' IDENTIFIED BY 'CINDER_DBPASS';\" | mysql -u root -pMARIADB_PASS\nmysql -u root -pMARIADB_PASS -e \"FLUSH PRIVILEGES;\"\nsource /root/admin-openrc\nopenstack user create --domain default --password CINDER_PASS cinder\nopenstack role add --project service --user cinder admin\nopenstack service create --name cinderv3 \\\n  --description \"OpenStack Block Storage\" volumev3\nopenstack endpoint create --region RegionOne \\\n  volumev3 public http://controller:8776/v3/%\\(project_id\\)s\nopenstack endpoint create --region RegionOne \\\n  volumev3 internal http://controller:8776/v3/%\\(project_id\\)s\nopenstack endpoint create --region RegionOne \\\n  volumev3 admin http://controller:8776/v3/%\\(project_id\\)s\ndnf install openstack-cinder-api openstack-cinder-scheduler -y\ncat >/etc/cinder/cinder.conf<<\"EOF\"\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller\nauth_strategy = keystone\nmy_ip = 192.168.48.101\n[database]\nconnection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder\n[keystone_authtoken]\nwww_authenticate_uri = http://controller:5000\nauth_url = http://controller:5000\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = cinder\npassword = CINDER_PASS\n[oslo_concurrency]\nlock_path = /var/lib/cinder/tmp\nEOF\nsu -s /bin/sh -c \"cinder-manage db sync\" cinder\ncat >> /etc/nova/nova.conf << EOF\n[cinder]\nos_region_name = RegionOne\nEOF\nsystemctl restart openstack-nova-api\nsystemctl enable openstack-cinder-api openstack-cinder-scheduler  --now\n```\n\n```\nsh cinder-controller.sh\n```\n\n### Storage\n\nå…³é—­æ‰€æœ‰èŠ‚ç‚¹(è¿è¡Œä¸äº†ï¼Œè¯·å›å¼€å¤´ï¼Œå¤åˆ¶å…³é—­é¡ºåºè„šæœ¬)<font color='red'>ï¼ˆæ³¨æ„å…³é—­é¡ºåºï¼Œè¿™é‡Œä¸åœ¨è¯´æ˜ï¼Œå›å¤´çœ‹ï¼‰</font>\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[æ‰€æœ‰èŠ‚ç‚¹]</font>\n\n```\nsh stop.sh\n```\n\nç»™computeæ·»åŠ ä¸€å—100gçš„ç£ç›˜\n\n![image-20241209211926972](https://i0.hdslb.com/bfs/article/87d2c3924d10efdb684d6f2dd0846fac697559838.png)\n\n`æ“ä½œèŠ‚ç‚¹[Storage]`\n\næŒ‰ç…§å‰æƒ…æè¦é‡Œçš„**Storage**èŠ‚ç‚¹ï¼Œæ·»åŠ ä¸€å—`æ–°ç¡¬ç›˜`ï¼Œæˆ‘è¿™é‡Œæ˜¯`/dev/sdb`\n\nCinderæ”¯æŒå¾ˆå¤šç±»å‹çš„åç«¯å­˜å‚¨ï¼Œæœ¬æŒ‡å¯¼ä½¿ç”¨æœ€ç®€å•çš„lvmä¸ºå‚è€ƒï¼Œå¦‚æœæ‚¨æƒ³ä½¿ç”¨å¦‚cephç­‰å…¶ä»–åç«¯ï¼Œè¯·è‡ªè¡Œé…ç½®ã€‚\n\n```\nmkdir openstack-install && cd openstack-install\nvim cinder-storage.sh\n```\n\n```ini\n#!/bin/bash\ndnf install lvm2 device-mapper-persistent-data scsi-target-utils rpcbind nfs-utils openstack-cinder-volume openstack-cinder-backup -y\n#é…ç½®lvmå·ç»„\npvcreate /dev/sdb\nvgcreate cinder-volumes /dev/sdb\n# sdb ä¸ºåˆ’åˆ†ç»™å—å­˜å‚¨ä½¿ç”¨çš„ç£ç›˜\n# å¦‚æœ‰å¤šä¸ªç£ç›˜ï¼Œåˆ™éœ€é‡å¤ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤\n\n#é…ç½®cinder\nmv /etc/cinder/cinder.conf{,.bak}\ncat >/etc/cinder/cinder.conf<<\"EOF\"\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller\nauth_strategy = keystone\nmy_ip = 192.168.0.4\nenabled_backends = lvm\nglance_api_servers = http://controller:9292\n[keystone_authtoken]\nwww_authenticate_uri = http://controller:5000\nauth_url = http://controller:5000\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = cinder\npassword = CINDER_PASS\n[database]\nconnection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder\n[lvm]\nvolume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver\nvolume_group = cinder-volumes\ntarget_protocol = iscsi\ntarget_helper = lioadm\n[oslo_concurrency]\nlock_path = /var/lib/cinder/tmp\nEOF\nsystemctl enable openstack-cinder-volume target --now\n\n```\n\n```\nsh cinder-storage.sh\n```\n\nè‡³æ­¤ï¼ŒCinderæœåŠ¡çš„éƒ¨ç½²å·²å…¨éƒ¨å®Œæˆï¼Œå¯ä»¥åœ¨controlleré€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç®€å•çš„éªŒè¯\n\n> `é…ç½®cinder backup ï¼ˆå¯é€‰ï¼‰`\n>\n> cinder-backupæ˜¯å¯é€‰çš„å¤‡ä»½æœåŠ¡ï¼ŒcinderåŒæ ·æ”¯æŒå¾ˆå¤šç§å¤‡ä»½åç«¯ï¼Œæœ¬æ–‡ä½¿ç”¨swiftå­˜å‚¨ï¼Œå¦‚æœæ‚¨æƒ³ä½¿ç”¨å¦‚NFSç­‰åç«¯ï¼Œè¯·è‡ªè¡Œé…ç½®ï¼Œä¾‹å¦‚å¯ä»¥å‚è€ƒ[OpenStackå®˜æ–¹æ–‡æ¡£](https://docs.openstack.org/cinder/2023.1/admin/nfs-backend.html)å¯¹NFSçš„é…ç½®è¯´æ˜ã€‚\n>\n> ä¿®æ”¹`/etc/cinder/cinder.conf`ï¼Œåœ¨`[DEFAULT]`ä¸­æ–°å¢\n>\n> ```ini\n> [DEFAULT]\n> backup_driver = cinder.backup.drivers.swift.SwiftBackupDriver\n> backup_swift_url = SWIFT_URL\n> ```\n>\n> è¿™é‡Œçš„`SWIFT_URL`æ˜¯æŒ‡ç¯å¢ƒä¸­swiftæœåŠ¡çš„URLï¼Œåœ¨éƒ¨ç½²å®ŒswiftæœåŠ¡åï¼Œæ‰§è¡Œ`openstack catalog show object-store`å‘½ä»¤è·å–ã€‚\n>\n> ```\n> systemctl start openstack-cinder-backup \n> ```\n\n### éªŒè¯æœåŠ¡\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\nsource admin-openrc\nsystemctl restart httpd memcached\nopenstack volume service list\n```\n\n![image-20241208234946287](https://i0.hdslb.com/bfs/article/de4c86bdf2f44d43f1637058cf5ea496697559838.png)\n\n## Horizon\n\nHorizonæ˜¯OpenStackæä¾›çš„å‰ç«¯é¡µé¢ï¼Œå¯ä»¥è®©ç”¨æˆ·é€šè¿‡ç½‘é¡µé¼ æ ‡çš„æ“ä½œæ¥æ§åˆ¶OpenStacké›†ç¾¤ï¼Œè€Œä¸ç”¨ç¹ççš„CLIå‘½ä»¤è¡Œã€‚Horizonä¸€èˆ¬éƒ¨ç½²åœ¨æ§åˆ¶èŠ‚ç‚¹ã€‚\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\ncd openstack-install\nvim horizon-controller.sh\n```\n\n```ini\ndnf install openstack-dashboard -y\ncp /etc/openstack-dashboard/local_settings{,.bak}\nsed -i 's/^ALLOWED_HOSTS/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^OPENSTACK_HOST/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^OPENSTACK_KEYSTONE_URL/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^TIME_ZONE/#&/' /etc/openstack-dashboard/local_settings\ncat >>/etc/openstack-dashboard/local_settings << \"EOF\"\nOPENSTACK_HOST = \"controller\"\nALLOWED_HOSTS = ['*']\nOPENSTACK_KEYSTONE_URL =  \"http://controller:5000/v3\"\nSESSION_ENGINE = 'django.contrib.sessions.backends.cache'\nCACHES = {\n'default': {\n    'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',\n    'LOCATION': 'controller:11211',\n    }\n}\nOPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True\nOPENSTACK_KEYSTONE_DEFAULT_DOMAIN = \"Default\"\nOPENSTACK_KEYSTONE_DEFAULT_ROLE = \"member\"\nWEBROOT = '/dashboard'\nTIME_ZONE = \"Asia/Shanghai\"\nPOLICY_FILES_PATH = \"/etc/openstack-dashboard\"\n\nOPENSTACK_API_VERSIONS = {\n    \"identity\": 3,\n    \"image\": 2,\n    \"volume\": 3,\n}\nEOF\nsystemctl restart httpd memcached\n```\n\n```\nsh horizon-controller.sh\n```\n\nè‡³æ­¤ï¼ŒhorizonæœåŠ¡çš„éƒ¨ç½²å·²å…¨éƒ¨å®Œæˆï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥`http://192.168.48.101/dashboard`ï¼Œæ‰“å¼€horizonç™»å½•é¡µé¢ã€‚\n\n![image-20241209003341910](https://i0.hdslb.com/bfs/article/d075519bb58011ef9d399b85fa3cd923697559838.png)\n\n![image-20241209003519051](https://i0.hdslb.com/bfs/article/b5de3b3f3ad748374ede0379f1cdc29b697559838.png)\n\n## Swift\n\nSwift æä¾›äº†å¼¹æ€§å¯ä¼¸ç¼©ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œé€‚åˆå­˜å‚¨å¤§è§„æ¨¡éç»“æ„åŒ–æ•°æ®ã€‚\n\n### controller\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```ini\ncd openstack-install\nvim swift-controller-1.sh\n```\n\n```ini\n#!/bin/bash\n#åˆ›å»ºæœåŠ¡å‡­è¯ä»¥åŠAPIç«¯ç‚¹ã€‚\n# åˆ›å»ºswiftç”¨æˆ·\nsource /root/admin-openrc\nopenstack user create --domain default --password SWIFT_PASS swift\n# æ·»åŠ adminè§’è‰²\nopenstack role add --project service --user swift admin\n# åˆ›å»ºå¯¹è±¡å­˜å‚¨æœåŠ¡\nopenstack service create --name swift --description \"OpenStack Object Storage\" object-store\n#åˆ›å»ºAPIç«¯ç‚¹ã€‚\nopenstack endpoint create --region RegionOne object-store public http://controller:8080/v1/AUTH_%\\(project_id\\)s\nopenstack endpoint create --region RegionOne object-store internal http://controller:8080/v1/AUTH_%\\(project_id\\)s\nopenstack endpoint create --region RegionOne object-store admin http://controller:8080/v1 \n#å®‰è£…Swiftã€‚\ndnf install openstack-swift-proxy python3-swiftclient \\\npython3-keystoneclient python3-keystonemiddleware memcached -y\n#é…ç½®proxy-serverã€‚\n#Swift RPMåŒ…é‡Œå·²ç»åŒ…å«äº†ä¸€ä¸ªåŸºæœ¬å¯ç”¨çš„proxy-server.confï¼Œåªéœ€è¦æ‰‹åŠ¨ä¿®æ”¹å…¶ä¸­çš„ipï¼ˆcontrollerå¯ä»¥ä¸æ”¹ï¼Œçœ‹ä½ è‡ªå·±éœ€è¦ï¼‰å’ŒSWIFT_PASSå³å¯ã€‚\nsed -i \"s/password = swift/password = SWIFT_PASS/g\" /etc/swift/proxy-server.conf\n```\n\n```\nsh swift-controller-1.sh\n```\n\n### Storage\n\næœ¬èŠ‚ç‚¹ï¼Œæ·»åŠ äº†å››å—ç¡¬ç›˜ä½œä¸ºswiftä½¿ç”¨çš„ç¡¬ç›˜\n\n<font color='red'>å…³é—­æ‰€æœ‰èŠ‚ç‚¹ï¼Œå›å¤´çœ‹ç‰©ç†å…³é—­é¡ºåº</font>\n\nç»™<font color='red'>storage</font>æ·»åŠ 4å¼ ç¡¬ç›˜ï¼Œæ·»åŠ å®Œä¹‹åå°±å¯ä»¥å¼€æœºäº†\n\n![image-20241209211943192](https://i0.hdslb.com/bfs/article/27f4d5b41f470c1836a5920ed5603321697559838.png)\n\næ“ä½œèŠ‚ç‚¹[Storage]\n\n```\ncd openstack-install\nvim swift-storage-1.sh\n```\n\n```ini\n#!/bin/bash\ndnf install openstack-swift-account openstack-swift-container openstack-swift-object -y\ndnf install xfsprogs rsync -y \n#å°†sdc,sdd,sde,sdfè®¾å¤‡æ ¼å¼åŒ–ä¸ºXFSï¼š\nmkfs.xfs -f /dev/sdc\nmkfs.xfs -f /dev/sdd\nmkfs.xfs -f /dev/sde\nmkfs.xfs -f /dev/sdf\n#åˆ›å»ºå®‰è£…ç‚¹ç›®å½•ç»“æ„ï¼š\nmkdir -p /srv/node/sdc\nmkdir -p /srv/node/sdd\nmkdir -p /srv/node/sde\nmkdir -p /srv/node/sdf\n#å†™å…¥è‡ªåŠ¨æŒ‚è½½\ncat >> /etc/fstab << EOF\n/dev/sdc /srv/node/sdc xfs noatime 0 2\n/dev/sdd /srv/node/sdd xfs noatime 0 2\n/dev/sde /srv/node/sde xfs noatime 0 2\n/dev/sdf /srv/node/sdf xfs noatime 0 2\nEOF\n#æŒ‚è½½è®¾å¤‡\nsystemctl daemon-reload\nmount -t xfs /dev/sdc /srv/node/sdc\nmount -t xfs /dev/sdd /srv/node/sdd\nmount -t xfs /dev/sde /srv/node/sde\nmount -t xfs /dev/sdf /srv/node/sdf\n#å¦‚æœç”¨æˆ·ä¸éœ€è¦å®¹ç¾åŠŸèƒ½ï¼Œä»¥ä¸Šæ­¥éª¤åªéœ€è¦åˆ›å»ºä¸€ä¸ªè®¾å¤‡å³å¯ï¼ŒåŒæ—¶å¯ä»¥è·³è¿‡ä¸‹é¢çš„rsyncé…ç½®ã€‚\nmv /etc/rsyncd.conf{,.bak}\ncat>/etc/rsyncd.conf<<EOF\n[DEFAULT]\nuid = swift\ngid = swift\nlog file = /var/log/rsyncd.log\npid file = /var/run/rsyncd.pid\naddress = 192.168.48.103\n#192.168.48.103ä¸ºstorageçš„ip\n[account]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/account.lock\n\n[container]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/container.lock\n\n[object]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/object.lock\nEOF\nsystemctl enable rsyncd.service --now\n#ç¼–è¾‘/etc/swiftç›®å½•çš„account-server.confã€container-server.confå’Œobject-server.confæ–‡ä»¶ï¼Œæ›¿æ¢bind_ipä¸ºå­˜å‚¨èŠ‚ç‚¹çš„IPåœ°å€ã€‚\nsudo sed -i 's/^bind_ip = 127\\.0\\.0\\.1$/bind_ip = 192.168.48.103/' /etc/swift/account-server.conf /etc/swift/container-server.conf /etc/swift/object-server.conf\n#ç¡®ä¿æŒ‚è½½ç‚¹ç›®å½•ç»“æ„çš„æ­£ç¡®æ‰€æœ‰æƒã€‚\nchown -R swift:swift /srv/node\n#åˆ›å»ºreconç›®å½•å¹¶ç¡®ä¿å…¶æ‹¥æœ‰æ­£ç¡®çš„æ‰€æœ‰æƒã€‚\nmkdir -p /var/cache/swift\nchown -R root:swift /var/cache/swift\nchmod -R 775 /var/cache/swift\n```\n\n```\nsh swift-storage-1.sh\n```\n\n### controller\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\ncd openstack-install\nvim swift-controller-2.sh\n```\n\n```ini\n#!/bin/bash\n#åˆ›å»ºå’Œåˆ†å‘åˆå§‹ç¯\n#è½¬åˆ°/etc/swiftç›®å½•ã€‚(æ‰€ä»¥æ“ä½œåœ¨æ­¤ç›®å½•ï¼Œæ‰§è¡Œ)\ncd /etc/swift\n##ç¬¬ä¸€éƒ¨åˆ†ï¼ˆ6202ï¼‰åˆ›å»ºç”¨æˆ·ç¯\nswift-ring-builder account.builder create 10 3 1\n#å°†æ¯ä¸ªå­˜å‚¨èŠ‚ç‚¹æ·»åŠ åˆ°ç¯ä¸­ã€‚\nswift-ring-builder account.builder add \\\n   --region 1 --zone 1 --ip 192.168.48.103 \\\n   --port 6202 --device sdc --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 1 --ip 192.168.48.103 \\\n   --port 6202 --device sdd --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 2 --ip 192.168.48.103 \\\n   --port 6202 --device sde --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 2 --ip 192.168.48.103 \\\n   --port 6202 --device sdf --weight 100\nswift-ring-builder account.builder rebalance\nswift-ring-builder account.builder\n##ç¬¬äºŒéƒ¨åˆ†ï¼ˆ6201ï¼‰åˆ›å»ºå®¹å™¨ç¯\nswift-ring-builder container.builder create 10 3 1\nswift-ring-builder container.builder add \\\n   --region 1 --zone 1 --ip 192.168.48.103 \\\n   --port 6201 --device sdc --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 1 --ip 192.168.48.103 \\\n   --port 6201 --device sdd --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 2 --ip 192.168.48.103 \\\n   --port 6201 --device sde --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 2 --ip 192.168.48.103 \\\n   --port 6201 --device sdf --weight 100\nswift-ring-builder container.builder\nswift-ring-builder container.builder rebalance\n\n##ç¬¬ä¸‰éƒ¨åˆ†ï¼ˆ6200ï¼‰åˆ›å»ºå¯¹è±¡ç¯\nswift-ring-builder object.builder create 10 3 1\nswift-ring-builder object.builder add \\\n   --region 1 --zone 1 --ip 192.168.48.103 \\\n   --port 6200 --device sdc --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 1 --ip 192.168.48.103 \\\n   --port 6200 --device sdd --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 2 --ip 192.168.48.103 \\\n   --port 6200 --device sde --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 2 --ip 192.168.48.103 \\\n   --port 6200 --device sdf --weight 100\nswift-ring-builder object.builder\nswift-ring-builder object.builder rebalance\n#å°†account.ring.gzï¼Œcontainer.ring.gzä»¥åŠ object.ring.gzæ–‡ä»¶å¤åˆ¶åˆ°æ¯ä¸ªå­˜å‚¨èŠ‚ç‚¹å’Œè¿è¡Œä»£ç†æœåŠ¡çš„ä»»ä½•å…¶ä»–èŠ‚ç‚¹ä¸Šçš„/etc/swiftç›®å½•ã€‚\nscp /etc/swift/account.ring.gz \\\n     /etc/swift/container.ring.gz \\\n     /etc/swift/object.ring.gz \\\n     192.168.48.103:/etc/swift\n\nmv  /etc/swift/swift.conf{,.bak}\ncat> /etc/swift/swift.conf<<EOF\n[swift-hash]\nswift_hash_path_suffix = swift\nswift_hash_path_prefix = swift\n[storage-policy:0]\nname = Policy-0\ndefault = yes\nEOF\n-------------------------------------------------------------------------------------\n#å°†æ§åˆ¶èŠ‚ç‚¹çš„swifté…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å­˜å‚¨èŠ‚ç‚¹ï¼ˆstorageï¼‰\nsshpass -p 'Lj201840.' scp /etc/swift/swift.conf 192.168.48.103:/etc/swift\n\n#swift_hash_path_suffixå’Œswift_hash_path_prefixä½œä¸ºå“ˆå¸Œç®—æ³•çš„ä¸€éƒ¨åˆ†ç”¨äºç¡®å®šæ•°æ®åœ¨é›†ç¾¤ä¸­çš„ä½ç½®ã€‚\n#è¿™äº›å€¼åº”è¯¥ä¿æŒæœºå¯†ï¼Œå¹¶ä¸”åœ¨éƒ¨ç½²é›†ç¾¤ä¹‹åä¸èƒ½æ›´æ”¹ä¸¢å¤±ã€‚å¯è‡ªå®šä¹‰\n-------------------------------------------------------------------------------------\n#åœ¨æ‰€æœ‰èŠ‚ç‚¹ç¡®ä¿å¯¹é…ç½®ç›®å½•æ‹¥æœ‰é€‚å½“çš„æ‰€æœ‰æƒï¼š\n####å­˜å‚¨èŠ‚ç‚¹ä¸æ§åˆ¶èŠ‚ç‚¹åŒæ—¶æ‰§è¡Œï¼ˆæ³¨æ„ï¼ï¼ï¼ï¼ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶æ‰§è¡Œï¼‰\n#æ“ä½œèŠ‚ç‚¹[controllerï¼Œstorage]\n\nchown -R root:swift /etc/swift \nyum install ansible -y\ncat << EOF >> /etc/ansible/hosts\n[storage]\n192.168.48.103 ansible_user=root\nEOF\nansible storage -m command -a \"chown -R root:swift /etc/swift\" -b --become-user root\n#åœ¨æ§åˆ¶å™¨èŠ‚ç‚¹å’Œä»»ä½•å…¶ä»–è¿è¡Œä»£ç†æœåŠ¡çš„èŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨å¯¹è±¡å­˜å‚¨ä»£ç†æœåŠ¡åŠå…¶ç›¸å…³æ€§ï¼Œå¹¶å°†å®ƒä»¬é…ç½®ä¸ºåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(å­˜å‚¨èŠ‚ç‚¹æ— ä»£ç†æœåŠ¡)\n#-------------------------------------------------------------------------------------\n#é‡å¯æœåŠ¡(æ“ä½œèŠ‚ç‚¹[controller]\nsystemctl enable openstack-swift-proxy.service memcached.service --now\nsystemctl restart openstack-swift-proxy.service memcached.service\n\n```\n\n```\nsh swift-controller-2.sh\n```\n\n### Storage\n\n```\ncd openstack-install\nvim swift-storage-2.sh\n```\n\n```ini\n#!/bin/bash\n#åœ¨å­˜å‚¨èŠ‚ç‚¹å¯åŠ¨æ‰€æœ‰æœåŠ¡\n systemctl enable openstack-swift-account.service openstack-swift-account-auditor.service \\\n  openstack-swift-account-reaper.service openstack-swift-account-replicator.service\n systemctl start openstack-swift-account.service openstack-swift-account-auditor.service \\\n  openstack-swift-account-reaper.service openstack-swift-account-replicator.service\n systemctl enable openstack-swift-container.service \\\n  openstack-swift-container-auditor.service openstack-swift-container-replicator.service \\\n  openstack-swift-container-updater.service\n systemctl start openstack-swift-container.service \\\n  openstack-swift-container-auditor.service openstack-swift-container-replicator.service \\\n  openstack-swift-container-updater.service\n systemctl enable openstack-swift-object.service openstack-swift-object-auditor.service \\\n  openstack-swift-object-replicator.service openstack-swift-object-updater.service\n systemctl start openstack-swift-object.service openstack-swift-object-auditor.service \\\n  openstack-swift-object-replicator.service openstack-swift-object-updater.service\nyum install ansible -y\ncat << EOF >> /etc/ansible/hosts\n[controller]\n192.168.48.101 ansible_user=root\nEOF\nansible controller -m command -a \"systemctl restart httpd memcached\" -b --become-user root\nansible controller -m command -a \"systemctl restart openstack-nova*\" -b --become-user root\n```\n\n```\nsh swift-storage-2.sh\n```\n\n### éªŒè¯\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\nsource /root/admin-openrc\ncd /etc/swift\nswift stat\n[root@controller swift]# swift stat\n               Account: AUTH_07a1ce96dca54f1bb0d3b968f1343617\n            Containers: 0\n               Objects: 0\n                 Bytes: 0\n       X-Put-Timestamp: 1684919814.32783\n           X-Timestamp: 1684919814.32783\n            X-Trans-Id: txd6f3affa0140455b935ff-00646dd605\n          Content-Type: text/plain; charset=utf-8\nX-Openstack-Request-Id: txd6f3affa0140455b935ff-00646dd605\n\n#æµ‹è¯•ä¸Šä¼ é•œåƒ\n[root@controller swift]# cd\n[root@controller ~]# swift upload demo /root/openstack-install/iso/cirros-0.4.0-x86_64-disk.img --object-name image\nimage\n```\n\n## Heat\n\nHeatæ˜¯ OpenStack è‡ªåŠ¨ç¼–æ’æœåŠ¡ï¼ŒåŸºäºæè¿°æ€§çš„æ¨¡æ¿æ¥ç¼–æ’å¤åˆäº‘åº”ç”¨ï¼Œä¹Ÿç§°ä¸º`Orchestration Service`ã€‚Heat çš„å„æœåŠ¡ä¸€èˆ¬å®‰è£…åœ¨`Controller`èŠ‚ç‚¹ä¸Šã€‚\n\næ“ä½œèŠ‚ç‚¹[controller]\n\n```\ncd openstack-install\nvim heat-controller.sh\n```\n\n```ini\n#ï¼/bin/bash\necho \"CREATE DATABASE heat;\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'localhost' IDENTIFIED BY 'HEAT_DBPASS';\" | mysql -u root -pMARIADB_PASS\necho \"GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'%' IDENTIFIED BY 'HEAT_DBPASS';\" | mysql -u root -pMARIADB_PASS\nmysql -u root -pMARIADB_PASS -e \"FLUSH PRIVILEGES;\"\nsource /root/admin-openrc\n#åˆ›å»ºheatç”¨æˆ·\nopenstack user create --domain default --password HEAT_PASS heat\n#æ·»åŠ  admin è§’è‰²åˆ° heat ç”¨æˆ·ä¸Š\nopenstack role add --project service --user heat admin\n##åˆ›å»ºheatå’Œ heat-cfn æœåŠ¡å®ä½“\nopenstack service create --name heat \\\n  --description \"Orchestration\" orchestration\nopenstack service create --name heat-cfn \\\n  --description \"Orchestration\"  cloudformation  \n##åˆ›å»º Orchestration æœåŠ¡çš„ API ç«¯ç‚¹\nopenstack endpoint create --region RegionOne \\\n  orchestration public http://controller:8004/v1/%\\(tenant_id\\)s\nopenstack endpoint create --region RegionOne \\\n  orchestration internal http://controller:8004/v1/%\\(tenant_id\\)s\nopenstack endpoint create --region RegionOne \\\n  orchestration admin http://controller:8004/v1/%\\(tenant_id\\)s\n\nopenstack endpoint create --region RegionOne \\\n  cloudformation public http://controller:8000/v1\nopenstack endpoint create --region RegionOne \\\n  cloudformation internal http://controller:8000/v1\nopenstack endpoint create --region RegionOne \\\n  cloudformation admin http://controller:8000/v1\n  #åˆ›å»ºstackç®¡ç†çš„é¢å¤–ä¿¡æ¯\n  #åˆ›å»º heat domain\n  #æ§åˆ¶èŠ‚ç‚¹\n#ä¸ºæ ˆåˆ›å»º heat åŒ…å«é¡¹ç›®å’Œç”¨æˆ·çš„åŸŸ\nopenstack domain create --description \"Stack projects and users\" heat\n\n#åœ¨ heat åŸŸä¸­åˆ›å»ºç®¡ç†é¡¹ç›®å’Œç”¨æˆ·çš„heat_domain_adminç”¨æˆ·ï¼š\nopenstack user create --domain heat --password=HEAT_DOMAIN_USER_PASS heat_domain_admin\n\n#)æ·»åŠ adminè§’è‰²åˆ° heat åŸŸ ä¸­çš„heat_domain_adminç”¨æˆ·ï¼Œå¯ç”¨heat_domain_adminç”¨æˆ·#ç®¡ç†æ ˆçš„ç®¡ç†æƒé™\nopenstack role add --domain heat --user-domain heat --user heat_domain_admin admin\n\n#ä¸ºæ ˆåˆ›å»º heat åŒ…å«é¡¹ç›®å’Œç”¨æˆ·çš„åŸŸ\nopenstack role create heat_stack_owner\n\n#æ·»åŠ heat_stack_owner è§’è‰²åˆ°demo é¡¹ç›®å’Œç”¨æˆ·ï¼Œå¯ç”¨demo ç”¨æˆ·ç®¡ç†æ ˆã€‚\nopenstack role add --project demo --user demo heat_stack_owner\n#å¿…é¡»æ·»åŠ  heat_stack_owner è§’è‰²åˆ°æ¯ä¸ªç®¡ç†æ ˆçš„ç”¨æˆ·ã€‚\n\n#heat_stack_user è§’è‰²\nopenstack role create heat_stack_user\ndnf install openstack-heat-api openstack-heat-api-cfn openstack-heat-engine -y\n\nmv /etc/heat/heat.conf{,.bak}\ncat > /etc/heat/heat.conf << EOF\n[database]\nconnection = mysql+pymysql://heat:HEAT_DBPASS@controller/heat  \n#HEAT_DBPASSæ˜¯HEATæ•°æ®åº“å¯†ç \n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller\nheat_metadata_server_url = http://controller:8000\nheat_waitcondition_server_url = http://controller:8000/v1/waitcondition\nstack_domain_admin = heat_domain_admin\nstack_domain_admin_password = HEAT_DOMAIN_PASS\nstack_user_domain_name = heat\n#RABBIT_PASSä¸ºRabbitmqæœåŠ¡å¯†ç  ç”¨æˆ·åæ˜¯openstack\n[keystone_authtoken]\nwww_authenticate_uri = http://controller:5000\nauth_url = http://controller:5000\nmemcached_servers = controller:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = heat\npassword = HEAT_PASS\n#HEAT_PASSæ˜¯heatç”¨æˆ·å¯†ç \n[trustee]\nauth_type = password\nauth_url = http://controller:5000\nusername = heat\npassword = HEAT_PASS\n#HEAT_PASSæ˜¯heatç”¨æˆ·å¯†ç \nuser_domain_name = default\n[clients_keystone]\nauth_uri = http://controller:5000\nEOF\n\nsu -s /bin/sh -c \"heat-manage db_sync\" heat\n##å¯åŠ¨ Orchestration ç¼–æ’æœåŠ¡heatç»„ä»¶å¹¶å°†å…¶è®¾ç½®ä¸ºéšç³»ç»Ÿå¯åŠ¨\nsystemctl enable openstack-heat-api.service \\\n  openstack-heat-api-cfn.service openstack-heat-engine.service --now\n\nsystemctl restart openstack-heat-api.service \\\n  openstack-heat-api-cfn.service openstack-heat-engine.service\nsystemctl restart httpd memcached\n```\n\n```\nsh heat-controller.sh\n```\n\néªŒè¯\n\n```bash\nsource /root/admin-openrc\nsystemctl list-unit-files |grep openstack-heat*\nopenstack service list\nopenstack orchestration service list\n#è¯¥è¾“å‡ºæ˜¾ç¤ºè¡¨æ˜åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šæœ‰åº”è¯¥å››ä¸ªheat-engineç»„ä»¶ã€‚è¯¥è¾“å‡ºæ˜¾ç¤ºè¡¨æ˜åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šæœ‰åº”è¯¥å››ä¸ªheat-engineç»„ä»¶ã€‚\n```\n\n![image-20241209213416843](https://i0.hdslb.com/bfs/article/9514b588eb3d45443e2c00ad67ef4be8697559838.png)\n\n## åˆ›å»ºå®ä¾‹\n\n### åˆ›å»ºå®ä¾‹ç±»å‹\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»è®¡ç®—ï¼Œç‚¹å‡»å®ä¾‹ç±»å‹ï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºå®ä¾‹ç±»å‹ã€‚\n\n![image-20240106230035149](https://i0.hdslb.com/bfs/article/31a02695e61aa72b806624303faa117f697559838.png)\n\næ ¹æ®ä»¥ä¸Šå›¾ç‰‡æ­¥éª¤ä¾æ¬¡å¡«å…¥ï¼šå®ä¾‹åç§°ã€VCPUæ•°é‡ã€å†…å­˜å¤§å°ã€æ ¹ç£ç›˜å¤§å°ï¼Œç¡®è®¤æ— è¯¯åç‚¹å‡»åˆ›å»ºå®ä¾‹ç±»å‹ã€‚\n\n### åˆ›å»ºé•œåƒ\n\næµ‹è¯•é•œåƒï¼šhttps://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img\n\n<font color='red'>æœ‰ä¸¤ç§ä¸Šä¼ æ–¹å¼ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼ï¼ï¼</font>\n\n<font color='red'>1.Windowsä¸Šä¼ é•œåƒæ–¹å¼</font>\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»è®¡ç®—ï¼Œç‚¹å‡»é•œåƒï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºé•œåƒã€‚\n\nWindowsä¸‹è½½åˆ°æœ¬åœ°å³å¯\n\n![image-20240106230649633](https://i0.hdslb.com/bfs/article/f7578d6c654e573a00ad4205cc93ad90697559838.png)\n\næ ¹æ®ä»¥ä¸Šå›¾ç‰‡æ­¥éª¤ä¾æ¬¡å¡«å…¥ï¼šé•œåƒåç§°ã€é€‰æ‹©æ–‡ä»¶ã€é•œåƒæ ¼å¼ï¼Œç¡®è®¤æ— è¯¯åç‚¹å‡»åˆ›å»ºé•œåƒã€‚\n**æ³¨**ï¼šæ¼”ç¤ºä¸Šä¼ çš„ img é•œåƒæ ¼å¼éœ€é€‰ç”¨ QCOW2 - QEMUæ¨¡æ‹Ÿå™¨ æ‰å¯æ­£å¸¸åŠ è½½ã€‚\n\n\n\n<font color='red'>2.Linuxä¸Šä¼ é•œåƒæ–¹å¼</font>\n\n```\nsource admin-openrc\nwget https://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img\n#å¯èƒ½ä¼šä¸‹è½½ä¸åˆ°ï¼Œå¯ä»¥å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨ä¸‹è½½ï¼Œç„¶åç§»åˆ°/root/ç›®å½•ä¸‹\nglance image-create --name \"cirros\" \\\n  --file cirros-0.6.2-x86_64-disk.img \\\n  --disk-format qcow2 --container-format bare \\\n  --visibility=public\n\nopenstack image list\n\n[root@controller-1 ~]# openstack image list\n+--------------------------------------+--------+--------+\n| ID                                   | Name   | Status |\n+--------------------------------------+--------+--------+\n| 627761da-7f8c-4780-842a-e50e62f5c464 | cirros | active |\n+--------------------------------------+--------+--------+\n\n```\n\n### åˆ›å»ºå†…éƒ¨ç½‘ç»œ\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºç½‘ç»œã€‚\n\n![image-20240106231124036](https://i0.hdslb.com/bfs/article/da09616a700395a6a6b0a877b21881a8697559838.png)\n\n![image-20240106231151367](https://i0.hdslb.com/bfs/article/346ecd635cac54617bca36b5094b51f1697559838.png)\n\n![image-20240106231323081](https://i0.hdslb.com/bfs/article/deaf52e986c04953e5f8a7d5a22ce293697559838.png)\n\n### åˆ›å»ºå¤–éƒ¨ç½‘ç»œ\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºç½‘ç»œã€‚\n\n<font color='red'>å¦‚æœä½ æ˜¯æŒ‰ç…§æœ¬æ–‡æ¡£æ­å»ºçš„ï¼Œå°±å¡«provider</font>\n\n![image-20240106231633793](https://i0.hdslb.com/bfs/article/caf436ffce78df4fa7a353c5acd0fd5a697559838.png)\n\n![image-20240106231854446](https://i0.hdslb.com/bfs/article/0f81a174f4be20a69836af42df878d6a697559838.png)\n\n![image-20240106232011057](https://i0.hdslb.com/bfs/article/3a29278808500fb7c038b2e24e3dc6a1697559838.png)\n\n### åˆ›å»ºè·¯ç”±\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»è·¯ç”±ï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºè·¯ç”±ã€‚\n\n![image-20240106232138022](https://i0.hdslb.com/bfs/article/c5558e4990fef2d297f7c07ff6f51b23697559838.png)\n\n\n\n![image-20240106232201129](https://i0.hdslb.com/bfs/article/f93314ea12af0e1102e58d94ffbb9a05697559838.png)\n\n![image-20240106232242376](https://i0.hdslb.com/bfs/article/11f7bdd637060c4a48d01388782f508f697559838.png)\n\n### æ·»åŠ å®‰å…¨ç»„è§„åˆ™\n\n![image-20240106232342515](https://i0.hdslb.com/bfs/article/16c7efc7747cd2934ae9ec777de4662e697559838.png)\n\n![image-20240106232725982](https://i0.hdslb.com/bfs/article/ded540227dcbc19e9f05c82c68984be9697559838.png)\n\næœ€åæ•ˆæœé•¿è¿™æ ·\n\n![image-20240106232758711](https://i0.hdslb.com/bfs/article/cf4db72bfde7068dfb912d6470b70148697559838.png)\n\n### åˆ›å»ºå®ä¾‹\n\n![image-20240106232939110](https://i0.hdslb.com/bfs/article/c3a1fab81557f5fa7a121a9098b1b3fa697559838.png)\n\n![image-20240106233038731](https://i0.hdslb.com/bfs/article/fb99edf0005108a2cbc1071f583039d9697559838.png)\n\n![image-20240106233101509](https://i0.hdslb.com/bfs/article/ecdcc6fd8b07e6fcf2b6fa84ade65f33697559838.png)\n\n![image-20240106233129659](https://i0.hdslb.com/bfs/article/3be68c8a12b638ba19d720e8e8549712697559838.png)\n\nç„¶åç‚¹å‡»åˆ›å»ºå®ä¾‹\n\nåˆ†é…æµ®åŠ¨ip\n\n![image-20240106233251169](https://i0.hdslb.com/bfs/article/7e2458b0235855e76d263700ed3b2dc8697559838.png)\n\n![image-20240106233418787](https://i0.hdslb.com/bfs/article/6b4d2468dd370387a38a85e513577cdd697559838.png)\n\n<font color='red'>ç»“è®ºï¼šåˆ›å»ºå®ä¾‹æˆåŠŸ</font>\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["OpenEuler","OpenStack"],"categories":["äº‘åŸç”Ÿ"]},{"title":"Nginxå…¥é—¨ç¬”è®°","url":"/posts/c0d89ad/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Nginxå…¥é—¨ç¬”è®°\n\n## Nginxä»‹ç»\n\nNginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPã€åå‘ä»£ç†æœåŠ¡å™¨\n\nä¸»è¦åŠŸèƒ½ï¼š\n\n- åå‘ä»£ç†\n- å®ç°é›†ç¾¤å’Œè´Ÿè½½å‡è¡¡\n- é™æ€èµ„æºè™šæ‹ŸåŒ–\n\nNginxçš„ç‰ˆæœ¬ï¼š\n\n- Nginxå¼€æºç‰ˆ http://nginx.org/en/\n\n  å®˜æ–¹åŸå§‹çš„Nginxç‰ˆæœ¬\n\n- Nginx pluså•†ä¸šç‰ˆ\n\n  å¼€ç®±å³ç”¨ï¼Œé›†æˆäº†å¤§é‡åŠŸèƒ½\n\n- Open Resty https://openresty.org/cn/\n\n  OpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚**æ›´é€‚ç”¨äºéœ€è¦å¤§é‡äºŒæ¬¡å¼€å‘çš„åœºæ™¯ï¼Œæœ‰æå¼ºçš„æ‰©å±•æ€§**\n\n- Tengine https://tengine.taobao.org/\n\n  ç”±æ·˜å®ç½‘å‘èµ·çš„WebæœåŠ¡å™¨é¡¹ç›®ã€‚å®ƒåœ¨[Nginx](../img/http://nginx.org/)çš„åŸºç¡€ä¸Šï¼Œé’ˆå¯¹å¤§è®¿é—®é‡ç½‘ç«™çš„éœ€æ±‚ï¼Œæ·»åŠ äº†å¾ˆå¤šé«˜çº§åŠŸèƒ½å’Œç‰¹æ€§ã€‚Tengineçš„æ€§èƒ½å’Œç¨³å®šæ€§å·²ç»åœ¨å¤§å‹çš„ç½‘ç«™å¦‚[æ·˜å®ç½‘](../img/http://www.taobao.com/)ï¼Œ[å¤©çŒ«å•†åŸ](../img/http://www.tmall.com/)ç­‰å¾—åˆ°äº†å¾ˆå¥½çš„æ£€éªŒã€‚ç›¸æ¯”äºOpen Restyï¼Œæ‰©å±•æ€§ä¸å¤Ÿå¼ºï¼Œä½†æ˜¯èƒ½å¤Ÿæ»¡è¶³ç»å¤šæ•°ä½¿ç”¨åœºæ™¯\n\n## ä»€ä¹ˆæ˜¯ä»£ç†\n\næ­£å‘ä»£ç†\n\næ­£å‘ä»£ç†å¯ä»¥ç†è§£ä¸ºã€Œå®¢æˆ·ç«¯ã€çš„ä»£ç†\n\n![image-20241123005914731](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/c116df24e7f9f8c6918c5ebec8502f41697559838.png)\n\n**åå‘ä»£ç†**\n\nåå‘ä»£ç†å¯ä»¥ç†è§£ä¸ºã€ŒæœåŠ¡å™¨ã€çš„ä»£ç†\n\n![image-20241123010005591](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/899292a6b0aa16ad51cbd09b4baf69ef697559838.png)\n\n## Nginxå®‰è£…\n\nä»¥ä¸‹æœ‰ä¸¤ç§æ–¹å¼ï¼ŒæŒ‰éœ€é€‰æ‹©ï¼Œç¼–è¯‘ä¼šæ…¢ä¸€ç‚¹ï¼Œä½†æ˜¯å¯ä»¥ç¦»çº¿å®‰è£…ï¼Œä¸éœ€è¦ä»ç½‘ç»œä¸‹è½½æ‰€éœ€çš„åŒ…ï¼ŒRpmå®‰è£…å…¨éƒ¨å®‰è£…éƒ½éœ€è¦ç½‘ç»œã€‚ä¸¤ä¸ªéƒ½å·®ä¸å¤š<font color='red'>ï¼ˆæˆ‘æ¥ä¸‹æ¥æµ‹è¯•å…¨éƒ¨ç”¨ç¼–è¯‘å®‰è£…ï¼‰</font>\n\n### ç¼–è¯‘å®‰è£…\n\nä¸é™åˆ¶;Linuxç³»ç»Ÿ\n\nè¿™é‡Œæˆ‘å°±ç”¨<font color='red'>OpenEuler22.03LTS</font>åšæ¼”ç¤ºï¼Œå‘½ä»¤éƒ½å’ŒCentOSå·®ä¸å¤šï¼Œä¸åšè¿‡å¤šè§£é‡Š\n\n1.å®‰è£…å¿…è¦å·¥å…·\n\n```bash\nyum install -y tar gcc make pcre pcre-devel zlib zlib-devel openssl openssl-devel\n```\n\n2.ä¸‹è½½æºç åŒ…\n\nå®˜ç½‘ï¼š[nginx: download](https://nginx.org/en/download.html)\n\n![image-20241122231106092](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/580cb024ffb5db3c1f204000c89c9ce8697559838.png)\n\nä½ å¯ä»¥å³é”®å¤åˆ¶é“¾æ¥åœ¨è™šæ‹Ÿæœºä¸‹è½½\n\n```\nwget https://nginx.org/download/nginx-1.26.2.tar.gz\n```\n\nä¹Ÿå¯ä»¥ç›´æ¥ç‚¹å‡»çº¢è‰²æ¡†æ¡†çš„ä¸‹è½½ä¸‹æ¥ç„¶åä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼ˆrootç”¨æˆ·ä¸€èˆ¬éƒ½ä¸Šä¼ åˆ°/rootï¼‰å»\n\n![image-20241122231808602](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/7869f6ff8b1d460f71f41fbf4b85f131697559838.png)\n\n3.åˆ›å»ºnginxå®‰è£…ç›®å½•å¹¶è§£å‹å®‰è£…åŒ…\n\n```bash\nmkdir -p /etc/nginx/\n#è§£å‹å¹¶ç§»åŠ¨åˆ°/app/nginx\ntar -zxf nginx-1.26.2.tar.gz\n#è¿›å…¥å®‰è£…ç›®å½•\ncd nginx-1.26.2\n# é…ç½®nginxå®‰è£…è·¯å¾„\n./configure --prefix=/etc/nginx/\n# ç¼–è¯‘&&å®‰è£…\nmake && make install\n```\n\n4.è®¾ç½®å®ˆæŠ¤è¿›ç¨‹å®ç°è‡ªå¯åŠ¨\n\n```bash\ncat > /etc/systemd/system/nginx.service <<\"EOF\"\n[Unit]\nDescription=nginx\nAfter=network.target remote-fs.target nss-ookup.target\n\n[Service]\nType=forking\nPIDFile=/etc/nginx/logs/nginx.pid\nExecStartPre=/etc/nginx/sbin/nginx -t -c /etc/nginx/conf/nginx.conf\nExecStart=/etc/nginx/sbin/nginx -c /etc/nginx/conf/nginx.conf\nExecReload=/etc/nginx/sbin/nginx -s reload\nExecStop=/etc/nginx/sbin/nginx -s stop\nExecQuit=/etc/nginx/sbin/nginx -s quit\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\nEOF\n# é‡è½½é…ç½®\nsystemctl daemon-reload\n# åŠ å…¥è‡ªå¯\nsystemctl enable nginx\n# å¯åŠ¨nginx\nsystemctl start nginx\n\n\n#å°†nginxå¯æ‰§è¡Œæ–‡ä»¶æ·»åŠ åˆ°$PATHï¼Œè¿™æ ·æ‰èƒ½å…¨å±€ä½¿ç”¨nginxå‘½ä»¤\ncat >> /etc/profile << \"EOF\"\nexport PATH=$PATH:/etc/nginx/sbin\nEOF\nsource /etc/profile\n```\n\n5.è®¿é—®æµ‹è¯•é¡µ\n\nè®¿é—®ä½ è™šæ‹Ÿæœºçš„ipå°±è¡Œ\n\n![image-20241123000006823](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/87529991daa95c5b5e5a4261e7ffd235697559838.png)\n\n\n\nåˆ°è¿™ç¼–è¯‘ç‰ˆnginxå®‰è£…æˆåŠŸ\n\næ™®åŠä¸€ä¸‹nginxå‘½ä»¤ï¼š\n\n`systemctl start nginx` å¯åŠ¨nginx\n\n`nginx -s reload` é‡è½½nginx\n\n### RPMå®‰è£…\n\næœ‰ä¸¤ä¸ªç³»ç»Ÿçš„æ•™ç¨‹ï¼Œæˆ‘ä¸‹é¢æœ‰æ ‡æ³¨\n\nå®˜ç½‘æ–‡æ¡£ï¼š[nginx: Linux packages](https://nginx.org/en/linux_packages.html)\n\n![image-20241123000502440](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/a42764bd1d0c8bcecd5ab7c714610307697559838.png)\n\n`Centos7æˆ–Centos8`\n\n```bash\nyum install yum-utils -y\n#æ·»åŠ nginxæº\ncat >/etc/yum.repos.d/nginx.repo << \"EOF\"\n[nginx-stable]\nname=nginx stable repo\nbaseurl=http://nginx.org/packages/centos/$releasever/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n\n[nginx-mainline]\nname=nginx mainline repo\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\nEOF\nyum install nginx -y\nsystemctl enable nginx --now\n```\n\n\n\n`OpenEulerç³»ç»Ÿ`\n\nå› ä¸ºæ²¡æœ‰é€‚é…openeulerçš„ç‰ˆæœ¬ï¼Œè¿™é‡Œç›´æ¥ç”¨centos8çš„æ¥ä»£æ›¿ï¼Œå…¼å®¹çš„æ²¡å…³ç³»ï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿå»è‡ªè¡Œæ›¿æ¢\n\nåŸæœ¬æ˜¯\\$releaseverçš„ï¼Œä½†æ˜¯æ²¡æœ‰`openeuler`çš„ç‰ˆæœ¬ç›´æ¥ç”¨8æ¥ä»£æ›¿ä¹Ÿå°±æ˜¯centos8ï¼Œ`openeulerå…¼å®¹centos`\n\n```bash\ncat >/etc/yum.repos.d/nginx.repo << \"EOF\"\n[nginx-stable]\nname=nginx stable repo\n#baseurl=http://nginx.org/packages/centos/$releasever/$basearch/\nbaseurl=http://nginx.org/packages/centos/8/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n[nginx-mainline]\nname=nginx mainline repo\n#baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\nbaseurl=http://nginx.org/packages/mainline/centos/8/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\nEOF\nyum install nginx -y\nsystemctl enable nginx --now\n```\n\nè®¿é—®æµ‹è¯•é¡µ\n\nè®¿é—®ä½ è™šæ‹Ÿæœºçš„ipå°±è¡Œ\n\n![image-20241123000006823](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/87529991daa95c5b5e5a4261e7ffd235697559838.png)\n\n### å…³é—­é˜²ç«å¢™\n\n```\nsystemctl disable firewalld &> /dev/null\nsystemctl stop firewalld\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n#é‡å¯æœåŠ¡å™¨\nreboot\n```\n\n## Nginxç›®å½•\n\n![image-20241123010256150](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/47f2615f3de2a93e9c9b5109fde01e77697559838.png)\n\n```\nconf #é…ç½®æ–‡ä»¶\n\tï½œ-nginx.conf # ä¸»é…ç½®æ–‡ä»¶\n\tï½œ-å…¶ä»–é…ç½®æ–‡ä»¶ # å¯é€šè¿‡é‚£ä¸ªincludeå…³é”®å­—ï¼Œå¼•å…¥åˆ°äº†nginx.confç”Ÿæ•ˆ\n\t\nhtml #é™æ€é¡µé¢\n\nlogsï¼ˆé»˜è®¤ä¸æ˜¯æ”¾åœ¨è¿™é‡Œï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ä¸ºè¿™é‡Œï¼‰\n\tï½œ-access.log #è®¿é—®æ—¥å¿—(æ¯æ¬¡è®¿é—®éƒ½ä¼šè®°å½•)\n\tï½œ-error.log #é”™è¯¯æ—¥å¿—\n\tï½œ-nginx.pid #è¿›ç¨‹å·\n\t\nsbin\n\tï½œ-nginx #ä¸»è¿›ç¨‹æ–‡ä»¶\n\t\n*_temp #è¿è¡Œæ—¶ï¼Œç”Ÿæˆä¸´æ—¶æ–‡ä»¶\n```\n\n## Nginxè¿›ç¨‹æ¨¡å‹\n\nä¸€ä¸ªMasterï¼šç›‘å¬è¯·æ±‚ï¼Œå¹¶åˆ†é…workerè¿›ç¨‹å¤„ç†\n\né»˜è®¤ä¸€ä¸ªworkerè¿›ç¨‹ï¼ˆå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹workeræ•°é‡ï¼‰ï¼šå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚\n\n![image-20241123010359608](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/2eba1a00c5ff87d3be9fd32dc200ae69697559838.png)\n\næ¯ä¸ªworkerä¹‹é—´å½¼æ­¤ç‹¬ç«‹ï¼Œæ¯ä¸€ä¸ªworkerå¤„ç†å¤šä¸ªè¯·æ±‚\n\n![image-20241123010441249](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/5f12722e2bf72c4351938dca90f8db9a697559838.png)\n\n## Nginxé…ç½®æ–‡ä»¶\n\n[Nginxé…ç½®ç”Ÿæˆå·¥å…·](https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhCN)\n\n### nginx.confé»˜è®¤é…ç½®æ–‡ä»¶\n\nè¿™æ˜¯nginxé»˜è®¤çš„é…ç½®æ–‡ä»¶\n\nå±•ç¤ºéƒ¨åˆ†æ ¸å¿ƒé…ç½®ï¼Œåç»­æ›´å¤šé…ç½®ä¼šåœ¨åé¢è¿›è¡Œæ…¢æ…¢å‡å\n\n```bash\n[root@localtion ~]# vim /etc/nginx/conf/nginx.conf\n# Nginx ä¸»é…ç½®æ–‡ä»¶\n# masterè¿›ç¨‹ä¼šå¯åŠ¨workerè¿›ç¨‹ï¼Œè¯¥é€‰é¡¹è®¾ç½®åœ¨ç³»ç»Ÿä¸­æ˜¾ç¤ºå¯åŠ¨è¯¥è¿›ç¨‹çš„ç”¨æˆ·åï¼ˆä¸€èˆ¬ä¸æ”¹åŠ¨ï¼Œé»˜è®¤nobodyï¼‰\n# user nobody\n# è®¾ç½®å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œé€šå¸¸è®¾ç½®ä¸ºè‡ªåŠ¨æˆ–ä¸CPUæ ¸å¿ƒæ•°ç›¸åŒ\nworker_processes  1;     #é»˜è®¤ä¸º1ï¼Œè¡¨ç¤ºå¼€å¯ä¸€ä¸ªä¸šåŠ¡è¿›ç¨‹\n\n# é”™è¯¯æ—¥å¿—æ”¾ç½®çš„è·¯å¾„ noticeã€infoæ˜¯é”™è¯¯æ—¥å¿—çš„çº§åˆ«ï¼Œæ¯”å¦‚ï¼šinfoå°±æ˜¯æ—¥å¿—çº§åˆ«å¤§äºinfoæ‰ç”Ÿæˆæ—¥å¿—\n# é»˜è®¤åœ°å€ä¸º/var/log/nginx/error.log ï¼Œå¯é€šè¿‡nginx -Vè¿”å›çš„--eror-log-pathå­—æ®µè·å–å®é™…å€¼\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n# pidæ–‡ä»¶å­˜æ”¾è·¯å¾„,é»˜è®¤ï¼š/var/run/nginx/nginx.pidï¼Œå¯é€šè¿‡nginx -Vè¿”å›çš„--pid-pathå­—æ®µè·å–å®é™…å€¼\n#pid        logs/nginx.pid;\n\n# äº‹ä»¶é©±åŠ¨æ¨¡å—é…ç½®\nevents {\n    # æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°\n    worker_connections  1024;   # å•ä¸ªä¸šåŠ¡è¿›ç¨‹å¯æ¥å—è¿æ¥æ•°\n}\n\n# HTTP æ¨¡å—é…ç½®\nhttp {\n    # å¼•å…¥ mime.types æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰æ–‡ä»¶æ‰©å±•åä¸MIMEç±»å‹çš„æ˜ å°„å…³ç³»\n    include       mime.types;  \n    # é»˜è®¤MIMEç±»å‹ï¼Œå½“è¯·æ±‚çš„æ–‡ä»¶ç±»å‹ä¸åœ¨mime.typesä¸­å®šä¹‰æ—¶ä½¿ç”¨\n    default_type  application/octet-stream;\n    \n     # è®¿é—®æ—¥å¿—æ ¼å¼\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    # è®¿é—®æ—¥å¿—åœ°å€ï¼Œé»˜è®¤ï¼š/var/log/nginx/access.logï¼Œå¯é€šè¿‡nginx -Vè¿”å›çš„--http-log-pathå­—æ®µè·å–å®é™…å€¼\n    #access_log  logs/access.log  main;\n\n    \n    # æ˜¯å¦å¼€å¯sendfileä¼ è¾“æ–‡ä»¶ï¼Œå¼€å¯å¯ä»¥æé«˜æ•ˆç‡\n    sendfile        on;   \n    # è¿æ¥è¶…æ—¶æ—¶é—´\n    keepalive_timeout  65;\n\n    # æœåŠ¡å™¨æ¨¡å—é…ç½®\n    server {\n        # ç›‘å¬80ç«¯å£\n        listen       80;\n        # æœåŠ¡å™¨åç§°\n        server_name  localhost;  #å¯ä»¥è®¾ç½®ä¸»æœºåå’ŒåŸŸå\n        # æ ¹ç›®å½•é…ç½®\n        location / {\n            root   html; # è®¾ç½®ç½‘ç«™æ ¹ç›®å½•\n            index  index.html index.htm; # é»˜è®¤é¦–é¡µæ–‡ä»¶\n        }\n        # é”™è¯¯é¡µé¢é…ç½®\n        error_page   500 502 503 504  /50x.html;\n        # å®šä¹‰50x.htmlé”™è¯¯é¡µé¢çš„ä½ç½®\n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n```\n\nåˆšåˆšè®¿é—®å®‰è£…æˆåŠŸåçš„æµ‹è¯•é¡µ\n\næµ‹è¯•æœ‰çš„indexæ–‡ä»¶åœ¨/etc/nginx/html/index.html\n\nä¸€èˆ¬æ‰€æœ‰çš„ç½‘é¡µçš„æ–‡ä»¶éƒ½æ”¾åœ¨nginxå®‰è£…ç›®å½•ä¸‹çš„htmlä¸‹\n\nè¿™é‡Œnginxçš„æ ¹ç›®å½•`/`ï¼Œç›‘å¬çš„ç«¯å£æ˜¯80\n\n> ```bash\n>     location / {\n>         root   html; # è®¾ç½®ç½‘ç«™æ ¹ç›®å½•\n>         index  index.html index.htm; # é»˜è®¤é¦–é¡µæ–‡ä»¶\n>     } # æ ¹ç›®å½•é…ç½®\n>         location / {\n>             root   html; # è®¾ç½®ç½‘ç«™æ ¹ç›®å½•\n>             index  index.html index.htm; # é»˜è®¤é¦–é¡µæ–‡ä»¶\n>         }\n> ```\n\næ¯æ¬¡ä¿®æ”¹é…ç½®æ–‡ä»¶è¦é‡è½½é…ç½®\n\n```\nnginx -s reload\n```\n\n### sendfileé…ç½®\n\nåœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ï¼Œå¯ç”¨Nginxçš„sendfileåŠŸèƒ½å¯ä»¥å‡å°‘CPUå’Œå†…å­˜çš„ä½¿ç”¨ï¼Œæé«˜æœåŠ¡å™¨æ€§èƒ½ï¼Œå› ä¸ºå®ƒå…è®¸æ•°æ®ç›´æ¥ä»ç£ç›˜ä¼ è¾“åˆ°ç½‘ç»œï¼Œæ— éœ€å…ˆåŠ è½½åˆ°Nginxçš„å†…å­˜ä¸­ã€‚è¿™ä¸ä»…é™ä½äº†CPUä½¿ç”¨ç‡ï¼Œè¿˜å‡å°‘äº†å†…å­˜å ç”¨ï¼Œä»è€Œæé«˜äº†I/Oæ•ˆç‡å’ŒæœåŠ¡å™¨çš„ååé‡ï¼Œå¹¶ä¸”é™ä½äº†å“åº”å»¶è¿Ÿã€‚\n\n```\nhttp{\n\tsendfile:on # off\n}\n\n# æˆ–è€…æŒ‡å®šæŸä¸ªserverå¼€å¯\nserver {\n    location / {\n        sendfile on;\n        ...\n    }\n}\n```\n\n![image-20241123015101492](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/c05595dddd92c8f886d7edb1a86a1459697559838.png)\n\n### gzipé…ç½®\n\n```yaml\nhttp{\n   gzip on; # å¼€å¯å‹ç¼©ï¼Œå‹ç¼©åå‘é€ç»™å®¢æˆ·ç«¯\n\tgzip_min_length 1;# è®¾ç½®æœ€å°å‹ç¼©ä¸‹é™ã€‚1å°±æ˜¯å°äº1å­—èŠ‚çš„æ–‡ä»¶ä¸å‹ç¼©\n\tgzip_comp_level 3 # å‹ç¼©çº§åˆ«0-9ï¼Œå€¼è¶Šå¤§æ–‡ä»¶å°±å‹ç¼©çš„è¶Šå°ï¼Œç›¸åº”çš„ä¼šæŸè€—æ›´å¤šæ€§èƒ½\n\tgzip_type text/plain application/javascript image/* # æŒ‡å®šå“ªäº› MIME ç±»å‹ï¼Œå¼€å¯å‹ç¼©ï¼ˆä¸å†™é»˜è®¤å…¨éƒ¨ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ image/* å°±æ˜¯æ‰€æœ‰å›¾ç‰‡ã€‚å…·ä½“å“ªäº›ç±»å‹å¯ä»¥çœ‹conf/mime.typesæ–‡ä»¶\n}\n```\n\nnginx ä¸­çš„ gzip å‹ç¼©åˆ†ä¸ºåŠ¨æ€å‹ç¼©ã€é™æ€å‹ç¼©\n\n- åŠ¨æ€å‹ç¼©ï¼šæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯è¿”å›å“åº”æ—¶ï¼Œæ¶ˆè€—è‡ªèº«çš„èµ„æºè¿›è¡Œå®æ—¶å‹ç¼©ï¼Œä¿è¯å®¢æˆ·ç«¯æ‹¿åˆ° gzip æ ¼å¼çš„æ–‡ä»¶\n\n  gzip onå¼€å¯çš„å°±æ˜¯åŠ¨æ€å‹ç¼©ï¼Œgzip_comp_levelè®¾ç½®çš„çº§åˆ«é«˜ï¼Œå¯èƒ½ä¼šé€ æˆCPUå ç”¨è¿‡é«˜ï¼ˆæ–‡ç« ï¼š[ç®€å•ä¸€æ‹›ç«ŸæŠŠnginxæœåŠ¡å™¨æ€§èƒ½æå‡50å€](https://www.toutiao.com/article/7329343713828897280/?app=news_article&timestamp=1707783801&use_new_style=1&req_id=202402130823202F9A6100389685E57A11&group_id=7329343713828897280&share_token=F2E89DA7-CC1F-4AAC-9BCC-A82B8020A9D6&tt_from=weixin&utm_source=weixin&utm_medium=toutiao_ios&utm_campaign=client_share&wxshare_count=1&source=m_redirect)ï¼‰\n\n- é™æ€å‹ç¼©ï¼šç›´æ¥å°†é¢„å…ˆå‹ç¼©è¿‡çš„ .gz æ–‡ä»¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¸å†å®æ—¶å‹ç¼©æ–‡ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ° .gz æ–‡ä»¶ï¼Œä¼šä½¿ç”¨å¯¹åº”çš„åŸå§‹æ–‡ä»¶\n\n  è¯¥åŠŸèƒ½éœ€è¦æ¨¡å—ï¼š `ngx_http_gzip_static_module`ï¼ˆé»˜è®¤ä¸ä¼šè¢«æ„å»ºï¼‰\n\n  æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼Œå½“å‰å®‰è£…çš„æ˜¯å¦åŒ…å«è¯¥æ¨¡å—\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼Œå½“å‰å®‰è£…çš„æ˜¯å¦åŒ…å«è¯¥æ¨¡å—\n\n```\nnginx -V\n```\n\n![image-20241123155117730](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/8ef963f00a9b45cfe1d7c4630613f286697559838.png)\n\nå¦‚è‹¥æ²¡æœ‰ï¼Œåˆ™è¦é‡æ–°ç¼–è¯‘ï¼š\n\n```bash\ncd nginx-1.26.2/\n./configure --prefix=/etc/nginx --with-http_gzip_static_module\n# æŒ‡å®šç¼–è¯‘é…ç½®ï¼Œè¿™ä¸ªå‚æ•°å®‰è£…æ¨¡å—`ngx_http_gzip_static_module` ä¸€å®šè¦æŒ‡å®šä½ çš„å®‰è£…ç›®å½•\nmake \n# ç¼–è¯‘\nmake install \n# å®‰è£…\n```\n\nå¯ç”¨ä»¥ä¸‹é…ç½®\n\n```\nhttp {\n    gzip  on;\n}\n```\n\nè®°å¾—é‡è½½é…ç½®\n\n```\nnginx -s reload\n```\n\n### Serveré…ç½®\n\nè™šæ‹Ÿä¸»æœºé…ç½®ï¼ˆå¯ä»¥å¯ç”¨å¤šä¸ªï¼‰ï¼Œå¤šä¸ªserverå­—æ®µï¼Œä¼šæ ¹æ®è¯·æ±‚çš„åŸŸå+ç«¯å£ä»å‰å‘ååŒ¹é…\n\nä»¥ä¸‹æ˜¯ä¾‹å­ï¼š\n\nå¦‚æœæ˜¯å…¬ç½‘ï¼šqianyios.topè¿™ä¸ªåŸŸåè¦è§£æåˆ°è¿™ä¸ªè¿™ä¸ªæœåŠ¡å™¨çš„å…¬ç½‘ip\n\nå¦‚æœæ˜¯å†…ç½‘ï¼šè¿™ä¸ªåŸŸåè¦åœ¨æœ¬æœºè¿›è¡ŒhostsåŒ¹é…æ˜ å°„`ip qianyios.top`\n\n```bash\nhttp {\n......\n    # è™šæ‹Ÿä¸»æœº(ç›¸å½“äºä¸€æ ·ç«™ç‚¹)\n    server {\n        # ç›‘å¬80ç«¯å£\n        listen       80;\n        # æœåŠ¡å™¨åç§°\n        #server_name  *.qianyios.top; å½“ä½ é…ç½®äº†é€šé…ç¬¦åŸŸåï¼Œå°±æ˜¯ä¸ç®¡ä½ æ˜¯www.qianyios.topè¿˜æ˜¯xxx.qianyios.top,ç­‰å„ç§å‰ç¼€éƒ½èƒ½è®¿é—®åˆ°è¿™é‡Œ\n        \n        server_name  qianyios.top;  #å¯ä»¥è®¾ç½®ä¸»æœºåå’ŒåŸŸåï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œæ”¯æŒé€šé…ç¬¦\n        #è®¿é—®çš„æ—¶å€™å°±æ˜¯åŸŸå+ç«¯å£å°±å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªserverä¸‹çš„ç½‘ç«™\n        \n        #æˆ‘ä¼šåœ¨è¿™é‡Œæ’å…¥ä¾‹å­ï¼Œä¸‹é¢æˆ‘ä¼šå±•ç¤ºä¾‹å­ï¼ï¼ï¼\n    }\n}\n```\n\nã€`ä¾‹å­1`ã€‘å½“è®¿é—®`http://qianyios.top:80`å°±ä¼šè®¿é—®ä»¥ä¸‹é¡µé¢ï¼ˆä¹Ÿå°±æ˜¯nginxæ¬¢è¿é¡µï¼‰ï¼Œè¿™é‡Œåªæ˜¯ä¾‹å­ï¼Œä½ å¯ä»¥æ ¹æ®ä½ è‡ªå·±æƒ…å†µåŒ¹é…\n\n`/`  è¿™ä¸ªè·¯å¾„å¾ˆç‰¹æ®Šï¼Œåªè¦ç”¨æˆ·è®¿é—®çš„åœ°å€qianyios.top:80åé¢æ²¡æœ‰åŠ ä»€ä¹ˆè¢«å…¶ä»–locationå®šä½åˆ°çš„è¯éƒ½ä¼šæ¥åˆ°è¿™ä¸ª\n\n```bash\nhttp {\n......\n    server {\n        listen       80;\n        server_name  qianyios.top; \n        location / {\n            root   html; # è®¾ç½®ç½‘ç«™æ ¹ç›®å½•\n            index  index.html index.htm; # é»˜è®¤é¦–é¡µæ–‡ä»¶\n            #å½“è®¿é—®çš„æ—¶å€™ä¼šåœ¨nginxç›®å½•ä¸‹çš„html/ä¸‹å¯»æ‰¾index.html index.htm;\n        }\n }\n```\n\n\n\nã€`ä¾‹å­2`ã€‘å½“è®¿é—®`http://qianyios.top:80/abc/`å°±ä¼šè®¿é—®ä»¥ä¸‹é¡µé¢ï¼Œä¸€ä¸ªserverå¯ä»¥å­˜åœ¨å¤šä¸ªlocationï¼Œä½†æ˜¯å…¶å®šä½çš„è·¯å¾„ä¸è¦å‡ºç°ç›¸åŒçš„ä½ç½®ã€‚æ¯”å¦‚ï¼šæœ‰ä¸¤ä¸ª`location /abc{å†…å®¹}`\n\næ³¨æ„æœ‰ä¸¤ä¸ªè¯¯åŒº\n\nâ‘ å¦‚æœrootæ˜¯/home è¿™é‡Œ`å®é™…è®¿é—®è·¯å¾„`æ˜¯`/home`/abc/index.html\n\nâ‘¡å¦‚æœrootæ˜¯/home/abc è¿™é‡Œ`å®é™…è®¿é—®è·¯å¾„`æ˜¯`/home/abc`/abc/index.html\n\nå…¶å®rootçš„åŠŸèƒ½å°±æ˜¯å°†qianyios.top:80å®šä¹‰ä¸ºrootï¼ˆç½‘ç«™æ ¹ç›®å½•ï¼‰ï¼Œç„¶åè®¿é—®åœ°å€åé¢çš„/abcå°±ä¼šåŠ åœ¨å®é™…è®¿é—®è·¯å¾„é‡Œ\n\n```bash\nhttp {\n......\n    server {\n        listen       80;\n        server_name  qianyios.top; \n         location / {\n            root   html; # è®¾ç½®ç½‘ç«™æ ¹ç›®å½•\n            index  index.html index.htm; # é»˜è®¤é¦–é¡µæ–‡ä»¶\n            #å½“è®¿é—®çš„æ—¶å€™ä¼šåœ¨nginxç›®å½•ä¸‹çš„html/ä¸‹å¯»æ‰¾index.html index.htm;\n        }\n        \n        \n        location /abc {\n        #è¿™ä¸ª/abcä¸‹çš„ç½‘ç«™æ ¹ç›®å½•å¯ä»¥ä¸ç”¨åœ¨nginxç›®å½•ä¸‹ï¼Œä½ å¯ä»¥å®šä¹‰å…¶ä»–ä½ç½®\n            root   /home; # è®¾ç½®å®šä½/abcç«™ç‚¹ä»¥/homeä¸ºç½‘ç«™æ ¹ç›®å½•\n            index  index.html index.htm; # é»˜è®¤é¦–é¡µæ–‡ä»¶\n            #å½“è®¿é—®çš„æ—¶å€™ä¼šåœ¨/homeç›®å½•ä¸‹å¯»æ‰¾index.html index.htm;\n        }\n }\n```\n\n![image-20241123170434381](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/577916afe2be2c88b14ae9378c9fc1af697559838.png)\n\n```\nmkdir /home/abc\necho \"welccome to /home/abc\" >> /home/abc/index.html\nnginx -s reload\nhttp://qianyios.top:80/abc\n```\n\nè¿™é‡Œåˆä¼šæœ‰ä¸¤ä¸ªæŠ¥é”™\n\n![image-20241123183422466](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/5873d1b533412e5d3a4e7a9bcb12c70b697559838.png)\n\næˆ‘ä»¬è¦å»æ‰¾index.htmlæ–‡ä»¶åªæœ‰åƒä»¥ä¸‹è¾“å…¥å‘½ä»¤æ‰ä¼šèƒ½æ‰¾å¾—åˆ°\n\n```\n[root@localtion ~]# ls /home/abc/\nindex.html\n```\n\nå¦‚æœä½ åªæ˜¯è®¿é—®`http://qianyios.top:80/abc`å®é™…è®¿é—®è·¯å¾„æ˜¯/home/abcï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºnginxä¼šå› ä¸ºabcæ˜¯ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬æœ¬èº«çš„ç›®çš„å°±æ˜¯è¦å»abcä¸‹å»æ‰¾index.html,æ‰€ä»¥æœ€åè¦åŠ ä¸ª`/`\n\nä½†æ˜¯å‘¢åœ¨å®¿ä¸»æœºçš„æµè§ˆå™¨å®é™…è®¿é—®åœ°å€æ˜¯`http://192.168.48.101/abc`ï¼ˆè¿™é‡Œæ˜¯æˆ‘çš„å®¿ä¸»æœºï¼Œæˆ‘æ²¡åšhostsæ˜ å°„ï¼Œæˆ‘å°±ç”¨ipäº†ï¼Œæˆ‘åªåœ¨è™šæ‹Ÿæœºåšäº†æ˜ å°„ä¸€æ ·çš„ã€‚ï¼‰æ³¨æ„ï¼Œè¿™é‡Œæˆ‘æœ€åæ²¡åŠ æ–œæ å®ƒè‡ªåŠ¨ç»™æˆ‘åŠ ä¸Šäº†ã€‚\n\n![image-20241123182819923](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/e7d01edd407e19c7f16c0cd2da09cdb7697559838.png)\n\næ€»ç»“ï¼šæˆ‘æä¸æ‡‚ä¸¤è€…æ€ä¹ˆå›äº‹ï¼Œå¯èƒ½linuxä¸ä¼šè‡ªåŠ¨åŠ ä¸Šå§ï¼Œæµè§ˆå™¨ä¼šï¼Œå°±æ˜¯è¯´å¦‚æœåœ¨è™šæ‹Ÿæœºè®¿é—®è¦åŠ `/`ã€‚ä¸ºäº†è§„èŒƒå°±æ˜¯ä¸ç®¡åœ¨å“ªéƒ½åœ¨é…ç½®æ–‡ä»¶åŠ ä¸Šæœ«å°¾çš„æ–œæ \n\n\n\nã€`ä¾‹å­3`ã€‘\n\nä¸€èˆ¬é™æ€æ–‡ä»¶ä¼šç”¨alias,æ¯”å¦‚è¯´/var/www/images/ä¸‹æœ‰ä¸ªå›¾ç‰‡\n\n![image-20241123185235133](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/e731dd6519e452b921376c3c6636369e697559838.png)\n\nå½“æˆ‘è®¾ç½®äº†ä»¥ä¸‹é…ç½®\n\n```bash\nlocation /images/ {\n\t# aliasè®¾ç½®è¯·æ±‚çš„åˆ«åï¼Œç”¨äºæ›¿æ¢æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚\n       alias /var/www/images/;\n}\n```\n\né‡è½½é…ç½®ä¹‹å\n\nè®¿é—®http://192.168.48.101/images/1.png\n\n<img src=\"../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/53570cebb87de92b4f0013d184981561697559838.png\" alt=\"image-20241123185936964\" style=\"zoom:67%;\" />\n\nç»“è®ºï¼š\n\nè®¿é—®åœ°å€ï¼š`192.168.48.101/images`/1.png\n\nå®é™…è®¿é—®åœ°å€ï¼š`/var/www/images`/1.png\n\nåŒç±»å‹çš„æ¡ˆä¾‹å†æ¥ä¸€ä¸ª\n\n```bash\nlocation /abc/ {\n   alias   /home/abc/; \n   index  index.html index.htm; # é»˜è®¤é¦–é¡µæ–‡ä»¶\n   #å½“è®¿é—®çš„æ—¶å€™ä¼šåœ¨/homeç›®å½•ä¸‹å¯»æ‰¾index.html index.htm;\n}\n```\n\n![image-20241123185910023](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/046d119d652f6d6665fd25e56bb520f6697559838.png)\n\n\n\n\n\nã€`ä¾‹å­4`ã€‘\n\nç²¾ç¡®åŒ¹é…ï¼ˆé¡¾åæ€ä¹‰ä¸åšè¿‡å¤šè§£é‡Šäº†ï¼‰\n\nè®¿é—®ï¼šhttp://qianyios.top/50x.html\n\n```\nlocation = /50x.html {\n            root   html;\n        }\n```\n\n\n\nã€`ä¾‹å­5`ã€‘\n\n- `~`ï¼šå¤§å°å†™æ•æ„Ÿï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰\n- `=` : ç²¾ç¡®åŒ¹é…ï¼ˆå¿…é¡»å…¨éƒ¨ç›¸ç­‰ï¼‰\n- `~*`ï¼šå¿½ç•¥å¤§å°å†™ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰ï¼Œè¿™é‡Œè¦æ³¨æ„å¿½ç•¥å¤§å°å†™çš„æ„æ€æ˜¯è¯·æ±‚çš„å­—ç¬¦å¤§å°å†™éƒ½å¯ä»¥ï¼Œ ä½†æ˜¯ä¸ä¼šè¿›è¡Œå¤§å°è½¬æ¢ï¼Œè¯·æ±‚çš„å¤§å°å†™å¯¹åº”çš„æ–‡ä»¶å¿…é¡»å­˜åœ¨ã€‚\n- `^~` ï¼šåªéœ€åŒ¹é…uriéƒ¨åˆ†\n- `@` ï¼šå†…éƒ¨æœåŠ¡è·³è½¬\n\n```bash\n#1.ç²¾ç¡®åŒ¹é…\n location = /index.html {\n  root /etc/nginx/html;\n}\n# åˆ™åŒ¹é…åˆ°http://192.168.48.101/index.htmlè¿™ç§è¯·æ±‚ã€‚\n\n#2.å¤§å°å†™é“­æ„ŸåŒ¹é…\n location ~ /ABC/ {\n    [ configuration ]\n }\n #è¯·æ±‚ç¤ºä¾‹\n #http://qianyios.top/ABC/ [æˆåŠŸ]\n #http://qianyios.top/abc/ [å¤±è´¥]\n\n#3.å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…\nlocation ~* /abc.html {\n    [ configuration ]\n}\n# åˆ™ä¼šå¿½ç•¥ uri éƒ¨åˆ†çš„å¤§å°å†™\n#http://qianyios.top/ABC.html [æˆåŠŸ] å¯ä»¥æˆåŠŸåŒ¹é…ï¼Œä½†æ˜¯ç›®å½•ä¸­è¦ABC.htmlæ–‡ä»¶\n#http://qianyios.top/abc.html [æˆåŠŸ] å¯ä»¥æˆåŠŸåŒ¹é…ï¼Œä½†æ˜¯ç›®å½•ä¸­è¦abc.htmlæ–‡ä»¶\n\n#4.æŒ‡å®šåç¼€åŒ¹é…\nlocation ~* \\.(gif|jpg|jpeg|png)$ {\n root /var/www/images;\n}\n#http://qianyios.top/1.png [æˆåŠŸ]\n\n#5.å¿½ç•¥æ­£åˆ™åŒ¹é…\nlocation ^~ /images/ {\n   alias /var/www/images;\n}\n#ä»¥ /img/ å¼€å¤´çš„è¯·æ±‚ï¼Œéƒ½ä¼šåŒ¹é…ä¸Š\n#http://qianyios.top/images/1.jpg  [æˆåŠŸ]\n#http://qianyios.top/images/1.png [æˆåŠŸ]\n```\n\n`æ³¨æ„ï¼š`å¦‚æœé…ç½®äº†`#5`ï¼Œé‚£ä¹ˆæ‰€æœ‰urlé‡Œè¯·æ±‚ /images/ ä¸‹çš„å›¾ç‰‡ä¼šè¢«ä¸Šé¢`#5`çš„å¤„ç†ï¼Œå› ä¸º `^~` æŒ‡ä»¤åŒ¹é…åˆ°äº†/image/ï¼Œåˆ™ä¸æ£€æŸ¥`#4`æ­£åˆ™è¡¨è¾¾å¼ã€‚å¯¹æ¯”è¿™ä¸¤ä¸ªlocationï¼Œå¯ä»¥**è®¾ç½®ä¸åŒç›®å½•ï¼Œç›¸åŒæ–‡ä»¶è¿›è¡Œå®éªŒã€‚**\n\n## åå‘ä»£ç†å’Œæ­£å‘ä»£ç†\n\n### åå‘ä»£ç†\n\n![image-20241124002646957](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/04df1bf721056ca83bb4a9b2537992ad697559838.png)\n\næ ¹æ®ä»¥ä¸Šçš„ä»£ç å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬è®¾ç½®ä¸‰ä¸ªserverï¼Œåˆ†åˆ«è¡¨ç¤º3ä¸ªç½‘ç«™ï¼Œä»–ä»¬éƒ½æœ‰å¯¹åº”çš„åŸŸåï¼Œç„¶åé€šè¿‡é…ç½®åå‘ä»£ç†ï¼ˆå³è¾¹çš„é…ç½®æ–‡ä»¶ï¼‰å®ç°åå‘ä»£ç†ã€‚å³ï¼šå½“ç”¨æˆ·è®¿é—®user1.comï¼Œnginxå°±ä¼šå°†è¯·æ±‚è½¬åˆ°å‘åˆ°https://website1.comä¸Šã€‚å¯¹åº”çš„åç«¯æœåŠ¡å™¨web1æ¥æ”¶åˆ°è¯·æ±‚å¹¶è¿”å›å“åº”ç»™ Nginxï¼ŒNginx æ¥æ”¶åˆ°æ¥è‡ªåç«¯æœåŠ¡å™¨çš„å“åº”ï¼Œå¹¶å°†å…¶è¿”å›ç»™ç”¨æˆ·ã€‚\n\n- å¯¹äº `user1.com` çš„è¯·æ±‚ï¼ŒNginx å°†å…¶è½¬å‘åˆ° `http://website1.com/`ã€‚\n- å¯¹äº `user2.com` çš„è¯·æ±‚ï¼ŒNginx å°†å…¶è½¬å‘åˆ° `http://website2.com/`ã€‚\n- å¯¹äº `user3.com` çš„è¯·æ±‚ï¼ŒNginx å°†å…¶è½¬å‘åˆ° `http://website3.com/`ã€‚\n\nå›¾ç‰‡ä¸­è¯´çš„æ— æ³•è·³è¿‡nginxå»ç›´æ¥è®¿é—®åç«¯æœåŠ¡å™¨ï¼Œè¯´æ³•å¤ªæ­»äº†ï¼Œåªèƒ½è¯´æ˜¯ä¸ªä¾‹ï¼Œå¦‚æœé¡¹ç›®æœ¬èº«å°±ä¸æƒ³è®©ä½ çŸ¥é“åç«¯çš„åœ°å€ï¼Œåªæƒ³è®©ä½ é€šè¿‡nginxæ¥è¿›è¡Œè®¿é—®ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå°±å¥½åƒbaidu.com    æ€»ä¸èƒ½è¯´baidu.comåªç»‘å®šåˆ°ä¸€ä¸ªæœºå­ä¸Šå§ï¼Œä»–è‚¯å®šä¼šæœ‰ä¸€ä¸ªåºå¤§çš„è´Ÿè½½å‡è¡¡ä»¥åŠåå‘ä»£ç†é›†ç¾¤ï¼Œå»å‡è¡¡è´Ÿè½½åˆ†æ•£æµé‡ç­‰æ“ä½œï¼Œå¦‚æœåªç»‘å®šåˆ°ä¸€ä¸ªæœºå­ï¼Œä¹Ÿæ‰¿å—ä¸ä½æ¯å¤©å‡ ç™¾ä¸‡çš„è®¿é—®ä¸‹é¢ä¼šè®²åˆ°è´Ÿè½½å‡è¡¡ã€‚å°±å¥½åƒä¸Šé¢çš„å›¾ç‰‡çš„ä¾‹å­ï¼Œæˆ‘çš„åç«¯ä¸‰ä¸ªéƒ½æ˜¯ç™¾åº¦çš„ç½‘ç«™ï¼Œæœ‰ä¸‰ä¸ªä¸åŒçš„åŸŸåï¼Œä½†æ˜¯ä¸å¯èƒ½è®©ç”¨æˆ·å»è®°ä½ä¸‰ä¸ªåŸŸåå§ï¼Œæ‰€ä»¥æœ‰ä¸ªnginxå»åšåå‘ä»£ç†ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªbaidu.comå»ä»£ç†è¿™ä¸‰ä¸ªwebä¹Ÿå¯ä»¥åšåˆ°åå‘ä»£ç†\n\n\n\n### æ­£å‘ä»£ç†\n\nç”¨æˆ·éœ€è¦é€šè¿‡ä»£ç†æœåŠ¡å™¨å»è®¿é—®å¤–ç½‘ã€‚è¿™ä¸ªä»£ç†æœåŠ¡å™¨å¯ä»¥æ˜¯å…¶ä»–å·¥å…·ä¸ä¸€å®šæ˜¯nginx\n\n![image-20241124004405332](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/d2846d2fd31a99a6ddf810b47222a881697559838.png)\n\n\n\n<font color='red'>æ€»ç»“</font>ï¼šç®€å•æ¥è¯´å±€åŸŸç½‘è®¿é—®äº’è”ç½‘å°±æ˜¯æ­£å‘ä»£ç†,äº’è”ç½‘è®¿é—®å±€åŸŸç½‘å°±æ˜¯åå‘ä»£ç†.è¿™äº›éƒ½æ˜¯éš§é“å¼ä»£ç†ï¼Œè¿›å‡ºéƒ½è¦ç»è¿‡ä»£ç†æœåŠ¡å™¨\n\n## è´Ÿè½½å‡è¡¡\n\n### **è´Ÿè½½å‡è¡¡ç­–ç•¥**\n\n**è½®è¯¢**\n\né»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨è½®è¯¢æ–¹å¼ï¼Œé€ä¸€è½¬å‘ï¼Œè¿™ç§æ–¹å¼é€‚ç”¨äºæ— çŠ¶æ€è¯·æ±‚ã€‚(åœ¨æ— å‚æ•°æƒ…å†µä¸‹å¹³å‡åˆ†é…æ‰€æœ‰è¯·æ±‚)\n\n![image-20241125174222842](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/db573abf75aa87a347a2483e6d949110697559838.png)\n\n```bash\nhttp {\n#upstreamå’Œserveræ˜¯åŒä¸€çº§åˆ«ï¼Œéƒ½åŒ…å«åœ¨httpå†…\n    upstream qianyi {\n        server website1.com   weight=10 down;  #æ¯åæ¬¡è¯·æ±‚ä¹‹åè½®è¯¢åˆ°ä¸‹ä¸€ä¸ª\n        server website2.com   weight=1;\n        server website3.com   weight=1 backup;\n    }\n\n    server {\n        listen 80;\n\tserver_name qianyios.top\n        location / {\n            proxy_pass http://qianyi;#åå­—éšæ„ï¼Œè¦å’Œupstreamåçš„åå­—ä¸€æ ·\n        }\n    }\n}\n```\n\n> `down`ï¼šè¡¨ç¤ºå½“å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½\n>\n> `weight`ï¼šé»˜è®¤ä¸º1.weightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚\n>\n> `backup`ï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ã€‚\n\n`ip_hash`\n\nå¯¹ç”¨æˆ·çš„ipè¿›è¡Œè®¡ç®—ï¼š`Hash(IP)%upstream_node_count`ï¼Œè¿”å›è¦ä½¿ç”¨æœºå™¨çš„ç´¢å¼•\n\næ¯ä¸€ä¸ªç”¨æˆ·ä¼šå›ºå®šåˆ†é…åˆ°ä¸€å°æœºå™¨ï¼Œé˜²æ­¢åœ¨Aæœºå™¨ä¸Šåˆ›å»ºSessionçš„ç”¨æˆ·ï¼Œåç»­è¢«åˆ†é…åˆ°å…¶ä»–æœºå™¨ï¼Œå¯¼è‡´Sessionå¤±æ•ˆ\n\nå¼€å¯ip_hashåï¼Œå¦‚æœæƒ³è¦ç§»é™¤ä¸€å°serverï¼Œå¿…é¡»ä½¿ç”¨downé…ç½®ã€‚å¦‚æœç›´æ¥åˆ é™¤ï¼Œä¼šå¯¼è‡´upstream_node_countå˜åŒ–ï¼Œä½¿å¾—æ‰€æœ‰ç”¨æˆ·è®¿é—®çš„è®¿é—®çš„æœºå™¨å‘ç”Ÿå˜åŒ–\n\nç¼ºç‚¹ï¼š\n\n- å¢åŠ æœåŠ¡èŠ‚ç‚¹ä¼šå¯¼è‡´upstream_node_countå˜åŒ–ï¼Œè¿›è€Œå¯¼è‡´æ‰€æœ‰ç”¨æˆ·è®¿é—®çš„æœºå™¨å˜åŒ–\n- æŸä¸ªç”¨æˆ·çŸ­æ—¶é—´å‘èµ·å¤§é‡è¯·æ±‚ï¼Œä¼šæ‰“åˆ°ä¸€å°å›ºå®šçš„æœºå™¨ï¼Œå¯¼è‡´è¿™å°æœºå™¨æ€§èƒ½å¤§å¹…ä¸‹é™ï¼Œè€Œå…¶ä»–æœºå™¨å¯èƒ½è¿˜æ˜¯ç©ºé—²\n\n```bash\nupstream test_server{\n    # å¼€å¯ip_hashï¼Œ\n    ip_hash;\n    \n\t\tserver web1.com:80;\n\t\tserver web2.com:80;\n}\n```\n\n`least_conn`\n\nå°½å¯èƒ½å°†è¯·æ±‚è½¬å‘åˆ°å½“å‰è¿æ¥æ•°æœ€å°‘çš„åç«¯æœåŠ¡å™¨\n\n```\nupstream test_server{\n    least_conn;\n    \n\t\tserver web1.com:80;\n\t\tserver web2.com:80;\n}\n```\n\nä¸‹é¢ä¾‹å­ï¼Œå¼€å¯least_connï¼ŒNginxä¼šä¼˜å…ˆè½¬å‘åˆ°Tomcat3\n\n![image-20241126232643480](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/e6f48aa1bd0b54d7d4c3f7248146b954697559838.png)\n\n\n\n`url_hash`\n\næ ¹æ®ç”¨æˆ·è®¿é—®çš„urlå®šå‘è½¬å‘è¯·æ±‚\n\n`fair`\n\næ ¹æ®åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´è½¬å‘è¯·æ±‚\n\n\n\n<font color='red'>æ€»ç»“</font>ï¼šå½“æˆ‘ä»¬è®¿é—®http://qianyios.topæ—¶åœ¨upstreamæ— å‚æ•°çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸‰ä¸ªç½‘é¡µéƒ½ä¼šå¹³å‡çš„è®¿é—®ï¼Œä¸”åœ°å€æ é‡Œçš„qianyios.topä¸ä¼šå˜\n\nå…¶æ¬¡æœ‰å‚æ•°æ—¶ï¼Œéƒ½ä¼šæŒ‰ç…§å‚æ•°çš„æ€§è´¨ï¼Œè¿›è¡Œè½®è¯¢è®¿é—®\n\n## åŠ¨é™åˆ†ç¦»\n\n- é™ï¼šå‰ç«¯é¡¹ç›®ï¼ˆé™æ€èµ„æºï¼‰\n- åŠ¨ï¼šæ¥å£æœåŠ¡\n- åŸŸåA.comè®¿é—®åˆ°Aé¡¹ç›®ã€B.comè®¿é—®åˆ°Bé¡¹ç›®\n\n  Api.comè®¿é—®æ¥å£æœåŠ¡\n\n  å°†3ä¸ªåŸŸåéƒ½è§£æåˆ°Nginxæ‰€åœ¨æœºå™¨\n\n```bash\n# å‰ç«¯\nserver {\n        listen       80;\n        server_name  A.com;\n        \n        location ~ {  \n            root /websit/xxx; # Aé¡¹ç›®ç›®å½•\n            index  index.html index.htm;\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n}\nserver {\n        listen       80;\n        server_name  B.com;\n        \n        location ~ {  \n            root /websit/xxx; # Bé¡¹ç›®ç›®å½•\n            index  index.html index.htm;\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n}\n\n# æ¥å£\nserver {\n        listen       80;\n        server_name  Api.com;\n\t\t\t\t\n\t# æ¥å£\n\tlocation  {\n        proxy_pass http://æ¥å£æœºå™¨çš„IP:ç«¯å£;\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n}\n```\n\n```bash\nlocation ~* /(js|css|img){\n\troot html;\n  index  index.html index.htm;\n}\n\n#   ~* è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚\n#   /(css|img|js) æ„å‘³ç€è¿™ä¸ªlocationå—å°†åŒ¹é…æ‰€æœ‰ä»¥/cssã€/imgæˆ–/jsç»“å°¾çš„URLè·¯å¾„ã€‚\n#  Nginxä¼šåœ¨æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­å¯¹åº”çš„htmlç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶ã€‚\n```\n\n## URLé‡å†™\n\n### return\n\næŠŠHttpé‡å®šå‘ä¸ºHttps\n\n```bash\nserver {\n        listen       80;\n        server_name  www.qianyios.com;\n\t\tlocation / { \n\t\t\treturn 302 https://www.qianyios.com$request_uri \n\t\t\t# 302æ˜¯çŠ¶æ€ç \n\t\t\t# $request_uriæ˜¯è·¯å¾„å’Œå‚æ•° ï¼Œä¾‹å¦‚ï¼š/xxx/xx?xx=xx\n        }\n}\n```\n\n### rewrite\n\n```bash\nrewriteæ˜¯URLé‡å†™çš„å…³é”®æŒ‡ä»¤ï¼Œæ ¹æ®regexï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰éƒ¨åˆ†å†…å®¹ï¼Œé‡å®šå‘åˆ°replacementï¼Œç»“å°¼æ˜¯flagæ ‡è®°ã€‚\n\nrewrite    <regex>   <replacement>  [flag];\nå…³é”®å­—\t\t\t\tæ­£åˆ™\t\t\t\tæ›¿ä»£å†…å®¹     flagtæ ‡è®°\n\næ­£åˆ™ï¼šper1æ£®å®¹æ­£åˆ™è¡¨è¾¾å¼è¯­å¥è¿›è¡Œè§„åˆ™åŒ¹é…\næ›¿ä»£å†…å®¹ï¼šå°†æ­£åˆ™åŒ¹é…çš„å†…å®¹æ›¿æ¢æˆreplacement\n\nflagæ ‡è®°è¯´æ˜ï¼š\nlast  #æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œç»§ç»­å‘ä¸‹åŒ¹é…æ–°çš„1ocation URIè§„åˆ™\nbreak #æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆå³ç»ˆæ­¢ï¼Œä¸å†åŒ¹é…åé¢çš„ä»»ä½•è§„åˆ™\n\nredirect #è¿”å›302ä¸´é‡å®šå‘ï¼Œæ¸¸è§ˆå™¨åœ°å€ä¼šæ˜¾ç¤ºè·³è½¬åçš„URLåœ°å€\npermanent #è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œæµ‹è§ˆå™¨åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„URLåœ°å€\n```\n\næŠŠHttpé‡å®šå‘ä¸ºHttps\n\n```bash\nserver {\n        listen       80;\n        server_name  www.qianyios.com;\n\t\tlocation / { \n\t\t   rewrite ^/(.*) https://www.qianyios.top.com/$1 redirect;\n\t\t   # åŒ¹é…åˆ°uriçš„/åçš„å†…å®¹ï¼Œå¹¶æ”¾åˆ°$1ä¸­ï¼Œæ‰§è¡Œé‡å®šå‘\n        \t  proxy_pass http://xxx;\n        }\n}\n```\n\nå½“ä½ å°è¯•è®¿é—®http://www.qianyios.top/1.htmlæ—¶ï¼Œç”±äºä¸Šè¿°rewriteæŒ‡ä»¤çš„å­˜åœ¨ï¼Œä½ çš„æµè§ˆå™¨å®é™…ä¸Šä¼šè¢«å¼•å¯¼è‡³https://www.qianyios.top.com/1.html\n\nä¸Šè¿°å‘½ä»¤æ”¹æˆreturnä¼šæ›´é«˜æ•ˆ\n\n```bash\nreturn 301 https://www.qianyios.top.com$request_uri;\n```\n\nå®ä¾‹ï¼š\n\n```bash\nrewrite ^/([0-9]+).html$  /index.jsp?pageNum=$1 break;\n```\n\nå‡è®¾æˆ‘ä»¬çš„çœŸå®åœ°å€æ˜¯192.168.48.101/index.jsp?pageNum=12   ä½†æ˜¯æˆ‘ä¸æƒ³å®¢æˆ·çŸ¥é“çœŸå®åœ°å€\n\né…ç½®äº†è¿™ä¸ªè§„åˆ™ä¹‹åï¼Œä»–å°±ä¼šå˜æˆ192.168.48.101/12.html\n\næˆ‘ä»¬è®¿é—®192.168.48.101/12.htmlï¼ˆä½†æ˜¯12.htmlæ˜¯ä¸å­˜åœ¨çš„ï¼‰ä¹‹åï¼Œä»–ä¼šæŠŠæµé‡è½¬å‘åˆ°192.168.48.101/index.jsp?pageNum=12ï¼ˆçœŸå®åœ°å€ï¼‰\n\n## Nginxç½‘å…³æœåŠ¡å™¨\n\nä¼ä¸šä¸­ï¼Œæ— è®ºæ˜¯å‰ç«¯é¡µé¢ã€é™æ€èµ„æºã€æ¥å£ï¼Œéƒ½æ˜¯é€šè¿‡Nginxè¿›è¡Œè®¿é—®ï¼ˆä½¿ç”¨proxy_passï¼‰ï¼Œè¿™æ—¶å€™è¿™å°NginxæœåŠ¡å™¨å°±æˆä¸ºäº†ç½‘å…³æœåŠ¡å™¨ï¼ˆæ‰¿æ‹…å…¥å£çš„åŠŸèƒ½ï¼‰\n\n![image-20241203004657289](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/836a165f1c9207a3043222f47a626fbe697559838.png)\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬å¯åŠ¨webæœåŠ¡å™¨çš„é˜²ç«å¢™ï¼Œè®¾ç½®å…¶åªèƒ½æ¥å—è¿™å°NginxæœåŠ¡å™¨çš„è¯·æ±‚\n\n```\nsystemctl start firewalld\n```\n\n**æ·»åŠ richè§„åˆ™**\n\n```bash\n#è¿™é‡Œçš„192.168.48.101æ˜¯ç½‘å…³æœåŠ¡å™¨(nginx)åœ°å€\nfirewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.48.101\" port protocol=\"tcp\" port=\"8080\" accept\" \n```\n\n- `firewall-cmd`ï¼šè¿™æ˜¯ç”¨æ¥ä¸firewalldè¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…·ã€‚\n- `--permanent`ï¼šè¡¨ç¤ºè¿™ä¸ªæ›´æ”¹ä¼šæ°¸ä¹…ç”Ÿæ•ˆï¼Œå³ä½¿ç³»ç»Ÿé‡å¯åä¹Ÿä¼šä¿ç•™ã€‚ä¸è¿‡è¯·æ³¨æ„ï¼Œä¸ºäº†ä½¿æ°¸ä¹…æ€§è§„åˆ™ç«‹å³ç”Ÿæ•ˆï¼Œæ‚¨éœ€è¦é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®ã€‚\n- `--add-rich-rule=\"è§„åˆ™\"`ï¼šè¿™æ˜¯ç”¨æ¥æ·»åŠ ä¸€æ¡å¯Œè§„åˆ™åˆ°firewalldçš„å‚æ•°ã€‚å¯Œè§„åˆ™å…è®¸æ›´å¤æ‚çš„æ¡ä»¶å’Œæ“ä½œã€‚\n\nåœ¨å¼•å·å†…çš„éƒ¨åˆ†å®šä¹‰äº†å…·ä½“çš„è§„åˆ™ï¼š\n\n- `rule family=\"ipv4\"`ï¼šæŒ‡å®šè¿™æ¡è§„åˆ™é€‚ç”¨äºIPv4åè®®ã€‚\n- `source address=\"192.168.48.101\"`ï¼šè§„åˆ™åªé€‚ç”¨äºæºåœ°å€ä¸º`192.168.48.101`çš„æµé‡ã€‚\n- `port protocol=\"tcp\" port=\"8080\"`ï¼šè¿™æ¡è§„åˆ™é’ˆå¯¹çš„æ˜¯TCPåè®®ï¼Œå¹¶ä¸”ä»…é™äºç«¯å£å·ä¸º`8080`çš„è¿æ¥ã€‚\n- `accept`ï¼šè¿™è¡¨ç¤ºå¦‚æœæ‰€æœ‰ä¸Šè¿°æ¡ä»¶éƒ½æ»¡è¶³ï¼Œåˆ™æ¥å—ï¼ˆå…è®¸ï¼‰è¯¥ç½‘ç»œæµé‡ã€‚\n\né…ç½®å®Œä¹‹åé‡å¯firewalld\n\n```\nsystemctl restart firewalld\n```\n\nè¿™æ—¶å€™ï¼ŒåŸæœ¬webå¼€å¯äº†é˜²ç«å¢™ä¹‹åï¼Œä¸ç®¡è®¿é—®webåœ°å€è¿˜æ˜¯nginxæœåŠ¡å™¨éƒ½æ— æ³•è®¿é—®åˆ°æˆ‘ä»¬çš„web\n\nä¸”nginxé…ç½®`proxy_pass http://192.168.48.105:8080`åå‘ä»£ç†åˆ°web\n\nä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨webç«¯é…ç½®äº†é˜²ç«å¢™è§„åˆ™ä¹‹åï¼Œè®©webåŒæ„æ¥æ”¶æ¥è‡ªnginxçš„192.168.48.101çš„è¯·æ±‚ï¼Œä¸”è‡ªèº«å¼€æ”¾8080ç«¯å£ï¼Œè¿™æ ·æˆ‘ä»¬è®¿é—®192.168.48.101ï¼ˆè¿™æ˜¯nginxçš„åœ°å€åå‘ä»£ç†åˆ°äº†webï¼‰å°±å¯ä»¥è®¿é—®webäº†\n\n**ç§»é™¤richè§„åˆ™**\n\n```bash\n#è¿™é‡Œçš„192.168.48.101æ˜¯ç½‘å…³æœåŠ¡å™¨(nginx)åœ°å€\nfirewall-cmd --permanent --remove-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.48.101\" port protocol=\"tcp\" port=\"8080\" accept\" \n```\n\n**æŸ¥çœ‹æ‰€æœ‰è§„åˆ™**\n\n```shell\nfirewall-cmd --list-all #æ‰€æœ‰å¼€å¯çš„è§„åˆ™\n```\n\n## é˜²ç›—é“¾é…ç½®\n\nå½“æˆ‘ä»¬è¯·æ±‚åˆ°ä¸€ä¸ªé¡µé¢åï¼Œè¿™ä¸ªé¡µé¢ä¸€èˆ¬ä¼šå†å»è¯·æ±‚å…¶ä¸­çš„é™æ€èµ„æºï¼Œè¿™æ—¶å€™è¯·æ±‚å¤´ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªreferå­—æ®µï¼Œè¡¨ç¤ºå½“å‰è¿™ä¸ªè¯·æ±‚çš„æ¥æºï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶æŒ‡å®šæ¥æºçš„è¯·æ±‚æ‰è¿”å›ï¼Œå¦åˆ™å°±ä¸è¿”å›ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœèµ„æº\n\n![image-20241208130819031](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/f2a13ea3f204061b76d98e2e31cd4c7a697559838.png)\n\n![image-20241208130344746](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/0ca270e01ec4bfe1567668978813d129697559838.png)\n\n```shell\nvalid_referers none|server_name\n```\n\nè®¾ç½®æœ‰æ•ˆçš„referå€¼\n\n- noneï¼šä¸æ ¡éªŒrefer\n- server_nameï¼šæ ¡éªŒreferåœ°å€æ˜¯å¦ä¸ºserver_nameï¼ˆserver_nameå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼‰\n\næ³¨æ„ï¼š` if ($invalid_referer)`ä¸­ifåæœ‰ä¸ªç©ºæ ¼ï¼Œä¸å†™å°±ä¼šæŠ¥é”™\n\n```bash\nnginx: [emerg] unknown directive \"if($invalid_referer)\" in /usr/local/nginx/conf/nginx.conf:27\n```\n\n1.ä¾‹å­ï¼šè¿™é‡Œè®¾ç½®nginxæœåŠ¡å™¨ä¸­çš„imgç›®å½•ä¸‹çš„å›¾ç‰‡å¿…é¡»referä¸ºhttps://blog.qianyios.topæ‰èƒ½è®¿é—®\n\n```bash\nserver {\n        listen       80;\n        server_name  localhost;\n\t  location /img{\n                valid_referers https://blog.qianyios.top/;\n                if ($invalid_referer){#æ— æ•ˆçš„refere\n                        return 403;#è¿”å›çŠ¶æ€ç 403\n                }\n                root html;\n                index  index.html index.htm;\n        }\n\n}\n```\n\nè¿™æ ·å…¶ä»–äººï¼Œä¸ç®¡æ˜¯å¼•ç”¨å›¾ç‰‡åˆ°ä»–è‡ªå·±webæˆ–è€…ç›´æ¥åœ¨åœ°å€æ è¾“å…¥ç›´æ¥è®¿é—®éƒ½ä¸è¡Œ\n\n![](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/7fb961c8f95308e9743eb7fc9df5284e697559838.png)\n\nå¦‚æœå¯ä»¥å¼€æ”¾`ç›´æ¥åœ¨åœ°å€æ è¾“å…¥ç›´æ¥è®¿é—®`å¯ä»¥åŠ none\n\n```bash\nvalid_referers none https://blog.qianyios.top/;\n```\n\n\n\n2.ç›´æ¥è·³è½¬åˆ°è‡ªå®šä¹‰å›¾ç‰‡\n\nå‡è®¾123.pngæ˜¯å†™æœ‰ç¦æ­¢ç›—å–å­—æ ·çš„å›¾ç‰‡\n\nå‡è®¾æˆ‘çš„å›¾ç‰‡æ˜¯http://qianyios.top/images/1.png\n\nä»–ä¼šç›´æ¥è·³è½¬åˆ°/var/www/image/123.png\n\n```bash\nlocation ^~ /image/ {\n   root /var/www/;\n}\n\nlocation ^~ /images/ {\n          valid_referers qianyios.top;\n          if ($invalid_referer){#æ— æ•ˆçš„refere\n             rewrite ^/images/(.*)$ /image/123.png break;\n             #return 302 /abc/123.png;\n          }\n          root /var/www/;\n}\n```\n\n`^/images/(.*)$` åŒ¹é…æ‰€æœ‰ä»¥ `/images/` å¼€å¤´çš„è·¯å¾„ï¼Œå¹¶æ•è·åç»­éƒ¨åˆ†ï¼ˆå³ `(.*)`ï¼‰ã€‚\n\n\n\nç”¨curlå·¥å…·è¿›è¡Œè®¿é—®\n\n```\nhttp://qianyios.top/images/1.png\n```\n\n![image-20241208135031449](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/6ca1eecc22842f0abf39f7c04507077c697559838.png)\n\nå¸¦å¼•ç”¨çš„è®¿é—®\n\n```bash\ncurl -e \"http://qianyios.top\" -I http://qianyios.top/images/1.png\n```\n\n![image-20241208135300813](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/006941d2d540486aa7f755741a4ab8a4697559838.png)\n\n## é«˜å¯ç”¨é…ç½®\n\n### èƒŒæ™¯\n\nå¦‚ä¸‹å›¾ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªNginxä½œä¸ºç½‘å…³ï¼Œä¸€æ—¦å‡ºç°æ•…éšœä¼šå¯¼è‡´å…¨éƒ¨æœåŠ¡ä¸å¯ç”¨\n\n![image-20241208141302678](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/b906e3608c6e725550da4bfc278674bc697559838.png)\n\né«˜å¯ç”¨æ–¹æ¡ˆï¼š\n\n![image-20241208141351424](../img/Nginx%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/4cc5dca9cc81adcfba9708bcf287674c697559838.png)\n\næ³¨æ„ï¼šNginxä¸»å¤‡æœºå™¨é…ç½®è¦åŸºæœ¬ä¸€è‡´ï¼Œå¦‚æœé…ç½®ç›¸å·®è¾ƒå¤§ï¼Œåœ¨åˆ‡æ¢æ—¶å¤§é‡æµé‡è¿›å…¥å¤‡ç”¨æœºï¼Œå®¹æ˜“é€ æˆå®•æœº\n\n**VRRPåè®®**\n\nkeepalivedæ˜¯åŸºäºVRRPï¼ˆVirtual Router Redundancy Protocolï¼‰åè®®çš„\n\nVRRPå¯ä»¥å°†å¤šä¸ªNginxç½‘å…³æœºå™¨åˆ†ä¸º masterã€backupä¸¤ç§ç±»å‹ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªVIPï¼ˆ`è™šæ‹ŸIP:Virtual IP Address`ï¼‰\n\næ¯å°æœºå™¨ä¸Šçš„keepalivedä¼šç›¸äº’é€šä¿¡ï¼Œæ ¹æ®å…¶ä»–æœºå™¨ä¸Šçš„keepalivedè¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œåˆ¤æ–­æœåŠ¡å™¨çŠ¶æ€ï¼Œå¦‚æœé»˜è®¤çš„`Master`åœæ­¢äº†ï¼Œå°±ä¼šåœ¨å‰©ä¸‹çš„`Backup`æœºå™¨ä¸­ï¼Œç«é€‰å‡ºä¸€å°NginxæœåŠ¡å™¨ä½œä¸ºMaster\n\nç”±MasteræœåŠ¡å™¨ä½¿ç”¨è¿™ä¸ªVIPï¼Œç”¨æˆ·è®¿é—®æ—¶ï¼Œè®¿é—®çš„æ˜¯VIP\n\n```\nyum install -y keepalived\n```\n\n```bash\n#keepalivedçš„é…ç½®æ–‡ä»¶\nvim /etc/keepalived/keepalived.conf\n```\n\nnginx1çš„é…ç½®\n\n```shell\n! Configuration File for keepalived\n\nglobal_defs {\n   # keepalivedé‚®ä»¶é€šçŸ¥ï¼ˆå¯é…ç½®å¤šä¸ªï¼‰\n   notification_email {\n     acassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   }\n   # é‚®ä»¶å‘ä»¶äººåœ°å€\n   notification_email_from Alexandre.Cassen@firewall.loc\n   # é‚®ä»¶æœåŠ¡å™¨ï¼ˆSMTPï¼‰åœ°å€\n   smtp_server 192.168.200.1\n   # è¿æ¥SMTPæœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´\n   smtp_connect_timeout 30\n   # åé¢ä¼šæåˆ°\n   router_id lb1 # è·¯ç”±idï¼Œå¯ä»¥éšæ„å–ï¼Œä½†æ˜¯è¦ä¿è¯æ¯ä¸ªé…ç½®äº†keepaliveçš„æœºå™¨ä¸é‡å¤å°±è¡Œ\n   \n   # vrrpç›¸å…³é…ç½®ï¼Œç”¨çš„æ¯”è¾ƒå°‘\n   vrrp_skip_check_adv_addr\n   vrrp_strict\n   vrrp_garp_interval 0\n   vrrp_gna_interval 0\n}\n# èŠ‚ç‚¹åå¯ä»¥éšæ„å–ï¼Œä½†è¦ä¿è¯ä¸»ã€å¤‡èŠ‚ç‚¹ä¹‹é—´ä¿æŒä¸€è‡´å³å¯\nvrrp_instance VI_1 {\n    state MASTER  #ä¸»æœåŠ¡å™¨\n    interface eth160 #vipåˆ°æ—¶å€™ä¼šç”Ÿæˆåœ¨è¿™ä¸ªç½‘å¡ä¸‹\n    virtual_router_id 51\n    priority 100  #ä¼˜å…ˆçº§\n    advert_int 1  #æ£€æµ‹é—´éš”æ—¶é—´\n    authentication {   #è®¤è¯æœºåˆ¶ï¼Œè¿™æ ·å¯ä»¥åŒºåˆ†å®ç°ä¸åŒä½œç”¨çš„keepalivedé›†ç¾¤ï¼Œä¸ä¼šæ··ä¹±\n        auth_type PASS # æŒ‡å®šäº†è®¤è¯ç±»å‹ä¸ºå¯†ç ï¼ˆPASSï¼‰\n        auth_pass 1111  # è®¾ç½®äº†è®¤è¯å¯†ç ï¼Œè¿™é‡Œè®¾ç½®çš„å¯†ç æ˜¯\"1111\"\n    }\n    virtual_ipaddress {\n        192.168.48.200 #æ€»ip\n    }\n}\n\nÂ·Â·Â·Â·Â·Â·å…¶ä½™é…ç½®Â·Â·Â·Â·Â·Â·\n}\n```\n\n- `authentication`ã€`virtual_router_id`ã€`virtual_ipaddress`è¿™å‡ ä¸ªä¸€æ ·çš„æœºå™¨ï¼Œæ‰ç®—æ˜¯åŒä¸€ä¸ªç»„é‡Œã€‚è¿™ä¸ªç»„æ‰ä¼šé€‰å‡ºä¸€ä¸ªä½œä¸ºMasteræœºå™¨\n\nnginx2çš„é…ç½®\n\n```bash\n! Configuration File for keepalived\n\nglobal_defs {\n   router_id lb2\n}\n\nvrrp_instance VI_1 {\n    state BACKUP  #ä¸»æœåŠ¡å™¨\n    interface eth160 #vipåˆ°æ—¶å€™ä¼šç”Ÿæˆåœ¨è¿™ä¸ªç½‘å¡ä¸‹\n    virtual_router_id 51\n    priority 50  #é™ä½ä¼˜å…ˆçº§\n    advert_int 1  #æ£€æµ‹é—´éš”æ—¶é—´\n    authentication {   #è®¤è¯æœºåˆ¶ï¼Œè¿™æ ·å¯ä»¥åŒºåˆ†å®ç°ä¸åŒä½œç”¨çš„keepalivedé›†ç¾¤ï¼Œä¸ä¼šæ··ä¹±\n        auth_type PASS # æŒ‡å®šäº†è®¤è¯ç±»å‹ä¸ºå¯†ç ï¼ˆPASSï¼‰\n        auth_pass 1111  # è®¾ç½®äº†è®¤è¯å¯†ç ï¼Œè¿™é‡Œè®¾ç½®çš„å¯†ç æ˜¯\"1111\"\n    }\n    virtual_ipaddress {\n        192.168.48.200 #æ€»ip\n    }\n}\n\nÂ·Â·Â·Â·Â·Â·å…¶ä½™é…ç½®Â·Â·Â·Â·Â·Â·\n}\n```\n\né…ç½®å®Œæˆåï¼Œé‡å¯keepalivedå°±å¯ä»¥å®ç°é«˜å¯ç”¨\n\n> å‡è®¾æˆ‘è®¿é—®192.168.48.200å°±ä¼šè®¿é—®åˆ°ç«äº‰åˆ°masterçš„æœåŠ¡å™¨ï¼Œç„¶åmasteræ˜¯ä¸ªnginxç½‘å…³ï¼Œå°†æµé‡è´Ÿè½½åˆ°Tomcatï¼Œå‡è®¾masterèŠ‚ç‚¹æŒ‚äº†ï¼Œvipå°±ä¼šè·³è½¬backupçš„ens160ä¸Šï¼Œè¿™æ ·è®¿é—®192.168.48.200å°±ä¼šè®¿é—®åˆ°backupçš„æœåŠ¡å™¨ï¼Œå½“masteræ¢å¤ï¼Œé‚£vipå°±ä¼šè·³å›åˆ°masterã€‚\n\nè¿™é‡Œæœ‰keepalivedå®éªŒè¿‡ç¨‹\n\nå¯ä»¥çœ‹ä¸€ä¸‹\n\n[K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå†…éƒ¨etcdï¼‰ | ä¸¥åƒå±¹åšå®¢](https://blog.qianyios.top/posts/7158/#æµ‹è¯•é›†ç¾¤è´Ÿè½½å‡è¡¡é«˜å¯ç”¨)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Nginx"],"categories":["ç¬”è®°"]},{"title":"åä¸ºenspæ¨¡æ‹Ÿå™¨å®‰è£…æ•™ç¨‹","url":"/posts/f8bb3dfe/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# åä¸ºenspæ¨¡æ‹Ÿå™¨å®‰è£…æ•™ç¨‹\n\nè¯·ç•™æ„ï¼šç»è¿‡å¤šå¹´ï¼ŒWindowsç³»ç»Ÿå·²ç»æ¨å‡ºå¤šä¸ªæ–°ç‰ˆæœ¬ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°å„ç§ä¸ç›¸å®¹çš„çŠ¶å†µï¼Œæ•…æ­¤æ­¤æ–‡ä»…ä¾›å‚è€ƒï¼Œå¦‚æœ‰ç–‘é—®ï¼Œè¯·è‡ªè¡Œå¤„ç†ã€‚eNSPæ¨¡æ‹Ÿå™¨ä»2019å¹´å¼€å§‹ä¸å†æœ‰æ–°ç‰ˆæœ¬æ›´æ–°ï¼Œæœ€è¿‘çš„ç‰ˆæœ¬æ˜¯1.3.00.100 V100R003C00SPC100ã€‚\n\n## å®‰è£…å‡†å¤‡\n\nä¸‹è½½åœ°å€1ï¼š[è‡ªå»º](https://resource.qianyios.top/%E7%BD%91%E7%BB%9C/ensp%E5%8F%8A%E9%99%84%E5%B1%9E%E5%AE%89%E8%A3%85%E5%8C%85.7z)   `é€Ÿåº¦è¾ƒæ…¢`\n\nä¸‹è½½åœ°å€2ï¼š[enspåŠä¾èµ–å®‰è£…åŒ…](https://www.alipan.com/s/ZaW6Nf5Y7RH)\n\nè¿™ä¸ªä¸‹è½½ä¹‹åæ˜¯enspåŠä¾èµ–å®‰è£…åŒ….exe123ï¼Œé‡å‘½åæŠŠåé¢çš„123åˆ é™¤å³å¯\n\n## å®‰è£…ç¯å¢ƒæ£€æŸ¥\n\næ£€æŸ¥ä¹‹å‰æ˜¯å¦å·²ç»å®‰è£…è¿‡ eNSP å’Œä¾èµ–è½¯ä»¶ï¼Œå¦‚æœæœ‰å…ˆè¯·å¸è½½ï¼ŒåŒ…æ‹¬ä¾èµ–è½¯ä»¶ä¸€èµ·å¸è½½ã€‚\n\nå¦‚æœä¹‹å‰å®‰è£…è¿‡ eNSP ï¼Œè¯·ä½¿ç”¨æ³¨å†Œè¡¨æ¸…ç†å·¥å…·æ¸…ç†ä¸€ä¸‹æ³¨å†Œè¡¨ã€`æ­¤æ­¥éª¤è°¨æ…æ“ä½œï¼Œæ³¨å†Œè¡¨æ¯”è¾ƒé‡è¦ï¼Œè¯·åœ¨æœ‰å¤‡ä»½çš„æƒ…å†µä¸‹æ¸…ç†ï¼Œæ¸…ç†å‡ºé”™å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨`ã€‘ã€‚\n\neNSPå®‰è£…å’Œä½¿ç”¨è¿‡ç¨‹ä¸­è¯·å°† Windows é˜²ç«å¢™å…³é—­ã€‚\n\nWindows11å®‰è£…éœ€è¦å…³é—­`å†…æ ¸éš”ç¦»`é€‰é¡¹ã€‚\n\n![image-20241203171543779](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/a375a8bc67d690b3ef34e90ca7e28a66697559838.png)\n\n## å®‰è£…winPcap\n\nåŒå‡»å®‰è£…åŒ…ï¼Œä¸€ç›´ä¸‹ä¸€æ­¥åˆ°è¿™ï¼Œä¿æŒé»˜è®¤ï¼Œç»§ç»­ä¸‹ä¸€æ­¥\n\n![image-20241203171543779](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/bc24e40e903e1abd505fb43ce11207b5697559838.png)\n\n![image-20241203171557056](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/1be2bb1ff1c3b662a0b2d2dadfea5e07697559838.png)\n\nç‚¹å‡»finishå³å¯\n\n## å®‰è£…Wireshark\n\nåŒå‡»å®‰è£…åŒ…æ‰“å¼€ï¼Œä¸€ç›´ä¸‹ä¸€æ­¥ï¼Œåˆ°è¿™ï¼Œä¿æŒé»˜è®¤ï¼Œç»§ç»­ä¸‹ä¸€æ­¥\n\n![image-20241203171834891](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/c8df9d2644951a197201edba2574b81f697559838.png)\n\nä¿æŒé»˜è®¤ï¼Œç»§ç»­ä¸‹ä¸€æ­¥\n\n![image-20241203171846995](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/fa609b4d9ef4ba9159970a96d7f9fc08697559838.png)\n\nå¯ä»¥è‡ªè¡Œé€‰æ‹©å®‰è£…è·¯å¾„ï¼Œä½†æ˜¯`ä¸å»ºè®®`,æˆ‘è¿™é‡Œæ˜¯cç›˜å†…å­˜ä¸å¤šäº†\n\n**![image-20241203171947349](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/493e445292ef501067f2ef1686c1d2bc697559838.png)**\n\nä¿æŒé»˜è®¤ï¼Œä¸‹ä¸€æ­¥\n\n![image-20241203172018191](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/4cc79174256632880fee34825c87d1e8697559838.png)\n\nä¿æŒé»˜è®¤ï¼Œä¸‹ä¸€æ­¥\n\n![image-20241203172028555](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/eef0cbf7e6d313c41566acd870fda609697559838.png)\n\nå®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šè·³å‡ºä¸€ä¸ªå®‰è£…èŠ‚ç›®ï¼Œä¿æŒé»˜è®¤ï¼Œä¸‹ä¸€æ­¥å³å¯\n\n![image-20241203172121518](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/ff29ea5aa56d6b96d3239f973c202adf697559838.png)\n\néƒ½ä¸é€‰ä¸‹ä¸€æ­¥\n\n![](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/fcd161c3697825329981f29a356e1713697559838.png)\n\næœ€åç‚¹å‡»finishï¼Œè¿”å›wiresharkå®‰è£…ç•Œé¢\n\nå•¥ä¹Ÿä¸é€‰ï¼Œç‚¹å‡»finish\n\n![image-20241203172223040](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/55c12a84c792a7f4f47e0a86fa801617697559838.png)\n\n## å®‰è£…VirtualBox\n\nåŒå‡»å®‰è£…åŒ…æ‰“å¼€ï¼Œä¸€ç›´ä¸‹ä¸€æ­¥ï¼Œåˆ°è¿™ï¼Œä¿æŒé»˜è®¤ï¼Œç»§ç»­ä¸‹ä¸€æ­¥<font color='red'>ï¼ˆè‡ªè¡Œé€‰æ‹©å®‰è£…è·¯å¾„ï¼Œä¹Ÿå¯ä»¥é»˜è®¤ï¼‰</font>\n\n![image-20241203172517015](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/ac77030dc58ca8b825272cf988a1a101697559838.png)\n\n![image-20241203172554183](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/c95708108bdb65a7783d0f67ffdfc03b697559838.png)\n\n![image-20241203172603260](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/4c83f8903f39350c6cf0d4dd4e7a0fbf697559838.png)\n\nç„¶åç‚¹å‡»å®‰è£…åˆ°è¿™\n\n![image-20241203172618811](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/2cd27f0028dc3ffb0ad6691fc7fd4ca4697559838.png)\n\n![image-20241203172633234](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/202b9840a5bd7f42f7cf3c68d2e8599a697559838.png)\n\n![image-20241203172653003](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/ef82bb16ba5f586c10b9ae1b918343f8697559838.png)\n\n![image-20241203172706558](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/408fc2de78aebdcd1b4f56e76e10de7e697559838.png)\n\n## å®‰è£…ensp\n\n![image-20241203172734710](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/0a807069ff5eb210324a13d80b0dfd98697559838.png)\n\n![image-20241203172819522](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/407464c59d82bd07cfbca76977b6ae1a697559838.png)\n\n![image-20241203172835791](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/c8db7f418347183a82ce800c7060cab7697559838.png)\n\n![image-20241203172910954](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/14ccb131956bed02d3b737bc05fb0915697559838.png)\n\nç„¶åä¸€ç›´ä¸‹ä¸€æ­¥ï¼Œå®‰è£…å³å¯\n\n![image-20241203173017563](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/6e20a84905fd08e69477d5bca190c395697559838.png)\n\n## æ‰“å¼€ensp\n\n![image-20241203173104621](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/1cfd3eeadc3f24829d853e5cda7015c7697559838.png)\n\n![image-20241203173125141](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/834005ebe3fecadfda62227b8b8305ea697559838.png)\n\næœ‰æŠ¥é”™äº†ï¼Œå¯åŠ¨ä¸€ä¸ªAR\n\n![image-20250316174953299](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/ef9ff3d7fefea5c96ca9c6f223ce030a697559838.png)\n\n![image-20241203173318129](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/9cb5e2cb92113f2149c8c480de188cde697559838.png)\n\nå› ä¸ºåˆšåˆšå®‰è£…VirtualBoxæœ€åæ²¡æœ‰é‡å¯ç”µè„‘ï¼Œä½ `é‡å¯ä¸€ä¸‹ç”µè„‘`å°±è¡Œäº†\n\nè¦ç¡®ä¿æ˜¯è¿™ä¸ªåœ°å€\n\n![image-20241203173633633](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/dea4d80b355a0cb41aadba8717596a16697559838.png)\n\nç„¶åä½ å†å»å¯åŠ¨å°±å¯ä»¥å¯åŠ¨äº†\n\n\n\nå¦‚æœè¿˜æ˜¯`ä¸è¡Œ`ï¼ŒARè·¯ç”±å™¨è¿˜æ˜¯å¯åŠ¨ä¸äº†ï¼Œä½ æ‰æ‰§è¡Œä¸‹é¢çš„æ“ä½œ\n\næŒ‰`winé”®`æœç´¢`è¿è¡Œ`è¾“å…¥regedit\n\n![image-20250316174447550](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/7ce123a68ab56fcb54fe80203ac03a20697559838.png)\n\nä½ ç›´æ¥å¯¼èˆªåˆ°\n\n```\nè®¡ç®—æœº\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VBoxDrv\n```\n\nå°†Startçš„å€¼æ”¹æˆ3ï¼Œç„¶åé‡å¯ç”µè„‘\n\n![image-20250316174742089](../img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/e6e92cd9760a698eb433d03bebeb9869697559838.png)\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["eNSP"],"categories":["ç½‘ç»œ"]},{"title":"SambaæœåŠ¡å™¨å®æˆ˜","url":"/posts/a8a56b19/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# SambaæœåŠ¡å™¨å®æˆ˜\n\nSambaæ˜¯åœ¨Linuxå’ŒUNIXç³»ç»Ÿä¸Šå®ç°SMBåè®®çš„ä¸€ä¸ªå…è´¹è½¯ä»¶ï¼Œç”±æœåŠ¡å™¨åŠå®¢æˆ·ç«¯ç¨‹åºæ„æˆã€‚SMBï¼ˆServer Messages Blockï¼Œä¿¡æ¯æœåŠ¡å—ï¼‰æ˜¯ä¸€ç§åœ¨å±€åŸŸç½‘ä¸Šå…±äº«æ–‡ä»¶å’Œæ‰“å°æœºçš„ä¸€ç§é€šä¿¡åè®®ï¼Œå®ƒä¸ºå±€åŸŸç½‘å†…çš„ä¸åŒè®¡ç®—æœºä¹‹é—´æä¾›æ–‡ä»¶åŠæ‰“å°æœºç­‰èµ„æºçš„å…±äº«æœåŠ¡ã€‚SMBåè®®æ˜¯å®¢æˆ·æœº/æœåŠ¡å™¨å‹åè®®ï¼Œå®¢æˆ·æœºé€šè¿‡è¯¥åè®®å¯ä»¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„å…±äº«æ–‡ä»¶ç³»ç»Ÿã€æ‰“å°æœºåŠå…¶ä»–èµ„æºã€‚é€šè¿‡è®¾ç½®â€œNetBIOS over TCP/IPâ€ä½¿å¾—Sambaä¸ä½†èƒ½ä¸å±€åŸŸç½‘ç»œä¸»æœºåˆ†äº«èµ„æºï¼Œè¿˜èƒ½ä¸å…¨ä¸–ç•Œçš„ç”µè„‘åˆ†äº«èµ„æºã€‚\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå   | os                | ip             | å†…å­˜ | ç¡¬ç›˜ |\n| -------- | ----------------- | -------------- | ---- | ---- |\n| qianyios | Openeuler22.03LTS | 192.168.48.101 | 2G   | 100G |\n\n## å®‰è£…Samba\n\n```bash\ndnf  install -y samba\n#å…³é—­é˜²ç«å¢™\nsystemctl disable firewalld &> /dev/null\nsystemctl stop firewalld\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n```\n\n## Sambaå…±äº«æœåŠ¡çš„åŒ¿åè®¿é—®\n\n### é…ç½®æ–‡ä»¶\n\nsambaæœåŠ¡å™¨æœ€ä¸»è¦çš„é…ç½®æ–‡ä»¶å…¶å®åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯/etc/samba/samb.confï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªéƒ¨åˆ†æ˜¯å…¨å±€å‚æ•°ï¼Œä¸€éƒ¨åˆ†æ˜¯å…±äº«èµ„æºç›¸å…³å‚æ•°ã€‚\n\n```\nvim /etc/samba/smb.conf\n```\n\nå…ˆå–æ¶ˆ[homes]ã€[printers]çš„é¡¹ç›®ï¼Œæ·»åŠ [share]é¡¹ç›®å¦‚ä¸‹\n\n```bash\n[global]\n        #ä¸ä¸»æœºåç›¸å…³çš„è®¾ç½®\n        #å·¥ä½œç»„åç§°\n        workgroup = SAMBA\n        security = user\n        passdb backend = tdbsam\n        printing = cups\n        printcap name = cups\n        load printers = yes\n        cups options = raw\n        ##æ·»åŠ æ­¤é¡¹ï¼Œå¼€å¯åŒ¿åç”¨æˆ·è®¿é—®\n        map to guest = Bad User\n        include = /etc/samba/usershares.conf\n[share]\n\t#è®¾ç½®å…±äº«è·¯å¾„\n        path = /abc \n        ##å…¬å…±è®¿é—®\n\t public=yes\n\t ##èƒ½å¤Ÿè®¿é—®\n        browseable=yes\n        ##å†™æƒé™\n        writable=yes\n        ##è®¾ç½®æƒé™\n        create mask=0644\n        directory mask=0755\n```\n\n### åˆ›å»ºå…±äº«è·¯å¾„ï¼Œå¹¶ç»™æƒé™\n\n```bash\nmkdir /abc\nchmod 777 /abc\nsystemctl enable --now smb.service\n#linuxåˆ›å»ºæµ‹è¯•æ–‡ä»¶,å®¢æˆ·ç«¯æŸ¥çœ‹\necho \"text\" >> /abc/test.txt\n```\n\næ–‡ä»¶å¤¹åœ°å€æ è¾“å…¥\\\\192.168.48.101\\share,ä»–ä¼šæç¤ºä½ è¾“å…¥ç”¨æˆ·å’Œå¯†ç ï¼Œç”¨æˆ·åæ˜¯nobodyï¼Œå¯†ç ä¸ç”¨è¾“ï¼Œç„¶åå°±å®¢æˆ·ç«¯å°±å¯ä»¥çœ‹è§linuxåˆ›å»ºçš„æµ‹è¯•æ–‡ä»¶\n\n![image-20241127103444665](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/94bce6da82dfd0554d7247c17b83883d697559838-1732698207215-37.png)\n\nå®¢æˆ·ç«¯åˆ›å»ºæ–‡ä»¶å¤¹ï¼ŒlinuxæŸ¥çœ‹\n\n![image-20241127103714433](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/de470210d7e0c0e0672fc033642f2132697559838-1732698207215-38.png)\n\n![image-20241127103729198](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/3c56d0e57aef146c93f28b0c72f479b7697559838-1732698207215-39.png)\n\n## Sambaå…±äº«æœåŠ¡çš„ç”¨æˆ·èº«ä»½éªŒè¯\n\n### é…ç½®æ–‡ä»¶\n\n```\nvim /etc/samba/smb.conf\n```\n\n```bash\n[global]\n        #ä¸ä¸»æœºåç›¸å…³çš„è®¾ç½®\n        #å·¥ä½œç»„åç§°\n        workgroup = SAMBA\n        security = user\n        passdb backend = tdbsam\n        printing = cups\n        printcap name = cups\n        load printers = yes\n        cups options = raw\n        ##æ·»åŠ æ­¤é¡¹ï¼Œå¼€å¯åŒ¿åç”¨æˆ·è®¿é—®\n       ## map to guest = Bad User   #ï¼ˆåˆ é™¤åŒ¿åè®¿é—®ï¼‰\n        include = /etc/samba/usershares.conf\n[share]\n\t#è®¾ç½®å…±äº«è·¯å¾„\n        path = /abc\n        ##å…¬å…±è®¿é—®\n        # public=yes   #ï¼ˆåˆ é™¤å…¬å…±è®¿é—®ï¼‰\n         ##èƒ½å¤Ÿè®¿é—®\n        browseable=yes\n        ##å†™æƒé™\n        #writable=yes  #ï¼ˆåˆ é™¤å†™å…¥æƒé™ï¼‰\n        ##è®¾ç½®æƒé™\n        create mask=0644\n        directory mask=0755\n        ##å…è®¸è®¿é—®çš„ç”¨æˆ·\n        valid users=qianyios, qianyios1\n        ##å…è®¸å†™å…¥çš„ç”¨æˆ·\n        write list=qianyios\n```\n\n### åˆ›å»ºsmbç”¨æˆ·\n\n```bash\nuseradd qianyios\nuseradd qianyios1\nsmbpasswd -a qianyios\n#æœ‰ä»¥ä¸‹æç¤º\nNew SMB password:    ##è®¾ç½®å¯†ç \nRetype new SMB password:   ##ç¡®è®¤å¯†ç \nAdded user qianyios.\n#qianyios1ä¹Ÿæ˜¯è¿™æ ·çš„æ“ä½œ\nsmbpasswd -a qianyios1\n```\n\n![image-20241127104829402](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/c8c2d257064d8e75cd91d4ed99bb5f1a697559838-1732698207216-40.png)\n\nåˆ—å‡ºsmbç”¨æˆ·åˆ—è¡¨\n\n```\npdbedit -L\n```\n\n![image-20241127104533486](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/c02eec4ab5bdde5310baad610570a1a9697559838-1732698207216-41.png)\n\n```bash\n#é‡å¯\nsystemctl restart smb.service \n```\n\nç”¨linuxçš„smbå®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•\n\n```\ndnf install -y samba-client\n```\n\n![image-20241127110308605](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/308dd394ef1734fbd888f0f2be759431697559838-1732698207216-42.png)\n\n![image-20241127110418511](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/0de632c049d81127f434ddb27f14d629697559838-1732698207216-43.png)\n\nåˆšå¥½æ ¹æ®å‰é¢çš„é…ç½®æ–‡ä»¶\n\n```bash\n##å…è®¸è®¿é—®çš„ç”¨æˆ·\nvalid users=qianyios, qianyios1\n##å…è®¸å†™å…¥çš„ç”¨æˆ·\nwrite list=qianyios\n```\n\nqianyioså¯åˆ›å»ºæ–‡ä»¶qianyios1ä¸å¯ä»¥åˆ›å»ºï¼Œä½†æ˜¯å¯ä»¥è¯»å–æ–‡ä»¶\n\n### windowså®¢æˆ·çš„æµ‹è¯•\n\nç”±äºä¹‹å‰åšåŒ¿åæµ‹è¯•è¿æ¥\n\nè¦åœ¨cmdæ¸…ç†ç½‘ç»œé©±åŠ¨å™¨ç¼“å­˜\n\n```\nnet use * /del\n```\n\n![image-20241127110815836](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/f931c126ff59ec70ac108644a8c41cc1697559838-1732698207216-44.png)\n\n![image-20241127110903495](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/1e64aa6ffe7cb63b8c602e4349df21d6697559838-1732698207216-45.png)\n\nåœ¨qianyiosç”¨æˆ·ä¸‹å¯ä»¥åˆ›å»ºæ–‡ä»¶å¤¹\n\n![image-20241127110927236](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/cd1cbca8829c9780740fe38c9394ab3f697559838-1732698207216-46.png)\n\nç”¨qianyios1è¯•ä¸€ä¸‹\n\n![image-20241127111029950](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/ed497502d42661ac546f8c6dd19f3d1e697559838-1732698207216-47.png)\n\nå¯æŸ¥çœ‹æ–‡ä»¶ä½†ä¸èƒ½åˆ›å»ºæ–‡ä»¶\n\n![image-20241127111102850](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/44aa217c0cbeadb5db805527ac933d16697559838-1732698207216-48.png)\n\n## Sambaå…±äº«æœåŠ¡çš„è´¦æˆ·åæ˜ å°„ï¼ˆè´¦æˆ·åˆ«åç™»å½•ï¼‰\n\n### é…ç½®æ˜ å°„æ–‡ä»¶å’ŒSambaé…ç½®æ–‡ä»¶\n\n```\ncat > /etc/samba/smbusers <<\"EOF\"\nqianyios = qyos\nqianyios1 = qyos1\nEOF\n```\n\n```bash\nvim /etc/samba/smb.conf\n\n#æ·»åŠ ä»¥ä¸‹å†…å®¹åœ¨å¯¹åº”ä½ç½®\nusername map = /etc/samba/smbusers\n```\n\n![image-20241127143636914](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/87dccb8046521751a8fb4c6a1fece7dc697559838-1732698207216-49.png)\n\né‡å¯æœåŠ¡\n\n```\n systemctl restart smb.service\n```\n\n### windowså®¢æˆ·ç«¯æµ‹è¯•\n\ncmdæ¸…ç†ç¼“å­˜\n\n```\nnet use * /del\n```\n\n![image-20241127144418512](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/50fcf31a611d893cfbefb76405830281697559838-1732698207216-50.png)\n\nqyoså¯ä»¥ç™»å…¥\n\n![image-20241127144427418](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/ac5da9c652a080898de1f9fe10b2d610697559838-1732698207216-51.png)\n\nqyos1ä¹Ÿå¯ä»¥ç™»å…¥\n\n![image-20241127144805385](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/b37c230b24ec42f47308b03457c3e726697559838-1732698207216-52.png)\n\n## Sambaå…±äº«æœåŠ¡çš„è®¿é—®æ§åˆ¶åˆ—è¡¨\n\nç¦æ­¢æŸä¸ªç½‘æ®µè®¿é—®\n\nhosts deny=192.168.48.  ##æ·»åŠ æ‹’ç»192.168.48æ®µè®¿é—®share\n\næˆ–è€…å¦‚æœä½ æƒ³å…è®¸é™¤äº†192.168.48.0/24ä¹‹å¤–çš„æ‰€æœ‰ä¸»æœºè®¿é—®ï¼š\n\nhosts allow = ALL EXCEPT 192.168.48.\n\n```\nvim /etc/samba/smb.conf\n```\n\n```bash\n[share]\n        #è®¾ç½®å…±äº«è·¯å¾„\n        path = /abc\n        ##å…¬å…±è®¿é—®\n        # public=yes   #ï¼ˆåˆ é™¤å…¬å…±è®¿é—®ï¼‰\n         ##èƒ½å¤Ÿè®¿é—®\n        browseable=yes\n        ##å†™æƒé™\n        #writable=yes  #ï¼ˆåˆ é™¤å†™å…¥æƒé™ï¼‰\n        ##è®¾ç½®æƒé™\n        create mask=0644\n        directory mask=0755\n        ##å…è®¸è®¿é—®çš„ç”¨æˆ·\n        valid users=qianyios,qianyios1\n        ##å…è®¸å†™å…¥çš„ç”¨æˆ·\n        write list=qianyios\n        ##æ·»åŠ æ‹’ç»192.168.48æ®µè®¿é—®share\n\t hosts deny=192.168.48.  \n```\n\n```bash\n##é‡å¯SambaæœåŠ¡\nsystemctl restart smb.service  \n```\n\nwindowså°±ä¸æµ‹è¯•äº†ç”¨linuxçš„smbå®¢æˆ·ç«¯æ¥æµ‹è¯•ä¸€ä¸‹\n\n```\nsmbclient //192.168.48.101/share -U qyos\n```\n\n![image-20241127164357033](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/021707c6b725ec020e7985e8d6836995697559838-1732698207216-53.png)\n\næˆ‘ä»¬æœ¬æœºæ˜¯192.168.48.101çš„ï¼Œå› ä¸ºç¦ç”¨äº†192.168.48.0/24çš„ç½‘æ®µè®¿é—®ï¼Œæ‰€ä»¥éƒ½è®¿é—®ä¸äº†\n\n## å°†sambaæŒ‚è½½åˆ°linuxä½¿ç”¨\n\nè®°å¾—å–æ¶ˆçš„ç¦æ­¢è®¿é—®å“¦\n\n```bash\n#åˆ›å»ºæŒ‚è½½ç‚¹\nmkdir -p /opt/share\n#å®‰è£…é™„å±\nyum install cifs-utils  -y\n#å°†å…±äº«æ–‡ä»¶å¤¹æŒ‚è½½åˆ°æŒ‚è½½ç‚¹\nmount.cifs //192.168.48.101/share /opt/share -o username=qianyios\ndf -h\nls /opt/share\n```\n\n![image-20241127165315328](../img/Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98/2b8fad94cb15fa94683165f81211fa61697559838-1732698207216-54.png)\n\nå·²æŒ‚è½½æˆåŠŸ\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Samba"],"categories":["è¿ç»´"]},{"title":"OpenEuler22.03 LTSéƒ¨ç½²Zabbix","url":"/posts/1ca7aa3d/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# OpenEuler22.03 LTSéƒ¨ç½²Zabbix\n\nä»¥ä¸‹æ–‡æ¡£éƒ¨åˆ†å‚è€ƒï¼š[Zabbix 6.2 å®‰è£…ï¼šå›½äº§ç³»ç»Ÿç¯‡ï¼ˆOpenEulerï¼‰-zabbix 5.0å®‰è£…](https://www.51cto.com/article/722701.html)\n\n## ä¸»æœºæ‹“æ‰‘å›¾\n\n| ä¸»æœºå        | ip             | ç¡¬ç›˜ | cpu  | å¤‡æ³¨   |\n| ------------- | -------------- | ---- | ---- | ------ |\n| zabbix-server | 192.168.48.101 | 100g | 2v   | ä¸»æ§   |\n| zabbix-agent  | 192.168.48.102 | 100g | 2v   | æµ‹è¯•æœº |\n\n## åŸºç¡€é…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[server]\n\nä¸è¦ä¸€è‚¡è„‘çš„å¤åˆ¶ï¼Œæ³¨æ„ä¿®æ”¹ç½‘å¡çš„åå­—ï¼Œæˆ‘è¿™é‡Œæ˜¯ens33ï¼ŒåŒ…æ‹¬ä¿®æ”¹ipæ®µï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯`192.168.48.`ä½ å°±è¦ä¿®æ”¹æˆä½ çš„`172.8.3.`æœ€åé‚£ä¸€ä¸ªä¸»æœºä½å°±ä¸ç”¨ç®¡ï¼Œå…¶ä»–ä¸å˜\n\n```bash\nvi system_init.sh\n```\n\n```shell\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\necho \"2.æ­£åœ¨å…³é—­firewalldã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl stop firewalld\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nNAME=ens33\nUUID=53b402ff-5865-47dd-a853-7afcd6521738\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS1=192.168.48.2\nDNS2=114.114.114.114\nEOF\nnmcli c reload\nnmcli c up ens33\n\n\necho \"4.æ–°å¢åä¸ºäº‘æº\"\nmkdir /etc/yum.repos.d/bak/\ncp /etc/yum.repos.d/* /etc/yum.repos.d/bak/\nsleep 3\n#åˆ‡æ¢ä¸ºåä¸ºäº‘ï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿«\nsed -i 's/\\$basearch/x86_64/g' /etc/yum.repos.d/openEuler.repo\nsed -i 's/http\\:\\/\\/repo.openeuler.org/https\\:\\/\\/mirrors.huaweicloud.com\\/openeuler/g' /etc/yum.repos.d/openEuler.repo\n\necho \"5.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\n yum clean all && yum makecache\n\necho \"6.æ·»åŠ hostsè§£æ\"\ncat > /etc/hosts <<EOF\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.101 zabbix-server\n192.168.48.102 zabbix-agent\nEOF\n\necho \"7.å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\"\nyum install chrony -y\nsystemctl enable chronyd --now\ntimedatectl set-timezone Asia/Shanghai\ntimedatectl set-local-rtc 1\ntimedatectl set-ntp yes\nchronyc -a makestep\nchronyc tracking\nchronyc sources\n\necho \"8.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet socat device-mapper-persistent-data lvm2 git gcc -y\n\necho \"9.é‡å¯\"\nreboot\n\n```\n\nè¿è¡Œ\n\n```bash\nsh system_init.sh ä¸»æœºå  ä¸»æœºä½\n\n[zabbix-server] sh system_init.sh zabbix-server 101\n\n[zabbix-agent] sh system_init.sh zabbix-agent 102\n\n```\n\n## zabbix-serverå®‰è£…\n\n### zabbixæœåŠ¡æ®µå®‰è£…\n\næ“ä½œèŠ‚ç‚¹ï¼š[server]\n\n```bash\n#åˆ›å»ºzabbixç”¨æˆ·\ngroupadd --system zabbix\nuseradd --system -g zabbix -d /usr/lib/zabbix -s /sbin/nologin -c \"Zabbix Monitoring System\" zabbix\n#åˆ›å»ºzabbixå®‰è£…ç›®å½•\nmkdir -p /app/zabbix\n```\n\n[ä¸‹è½½ Zabbix æºç ](https://www.zabbix.com/download_sources)\n\n![image-20241113000651160](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/49a030b3bf3a051bf26a6bdcbe1f64e255933597.png)\n\n```bash\n#serverç«¯ä¸‹è½½æºç åŒ…,ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ä¸Šä¼ åˆ°è™šæ‹Ÿæœºå³å¯ï¼Œæˆ‘æ˜¯æ”¾åˆ°äº†rootç›®å½•ä¸‹\nwget https://cdn.zabbix.com/zabbix/sources/stable/7.0/zabbix-7.0.5.tar.gz\ntar -zxvf zabbix-7.*.tar.gz\n```\n\nå¼€å§‹ç¼–è¯‘å®‰è£…\n\n- `prefix` æŒ‡å®šå®‰è£…ç›®å½•ã€‚\n- `enable-server` å¯ç”¨ Zabbix Serverã€‚\n- `enable-agent` å¯ç”¨ Zabbix agentã€‚\n- `with-mysql` åç«¯æŒ‡å®šæ•°æ®åº“ä¸ºmysqlã€‚\n- `net-snmp` æ”¯æŒ snmp åè®®ã€‚\n\nå…¶å®è¿˜æœ‰å¾ˆå¤šå‚æ•°,å¤§å®¶å¯ä»¥å‚è€ƒ ./configure --help è‡ªè¡Œç ”ç©¶ ï¼Œå®˜æ–¹æ–‡æ¡£é‡Œä¹Ÿæœ‰æ¡ˆä¾‹\n\n```bash\n#å®‰è£…éœ€è¦çš„ç»„ä»¶\ndnf -y install mysql-devel libevent-devel pcre-devel\n#å¼€å§‹ç¼–è¯‘ï¼ˆ/app/zabbixï¼‰æ˜¯zabbixçš„å®‰è£…ç›®å½•ï¼Œä»¥ä¸‹ç¼–è¯‘ä¼šå®‰è£…åœ¨/app/zabbix\nmv zabbix-7.0.5 zabbix && cd zabbix\n./configure --prefix=/app/zabbix --enable-server --enable-agent --with-mysql\n```\n\nå‡ºç°è¿™ä¸ªé¡µé¢æ˜¯ç¼–è¯‘å®Œæˆ\n\n![image-20241113003302745](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/947a7ccd94bea32563c823c2f6d8513b55933597.png)\n\n```bash\n#å¼€å§‹å®‰è£…\nmake && make install\n#å®‰è£…å®Œæˆï¼\n```\n\n![image-20241113003537003](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/5257a198e548d997c7fd18a99a686fd055933597.png)\n\næ•´ä½“ç›®å½•æƒ…å†µ\n\n![image-20241113003611525](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/dfe08330e50249db5901faf896e6589d55933597.png)\n\n### PHPéƒ¨åˆ†\n\nopenEuler 22.04 è‡ªå¸¦8.0ç‰ˆæœ¬ï¼Œæ‰€ä»¥ç¬¦åˆ6.0ä»¥ä¸Šç‰ˆæœ¬çš„éœ€æ±‚ã€‚\n\n![image-20241113003920331](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/65f8f2a540a55dbe58769fe925df07e355933597.png)\n\n```bash\ndnf -y install php php-fpm\n```\n\n### Apache\n\nç”±äºå®‰è£…PHPä¼šè‡ªåŠ¨å®‰è£…apacheï¼ˆhttpdï¼‰æœåŠ¡ï¼Œæ‰€ä»¥å®‰è£…è¿‡ç¨‹å¹¶æœªæåŠapacheçš„å®‰è£…è¿‡ç¨‹\n\nç°åœ¨ç§»åŠ¨zabbixå‰ç«¯ç½‘é¡µæ–‡ä»¶åˆ°/var/http/htmlï¼ˆè¿™æ˜¯apacheç½‘é¡µçš„è¿è¡Œæ ¹ç›®å½•æ–‡ä»¶ï¼‰\n\n```bash\n[root@zabbix-sever zabbix]# pwd\n/root/zabbix\n#æˆ‘ç°åœ¨/root/zabbixæ˜¯åˆšåˆšè§£å‹æºç åŒ…çš„åœ°æ–¹ï¼Œåˆ«èµ°é”™äº†ï¼Œçœ‹ä½ çš„ä½ç½®åœ¨å“ª\ncd /root/zabbix\n#è¿™ä¸ªå‘½ä»¤ä¼šé€’å½’åœ°å¤åˆ¶ ui ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å­ç›®å½•å’Œæ–‡ä»¶ï¼Œåˆ° /var/www/html/ ç›®å½•ä¸­å¹¶ä¸”ä¿ç•™æ–‡ä»¶çš„æƒé™å’Œå±æ€§\ncp -rp ui/* /var/www/html/\n#å¯åŠ¨apache\nsystemctl start httpd && systemctl enable httpd\nsystemctl start php-fpm && systemctl enable php-fpm\n```\n\nè®¿é—®192.168.48.101\n\né€‰æ‹©ä¸­æ–‡\n\n![image-20241113004815682](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/ad59308fa51e608b7ba3d4102cc050cd55933597.png)\n\nè¿™é‡Œæ˜¾ç¤ºæœ‰äº›phpæ‰©å±•æ²¡ä¸‹è½½ç­‰\n\n![image-20241113004839965](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/d027395f9a7ea2887fd98ed3866170a155933597.png)\n\n```\ndnf -y install php-gd php-mysqlnd php-bcmath php-xml php-mbstring\n```\n\nå®‰è£…å®Œä¾èµ–æ­¤æ—¶ä¸éœ€è¦é‡å¯ä»»ä½•æœåŠ¡ï¼Œæ¥ä¸‹æ¥è°ƒæ•´PHPçš„é…ç½®æ–‡ä»¶ã€‚\n\næ ¹æ®æŠ¥é”™æ¥è°ƒæ•´ä¸‰ä¸ªå€¼åˆ†åˆ«æ˜¯ `post_max_size`,`max_execution_time`,`max_input_time`ã€‚\n\n- æ‰€è¦æ±‚çš„æœ€å°PHP postå¤§å°æ˜¯16M (é…ç½®é¡¹\"post_max_size\")ã€‚\n- æ‰€è¦æ±‚çš„æœ€å°PHPè„šæœ¬æ‰§è¡Œæ—¶é—´æ˜¯300 (é…ç½®é¡¹ \"max_execution_time\")ã€‚\n- æ‰€è¦æ±‚çš„PHPè„šæœ¬æœ€å°è§£ææ—¶é—´æ˜¯300 (é…ç½®é¡¹\"max_input_time\")ã€‚\n\n```bash\n#ä¸€é”®ä¿®æ”¹å‘½ä»¤\nsed -i 's/post_max_size = 8M/post_max_size = 16M/g' /etc/php.ini\nsed -i 's/max_execution_time = 30/max_execution_time = 300/g' /etc/php.ini\nsed -i 's/max_input_time = 60/max_input_time = 300/g' /etc/php.ini\n```\n\næ”¹å®Œä¹‹åéœ€è¦é‡å¯php-fpmæœåŠ¡ã€‚\n\n```\nsystemctl restart php-fpm\n```\n\nåˆ·æ–°é¡µé¢å°±okäº†\n\n![image-20241113005733127](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/042bd7ef89e62f03bf6df00e095e972855933597.png)\n\n### å®‰è£…mysql\n\n#### å®‰è£…mysql\n\n```bash\ndnf -y install mysql-server\nsystemctl start mysqld && systemctl enable mysqld\nmysql_secure_installation\n\n#æç¤ºä¿¡æ¯ï¼šVALIDATE PASSWORD COMPONENT can be u Â·Â·Â·Â·Â· gh. Would you like to setup VALIDATE PASSWORD component?\n#éªŒè¯å¯†ç ç»„ä»¶å¯ç”¨äºæµ‹è¯•å¯†ç å’Œæé«˜å®‰å…¨æ€§ã€‚å®ƒæ£€æŸ¥å¯†ç çš„å¼ºåº¦ï¼Œå¹¶å…è®¸ç”¨æˆ·åªè®¾ç½®é‚£äº›è¶³å¤Ÿå®‰å…¨çš„å¯†ç ã€‚è¦è®¾ç½®VALIDATE PASSWORDç»„ä»¶å—ï¼Ÿ\nPress y|Y for Yes, any other key for No: NO (å¡«NO)\nNew password: \nRe-enter new password:\n#è¾“å…¥ä½ çš„ç§˜å¯†ï¼Œæˆ‘è¿™é‡Œæ˜¯qianyios007\n#æ˜¯å¦åˆ é™¤åŒ¿åç”¨æˆ·\nRemove anonymous users?  (Press y|Y for Yes, any other key for No) : Y\n#æ˜¯å¦ç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•\nDisallow root login remotely? (Press y|Y for Yes, any other key for No) : No\n#æ˜¯å¦åˆ é™¤æµ‹è¯•æ•°æ®åº“ï¼Ÿ\nRemove test database and access to it? (Press y|Y for Yes, any other key for No) : Y\n#æ˜¯å¦é‡æ–°åŠ è½½ç‰¹æƒè¡¨å—ï¼Ÿ\nReload privilege tables now?  (Press y|Y for Yes, any other key for No) : Y\n\n# éªŒè¯ç™»å…¥æ•°æ®åº“\nmysql -u root -pqianyios007\n\n```\n\n![image-20241113002206219](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/bc5f63fe3e98602ca6b7b5f91c7d80fe55933597.png)\n\n#### åˆ›å»ºZabbixæ‰€éœ€è¦çš„æ•°æ®åº“å’Œç”¨æˆ·\n\n```bash\nmysql -u root -pqianyios007\n#åˆ›å»ºä¸€ä¸ªåä¸ºzabbixçš„æ–°æ•°æ®åº“ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸ºutf8mb4ï¼Œæ’åºè§„åˆ™ä¸ºutf8mb4_binã€‚\ncreate database zabbix character set utf8mb4 collate utf8mb4_bin;\n#åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·zabbixï¼Œè¯¥ç”¨æˆ·åªèƒ½ä»localhostè¿æ¥ï¼Œå¯†ç è®¾ç½®ä¸º123456ã€‚\ncreate user zabbix@localhost identified by '123456';\n#æˆäºˆzabbixç”¨æˆ·å¯¹zabbixæ•°æ®åº“çš„æ‰€æœ‰è¡¨çš„æ‰€æœ‰æƒé™ã€‚\ngrant all privileges on zabbix.* to zabbix@localhost;\n#è®¾ç½®å…¨å±€å˜é‡log_bin_trust_function_creatorsä¸º1ï¼Œè¿™å…è®¸åˆ›å»ºå­˜å‚¨å‡½æ•°æ—¶ä¸å—äºŒè¿›åˆ¶æ—¥å¿—çš„é™åˆ¶\nset global log_bin_trust_function_creators = 1;\nquit;\n```\n\n#### å¯¼å…¥Zbbix çš„æ•°æ®æ–‡ä»¶\n\n```bash\ncd /root/zabbix\ncat database/mysql/schema.sql | mysql -uzabbix -p123456 zabbix\ncat database/mysql/images.sql | mysql -uzabbix -p123456 zabbix\ncat database/mysql/data.sql | mysql -uzabbix -p123456 zabbix\nmysql -u root -pqianyios007\n#ç›¸å…³æ•°æ®å¯¼å…¥å®Œæˆåå…³æ‰log_bin_trust_function_creatorsåŠŸèƒ½ã€‚\nset global log_bin_trust_function_creators = 0;\nquit;\n```\n\nå®Œæˆè¿™éƒ¨åˆ†ï¼Œå°±å¯ä»¥åœ¨å‰ç«¯è¿›å…¥æ•°æ®åº“é…é…ç½®ç•Œé¢ã€‚\n\n![image-20241113011128139](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/ab5ba4a44f0a35fd34f04be13e5e0d7955933597.png)\n\n![image-20241113011239994](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/73aeb632f7ed517bab752da75d11706a55933597.png)\n\n![image-20241113011250313](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/b236034d98b75d19563d32c44a8022f555933597.png)\n\næŠ¥é”™äº†ï¼Œæ­¤æ—¶ä¼šå‡ºç°æ— æ³•åˆ›å»ºï¼Œè¿™æ˜¯ç”±äºç›®æ ‡ç›®å½•æ²¡æœ‰æƒé™å¯¼è‡´çš„ï¼Œå¯ä»¥ç‚¹å‡»<font color='cornflowerblue'>è“è‰²å­—ä½“(ç½‘é¡µä¸­ä¸‹è½½é…ç½®æ–‡ä»¶)</font>å°†é…ç½®å¾—å¥½çš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åä¼ åˆ°å‰ç«¯æç¤ºçš„ç›®å½•é‡Œï¼Œè¯¥æ–‡è¿™é‡Œè·¯å¾„ä¸ºï¼š\n\n```\n/var/www/html/conf/\n```\n\n![image-20241113011413414](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/b47c8262ee60d1dc80860c4deae796fe55933597.png)\n\nè‡ªè¡Œä¸‹è½½ç”¨å·¥å…·ä¼ è¿‡å»å³å¯\n\n![image-20241113011854494](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/6e84e5ae52509a8f01279aa523251dd355933597.png)\n\næ”¾è¿‡å»ä¹‹ååˆ·æ–°å³å¯\n\n> <font color='red'>ç®¡ç†å‘˜ç”¨æˆ·åå¯†ç ä¸ºAdmin/zabbix</font>\n\n![image-20241113012114792](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/182897f98cbd0dc652868b0158b703b255933597.png)\n\næœåŠ¡ç«¯å®‰è£…æˆåŠŸ!\n\n![image-20241113012126819](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/8640ed2d6b5405dbfb48e3d1a38341d355933597.png)\n\n### zabbix-serveråŸºæœ¬é…ç½®\n\nè¿™é‡Œå¯ä»¥çœ‹å§serverç«¯æ˜¯æ²¡æœ‰å¯åŠ¨çš„ï¼Œè¯´æ˜è¦å¯¹äºä»–è¿›è¡Œé…ç½®\n\n![image-20241113082126854](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/d0b1b11c6596b52a2c5b5995cf62985955933597.png)\n\né¦–å…ˆæ¥è¯´è¯´zabbix server ç›®å½•çš„ä¸€äº›æƒ…å†µ\n\n- ç¨‹åºæ–‡ä»¶è·¯å¾„ä¸º/app/zabbix/sbin/\n- é…ç½®æ–‡ä»¶è·¯å¾„ä¸º/app/zabbix/etc/\n\n1. ç¼–è¾‘é…ç½®æ–‡ä»¶\n\n```yaml\nsed -i 's|^LogFile=.*|LogFile=/var/log/zabbix/zabbix_server.log|' /app/zabbix/etc/zabbix_server.conf\nsed -i '/^# DBPassword=/a \\  DBPassword=123456' /app/zabbix/etc/zabbix_server.conf\nsed -i '/^# PidFile=\\/tmp\\/zabbix_server.pid$/a \\  PidFile=/var/log/zabbix/zabbix_server.pid' /app/zabbix/etc/zabbix_server.conf\n```\n\n2. åˆ¶ä½œzabbix serverå®ˆæŠ¤æ–‡ä»¶\n\n```bash\ncat > /usr/lib/systemd/system/zabbix-server.service <<\"EOF\"\n[Unit]\nDescription=Zabbix Server\nAfter=syslog.target\nAfter=network.target\nAfter=postgresql.service\nAfter=pgbouncer.service\nAfter=postgresql-13.service\n\n[Service]\nEnvironment=\"CONFFILE=/app/zabbix/etc/zabbix_server.conf\"\nEnvironmentFile=-/etc/sysconfig/zabbix-server\nType=forking\nRestart=on-failure\n#pidæ–‡ä»¶è¦æ”¹å“¦ï¼Œçœ‹ä½ åœ¨å“ªä¸ªä½ç½®\nPIDFile=/var/log/zabbix/zabbix_server.pid\nKillMode=control-group\nExecStart=/app/zabbix/sbin/zabbix_server -c $CONFFILE\nExecStop=/bin/kill -SIGTERM $MAINPID\nRestartSec=10s\nTimeoutSec=0\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\nç”±äºæ˜¯æºç ç¼–è¯‘å®‰è£…ï¼Œæ‰€ä»¥å­˜æ”¾æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ä¸å­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡Œåˆ›å»ºå’Œç»™äºˆæƒé™\n\n```bash\nmkdir /var/log/zabbix\nchown zabbix:zabbix /var/log/zabbix\n```\n\nå¯åŠ¨zabbix-serverå’ŒæŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€ã€‚\n\n```bash\nsystemctl start zabbix-server && systemctl enable zabbix-server\nsystemctl status zabbix-server\n```\n\n![image-20241113083832700](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/55aefc3518aa2a6e2a40c1f18b982a3955933597.png)\n\næŸ¥çœ‹æ—¥å¿—ä¹Ÿæ­£å¸¸\n\n```\ntail -f /var/log/zabbix/zabbix_server.log\n```\n\n![image-20241113084050766](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/cf3182ac66d49a911ed82e4ff42eb24755933597.png)\n\næŸ¥çœ‹ç½‘é¡µå·²ç»åœ¨è¿è¡Œäº†\n![image-20241113084136313](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/e31a1197e294576aa3f2641537a70163697559838.png)\n\n## zabbix-agentå®‰è£…\n\n### serverç«¯å®‰è£…agent\n\næ“ä½œèŠ‚ç‚¹[server]\n\n```bash\n#åˆ¶ä½œ Zabbix agent å®ˆæŠ¤æ–‡ä»¶\ncat > /usr/lib/systemd/system/zabbix-agent.service<<\"EOF\"\n[Unit]\nDescription=Zabbix Agent\nAfter=syslog.target\nAfter=network.target\n[Service]\nEnvironment=\"CONFFILE=/app/zabbix/etc/zabbix_agentd.conf\"\nType=simple\nRestart=on-failure\n#PIDæ–‡ä»¶è¦æ”¹\nPIDFile=/var/log/zabbix/zabbix_agentd.pid\nKillMode=control-group\nExecStart=/app/zabbix/sbin/zabbix_agentd -c $CONFFILE\nExecStop=/bin/kill -SIGTERM $MAINPID\nRestartSec=10s\nUser=zabbix\nGroup=zabbix\n[Install]\nWantedBy=multi-user.target\nEOF\n#ä¿®æ”¹agenté…ç½®æ–‡ä»¶ä¹Ÿæ˜¯å’Œserverä¸€æ ·ä¿®æ”¹æ—¥å¿—æ–‡ä»¶å’Œpidæ–‡ä»¶ä½ç½®\nsed -i 's|^LogFile=.*|LogFile=/var/log/zabbix/zabbix_agentd.log|' /app/zabbix/etc/zabbix_agentd.conf\n\nsed -i '/^# PidFile=\\/tmp\\/zabbix_agentd.pid$/a \\  PidFile=/var/log/zabbix/zabbix_agentd.pid' /app/zabbix/etc/zabbix_agentd.conf\n#å¯åŠ¨zabbix agent\nsystemctl daemon-reload\nsystemctl start zabbix-agent && systemctl enable zabbix-agent\n```\n\n> <font color='red'>è¿™æ ·åœ¨serverä¸»æœºçš„zabbixçš„serverç«¯å’Œagentç«¯å·²ç»å®‰è£…å¥½äº†ï¼Œä½†æ˜¯ç°åœ¨å°±æ˜¯è¯´åªæœ‰ä¸€ä¸ªagentç«¯ä¹Ÿå°±æ˜¯æœ¬æœºï¼Œåªèƒ½ç›‘æ§è‡ªå·±ï¼Œç°åœ¨å°±æ•™ä½ ä»¬å»ç›‘æ§å…¶ä»–æœºå­</font>\n\n![image-20241113143603974](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/9d09dd27353c1514fd817b4ca8af8818697559838.png)\n\n### å…¶ä»–ä¸»æœºå®‰è£…agent\n\næ“ä½œèŠ‚ç‚¹ï¼š[zabbix-agent]\n\n```bash\n#agentç«¯ä¸‹è½½æºç åŒ…,ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ä¸Šä¼ åˆ°è™šæ‹Ÿæœºå³å¯ï¼Œæˆ‘æ˜¯æ”¾åˆ°äº†rootç›®å½•ä¸‹\nwget https://cdn.zabbix.com/zabbix/sources/stable/7.0/zabbix-7.0.5.tar.gz\ntar -zxvf zabbix-7.*.tar.gz\n#åˆ›å»ºzabbixç”¨æˆ·\ngroupadd --system zabbix\nuseradd --system -g zabbix -d /usr/lib/zabbix -s /sbin/nologin -c \"Zabbix Monitoring System\" zabbix\n#åˆ›å»ºzabbixå®‰è£…ç›®å½•\nmkdir -p /app/zabbix\n#å®‰è£…éœ€è¦çš„ç»„ä»¶\ndnf -y install mysql-devel libevent-devel pcre-devel\n#å¼€å§‹ç¼–è¯‘ï¼ˆ/app/zabbixï¼‰æ˜¯zabbixçš„å®‰è£…ç›®å½•ï¼Œä»¥ä¸‹ç¼–è¯‘ä¼šå®‰è£…åœ¨/app/zabbix è¿™é‡Œåªéœ€è¦å¯ç”¨agentå³å¯serverä¸ç”¨\nmv zabbix-7.0.5 zabbix && cd zabbix\n./configure --prefix=/app/zabbix --enable-agent \n#å¼€å§‹å®‰è£…\nmake install\n#ä¿®æ”¹é…ç½®æ–‡ä»¶\nsed -i 's|^LogFile=.*|LogFile=/var/log/zabbix/zabbix_agentd.log|' /app/zabbix/etc/zabbix_agentd.conf\nsed -i '/^# PidFile=\\/tmp\\/zabbix_agentd.pid$/a \\  PidFile=/var/log/zabbix/zabbix_agentd.pid' /app/zabbix/etc/zabbix_agentd.conf\n#ä¿®æ”¹æµ‹è¯•æœºagenté…ç½®æ–‡ä»¶é‡Œçš„serve-ipï¼Œè¿™é‡Œè¦å¡«serveræœºçš„ipï¼ˆä¿®æ”¹192.168.48.101å³å¯ï¼‰\nsed -i 's/Server=127.0.0.1/Server=192.168.48.101/g' /app/zabbix/etc/zabbix_agentd.conf\nsed -i 's/ServerActive=127.0.0.1/ServerActive=192.168.48.101/g' /app/zabbix/etc/zabbix_agentd.conf\n#zabbix-agentä¿®æ”¹æˆä½ æµ‹è¯•æœºçš„ä¸»æœºå\nsed -i 's/Hostname=Zabbix server/Hostname=zabbix-agent/g' /app/zabbix/etc/zabbix_agentd.conf\n\n#åˆ¶ä½œ Zabbix agent å®ˆæŠ¤æ–‡ä»¶\ncat > /usr/lib/systemd/system/zabbix-agent.service<<\"EOF\"\n[Unit]\nDescription=Zabbix Agent\nAfter=syslog.target\nAfter=network.target\n[Service]\nEnvironment=\"CONFFILE=/app/zabbix/etc/zabbix_agentd.conf\"\nType=simple\nRestart=on-failure\n#PIDæ–‡ä»¶è¦æ”¹\nPIDFile=/var/log/zabbix/zabbix_agentd.pid\nKillMode=control-group\nExecStart=/app/zabbix/sbin/zabbix_agentd -c $CONFFILE\nExecStop=/bin/kill -SIGTERM $MAINPID\nRestartSec=10s\nUser=zabbix\nGroup=zabbix\n[Install]\nWantedBy=multi-user.target\nEOF\n#ç”±äºæ˜¯æºç ç¼–è¯‘å®‰è£…ï¼Œæ‰€ä»¥å­˜æ”¾æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ä¸å­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡Œåˆ›å»ºå’Œç»™äºˆæƒé™\nmkdir /var/log/zabbix\nchown zabbix:zabbix /var/log/zabbix\n#å¯åŠ¨zabbix agent\nsystemctl daemon-reload\nsystemctl start zabbix-agent && systemctl enable zabbix-agent\n```\n\nzabbixé¡µé¢é…ç½®æµ‹è¯•æœºç›‘æ§ç«¯\n\n![image-20241113150026254](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/7b2a2ff9084a796a1490d2d1ff0afb5b697559838.png)\n\n![image-20241113150133543](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/d72bc3471d4faf086a5786bf7982a72d697559838.png)\n\n![image-20241113150518858](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/9c745a1be14218cc8fec182d30c54701697559838.png)\n\næœ€ç»ˆæ•ˆæœï¼Œç‚¹å‡»æ·»åŠ å³å¯\n\n![image-20241113150550231](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/8bf61dcdd9e7e18e502ba46213a734a4697559838.png)\n\n![image-20241113152007961](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/d9683d405ab9cfa7d529c6b1d58d0a5b697559838.png)\n\næµ‹è¯•ç«¯çš„æœºå­å·²ç»æ·»åŠ å¥½äº†\n\n## æµ‹è¯•\n\n### Zabbix Web é…ç½®æ¨¡æ¿(ç›‘å¬ Port 80)\n\næ“ä½œèŠ‚ç‚¹ï¼š[zabbix-agent]\n\n#### å®‰è£…nginxå¹¶é…ç½®ç½‘é¡µ\n\nå› ä¸ºæ²¡æœ‰é€‚é…openeulerçš„ç‰ˆæœ¬ï¼Œè¿™é‡Œç›´æ¥ç”¨centos8çš„æ¥ä»£æ›¿ï¼Œå…¼å®¹çš„æ²¡å…³ç³»ï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿå»è‡ªè¡Œæ›¿æ¢\n\n```bash\ncat >/etc/yum.repos.d/nginx.repo << \"EOF\"\n[nginx-stable]\nname=nginx stable repo\n#baseurl=http://nginx.org/packages/centos/$releasever/$basearch/\n#åŸæœ¬æ˜¯$releaseverçš„ï¼Œä½†æ˜¯æ²¡æœ‰openeulerçš„ç‰ˆæœ¬ç›´æ¥ç”¨8æ¥ä»£æ›¿ä¹Ÿå°±æ˜¯centos8ï¼Œopeneulerå…¼å®¹centos\nbaseurl=http://nginx.org/packages/centos/8/$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\n\n[nginx-mainline]\nname=nginx mainline repo\n#baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\nbaseurl=http://nginx.org/packages/mainline/centos/8/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\nEOF\nyum install nginx -y\nsystemctl enable nginx --now\n```\n\nè¿™æ ·å°±å¯ä»¥éšæ—¶å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„nginx\n\næ·»åŠ æµ‹è¯•ç½‘é¡µ\n\n`/etc/nginx/conf.d/default.conf`\n\n```bash\n[root@zabbix-agent ~]# cat /etc/nginx/conf.d/default.conf\nserver {\n#80ç«¯å£\n    listen       80;\n    server_name  localhost;\n\n    #access_log  /var/log/nginx/host.access.log  main;\n\n    location / {\n    #è¿™é‡Œå°±æ˜¯ç½‘ç«™çš„æ ¹ç›®å½•äº†\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n    #ã€‚ã€‚ã€‚ã€‚ã€‚\n}\n```\n\nç›´æ¥ä¿®æ”¹80ç«¯å£ä¸‹çš„ç½‘ç«™é‡Œé¢çš„å†…å®¹\n\n```\nvim /usr/share/nginx/html/index.html\n```\n\né‡Œé¢çš„å†…å®¹å…¨éƒ¨åˆ äº†,å†™å…¥ä»¥ä¸‹å†…å®¹ï¼Œç„¶åä¿å­˜é€€å‡ºå³å¯\n\n```\n<h1>welcome to qianyios.blog</h1>\n```\n\né‡å¯æœåŠ¡\n\n```\nnginx -s reload\n```\n\n![image-20241116181113300](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/757fe1ce34333c57d7b4d507eb8db740697559838.png)\n\n#### é…ç½®80ç«¯å£æ¨¡æ¿\n\nåˆ›å»ºç›‘æ§80ç«¯å£çŠ¶æ€çš„æ¨¡æ¿\n\n![image-20241116185125433](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/6e6a8c1481a46fe120dc4a1307ad9d48697559838.png)\n\nåˆ›å»ºç›‘æ§é¡¹\n\n![image-20241116201133039](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/7252cf1b23304a449061a6bcde24373b697559838.png)\n\n![image-20241116205532638](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/ed563023ab274f9a62403ee99b7503de697559838.png)\n\nåˆ›å»ºè§¦å‘å™¨\n\nç‚¹å‡»è§¦å‘å™¨ï¼Œåˆ›å»ºè§¦å‘å™¨\n\n![image-20241116201342794](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/7b5b4548528b33487f880c3c7443fdaf697559838.png)\n\n![image-20241116201548422](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/b33191927a10b59889e5c29b333fbb80697559838.png)\n\nåˆ›å»ºå›¾å½¢\n\n![image-20241116201716163](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/df9becd1a23c51fb6875d041da3b6630697559838.png)\n\n![image-20241116201748272](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/325a8be80a46be5c23c862011d1955be697559838.png)\n\n#### é…ç½®æµ‹è¯•æœºåº”ç”¨80ç«¯å£æ¨¡æ¿\n\n![image-20241116202908169](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/3f958de07947d70beffc35ed0cec8e9e697559838.png)\n\næ›´æ–°ä¸€ä¸‹\n\n![image-20241116204210574](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/5c88a77095f55137059019a0e7af3a1b697559838.png)\n\n#### 80ç«¯å£æ¨¡æ¿æµ‹è¯•\n\n![image-20241116205844643](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/cb0734669d4409483a6bcf2afbf4c529697559838.png)\n\nå½“æˆ‘ä»¬æ¨¡æ‹Ÿ80ç«¯å£down\n\n```\nsystemctl stop nginx\n```\n\n![image-20241116205932836](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/92dfcb1d1774bac8af5ab15fecdda2bc697559838.png)\n\n![image-20241116210138178](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/812219ac4a182e68dd4a161a1b0def8b697559838.png)\n\nç„¶åæˆ‘ä»¬å†å¼€èµ·æ¥\n\n```\nsystemctl start nginx\n```\n\n![image-20241116210022189](../img/OpenEuler22.03%20LTS%E9%83%A8%E7%BD%B2Zabbix/e83cbcb6a36d9638463775bf664d8141697559838.png)\n\nåˆ°æ­¤ç›‘æµ‹80ç«¯å£æˆåŠŸ\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Zabbix"],"categories":["è¿ç»´"]},{"title":"Butterflyä¸»é¢˜ç¾åŒ–ä¹‹è·¯","url":"/posts/23d5be7c/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Butterflyä¸»é¢˜ç¾åŒ–ä¹‹è·¯\n\nä»¥ä¸‹å†…å®¹æ‘˜è‡ª[Butterfly - A Simple and Card UI Design theme for Hexo](https://butterfly.js.org/)\n\n## å®‰è£…ä¸»é¢˜\n\nåœ¨hexoæ ¹ç›®å½•ä¸‹æ‰§è¡Œ\n\ngiteeï¼ˆé€‚åˆä¸­å›½å¤§é™†ï¼‰\n\n```\ngit clone -b master https://gitee.com/immyw/hexo-theme-butterfly.git themes/butterfly\n```\n\ngithubï¼ˆå»ºè®®å…ˆç”¨è¿™ä¸ªï¼‰\n\n```\ngit clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly\n```\n\n> å‡çº§æ–¹æ³•ï¼šåœ¨ä¸»é¢˜ç›®å½•ä¸‹ï¼Œè¿è¡Œgit pull\n\nä¹Ÿå¯ä»¥ç”¨npmæ–¹æ³•å®‰è£…\n\n```\nnpm install hexo-theme-butterfly\n```\n\n> å‡çº§æ–¹æ³•ï¼šåœ¨ Hexo æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œ `npm update hexo-theme-butterfly`\n\n## åº”ç”¨ä¸»é¢˜\n\nåœ¨hexoæ ¹ç›®å½•å†™ä¸‹çš„_config.ymlæœ‰ä¸ªthemeï¼šä¿®æ”¹ä¸ºä»¥ä¸‹\n\n```\ntheme: butterfly\n```\n\nå¦‚æœä½ æ²¡æœ‰ pug ä»¥åŠ stylus çš„æ¸²æŸ“å™¨ï¼Œè¯·ä¸‹è½½å®‰è£…ï¼š\n\n```\nnpm install hexo-renderer-pug hexo-renderer-stylus hexo-butterfly-extjs --save \n```\n\n## Front-matter\n\nFront-matter æ˜¯ markdown æ–‡ä»¶æœ€ä¸Šæ–¹ä»¥ --- åˆ†éš”çš„åŒºåŸŸï¼Œç”¨äºæŒ‡å®šä¸ªåˆ«æ¡£æ¡ˆçš„å˜æ•°ã€‚\n\nPage Front-matter ç”¨äº é…ç½®é¡µé¢\nPost Front-matter ç”¨äº é…ç½®æ–‡ç« é¡µ\n\n> å¦‚æœæ ‡æ³¨çš„å‚æ•°ï¼Œå¯æ ¹æ®è‡ªå·±éœ€è¦æ·»åŠ ï¼Œä¸ç”¨å…¨éƒ¨éƒ½å†™åœ¨ markdown é‡Œ å¯é€‰\n\n1. Page Front-matter\n\n```\n---\ntitle:\ndate:\nupdated:\ntype:\ncomments:\ndescription:\nkeywords:\ntop_img:\nmathjax:\nkatex:\naside:\naplayer:\nhighlight_shrink:\nrandom:\nlimit:\n  type:\n  value:\n---\n```\n\n| å‚æ•°             | è§£é‡Š                                                         |\n| ---------------- | ------------------------------------------------------------ |\n| title            | ã€å¿…éœ€ã€‘é¡µé¢æ ‡é¢˜                                             |\n| date             | ã€å¿…éœ€ã€‘é¡µé¢åˆ›å»ºæ—¥æœŸ                                         |\n| type             | ã€å¿…éœ€ã€‘æ ‡ç­¾ã€åˆ†ç±»å’Œå‹æƒ…é“¾æ¥ä¸‰ä¸ªé¡µé¢éœ€è¦é…ç½®                 |\n| updated          | ã€å¯é€‰ã€‘é¡µé¢æ›´æ–°æ—¥æœŸ                                         |\n| description      | ã€å¯é€‰ã€‘é¡µé¢æè¿°                                             |\n| keywords         | ã€å¯é€‰ã€‘é¡µé¢å…³é”®è¯                                           |\n| comments         | ã€å¯é€‰ã€‘æ˜¾ç¤ºé¡µé¢è¯„è®ºæ¨¡å— ï¼ˆé»˜è®¤ trueï¼‰                       |\n| top_img          | ã€å¯é€‰ã€‘é¡µé¢é¡¶éƒ¨å›¾ç‰‡                                         |\n| mathjax          | ã€å¯é€‰ã€‘æ˜¾ç¤º mathjax ï¼ˆå½“è®¾ç½® mathjax çš„ per_pageï¼š false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ falseï¼‰ |\n| katex            | ã€å¯é€‰ã€‘æ˜¾ç¤º katex ï¼ˆå½“è®¾ç½® katex çš„ per_pageï¼š false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ falseï¼‰ |\n| aside            | ã€å¯é€‰ã€‘æ˜¾ç¤ºä¾§è¾¹æ  ï¼ˆé»˜è®¤ trueï¼‰                             |\n| aplayer          | ã€å¯é€‰ã€‘åœ¨éœ€è¦çš„é¡µé¢åŠ è½½ aplayer çš„ js å’Œ cssï¼Œè¯·å‚è€ƒæ–‡ç« ä¸‹é¢çš„ é…ç½®éŸ³æ¨‚ |\n| highlight_shrink | ã€å¯é€‰ã€‘é…ç½®ä»£ç æ¡†æ˜¯å¦å±•å¼€ ï¼ˆtrue/falseï¼‰ ï¼ˆé»˜è®¤ä¸ºè®¾ç½®ä¸­ highlight_shrink çš„é…ç½®ï¼‰ |\n| random           | ã€å¯é€‰ã€‘é…ç½®å‹æƒ…é“¾æ¥æ˜¯å¦éšæœºæ’åºï¼ˆé»˜è®¤ä¸º falseï¼‰             |\n| limit            | ã€å¯é€‰ã€‘é…ç½®è¯´æ˜¾ç¤ºæ•°é‡                                       |\n| limit.type       | ã€å¯é€‰ã€‘é…ç½®è¯´æ˜¾ç¤ºæ•°é‡çš„ç±»å‹ ï¼ˆdate æˆ–è€… numï¼‰               |\n| limit.value      | ã€å¯é€‰ã€‘é…ç½®è¯´æ˜¾ç¤ºæ•°é‡çš„å€¼                                   |\n\n2. Post Front-matter\n\n```\n---\ntitle:\ndate:\nupdated:\ntags:\ncategories:\nkeywords:\ndescription:\ntop_img:\ncomments:\ncover:\ntoc:\ntoc_number:\ntoc_style_simple:\ncopyright:\ncopyright_author:\ncopyright_author_href:\ncopyright_url:\ncopyright_info:\nmathjax:\nkatex:\naplayer:\nhighlight_shrink:\naside:\nabcjs:\n---\n```\n\n| å†™æ³•                  | è§£é‡Š                                                         |\n| --------------------- | ------------------------------------------------------------ |\n| title                 | ã€å¿…éœ€ã€‘æ–‡ç« æ ‡é¢˜                                             |\n| date                  | ã€å¿…éœ€ã€‘é¡µé¢åˆ›å»ºæ—¥æœŸ                                         |\n| updated               | ã€å¯é€‰ã€‘é¡µé¢æ›´æ–°æ—¥æœŸ                                         |\n| description           | ã€å¯é€‰ã€‘é¡µé¢æè¿°                                             |\n| tags                  | ã€å¯é€‰ã€‘æ–‡ç« æ ‡ç­¾                                             |\n| keywords              | ã€å¯é€‰ã€‘é¡µé¢å…³é”®è¯                                           |\n| top_img               | ã€å¯é€‰ã€‘é¡µé¢é¡¶éƒ¨å›¾ç‰‡                                         |\n| categories            | ã€å¯é€‰ã€‘æ–‡ç« åˆ†ç±»                                             |\n| cover                 | ã€å¯é€‰ã€‘æ–‡ç« ç¼©ç•¥å›¾ï¼ˆå¦‚æœæ²¡æœ‰è®¾ç½® top_imgï¼Œæ–‡ç« é¡µé¡¶éƒ¨å°†æ˜¾ç¤ºç¼©ç•¥å›¾ï¼Œå¯è®¾ä¸º false/å›¾ç‰‡åœ°å€/ç•™ç©ºï¼‰ |\n| comments              | ã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç« è¯„è®ºæ¨¡å—ï¼ˆé»˜è®¤ trueï¼‰                        |\n| toc                   | ã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç«  TOCï¼ˆé»˜è®¤ä¸ºè®¾ç½®ä¸­ toc çš„ enable é…ç½®ï¼‰      |\n| toc_number            | ã€å¯é€‰ã€‘æ˜¾ç¤º toc_numberï¼ˆé»˜è®¤ä¸ºè®¾ç½®ä¸­ toc çš„ number é…ç½®ï¼‰   |\n| toc_style_simple      | ã€å¯é€‰ã€‘æ˜¾ç¤º toc ç®€æ´æ¨¡å¼                                    |\n| copyright             | ã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç« ç‰ˆæƒæ¨¡å—ï¼ˆé»˜è®¤ä¸ºè®¾ç½®ä¸­ post_copyright çš„ enable é…ç½®ï¼‰ |\n| copyright_author      | ã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„æ–‡ç« ä½œè€…                               |\n| copyright_author_href | ã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„é“¾æ¥æ–‡ç« ä½œè€…                           |\n| copyright_url         | ã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„é“¾æ¥æ–‡ç« é“¾æ¥                           |\n| copyright_info        | ã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„æ–‡å­—ç‰ˆæƒå£°æ˜                           |\n| mathjax               | ã€å¯é€‰ã€‘æ˜¾ç¤º mathjaxï¼ˆå½“è®¾ç½® mathjax çš„ per_pageï¼š false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false ï¼‰ |\n| katex                 | ã€å¯é€‰ã€‘æ˜¾ç¤º katex ï¼ˆå½“è®¾ç½® katex çš„ per_pageï¼š false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false ï¼‰ |\n| aplayer               | ã€å¯é€‰ã€‘åœ¨éœ€è¦çš„é¡µé¢åŠ è½½ aplayer çš„ js å’Œ cssï¼Œè¯·å‚è€ƒæ–‡ç« ä¸‹é¢çš„ é…ç½®éŸ³ä¹ |\n| highlight_shrink      | ã€å¯é€‰ã€‘é…ç½®ä»£ç æ¡†æ˜¯å¦å±•å¼€ï¼ˆtrue/falseï¼‰ï¼ˆé»˜è®¤ä¸ºè®¾ç½®ä¸­ highlight_shrink çš„é…ç½®ï¼‰ |\n| aside                 | ã€å¯é€‰ã€‘æ˜¾ç¤ºä¾§è¾¹æ  ï¼ˆé»˜è®¤ trueï¼‰                             |\n| abcjs                 | ã€å¯é€‰ã€‘åŠ è½½ abcjs ï¼ˆå½“è®¾ç½® abcjs çš„ per_pageï¼š false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false ï¼‰ |\n\n## æ ‡ç­¾é¡µ\n\n> æ ‡ç­¾é¡µæ–‡ä»¶åä¸ä¸€å®šæ˜¯ tagsï¼Œ ä¾‹å­ä¸­çš„ tags åªæ˜¯ä¸€ä¸ªç¤ºä¾‹\n> è®°å¾—æ·»åŠ  `type: \"tags\"`\n\n1. å‰å¾€ä½ çš„ Hexo çš„æ ¹ç›®å½•\n\n2. è¾“å…¥ `hexo new page tags`\n\n3. ä½ ä¼šæ‰¾åˆ° è¿™ä¸ªæ–‡ä»¶source/tags/index.md\n\n4. ä¿®æ”¹æ­¤æ–‡æ¡£ ï¼š\n\n```\n---\ntitle: æ ‡ç­¾\ndate: 2018-01-05 00:00:00\ntype: \"tags\"\norderby: random\norder: 1\n---\n```\n\n![image-20241105124440059](../img/Butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96%E4%B9%8B%E8%B7%AF/3370a63ac484df599c1e8a50c2fd5798697559838.png)\n\n| å‚æ•°    | è§£é‡Š                                                         |\n| ------- | ------------------------------------------------------------ |\n| type    | ã€å¿…é¡»ã€‘é¡µé¢ç±»å‹ï¼Œå¿…é¡»ä¸º tags                                |\n| orderby | ã€å¯é€‰ã€‘æ’åºæ–¹å¼ ï¼š<br/>random - éšæœºæ’åº / name - æ ‡ç­¾åå­—æ’åº / length - æ ‡ç­¾æ•°é‡æ’åº |\n| order   | ã€å¯é€‰ã€‘æ’åºæ¬¡åºï¼š 1ï¼ˆå‡åºï¼‰ï¼Œ-1ï¼ˆé™åºï¼‰                     |\n\n## åˆ†ç±»é¡µ\n\n> åˆ†ç±»é¡µæ–‡ä»¶åä¸ä¸€å®šæ˜¯ categoriesï¼Œ ä¾‹å­ä¸­çš„ categories åªæ˜¯ä¸€ä¸ªç¤ºä¾‹\n> è®°å¾—æ·»åŠ  `type: \"categories\"`\n\n1. å‰å¾€ä½ çš„ Hexo çš„æ ¹ç›®å½•\n2. è¾“å…¥ `hexo new page categories`\n3. ä½ ä¼šæ‰¾åˆ° è¿™ä¸ªæ–‡ä»¶source/categories/index.md\n4. ä¿®æ”¹æ­¤æ–‡æ¡£ ï¼š\n\n```\n---\ntitle: åˆ†ç±»\ndate: 2024-11-05 12:44:54\ntype: \"categories\"\n---\n```\n\n![image-20241105124524423](../img/Butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96%E4%B9%8B%E8%B7%AF/27b8cbdd42c35ba2150bdb500580d6be697559838.png)\n\n## å‹æƒ…é“¾æ¥\n\n> å‹æƒ…é“¾æ¥é¡µæ–‡ä»¶åä¸ä¸€å®šæ˜¯ linkï¼Œ ä¾‹å­ä¸­çš„ link åªæ˜¯ä¸€ä¸ªç¤ºä¾‹\n> è®°å¾—æ·»åŠ  `type: \"link\"`\n\n1. å‰å¾€ä½ çš„ Hexo çš„æ ¹ç›®å½•\n2. è¾“å…¥ `hexo new page link`\n3. ä½ ä¼šæ‰¾åˆ° è¿™ä¸ªæ–‡ä»¶source/link/index.md\n4. ä¿®æ”¹æ­¤æ–‡æ¡£ ï¼š\n\n```\n---\ntitle: å‹æƒ…é“¾æ¥\ndate: 2024-11-05 12:47:52\ntype: \"link\"\n---\n```\n\nåœ¨ Hexo æ ¹ç›®å½•ä¸­çš„ ï¼ˆå¦‚æœæ²¡æœ‰ _data æ–‡ä»¶å¤¹ï¼Œè¯·è‡ªè¡Œåˆ›å»ºï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ `source/_data/link.yml`\n\n```\n- class_name: å‹æƒ…é“¾æ¥\n  class_desc: é‚£äº›äººï¼Œé‚£äº›äº‹\n  link_list:\n    - name: Hexo\n      link: https://hexo.io/zh-tw/\n      avatar: https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg\n      descr: å¿«é€Ÿã€ç°¡å–®ä¸”å¼·å¤§çš„ç¶²èªŒæ¡†æ¶\n\n- class_name: ç½‘ç«™\n  class_desc: å€¼å¾—æ¨èçš„ç½‘ç«™\n  link_list:\n    - name: ä¸¥åƒå±¹\n      link: https://blog.qianyios.top/\n      avatar: https://blog.qianyios.top/img/fluid.png\n      descr: åšå®¢\n```\n\n## 404é¡µé¢\n\n```\n# A simple 404 page\nerror_404:\n  enable: false\n  subtitle: 'é¡µé¢ä¸å­˜åœ¨'\n  background: /img/error-page.png\n```\n\n## é…ç½®æ–‡ä»¶é€Ÿè¯»\n\n```\n# --------------------------------------\n# Hexo Butterfly Theme Configuration\n# If you have any questions, please refer to the documentation\n# Chinese: https://butterfly.js.org/\n# English: https://butterfly.js.org/en/\n# --------------------------------------\n\n# --------------------------------------\n# Navigation Settings\n# --------------------------------------\n\nnav:\n  # å¯¼èˆªæ  Logo å›¾ç‰‡\n  logo:\n  # æ˜¯å¦æ˜¾ç¤ºæ ‡é¢˜\n  display_title: true\n  # æ˜¯å¦å›ºå®šå¯¼èˆªæ \n  fixed: false\n\nmenu:\n  # é¦–é¡µ: / || fas fa-home\n  # åˆ—è¡¨||fas fa-list:\n  #   éŸ³ä¹: /music/ || fas fa-music\n  #   ç”µå½±: /movies/ || fas fa-video\n  é¦–é¡µ: / || fas fa-home\n  æ ‡ç­¾: /tags/ || fas fa-tags\n  åˆ†ç±»: /categories/ || fas fa-folder-open\n  å‹é“¾: /link/ || fas fa-link\n  åˆ—è¡¨ || fas fa-list || hide:\n    éŸ³ä¹: /music/ || fas fa-music\n    ç”µå½±: /movies/ || fas fa-video\n\n# --------------------------------------\n# Code Blocks Settings\n# --------------------------------------\n\ncode_blocks:\n  # ä»£ç å—ä¸»é¢˜: darker / pale night / light / ocean / false\n  theme: light\n  # æ˜¯å¦ä½¿ç”¨ Mac é£æ ¼\n  macStyle: true\n  # ä»£ç å—é«˜åº¦é™åˆ¶ï¼ˆå•ä½: pxï¼‰\n  height_limit: 200\n  # æ˜¯å¦è‡ªåŠ¨æ¢è¡Œ\n  word_wrap: false\n\n  # å·¥å…·æ \n  # æ˜¯å¦æ˜¾ç¤ºå¤åˆ¶æŒ‰é’®\n  copy: true\n  # æ˜¯å¦æ˜¾ç¤ºè¯­è¨€æ ‡ç±¤\n  language: true\n  # true: æ”¶ç¼©ä»£ç å— | false: å±•å¼€ä»£ç å— | none: å±•å¼€ä»£ç å—å¹¶éšè—æŒ‰é’®\n  shrink: false\n  # æ˜¯å¦æ˜¾ç¤ºå…¨å±æ˜¾ç¤ºä»£ç å—æŒ‰é’®\n  fullpage: false\n\n# ç¤¾äº¤åª’ä½“é“¾æ¥\n# æ ¼å¼:\n#   icon: é“¾æ¥ || æè¿° || é¢œè‰²\nsocial:\n  # fab fa-github: https://github.com/xxxxx || Github || '#24292e'\n  # fas fa-envelope: mailto:xxxxxx@gmail.com || Email || '#4a7dbe'\n\n# --------------------------------------\n# å›¾ç‰‡è®¾ç½®\n# --------------------------------------\n\n# ç½‘ç«™çš„ favicon å›¾æ ‡\nfavicon: https://blog.qianyios.top/img/fluid.png\n# å¤´åƒè®¾ç½®\navatar:\n# å¤´åƒå›¾ç‰‡é“¾æ¥\n  img: https://blog.qianyios.top/img/fluid.png\n  # æ˜¯å¦å¯ç”¨å¤´åƒæ•ˆæœ\n  effect: true\n\n# ç¦ç”¨æ‰€æœ‰æ¨ªå¹…å›¾ç‰‡\ndisable_top_img: true\n\n# å¦‚æœé¡µé¢æœªè®¾ç½®æ¨ªå¹…ï¼Œåˆ™æ˜¾ç¤ºé»˜è®¤çš„æ¨ªå¹…å›¾ç‰‡\ndefault_top_img:\n\n# ä¸»é¡µçš„æ¨ªå¹…å›¾ç‰‡\nindex_img:\n\n# å½’æ¡£é¡µçš„æ¨ªå¹…å›¾ç‰‡\narchive_img:\n\n# æ³¨æ„: æ˜¯æ ‡ç±¤é¡µï¼ˆå•ä¸ªæ ‡ç±¤ï¼‰ï¼Œä¸æ˜¯æ ‡ç±¤é¡µé¢ï¼ˆæ‰€æœ‰æ ‡ç±¤ï¼‰\ntag_img:\n\n# æ ‡ç±¤é¡µçš„æ¨ªå¹…å›¾ç‰‡ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªæ ‡ç±¤è®¾ç½®æ¨ªå¹…å›¾ç‰‡\n# æ ¼å¼:\n#  - æ ‡ç±¤å: å›¾ç‰‡é“¾æ¥\ntag_per_img:\n\n# æ³¨æ„: æ˜¯åˆ†ç±»é¡µï¼ˆå•ä¸ªåˆ†ç±»ï¼‰ï¼Œä¸æ˜¯åˆ†ç±»é¡µé¢ï¼ˆæ‰€æœ‰åˆ†ç±»ï¼‰\ncategory_img:\n\n# åˆ†ç±»é¡µçš„æ¨ªå¹…å›¾ç‰‡ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªåˆ†ç±»è®¾ç½®æ¨ªå¹…å›¾ç‰‡\n# æ ¼å¼:\n#  - åˆ†ç±»å: å›¾ç‰‡é“¾æ¥\n# Format:\n#  - category name: xxxxx\ncategory_per_img:\n\n# é¡µè„šçš„èƒŒæ™¯å›¾ç‰‡\nfooter_img: false\n\n# ç½‘ç«™èƒŒæ™¯\n# å¯ä»¥è®¾ç½®ä¸ºé¢œè‰²æˆ–å›¾ç‰‡\n# å›¾ç‰‡æ ¼å¼: url(http://xxxxxx.com/xxx.jpg)\nbackground:\n\n# å°é¢è®¾ç½®\ncover:\n  # æ˜¯å¦ç¦ç”¨å°é¢\n  index_enable: true\n  aside_enable: true\n  archives_enable: true\n  # å½“æœªè®¾ç½®å°é¢æ—¶ï¼Œæ˜¾ç¤ºé»˜è®¤å°é¢\n  default_cover:\n    # - xxx.jpg\n\n# æ›¿æ¢æŸåçš„å›¾ç‰‡\nerror_img:\n# å‹é“¾é¡µé¢çš„é”™è¯¯å›¾ç‰‡\n  flink: /img/friend_404.gif\n# æ–‡ç« é¡µé¢çš„é”™è¯¯å›¾ç‰‡\n  post_page: /img/404.jpg\n\n# ç®€å•çš„ 404 é¡µé¢\nerror_404:\n  # æ˜¯å¦å¯ç”¨ 404 é¡µé¢\n  enable: false\n  # 404 é¡µé¢çš„å‰¯æ ‡é¢˜\n  subtitle: 'é¡µé¢ä¸å­˜åœ¨ï¼'\n  # 404 é¡µé¢çš„å¡ç‰‡èƒŒæ™¯å›¾ç‰‡\n  background: /img/error-page.png\n\n# æ–‡ç« å…ƒæ•°æ®è®¾ç½®\npost_meta:\n  # ä¸»é¡µé¡µé¢\n  page:\n    # æ—¥æœŸç±»å‹: created / updated / both\n    date_type: created\n    # æ—¥æœŸæ ¼å¼: date / relative\n    date_format: date\n    # æ˜¯å¦æ˜¾ç¤ºåˆ†ç±»\n    categories: true\n    # æ˜¯å¦æ˜¾ç¤ºæ ‡ç±¤\n    tags: false\n    # æ˜¯å¦æ˜¾ç¤ºæ–‡å­—æ ‡ç±¤\n    label: true\n\n  # æ–‡ç« é¡µé¢\n  post:\n    # å…ƒæ•°æ®ä½ç½®: left / center\n    position: left\n    # æ—¥æœŸç±»å‹: created / updated / both\n    date_type: both\n    # æ—¥æœŸæ ¼å¼: date / relative\n    date_format: date\n    categories: true\n    tags: true\n    label: true\n\n# --------------------------------------\n# é¦–é¡µè®¾ç½®\n# --------------------------------------\n\n# é¦–é¡µå¤´å›¾çš„è®¾ç½®\n# é»˜è®¤: å¤´å›¾å…¨å±ï¼Œç«™ç‚¹ä¿¡æ¯åœ¨ä¸­é—´\n# ç«™ç‚¹ä¿¡æ¯çš„ä½ç½®ï¼Œä¾‹å¦‚: 300px/300em/300rem/10%\nindex_site_info_top:\n# å¤´å›¾çš„é«˜åº¦ï¼Œä¾‹å¦‚: 300px/300em/300rem\nindex_top_img_height:\n\n# é¦–é¡µçš„å‰¯æ ‡é¢˜è®¾ç½®\nsubtitle:\n  # æ˜¯å¦å¯ç”¨å‰¯æ ‡é¢˜\n  enable: false\n  # æ˜¯å¦å¯ç”¨æ‰“å­—æœºæ•ˆæœ\n  effect: true\n  # è‡ªå®šä¹‰ typed.js\n  # https://github.com/mattboldt/typed.js/#customization\n  typed_option:\n  # æ¥æº - è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡ APIï¼ˆä»…é™ä¸­æ–‡ï¼‰\n  # å®ƒå°†é¦–å…ˆæ˜¾ç¤ºæ¥æºï¼Œç„¶åæ˜¾ç¤ºå‰¯æ ‡é¢˜å†…å®¹\n  # é€‰æ‹©: false/1/2/3\n  # false - ç¦ç”¨æ­¤åŠŸèƒ½\n  # 1 - hitokoto.cn\n  # 2 - yijuzhan.com\n  # 3 - jinrishici.com\n  source: false\n  # å¦‚æœå…³é—­æ‰“å­—æœºæ•ˆæœï¼Œå‰¯æ ‡é¢˜å°†ä»…æ˜¾ç¤º sub çš„ç¬¬ä¸€è¡Œå†…å®¹\n  sub:\n\n#é¦–é¡µä¸Šçš„æ–‡ç« å¸ƒå±€\n# 1ï¼šå°é¢åœ¨å·¦è¾¹ï¼Œä¿¡æ¯åœ¨å³è¾¹\n# 2ï¼šå°é¢åœ¨å³è¾¹ï¼Œä¿¡æ¯åœ¨å·¦è¾¹\n# 3ï¼šå°é¢å’Œä¿¡æ¯åœ¨å·¦å³äº¤æ›¿\n# 4ï¼šå°é¢åœ¨ä¸Šé¢ï¼Œä¿¡æ¯åœ¨ä¸‹é¢\n# 5ï¼šä¿¡æ¯æ˜¾ç¤ºåœ¨å°é¢ä¸Š\n# 6ï¼šç Œä½“å¸ƒå±€â€”â€”è¦†ç›–åœ¨é¡¶éƒ¨ï¼Œä¿¡æ¯åœ¨åº•éƒ¨\n# 7ï¼šç Œä½“å¸ƒå±€-ä¿¡æ¯æ˜¾ç¤ºåœ¨å°é¢ä¸Š\nindex_layout: 3\n\n# åœ¨é¦–é¡µæ˜¾ç¤ºæ–‡ç« ç®€ä»‹\n# 1: æè¿°\n# 2: ä¸¤è€…ï¼ˆå¦‚æœå­˜åœ¨æè¿°ï¼Œå°†æ˜¾ç¤ºæè¿°ï¼Œå¦åˆ™æ˜¾ç¤ºè‡ªåŠ¨æ‘˜è¦ï¼‰\n# 3: è‡ªåŠ¨æ‘˜è¦ï¼ˆé»˜è®¤ï¼‰\n# false: ä¸æ˜¾ç¤ºæ–‡ç« ç®€ä»‹\nindex_post_content:\n  method: 1\n  # If you set method to 2 or 3, the length need to config\n  length: 500\n\n# --------------------------------------\n# æ–‡ç« è®¾ç½®\n# --------------------------------------\n\ntoc:\n# æ˜¯å¦åœ¨æ–‡ç« ä¸­æ˜¾ç¤ºç›®å½•\n  post: true\n# æ˜¯å¦åœ¨æ–‡ç« ä¸­æ˜¾ç¤ºç›®å½•\n  page: false\n# æ˜¯å¦æ˜¾ç¤ºç›®å½•ç¼–å·\n  number: true\n# æ˜¯å¦é»˜è®¤å±•å¼€ç›®å½•\n  expand: false\n  # æ˜¯å¦ä½¿ç”¨ç®€æ´é£æ ¼ï¼ˆä»…é€‚ç”¨äºæ–‡ç« ï¼‰\n  style_simple: false\n    # æ˜¯å¦æ˜¾ç¤ºæ»šåŠ¨ç™¾åˆ†æ¯”\n  scroll_percent: true\n\npost_copyright:\n# æ˜¯å¦å¯ç”¨ç‰ˆæƒå£°æ˜\n  enable: true\n  # æ˜¯å¦è¿›è¡Œæ–‡ç«  URL è§£ç \n  decode: false\n  # ä½œè€…é“¾æ¥\n  author_href: https://blog.qianyios.top\n  license: CC BY-NC-SA 4.0\n  license_url: https://creativecommons.org/licenses/by-nc-sa/4.0/\n\n# èµåŠ©/æ‰“èµ\nreward:\n# æ˜¯å¦å¯ç”¨æ‰“èµ\n  enable: false\n  # æ‰“èµæ¡ˆä¾‹æ–‡æœ¬\n  text:\n  QR_code:\n    # - img: /img/wechat.jpg\n    #   link:\n    #   text: wechat\n    # - img: /img/alipay.jpg\n    #   link:\n    #   text: alipay\n\n# æ–‡ç« ç¼–è¾‘\n# è½»é¬†åœ¨çº¿æµè§ˆå’Œç¼–è¾‘åšå®¢æºä»£ç \npost_edit:\n# æ˜¯å¦å¯ç”¨åœ¨çº¿ç¼–è¾‘\n  enable: false\n  # url: https://github.com/user-name/repo-name/edit/branch-name/subdirectory-name/\n  # For example: https://github.com/jerryc127/butterfly.js.org/edit/main/source/\n  url:\n\n# ç›¸å…³æ–‡ç« \nrelated_post:\n# æ˜¯å¦æ˜¾ç¤ºç›¸å…³æ–‡ç« \n  enable: false\n  # æ˜¾ç¤ºçš„æ–‡ç« æ•°é‡\n  limit: 6\n  # Choose: created / updated\n  date_type: created\n\n# é€‰æ‹©: 1 / 2 / false\n# 1: â€œä¸‹ä¸€ç¯‡æ–‡ç« â€å°†é“¾æ¥åˆ°æ—§æ–‡ç« \n# 2: â€œä¸‹ä¸€ç¯‡æ–‡ç« â€å°†é“¾æ¥åˆ°æ–°æ–‡ç« \n# false: ç¦ç”¨åˆ†é¡µ\npost_pagination: 1\n\n# æ˜¾ç¤ºæ–‡ç« è¿‡æœŸé€šçŸ¥\nnoticeOutdate:\n  # æ˜¯å¦å¯ç”¨è¿‡æœŸé€šçŸ¥\n  enable: true\n  # Style: simple / flat\n  style: flat\n  # å¤šå°‘å¤©åæ˜¾ç¤ºé€šçŸ¥\n  limit_day: 365\n  # Position: top / bottom\n  position: top\n  message_prev: å·²ç»è¿‡äº†\n  message_next: å¤©è‡ªä¸Šæ¬¡æ›´æ–°ï¼Œæ–‡ç« å†…å®¹å¯èƒ½å·²è¿‡æ—¶ã€‚\n\n# --------------------------------------\n# é¡µè„šè®¾ç½®\n# --------------------------------------\nfooter:\n  owner:\n    enable: true\n    since: 2024\n  # è‡ªå®šä¹‰æ–‡æœ¬\n  custom_text: ä¸¥åƒå±¹åšå®¢\n  # Copyright of theme and framework\n  copyright: true\n\n# --------------------------------------\n# ä¾§è¾¹æ è®¾ç½®\n# --------------------------------------\n\naside:\n# æ˜¯å¦å¯ç”¨ä¾§è¾¹æ \n  enable: true\n  # æ˜¯å¦é»˜è®¤éšè—ä¾§è¾¹æ \n  hide: false\n  # æ˜¯å¦åœ¨å³ä¸‹è§’æ˜¾ç¤ºéšè—ä¾§è¾¹æ çš„æŒ‰é’®\n  button: true\n  # ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¯å¦å¯ç”¨ä¾§è¾¹æ \n  mobile: true\n   # ä¾§è¾¹æ ä½ç½®ï¼šleft / right\n  position: right\n  display:\n    # å½’æ¡£é¡µé¢æ˜¯å¦æ˜¾ç¤ºä¾§è¾¹æ \n    archive: true\n    # æ ‡ç±¤é¡µé¢æ˜¯å¦æ˜¾ç¤ºä¾§è¾¹æ \n    tag: true\n    # åˆ†ç±»é¡µé¢æ˜¯å¦æ˜¾ç¤ºä¾§è¾¹æ \n    category: true\n  card_author:\n  # æ˜¯å¦æ˜¾ç¤ºä½œè€…ä¿¡æ¯å¡ç‰‡\n    enable: true\n    # ä½œè€…æè¿°\n    description:\n    button:\n    # æ˜¯å¦æ˜¾ç¤ºæŒ‰é’®\n      enable: false\n      icon: fab fa-github\n      text: Follow Me\n      link: https://github.com/xxxxxx\n  card_announcement:\n  # æ˜¯å¦æ˜¾ç¤ºå…¬å‘Šå¡ç‰‡\n    enable: true\n    # å…¬å‘Šå†…å®¹\n    content: é„™äººåˆè€•è¿ç»´é—¨é“ï¼Œåä¸ºäº‘è®¡ç®—hcipè¯ä¹¦è·å¾—è€…ï¼Œå¾€åæ·±è€•Linuxï¼Œdockerï¼Œk8sè¿ç»´ã€‚\n  card_recent_post:\n  # æ˜¯å¦æ˜¾ç¤ºæœ€è¿‘æ–‡ç« å¡ç‰‡\n    enable: true\n    # æ˜¾ç¤ºæ–‡ç« æ•°é‡ï¼Œ0 è¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰\n    limit: 5\n      # æ’åºæ–¹å¼ï¼šdate / updated\n    sort: date\n    sort_order:\n  card_newest_comments:\n  # æ˜¯å¦æ˜¾ç¤ºæœ€æ–°è¯„è®ºå¡ç‰‡\n    enable: false\n    sort_order:\n    # æ˜¾ç¤ºè¯„è®ºæ•°é‡\n    limit: 6\n     # å•ä½ï¼šåˆ†é’Ÿï¼Œä¿å­˜æ•°æ®åˆ° localStorage\n    storage: 10\n     # æ˜¯å¦æ˜¾ç¤ºå¤´åƒ\n    avatar: true\n  card_categories:\n   # æ˜¯å¦æ˜¾ç¤ºåˆ†ç±»å¡ç‰‡\n    enable: true\n    # æ˜¾ç¤ºåˆ†ç±»æ•°é‡ï¼Œ0 è¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰\n    limit: 8\n    # Choose: none / true / false\n    expand: none\n    sort_order:\n  card_tags:\n  # æ˜¯å¦æ˜¾ç¤ºæ ‡ç±¤å¡ç‰‡\n    enable: true\n    # æ˜¾ç¤ºæ ‡ç±¤æ•°é‡ï¼Œ0 è¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰\n    limit: 40\n    # æ˜¯å¦å¯ç”¨é¢œè‰²\n    color: false\n    # æ ‡ç±¤æ’åºæ–¹å¼ï¼šrandom/name/length\n    orderby: random\n    # æ’åºé¡ºåºï¼š1 è¡¨ç¤ºå‡åºï¼Œ-1 è¡¨ç¤ºé™åº\n    order: 1\n    sort_order:\n  card_archives:\n      # æ˜¯å¦æ˜¾ç¤ºå½’æ¡£å¡ç‰‡\n    enable: true\n    # å½’æ¡£ç±»å‹ï¼šmonthly / yearly\n    type: monthly\n    # æ—¥æœŸæ ¼å¼ï¼Œä¾‹å¦‚ï¼šYYYYå¹´MMæœˆ\n    format: MMMM YYYY\n    # æ’åºé¡ºåºï¼š1 è¡¨ç¤ºå‡åºï¼Œ-1 è¡¨ç¤ºé™åº\n    order: -1\n    # æ˜¾ç¤ºå½’æ¡£æ•°é‡ï¼Œ0 è¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰\n    limit: 8\n    sort_order:\n  card_post_series:\n  # æ˜¯å¦æ˜¾ç¤ºç³»åˆ—æ–‡ç« å¡ç‰‡\n    enable: true\n    # æ ‡é¢˜æ˜¾ç¤ºç³»åˆ—åç§°\n    series_title: false\n    # æ’åºæ–¹å¼ï¼štitle æˆ– date\n    orderBy: 'date'\n    # æ’åºé¡ºåºï¼š1 è¡¨ç¤ºå‡åºï¼Œ-1 è¡¨ç¤ºé™åº\n    order: -1\n  card_webinfo:\n  # æ˜¯å¦æ˜¾ç¤ºç½‘ç«™ä¿¡æ¯å¡ç‰‡\n    enable: true\n    # æ˜¯å¦æ˜¾ç¤ºæ–‡ç« æ•°é‡\n    post_count: true\n    # æ˜¯å¦æ˜¾ç¤ºæœ€åæ¨é€æ—¥æœŸ\n    last_push_date: true\n    sort_order:\n    # å‘ä½ˆæ—¥æœŸä¸å½“å‰æ—¥æœŸçš„æ—¶é—´å·®\n    # æ ¼å¼ï¼šMonth/Day/Year Time æˆ– Year/Month/Day Time\n    # å¦‚æœä¸å¯ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·ç•™ç©º\n    runtime_date:\n\n# --------------------------------------\n# å³ä¸‹è§’æŒ‰é’®è®¾ç½®\n# --------------------------------------\n\n# å³ä¸‹è§’æŒ‰é’®ä¸åº•éƒ¨çš„è·ç¦»ï¼ˆé»˜è®¤å•ä½ï¼špxï¼‰\nrightside_bottom:\n\n# ç®€ç¹è½¬æ¢è®¾ç½®\ntranslate:\n# æ˜¯å¦å¯ç”¨ç®€ç¹è½¬æ¢\n  enable: false\n  # æŒ‰é’®æ–‡æœ¬\n  default: ç¹\n  # ç½‘ç«™è¯­è¨€ï¼ˆ1 - ç¹ä½“ä¸­æ–‡ / 2 - ç®€ä½“ä¸­æ–‡ï¼‰\n  defaultEncoding: 2\n  # è½¬æ¢å»¶è¿Ÿ\n  translateDelay: 0\n  # æŒ‰é’®åœ¨ç®€ä½“ä¸­æ–‡æ—¶çš„æ–‡æœ¬\n  msgToTraditionalChinese: 'ç¹'\n  # æŒ‰é’®åœ¨ç¹ä½“ä¸­æ–‡æ—¶çš„æ–‡æœ¬\n  msgToSimplifiedChinese: 'ç°¡'\n\n#é–²è¯»æ¨¡å¼\nreadmode: true\n\n# æš—é»‘æ¨¡å¼è®¾ç½®\ndarkmode:\n# æ˜¯å¦å¯ç”¨æš—é»‘æ¨¡å¼\n  enable: true\n  # åˆ‡æ¢æš—é»‘/æ˜äº®æ¨¡å¼çš„æŒ‰é’®\n  button: true\n  # æ˜¯å¦è‡ªåŠ¨åˆ‡æ¢æš—é»‘/æ˜äº®æ¨¡å¼\n  # autoChangeMode: 1  è·Ÿéšç³»ç»Ÿè®¾ç½®ï¼Œå¦‚æœç³»ç»Ÿä¸æ”¯æŒæš—é»‘æ¨¡å¼ï¼Œåˆ™åœ¨æ™šä¸Š 6 ç‚¹åˆ°æ—©ä¸Š 6 ç‚¹ä¹‹é—´åˆ‡æ¢æš—é»‘æ¨¡å¼\n  # autoChangeMode: 2  åœ¨æ™šä¸Š 6 ç‚¹åˆ°æ—©ä¸Š 6 ç‚¹ä¹‹é—´åˆ‡æ¢æš—é»‘æ¨¡å¼\n  # autoChangeMode: false  ä¸è‡ªåŠ¨åˆ‡æ¢\n  autoChangeMode: false\n  # è®¾ç½®æ˜äº®æ¨¡å¼æ—¶é—´ï¼Œå€¼åœ¨ 0 åˆ° 24 ä¹‹é—´ã€‚å¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤å€¼ä¸º 6 å’Œ 18 \n  start:\n  end:\n\n# åœ¨è¿”å›é¡¶éƒ¨æŒ‰é’®ä¸­æ˜¾ç¤ºæ»šåŠ¨ç™¾åˆ†æ¯”\nrightside_scroll_percent: false\n\n# ä¸è¦ä¿®æ”¹ä»¥ä¸‹è®¾ç½®ï¼Œé™¤éä½ çŸ¥é“å®ƒä»¬çš„å·¥ä½œåŸç†\n# é€‰æ‹©ï¼šreadmode,translate,darkmode,hideAside,toc,chat,comment\n# ä¸è¦é‡è¤‡ç›¸åŒçš„å€¼\nrightside_item_order:\n# æ˜¯å¦å¯ç”¨å³ä¾§é¡¹ç›®é¡ºåº\n  enable: false\n  # éšè—çš„é»˜è®¤é¡¹ç›®ï¼šreadmode,translate,darkmode,hideAside\n  hide:\n  # æ˜¾ç¤ºçš„é»˜è®¤é¡¹ç›®ï¼štoc,chat,comment\n  show:\n\n# --------------------------------------\n# å…¨å±€è®¾ç½®\n# --------------------------------------\n\n# é”šç‚¹è®¾ç½®\nanchor:\n  # æ»šåŠ¨æ—¶ï¼ŒURL å°†æ ¹æ®æ ‡é¢˜ ID æ›´æ–°\n  auto_update: false\n # ç‚¹å‡»æ ‡é¢˜æ»šåŠ¨å¹¶æ›´æ–°é”šç‚¹\n  click_to_scroll: false\n# å›¾ç‰‡æ ‡é¢˜\nphotofigcaption: false\n# è¤‡åˆ¶è®¾ç½®\ncopy:\n# æ˜¯å¦å¯ç”¨è¤‡åˆ¶åŠŸèƒ½\n  enable: true\n  # åœ¨è¤‡åˆ¶çš„å†…å®¹åæ·»åŠ ç‰ˆæƒä¿¡æ¯\n  copyright:\n    enable: true\n    # å½“è¤‡åˆ¶å­—ç¬¦æ•°è¶…è¿‡ limit_count æ—¶æ·»åŠ ç‰ˆæƒä¿¡æ¯\n    limit_count: 150\n\n# éœ€è¦å®‰è£… hexo-wordcount æ’ä»¶\nwordcount:\n# æ˜¯å¦å¯ç”¨å­—æ•°ç»Ÿè®¡\n  enable: true\n  # åœ¨æ–‡ç« å…ƒä¿¡æ¯ä¸­æ˜¾ç¤ºå­—æ•°ç»Ÿè®¡\n  post_wordcount: true\n  # åœ¨æ–‡ç« å…ƒä¿¡æ¯ä¸­æ˜¾ç¤ºé–²è¯»æ—¶é—´\n  min2read: true\n  # åœ¨ä¾§è¾¹æ ç½‘ç«™ä¿¡æ¯ä¸­æ˜¾ç¤ºæ€»å­—æ•°\n  total_wordcount: true\n\n# ä¸è’œå­ PV / UV ç»Ÿè®¡\nbusuanzi:\n  site_uv: true\n  site_pv: true\n  page_pv: true\n\n# --------------------------------------\n# æ•°å­¦å…¬å¼è®¾ç½®\n# --------------------------------------\n\n# å…³äº per_page\n# å¦‚æœè®¾ç½®ä¸º trueï¼Œå°†åœ¨æ¯ä¸ªé¡µé¢åŠ è½½ mathjax/katex è„šæœ¬\n# å¦‚æœè®¾ç½®ä¸º falseï¼Œå°†æ ¹æ®ä½ çš„è®¾ç½®åŠ è½½ mathjax/katex è„šæœ¬ï¼ˆåœ¨é¡µé¢çš„ front-matter ä¸­æ·»åŠ  'mathjax: true' æˆ–è€… 'katex: true'ï¼‰\nmath:\n  # é€‰æ‹©ï¼šmathjax, katex\n  # å¦‚æœä¸éœ€è¦æ•°å­¦å…¬å¼ï¼Œä¿æŒä¸ºç©º\n  use:\n  per_page: true\n  hide_scrollbar: false\n\n  mathjax:\n    # å¯ç”¨ä¸Šä¸‹æ–‡èœå•\n    enableMenu: true\n    # é€‰æ‹©ï¼šall / ams / noneï¼Œè¿™æ§åˆ¶æ˜¯å¦å¯¹å…¬å¼ç¼–å·ä»¥åŠå¦‚ä½•ç¼–å·\n    tags: none\n\n  katex:\n    # å¯ç”¨è¤‡åˆ¶ KaTeX å…¬å¼\n    copy_tex: false\n\n# --------------------------------------\n# æœç´¢è®¾ç½®\n# --------------------------------------\n\nsearch:\n  # é€‰æ‹©ï¼šalgolia_search / local_search / docsearch\n  # å¦‚æœä¸éœ€è¦æœç´¢åŠŸèƒ½ï¼Œä¿æŒä¸ºç©º\n  use:\n  placeholder:\n\n  # Algolia æœç´¢\n  algolia_search:\n    # æ¯é¡µæœç´¢ç»“æœæ•°é‡\n    hitsPerPage: 6\n\n  # æœ¬åœ°æœç´¢\n  local_search:\n    # é¡µé¢åŠ è½½æ—¶é¢„åŠ è½½æœç´¢æ•°æ®\n    preload: false\n    # æ¯ç¯‡æ–‡ç« æ˜¾ç¤ºçš„é¡¶éƒ¨ n ä¸ªæœç´¢ç»“æœï¼Œè®¾ç½®ä¸º -1 æ˜¾ç¤ºæ‰€æœ‰ç»“æœ\n    top_n_per_article: 1\n    # å°† HTML å­—ç¬¦ä¸²åè½¬ä¹‰ä¸ºå¯è¯»å†…å®¹\n    unescape: false\n    CDN:\n\n  # Docsearch\n  # https://docsearch.algolia.com/\n  docsearch:\n    appId:\n    apiKey:\n    indexName:\n    option:\n\n# --------------------------------------\n# åˆ†äº«ç³»ç»Ÿ\n# --------------------------------------\n\nshare:\n  # é€‰æ‹©ï¼šsharejs / addtoany\n  # å¦‚æœä¸éœ€è¦åˆ†äº«åŠŸèƒ½ï¼Œä¿æŒä¸ºç©º\n  use: sharejs\n\n  # Share.js\n  # https://github.com/overtrue/share.js\n  sharejs:\n    sites: facebook,twitter,wechat,weibo,qq\n\n  # AddToAny\n  # https://www.addtoany.com/\n  addtoany:\n    item: facebook,twitter,wechat,sina_weibo,facebook_messenger,email,copy_link\n\n# --------------------------------------\n# è¯„è®ºç³»ç»Ÿ\n# --------------------------------------\n\ncomments:\n  # æœ€å¤šä¸¤ä¸ªè¯„è®ºç³»ç»Ÿï¼Œç¬¬ä¸€ä¸ªå°†ä½œä¸ºé»˜è®¤æ˜¾ç¤º\n  # å¦‚æœä¸éœ€è¦è¯„è®ºåŠŸèƒ½ï¼Œä¿æŒä¸ºç©º\n  # é€‰æ‹©ï¼šDisqus/Disqusjs/Livere/Gitalk/Valine/Waline/Utterances/Facebook Comments/Twikoo/Giscus/Remark42/Artalk\n  # ä¸¤ä¸ªè¯„è®ºç³»ç»Ÿçš„æ ¼å¼ï¼šDisqus,Waline\n  use:\n  # æŒ‰é’®æ—è¾¹æ˜¾ç¤ºè¯„è®ºç³»ç»Ÿåç§°\n  text: true\n  # æ‡’åŠ è½½ï¼šè¯„è®ºç³»ç»Ÿå°†åœ¨è¯„è®ºå…ƒç´ è¿›å…¥æµè§ˆå™¨è§†å£æ—¶åŠ è½½\n  # å¦‚æœè®¾ç½®ä¸º trueï¼Œè¯„è®ºè®¡æ•°å°†æ— æ•ˆ\n  lazyload: false\n  # åœ¨æ–‡ç« é¡¶éƒ¨å›¾ç‰‡ä¸­æ˜¾ç¤ºè¯„è®ºè®¡æ•°\n  count: false\n  # åœ¨ä¸»é¡µæ˜¾ç¤ºè¯„è®ºè®¡æ•°\n  card_post_count: false\n\n# Disqus\n# https://disqus.com/\ndisqus:\n  shortname:\n  # For newest comments widget\n  apikey:\n\n# Alternative Disqus - Render comments with Disqus API\n# https://github.com/SukkaW/DisqusJS\ndisqusjs:\n  shortname:\n  apikey:\n  option:\n\n# Livere\n# https://www.livere.com/\nlivere:\n  uid:\n\n# Gitalk\n# https://github.com/gitalk/gitalk\ngitalk:\n  client_id:\n  client_secret:\n  repo:\n  owner:\n  admin:\n  option:\n\n# Valine\n# https://valine.js.org\nvaline:\n  appId:\n  appKey:\n  avatar: monsterid\n  # This configuration is suitable for domestic custom domain name users, overseas version will be automatically detected (no need to manually fill in)\n  serverURLs:\n  bg:\n  # Use Valine visitor count as the page view count\n  visitor: false\n  option:\n\n# Waline - A simple comment system with backend support fork from Valine\n# https://waline.js.org/\nwaline:\n  serverURL:\n  bg:\n  # Use Waline pageview count as the page view count\n  pageview: false\n  option:\n\n# Utterances\n# https://utteranc.es/\nutterances:\n  repo:\n  # Issue Mapping: pathname/url/title/og:title\n  issue_term: pathname\n  # Theme: github-light/github-dark/github-dark-orange/icy-dark/dark-blue/photon-dark\n  light_theme: github-light\n  dark_theme: photon-dark\n  js:\n  option:\n\n# Facebook Comments Plugin\n# https://developers.facebook.com/docs/plugins/comments/\nfacebook_comments:\n  app_id:\n  # optional\n  user_id:\n  pageSize: 10\n  # Choose: social / time / reverse_time\n  order_by: social\n  lang: en_US\n\n# Twikoo\n# https://github.com/imaegoo/twikoo\ntwikoo:\n  envId:\n  region:\n  # Use Twikoo visitor count as the page view count\n  visitor: false\n  option:\n\n# Giscus\n# https://giscus.app/\ngiscus:\n  repo:\n  repo_id:\n  category_id:\n  light_theme: light\n  dark_theme: dark\n  js:\n  option:\n\n# Remark42\n# https://remark42.com/docs/configuration/frontend/\nremark42:\n  host:\n  siteId:\n  option:\n\n# Artalk\n# https://artalk.js.org/guide/frontend/config.html\nartalk:\n  server:\n  site:\n  # Use Artalk visitor count as the page view count\n  visitor: false\n  option:\n\n# --------------------------------------\n# èŠå¤©æœåŠ¡é…ç½®\n# --------------------------------------\n\nchat:\n  # èŠå¤©æœåŠ¡ç±»å‹ï¼Œå¯é€‰å€¼ï¼šchatra/tidio/crispï¼Œå¦‚æœä¸éœ€è¦èŠå¤©åŠŸèƒ½åˆ™ç•™ç©º\n  use: \n  # æ¨èä½¿ç”¨èŠå¤©æŒ‰é’®ï¼Œä¼šåœ¨ç½‘ç«™å³ä¸‹è§’åˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œå¹¶éšè—åŸå§‹æŒ‰é’®\n  rightside_button: false\n  # åŸå§‹èŠå¤©æŒ‰é’®åœ¨å‘ä¸Šæ»šåŠ¨æ—¶æ˜¾ç¤ºï¼Œå‘ä¸‹æ»šåŠ¨æ—¶éšè—\n  button_hide_show: false\n\n# https://chatra.io/\nchatra:\n  id:\n\n# https://www.tidio.com/\ntidio:\n  public_key:\n\n# https://crisp.chat/en/\ncrisp:\n  website_id:\n\n# --------------------------------------\n# åˆ†ææœåŠ¡é…ç½®\n# --------------------------------------\n\n# https://tongji.baidu.com/web/welcome/login\nbaidu_analytics:\n\n# https://analytics.google.com/analytics/web/\ngoogle_analytics:\n\n# https://www.cloudflare.com/zh-tw/web-analytics/\ncloudflare_analytics:\n\n# https://clarity.microsoft.com/\nmicrosoft_clarity:\n\n# https://umami.is/\numami_analytics:\n  enable: false\n  # For self-hosted setups, configure the hostname of the Umami instance\n  serverURL:\n  website_id:\n  option:\n  UV_PV:\n    site_uv: false\n    site_pv: false\n    page_pv: false\n    # Umami Cloud (API key) / self-hosted Umami (token)\n    token:\n\n# --------------------------------------\n# å¹¿å‘Šé…ç½®\n# --------------------------------------\n\n# Google Adsense\ngoogle_adsense:\n  enable: false\n  auto_ads: true\n  js: https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\n  client:\n  enable_page_level_ads: true\n\n# Insert ads manually\n# Leave it empty if you don't need ads\nad:\n  # Insert ads in the index (every three posts)\n  index:\n  # Insert ads in aside\n  aside:\n  # Insert ads in the post (before pagination)\n  post:\n\n# --------------------------------------\n# ç«™ç‚¹éªŒè¯é…ç½®\n# --------------------------------------\n\n\nsite_verification:\n  # - name: google-site-verification\n  #   content: xxxxxx\n  # - name: baidu-site-verification\n  #   content: xxxxxxx\n\n# --------------------------------------\n# ç¾åŒ– / æ•ˆæœ\n# --------------------------------------\n# ä¸»é¢˜é¢œè‰²è‡ªå®šä¹‰\n# æ³¨æ„ï¼šé¢œè‰²å€¼å¿…é¡»ç”¨åŒå¼•å·ï¼Œå¦‚ \"#000\"ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ï¼\n# ä¸»é¢˜é¢œè‰²é…ç½®\n# theme_color:\n#   æ˜¯å¦å¯ç”¨ä¸»é¢˜é¢œè‰²\n#   enable: true\n#   ä¸»é¢œè‰²\n#   main: \"#49B1F5\"\n#   åˆ†é¡µå™¨é¢œè‰²\n#   paginator: \"#00c4b6\"\n#   æŒ‰é’®æ‚¬åœé¢œè‰²\n#   button_hover: \"#FF7242\"\n#   æ–‡æœ¬é€‰æ‹©é¢œè‰²\n#   text_selection: \"#00c4b6\"\n#   é“¾æ¥é¢œè‰²\n#   link_color: \"#99a9bf\"\n#   å…ƒæ•°æ®é¢œè‰²\n#   meta_color: \"#858585\"\n#   æ°´å¹³çº¿é¢œè‰²\n#   hr_color: \"#A4D8FA\"\n#   ä»£ç å‰æ™¯è‰²\n#   code_foreground: \"#F47466\"\n#   ä»£ç èƒŒæ™¯è‰²\n#   code_background: \"rgba(27, 31, 35, .05)\"\n#   ç›®å½•é¢œè‰²\n#   toc_color: \"#00c4b6\"\n#   å¼•ç”¨å—å¡«å……é¢œè‰²\n#   blockquote_padding_color: \"#49b1f5\"\n#   å¼•ç”¨å—èƒŒæ™¯é¢œè‰²\n#   blockquote_background_color: \"#49b1f5\"\n#   æ»šåŠ¨æ¡é¢œè‰²\n#   scrollbar_color: \"#49b1f5\"\n#   æµ…è‰²æ¨¡å¼ä¸‹çš„ä¸»é¢˜é¢œè‰²\n#   meta_theme_color_light: \"ffffff\"\n#   æ·±è‰²æ¨¡å¼ä¸‹çš„ä¸»é¢˜é¢œè‰²\n#   meta_theme_color_dark: \"#0d0d0d\"\n\n# åˆ†ç±»å’Œæ ‡ç±¤é¡µé¢çš„ç”¨æˆ·ç•Œé¢è®¾ç½®\n# é€‰æ‹©ï¼šindex - ä¸ä¸»é¡µ UI ç›¸åŒ / default - ä¸å½’æ¡£ UI ç›¸åŒ\n# ç•™ç©ºæˆ–è®¾ç½®ä¸º index\ncategory_ui:\ntag_ui:\n\n# Rounded corners for UI elements\nrounded_corners_ui: true\n\n# æ‹‰ä¼¸è¡Œä½¿æ¯è¡Œå®½åº¦ç›¸ç­‰\ntext_align_justify: false\n\n# ä¸ºé¡µçœ‰å’Œé¡µè„šæ·»åŠ é®ç½©\nmask:\n  header: true\n  footer: true\n\n# åŠ è½½åŠ¨ç”»\npreloader:\n  enable: false\n  # èµ„æº\n  # 1. å…¨å±åŠ è½½\n  # 2. è¿›åº¦æ¡\n  source: 1\n  # pace theme (see https://codebyzach.github.io/pace/)\n  pace_css_url:\n\n# é¡µé¢è¿‡æ¸¡æ•ˆæœ\nenter_transitions: true\n\n# é»˜è®¤æ˜¾ç¤ºæ¨¡å¼ - light (é»˜è®¤) / dark\ndisplay_mode: light\n\n# ç¾åŒ–æ–‡ç« å†…å®¹çš„é…ç½®\nbeautify:\n  # æ˜¯å¦å¯ç”¨ç¾åŒ–\n  enable: false\n  # æŒ‡å®šç¾åŒ–çš„èŒƒå›´ (site æˆ– post)\n  field: post\n  # æŒ‡å®šæ ‡é¢˜å‰ç¼€å›¾æ ‡ï¼Œå¦‚ '\\f0c1'\n  title-prefix-icon:\n  # æŒ‡å®šæ ‡é¢˜å‰ç¼€å›¾æ ‡çš„é¢œè‰²ï¼Œå¦‚ '#F47466'\n  title-prefix-icon-color:\n\n# å…¨å±€å­—ä½“è®¾ç½®\n# é™¤éæ‚¨çŸ¥é“å®ƒä»¬çš„å·¥ä½œåŸç†ï¼Œå¦åˆ™ä¸è¦ä¿®æ”¹ä»¥ä¸‹è®¾ç½®\nfont:\n  global_font_size:\n  code_font_size:\n  font_family:\n  code_font_family:\n\n# ç½‘ç«™æ ‡é¢˜å’Œå‰¯æ ‡é¢˜çš„å­—ä½“è®¾ç½®\nblog_title_font:\n  font_link:\n  font_family:\n\n# åˆ†éš”ç¬¦å›¾æ ‡çš„è®¾ç½®\nhr_icon:\n# æ˜¯å¦å¯ç”¨åˆ†éš”ç¬¦å›¾æ ‡\n  enable: true\n  # Font Awesome å›¾æ ‡çš„ unicode å€¼ï¼Œå¦‚ '\\3423'\n  icon:\n  icon_top:\n\n# æ‰“å­—æœºæ•ˆæœ\n# https://github.com/disjukr/activate-power-mode\nactivate_power_mode:\n  # æ˜¯å¦å¯ç”¨æ‰“å­—æœºæ•ˆæœ\n  enable: false\n  # æ˜¯å¦å¯ç”¨å½©è‰²æ•ˆæœ\n  colorful: true\n  # æ˜¯å¦å¯ç”¨éœ‡åŠ¨æ•ˆæœ\n  shake: true\n  # æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ç”¨\n  mobile: false\n\n# èƒŒæ™¯æ•ˆæœ\n# --------------------------------------\n\n# canvas_ribbon\n# å‚è§: https://github.com/hustcc/ribbon.js\ncanvas_ribbon:\n  # æ˜¯å¦å¯ç”¨ canvas_ribbon\n  enable: false\n  # ribbon çš„å¤§å°\n  size: 150\n  # ribbon çš„ä¸é€æ˜åº¦ (0 ~ 1)\n  alpha: 0.6\n  zIndex: -1\n  # æ˜¯å¦ç‚¹å‡»æ›´æ”¹é¢œè‰²\n  click_to_change: false\n  # æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ç”¨\n  mobile: false\n\n# Fluttering Ribbon\ncanvas_fluttering_ribbon:\n  enable: false\n  mobile: false\n\n# canvas_nest\n# https://github.com/hustcc/canvas-nest.js\ncanvas_nest:\n  # æ˜¯å¦å¯ç”¨ canvas_nest\n  enable: true\n  # çº¿æ¡é¢œè‰²ï¼Œé»˜è®¤: '0,0,0'; RGB å€¼: (R,G,B).(æ³¨æ„: ä½¿ç”¨ ',' åˆ†éš”.)\n  color: '0,0,255'\n  # çº¿æ¡çš„ä¸é€æ˜åº¦ (0~1)\n  opacity: 0.7\n  # èƒŒæ™¯çš„ z-index å±æ€§\n  zIndex: -1\n  # çº¿æ¡æ•°é‡\n  count: 99\n  # æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ç”¨\n  mobile: false\n\n# é¼ æ ‡ç‚¹å‡»æ•ˆæœ: çƒŸèŠ±\nfireworks:\n  # æ˜¯å¦å¯ç”¨çƒŸèŠ±æ•ˆæœ\n  enable: true\n  zIndex: 9999\n  # æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ç”¨\n  mobile: false\n\n# é¼ æ ‡ç‚¹å‡»æ•ˆæœ: å¿ƒå½¢ç¬¦å·\nclick_heart:\n  # æ˜¯å¦å¯ç”¨å¿ƒå½¢ç¬¦å·æ•ˆæœ\n  enable: false\n  # æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ç”¨\n  mobile: false\n\n# é¼ æ ‡ç‚¹å‡»æ•ˆæœ: æ–‡å­—\nclickShowText:\n  # æ˜¯å¦å¯ç”¨æ–‡å­—æ•ˆæœ\n  enable: false\n  text:\n    # - I\n    # - LOVE\n    # - YOU\n  fontSize: 15px\n  # æ˜¯å¦éšæœºæ˜¾ç¤ºæ–‡å­—\n  random: false\n  # æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ç”¨\n  mobile: false\n\n# --------------------------------------\n# Lightbox Settings\n# --------------------------------------\n\n# Choose: fancybox / medium_zoom\n# https://github.com/francoischalifour/medium-zoom\n# https://fancyapps.com/fancybox/\n# Leave it empty if you don't need lightbox\nlightbox:\n\n# --------------------------------------\n# æ ‡ç±¤å¤–æŒ‚è®¾ç½®\n# --------------------------------------\n\n# ç³»åˆ—\nseries:\n# æ˜¯å¦å¯ç”¨ç³»åˆ—\n  enable: false\n  # æŒ‰æ ‡é¢˜æˆ–æ—¥æœŸæ’åº\n  orderBy: 'title'\n  # æ’åºé¡ºåºï¼š1 è¡¨ç¤ºå‡åºï¼Œ-1 è¡¨ç¤ºé™åº\n  order: 1\n  number: true\n\n# ABCJS - ABC éŸ³ä¹ç¬¦å·æ’ä»¶\n# https://github.com/paulrosen/abcjs\nabcjs:\n  enable: false\n  per_page: true\n\n# Mermaid\n# https://github.com/mermaid-js/mermaid\nmermaid:\n  enable: false\n  # Write Mermaid diagrams using code blocks\n  code_write: false\n  # built-in themes: default / forest / dark / neutral\n  theme:\n    light: default\n    dark: dark\n\n# chartjs\n# see https://www.chartjs.org/docs/latest/\nchartjs:\n  enable: false\n  # Do not modify unless you understand how they work.\n  # The default settings are only used when the MD syntax is not specified.\n  # General font color for the chart\n  fontColor:\n    light: 'rgba(0, 0, 0, 0.8)'\n    dark: 'rgba(255, 255, 255, 0.8)'\n  # General border color for the chart\n  borderColor:\n    light: 'rgba(0, 0, 0, 0.1)'\n    dark: 'rgba(255, 255, 255, 0.2)'\n  # Background color for scale labels on radar and polar area charts\n  scale_ticks_backdropColor:\n    light: 'transparent'\n    dark: 'transparent'\n\n# Note - Bootstrap Callout\nnote:\n  # Note tag style values:\n  #  - simple    bs-callout old alert style. Default.\n  #  - modern    bs-callout new (v2-v3) alert style.\n  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.\n  #  - disabled  disable all CSS styles import of note tag.\n  style: flat\n  icons: true\n  border_radius: 3\n  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).\n  # Offset also applied to label tag variables. This option can work with disabled note tag.\n  light_bg_offset: 0\n\n# --------------------------------------\n# å…¶ä»–è®¾ç½®\n# --------------------------------------\n\n# https://github.com/MoOx/pjax\npjax:\n# æ˜¯å¦å¯ç”¨ pjax\n  enable: false\n # æ’é™¤æŒ‡å®šé¡µé¢ä¸ä½¿ç”¨ pjaxï¼Œå¦‚ '/music/'\n  exclude:\n    # - /xxxxxx/\n\n# æ³¨å…¥ CSS å’Œè„šæœ¬ (aplayer/meting)\naplayerInject:\n# æ˜¯å¦å¯ç”¨æ³¨å…¥\n  enable: false\n  # æ˜¯å¦æ¯é¡µå¯ç”¨\n  per_page: true\n\n# Snackbar - Toast Notification\n# https://github.com/polonel/SnackBar\n# position: top-left / top-center / top-right / bottom-left / bottom-center / bottom-right\nsnackbar:\n  enable: false\n  position: bottom-left\n  # The background color of Toast Notification in light mode and dark mode\n  bg_light: '#49b1f5'\n  bg_dark: '#1f1f1f'\n\n# Instant.page\n# https://instant.page/\ninstantpage: false\n\n# Pangu - åœ¨ä¸­æ–‡å­—ç¬¦å’Œè‹±æ–‡å­—ç¬¦ä¹‹é—´æ’å…¥ç©ºæ ¼\n# https://github.com/vinta/pangu.js\npangu:\n  enable: false\n  # Specify the field to use pangu (site or post)\n  field: site\n\n# Lazyload\n# https://github.com/verlok/vanilla-lazyload\nlazyload:\n  enable: false\n  # Specify the field to use lazyload (site or post)\n  field: site\n  placeholder:\n  blur: false\n\n# PWA\n# See https://github.com/JLHwung/hexo-offline\n# ---------------\npwa:\n  enable: false\n  manifest:\n  apple_touch_icon:\n  favicon_32_32:\n  favicon_16_16:\n  mask_icon:\n\n# Open graph meta tags\n# https://hexo.io/docs/helpers#open-graph\nOpen_Graph_meta:\n  enable: true\n  option:\n    # twitter_card:\n    # twitter_image:\n    # twitter_id:\n    # twitter_site:\n    # google_plus:\n    # fb_admins:\n    # fb_app_id:\n\n# Add the vendor prefixes to ensure compatibility\ncss_prefix: true\n\n# Inject\n# æ’å…¥ä»£ç åˆ° headï¼ˆåœ¨ '</head>' æ ‡ç±¤ä¹‹å‰ï¼‰å’Œåº•éƒ¨ï¼ˆåœ¨ '</body>' æ ‡ç±¤ä¹‹å‰ï¼‰\ninject:\n  head:\n    # - <link rel=\"stylesheet\" href=\"/xxx.css\">\n    - <meta name=\"referrer\" content=\"no-referrer\"/>\n  bottom:\n    # - <script src=\"xxxx\"></script>\n\n# CDN è®¾ç½®\n# é™¤éä½ çŸ¥é“å®ƒä»¬çš„å·¥ä½œåŸç†ï¼Œå¦åˆ™ä¸è¦ä¿®æ”¹ä»¥ä¸‹è®¾ç½®\nCDN:\n  # å†…éƒ¨å’Œç¬¬ä¸‰æ–¹è„šæœ¬çš„ CDN æä¾›å•†\n  # ä¸¤è€…çš„é€‰é¡¹ï¼šlocal/jsdelivr/unpkg/cdnjs/custom\n  # æ³¨æ„ï¼š Dev ç‰ˆæœ¬åªèƒ½ä½¿ç”¨ 'local' ä½œä¸ºå†…éƒ¨è„šæœ¬\n  # æ³¨æ„ï¼šå°†ç¬¬ä¸‰æ–¹è„šæœ¬è®¾ç½®ä¸º 'local' æ—¶ï¼Œéœ€è¦å®‰è£… hexo-butterfly-extjs\n  internal_provider: local\n  third_party_provider: local\n\n  # æ˜¯å¦åœ¨ URL ä¸­æ·»åŠ ç‰ˆæœ¬å·ï¼Œtrue æˆ– false\n  version: false\n\n  # è‡ªå®šä¹‰æ ¼å¼\n  # ä¾‹å¦‚ï¼šhttps://cdn.staticfile.org/${cdnjs_name}/${version}/${min_cdnjs_file}\n  custom_format:\n\n  option:\n    # abcjs_basic_js:\n    # activate_power_mode:\n    # algolia_js:\n    # algolia_search:\n    # aplayer_css:\n    # aplayer_js:\n    # artalk_css:\n    # artalk_js:\n    # blueimp_md5:\n    # busuanzi:\n    # canvas_fluttering_ribbon:\n    # canvas_nest:\n    # canvas_ribbon:\n    # chartjs:\n    # click_heart:\n    # clickShowText:\n    # disqusjs:\n    # disqusjs_css:\n    # docsearch_css:\n    # docsearch_js:\n    # egjs_infinitegrid:\n    # fancybox:\n    # fancybox_css:\n    # fireworks:\n    # fontawesome:\n    # gitalk:\n    # gitalk_css:\n    # giscus:\n    # instantpage:\n    # instantsearch:\n    # katex:\n    # katex_copytex:\n    # lazyload:\n    # local_search:\n    # main:\n    # main_css:\n    # mathjax:\n    # medium_zoom:\n    # mermaid:\n    # meting_js:\n    # pangu:\n    # prismjs_autoloader:\n    # prismjs_js:\n    # prismjs_lineNumber_js:\n    # pjax:\n    # sharejs:\n    # sharejs_css:\n    # snackbar:\n    # snackbar_css:\n    # translate:\n    # twikoo:\n    # typed:\n    # utils:\n    # valine:\n    # waline_css:\n    # waline_js:\n```\n\n## è¯­è¨€\n\nä¿®æ”¹ Hexo æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ `_config.yml`\n\né»˜è®¤è¯­è¨€æ˜¯ en\n\nä¸»é¢˜æ”¯æŒ\n\n- default(en)\n- zh-CN ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰\n- zh-TW ï¼ˆå°æ¹¾ç¹ä½“ä¸­æ–‡ï¼‰\n- zh-HK ï¼ˆé¦™æ¸¯ç¹ä½“ä¸­æ–‡ï¼‰\n- ja ï¼ˆæ—¥è¯­ï¼‰\n- koï¼ˆéŸ©è¯­ï¼‰\n\n![image-20241105130223438](../img/Butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96%E4%B9%8B%E8%B7%AF/0228241de3d58331ba40050aea7268a0697559838.png)\n\n## å¯¼èˆª\n\n### å‚æ•°è®¾ç½®\n\n```\nnav:\n  # å¯¼èˆªæ  Logo å›¾ç‰‡\n  logo:\n  # æ˜¯å¦æ˜¾ç¤ºæ ‡é¢˜\n  display_title: true\n  # æ˜¯å¦å›ºå®šå¯¼èˆªæ \n  fixed: false\n```\n\n### ç›®å½•\n\nå¯¼èˆªçš„æ–‡å­—å¯è‡ªè¡Œæ›´æ”¹ï¼š\n\næ ¼å¼ï¼šåå­—: è·¯å¾„ `||` å›¾æ ‡å\n\nä¾‹å¦‚ï¼š\n\n```yaml\nmenu:\né¦–é¡µ: / || fas fa-home\næ—¶é—´è½´: /archives/ || fas fa-archive\næ ‡ç­¾: /tags/ || fas fa-tags\nåˆ†ç±»: /categories/ || fas fa-folder-open\næ¸…å•||fa fa-heartbeat:\nç…§ç‰‡: /Gallery/ || fas fa-images\nå‹é“¾: /link/ || fas fa-link\nå…³äº: /about/ || fas fa-heart\nåˆ—è¡¨||fas fa-list:\n  éŸ³ä¹: /music/ || fas fa-music\n  ç”µå½±: /movies/ || fas fa-video\n```\n\né»˜è®¤å­ç›®å½•æ˜¯å±•å¼€çš„ï¼Œå¦‚æœä½ æƒ³è¦éšè—ï¼Œåœ¨å­ç›®å½•é‡Œæ·»åŠ `hide:`\n\n```yaml\nåˆ—è¡¨ || fas fa-list || hide:\n  éŸ³ä¹: /music/ || fas fa-music\n  ç”µå½±: /movies/ || fas fa-video\n```\n\næˆ‘çš„ç›®å½•ï¼š\n\n```yaml\nmenu:\n  é¦–é¡µ: / || fas fa-home\n  æ ‡ç­¾: /tags/ || fas fa-tags\n  åˆ†ç±»: /categories/ || fas fa-folder-open\n  å‹é“¾: /link/ || fas fa-link\n  åˆ—è¡¨ || fas fa-list || hide:\n    éŸ³ä¹: /music/ || fas fa-music\n    ç”µå½±: /movies/ || fas fa-video\n```\n\n## ä»£ç é«˜äº®\n\nHighlight.js æ˜¯ç”¨ JavaScript ç¼–å†™çš„è¯­æ³•é«˜äº®å·¥å…·ã€‚å®ƒé€‚ç”¨äº æµè§ˆå™¨ä»¥åŠæœåŠ¡å™¨ä¸Šã€‚å®ƒå‡ ä¹å¯ä»¥ä¸ä»»ä½• æ ‡è®°ï¼Œä¸ä¾èµ–äºä»»ä½•å…¶ä»–æ¡†æ¶ï¼Œå¹¶ä¸”å…·æœ‰è‡ªåŠ¨è¯­è¨€ æ£€æ³¢ã€‚\n\n```\n#å¸è½½é»˜è®¤çš„é«˜äº®æ’ä»¶\nnpm uninstall  hexo-prism-plugin\né€šè¿‡ NPM åŒ…å®‰è£…Highlight.js \nnpm install highlight.js\nhexo clean && hexo g && hexo s\n```\n\n## è¯„è®ºç³»ç»Ÿ\n\næˆ‘ç”¨çš„æ˜¯twikooï¼ˆverceléƒ¨ç½²ï¼‰å…è´¹\n\nå…·ä½“é…ç½®å¯å‚è€ƒ [äº‘å‡½æ•°éƒ¨ç½² | Twikoo æ–‡æ¡£](https://twikoo.js.org/backend.html#vercel-éƒ¨ç½²)\n\n```\ntwikoo:\n  envId: https://å¡«å†™verceléƒ¨ç½²å¥½çš„åŸŸåï¼Œå»ºè®®è‡ªå®šä¹‰åŸŸå\n  region:\n  # Use Twikoo visitor count as the page view count\n  visitor: false\n  option:\n```\n\n## æ–‡ç« åŠ å¯†\n\n```\nnpm install --save hexo-blog-encrypt\n```\n\nåœ¨æ–‡ç« å¼€å¤´æ·»åŠ `passwd`\n\n```\n---\ntitle: Hello World\npassword: hello\n#å¯†ç å°±æ˜¯hello\nwrong_pass_message: 'æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•.'\nwrong_hash_message: 'æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.'\nmessage: å‰å¾€å…³äºé¡µè”ç³»æœ¬äºº\n---\n```\n\nèƒ½å¦æˆåŠŸåŠ å¯†æœ‰ä¸ªå‰ææ¡ä»¶ï¼Œè®¿é—®ç½‘ç«™çš„åè®®è¦æ˜¯httpsï¼Œæ‰€ä»¥ä½ è¦ç»™ä½ çš„ç½‘ç«™æ·»åŠ `sslè¯ä¹¦`å³å¯ï¼Œæ²¡æœ‰æ·»åŠ çš„å³ä½¿è¾“å…¥å¯†ç ä¹Ÿæ²¡æœ‰æ•ˆæœï¼Œè§£é”ä¸äº†çš„\n\n![image-20241108212212875](../img/Butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96%E4%B9%8B%E8%B7%AF/8d36bf594e87766274f4eca3ba31484c697559838.png)\n\n## æ–‡ç« è‡ªåŠ¨ç¼–å·\n\næˆ‘æ˜¯è‡ªå·±åŠ äº†ä¸€ä¸ª`hexo-theme-butterfly\\source\\css\\my.css`æ·»åŠ äº†ä»¥ä¸‹å†…å®¹ã€‚\n\n```\n/*æ–‡ç« ç¼–å·*/\n/* è®© h1 è§¦å‘é‡ç½® h2-h6 çš„è®¡æ•° */\n.post-content h1 {\n    counter-reset: main-section !important;  /* å…³é”®ï¼šç¡®ä¿æ¯ä¸ª h1 é‡æ–°å¼€å§‹ h2 è®¡æ•° */\n}\n\n/* h2 ä½œä¸ºä¸»è¦ç¼–å·ï¼ˆ1. 2. 3.ï¼‰*/\n.post-content h2 {\n    counter-increment: main-section !important;\n    counter-reset: sub-section !important;\n}\n\n.post-content h2::before {\n    content: counter(main-section) \". \" !important;\n}\n\n/* h3 ä½œä¸ºæ¬¡çº§ç¼–å·ï¼ˆ1.1 1.2 2.1 2.2ï¼‰ */\n.post-content h3 {\n    counter-increment: sub-section !important;\n    counter-reset: sub-sub-section !important;\n}\n\n.post-content h3::before {\n    content: counter(main-section) \".\" counter(sub-section) \". \" !important;\n}\n\n/* h4 ä¸‰çº§ç¼–å·ï¼ˆ1.1.1 2.1.1ï¼‰ */\n.post-content h4 {\n    counter-increment: sub-sub-section !important;\n    counter-reset: sub-sub-sub-section !important;\n}\n\n.post-content h4::before {\n    content: counter(main-section) \".\" counter(sub-section) \".\" counter(sub-sub-section) \". \" !important;\n}\n\n/* h5 å››çº§ç¼–å·ï¼ˆ1.1.1.1 2.1.1.1ï¼‰ */\n.post-content h5 {\n    counter-increment: sub-sub-sub-section !important;\n    counter-reset: sub-sub-sub-sub-section !important;\n}\n\n.post-content h5::before {\n    content: counter(main-section) \".\" counter(sub-section) \".\" counter(sub-sub-section) \".\" counter(sub-sub-sub-section) \". \" !important;\n}\n\n/* h6 äº”çº§ç¼–å·ï¼ˆ1.1.1.1.1 2.1.1.1.1ï¼‰ */\n.post-content h6 {\n    counter-increment: sub-sub-sub-sub-section !important;\n}\n\n.post-content h6::before {\n    content: counter(main-section) \".\" counter(sub-section) \".\" counter(sub-sub-section) \".\" counter(sub-sub-sub-section) \".\" counter(sub-sub-sub-sub-section) \". \" !important;\n}\n\n/* è®¾ç½®æ ‡é¢˜ä¹‹é—´çš„é—´è· */\n.post-content h2 { margin: 40px 0; }\n.post-content h3 { margin: 30px 0; }\n.post-content h4 { margin: 20px 0; }\n.post-content h5 { margin: 15px 0; }\n.post-content h6 { margin: 10px 0; }\n\n/*ä¾§è¾¹æ å¼€å§‹ç¼–å·*/\n/* åˆå§‹åŒ– toc-level-2 çš„è®¡æ•°å™¨ */\n.toc {\n    counter-reset: toc-section;\n}\n\n/* è®© toc-level-2 ä½œä¸ºç¼–å·çš„èµ·ç‚¹ */\n.toc .toc-level-2 {\n    counter-reset: toc-subsection; /* æ¯ä¸ª toc-level-2 å¼€å§‹æ–°çš„å­è®¡æ•° */\n    counter-increment: toc-section; /* å¢åŠ ä¸€çº§è®¡æ•° */\n}\n\n/* åœ¨é“¾æ¥å‰é¢æ·»åŠ ç¼–å· */\n.toc .toc-level-2 > a::before {\n    content: counter(toc-section) \".\";\n    font-weight: bold;\n    margin-right: 5px;\n}\n\n/* toc-level-3 å¼€å§‹äºŒçº§ç¼–å· */\n.toc .toc-level-3 {\n    counter-reset: toc-subsubsection;\n    counter-increment: toc-subsection;\n}\n\n.toc .toc-level-3 > a::before {\n    content: counter(toc-section) \".\" counter(toc-subsection) \".\";\n    font-weight: bold;\n    margin-right: 5px;\n}\n\n/* toc-level-4 å¼€å§‹ä¸‰çº§ç¼–å· */\n.toc .toc-level-4 {\n    counter-increment: toc-subsubsection;\n}\n\n.toc .toc-level-4 > a::before {\n    content: counter(toc-section) \".\" counter(toc-subsection) \".\" counter(toc-subsubsection) \".\";\n    font-weight: bold;\n    margin-right: 5px;\n}\n\n/* éšè—ä¸»é¢˜è‡ªå¸¦çš„ç¼–å· */\n.toc .toc-number {\n    display: none;\n}\nspan.toc-text {\n    margin-left: -10px;\n}\n```\n\næ•ˆæœå›¾\n\n![image-20241117192718651](../img/Butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96%E4%B9%8B%E8%B7%AF/image-20241117192718651.png)\n\n## æ”¯æŒKaTeXæ•°å­¦å…¬å¼å’Œä¸‹æ ‡\n\n### ä¸Šä¸‹æ ‡æ”¯æŒï¼š\n\nHexo éœ€è¦ä½¿ç”¨ Markdown æ¸²æŸ“å¼•æ“å°† md æ–‡ä»¶æ¸²æŸ“æˆ html æ–‡ä»¶ï¼ŒHexo é»˜è®¤ä½¿ç”¨ hexo-renderer-markedï¼Œå¯ä»¥æ¢æˆ hexo-renderer-markdown-itã€‚\n\n[hexo-renderer-markdown-it](https://github.com/hexojs/hexo-renderer-markdown-it) æ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½ï¼Œå¦‚ï¼šä¸Šæ ‡ã€ä¸‹æ ‡ã€å¼•ç”¨æ³¨è„šã€emojiã€KaTex å…¬å¼ã€å¤šç»´è¡¨æ ¼ç­‰ç­‰ã€‚\n\nå…ˆå¸è½½ Hexo é»˜è®¤å¼•æ“\n\n```\nnpm un hexo-renderer-marked --save\n```\n\nå®‰è£… markdown-it å¼•æ“\n\n```\nnpm i hexo-renderer-markdown-it --save\n```\n\nåœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.yml ä¸­å¢åŠ ä»¥ä¸‹é…ç½®\n\n```\nmarkdown:\n  markdown:\n  preset: 'default'\n  render:\n    html: true\n    xhtmlOut: false\n    langPrefix: 'language-'\n    breaks: true\n    linkify: true\n    typographer: true\n    quotes: 'â€œâ€â€˜â€™'\n  enable_rules:\n  disable_rules:\n  plugins:\n    - 'markdown-it-footnote'\n    - 'markdown-it-ins'\n    - 'markdown-it-mark'\n    - 'markdown-it-sub'\n    - 'markdown-it-sup'\n  images:\n    lazyload: false\n    prepend_root: false\n    post_asset: true\n```\n\n```\né…ç½®ä¸­çš„ typographer: true çš„ä½œç”¨æ˜¯æ˜¾ç¤ºç‰¹æ®Šæ ¼å¼å­—ç¬¦\n\nå†™æ³•ï¼š\n(c) (C) (r) (R) (tm) (TM) (p) (P) +-\n\næ•ˆæœï¼š\nÂ© Â© Â® Â® â„¢ â„¢ (p) (P) Â±\n```\n\nå…¶ä»–ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ markdown-it çš„[å®˜æ–¹æ•ˆæœæ¼”ç¤º Demo](https://markdown-it.github.io/)\n\n### æ•°å­¦å…¬å¼\n\n```\nnpm i @traptitech/markdown-it-katex --save\n```\n\nåœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.yml ä¸­å¢åŠ ä»¥ä¸‹é…ç½®\n\n```\nmarkdown_it_katex:\n  plugins:\n  - plugin:\n    name: '@traptitech/markdown-it-katex'\n    options: # see https://katex.org/docs/options.html\n      blockClass: \"math-block\"\n      strict: false\n      throwOnError: false\n      errorColor: \"#cc0000\"\n```\n\n![image-20250123234349921](../img/Butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96%E4%B9%8B%E8%B7%AF/f6c459201fe2d2f36e88e4bbf96e00da697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Butterfly"],"categories":["Hexo"]},{"title":"JavaScript","url":"/posts/cc1b9611/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# JavaScript åŸºç¡€\n\næœ¬ç¬”è®°æ•´ç†è‡ª[é»‘é©¬ç¨‹åºå‘˜å‰ç«¯JavaScriptå…¥é—¨åˆ°ç²¾é€šå…¨å¥—è§†é¢‘æ•™ç¨‹ï¼Œjavascriptæ ¸å¿ƒè¿›é˜¶ES6è¯­æ³•ã€APIã€jsé«˜çº§ç­‰åŸºç¡€çŸ¥è¯†å’Œå®æˆ˜æ•™ç¨‹](https://www.bilibili.com/video/BV1Y84y1L7Nn/?share_source=copy_web&vd_source=ee3bb79c6a500b8fb62eb9daab5faedb)\n\n## ä»‹ç»\n\n> æŒæ¡ JavaScript çš„å¼•å…¥æ–¹å¼ï¼Œåˆæ­¥è®¤è¯† JavaScript çš„ä½œç”¨\n\n### å¼•å…¥æ–¹å¼\n\nJavaScript ç¨‹åºä¸èƒ½ç‹¬ç«‹è¿è¡Œï¼Œå®ƒéœ€è¦è¢«åµŒå…¥ HTML ä¸­ï¼Œç„¶åæµè§ˆå™¨æ‰èƒ½æ‰§è¡Œ JavaScript ä»£ç ã€‚é€šè¿‡ `script` æ ‡ç­¾å°† JavaScript ä»£ç å¼•å…¥åˆ° HTML ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š\n\n#### å†…éƒ¨æ–¹å¼\n\né€šè¿‡ `script` æ ‡ç­¾åŒ…è£¹ JavaScript ä»£ç \n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¼•å…¥æ–¹å¼</title>\n</head>\n<body>\n  <!-- å†…è”å½¢å¼ï¼šé€šè¿‡ script æ ‡ç­¾åŒ…è£¹ JavaScript ä»£ç  -->\n  <script>\n    alert('å—¨ï¼Œæ¬¢è¿æ¥ä¸¥åƒå±¹åšå®¢å­¦ä¹ å‰ç«¯æŠ€æœ¯ï¼')\n  </script>\n</body>\n</html>\n```\n\n#### å¤–éƒ¨å½¢å¼\n\nä¸€èˆ¬å°† JavaScript ä»£ç å†™åœ¨ç‹¬ç«‹çš„ä»¥ .js ç»“å°¾çš„æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡ `script` æ ‡ç­¾çš„ `src` å±æ€§å¼•å…¥\n\n```javascript\n// demo.js\ndocument.write('å—¨ï¼Œæ¬¢è¿æ¥ä¸¥åƒå±¹åšå®¢å­¦ä¹ å‰ç«¯æŠ€æœ¯ï¼')\n```\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¼•å…¥æ–¹å¼</title>\n</head>\n<body>\n  <!-- å¤–éƒ¨å½¢å¼ï¼šé€šè¿‡ script çš„ src å±æ€§å¼•å…¥ç‹¬ç«‹çš„ .js æ–‡ä»¶ -->\n  <script src=\"demo.js\"></script>\n</body>\n</html>\n```\n\nå¦‚æœ script æ ‡ç­¾ä½¿ç”¨ src å±æ€§å¼•å…¥äº†æŸ .js æ–‡ä»¶ï¼Œé‚£ä¹ˆ æ ‡ç­¾çš„ä»£ç ä¼šè¢«å¿½ç•¥ï¼ï¼ï¼å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¼•å…¥æ–¹å¼</title>\n</head>\n<body>\n  <!-- å¤–éƒ¨å½¢å¼ï¼šé€šè¿‡ script çš„ src å±æ€§å¼•å…¥ç‹¬ç«‹çš„ .js æ–‡ä»¶ -->\n  <script src=\"demo.js\">\n    // æ­¤å¤„çš„ä»£ç ä¼šè¢«å¿½ç•¥æ‰ï¼ï¼ï¼ï¼\n  \talert(666);  \n  </script>\n</body>\n</html>\n```\n\n###  æ³¨é‡Šå’Œç»“æŸç¬¦\n\né€šè¿‡æ³¨é‡Šå¯ä»¥å±è”½ä»£ç è¢«æ‰§è¡Œæˆ–è€…æ·»åŠ å¤‡æ³¨ä¿¡æ¯ï¼ŒJavaScript æ”¯æŒä¸¤ç§å½¢å¼æ³¨é‡Šè¯­æ³•ï¼š\n\n#### å•è¡Œæ³¨é‡Š\n\nä½¿ç”¨ `// ` æ³¨é‡Šå•è¡Œä»£ç \n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - æ³¨é‡Š</title>\n</head>\n<body>\n  \n  <script>\n    // è¿™ç§æ˜¯å•è¡Œæ³¨é‡Šçš„è¯­æ³•\n    // ä¸€æ¬¡åªèƒ½æ³¨é‡Šä¸€è¡Œ\n    // å¯ä»¥é‡å¤æ³¨é‡Š\n    document.write('å—¨ï¼Œæ¬¢è¿æ¥ä¸¥åƒå±¹åšå®¢å­¦ä¹ å‰ç«¯æŠ€æœ¯ï¼');\n  </script>\n</body>\n</html>\n```\n\n#### å¤šè¡Œæ³¨é‡Š\n\nä½¿ç”¨ `/* */` æ³¨é‡Šå¤šè¡Œä»£ç \n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - æ³¨é‡Š</title>\n</head>\n<body>\n  \n  <script>\n    /* è¿™ç§çš„æ˜¯å¤šè¡Œæ³¨é‡Šçš„è¯­æ³• */\n    /*\n    \tæ›´å¸¸è§çš„å¤šè¡Œæ³¨é‡Šæ˜¯è¿™ç§å†™æ³•\n    \tåœ¨äº›å¯ä»¥ä»»æ„æ¢è¡Œ\n    \tå¤šå°‘è¡Œéƒ½å¯ä»¥\n      */\n    document.write('å—¨ï¼Œæ¬¢è¿æ¥ä¸¥åƒå±¹åšå®¢å­¦ä¹ å‰ç«¯æŠ€æœ¯ï¼')\n  </script>\n</body>\n</html>\n```\n\n**æ³¨ï¼šç¼–è¾‘å™¨ä¸­å•è¡Œæ³¨é‡Šçš„å¿«æ·é”®ä¸º `ctrl + /`**\n\n### ç»“æŸç¬¦\n\nåœ¨ JavaScript ä¸­ `;` ä»£è¡¨ä¸€æ®µä»£ç çš„ç»“æŸï¼Œå¤šæ•°æƒ…å†µä¸‹å¯ä»¥çœç•¥ `;` ä½¿ç”¨å›è½¦ï¼ˆenterï¼‰æ›¿ä»£ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - ç»“æŸç¬¦</title>\n</head>\n<body>\n  \n  <script> \n    alert(1);\n    alert(2);\n    alert(1)\n    alert(2)\n  </script>\n</body>\n</html>\n```\n\nå®é™…å¼€å‘ä¸­æœ‰è®¸å¤šäººä¸»å¼ ä¹¦å†™ JavaScript ä»£ç æ—¶çœç•¥ç»“æŸç¬¦ `;`\n\n### è¾“å…¥å’Œè¾“å‡º\n\nè¾“å‡ºå’Œè¾“å…¥ä¹Ÿå¯ç†è§£ä¸ºäººå’Œè®¡ç®—æœºçš„äº¤äº’ï¼Œç”¨æˆ·é€šè¿‡é”®ç›˜ã€é¼ æ ‡ç­‰å‘è®¡ç®—æœºè¾“å…¥ä¿¡æ¯ï¼Œè®¡ç®—æœºå¤„ç†åå†å±•ç¤ºç»“æœç»™ç”¨æˆ·ï¼Œè¿™ä¾¿æ˜¯ä¸€æ¬¡è¾“å…¥å’Œè¾“å‡ºçš„è¿‡ç¨‹ã€‚\n\nä¸¾ä¾‹è¯´æ˜ï¼šå¦‚æŒ‰é”®ç›˜ä¸Šçš„æ–¹å‘é”®ï¼Œå‘ä¸Š/ä¸‹é”®å¯ä»¥æ»šåŠ¨é¡µé¢ï¼ŒæŒ‰å‘ä¸Š/ä¸‹é”®è¿™ä¸ªåŠ¨ä½œå«ä½œè¾“å…¥ï¼Œé¡µé¢å‘ç”Ÿäº†æ»šåŠ¨äº†è¿™ä¾¿å«è¾“å‡ºã€‚\n\n#### è¾“å‡º\n\nJavaScript å¯ä»¥æ¥æ”¶ç”¨æˆ·çš„è¾“å…¥ï¼Œç„¶åå†å°†è¾“å…¥çš„ç»“æœè¾“å‡ºï¼š\n\n`alert()`ã€`document.wirte()`\n\nä»¥æ•°å­—ä¸ºä¾‹ï¼Œå‘ `alert()` æˆ– `document.write()`è¾“å…¥ä»»æ„æ•°å­—ï¼Œä»–éƒ½ä¼šä»¥å¼¹çª—å½¢å¼å±•ç¤ºï¼ˆè¾“å‡ºï¼‰ç»™ç”¨æˆ·ã€‚\n\n####  è¾“å…¥\n\nå‘ `prompt()` è¾“å…¥ä»»æ„å†…å®¹ä¼šä»¥å¼¹çª—å½¢å¼å‡ºç°åœ¨æµè§ˆå™¨ä¸­ï¼Œä¸€èˆ¬æç¤ºç”¨æˆ·è¾“å…¥ä¸€äº›å†…å®¹ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - è¾“å…¥è¾“å‡º</title>\n</head>\n<body>\n  \n  <script> \n    // 1. è¾“å…¥çš„ä»»æ„æ•°å­—ï¼Œéƒ½ä¼šä»¥å¼¹çª—å½¢å¼å±•ç¤º\n    document.write('è¦è¾“å‡ºçš„å†…å®¹')\n    alert('è¦è¾“å‡ºçš„å†…å®¹');\n\n    // 2. ä»¥å¼¹çª—å½¢å¼æç¤ºç”¨æˆ·è¾“å…¥å§“åï¼Œæ³¨æ„è¿™é‡Œçš„æ–‡å­—ä½¿ç”¨è‹±æ–‡çš„å¼•å·\n    prompt('è¯·è¾“å…¥æ‚¨çš„å§“å:')\n  </script>\n</body>\n</html>\n```\n\n## å˜é‡\n\n> äº†è§£å˜é‡ã€æ•°æ®ç±»å‹ã€è¿ç®—ç¬¦ç­‰åŸºç¡€æ¦‚å¿µï¼Œèƒ½å¤Ÿå®ç°æ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œç»“åˆå››åˆ™è¿ç®—ä½“ä¼šå¦‚ä½•ç¼–ç¨‹ã€‚\n\n- ä½“ä¼šç°å®ä¸–ç•Œä¸­çš„äº‹ç‰©ä¸è®¡ç®—æœºçš„å…³ç³»\n- ç†è§£ä»€ä¹ˆæ˜¯æ•°æ®å¹¶çŸ¥é“æ•°æ®çš„åˆ†ç±»\n- ç†è§£å˜é‡å­˜å‚¨æ•°æ®çš„â€œå®¹å™¨â€\n- æŒæ¡å¸¸è§è¿ç®—ç¬¦çš„ä½¿ç”¨ï¼Œäº†è§£ä¼˜å…ˆçº§å…³ç³»\n- çŸ¥é“ JavaScript æ•°æ®ç±»å‹éšå¼è½¬æ¢çš„ç‰¹å¾\n\n> ç†è§£å˜é‡æ˜¯è®¡ç®—æœºå­˜å‚¨æ•°æ®çš„â€œå®¹å™¨â€ï¼ŒæŒæ¡å˜é‡çš„å£°æ˜æ–¹å¼\n\nå˜é‡æ˜¯è®¡ç®—æœºä¸­ç”¨æ¥å­˜å‚¨æ•°æ®çš„â€œå®¹å™¨â€ï¼Œå®ƒå¯ä»¥è®©è®¡ç®—æœºå˜å¾—æœ‰è®°å¿†ï¼Œé€šä¿—çš„ç†è§£å˜é‡å°±æ˜¯ä½¿ç”¨ã€æŸä¸ªç¬¦å·ã€‘æ¥ä»£è¡¨ã€æŸä¸ªå…·ä½“çš„æ•°å€¼ã€‘ï¼ˆæ•°æ®ï¼‰\n\n```html\n<script>\n  // x ç¬¦å·ä»£è¡¨äº† 5 è¿™ä¸ªæ•°å€¼\n  x = 5\n  // y ç¬¦å·ä»£è¡¨äº† 6 è¿™ä¸ªæ•°å€¼\n  y = 6\n    \n  //ä¸¾ä¾‹ï¼š åœ¨ JavaScript ä¸­ä½¿ç”¨å˜é‡å¯ä»¥å°†æŸä¸ªæ•°æ®ï¼ˆæ•°å€¼ï¼‰è®°å½•ä¸‹æ¥ï¼\n\n  // å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ä¿å­˜åœ¨ num è¿™ä¸ªå˜é‡ï¼ˆå®¹å™¨ï¼‰ä¸­\n  num = prompt('è¯·è¾“å…¥ä¸€æ•°å­—!')\n\n  // é€šè¿‡ num å˜é‡ï¼ˆå®¹å™¨ï¼‰å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹è¾“å‡ºå‡ºæ¥\n  alert(num)\n  document.write(num)\n</script>\n```\n\n### å£°æ˜\n\nå£°æ˜(å®šä¹‰)å˜é‡æœ‰ä¸¤éƒ¨åˆ†æ„æˆï¼šå£°æ˜å…³é”®å­—ã€å˜é‡åï¼ˆæ ‡è¯†ï¼‰\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å£°æ˜å’Œèµ‹å€¼</title>\n</head>\n<body>\n  \n  <script> \n    // let å˜é‡å\n    // å£°æ˜(å®šä¹‰)å˜é‡æœ‰ä¸¤éƒ¨åˆ†æ„æˆï¼šå£°æ˜å…³é”®å­—ã€å˜é‡åï¼ˆæ ‡è¯†ï¼‰\n    // let å³å…³é”®å­—ï¼Œæ‰€è°“å…³é”®å­—æ˜¯ç³»ç»Ÿæä¾›çš„ä¸“é—¨ç”¨æ¥å£°æ˜ï¼ˆå®šä¹‰ï¼‰å˜é‡çš„è¯è¯­\n    // age å³å˜é‡çš„åç§°ï¼Œä¹Ÿå«æ ‡è¯†ç¬¦\n    let age\n  </script>\n</body>\n</html>\n```\n\nå…³é”®å­—æ˜¯ JavaScript ä¸­å†…ç½®çš„ä¸€äº›è‹±æ–‡è¯æ±‡ï¼ˆå•è¯æˆ–ç¼©å†™ï¼‰ï¼Œå®ƒä»¬ä»£è¡¨æŸäº›ç‰¹å®šçš„å«ä¹‰ï¼Œå¦‚ `let` çš„å«ä¹‰æ˜¯å£°æ˜å˜é‡çš„ï¼Œçœ‹åˆ° `let`  åå°±å¯æƒ³åˆ°è¿™è¡Œä»£ç çš„æ„æ€æ˜¯åœ¨å£°æ˜å˜é‡ï¼Œå¦‚ `let age;` \n\n`let` å’Œ `var` éƒ½æ˜¯ JavaScript ä¸­çš„å£°æ˜å˜é‡çš„å…³é”®å­—ï¼Œæ¨èä½¿ç”¨ `let` å£°æ˜å˜é‡ï¼ï¼ï¼\n\n### èµ‹å€¼\n\nå£°æ˜ï¼ˆå®šä¹‰ï¼‰å˜é‡ç›¸å½“äºåˆ›é€ äº†ä¸€ä¸ªç©ºçš„â€œå®¹å™¨â€ï¼Œé€šè¿‡èµ‹å€¼å‘è¿™ä¸ªå®¹å™¨ä¸­æ·»åŠ æ•°æ®ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å£°æ˜å’Œèµ‹å€¼</title>\n</head>\n<body>\n  \n  <script> \n    // å£°æ˜(å®šä¹‰)å˜é‡æœ‰ä¸¤éƒ¨åˆ†æ„æˆï¼šå£°æ˜å…³é”®å­—ã€å˜é‡åï¼ˆæ ‡è¯†ï¼‰\n    // let å³å…³é”®å­—ï¼Œæ‰€è°“å…³é”®å­—æ˜¯ç³»ç»Ÿæä¾›çš„ä¸“é—¨ç”¨æ¥å£°æ˜ï¼ˆå®šä¹‰ï¼‰å˜é‡çš„è¯è¯­\n    // age å³å˜é‡çš„åç§°ï¼Œä¹Ÿå«æ ‡è¯†ç¬¦\n    let age\n    // èµ‹å€¼ï¼Œå°† 18 è¿™ä¸ªæ•°æ®å­˜å…¥äº† age è¿™ä¸ªâ€œå®¹å™¨â€ä¸­\n    age = 18\n    // è¿™æ · age çš„å€¼å°±æˆäº† 18\n    document.write(age)\n    \n    // ä¹Ÿå¯ä»¥å£°æ˜å’Œèµ‹å€¼åŒæ—¶è¿›è¡Œ\n    let str = 'hello world!'\n    alert(str);\n  </script>\n</body>\n</html>\n```\n\n### å…³é”®å­—\n\nJavaScript ä½¿ç”¨ä¸“é—¨çš„å…³é”®å­— `let` å’Œ `var` æ¥å£°æ˜ï¼ˆå®šä¹‰ï¼‰å˜é‡ï¼Œåœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ä¸€äº›ç»†èŠ‚ï¼š\n\nä»¥ä¸‹æ˜¯ä½¿ç”¨ `let` æ—¶çš„æ³¨æ„äº‹é¡¹ï¼š\n\n1. å…è®¸å£°æ˜å’Œèµ‹å€¼åŒæ—¶è¿›è¡Œ\n2. ä¸å…è®¸é‡å¤å£°æ˜\n3. å…è®¸åŒæ—¶å£°æ˜å¤šä¸ªå˜é‡å¹¶èµ‹å€¼\n4. JavaScript ä¸­å†…ç½®çš„ä¸€äº›å…³é”®å­—ä¸èƒ½è¢«å½“åšå˜é‡å\n\nä»¥ä¸‹æ˜¯ä½¿ç”¨ `var` æ—¶çš„æ³¨æ„äº‹é¡¹ï¼š\n\n2. å…è®¸å£°æ˜å’Œèµ‹å€¼åŒæ—¶è¿›è¡Œ\n2. å…è®¸é‡å¤å£°æ˜\n3. å…è®¸åŒæ—¶å£°æ˜å¤šä¸ªå˜é‡å¹¶èµ‹å€¼\n\nå¤§éƒ¨åˆ†æƒ…å†µä½¿ç”¨ `let` å’Œ `var` åŒºåˆ«ä¸å¤§ï¼Œä½†æ˜¯ `let` ç›¸è¾ƒ `var` æ›´ä¸¥è°¨ï¼Œå› æ­¤æ¨èä½¿ç”¨ `let`ï¼ŒåæœŸä¼šæ›´è¿›ä¸€æ­¥ä»‹ç»äºŒè€…é—´çš„åŒºåˆ«ã€‚\n\n### å˜é‡åå‘½åè§„åˆ™\n\nå…³äºå˜é‡çš„åç§°ï¼ˆæ ‡è¯†ç¬¦ï¼‰æœ‰ä¸€ç³»åˆ—çš„è§„åˆ™éœ€è¦éµå®ˆï¼š\n\n1. åªèƒ½æ˜¯å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€$ï¼Œä¸”ä¸èƒ½èƒ½æ•°å­—å¼€å¤´\n2. å­—æ¯åŒºåˆ†å¤§å°å†™ï¼Œå¦‚ Age å’Œ age æ˜¯ä¸åŒçš„å˜é‡\n3. JavaScript å†…éƒ¨å·²å ç”¨äºå•è¯ï¼ˆå…³é”®å­—æˆ–ä¿ç•™å­—ï¼‰ä¸å…è®¸ä½¿ç”¨\n4. å°½é‡ä¿è¯å˜é‡å…·æœ‰ä¸€å®šçš„è¯­ä¹‰ï¼Œè§å­—çŸ¥ä¹‰\n\næ³¨ï¼šæ‰€è°“å…³é”®å­—æ˜¯æŒ‡ JavaScript å†…éƒ¨ä½¿ç”¨çš„è¯è¯­ï¼Œå¦‚ `let` å’Œ`var`ï¼Œä¿ç•™å­—æ˜¯æŒ‡ JavaScript å†…éƒ¨ç›®å‰æ²¡æœ‰ä½¿ç”¨çš„è¯è¯­ï¼Œä½†æ˜¯å°†æ¥å¯èƒ½ä¼šä½¿ç”¨è¯è¯­ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å˜é‡åå‘½åè§„åˆ™</title>\n</head>\n<body>\n  \n  <script> \n    let age = 18 // æ­£ç¡®\n    let age1 = 18 // æ­£ç¡®\n    let _age = 18 // æ­£ç¡®\n\n    // let 1age = 18; // é”™è¯¯ï¼Œä¸å¯ä»¥æ•°å­—å¼€å¤´\n    let $age = 18 // æ­£ç¡®\n    let Age = 24 // æ­£ç¡®ï¼Œå®ƒä¸å°å†™çš„ age æ˜¯ä¸åŒçš„å˜é‡\n    // let let = 18; // é”™è¯¯ï¼Œlet æ˜¯å…³é”®å­—\n    let int = 123 // ä¸æ¨èï¼Œint æ˜¯ä¿ç•™å­—\n  </script>\n</body>\n</html>\n```\n\n## å¸¸é‡\n\næ¦‚å¿µï¼šä½¿ç”¨ const å£°æ˜çš„å˜é‡ç§°ä¸ºâ€œå¸¸é‡â€ã€‚\n\nä½¿ç”¨åœºæ™¯ï¼šå½“æŸä¸ªå˜é‡æ°¸è¿œä¸ä¼šæ”¹å˜çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨ const æ¥å£°æ˜ï¼Œè€Œä¸æ˜¯letã€‚\n\nå‘½åè§„èŒƒï¼šå’Œå˜é‡ä¸€è‡´\n\n~~~javascript\nconst PI = 3.14\n~~~\n\n>æ³¨æ„ï¼š å¸¸é‡ä¸å…è®¸é‡æ–°èµ‹å€¼,å£°æ˜çš„æ—¶å€™å¿…é¡»èµ‹å€¼ï¼ˆåˆå§‹åŒ–ï¼‰\n\n## æ•°æ®ç±»å‹\n\n> è®¡ç®—æœºä¸–ç•Œä¸­çš„ä¸‡äº‹æˆç‰©éƒ½æ˜¯æ•°æ®ã€‚\n\nè®¡ç®—æœºç¨‹åºå¯ä»¥å¤„ç†å¤§é‡çš„æ•°æ®ï¼Œä¸ºäº†æ–¹ä¾¿æ•°æ®çš„ç®¡ç†ï¼Œå°†æ•°æ®åˆ†æˆäº†ä¸åŒçš„ç±»å‹ï¼š\n\næ³¨ï¼šé€šè¿‡ typeof å…³é”®å­—æ£€æµ‹æ•°æ®ç±»å‹\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - æ•°æ®ç±»å‹</title>\n</head>\n<body>\n  \n  <script> \n    // æ£€æµ‹ 1 æ˜¯ä»€ä¹ˆç±»å‹æ•°æ®ï¼Œç»“æœä¸º number\n    document.write(typeof 1)\n  </script>\n</body>\n</html>\n```\n\n### æ•°å€¼ç±»å‹\n\nå³æˆ‘ä»¬æ•°å­¦ä¸­å­¦ä¹ åˆ°çš„æ•°å­—ï¼Œå¯ä»¥æ˜¯æ•´æ•°ã€å°æ•°ã€æ­£æ•°ã€è´Ÿæ•°\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - æ•°æ®ç±»å‹</title>\n</head>\n<body>\n  \n  <script> \n    let score = 100 // æ­£æ•´æ•°\n    let price = 12.345 // å°æ•°\n    let temperature = -40 // è´Ÿæ•°\n\n    document.write(typeof score) // ç»“æœä¸º number\n    document.write(typeof price) // ç»“æœä¸º number\n    document.write(typeof temperature) // ç»“æœä¸º number\n  </script>\n</body>\n</html>\n```\n\nJavaScript ä¸­çš„æ•°å€¼ç±»å‹ä¸æ•°å­¦ä¸­çš„æ•°å­—æ˜¯ä¸€æ ·çš„ï¼Œåˆ†ä¸ºæ­£æ•°ã€è´Ÿæ•°ã€å°æ•°ç­‰ã€‚\n\n### å­—ç¬¦ä¸²ç±»å‹\n\né€šè¿‡å•å¼•å·ï¼ˆ `''`ï¼‰ ã€åŒå¼•å·ï¼ˆ `\"\"`ï¼‰æˆ–åå¼•å·åŒ…è£¹çš„æ•°æ®éƒ½å«å­—ç¬¦ä¸²ï¼Œå•å¼•å·å’ŒåŒå¼•å·æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œæ¨èä½¿ç”¨å•å¼•å·ã€‚\n\næ³¨æ„äº‹é¡¹ï¼š\n\n1. æ— è®ºå•å¼•å·æˆ–æ˜¯åŒå¼•å·å¿…é¡»æˆå¯¹ä½¿ç”¨\n2. å•å¼•å·/åŒå¼•å·å¯ä»¥äº’ç›¸åµŒå¥—ï¼Œä½†æ˜¯ä¸ä»¥è‡ªå·²åµŒå¥—è‡ªå·²\n3. å¿…è¦æ—¶å¯ä»¥ä½¿ç”¨è½¬ä¹‰ç¬¦ `\\`ï¼Œè¾“å‡ºå•å¼•å·æˆ–åŒå¼•å·\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - æ•°æ®ç±»å‹</title>\n</head>\n<body>\n  \n  <script> \n    let user_name = 'å°æ˜' // ä½¿ç”¨å•å¼•å·\n    let gender = \"ç”·\" // ä½¿ç”¨åŒå¼•å·\n    let str = '123' // çœ‹ä¸Šå»æ˜¯æ•°å­—ï¼Œä½†æ˜¯ç”¨å¼•å·åŒ…è£¹äº†å°±æˆäº†å­—ç¬¦ä¸²äº†\n    let str1 = '' // è¿™ç§æƒ…å†µå«ç©ºå­—ç¬¦ä¸²\n\t\t\n    documeent.write(typeof user_name) // ç»“æœä¸º string\n    documeent.write(typeof gender) // ç»“æœä¸º string\n    documeent.write(typeof str) // ç»“æœä¸º string\n  </script>\n</body>\n</html>\n```\n\n### å¸ƒå°”ç±»å‹\n\nè¡¨ç¤ºè‚¯å®šæˆ–å¦å®šæ—¶åœ¨è®¡ç®—æœºä¸­å¯¹åº”çš„æ˜¯å¸ƒå°”ç±»å‹æ•°æ®ï¼Œå®ƒæœ‰ä¸¤ä¸ªå›ºå®šçš„å€¼ `true` å’Œ `false`ï¼Œè¡¨ç¤ºè‚¯å®šçš„æ•°æ®ç”¨ `true`ï¼Œè¡¨ç¤ºå¦å®šçš„æ•°æ®ç”¨ `false`ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - æ•°æ®ç±»å‹</title>\n</head>\n<body>\n  \n  <script> \n    //  pinkè€å¸ˆå¸…ä¸å¸…ï¼Ÿå›ç­” æ˜¯ æˆ– å¦\n    let isCool = true // æ˜¯çš„ï¼Œæ‘”æ­»äº†ï¼\n    isCool = false // ä¸ï¼Œå¥—é©¬æ†çš„æ±‰å­ï¼\n\n    document.write(typeof isCool) // ç»“æœä¸º boolean\n  </script>\n</body>\n</html>\n```\n\n### undefined\n\næœªå®šä¹‰æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹ï¼Œåªæœ‰ä¸€ä¸ªå€¼ undefinedï¼Œåªå£°æ˜å˜é‡ï¼Œä¸èµ‹å€¼çš„æƒ…å†µä¸‹ï¼Œå˜é‡çš„é»˜è®¤å€¼ä¸º undefinedï¼Œä¸€èˆ¬å¾ˆå°‘ã€ç›´æ¥ã€‘ä¸ºæŸä¸ªå˜é‡èµ‹å€¼ä¸º undefinedã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - æ•°æ®ç±»å‹</title>\n</head>\n<body>\n  \n  <script> \n    // åªå£°æ˜äº†å˜é‡ï¼Œå¹¶æœ«èµ‹å€¼\n    let tmp;\n    document.write(typeof tmp) // ç»“æœä¸º undefined\n  </script>\n</body>\n</html>\n```\n\n**æ³¨ï¼šJavaScript ä¸­å˜é‡çš„å€¼å†³å®šäº†å˜é‡çš„æ•°æ®ç±»å‹ã€‚**\n\n## ç±»å‹è½¬æ¢\n\n> ç†è§£å¼±ç±»å‹è¯­è¨€çš„ç‰¹å¾ï¼ŒæŒæ¡æ˜¾å¼ç±»å‹è½¬æ¢çš„æ–¹æ³•\n\nåœ¨ JavaScript ä¸­æ•°æ®è¢«åˆ†æˆäº†ä¸åŒçš„ç±»å‹ï¼Œå¦‚æ•°å€¼ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€undefinedï¼Œåœ¨å®é™…ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œä¸åŒæ•°æ®ç±»å‹ä¹‹é—´å­˜åœ¨ç€è½¬æ¢çš„å…³ç³»ã€‚\n\n### éšå¼è½¬æ¢\n\næŸäº›è¿ç®—ç¬¦è¢«æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿå†…éƒ¨è‡ªåŠ¨å°†æ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œè¿™ç§è½¬æ¢ç§°ä¸ºéšå¼è½¬æ¢ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - éšå¼è½¬æ¢</title>\n</head>\n<body>\n  <script> \n    let num = 13 // æ•°å€¼\n    let num2 = '2' // å­—ç¬¦ä¸²\n\n    // ç»“æœä¸º 132\n    // åŸå› æ˜¯å°†æ•°å€¼ num è½¬æ¢æˆäº†å­—ç¬¦ä¸²ï¼Œç›¸å½“äº '13'\n    // ç„¶å + å°†ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥åˆ°äº†ä¸€èµ·\n    console.log(num + num2)\n\n    // ç»“æœä¸º 11\n    // åŸå› æ˜¯å°†å­—ç¬¦ä¸² num2 è½¬æ¢æˆäº†æ•°å€¼ï¼Œç›¸å½“äº 2\n    // ç„¶åæ•°å€¼ 13 å‡å» æ•°å€¼ 2\n    console.log(num - num2)\n\n    let a = prompt('è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—')\n    let b = prompt('è¯·å†è¾“å…¥ä¸€ä¸ªæ•°å­—')\n\n    alert(a + b);\n  </script>\n</body>\n</html>\n```\n\næ³¨ï¼šæ•°æ®ç±»å‹çš„éšå¼è½¬æ¢æ˜¯ JavaScript çš„ç‰¹å¾ï¼Œåç»­å­¦ä¹ ä¸­è¿˜ä¼šé‡åˆ°ï¼Œç›®å‰å…ˆéœ€è¦ç†è§£ä»€ä¹ˆæ˜¯éšå¼è½¬æ¢ã€‚\n\nè¡¥å……ä»‹ç»æ¨¡æ¿å­—ç¬¦ä¸²çš„æ‹¼æ¥çš„ä½¿ç”¨\n\n### æ˜¾å¼è½¬æ¢\n\nç¼–å†™ç¨‹åºæ—¶è¿‡åº¦ä¾é ç³»ç»Ÿå†…éƒ¨çš„éšå¼è½¬æ¢æ˜¯ä¸ä¸¥ç¦çš„ï¼Œå› ä¸ºéšå¼è½¬æ¢è§„å¾‹å¹¶ä¸æ¸…æ™°ï¼Œå¤§å¤šæ˜¯é ç»éªŒæ€»ç»“çš„è§„å¾‹ã€‚ä¸ºäº†é¿å…å› éšå¼è½¬æ¢å¸¦æ¥çš„é—®é¢˜ï¼Œé€šå¸¸æ ¹é€»è¾‘éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ˜¾ç¤ºè½¬æ¢ã€‚\n\n#### Number\n\né€šè¿‡ `Number` æ˜¾ç¤ºè½¬æ¢æˆæ•°å€¼ç±»å‹ï¼Œå½“è½¬æ¢å¤±è´¥æ—¶ç»“æœä¸º `NaN`ï¼ˆNot a Numberï¼‰å³ä¸æ˜¯ä¸€ä¸ªæ•°å­—ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - éšå¼è½¬æ¢</title>\n</head>\n<body>\n  <script>\n    let t = '12'\n    let f = 8\n\n    // æ˜¾å¼å°†å­—ç¬¦ä¸² 12 è½¬æ¢æˆæ•°å€¼ 12\n    t = Number(t)\n\n    // æ£€æµ‹è½¬æ¢åçš„ç±»å‹\n    // console.log(typeof t);\n    console.log(t + f) // ç»“æœä¸º 20\n\n    // å¹¶ä¸æ˜¯æ‰€æœ‰çš„å€¼éƒ½å¯ä»¥è¢«è½¬æˆæ•°å€¼ç±»å‹\n    let str = 'hello'\n    // å°† hello è½¬æˆæ•°å€¼æ˜¯ä¸ç°å®çš„ï¼Œå½“æ— æ³•è½¬æ¢æˆ\n    // æ•°å€¼æ—¶ï¼Œå¾—åˆ°çš„ç»“æœä¸º NaN ï¼ˆNot a Numberï¼‰\n    console.log(Number(str))\n  </script>\n</body>\n</html>\n```\n\n## è¿ç®—ç¬¦\n\n> ç†è§£ä»€ä¹ˆæ˜¯æµç¨‹æ§åˆ¶ï¼ŒçŸ¥é“æ¡ä»¶æ§åˆ¶çš„ç§ç±»å¹¶æŒæ¡å…¶å¯¹åº”çš„è¯­æ³•è§„åˆ™ï¼Œå…·å¤‡åˆ©ç”¨å¾ªç¯ç¼–å†™ç®€æ˜“ATMå–æ¬¾æœºç¨‹åºèƒ½åŠ›\n\n- è¿ç®—ç¬¦\n- è¯­å¥\n- ç»¼åˆæ¡ˆä¾‹\n\n### ç®—æœ¯è¿ç®—ç¬¦\n\næ•°å­—æ˜¯ç”¨æ¥è®¡ç®—çš„ï¼Œæ¯”å¦‚ï¼šä¹˜æ³• * ã€é™¤æ³• / ã€åŠ æ³• + ã€å‡æ³• - ç­‰ç­‰ï¼Œæ‰€ä»¥ç»å¸¸å’Œç®—æœ¯è¿ç®—ç¬¦ä¸€èµ·ã€‚\n\nç®—æœ¯è¿ç®—ç¬¦ï¼šä¹Ÿå«æ•°å­¦è¿ç®—ç¬¦ï¼Œä¸»è¦åŒ…æ‹¬åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–ä½™ï¼ˆæ±‚æ¨¡ï¼‰ç­‰\n\n| è¿ç®—ç¬¦ | ä½œç”¨                                                 |\n| ------ | ---------------------------------------------------- |\n| +      | æ±‚å’Œ                                                 |\n| -      | æ±‚å·®                                                 |\n| *      | æ±‚ç§¯                                                 |\n| /      | æ±‚å•†                                                 |\n| **%**  | å–æ¨¡ï¼ˆå–ä½™æ•°ï¼‰ï¼Œå¼€å‘ä¸­ç»å¸¸ç”¨äºä½œä¸ºæŸä¸ªæ•°å­—æ˜¯å¦è¢«æ•´é™¤ |\n\n> æ³¨æ„ï¼šåœ¨è®¡ç®—å¤±è´¥æ—¶ï¼Œæ˜¾ç¤ºçš„ç»“æœæ˜¯ NaN ï¼ˆnot a numberï¼‰\n\n```javascript\n// ç®—æœ¯è¿ç®—ç¬¦\nconsole.log(1 + 2 * 3 / 2) //  4 \nlet num = 10\nconsole.log(num + 10)  // 20\nconsole.log(num + num)  // 20\n\n// 1. å–æ¨¡(å–ä½™æ•°)  ä½¿ç”¨åœºæ™¯ï¼š  ç”¨æ¥åˆ¤æ–­æŸä¸ªæ•°æ˜¯å¦èƒ½å¤Ÿè¢«æ•´é™¤\nconsole.log(4 % 2) //  0  \nconsole.log(6 % 3) //  0\nconsole.log(5 % 3) //  2\nconsole.log(3 % 5) //  3\n\n// 2. æ³¨æ„äº‹é¡¹ : å¦‚æœæˆ‘ä»¬è®¡ç®—å¤±è´¥ï¼Œåˆ™è¿”å›çš„ç»“æœæ˜¯ NaN (not a number)\nconsole.log('pinkè€å¸ˆ' - 2)\nconsole.log('pinkè€å¸ˆ' * 2)\nconsole.log('pinkè€å¸ˆ' + 2)   // pinkè€å¸ˆ2\n```\n\n### èµ‹å€¼è¿ç®—ç¬¦\n\nèµ‹å€¼è¿ç®—ç¬¦ï¼šå¯¹å˜é‡è¿›è¡Œèµ‹å€¼çš„è¿ç®—ç¬¦\n\n =     å°†ç­‰å·å³è¾¹çš„å€¼èµ‹äºˆç»™å·¦è¾¹, è¦æ±‚å·¦è¾¹å¿…é¡»æ˜¯ä¸€ä¸ªå®¹å™¨\n\n| è¿ç®—ç¬¦ | ä½œç”¨     |\n| ------ | -------- |\n| +=     | åŠ æ³•èµ‹å€¼ |\n| -+     | å‡æ³•èµ‹å€¼ |\n| *=     | ä¹˜æ³•èµ‹å€¼ |\n| /=     | é™¤æ³•èµ‹å€¼ |\n| %=     | å–ä½™èµ‹å€¼ |\n\n```javascript\n<script>\nlet num = 1\n// num = num + 1\n// é‡‡å–èµ‹å€¼è¿ç®—ç¬¦\n// num += 1\nnum += 3\nconsole.log(num)\n</script>\n```\n\n### è‡ªå¢/è‡ªå‡è¿ç®—ç¬¦\n\n| ç¬¦å· | ä½œç”¨ | è¯´æ˜                       |\n| ---- | ---- | -------------------------- |\n| ++   | è‡ªå¢ | å˜é‡è‡ªèº«çš„å€¼åŠ 1ï¼Œä¾‹å¦‚: x++ |\n| --   | è‡ªå‡ | å˜é‡è‡ªèº«çš„å€¼å‡1ï¼Œä¾‹å¦‚: x-- |\n\n1. ++åœ¨å‰å’Œ++åœ¨ååœ¨å•ç‹¬ä½¿ç”¨æ—¶äºŒè€…å¹¶æ²¡æœ‰å·®åˆ«ï¼Œè€Œä¸”ä¸€èˆ¬å¼€å‘ä¸­æˆ‘ä»¬éƒ½æ˜¯ç‹¬ç«‹ä½¿ç”¨\n2. ++åœ¨åï¼ˆåç¼€å¼ï¼‰æˆ‘ä»¬ä¼šä½¿ç”¨æ›´å¤š\n\n> æ³¨æ„ï¼š\n>\n> 1. åªæœ‰å˜é‡èƒ½å¤Ÿä½¿ç”¨è‡ªå¢å’Œè‡ªå‡è¿ç®—ç¬¦\n> 2. ++ã€-- å¯ä»¥åœ¨å˜é‡å‰é¢ä¹Ÿå¯ä»¥åœ¨å˜é‡åé¢ï¼Œæ¯”å¦‚: x++  æˆ–è€…  ++x \n\n```javascript\n<script>\n    // let num = 10\n    // num = num + 1\n    // num += 1\n    // // 1. å‰ç½®è‡ªå¢\n    // let i = 1\n    // ++i\n    // console.log(i)\n\n    // let i = 1\n    // console.log(++i + 1)\n    // 2. åç½®è‡ªå¢\n    // let i = 1\n    // i++\n    // console.log(i)\n    // let i = 1\n    // console.log(i++ + 1)\n\n    // äº†è§£ \n    let i = 1\n    console.log(i++ + ++i + i)\n  </script>\n```\n\n### æ¯”è¾ƒè¿ç®—ç¬¦\n\nä½¿ç”¨åœºæ™¯ï¼šæ¯”è¾ƒä¸¤ä¸ªæ•°æ®å¤§å°ã€æ˜¯å¦ç›¸ç­‰ï¼Œæ ¹æ®æ¯”è¾ƒç»“æœè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆtrue / falseï¼‰\n\n| è¿ç®—ç¬¦ | ä½œç”¨                                   |\n| ------ | -------------------------------------- |\n| >      | å·¦è¾¹æ˜¯å¦å¤§äºå³è¾¹                       |\n| <      | å·¦è¾¹æ˜¯å¦å°äºå³è¾¹                       |\n| >=     | å·¦è¾¹æ˜¯å¦å¤§äºæˆ–ç­‰äºå³è¾¹                 |\n| <=     | å·¦è¾¹æ˜¯å¦å°äºæˆ–ç­‰äºå³è¾¹                 |\n| ===    | å·¦å³ä¸¤è¾¹æ˜¯å¦`ç±»å‹`å’Œ`å€¼`éƒ½ç›¸ç­‰ï¼ˆé‡ç‚¹ï¼‰ |\n| ==     | å·¦å³ä¸¤è¾¹`å€¼`æ˜¯å¦ç›¸ç­‰                   |\n| !=     | å·¦å³å€¼ä¸ç›¸ç­‰                           |\n| !==    | å·¦å³ä¸¤è¾¹æ˜¯å¦ä¸å…¨ç­‰                     |\n\n```javascript\n<script>\n  console.log(3 > 5)\n  console.log(3 >= 3)\n  console.log(2 == 2)\n  // æ¯”è¾ƒè¿ç®—ç¬¦æœ‰éšå¼è½¬æ¢ æŠŠ'2' è½¬æ¢ä¸º 2  åŒç­‰å· åªåˆ¤æ–­å€¼\n  console.log(2 == '2')  // true\n  // console.log(undefined === null)\n  // === å…¨ç­‰ åˆ¤æ–­ å€¼ å’Œ æ•°æ®ç±»å‹éƒ½ä¸€æ ·æ‰è¡Œ\n  // ä»¥ååˆ¤æ–­æ˜¯å¦ç›¸ç­‰ è¯·ç”¨ ===  \n  console.log(2 === '2')\n  console.log(NaN === NaN) // NaN ä¸ç­‰äºä»»ä½•äººï¼ŒåŒ…æ‹¬ä»–è‡ªå·±\n  console.log(2 !== '2')  // true  \n  console.log(2 != '2') // false \n  console.log('-------------------------')\n  console.log('a' < 'b') // true\n  console.log('aa' < 'ab') // true\n  console.log('aa' < 'aac') // true\n  console.log('-------------------------')\n</script>\n```\n\n### é€»è¾‘è¿ç®—ç¬¦\n\nä½¿ç”¨åœºæ™¯ï¼šå¯ä»¥æŠŠå¤šä¸ªå¸ƒå°”å€¼æ”¾åˆ°ä¸€èµ·è¿ç®—ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼\n\n| ç¬¦å· | åç§°   | æ—¥å¸¸è¯»æ³• | ç‰¹ç‚¹                       | å£è¯€           |\n| ---- | ------ | -------- | -------------------------- | -------------- |\n| &&   | é€»è¾‘ä¸ | å¹¶ä¸”     | ç¬¦å·ä¸¤è¾¹æœ‰ä¸€ä¸ªå‡çš„ç»“æœä¸ºå‡ | ä¸€å‡åˆ™å‡       |\n| \\|\\| | é€»è¾‘æˆ– | æˆ–è€…     | ç¬¦å·ä¸¤è¾¹æœ‰ä¸€ä¸ªçœŸçš„ç»“æœä¸ºçœŸ | ä¸€çœŸåˆ™çœŸ       |\n| !    | é€»è¾‘é | å–å     | trueå˜false  falseå˜true   | çœŸå˜å‡ï¼Œå‡å˜çœŸ |\n\n| A     | B     | A && B | A \\|\\| B | !A    |\n| ----- | ----- | ------ | -------- | ----- |\n| false | false | false  | false    | true  |\n| false | true  | false  | true     | true  |\n| true  | false | false  | true     | false |\n| true  | true  | true   | true     | false |\n\n```javascript\n<script>\n    // é€»è¾‘ä¸ ä¸€å‡åˆ™å‡\n    console.log(true && true)\n    console.log(false && true)\n    console.log(3 < 5 && 3 > 2)\n    console.log(3 < 5 && 3 < 2)\n    console.log('-----------------')\n    // é€»è¾‘æˆ– ä¸€çœŸåˆ™çœŸ\n    console.log(true || true)\n    console.log(false || true)\n    console.log(false || false)\n    console.log('-----------------')\n    // é€»è¾‘é  å–å\n    console.log(!true)\n    console.log(!false)\n\n    console.log('-----------------')\n\n    let num = 6\n    console.log(num > 5 && num < 10)\n    console.log('-----------------')\n  </script>\n```\n\n### è¿ç®—ç¬¦ä¼˜å…ˆçº§\n\n ![image-20241108214226197](../img/JavaScript%E5%9F%BA%E7%A1%80/8f4c37d84a7c0bd219784f4c3b4e49fd697559838.png)\n\n> é€»è¾‘è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼š ï¼> && >  ||  \n\n## è¯­å¥\n\n### è¡¨è¾¾å¼å’Œè¯­å¥\n\n![67101792498](../img/JavaScript%E5%9F%BA%E7%A1%80/59c2f242554310a9bc6b4f440e818757697559838.png)\n\n\n\n### åˆ†æ”¯è¯­å¥\n\nåˆ†æ”¯è¯­å¥å¯ä»¥æ ¹æ®æ¡ä»¶åˆ¤å®šçœŸå‡ï¼Œæ¥é€‰æ‹©æ€§çš„æ‰§è¡Œæƒ³è¦çš„ä»£ç \n\nåˆ†æ”¯è¯­å¥åŒ…å«ï¼š\n\n1. ifåˆ†æ”¯è¯­å¥ï¼ˆé‡ç‚¹ï¼‰\n2. ä¸‰å…ƒè¿ç®—ç¬¦\n3. switchè¯­å¥\n\n#### if åˆ†æ”¯è¯­å¥\n\nè¯­æ³•ï¼š\n\n~~~javascript\nif(æ¡ä»¶è¡¨è¾¾å¼) {\n  // æ»¡è¶³æ¡ä»¶è¦æ‰§è¡Œçš„è¯­å¥\n}\n~~~\n\nå°æ‹¬å·å†…çš„æ¡ä»¶ç»“æœæ˜¯å¸ƒå°”å€¼ï¼Œä¸º true æ—¶ï¼Œè¿›å…¥å¤§æ‹¬å·é‡Œæ‰§è¡Œä»£ç ï¼›ä¸ºfalseï¼Œåˆ™ä¸æ‰§è¡Œå¤§æ‹¬å·é‡Œé¢ä»£ç \n\nå°æ‹¬å·å†…çš„ç»“æœè‹¥ä¸æ˜¯å¸ƒå°”ç±»å‹æ—¶ï¼Œä¼šå‘ç”Ÿç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œç±»ä¼¼Boolean()\n\nå¦‚æœå¤§æ‹¬å·åªæœ‰ä¸€ä¸ªè¯­å¥ï¼Œå¤§æ‹¬å·å¯ä»¥çœç•¥ï¼Œä½†æ˜¯ï¼Œä¿ºä»¬ä¸æå€¡è¿™ä¹ˆåš~\n\n~~~javascript\n<script>\n    // å•åˆ†æ”¯è¯­å¥\n    // if (false) {\n    //   console.log('æ‰§è¡Œè¯­å¥')\n    // }\n    // if (3 > 5) {\n    //   console.log('æ‰§è¡Œè¯­å¥')\n    // }\n    // if (2 === '2') {\n    //   console.log('æ‰§è¡Œè¯­å¥')\n    // }\n    //  1. é™¤äº†0 æ‰€æœ‰çš„æ•°å­—éƒ½ä¸ºçœŸ\n    //   if (0) {\n    //     console.log('æ‰§è¡Œè¯­å¥')\n    //   }\n    // 2.é™¤äº† '' æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¸ºçœŸ true\n    // if ('pinkè€å¸ˆ') {\n    //   console.log('æ‰§è¡Œè¯­å¥')\n    // }\n    // if ('') {\n    //   console.log('æ‰§è¡Œè¯­å¥')\n    // }\n    // // if ('') console.log('æ‰§è¡Œè¯­å¥')\n\n    // 1. ç”¨æˆ·è¾“å…¥\n    let score = +prompt('è¯·è¾“å…¥æˆç»©')\n    // 2. è¿›è¡Œåˆ¤æ–­è¾“å‡º\n    if (score >= 700) {\n      alert('æ­å–œè€ƒå…¥é»‘é©¬ç¨‹åºå‘˜')\n    }\n    console.log('-----------------')\n\n  </script>\n~~~\n\n#### ifåŒåˆ†æ”¯è¯­å¥\n\nå¦‚æœæœ‰ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ if else åŒåˆ†æ”¯è¯­å¥\n\n~~~javascript\nif (æ¡ä»¶è¡¨è¾¾å¼){\n  // æ»¡è¶³æ¡ä»¶è¦æ‰§è¡Œçš„è¯­å¥\n} else {\n  // ä¸æ»¡è¶³æ¡ä»¶è¦æ‰§è¡Œçš„è¯­å¥\n}\n~~~\n\nä¾‹å¦‚ï¼š\n\n~~~javascript\n <script>\n    // 1. ç”¨æˆ·è¾“å…¥\n    let uname = prompt('è¯·è¾“å…¥ç”¨æˆ·å:')\n    let pwd = prompt('è¯·è¾“å…¥å¯†ç :')\n    // 2. åˆ¤æ–­è¾“å‡º\n    if (uname === 'pink' && pwd === '123456') {\n      alert('æ­å–œç™»å½•æˆåŠŸ')\n    } else {\n      alert('ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯')\n    }\n  </script>\n~~~\n\n#### if å¤šåˆ†æ”¯è¯­å¥\n\nä½¿ç”¨åœºæ™¯ï¼š é€‚åˆäºæœ‰å¤šä¸ªæ¡ä»¶çš„æ—¶å€™\n\n~~~javascript\n <script>\n    // 1. ç”¨æˆ·è¾“å…¥\n    let score = +prompt('è¯·è¾“å…¥æˆç»©ï¼š')\n    // 2. åˆ¤æ–­è¾“å‡º\n    if (score >= 90) {\n      alert('æˆç»©ä¼˜ç§€ï¼Œå®è´ï¼Œä½ æ˜¯æˆ‘çš„éª„å‚²')\n    } else if (score >= 70) {\n      alert('æˆç»©è‰¯å¥½ï¼Œå®è´ï¼Œä½ è¦åŠ æ²¹å“¦~~')\n    } else if (score >= 60) {\n      alert('æˆç»©åŠæ ¼ï¼Œå®è´ï¼Œä½ å¾ˆå±é™©~')\n    } else {\n      alert('æˆç»©ä¸åŠæ ¼ï¼Œå®è´ï¼Œæˆ‘ä¸æƒ³å’Œä½ è¯´è¯ï¼Œæˆ‘åªæƒ³ç”¨é­å­å’Œä½ è¯´è¯~')\n    }\n  </script>\n~~~\n\n#### ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆä¸‰å…ƒè¡¨è¾¾å¼ï¼‰\n\n**ä½¿ç”¨åœºæ™¯**ï¼š ä¸€äº›ç®€å•çš„åŒåˆ†æ”¯ï¼Œå¯ä»¥ä½¿ç”¨  ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆä¸‰å…ƒè¡¨è¾¾å¼ï¼‰ï¼Œå†™èµ·æ¥æ¯” if  elseåŒåˆ†æ”¯ æ›´ç®€å•\n\n**ç¬¦å·**ï¼š? ä¸ : é…åˆä½¿ç”¨\n\nè¯­æ³•ï¼š\n\n~~~javascript\næ¡ä»¶ ? è¡¨è¾¾å¼1 ï¼š è¡¨è¾¾å¼2\n~~~\n\nä¾‹å¦‚ï¼š\n\n~~~javascript\n// ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆä¸‰å…ƒè¡¨è¾¾å¼ï¼‰\n// 1. è¯­æ³•æ ¼å¼\n// æ¡ä»¶ ? è¡¨è¾¾å¼1 : è¡¨è¾¾å¼2 \n\n// 2. æ‰§è¡Œè¿‡ç¨‹ \n// 2.1 å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œè¡¨è¾¾å¼1\n// 2.2 å¦‚æœæ¡ä»¶ä¸ºå‡ï¼Œåˆ™æ‰§è¡Œè¡¨è¾¾å¼2\n\n// 3. éªŒè¯\n// 5 > 3 ? 'çœŸçš„' : 'å‡çš„'\nconsole.log(5 < 3 ? 'çœŸçš„' : 'å‡çš„')\n\n// let age = 18 \n// age = age + 1\n//  age++\n\n// 1. ç”¨æˆ·è¾“å…¥ \nlet num = prompt('è¯·æ‚¨è¾“å…¥ä¸€ä¸ªæ•°å­—:')\n// 2. åˆ¤æ–­è¾“å‡º- å°äº10æ‰è¡¥0\n// num = num < 10 ? 0 + num : num\nnum = num >= 10 ? num : 0 + num\nalert(num)\n~~~\n\n#### switchè¯­å¥ï¼ˆäº†è§£ï¼‰\n\nä½¿ç”¨åœºæ™¯ï¼š é€‚åˆäºæœ‰å¤šä¸ªæ¡ä»¶çš„æ—¶å€™ï¼Œä¹Ÿå±äºåˆ†æ”¯è¯­å¥ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å’Œ ifå¤šåˆ†æ”¯è¯­å¥ åŠŸèƒ½ç›¸åŒ\n\næ³¨æ„ï¼š\n\n1. switch caseè¯­å¥ä¸€èˆ¬ç”¨äºç­‰å€¼åˆ¤æ–­, ifé€‚åˆäºåŒºé—´åˆ¤æ–­\n2. switchcaseä¸€èˆ¬éœ€è¦é…åˆbreakå…³é”®å­—ä½¿ç”¨ æ²¡æœ‰breakä¼šé€ æˆcaseç©¿é€\n3. if å¤šåˆ†æ”¯è¯­å¥å¼€å‘è¦æ¯”switchæ›´é‡è¦ï¼Œä½¿ç”¨ä¹Ÿæ›´å¤š\n\nä¾‹å¦‚ï¼š\n\n~~~javascript\n// switchåˆ†æ”¯è¯­å¥\n// 1. è¯­æ³•\n// switch (è¡¨è¾¾å¼) {\n//   case å€¼1:\n//     ä»£ç 1\n//     break\n\n//   case å€¼2:\n//     ä»£ç 2\n//     break\n//   ...\n//   default:\n//     ä»£ç n\n// }\n\n<script>\n  switch (2) {\n    case 1:\n    console.log('æ‚¨é€‰æ‹©çš„æ˜¯1')\n    break  // é€€å‡ºswitch\n    case 2:\n    console.log('æ‚¨é€‰æ‹©çš„æ˜¯2')\n    break  // é€€å‡ºswitch\n    case 3:\n    console.log('æ‚¨é€‰æ‹©çš„æ˜¯3')\n    break  // é€€å‡ºswitch\n    default:\n    console.log('æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„')\n  }\n</script>\n~~~\n\n#### æ–­ç‚¹è°ƒè¯•\n\n**ä½œç”¨ï¼š**å­¦ä¹ æ—¶å¯ä»¥å¸®åŠ©æ›´å¥½çš„ç†è§£ä»£ç è¿è¡Œï¼Œå·¥ä½œæ—¶å¯ä»¥æ›´å¿«æ‰¾åˆ°bug\n\næµè§ˆå™¨æ‰“å¼€è°ƒè¯•ç•Œé¢\n\n1. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·\n2. ç‚¹åˆ°æºä»£ç ä¸€æ  ï¼ˆ sources ï¼‰\n3. é€‰æ‹©ä»£ç æ–‡ä»¶\n\n**æ–­ç‚¹ï¼š**åœ¨æŸå¥ä»£ç ä¸ŠåŠ çš„æ ‡è®°å°±å«æ–­ç‚¹ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°è¿™å¥æœ‰æ ‡è®°çš„ä»£ç æ—¶ä¼šæš‚åœä¸‹æ¥\n\n\n\n### å¾ªç¯è¯­å¥\n\nä½¿ç”¨åœºæ™¯ï¼šé‡å¤æ‰§è¡Œ æŒ‡å®šçš„ä¸€æ®µä»£ç ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦è¾“å‡º10æ¬¡ 'æˆ‘å­¦çš„å¾ˆæ£’'\n\nå­¦ä¹ è·¯å¾„ï¼š\n\n1.whileå¾ªç¯\n\n2.for å¾ªç¯ï¼ˆé‡ç‚¹ï¼‰\n\n#### whileå¾ªç¯\n\nwhile :  åœ¨â€¦. æœŸé—´ï¼Œ æ‰€ä»¥ whileå¾ªç¯ å°±æ˜¯åœ¨æ»¡è¶³æ¡ä»¶æœŸé—´ï¼Œé‡å¤æ‰§è¡ŒæŸäº›ä»£ç ã€‚\n\n**è¯­æ³•ï¼š**\n\n~~~javascript\nwhile (æ¡ä»¶è¡¨è¾¾å¼) {\n   // å¾ªç¯ä½“    \n}\n~~~\n\nä¾‹å¦‚ï¼š\n\n~~~javascript\n// whileå¾ªç¯: é‡å¤æ‰§è¡Œä»£ç \n\n// 1. éœ€æ±‚: åˆ©ç”¨å¾ªç¯é‡å¤æ‰“å°3æ¬¡ 'æœˆè–ªè¿‡ä¸‡ä¸æ˜¯æ¢¦ï¼Œæ¯•ä¸šæ—¶å€™è§è‹±é›„'\nlet i = 1\nwhile (i <= 3) {\n  document.write('æœˆè–ªè¿‡ä¸‡ä¸æ˜¯æ¢¦ï¼Œæ¯•ä¸šæ—¶å€™è§è‹±é›„~<br>')\n  i++   // è¿™é‡Œåƒä¸‡ä¸è¦å¿˜äº†å˜é‡è‡ªå¢å¦åˆ™é€ æˆæ­»å¾ªç¯\n}\n~~~\n\nå¾ªç¯ä¸‰è¦ç´ ï¼š\n\n1.åˆå§‹å€¼ ï¼ˆç»å¸¸ç”¨å˜é‡ï¼‰\n\n2.ç»ˆæ­¢æ¡ä»¶\n\n3.å˜é‡çš„å˜åŒ–é‡\n\nä¾‹å¦‚ï¼š\n\n~~~javascript\n<script>\n  // // 1. å˜é‡çš„èµ·å§‹å€¼\n  // let i = 1\n  // // 2. ç»ˆæ­¢æ¡ä»¶\n  // while (i <= 3) {\n  //   document.write('æˆ‘è¦å¾ªç¯ä¸‰æ¬¡ <br>')\n  //   // 3. å˜é‡çš„å˜åŒ–é‡\n  //   i++\n  // }\n  // 1. å˜é‡çš„èµ·å§‹å€¼\n  let end = +prompt('è¯·è¾“å…¥æ¬¡æ•°:')\nlet i = 1\n// 2. ç»ˆæ­¢æ¡ä»¶\nwhile (i <= end) {\n  document.write('æˆ‘è¦å¾ªç¯ä¸‰æ¬¡ <br>')\n  // 3. å˜é‡çš„å˜åŒ–é‡\n  i++\n}\n\n</script>\n~~~\n\n#### ä¸­æ­¢å¾ªç¯\n\n`break`   ä¸­æ­¢æ•´ä¸ªå¾ªç¯ï¼Œä¸€èˆ¬ç”¨äºç»“æœå·²ç»å¾—åˆ°, åç»­çš„å¾ªç¯ä¸éœ€è¦çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼ˆæé«˜æ•ˆç‡ï¼‰  \n\n`continue`  ä¸­æ­¢æœ¬æ¬¡å¾ªç¯ï¼Œä¸€èˆ¬ç”¨äºæ’é™¤æˆ–è€…è·³è¿‡æŸä¸€ä¸ªé€‰é¡¹çš„æ—¶å€™\n\n~~~javascript\n<script>\n    // let i = 1\n    // while (i <= 5) {\n    //   console.log(i)\n    //   if (i === 3) {\n    //     break  // é€€å‡ºå¾ªç¯\n    //   }\n    //   i++\n\n    // }\n\n\n    let i = 1\n    while (i <= 5) {\n      if (i === 3) {\n        i++\n        continue\n      }\n      console.log(i)\n      i++\n\n    }\n  </script>\n~~~\n\n#### æ— é™å¾ªç¯\n\n1.while(true) æ¥æ„é€ â€œæ— é™â€å¾ªç¯ï¼Œéœ€è¦ä½¿ç”¨breaké€€å‡ºå¾ªç¯ã€‚ï¼ˆå¸¸ç”¨ï¼‰\n\n2.for(;;) ä¹Ÿå¯ä»¥æ¥æ„é€ â€œæ— é™â€å¾ªç¯ï¼ŒåŒæ ·éœ€è¦ä½¿ç”¨breaké€€å‡ºå¾ªç¯ã€‚\n\n~~~javascript\n// æ— é™å¾ªç¯  \n// éœ€æ±‚ï¼š é¡µé¢ä¼šä¸€ç›´å¼¹çª—è¯¢é—®ä½ çˆ±æˆ‘å—ï¼Ÿ\n// (1). å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯ 'çˆ±'ï¼Œåˆ™é€€å‡ºå¼¹çª—\n// (2). å¦åˆ™ä¸€ç›´å¼¹çª—è¯¢é—®\n\n// 1. while(true) æ— é™å¾ªç¯\n// while (true) {\n//   let love = prompt('ä½ çˆ±æˆ‘å—?')\n//   if (love === 'çˆ±') {\n//     break\n//   }\n// }\n\n// 2. for(;;) æ— é™å¾ªç¯\nfor (; ;) {\n  let love = prompt('ä½ çˆ±æˆ‘å—?')\n  if (love === 'çˆ±') {\n    break\n  }\n}\n~~~\n\n### æ€»ç»“\n\n> **if å¤šåˆ†æ”¯è¯­å¥å’Œ switchçš„åŒºåˆ«ï¼š**\n>\n> 1. å…±åŒç‚¹\n>\n>    - éƒ½èƒ½å®ç°å¤šåˆ†æ”¯é€‰æ‹©ï¼Œ å¤šé€‰1 \n>    - å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¯ä»¥äº’æ¢\n>\n> 2. åŒºåˆ«ï¼š\n>\n>    - switchâ€¦caseè¯­å¥é€šå¸¸å¤„ç†caseä¸ºæ¯”è¾ƒ**ç¡®å®šå€¼**çš„æƒ…å†µï¼Œè€Œifâ€¦elseâ€¦è¯­å¥æ›´åŠ çµæ´»ï¼Œé€šå¸¸ç”¨äº**èŒƒå›´åˆ¤æ–­**(å¤§äºï¼Œç­‰äºæŸä¸ªèŒƒå›´)ã€‚\n>    - switch è¯­å¥è¿›è¡Œåˆ¤æ–­åç›´æ¥æ‰§è¡Œåˆ°ç¨‹åºçš„è¯­å¥ï¼Œæ•ˆç‡æ›´é«˜ï¼Œè€Œifâ€¦elseè¯­å¥æœ‰å‡ ç§åˆ¤æ–­æ¡ä»¶ï¼Œå°±å¾—åˆ¤æ–­å¤šå°‘æ¬¡\n>    - switch ä¸€å®šè¦æ³¨æ„ å¿…é¡»æ˜¯ ===  å…¨ç­‰ï¼Œä¸€å®šæ³¨æ„ æ•°æ®ç±»å‹ï¼ŒåŒæ—¶æ³¨æ„breakå¦åˆ™ä¼šæœ‰ç©¿é€æ•ˆæœ\n>    - ç»“è®ºï¼š\n>      - å½“åˆ†æ”¯æ¯”è¾ƒå°‘æ—¶ï¼Œifâ€¦elseè¯­å¥æ‰§è¡Œæ•ˆç‡é«˜ã€‚\n>      - å½“åˆ†æ”¯æ¯”è¾ƒå¤šæ—¶ï¼Œswitchè¯­å¥æ‰§è¡Œæ•ˆç‡é«˜ï¼Œè€Œä¸”ç»“æ„æ›´æ¸…æ™°ã€‚\n\n## ç»¼åˆæ¡ˆä¾‹-ATMå­˜å–æ¬¾æœº\n\n\n\n![67101878155](../img/JavaScript%E5%9F%BA%E7%A1%80/d4768c75053104c3ba05da6a283df2ce697559838.png)\n\n\n\nåˆ†æï¼š\n\nâ‘ ï¼šæç¤ºè¾“å…¥æ¡†å†™åˆ°å¾ªç¯é‡Œé¢ï¼ˆæ— é™å¾ªç¯ï¼‰\n\nâ‘¡ï¼šç”¨æˆ·è¾“å…¥4åˆ™é€€å‡ºå¾ªç¯ break\n\nâ‘¢ï¼šæå‰å‡†å¤‡ä¸€ä¸ªé‡‘é¢é¢„å…ˆå­˜å‚¨ä¸€ä¸ªæ•°é¢ money\n\nâ‘£ï¼šæ ¹æ®è¾“å…¥ä¸åŒçš„å€¼ï¼Œåšä¸åŒçš„æ“ä½œ\n\nâ€‹     (1)  å–é’±åˆ™æ˜¯å‡æ³•æ“ä½œï¼Œ å­˜é’±åˆ™æ˜¯åŠ æ³•æ“ä½œï¼ŒæŸ¥çœ‹ä½™é¢åˆ™æ˜¯ç›´æ¥æ˜¾ç¤ºé‡‘é¢\n\nâ€‹     (2) å¯ä»¥ä½¿ç”¨ if else if å¤šåˆ†æ”¯ æ¥æ‰§è¡Œä¸åŒçš„æ“ä½œ\n\nå®Œæ•´ä»£ç ï¼š\n\n~~~javascript\n<script>\n  // 1. å¼€å§‹å¾ªç¯ è¾“å…¥æ¡†å†™åˆ° å¾ªç¯é‡Œé¢\n  // 3. å‡†å¤‡ä¸€ä¸ªæ€»çš„é‡‘é¢\n  let money = 100\nwhile (true) {\n  let re = +prompt(`\nè¯·æ‚¨é€‰æ‹©æ“ä½œï¼š\n1.å­˜é’±\n2.å–é’±\n3.æŸ¥çœ‹ä½™é¢\n4.é€€å‡º\n`)\n  // 2. å¦‚æœç”¨æˆ·è¾“å…¥çš„ 4 åˆ™é€€å‡ºå¾ªç¯ï¼Œ break  å†™åˆ°if é‡Œé¢ï¼Œæ²¡æœ‰å†™åˆ°switché‡Œé¢ï¼Œ å› ä¸º4éœ€è¦breaké€€å‡ºå¾ªç¯\n  if (re === 4) {\n    break\n  }\n  // 4. æ ¹æ®è¾“å…¥åšæ“ä½œ\n  switch (re) {\n    case 1:\n      // å­˜é’±\n      let cun = +prompt('è¯·è¾“å…¥å­˜æ¬¾é‡‘é¢')\n      money = money + cun\n      break\n      case 2:\n      // å­˜é’±\n      let qu = +prompt('è¯·è¾“å…¥å–æ¬¾é‡‘é¢')\n      money = money - qu\n      break\n      case 3:\n      // å­˜é’±\n      alert(`æ‚¨çš„é“¶è¡Œå¡ä½™é¢æ˜¯${money}`)\n      break\n  }\n}\n</script>\n~~~\n\n## for è¯­å¥\n\n> æŒæ¡ for å¾ªç¯è¯­å¥ï¼Œè®©ç¨‹åºå…·å¤‡é‡å¤æ‰§è¡Œèƒ½åŠ›\n\n`for` æ˜¯ JavaScript æä¾›çš„å¦ä¸€ç§å¾ªç¯æ§åˆ¶çš„è¯å¥ï¼Œå®ƒå’Œ `while` åªæ˜¯è¯­æ³•ä¸Šå­˜åœ¨å·®å¼‚ã€‚\n\n### forè¯­å¥çš„åŸºæœ¬ä½¿ç”¨\n\n1. å®ç°å¾ªç¯çš„ 3 è¦ç´ \n\n```html\n<script>\n  // 1. è¯­æ³•æ ¼å¼\n  // for(èµ·å§‹å€¼; ç»ˆæ­¢æ¡ä»¶; å˜åŒ–é‡) {\n  //   // è¦é‡å¤æ‰§è¡Œçš„ä»£ç \n  // }\n\n  // 2. ç¤ºä¾‹ï¼šåœ¨ç½‘é¡µä¸­è¾“å…¥æ ‡é¢˜æ ‡ç­¾\n  // èµ·å§‹å€¼ä¸º 1\n  // å˜åŒ–é‡ i++\n  // ç»ˆæ­¢æ¡ä»¶ i <= 6\n  for(let i = 1; i <= 6; i++) {\n    document.write(`<h${i}>å¾ªç¯æ§åˆ¶ï¼Œå³é‡å¤æ‰§è¡Œ<h${i}>`)\n  }\n</script>\n```\n\n2. å˜åŒ–é‡å’Œæ­»å¾ªç¯ï¼Œ`for` å¾ªç¯å’Œ `while` ä¸€æ ·ï¼Œå¦‚æœä¸åˆç†è®¾ç½®å¢é‡å’Œç»ˆæ­¢æ¡ä»¶ï¼Œä¾¿ä¼šäº§ç”Ÿæ­»å¾ªç¯ã€‚\n\n\n3. è·³å‡ºå’Œç»ˆæ­¢å¾ªç¯\n\n```html\n<script>\n    // 1. continue \n    for (let i = 1; i <= 5; i++) {\n        if (i === 3) {\n            continue  // ç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯\n        }\n        console.log(i)\n    }\n    // 2. break\n    for (let i = 1; i <= 5; i++) {\n        if (i === 3) {\n            break  // é€€å‡ºç»“æŸæ•´ä¸ªå¾ªç¯\n        }\n        console.log(i)\n    }\n</script>\n```\n\nç»“è®ºï¼š\n\n- `JavaScript` æä¾›äº†å¤šç§è¯­å¥æ¥å®ç°å¾ªç¯æ§åˆ¶ï¼Œä½†æ— è®ºä½¿ç”¨å“ªç§è¯­å¥éƒ½ç¦»ä¸å¼€å¾ªç¯çš„3ä¸ªç‰¹å¾ï¼Œå³èµ·å§‹å€¼ã€å˜åŒ–é‡ã€ç»ˆæ­¢æ¡ä»¶ï¼Œåšä¸ºåˆå­¦è€…åº”ç€é‡ä½“ä¼šè¿™3ä¸ªç‰¹å¾ï¼Œä¸å¿…è¿‡å¤šçº ç»“ä¸‰ç§è¯­å¥çš„åŒºåˆ«ã€‚\n- èµ·å§‹å€¼ã€å˜åŒ–é‡ã€ç»ˆæ­¢æ¡ä»¶ï¼Œç”±å¼€å‘è€…æ ¹æ®é€»è¾‘éœ€è¦è¿›è¡Œè®¾è®¡ï¼Œè§„é¿æ­»å¾ªç¯çš„å‘ç”Ÿã€‚\n- å½“å¦‚æœæ˜ç¡®äº†å¾ªç¯çš„æ¬¡æ•°çš„æ—¶å€™æ¨èä½¿ç”¨`for`å¾ªç¯,å½“ä¸æ˜ç¡®å¾ªç¯çš„æ¬¡æ•°çš„æ—¶å€™æ¨èä½¿ç”¨`while`å¾ªç¯\n\n>æ³¨æ„ï¼š`for` çš„è¯­æ³•ç»“æ„æ›´ç®€æ´ï¼Œæ•… `for` å¾ªç¯çš„ä½¿ç”¨é¢‘æ¬¡ä¼šæ›´å¤šã€‚\n\n\n\n### å¾ªç¯åµŒå¥—\n\nåˆ©ç”¨å¾ªç¯çš„çŸ¥è¯†æ¥å¯¹æ¯”ä¸€ä¸ªç®€å•çš„å¤©æ–‡çŸ¥è¯†ï¼Œæˆ‘ä»¬çŸ¥é“åœ°çƒåœ¨è‡ªè½¬çš„åŒæ—¶ä¹Ÿåœ¨å›´ç»•å¤ªé˜³å…¬è½¬ï¼Œå¦‚æœæŠŠè‡ªè½¬å’Œå…¬è½¬éƒ½çœ‹æˆæ˜¯å¾ªç¯çš„è¯ï¼Œå°±ç›¸å½“äºæ˜¯å¾ªç¯ä¸­åˆåµŒå¥—äº†å¦ä¸€ä¸ªå¾ªç¯ã€‚\n\n![universe](../img/JavaScript%E5%9F%BA%E7%A1%80/d2c0e179a219843bdaf30e1781734889697559838.gif)\n\nå®é™…ä¸Š JavaScript ä¸­ä»»ä½•ä¸€ç§å¾ªç¯è¯­å¥éƒ½æ”¯æŒå¾ªç¯çš„åµŒå¥—ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š\n\n![64791826139](../img/JavaScript%E5%9F%BA%E7%A1%80/797b531035e1adb675ec853fba7b7414697559838.png)\n\n```html\n// 1. å¤–é¢çš„å¾ªç¯ è®°å½•ç¬¬nå¤© \nfor (let i = 1; i < 4; i++) {\n    document.write(`ç¬¬${i}å¤© <br>`)\n    // 2. é‡Œå±‚çš„å¾ªç¯è®°å½• å‡ ä¸ªå•è¯\n    for (let j = 1; j < 6; j++) {\n        document.write(`è®°ä½ç¬¬${j}ä¸ªå•è¯<br>`)\n    }\n}\n```\n\nè®°ä½ï¼Œå¤–å±‚å¾ªç¯å¾ªç¯ä¸€æ¬¡ï¼Œé‡Œå±‚å¾ªç¯å¾ªç¯å…¨éƒ¨\n\n#### å€’ä¸‰è§’\n\n~~~javascript\n // å¤–å±‚æ‰“å°å‡ è¡Œ\nfor (let i = 1; i <= 5; i++) {\n    // é‡Œå±‚æ‰“å°å‡ ä¸ªæ˜Ÿæ˜Ÿ\n    for (let j = 1; j <= i; j++) {\n        document.write('â˜…')\n    }\n    document.write('<br>')\n}\n~~~\n\n ![64791867895](../img/JavaScript%E5%9F%BA%E7%A1%80/3789b2ee2b9fac332b31937f402b9b88697559838.png)\n\n#### ä¹ä¹ä¹˜æ³•è¡¨\n\næ ·å¼css\n\n~~~css\nspan {\n    display: inline-block;\n    width: 100px;\n    padding: 5px 10px;\n    border: 1px solid pink;\n    margin: 2px;\n    border-radius: 5px;\n    box-shadow: 2px 2px 2px rgba(255, 192, 203, .4);\n    background-color: rgba(255, 192, 203, .1);\n    text-align: center;\n    color: hotpink;\n}\n~~~\n\njavascript \n\n~~~javascript\n // å¤–å±‚æ‰“å°å‡ è¡Œ\nfor (let i = 1; i <= 9; i++) {\n    // é‡Œå±‚æ‰“å°å‡ ä¸ªæ˜Ÿæ˜Ÿ\n    for (let j = 1; j <= i; j++) {\n        // åªéœ€è¦å§ â˜… æ¢æˆ  1 x 1 = 1   \n        document.write(`\n\t\t<div> ${j} x ${i} = ${j * i} </div>\n     `)\n    }\n    document.write('<br>')\n}\n~~~\n\n![64791873467](../img/JavaScript%E5%9F%BA%E7%A1%80/ca033fbc176da1c0580090729f41add7697559838.png)\n\n## æ•°ç»„\n\n> çŸ¥é“ä»€ä¹ˆæ˜¯æ•°ç»„åŠå…¶åº”ç”¨çš„åœºæ™¯ï¼ŒæŒæ¡æ•°ç»„å£°æ˜åŠè®¿é—®çš„è¯­æ³•ã€‚\n\n### æ•°ç»„æ˜¯ä»€ä¹ˆï¼Ÿ\n\n**æ•°ç»„ï¼š**(Array)æ˜¯ä¸€ç§å¯ä»¥æŒ‰é¡ºåºä¿å­˜æ•°æ®çš„æ•°æ®ç±»å‹\n\n**ä½¿ç”¨åœºæ™¯ï¼š**å¦‚æœæœ‰å¤šä¸ªæ•°æ®å¯ä»¥ç”¨æ•°ç»„ä¿å­˜èµ·æ¥ï¼Œç„¶åæ”¾åˆ°ä¸€ä¸ªå˜é‡ä¸­ï¼Œç®¡ç†éå¸¸æ–¹ä¾¿\n\n### æ•°ç»„çš„åŸºæœ¬ä½¿ç”¨\n\n#### å®šä¹‰æ•°ç»„å’Œæ•°ç»„å•å…ƒ\n\n```html\n<script>\n  // 1. è¯­æ³•ï¼Œä½¿ç”¨ [] æ¥å®šä¹‰ä¸€ä¸ªç©ºæ•°ç»„\n  // å®šä¹‰ä¸€ä¸ªç©ºæ•°ç»„ï¼Œç„¶åèµ‹å€¼ç»™å˜é‡ classes\n  // let classes = [];\n\n  // 2. å®šä¹‰éç©ºæ•°ç»„\n  let classes = ['å°æ˜', 'å°åˆš', 'å°çº¢', 'å°ä¸½', 'å°ç±³']\n</script>\n```\n\né€šè¿‡ `[]` å®šä¹‰æ•°ç»„ï¼Œæ•°æ®ä¸­å¯ä»¥å­˜æ”¾çœŸæ­£çš„æ•°æ®ï¼Œå¦‚å°æ˜ã€å°åˆšã€å°çº¢ç­‰è¿™äº›éƒ½æ˜¯æ•°ç»„ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬è¿™äº›æ•°æ®ç§°ä¸ºæ•°ç»„å•å…ƒï¼Œæ•°ç»„å•å…ƒä¹‹é—´ä½¿ç”¨è‹±æ–‡é€—å·åˆ†éš”ã€‚\n\n#### è®¿é—®æ•°ç»„å’Œæ•°ç»„ç´¢å¼•\n\nä½¿ç”¨æ•°ç»„å­˜æ”¾æ•°æ®å¹¶ä¸æ˜¯æœ€ç»ˆç›®çš„ï¼Œå…³é”®æ˜¯èƒ½å¤Ÿéšæ—¶çš„è®¿é—®åˆ°æ•°ç»„ä¸­çš„æ•°æ®ï¼ˆå•å…ƒï¼‰ã€‚å…¶å® JavaScript ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®å•å…ƒéƒ½ç¼–äº†å·ï¼Œé€šè¿‡æ•°æ®å•å…ƒåœ¨æ•°ç»„ä¸­çš„ç¼–å·ä¾¿å¯ä»¥è½»æ¾è®¿é—®åˆ°æ•°ç»„ä¸­çš„æ•°æ®å•å…ƒäº†ã€‚\n\næˆ‘ä»¬å°†æ•°æ®å•å…ƒåœ¨æ•°ç»„ä¸­çš„ç¼–å·ç§°ä¸ºç´¢å¼•å€¼ï¼Œä¹Ÿæœ‰äººç§°å…¶ä¸ºä¸‹æ ‡ã€‚\n\nç´¢å¼•å€¼å®é™…æ˜¯æŒ‰ç€æ•°æ®å•å…ƒåœ¨æ•°ç»„ä¸­çš„ä½ç½®ä¾æ¬¡æ’åˆ—çš„ï¼Œæ³¨æ„æ˜¯ä»` 0` å¼€å§‹çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![array](../img/JavaScript%E5%9F%BA%E7%A1%80/5012790158782c15696a69570a182692697559838.jpg)\n\nè§‚å¯Ÿä¸Šå›¾å¯ä»¥æ•°æ®å•å…ƒã€å°æ˜ã€‘å¯¹åº”çš„ç´¢å¼•å€¼ä¸ºã€0ã€‘ï¼Œæ•°æ®å•å…ƒã€å°çº¢ã€‘å¯¹åº”çš„ç´¢å¼•å€¼ä¸ºã€2ã€‘\n\n```html\n<script>\n  let classes = ['å°æ˜', 'å°åˆš', 'å°çº¢', 'å°ä¸½', 'å°ç±³']\n  \n  // 1. è®¿é—®æ•°ç»„ï¼Œè¯­æ³•æ ¼å¼ä¸ºï¼šå˜é‡å[ç´¢å¼•å€¼]\n  document.write(classes[0] // ç»“æœä¸ºï¼šå°æ˜\n  document.write(classes[1] // ç»“æœä¸ºï¼šå°åˆš\n  document.write(classes[4] // ç»“æœä¸ºï¼šå°ç±³\n  \n  // 2. é€šè¿‡ç´¢å¼•å€¼è¿˜å¯ä»¥ä¸ºæ•°ç»„å•é‡æ–°èµ‹å€¼\n  document.write(classes[3] // ç»“æœä¸ºï¼šå°ä¸½\n  // é‡æ–°ä¸ºç´¢å¼•å€¼ä¸º 3 çš„å•å…ƒèµ‹å€¼\n  classes[3] = 'å°å°ä¸½'\n  document.wirte(classes[3]; // ç»“æœä¸ºï¼š å°å°ä¸½\n</script>\n```\n\n#### æ•°æ®å•å…ƒå€¼ç±»å‹\n\næ•°ç»„åšä¸ºæ•°æ®çš„é›†åˆï¼Œå®ƒçš„å•å…ƒå€¼å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹\n\n```html\n<script>\n  // 6. æ•°ç»„å•å€¼ç±»å‹å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹\n\n  // a) æ•°ç»„å•å…ƒå€¼çš„ç±»å‹ä¸ºå­—ç¬¦ç±»å‹\n  let list = ['HTML', 'CSS', 'JavaScript']\n  // b) æ•°ç»„å•å…ƒå€¼çš„ç±»å‹ä¸ºæ•°å€¼ç±»å‹\n  let scores = [78, 84, 70, 62, 75]\n  // c) æ··åˆå¤šç§ç±»å‹\n  let mixin = [true, 1, false, 'hello']\n</script>\n```\n\n#### æ•°ç»„é•¿åº¦å±æ€§\n\né‡ç”³ä¸€æ¬¡ï¼Œæ•°ç»„åœ¨ JavaScript ä¸­å¹¶ä¸æ˜¯æ–°çš„æ•°æ®ç±»å‹ï¼Œå®ƒå±äºå¯¹è±¡ç±»å‹ã€‚\n\n```html\n<script>\n  // å®šä¹‰ä¸€ä¸ªæ•°ç»„\n  let arr = ['html', 'css', 'javascript']\n  // æ•°ç»„å¯¹åº”ç€ä¸€ä¸ª length å±æ€§ï¼Œå®ƒçš„å«ä¹‰æ˜¯è·å–æ•°ç»„çš„é•¿åº¦\n  console.log(arr.length) // 3\n</script>\n```\n\n### æ“ä½œæ•°ç»„\n\næ•°ç»„åšä¸ºå¯¹è±¡æ•°æ®ç±»å‹ï¼Œä¸ä½†æœ‰ `length` å±æ€§å¯ä»¥ä½¿ç”¨ï¼Œè¿˜æä¾›äº†è®¸å¤šæ–¹æ³•ï¼š\n\n1. push åŠ¨æ€å‘æ•°ç»„çš„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå•å…ƒ\n2. unshit åŠ¨æ€å‘æ•°ç»„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªå•å…ƒ\n3. pop åˆ é™¤æœ€åä¸€ä¸ªå•å…ƒ\n4. shift åˆ é™¤ç¬¬ä¸€ä¸ªå•å…ƒ\n5. splice åŠ¨æ€åˆ é™¤ä»»æ„å•å…ƒ\n\nä½¿ç”¨ä»¥ä¸Š4ä¸ªæ–¹æ³•æ—¶ï¼Œéƒ½æ˜¯ç›´æ¥åœ¨åŸæ•°ç»„ä¸Šè¿›è¡Œæ“ä½œï¼Œå³æˆåŠŸè°ƒä»»ä½•ä¸€ä¸ªæ–¹æ³•ï¼ŒåŸæ•°ç»„éƒ½è·Ÿç€å‘ç”Ÿç›¸åº”çš„æ”¹å˜ã€‚å¹¶ä¸”åœ¨æ·»åŠ æˆ–åˆ é™¤å•å…ƒæ—¶ `length` å¹¶ä¸ä¼šå‘ç”Ÿé”™ä¹±ã€‚\n\n```html\n<script>\n  // å®šä¹‰ä¸€ä¸ªæ•°ç»„\n  let arr = ['html', 'css', 'javascript']\n\n  // 1. push åŠ¨æ€å‘æ•°ç»„çš„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå•å…ƒ\n  arr.push('Nodejs')\n  console.log(arr)\n  arr.push('Vue')\n\n  // 2. unshit åŠ¨æ€å‘æ•°ç»„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªå•å…ƒ\n  arr.unshift('VS Code')\n  console.log(arr)\n\n  // 3. splice åŠ¨æ€åˆ é™¤ä»»æ„å•å…ƒ\n  arr.splice(2, 1) // ä»ç´¢å¼•å€¼ä¸º2çš„ä½ç½®å¼€å§‹åˆ é™¤1ä¸ªå•å…ƒ\n  console.log(arr)\n\n  // 4. pop åˆ é™¤æœ€åä¸€ä¸ªå•å…ƒ\n  arr.pop()\n  console.log(arr)\n\n  // 5. shift åˆ é™¤ç¬¬ä¸€ä¸ªå•å…ƒ\n  arr.shift()\n  console.log(arr)\n</script>\n```\n\n## å‡½æ•°\n\n> ç†è§£å°è£…çš„æ„ä¹‰ï¼Œèƒ½å¤Ÿé€šè¿‡å‡½æ•°çš„å£°æ˜å®ç°é€»è¾‘çš„å°è£…ï¼ŒçŸ¥é“å¯¹è±¡æ•°æ®ç±»å‹çš„ç‰¹å¾ï¼Œç»“åˆæ•°å­¦å¯¹è±¡å®ç°ç®€å•è®¡ç®—åŠŸèƒ½ã€‚\n\n- ç†è§£å‡½æ•°çš„å°è£…çš„ç‰¹å¾\n- æŒæ¡å‡½æ•°å£°æ˜çš„è¯­æ³•\n- ç†è§£ä»€ä¹ˆæ˜¯å‡½æ•°çš„è¿”å›å€¼\n- çŸ¥é“å¹¶èƒ½ä½¿ç”¨å¸¸è§çš„å†…ç½®å‡½æ•°\n\n> ç†è§£å‡½æ•°çš„å°è£…ç‰¹æ€§ï¼ŒæŒæ¡å‡½æ•°çš„è¯­æ³•è§„åˆ™\n\n### å£°æ˜å’Œè°ƒç”¨\n\nå‡½æ•°å¯ä»¥æŠŠå…·æœ‰ç›¸åŒæˆ–ç›¸ä¼¼é€»è¾‘çš„ä»£ç â€œåŒ…è£¹â€èµ·æ¥ï¼Œé€šè¿‡å‡½æ•°è°ƒç”¨æ‰§è¡Œè¿™äº›è¢«â€œåŒ…è£¹â€çš„ä»£ç é€»è¾‘ï¼Œè¿™ä¹ˆåšçš„ä¼˜åŠ¿æ˜¯æœ‰åˆ©äºç²¾ç®€ä»£ç æ–¹ä¾¿å¤ç”¨ã€‚\n\n#### å£°æ˜ï¼ˆå®šä¹‰ï¼‰\n\nå£°æ˜ï¼ˆå®šä¹‰ï¼‰ä¸€ä¸ªå®Œæ•´å‡½æ•°åŒ…æ‹¬å…³é”®å­—ã€å‡½æ•°åã€å½¢å¼å‚æ•°ã€å‡½æ•°ä½“ã€è¿”å›å€¼5ä¸ªéƒ¨åˆ†\n\n![function](../img/JavaScript%E5%9F%BA%E7%A1%80/a55aaafe880c7233191e50fe81643820697559838.jpg)\n\n#### è°ƒç”¨\n\nå£°æ˜ï¼ˆå®šä¹‰ï¼‰çš„å‡½æ•°å¿…é¡»è°ƒç”¨æ‰ä¼šçœŸæ­£è¢«æ‰§è¡Œï¼Œä½¿ç”¨ `()` è°ƒç”¨å‡½æ•°ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å£°æ˜å’Œè°ƒç”¨</title>\n</head>\n<body>\n  <script>\n    // å£°æ˜ï¼ˆå®šä¹‰ï¼‰äº†æœ€ç®€å•çš„å‡½æ•°ï¼Œæ—¢æ²¡æœ‰å½¢å¼å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰è¿”å›å€¼\n    function sayHi() {\n      console.log('å—¨~')\n    }\n    // å‡½æ•°è°ƒç”¨ï¼Œè¿™äº›å‡½æ•°ä½“å†…çš„ä»£ç é€»è¾‘ä¼šè¢«æ‰§è¡Œ\n    // å‡½æ•°å()\n        \n    sayHi()\n    // å¯ä»¥é‡å¤è¢«è°ƒç”¨ï¼Œå¤šå°‘æ¬¡éƒ½å¯ä»¥\n    sayHi()\n  </script>\n</body>\n</html>\n```\n\n> æ³¨ï¼šå‡½æ•°åçš„å‘½åè§„åˆ™ä¸å˜é‡æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”å°½é‡ä¿è¯å‡½æ•°åçš„è¯­ä¹‰ã€‚\n\nå°æ¡ˆä¾‹ï¼š å°æ˜Ÿæ˜Ÿ\n\n~~~javascript\n<script>\n        // å‡½æ•°å£°æ˜\n        function sayHi() {\n            // document.write('hai~')\n            document.write(`*<br>`)\n            document.write(`**<br>`)\n            document.write(`***<br>`)\n            document.write(`****<br>`)\n            document.write(`*****<br>`)\n            document.write(`******<br>`)\n            document.write(`*******<br>`)\n            document.write(`********<br>`)\n            document.write(`*********<br>`)\n        }\n        // å‡½æ•°è°ƒç”¨\n        sayHi()\n        sayHi()\n        sayHi()\n        sayHi()\n        sayHi()\n    </script>\n~~~\n\n###  å‚æ•°\n\né€šè¿‡å‘å‡½æ•°ä¼ é€’å‚æ•°ï¼Œå¯ä»¥è®©å‡½æ•°æ›´åŠ çµæ´»å¤šå˜ï¼Œå‚æ•°å¯ä»¥ç†è§£æˆæ˜¯ä¸€ä¸ªå˜é‡ã€‚\n\nå£°æ˜ï¼ˆå®šä¹‰ï¼‰ä¸€ä¸ªåŠŸèƒ½ä¸ºæ‰“æ‹›å‘¼çš„å‡½æ•°\n\n- ä¼ å…¥æ•°æ®åˆ—è¡¨\n- å£°æ˜è¿™ä¸ªå‡½æ•°éœ€è¦ä¼ å…¥å‡ ä¸ªæ•°æ®\n- å¤šä¸ªæ•°æ®ç”¨é€—å·éš”å¼€\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å‡½æ•°å‚æ•°</title>\n</head>\n<body>\n\n  <script>\n    // å£°æ˜ï¼ˆå®šä¹‰ï¼‰ä¸€ä¸ªåŠŸèƒ½ä¸ºæ‰“æ‹›å‘¼çš„å‡½æ•°\n    // function sayHi() {\n    //   console.log('å—¨~')\n    // }\n    // è°ƒç”¨å‡½æ•°\n    // sayHi()\n\t\n\n    // è¿™ä¸ªå‡½æ•°ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆä»·å€¼ï¼Œé™¤éèƒ½å¤Ÿå‘ä¸åŒçš„äººæ‰“æ‹›å‘¼\n    // è¿™å°±éœ€è¦å€ŸåŠ©å‚æ•°æ¥å®ç°äº†\n    function sayHi(name) {\n      // å‚æ•° name å¯ä»¥è¢«ç†è§£æˆæ˜¯ä¸€ä¸ªå˜é‡\n      console.log(name)\n      console.log('å—¨~' + name)\n    }\n\n    // è°ƒç”¨ sayHi å‡½æ•°ï¼Œæ‹¬å·ä¸­å¤šäº† 'å°æ˜'\n    // è¿™æ—¶ç›¸å½“äºä¸ºå‚æ•° name èµ‹å€¼äº†\n    sayHi('å°æ˜')// ç»“æœä¸º å°æ˜\n\n    // å†æ¬¡è°ƒç”¨ sayHi å‡½æ•°ï¼Œæ‹¬å·ä¸­å¤šäº† 'å°çº¢'\n    // è¿™æ—¶ç›¸å½“äºä¸ºå‚æ•° name èµ‹å€¼äº†\n    sayHi('å°çº¢') // ç»“æœä¸º å°çº¢\n  </script>\n</body>\n</html>\n```\n\næ€»ç»“ï¼š\n\n1. å£°æ˜ï¼ˆå®šä¹‰ï¼‰å‡½æ•°æ—¶çš„å½¢å‚æ²¡æœ‰æ•°é‡é™åˆ¶ï¼Œå½“æœ‰å¤šä¸ªå½¢å‚æ—¶ä½¿ç”¨ `,` åˆ†éš”\n2. è°ƒç”¨å‡½æ•°ä¼ é€’çš„å®å‚è¦ä¸å½¢å‚çš„é¡ºåºä¸€è‡´\n\n#### å½¢å‚å’Œå®å‚\n\nå½¢å‚ï¼šå£°æ˜å‡½æ•°æ—¶å†™åœ¨å‡½æ•°åå³è¾¹å°æ‹¬å·é‡Œçš„å«å½¢å‚ï¼ˆå½¢å¼ä¸Šçš„å‚æ•°ï¼‰\n\nå®å‚ï¼šè°ƒç”¨å‡½æ•°æ—¶å†™åœ¨å‡½æ•°åå³è¾¹å°æ‹¬å·é‡Œçš„å«å®å‚ï¼ˆå®é™…ä¸Šçš„å‚æ•°ï¼‰\n\nå½¢å‚å¯ä»¥ç†è§£ä¸ºæ˜¯åœ¨è¿™ä¸ªå‡½æ•°å†…å£°æ˜çš„å˜é‡ï¼ˆæ¯”å¦‚ num1 = 10ï¼‰å®å‚å¯ä»¥ç†è§£ä¸ºæ˜¯ç»™è¿™ä¸ªå˜é‡èµ‹å€¼\n\nå¼€å‘ä¸­å°½é‡ä¿æŒå½¢å‚å’Œå®å‚ä¸ªæ•°ä¸€è‡´\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å‡½æ•°å‚æ•°</title>\n</head>\n<body>\n  <script>\n    // å£°æ˜ï¼ˆå®šä¹‰ï¼‰ä¸€ä¸ªè®¡ç®—ä»»æ„ä¸¤æ•°å­—å’Œçš„å‡½æ•°\n    // å½¢å‚ x å’Œ y åˆ†åˆ«è¡¨ç¤ºä»»æ„ä¸¤ä¸ªæ•°å­—ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªå˜é‡\n    function count(x, y) {\n      console.log(x + y);\n    }\n    // è°ƒç”¨å‡½æ•°ï¼Œä¼ å…¥ä¸¤ä¸ªå…·ä½“çš„æ•°å­—åšä¸ºå®å‚\n    // æ­¤æ—¶ 10 èµ‹å€¼ç»™äº†å½¢å‚ x\n    // æ­¤æ—¶ 5  èµ‹å€¼ç»™äº†å½¢å‚ y\n    count(10, 5); // ç»“æœä¸º 15\n  </script>\n</body>\n</html>\n```\n\n### è¿”å›å€¼\n\nå‡½æ•°çš„æœ¬è´¨æ˜¯å°è£…ï¼ˆåŒ…è£¹ï¼‰ï¼Œå‡½æ•°ä½“å†…çš„é€»è¾‘æ‰§è¡Œå®Œæ¯•åï¼Œå‡½æ•°å¤–éƒ¨å¦‚ä½•è·å¾—å‡½æ•°å†…éƒ¨çš„æ‰§è¡Œç»“æœå‘¢ï¼Ÿè¦æƒ³è·å¾—å‡½æ•°å†…éƒ¨é€»è¾‘çš„æ‰§è¡Œç»“æœï¼Œéœ€è¦é€šè¿‡ `return` è¿™ä¸ªå…³é”®å­—ï¼Œå°†å†…éƒ¨æ‰§è¡Œç»“æœä¼ é€’åˆ°å‡½æ•°å¤–éƒ¨ï¼Œè¿™ä¸ªè¢«ä¼ é€’åˆ°å¤–éƒ¨çš„ç»“æœå°±æ˜¯è¿”å›å€¼ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å‡½æ•°è¿”å›å€¼</title>\n</head>\n<body>\n\n  <script>\n    // å®šä¹‰æ±‚å’Œå‡½æ•°\n    function count(a, b) {\n      let s = a + b\n      // s å³ä¸º a + b çš„ç»“æœ\n      // é€šè¿‡ return å°† s ä¼ é€’åˆ°å¤–éƒ¨\n      return s\n    }\n\n    // è°ƒç”¨å‡½æ•°ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æœ‰è¿”å›å€¼\n    // é‚£ä¹ˆå¯å°†è¿™ä¸ªè¿”å›å€¼èµ‹å€¼ç»™å¤–éƒ¨çš„ä»»æ„å˜é‡\n    let total = count(5, 12)\n  </script>\n</body>\n</html>\n```\n\næ€»ç»“ï¼š\n\n1. åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨return å…³é”®å­—èƒ½å°†å†…éƒ¨çš„æ‰§è¡Œç»“æœäº¤ç»™å‡½æ•°å¤–éƒ¨ä½¿ç”¨\n2. å‡½æ•°å†…éƒ¨åªèƒ½å‡ºç°1 æ¬¡ returnï¼Œå¹¶ä¸” return ä¸‹ä¸€è¡Œä»£ç ä¸ä¼šå†è¢«æ‰§è¡Œï¼Œæ‰€ä»¥return åé¢çš„æ•°æ®ä¸è¦æ¢è¡Œå†™\n3. returnä¼šç«‹å³ç»“æŸå½“å‰å‡½æ•°\n4. å‡½æ•°å¯ä»¥æ²¡æœ‰returnï¼Œè¿™ç§æƒ…å†µé»˜è®¤è¿”å›å€¼ä¸º undefined\n\n### ä½œç”¨åŸŸ\n\né€šå¸¸æ¥è¯´ï¼Œä¸€æ®µç¨‹åºä»£ç ä¸­æ‰€ç”¨åˆ°çš„åå­—å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆå’Œå¯ç”¨çš„ï¼Œè€Œé™å®šè¿™ä¸ªåå­—çš„å¯ç”¨æ€§çš„ä»£ç èŒƒå›´å°±æ˜¯è¿™ä¸ªåå­—çš„ä½œç”¨åŸŸã€‚\n\nä½œç”¨åŸŸçš„ä½¿ç”¨æé«˜äº†ç¨‹åºé€»è¾‘çš„å±€éƒ¨æ€§ï¼Œå¢å¼ºäº†ç¨‹åºçš„å¯é æ€§ï¼Œå‡å°‘äº†åå­—å†²çªã€‚\n\n#### å…¨å±€ä½œç”¨åŸŸ\n\nä½œç”¨äºæ‰€æœ‰ä»£ç æ‰§è¡Œçš„ç¯å¢ƒ(æ•´ä¸ª script æ ‡ç­¾å†…éƒ¨)æˆ–è€…ä¸€ä¸ªç‹¬ç«‹çš„ js æ–‡ä»¶\n\nå¤„äºå…¨å±€ä½œç”¨åŸŸå†…çš„å˜é‡ï¼Œç§°ä¸ºå…¨å±€å˜é‡\n\n#### å±€éƒ¨ä½œç”¨åŸŸ\n\nä½œç”¨äºå‡½æ•°å†…çš„ä»£ç ç¯å¢ƒï¼Œå°±æ˜¯å±€éƒ¨ä½œç”¨åŸŸã€‚ å› ä¸ºè·Ÿå‡½æ•°æœ‰å…³ç³»ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºå‡½æ•°ä½œç”¨åŸŸã€‚\n\nå¤„äºå±€éƒ¨ä½œç”¨åŸŸå†…çš„å˜é‡ç§°ä¸ºå±€éƒ¨å˜é‡\n\n>å¦‚æœå‡½æ•°å†…éƒ¨ï¼Œå˜é‡æ²¡æœ‰å£°æ˜ï¼Œç›´æ¥èµ‹å€¼ï¼Œä¹Ÿå½“å…¨å±€å˜é‡çœ‹ï¼Œä½†æ˜¯å¼ºçƒˆä¸æ¨è\n>\n>ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µï¼Œå‡½æ•°å†…éƒ¨çš„å½¢å‚å¯ä»¥çœ‹åšæ˜¯å±€éƒ¨å˜é‡ã€‚\n\n### åŒ¿åå‡½æ•°\n\nå‡½æ•°å¯ä»¥åˆ†ä¸ºå…·åå‡½æ•°å’ŒåŒ¿åå‡½æ•°\n\nåŒ¿åå‡½æ•°ï¼šæ²¡æœ‰åå­—çš„å‡½æ•°,æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚\n\n#### å‡½æ•°è¡¨è¾¾å¼\n\n~~~javascript\n// å£°æ˜\nlet fn = function() { \n   console.log('å‡½æ•°è¡¨è¾¾å¼')\n}\n// è°ƒç”¨\nfn()\n~~~\n\n#### ç«‹å³æ‰§è¡Œå‡½æ•°\n\n~~~javascript\n(function(){ xxx  })();\n(function(){xxxx}());\n~~~\n\n>æ— éœ€è°ƒç”¨ï¼Œç«‹å³æ‰§è¡Œï¼Œå…¶å®æœ¬è´¨å·²ç»è°ƒç”¨äº†\n>\n>å¤šä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ä¹‹é—´ç”¨åˆ†å·éš”å¼€\n\nåœ¨èƒ½å¤Ÿè®¿é—®åˆ°çš„æƒ…å†µä¸‹ å…ˆå±€éƒ¨ å±€éƒ¨æ²¡æœ‰åœ¨æ‰¾å…¨å±€\n\n## å¯¹è±¡\n\n> çŸ¥é“å¯¹è±¡æ•°æ®ç±»å‹çš„ç‰¹å¾ï¼Œèƒ½å¤Ÿåˆ©ç”¨æ•°ç»„å¯¹è±¡æ¸²æŸ“é¡µé¢\n\n- ç†è§£ä»€ä¹ˆæ˜¯å¯¹è±¡ï¼ŒæŒæ¡å®šä¹‰å¯¹è±¡çš„è¯­æ³•\n- æŒæ¡æ•°å­¦å¯¹è±¡çš„ä½¿ç”¨\n\n> å¯¹è±¡æ˜¯ JavaScript æ•°æ®ç±»å‹çš„ä¸€ç§ï¼Œä¹‹å‰å·²ç»å­¦ä¹ äº†æ•°å€¼ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€å¸ƒå°”ç±»å‹ã€undefinedã€‚å¯¹è±¡æ•°æ®ç±»å‹å¯ä»¥è¢«ç†è§£æˆæ˜¯ä¸€ç§æ•°æ®é›†åˆã€‚å®ƒç”±å±æ€§å’Œæ–¹æ³•ä¸¤éƒ¨åˆ†æ„æˆã€‚\n\n### è¯­æ³•\n\nå£°æ˜ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„å˜é‡ä¸ä¹‹å‰å£°æ˜ä¸€ä¸ªæ•°å€¼æˆ–å­—ç¬¦ä¸²ç±»å‹çš„å˜é‡æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¯¹è±¡è¯­æ³•</title>\n</head>\n<body>\n\n  <script>\n    // å£°æ˜å­—ç¬¦ä¸²ç±»å‹å˜é‡\n    let str = 'hello world!'\n    \n    // å£°æ˜æ•°å€¼ç±»å‹å˜é‡\n    let num = 199\n\n    // å£°æ˜å¯¹è±¡ç±»å‹å˜é‡ï¼Œä½¿ç”¨ä¸€å¯¹èŠ±æ‹¬å·\n    // user ä¾¿æ˜¯ä¸€ä¸ªå¯¹è±¡äº†ï¼Œç›®å‰å®ƒæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡\n    let user = {}\n  </script>\n</body>\n</html>\n```\n\n### å±æ€§å’Œè®¿é—®\n\næ•°æ®æè¿°æ€§çš„ä¿¡æ¯ç§°ä¸ºå±æ€§ï¼Œå¦‚äººçš„å§“åã€èº«é«˜ã€å¹´é¾„ã€æ€§åˆ«ç­‰ï¼Œä¸€èˆ¬æ˜¯åè¯æ€§çš„ã€‚\n\n1. å±æ€§éƒ½æ˜¯æˆ å¯¹å‡ºç°çš„ï¼ŒåŒ…æ‹¬å±æ€§åå’Œå€¼ï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨è‹±æ–‡ `:` åˆ†éš”\n2. å¤šä¸ªå±æ€§ä¹‹é—´ä½¿ç”¨è‹±æ–‡ `,` åˆ†éš”\n3. å±æ€§å°±æ˜¯ä¾é™„åœ¨å¯¹è±¡ä¸Šçš„å˜é‡\n4. å±æ€§åå¯ä»¥ä½¿ç”¨ `\"\"` æˆ– `''`ï¼Œä¸€èˆ¬æƒ…å†µä¸‹çœç•¥ï¼Œé™¤éåç§°é‡åˆ°ç‰¹æ®Šç¬¦å·å¦‚ç©ºæ ¼ã€ä¸­æ¨ªçº¿ç­‰\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¯¹è±¡è¯­æ³•</title>\n</head>\n<body>\n\n  <script>\n    // é€šè¿‡å¯¹è±¡æè¿°ä¸€ä¸ªäººçš„æ•°æ®ä¿¡æ¯\n    // person æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªå±æ€§ name\n    // å±æ€§éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå±æ€§å å’Œ å€¼ï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨è‹±æ–‡ : åˆ†éš”\n    let person = {\n      name: 'å°æ˜', // æè¿°äººçš„å§“å\n      age: 18, // æè¿°äººçš„å¹´é¾„\n      stature: 185, // æè¿°äººçš„èº«é«˜\n      gender: 'ç”·', // æè¿°äººçš„æ€§åˆ«\n    }\n  </script>\n</body>\n</html>\n```\n\nå£°æ˜å¯¹è±¡ï¼Œå¹¶æ·»åŠ äº†è‹¥å¹²å±æ€§åï¼Œå¯ä»¥ä½¿ç”¨ `.` æˆ– `[]` è·å¾—å¯¹è±¡ä¸­å±æ€§å¯¹åº”çš„å€¼ï¼Œæˆ‘ç§°ä¹‹ä¸ºå±æ€§è®¿é—®ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¯¹è±¡è¯­æ³•</title>\n</head>\n<body>\n\n  <script>\n    // é€šè¿‡å¯¹è±¡æè¿°ä¸€ä¸ªäººçš„æ•°æ®ä¿¡æ¯\n    // person æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªå±æ€§ name\n    // å±æ€§éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå±æ€§å å’Œ å€¼ï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨è‹±æ–‡ : åˆ†éš”\n    let person = {\n      name: 'å°æ˜', // æè¿°äººçš„å§“å\n      age: 18, // æè¿°äººçš„å¹´é¾„\n      stature: 185, // æè¿°äººçš„èº«é«˜\n      gender: 'ç”·', // æè¿°äººçš„æ€§åˆ«\n    };\n    \n    // è®¿é—®äººçš„åå­—\n    console.log(person.name) // ç»“æœä¸º å°æ˜\n    // è®¿é—®äººæ€§åˆ«\n    console.log(person.gender) // ç»“æœä¸º ç”·\n    // è®¿é—®äººçš„èº«é«˜\n    console.log(person['stature'] // ç»“æœä¸º 185\n   // æˆ–è€…\n    console.log(person.stature) // ç»“æœåŒä¸º 185\n  </script>\n</body>\n</html>\n```\n\næ‰©å±•ï¼šä¹Ÿå¯ä»¥åŠ¨æ€ä¸ºå¯¹è±¡æ·»åŠ å±æ€§ï¼ŒåŠ¨æ€æ·»åŠ ä¸ç›´æ¥å®šä¹‰æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¯­æ³•ä¸Šæ›´çµæ´»ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¯¹è±¡è¯­æ³•</title>\n</head>\n<body>\n\n  <script>\n    // å£°æ˜ä¸€ä¸ªç©ºçš„å¯¹è±¡ï¼ˆæ²¡æœ‰ä»»ä½•å±æ€§ï¼‰\n\tlet user = {}\n    // åŠ¨æ€è¿½åŠ å±æ€§\n    user.name = 'å°æ˜'\n    user['age'] = 18\n    \n    // åŠ¨æ€æ·»åŠ ä¸ç›´æ¥å®šä¹‰æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¯­æ³•ä¸Šæ›´çµæ´»\n  </script>\n</body>\n</html>\n```\n\n### æ–¹æ³•å’Œè°ƒç”¨\n\næ•°æ®è¡Œä¸ºæ€§çš„ä¿¡æ¯ç§°ä¸ºæ–¹æ³•ï¼Œå¦‚è·‘æ­¥ã€å”±æ­Œç­‰ï¼Œä¸€èˆ¬æ˜¯åŠ¨è¯æ€§çš„ï¼Œå…¶æœ¬è´¨æ˜¯å‡½æ•°ã€‚\n\n1. æ–¹æ³•æ˜¯ç”±æ–¹æ³•åå’Œå‡½æ•°ä¸¤éƒ¨åˆ†æ„æˆï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨ : åˆ†éš”\n2. å¤šä¸ªå±æ€§ä¹‹é—´ä½¿ç”¨è‹±æ–‡ `,` åˆ†éš”\n3. æ–¹æ³•æ˜¯ä¾é™„åœ¨å¯¹è±¡ä¸­çš„å‡½æ•°\n4. æ–¹æ³•åå¯ä»¥ä½¿ç”¨ `\"\"` æˆ– `''`ï¼Œä¸€èˆ¬æƒ…å†µä¸‹çœç•¥ï¼Œé™¤éåç§°é‡åˆ°ç‰¹æ®Šç¬¦å·å¦‚ç©ºæ ¼ã€ä¸­æ¨ªçº¿ç­‰\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¯¹è±¡æ–¹æ³•</title>\n</head>\n<body>\n\n  <script>\n    // æ–¹æ³•æ˜¯ä¾é™„åœ¨å¯¹è±¡ä¸Šçš„å‡½æ•°\n    let person = {\n      name: 'å°çº¢',\n      age: 18,\n      // æ–¹æ³•æ˜¯ç”±æ–¹æ³•åå’Œå‡½æ•°ä¸¤éƒ¨åˆ†æ„æˆï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨ : åˆ†éš”\n      singing: function () {\n        console.log('ä¸¤åªè€è™ï¼Œä¸¤åªè€è™ï¼Œè·‘çš„å¿«ï¼Œè·‘çš„å¿«...')\n      },\n      run: function () {\n        console.log('æˆ‘è·‘çš„éå¸¸å¿«...')\n      }\n    }\n  </script>\n</body>\n</html>\n```\n\nå£°æ˜å¯¹è±¡ï¼Œå¹¶æ·»åŠ äº†è‹¥å¹²æ–¹æ³•åï¼Œå¯ä»¥ä½¿ç”¨ `.` æˆ– `[]` è°ƒç”¨å¯¹è±¡ä¸­å‡½æ•°ï¼Œæˆ‘ç§°ä¹‹ä¸ºæ–¹æ³•è°ƒç”¨ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¯¹è±¡æ–¹æ³•</title>\n</head>\n<body>\n\n  <script>\n    // æ–¹æ³•æ˜¯ä¾é™„åœ¨å¯¹è±¡ä¸Šçš„å‡½æ•°\n    let person = {\n      name: 'å°çº¢',\n      age: 18,\n      // æ–¹æ³•æ˜¯ç”±æ–¹æ³•åå’Œå‡½æ•°ä¸¤éƒ¨åˆ†æ„æˆï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨ : åˆ†éš”\n      singing: function () {\n        console.log('ä¸¤åªè€è™ï¼Œä¸¤åªè€è™ï¼Œè·‘çš„å¿«ï¼Œè·‘çš„å¿«...')\n      },\n      run: function () {\n        console.log('æˆ‘è·‘çš„éå¸¸å¿«...')\n      }\n    }\n    \n    // è°ƒç”¨å¯¹è±¡ä¸­ singing æ–¹æ³•\n    person.singing()\n    // è°ƒç”¨å¯¹è±¡ä¸­çš„ run æ–¹æ³•\n    person.run()\n\n  </script>\n</body>\n</html>\n```\n\næ‰©å±•ï¼šä¹Ÿå¯ä»¥åŠ¨æ€ä¸ºå¯¹è±¡æ·»åŠ æ–¹æ³•ï¼ŒåŠ¨æ€æ·»åŠ ä¸ç›´æ¥å®šä¹‰æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¯­æ³•ä¸Šæ›´çµæ´»ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>JavaScript åŸºç¡€ - å¯¹è±¡æ–¹æ³•</title>\n</head>\n<body>\n\n  <script>\n    // å£°æ˜ä¸€ä¸ªç©ºçš„å¯¹è±¡ï¼ˆæ²¡æœ‰ä»»ä½•å±æ€§ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼‰\n\tlet user = {}\n    // åŠ¨æ€è¿½åŠ å±æ€§\n    user.name = 'å°æ˜'\n    user.['age'] = 18\n    \n    // åŠ¨æ€æ·»åŠ æ–¹æ³•\n    user.move = function () {\n      console.log('ç§»åŠ¨ä¸€ç‚¹è·ç¦»...')\n    }\n    \n  </script>\n</body>\n</html>\n```\n\n**æ³¨ï¼šæ— è®ºæ˜¯å±æ€§æˆ–æ˜¯æ–¹æ³•ï¼ŒåŒä¸€ä¸ªå¯¹è±¡ä¸­å‡ºç°åç§°ä¸€æ ·çš„ï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„ã€‚**\n\n### null\n\nnull ä¹Ÿæ˜¯ JavaScript ä¸­æ•°æ®ç±»å‹çš„ä¸€ç§ï¼Œé€šå¸¸åªç”¨å®ƒæ¥è¡¨ç¤ºä¸å­˜åœ¨çš„å¯¹è±¡ã€‚ä½¿ç”¨ typeof æ£€æµ‹ç±»å‹å®ƒçš„ç±»å‹æ—¶ï¼Œç»“æœä¸º `object`ã€‚\n\n#### éå†å¯¹è±¡\n\n~~~javascript\nlet obj = {\n      uname: 'pink',\n      age: 18,\n      sex: 'ç”·'\n    }\n    console.log(obj['uname'];//è¾“å‡ºæŸä¸ªå±æ€§åçš„å€¼\n    \n    for(let i in obj) {\n      // i å±æ€§å  å­—ç¬¦ä¸²  å¸¦å¼•å·    obj.'uname'     i ===  'uname'\n      // obj[k]  å±æ€§å€¼    obj['uname']   obj[i]\n      console.log(i)  //è¾“å‡ºæ‰€æœ‰å±æ€§å\n    }\n    for(let i in obj) {\n      // i å±æ€§å  å­—ç¬¦ä¸²  å¸¦å¼•å·    obj.'uname'     i ===  'uname'\n      // obj[i]  å±æ€§å€¼    obj['uname']   obj[i]\n      console.log(obj[i]  //è¾“å‡ºæ‰€æœ‰å±æ€§çš„å€¼\n    }\n~~~\n\nfor in ä¸æå€¡éå†æ•°ç»„ å› ä¸º k æ˜¯ å­—ç¬¦ä¸²  \n\n![image-20241110152447210](../img/JavaScript%E5%9F%BA%E7%A1%80/image-20241110152447210.png)\n\n### æ¡ˆä¾‹\n\n```html\n<script>\n    let student = [\n      { name: 'å°ç±³', age: 18, sex: 'ç”·', homedown: 'æ²³å—' },\n      { name: 'å°ç¾', age: 12, sex: 'å¥³', homedown: 'åŒ—äº¬' },\n      { name: 'å°ä¸‰', age: 13, sex: 'ç”·', homedown: 'æ¹–åŒ—' },\n      { name: 'å°å››', age: 15, sex: 'å¥³', homedown: 'å¹¿ä¸œ' }\n    ]\n    for (let i = 0; i <= student.length; i++) {\n        // console.log(i) //ä¸‹æ ‡ç´¢å¼•å·\n        // console.log(student[i] //æ•°ç»„å…ƒç´ =æ¯ä¸ªå¯¹è±¡\n        console.log(student[i].name) //è¾“å‡ºæ¯ä¸ªå¯¹è±¡çš„åå­—\n        //console.log(student[i].age) //è¾“å‡ºæ¯ä¸ªå¯¹è±¡çš„å¹´é¾„\n      }\n  </script>\n```\n\n![image-20241110151302747](../img/JavaScript%E5%9F%BA%E7%A1%80/583a7fa87f4f161fbd9359148f429d5d697559838.png)\n\n## å†…ç½®å¯¹è±¡\n\nå›æƒ³ä¸€ä¸‹æˆ‘ä»¬æ›¾ç»ä½¿ç”¨è¿‡çš„ `console.log`ï¼Œ`console`å…¶å®å°±æ˜¯ JavaScript ä¸­å†…ç½®çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­å­˜åœ¨ä¸€ä¸ªæ–¹æ³•å« `log`ï¼Œç„¶åè°ƒç”¨ `log` è¿™ä¸ªæ–¹æ³•ï¼Œå³ `console.log()`ã€‚\n\né™¤äº† `console` å¯¹è±¡å¤–ï¼ŒJavaScritp è¿˜æœ‰å…¶å®ƒçš„å†…ç½®çš„å¯¹è±¡\n\n### Math\n\n`Math` æ˜¯ JavaScript ä¸­å†…ç½®çš„å¯¹è±¡ï¼Œç§°ä¸ºæ•°å­¦å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸‹å³åŒ…å«äº†å±æ€§ï¼Œä¹ŸåŒ…å«äº†è®¸å¤šçš„æ–¹æ³•ã€‚\n\n#### å±æ€§\n\n- Math.PIï¼Œè·å–åœ†å‘¨ç‡\n\n```javascript\n// åœ†å‘¨ç‡\nconsole.log(Math.PI);\n```\n\n#### æ–¹æ³•\n\n- Math.randomï¼Œç”Ÿæˆ 0 åˆ° 1 é—´çš„éšæœºæ•°\n\n```javascript\n// 0 ~ 1 ä¹‹é—´çš„éšæœºæ•°, åŒ…å« 0 ä¸åŒ…å« 1\nMath.random()\n```\n\n- Math.ceilï¼Œæ•°å­—å‘ä¸Šå–æ•´\n\n```javascript\n// èˆå¼ƒå°æ•°éƒ¨åˆ†ï¼Œæ•´æ•°éƒ¨åˆ†åŠ 1\nMath.ceil(3.4)\n```\n\n- Math.floorï¼Œæ•°å­—å‘ä¸‹å–æ•´\n\n```javascript\n// èˆå¼ƒå°æ•°éƒ¨åˆ†ï¼Œæ•´æ•°éƒ¨åˆ†ä¸å˜\nMath.floor(4.68)\n```\n\n- Math.roundï¼Œå››èˆäº”å…¥å–æ•´\n\n```javascript\n// å–æ•´ï¼Œå››èˆäº”å…¥åŸåˆ™\nMath.round(5.46539)\nMath.round(4.849)\n```\n\n- Math.maxï¼Œåœ¨ä¸€ç»„æ•°ä¸­æ‰¾å‡ºæœ€å¤§çš„\n\n```javascript\n// æ‰¾å‡ºæœ€å¤§å€¼\nMath.max(10, 21, 7, 24, 13)\n```\n\n- Math.minï¼Œåœ¨ä¸€ç»„æ•°ä¸­æ‰¾å‡ºæœ€å°çš„\n\n```javascript\n// æ‰¾å‡ºæœ€å°å€¼\nMath.min(24, 18, 6, 19, 21)\n```\n\n- Math.powï¼Œå¹‚æ–¹æ³•\n\n```javascript\n// æ±‚æŸä¸ªæ•°çš„å¤šå°‘æ¬¡æ–¹\nMath.pow(4, 2) // æ±‚ 4 çš„ 2 æ¬¡æ–¹\nMath.pow(2, 3) // æ±‚ 2 çš„ 3 æ¬¡æ–¹\n```\n\n- Math.sqrtï¼Œå¹³æ–¹æ ¹\n\n```javascript\n// æ±‚æŸæ•°çš„å¹³æ–¹æ ¹\nMath.sqrt(16)\n```\n\næ•°å­¦å¯¹è±¡æä¾›äº†æ¯”è¾ƒå¤šçš„æ–¹æ³•ï¼Œè¿™é‡Œä¸è¦æ±‚å¼ºè®°ï¼Œé€šè¿‡æ¼”ç¤ºæ•°å­¦å¯¹è±¡çš„ä½¿ç”¨ï¼ŒåŠ æ·±å¯¹å¯¹è±¡çš„ç†è§£ã€‚\n\n","tags":["JavaScript"],"categories":["ç¼–ç¨‹"]},{"title":"OpenEuleréƒ¨ç½²K8s-1.31.1","url":"/posts/50cdf140/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# OpenEuleréƒ¨ç½²K8s-1.31.1\n\n## ä¸»æœºæ‹“æ‰‘å›¾\n\n| ä¸»æœºå | ip             | å†…å­˜ | ç¡¬ç›˜ | cpu  | OS                      |\n| ------ | -------------- | ---- | ---- | ---- | ----------------------- |\n| master | 192.168.48.101 | 5G   | 100G | 2    | openEuler-22.03-LTS-SP4 |\n| node01 | 192.168.48.102 | 5G   | 100G | 2    | openEuler-22.03-LTS-SP4 |\n| node02 | 192.168.48.103 | 5G   | 100G | 2    | openEuler-22.03-LTS-SP4 |\n\né•œåƒä¸‹è½½åœ°å€ï¼š[OpenEuler-22.03-LTS](https://mirrors.nju.edu.cn/openeuler/openEuler-22.03-LTS-SP4/ISO/x86_64/)\n\nä¸‹è½½åä¸ºopenEuler-22.03-LTS-SP4-x86_64-dvd.iso\n\n## åŸºæœ¬é…ç½®\n\næ³¨æ„ä¸€ä¸‹ä½ çš„ç½‘å¡å«ä»€ä¹ˆï¼Œæˆ‘çš„æ˜¯ens33ï¼Œå¦‚æœä½ æ˜¯å…¶ä»–çš„è®°å¾—æ›¿æ¢ï¼Œä¸è¦æ— è„‘çš„å¤åˆ¶ç²˜è´´ï¼Œçœ‹çœ‹è„šæœ¬é‚£äº›éœ€è¦æ”¹çš„ï¼Œç›®æµ‹éœ€è¦æ”¹çš„æ˜¯ipè¿™äº›ï¼Œè¿˜æœ‰ç¬¬ä¸‰æ­¥å’Œç¬¬å…­æ­¥\n\n### åŸºæœ¬é…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰èŠ‚ç‚¹]\n\n```\nvi k8s_system_init.sh\n```\n\n```\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\necho \"2.æ­£åœ¨å…³é—­firewalldã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl stop firewalld\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nNAME=ens33\nUUID=53b402ff-5865-47dd-a853-7afcd6521738\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS1=192.168.48.2\nDNS2=114.114.114.114\nEOF\nnmcli c reload\nnmcli c up ens33\n\n\necho \"4.æ–°å¢åä¸ºäº‘æºã€k8sæº\"\nmkdir /etc/yum.repos.d/bak/\ncp /etc/yum.repos.d/* /etc/yum.repos.d/bak/\nsleep 3\ncat <<EOF | tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.31/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.31/rpm/repodata/repomd.xml.key\nEOF\n#åˆ‡æ¢ä¸ºåä¸ºäº‘ï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿«\nsed -i 's/\\$basearch/x86_64/g' /etc/yum.repos.d/openEuler.repo\nsed -i 's/http\\:\\/\\/repo.openeuler.org/https\\:\\/\\/mirrors.huaweicloud.com\\/openeuler/g' /etc/yum.repos.d/openEuler.repo\n\necho \"5.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\n yum clean all && yum makecache\n\necho \"6.æ·»åŠ hostsè§£æ\"\ncat > /etc/hosts <<EOF\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.101 master\n192.168.48.102 node01\n192.168.48.103 node02\nEOF\n\n\necho \"7.å…³é—­swapåˆ†åŒº\"\nswapoff -a && sysctl -w vm.swappiness=0 &> /dev/null\nsed -ri '/^[^#]*swap/s@^@#@' /etc/fstab\n\n\necho \"8.å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\"\nyum install chrony -y\nsystemctl enable chronyd --now\ntimedatectl set-timezone Asia/Shanghai\ntimedatectl set-local-rtc 1\ntimedatectl set-ntp yes\nchronyc -a makestep\nchronyc tracking\nchronyc sources\n\n\necho \"9.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet socat device-mapper-persistent-data lvm2 git -y\n\necho \"10.é‡å¯\"\nreboot\n\n```\n\nè¿è¡Œè„šæœ¬\n\n```\nsh k8s_system_init.sh ä¸»æœºå  ä¸»æœºä½\n\n[master] sh k8s_system_init.sh master 101\n\n[node01] sh k8s_system_init.sh node01 102\n\n[node02] sh k8s_system_init.sh node02 103\n```\n\n### é…ç½®sshå…å¯†\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\næ³¨æ„ä¿®æ”¹ä½ çš„ä¸»æœºå¯†ç å’Œä¸»æœºåˆ—è¡¨çš„ä¸»æœºå\n\n```\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"master\" \"node01\" \"node02\")\n# å¯†ç \npassword=\"Lj201840.\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n### é…ç½®å†…æ ¸è·¯ç”±è½¬å‘åŠç½‘æ¡¥è¿‡æ»¤ä»¥åŠå®‰è£…ipsetåŠipvsadm\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\n```\nsed -i 's/net.ipv4.ip_forward=0/net.ipv4.ip_forward=1/g' /etc/sysctl.conf\ncat > /etc/sysctl.d/k8s.conf << EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nvm.swappiness = 0\nEOF\n# é…ç½®åŠ è½½br_netfilteræ¨¡å—\ncat <<EOF | sudo tee /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\n#åŠ è½½br_netfilter overlayæ¨¡å—\nmodprobe br_netfilter\nmodprobe overlay\nsysctl --system\nsysctl -p \n# ä½¿ç”¨æ–°æ·»åŠ é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ\nsysctl -p /etc/sysctl.d/k8s.conf  \nyum -y install ipset ipvsadm\ncat > /etc/sysconfig/modules/ipvs.module <<EOF\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack\nEOF\n#æˆæƒã€è¿è¡Œã€æ£€æŸ¥æ˜¯å¦åŠ è½½\nchmod 755 /etc/sysconfig/modules/ipvs.module &&  /etc/sysconfig/modules/ipvs.module\næŸ¥çœ‹å¯¹åº”çš„æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ\nlsmod | grep -e ip_vs -e nf_conntrack_ipv4\n```\n\n## containerdå®¹å™¨ç¯å¢ƒå®‰è£…\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰èŠ‚ç‚¹]\n\n```bash\n#ä¸‹è½½æ‰€éœ€è½¯ä»¶åŒ…\nwget https://github.com/containerd/containerd/releases/download/v1.7.22/containerd-1.7.22-linux-amd64.tar.gz\nwget https://github.com/opencontainers/runc/releases/download/v1.1.15/runc.amd64\nwget https://github.com/containernetworking/plugins/releases/download/v1.5.1/cni-plugins-linux-amd64-v1.5.1.tgz\n\n#å®‰è£…containerd\ntar Cxzvf /usr/local containerd-1.7.22-linux-amd64.tar.gz\n# åˆ›å»ºæœåŠ¡ï¼Œæ‰€æœ‰ä¸»æœºéƒ½è¦æ“ä½œ\ncat << EOF > /usr/lib/systemd/system/containerd.service\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/containerd\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\n\n# Comment TasksMax if your systemd version does not supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl daemon-reload && systemctl enable --now containerd\n\n#å®‰è£…runc\ninstall -m 755 runc.amd64 /usr/local/sbin/runc\n#å®‰è£…cni\nmkdir -p /opt/cni/bin && tar -xzf cni-plugins-linux-amd64-v1.5.1.tgz -C /opt/cni/bin/\n\n#ç”Ÿæˆå®¹å™¨é…ç½®æ–‡ä»¶\nmkdir -p /etc/containerd && containerd config default > /etc/containerd/config.toml\nsed -i 's#sandbox_image = \"registry.k8s.io/pause:.*\"#sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.10\"#' /etc/containerd/config.toml\nsed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\n\ncat >/etc/crictl.yaml <<\"EOF\"\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n\n#é…ç½®containerdé•œåƒåŠ é€Ÿ\n# ä¿®æ”¹ /etc/containerd/config.toml ä¸­çš„ config_path\nsed -i 's|^  config_path =.*$|  config_path = \"/etc/containerd/certs.d\"|' /etc/containerd/config.toml\n\n# åˆ›å»ºå¿…è¦çš„ç›®å½•\nmkdir -p /etc/containerd/certs.d/docker.io\nmkdir -p /etc/containerd/certs.d/registry.k8s.io\n\n# é…ç½® docker.io çš„ hosts.toml\ncat <<EOF > /etc/containerd/certs.d/docker.io/hosts.toml\nserver = \"https://docker.io\"\n[host.\"https://docker.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\"]\n[host.\"https://reg-mirror.giniu.com\"]\n  capabilities = [\"pull\", \"resolve\"]\nEOF\n\n# é…ç½® registry.k8s.io çš„ hosts.toml\ncat <<EOF > /etc/containerd/certs.d/registry.k8s.io/hosts.toml\nserver = \"https://registry.k8s.io\"\n[host.\"https://k8s.m.daocloud.io\"]\n  capabilities = [\"pull\", \"resolve\", \"push\"]\nEOF\n\n# é‡å¯ containerd æœåŠ¡\nsystemctl daemon-reload\nsystemctl restart containerd.service\n\n```\n\n## å®‰è£…K8s1.31.1\n\næ“ä½œèŠ‚ç‚¹:[æ‰€æœ‰èŠ‚ç‚¹]\n\nä¸å‡ºæ„å¤–ç¬¬ä¸€æ­¥å®‰è£…çš„å°±æ˜¯1.31.1çš„ç‰ˆæœ¬\n\n```bash\nyum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\n#  é…ç½®kubeletä¸ºäº†å®ç°dockerä½¿ç”¨çš„cgroupdriverä¸kubeletä½¿ç”¨çš„cgroupçš„ä¸€è‡´æ€§ï¼Œå»ºè®®ä¿®æ”¹å¦‚ä¸‹æ–‡ä»¶å†…å®¹ã€‚æ‰€æœ‰èŠ‚ç‚¹å‡è¦å®‰è£…\nsed -i 's/^KUBELET_EXTRA_ARGS=/KUBELET_EXTRA_ARGS=\"--cgroup-driver=systemd\"/g' /etc/sysconfig/kubelet\n\n#è®¾ç½®kubeletä¸ºå¼€æœºè‡ªå¯åŠ¨å³å¯ï¼Œç”±äºæ²¡æœ‰ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé›†ç¾¤åˆå§‹åŒ–åè‡ªåŠ¨å¯åŠ¨\nsystemctl enable kubelet --now\n```\n\nå¼€å§‹å®‰è£…K8s\n\næ“ä½œèŠ‚ç‚¹:[master]\n\n```bash\nkubeadm config print init-defaults > /etc/kubernetes/init-default.yaml\n\n# ä¿®æ”¹ä¸ºå›½å†…é˜¿é‡Œæº\nsed -i 's/registry.k8s.io/registry.aliyuncs.com\\/google_containers/' /etc/kubernetes/init-default.yaml\n \n# è®¾ç½® apiServerIP åœ°å€. è¯·è‡ªè¡Œæ›¿æ¢192.168.48.101ä¸ºè‡ªå·±masterçš„IP\nsed -i 's/1.2.3.4/192.168.48.101/' /etc/kubernetes/init-default.yaml\n\nsed -i '/serviceSubnet: 10.96.0.0\\/12/a \\  podSubnet: 192.168.0.0/16' /etc/kubernetes/init-default.yaml\n\nsed -i 's/1.31.0/1.31.1/g' /etc/kubernetes/init-default.yaml\n#æ‹‰å–æ‰€éœ€é•œåƒ\nkubeadm config images pull --config /etc/kubernetes/init-default.yaml\n\nkubeadm init --image-repository registry.aliyuncs.com/google_containers --upload-certs\n```\n\nå¦‚æœè¦é‡ç½®é›†ç¾¤ï¼Œæˆ–è€…æŠ¥é”™åˆ™è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŠ¥é”™äº†å°±æ‰¾åŸå› çœ‹çœ‹å“ªé‡Œå‡ºé”™äº†\n\n```bash\nkubeadm reset\n[reset] Are you sure you want to proceed? [y/N]: y\n#è¾“å…¥Y\n\nsudo rm -rf /etc/kubernetes/manifests/*\nsudo iptables -F && sudo ipvsadm --clear\n```\n\nåˆå§‹åŒ–åè¿è¡Œä»¥ä¸‹å‘½ä»¤\n\n```bash\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n## åŠ å…¥nodeèŠ‚ç‚¹\n\n```\nkubeadm token create --print-join-command\n```\n\nç”Ÿæˆä»¥ä¸‹ä¿¡æ¯\n\n```\nkubeadm join 192.168.48.101:6443 --token mxybd6.j56dbce9cy698ejr --discovery-token-ca-cert-hash sha256:c1b1c7248f6aeea4d01244a226489958bfaaaa76926077b5c09b143c760b68e9\n```\n\nå°†è¿™ä¸ªå‘½ä»¤å¤åˆ¶ç»™node01å’Œnode02è¿è¡Œå°±å¯ä»¥åŠ å…¥é›†ç¾¤äº†\n\n## å®‰è£…ç½‘ç»œæ’ä»¶\n\n```bash\necho '185.199.108.133 raw.githubusercontent.com' >> /etc/hosts\ncurl https://raw.githubusercontent.com/projectcalico/calico/v3.25.1/manifests/calico.yaml -O\nsed -i '/- name: WAIT_FOR_DATASTORE/i \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ - name: IP_AUTODETECTION_METHOD\\n              value: interface=ens33' calico.yaml\nsed -i 's| docker.io/calico/| registry.cn-hangzhou.aliyuncs.com/qianyios/|' calico.yaml\nkubectl apply -f calico.yaml\n```\n\nç­‰å¾…åå‡ åˆ†é’Ÿè¿™æ ·å­ï¼Œå°±å‡ºç°ä»¥ä¸‹å…¨éƒ¨readyå’Œrunningå°±è¯´æ˜K8sé›†ç¾¤éƒ¨ç½²æˆåŠŸ\n\n```\nkubectl get pods -A\n```\n\n![image-20241008204558946](../img/OpenEuler%E9%83%A8%E7%BD%B2K8s-1.31.1/bb20dc5992b31b8ce4352cda63a47d3e697559838-1728392228410-5-1758977358885-2.png)\n\n## K8S-dashboard\n\n### é…ç½®yaml\n\n```\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml\nsed -i 's/kubernetesui\\/dashboard:v2.7.0/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/dashboard:v2.7.0/g' recommended.yaml\nsed -i 's/kubernetesui\\/metrics-scraper:v1.0.8/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/metrics-scraper:v1.0.8/g' recommended.yaml\n```\n\nä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```\nvim recommended.yaml\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30001\n  type: NodePort\n  selector:\n    app: kubernetes-dashboard\n\n---\n```\n\nè¿è¡Œ\n\n```\nkubectl apply -f recommended.yaml\n```\n\n### åˆ›å»ºcluster-adminç”¨æˆ·\n\n```\n#åˆ›å»ºservice accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜ç¾¤è§’è‰²\n#åˆ›å»ºç”¨æˆ·\nkubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n#ç”¨æˆ·æˆæƒ\nkubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n#è·å–ç”¨æˆ·Token\nkubectl create token dashboard-admin -n kubernetes-dashboard\n```\n\nè®°å½•token\n\n```\neyJhbGciOiJSUzI1NiIsImtpZCI6IjhsSUtJbk93YU5xR1V2ZndOS0lFMnpVLVR1cEl1YUF5U0JBd2NRUXFHVE0ifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzI4Mzk1MzcxLCJpYXQiOjE3MjgzOTE3NzEsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiYjA5NjA2OTEtNTVkNy00YzhmLTliZGItZDRkNzljYTU0YTJiIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIwYzU0YWE0OC0zYTFkLTQyNmYtODI5ZS01ODVjZWNjMzEyYjAifX0sIm5iZiI6MTcyODM5MTc3MSwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.dYb1MRmrKqNSTs2SKGsXZT_Nq4xtt3JeQEXOaHIjvFNtn_iCk1qTuY6oUBE8xdRv4S1oyqb52udGj0Zb5gYpMEBIfpQxTL_KJkeR-1S-tyl2U1FsH6UCnPE_j7KWh5suU3YJncIhQ26Ei7hC12WuZ9l-_UD3mL2tEPzwjbhnT0qir2Qe4rqrSJNNSQHrtwNVD2O-zv13VaUx6azXArec2GPDYR5ZYbSqMXuklaelwtZoKPLzP0DFnZy4jJ4n1JM7PRzqS5sWT_2nMgpSFZ_a5E0b7knvcNvyQHgHzeIYTrY88wjaCQi3x3cIn2hUvtVsroZySjx3Mz-ZECco5WN-eQ\n```\n\næµè§ˆå™¨è®¿é—®å³å¯å¹¶è¾“å…¥ä»¥ä¸Štoken\n\n```\nhttps://192.168.48.101:30001/\n```\n\n![image-20241008205011179](../img/OpenEuler%E9%83%A8%E7%BD%B2K8s-1.31.1/2f4d9987d1d4fd3c05638ef58883a199697559838-1728392228410-6-1758977358885-3.png)\n\n## ä¿®æ”¹modeæ”¯æŒipvs\n\nä¿®æ”¹å™¨è¯·ç¡®è®¤ä½ çš„æœºå­æ˜¯å¦æ”¯æŒipvsï¼Œæˆ‘å·²ç»åœ¨`2.2 ç³»ç»Ÿåˆå§‹åŒ–`çš„è„šæœ¬é‡Œè®¾ç½®äº†ipvsåŠŸèƒ½ï¼Œä½ è¦æ˜¯æ²¡ç”¨æˆ‘çš„ï¼Œä½ å¯ä»¥è‡ªè¡Œçœ‹çœ‹è„šæœ¬ï¼Œæˆ–è€…è‡ªè¡Œé…ç½®\n\n```bash\nroot@master1:~# kubectl get configmap kube-proxy -n kube-system -o yaml | grep mode\n    mode: \"\" #å¯èƒ½ä¸ºç©ºï¼Œä¹Ÿå¯èƒ½æ˜¯iptables\n```\n\né‚£è¿™æ ·ä»–æ˜¯ä¸æ”¯æŒipvsè¦è¿›è¡Œä¿®æ”¹\n\n```bash\nkubectl edit configmap kube-proxy -n kube-system\n```\n\nç„¶åä¿®æ”¹ä¸º`mode: \"ipvs\"`\n\n![image-20250927203606943](../img/OpenEuler%E9%83%A8%E7%BD%B2K8s-1.31.1/fe6af7c42906d9732fd1de7540d3fb8b697559838.png)\n\né‡å¯kube-proxy Pods\n\n```bash\nkubectl delete pod -n kube-system -l k8s-app=kube-proxy\n```\n\næ£€æŸ¥æ˜¯å¦å¯ç”¨\n\n```bash\n#ç„¶åä½ å°±ä¼šçœ‹è§ä¸€å¤§å †çš„è§„åˆ™ï¼Œé‚£ä»–è¡¨ç¤º IPVS å·²å¯ç”¨ã€‚\nroot@master1:~# ipvsadm -L -n\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  172.17.0.1:30001 rr\n  -> 10.244.196.158:8443          Masq    1      0          0\nTCP  172.17.0.1:30080 rr\n  -> 10.244.196.159:80            Masq    1      0          0\n  -> 10.244.196.160:80            Masq    1      0          0\nTCP  192.168.48.128:30001 rr\n  -> 10.244.196.158:8443          Masq    1      0          0\nTCP  192.168.48.128:30080 rr\n  -> 10.244.196.159:80            Masq    1      0          0\n  -> 10.244.196.160:80            Masq    1      0          0\nTCP  10.96.0.1:443 rr\n  -> 192.168.48.128:6443          Masq    1      8          0\nTCP  10.96.0.10:53 rr\n  -> 10.244.137.89:53             Masq    1      0          0\n  -> 10.244.137.90:53             Masq    1      0          0\nTCP  10.96.0.10:9153 rr\n......\n```\n\n\n\nè‡³æ­¤K8s-1.31.1éƒ¨ç½²å®Œæˆ\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["OpenEuler","K8s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"Linuxå®‰è£…Mysql8.4.2 LTS","url":"/posts/32ce47c9/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Linuxå®‰è£…Mysql8.4.2 LTS\n\n## ä¸‹è½½å®‰è£…åŒ…\n\nä¸‹è½½åœ°å€ï¼š[MySQL](https://dev.mysql.com/downloads/mysql/)\n\næ ¹æ®è‡ªå·±çš„ç³»ç»Ÿé€‰æ‹©å“¦ï¼\n\næˆ‘çš„ç³»ç»Ÿæ˜¯OpenEuler22.03LTSå…¼å®¹çº¢å¸½å®‰è£…åŒ…\n\n![image-20240908141022472](../img/Linux%E5%AE%89Mysql8.4.2%20LTS%EF%BC%88%E4%BB%A5rpm%E5%8C%85%E5%AE%89%E8%A3%85%EF%BC%89.assets/b6bd0beb860af13cbd1155822d54b8c3697559838.png)\n\nä¸‹è½½ä¹‹åä¸Šä¼ åˆ°rootç›®å½•ä¸‹\n\n![image-20240908141150263](../img/Linux%E5%AE%89Mysql8.4.2%20LTS%EF%BC%88%E4%BB%A5rpm%E5%8C%85%E5%AE%89%E8%A3%85%EF%BC%89.assets/ca4177bf8ec777a34d4a62e04ce8b4af697559838.png)\n\nåˆ›å»ºå®‰è£…ç›®å½•å¹¶è§£å‹å®‰è£…åŒ…åˆ°æ­¤ç›®å½•ä¸‹\n\n```\nmkdir mysql8.4.2lts\ntar -xvf mysql-8.4.2-1.el8.x86_64.rpm-bundle.tar -C mysql8.4.2lts\ncd mysql8.4.2lts/\nls\n```\n\nå·²ç»è§£å‹å®Œæˆäº†å“¦\n\n![image-20240908141612404](../img/Linux%E5%AE%89Mysql8.4.2%20LTS%EF%BC%88%E4%BB%A5rpm%E5%8C%85%E5%AE%89%E8%A3%85%EF%BC%89.assets/d1f85f051509e83d816c26f2f6240b35697559838.png)\n\n## å¼€å§‹å®‰è£…\n\nåˆ é™¤æ—§ç‰ˆæœ¬çš„mysqlå’Œmariadb\n\n```\n# å¸è½½ mariadb ç›¸å…³çš„åŒ…\nyum remove mariadb mariadb-config mariadb-libs -y\n\n# å¦‚æœä¹‹å‰å®‰è£…è¿‡ MySQL ç¤¾åŒºç‰ˆï¼Œä¹Ÿéœ€è¦ä¸€å¹¶ç§»é™¤\nyum remove mysql-community-common mysql-community-icu-data-files mysql-community-client-plugins mysql-community-libs mysql-community-client mysql-community-server mysql-community-libs-compat -y\n```\n\næœ€å¥½æŒ‰ç…§ä»¥ä¸‹é¡ºåºæŒ‰ç…§ï¼Œä¸ç„¶ä¼šæŠ¥é”™\n\n```\n#å…¨å±€çš„ä¾èµ–ï¼ˆcommonï¼‰\nrpm -ivh mysql-community-common-8.4.2-1.el8.x86_64.rpm\nrpm -ivh mysql-community-icu-data-files-8.4.2-1.el8.x86_64.rpm\nrpm -ivh mysql-community-client-plugins-8.4.2-1.el8.x86_64.rpm\nrpm -ivh mysql-community-libs-8.4.2-1.el8.x86_64.rpm\nrpm -ivh mysql-community-client-8.4.2-1.el8.x86_64.rpm\nrpm -ivh mysql-community-server-8.4.2-1.el8.x86_64.rpm\n#phpä¾èµ–æ–‡ä»¶\nrpm -ivh mysql-community-libs-compat-8.4.2-1.el8.x86_64.rpm\n```\n\n<font color='red'>æ³¨æ„ï¼šå¦‚æœéœ€è¦æ­è½½phpä½¿ç”¨ï¼Œéœ€è¦å®‰è£…7.7ï¼Œå› ä¸ºrpm -ivh mysql-community-libs-compatæ˜¯phpçš„ä¾èµ–ã€‚ï¼›å¦‚æœä¸å®‰è£…phpï¼Œåˆ™æ— éœ€å®‰è£…7.7çš„ä¾èµ–ã€‚</font>\n\n## æ•°æ®åº“åŸºç¡€é…ç½®\n\n### å¯åŠ¨æ•°æ®åº“å¹¶ä¸”è®¾ç½®è‡ªå¯åŠ¨\n\n```\nsystemctl enable mysqld --now\n```\n\n### æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹\n\n```\nps -ef | grep mysql\n```\n\n![image-20240908144458980](../img/Linux%E5%AE%89Mysql8.4.2%20LTS%EF%BC%88%E4%BB%A5rpm%E5%8C%85%E5%AE%89%E8%A3%85%EF%BC%89.assets/6810095115b61df251616389ab64b3da697559838.png)\n\n### æŸ¥çœ‹åˆå§‹å¯†ç \n\n```\ngrep 'temporary password' /var/log/mysqld.log\n```\n\n```\n2024-09-08T06:44:47.204524Z 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: zo+&q(qYG21X\nå¯†ç æ˜¯zo+&q(qYG21X\n```\n\n### ä¿®æ”¹å¯†ç \n\n```\nmysql -uroot -p\"zo+&q(qYG21X\"\nalter user 'root'@'localhost' identified by 'Qianyios007@';\n```\n\nä»¥åä½ å°±å¯ä»¥ç”¨ä»¥ä¸‹ç›®å½•ç™»å…¥mysqläº†\n\n```\nmysql -uroot -p\"Qianyios007@\"\n```\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["OpenEuler","Mysql"],"categories":["è¿ç»´"]},{"title":"åŸºäºK8Sçš„CICDç³»ç»Ÿå®ç°","url":"/posts/40462/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# åŸºäºK8Sçš„CICDç³»ç»Ÿå®ç°\n\n## å‰æƒ…æè¦\n\nåœ¨æ­¤å£°æ˜ï¼Œè¿™ä¸ªé¡¹ç›®éœ€è¦æœ‰32G+ä»¥ä¸Šçš„è¿è¡Œå†…å­˜ï¼Œä¸ç„¶ç»§ç»­ä¸äº†ï¼Œ32Gè¿è¡Œå†…å­˜ç”µè„‘å‹‰å¼ºèƒ½ï¼ˆé˜‰å‰²ç‰ˆæµç•…ï¼‰è¿è¡Œï¼Œè€Œä¸”ä¹Ÿæ˜¯å…³äº†ä¸€å°harbor2æ‰èƒ½å‹‰å¼ºè¿è¡Œï¼Œå…³äº†æ²¡äº‹çš„ï¼Œå› ä¸ºharboræ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œæœ‰ä¸€å°harbor1å°±è¡Œäº†ã€‚\n\nCICDæµç¨‹æ¼”ç¤º\n\n<div style=\"text-align:center; margin: 20px 0;\">\n  <video id=\"myVideo\" width=\"800\" controls preload=\"metadata\" style=\"\n    border-radius: 12px;\n    box-shadow: 0 4px 16px rgba(0,0,0,0.25);\n    outline: none;\n    background-color: #000;\n    max-width: 100%;\n  \">\n    <source src=\"https://qianyios-img.oss-cn-guangzhou.aliyuncs.com/%E5%9F%BA%E4%BA%8EK8s%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84cicd%E5%B9%B3%E5%8F%B0-%E6%BC%94%E7%A4%BA%E8%A7%86%E9%A2%91.mp4\" type=\"video/mp4\">\n  </video>\n</div>\n<style>\n#myVideo::-webkit-media-controls-panel {\n  background-color: rgba(20, 20, 20, 0.7);\n  border-radius: 0 0 12px 12px;\n}\n#myVideo::-webkit-media-controls-play-button {\n  filter: invert(80%);\n}\n#myVideo::-webkit-media-controls-timeline {\n  height: 5px;\n  border-radius: 3px;\n}\n#myVideo::-webkit-media-controls-volume-slider {\n  filter: invert(80%);\n}\n</style>\n\n\n\n\nCICDé«˜å¯ç”¨æ¼”ç¤º\n\n<div style=\"text-align:center; margin: 20px 0;\">\n  <video id=\"myVideo\" width=\"800\" controls preload=\"metadata\" style=\"\n    border-radius: 12px;\n    box-shadow: 0 4px 16px rgba(0,0,0,0.25);\n    outline: none;\n    background-color: #000;\n    max-width: 100%;\n  \">\n    <source src=\"https://qianyios-img.oss-cn-guangzhou.aliyuncs.com/cicd%E9%A1%B9%E7%9B%AE%E9%AB%98%E5%8F%AF%E7%94%A8%E6%BC%94%E7%A4%BA.mp4\" type=\"video/mp4\">\n  </video>\n</div>\n<style>\n#myVideo::-webkit-media-controls-panel {\n  background-color: rgba(20, 20, 20, 0.7);\n  border-radius: 0 0 12px 12px;\n}\n#myVideo::-webkit-media-controls-play-button {\n  filter: invert(80%);\n}\n#myVideo::-webkit-media-controls-timeline {\n  height: 5px;\n  border-radius: 3px;\n}\n#myVideo::-webkit-media-controls-volume-slider {\n  filter: invert(80%);\n}\n</style>\n  \n\n## ç³»ç»Ÿæ‹“æ‰‘å›¾\n\nè¿è¡Œå†…å­˜ä¸¥æ ¼æŒ‰ç…§æˆ‘çš„ä»¥ä¸‹çš„å†…å­˜è§„æ ¼æ¥å¡«å†™ï¼Œè¿™æ˜¯å‹‰å¼ºèƒ½è¿è¡Œçš„é…ç½®å‚æ•°ï¼Œå¦‚æœå†…å­˜å¤šçš„è¯è‡ªè¡ŒåŠ å¤šå³å¯\n\nK8Sé›†ç¾¤\n\n| ä¸»æœºå   | ip1ï¼ˆNATï¼‰     | ç³»ç»Ÿ                | ç£ç›˜1 | ç£ç›˜2 | å†…å­˜ | cpu  |\n| -------- | -------------- | ------------------- | ----- | ----- | ---- | ---- |\n| master1  | 192.168.48.101 | OpenEuler-22.04-LTS | 100G  | 100G  | 6.2G | 2v2c |\n| master2  | 192.168.48.102 | OpenEuler-22.04-LTS | 100G  | 100G  | 6.2G | 2v2c |\n| master3  | 192.168.48.103 | OpenEuler-22.04-LTS | 100G  | 100G  | 6.2G | 2v2c |\n| node01   | 192.168.48.104 | OpenEuler-22.04-LTS | 100G  |       | 9.9G | 2v2c |\n| é«˜å¯ç”¨ip | 192.168.48.200 |                     |       |       |      |      |\n\nharboré›†ç¾¤\n\n| è§’è‰²                                | ä¸»æœºå         | ip             | ç³»ç»Ÿ                | èµ„æºæœ€ä½è¦æ±‚                            |\n| ----------------------------------- | -------------- | -------------- | ------------------- | --------------------------------------- |\n| Harbor1<br />nginx<br />Keepalived1 | harbor1        | 192.168.48.106 | OpenEuler-22.04-LTS | CPUï¼š1æ ¸ <br />å†…å­˜ï¼š1G <br />ç¡¬ç›˜ï¼š40G |\n| Harbor2<br />nginx<br />Keepalived2 | harbor2        | 192.168.48.107 | OpenEuler-22.04-LTS | CPUï¼š1æ ¸ <br />å†…å­˜ï¼š1G <br />ç¡¬ç›˜ï¼š40G |\n| postgresql<br />Redis<br />NFSå…±äº«  | zujian         | 192.168.48.108 | OpenEuler-22.04-LTS | CPUï¼š1æ ¸ <br />å†…å­˜ï¼š1G <br />ç¡¬ç›˜ï¼š40G |\n| é«˜å¯ç”¨ip                            | 192.168.48.100 |                |                     |                                         |\n\nç³»ç»Ÿæ¶æ„å›¾\n\n![image-20241111220607255](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/image-20241111220607255-1731333971370-4.png)\n\nç³»ç»Ÿæµç¨‹å›¾\n\n![image-20241111215652395](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/image-20241111215652395-1731333422328-1.png)\n\n## éƒ¨ç½²K8Sé«˜å¯ç”¨é›†ç¾¤\n\n[OpenEuler-éƒ¨ç½²K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå†…éƒ¨etcdï¼‰ - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/62904/)\n\n## éƒ¨ç½²cephé›†ç¾¤\n\n> æ³¨æ„ï¼šåŸæ–‡ç« æ˜¯éƒ¨ç½²åœ¨master1ï¼Œnode01ï¼Œnode02ï¼Œç”±äºç¡¬ä»¶åŸå› ï¼Œç°åœ¨éœ€è¦éƒ¨ç½²åœ¨ä¸‰å°masterï¼Œæ‰€ä»¥åŸæ–‡ç« å¼€å¤´åŠ ç¡¬ç›˜ï¼Œä½ ä¹Ÿåªéœ€è¦åŠ åœ¨ä¸‰å°masterä¸Šï¼Œè¯·è‡ªå·±æ³¨æ„åœ¨2.1-2ä½ç½®ä¿®æ”¹é›†ç¾¤åç§°å’Œç¡¬ç›˜åç§°ã€‚åŒ…æ‹¬è¦ä¸‹è½½çš„é•œåƒï¼Œå°±åœ¨ä¸‰å°masterä¸‹è½½å°±è¡Œäº†ï¼Œæ¥ç€ä½ å°±å¯ä»¥ç»§ç»­åšäº†\n\n[åŸºäºK8S1.28.2å®éªŒrookéƒ¨ç½²ceph - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/58032/)\n\nä»¥ä¸‹è¿›è¡Œcephfså­˜å‚¨åšå­˜å‚¨å£°æ˜å³Storageclassï¼Œæ–¹ä¾¿åç»­jenkinså’Œgitlabè°ƒç”¨\n\n### åˆ›å»ºcephfsæ–‡ä»¶ç³»ç»Ÿ\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\ncd\ncd rook/deploy/examples\ncat >rook-cephfs.yaml << \"EOF\"\napiVersion: ceph.rook.io/v1\nkind: CephFilesystem\nmetadata:\n  name: rook-cephfs      #ä¿®æ”¹åå­—\n  namespace: rook-ceph \nspec:\n  metadataPool:\n    replicated:\n      size: 3\n      requireSafeReplicaSize: true # å‚æ•°æŒ‡ç¤ºæ˜¯å¦è¦æ±‚å‰¯æœ¬æ•°é‡å¿…é¡»æ˜¯å¶æ•°\n    parameters:\n      compression_mode:\n        none\n  dataPools:\n    - name: replicated\n      failureDomain: host\n      replicated:\n        size: 3\n        requireSafeReplicaSize: false\n      parameters:\n        compression_mode:\n          none\n  preserveFilesystemOnDelete: true #å½“åˆ é™¤CephFilesystemèµ„æºæ—¶ï¼Œæ˜¯å¦ä¿ç•™Cephé›†ç¾¤ä¸­çš„å®é™…æ–‡ä»¶ç³»ç»Ÿã€‚è‹¥è®¾ä¸ºtrueåˆ™ä¿ç•™ï¼Œæ–¹ä¾¿åç»­æ¢å¤ä½¿ç”¨ã€‚\n  metadataServer:\n    activeCount: 3\n    activeStandby: true\n    placement:\n      podAntiAffinity:\n        preferredDuringSchedulingIgnoredDuringExecution:\n          - weight: 100\n            podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                  - key: app\n                    operator: In\n                    values:\n                      - rook-ceph-mds\n              topologyKey: topology.kubernetes.io/zone\n    priorityClassName: system-cluster-critical\n    livenessProbe:\n      disabled: false\n    startupProbe:\n      disabled: false\nEOF\nkubectl apply -f rook-cephfs.yaml \nkubectl get pod -n rook-ceph | grep rook-cephfs\n```\n\nå¯èƒ½è¦ä¸€åˆ†é’Ÿæ‰ä¼šåˆ›å»ºå¥½\n\n`ä¸ºä»€ä¹ˆæˆ‘èƒ½ç›´æ¥åœ¨k8sç›´æ¥è¿è¡ŒcephæŒ‡ä»¤ï¼Œè€Œä¸è¿›å…¥podï¼Œè‡ªè¡Œå»ç¬¬äºŒæ­¥å¼€é€šçœ‹éƒ¨ç½²cephé›†ç¾¤çš„`\n\n![image-20240501205306444](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/2a1d57c846a6ca7b49a5d0527332f138697559838.png)\n\nå¿«æ·é“¾æ¥ï¼š[åœ¨K8Sä¸­ç›´æ¥è°ƒç”¨å‡ºcephå‘½ä»¤](https://blog.qianyios.top/posts/58032/#%E5%9C%A8K8S%E4%B8%AD%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%E5%87%BAceph%E5%91%BD%E4%BB%A4)\n\n```\n[root@master1 examples]# ceph fs status\nrook-cephfs - 0 clients\n===========\nRANK      STATE            MDS          ACTIVITY     DNS    INOS   DIRS   CAPS\n 0        active      rook-cephfs-f  Reqs:    0 /s    10     13     12      0\n 1        active      rook-cephfs-c  Reqs:    0 /s     0      0      0      0\n 2        active      rook-cephfs-d  Reqs:    0 /s    10     12     11      0\n0-s   standby-replay  rook-cephfs-a  Evts:    0 /s     0      0      0      0\n2-s   standby-replay  rook-cephfs-b  Evts:    0 /s     0      0      0      0\n1-s   standby-replay  rook-cephfs-e  Evts:    0 /s     0      0      0      0\n         POOL             TYPE     USED  AVAIL\n rook-cephfs-metadata   metadata     0   94.9G\nrook-cephfs-replicated    data       0   94.9G\nMDS version: ceph version 17.2.6 (d7ff0d10654d2280e08f1ab989c7cdf3064446a5) quincy (stable)\n[root@master1 examples]# ceph fs ls\nname: rook-cephfs, metadata pool: rook-cephfs-metadata, data pools: [rook-cephfs-replicated ]\n[root@master1 examples]#\n```\n\n`rook-cephfs-replicated`æ˜¯ä¸‹é¢å­˜å‚¨å£°æ˜éœ€è¦ç”¨åˆ°çš„ pool\n\n### åˆ›å»ºStorageclass\n\næ˜¯k8sè°ƒç”¨cephçš„å£°æ˜ï¼Œé€šè¿‡è¿™ä¸ªStorageclassæ‰èƒ½å»è°ƒç”¨ceph\n\n```yaml\ncd \ncd rook/deploy/examples\ncat > rook-cephfs-sc.yaml <<\"EOF\"\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: rook-cephfs-sc\nprovisioner: rook-ceph.cephfs.csi.ceph.com\nparameters:\n  clusterID: rook-ceph #cephé›†ç¾¤å‘½åç©ºé—´\n  fsName: rook-cephfs  #cephfsï¼Œåˆšåˆšåˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿ\n  pool: rook-cephfs-replicated   #åˆšåˆšåˆ›å»ºçš„fsæ‰€åŒ…å«çš„pool\n\n  csi.storage.k8s.io/provisioner-secret-name: rook-csi-cephfs-provisioner\n  csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph\n  csi.storage.k8s.io/controller-expand-secret-name: rook-csi-cephfs-provisioner\n  csi.storage.k8s.io/controller-expand-secret-namespace: rook-ceph\n  csi.storage.k8s.io/node-stage-secret-name: rook-csi-cephfs-node\n  csi.storage.k8s.io/node-stage-secret-namespace: rook-ceph\nreclaimPolicy: Delete\nallowVolumeExpansion: true\nEOF\nkubectl apply -f rook-cephfs-sc.yaml \nkubectl get sc\n```\n\n![image-20240914162514951](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/7385fd2c6cfbfd0d82bde000a657ef7a697559838.png)\n\n## éƒ¨ç½²harborè¿›ç¾¤\n\n[Harborå…±äº«å­˜å‚¨é«˜å¯ç”¨ - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/40301/)\n\n### é…ç½®ä»“åº“åœ°å€\n\néƒ¨ç½²å¥½åï¼Œéœ€è¦å°†K8så„ä¸ªèŠ‚ç‚¹ï¼Œå’Œharborå„ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œé…ç½®ä»“åº“åœ°å€\n\næ“ä½œèŠ‚ç‚¹ï¼š[æ‰€æœ‰èŠ‚ç‚¹]\n\n```\nvim /etc/docker/daemon.json\n```\n\n```\n# å®¢æˆ·ç«¯é»˜è®¤ä½¿ç”¨çš„æ˜¯httpsåè®®ï¼Œæ‰€ä»¥éœ€è¦å¯¹dockeråšä»¥ä¸‹ä¿®æ”¹,åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ insecure-registries\n[root@qianyios ~]# vim /etc/docker/daemon.json\n{\n   ................\n  \"registry-mirrors\": [],#æ— å…³ç´§è¦ï¼Œä¸ç”¨çœ‹,\n  \"insecure-registries\": [ \"192.168.48.100\" ],#é‡è¦åŠ è¿™è¡Œï¼Œåˆ«å¿˜äº†å¦‚æœä»–ä¸æ˜¯æœ€åä¸€è¡Œä¸€å®šè¦åœ¨æœ«å°¾åŠ é€—å·\n ................\n}\n\n# ä¿®æ”¹åï¼Œé‡å¯dockerä½¿å…¶ç”Ÿæ•ˆ\nsystemctl daemon-reload\nsystemctl restart docker\n\n# åˆ©ç”¨docker infoæŸ¥çœ‹æ˜¯å¦æ·»åŠ ä¸Š\n[root@qianyios ~]# docker info\nContainers: 10\n Running: 1\n Paused: 0\n Stopped: 9\nImages: 37\n...\n Experimental: false\n Insecure Registries:\n  192.168.48.100   ###è¦ç¡®ä¿æœ‰è¿™ä¸ªæ‰è¡Œ\n  127.0.0.0/8\n Registry Mirrors:\n```\n\n![image-20240505170836267](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/27c58491143f043c8571088a209586ba697559838.png)\n\n### æµ‹è¯•å…å¯†ç™»å…¥\n\næ¥ä¸‹æ¥æµ‹è¯•å…å¯†ç™»å…¥ï¼Œç¬¬ä¸€æ¬¡ç™»å…¥è¦å¯†ç ï¼Œç¬¬äºŒæ¬¡ç™»å…¥å°±ä¸ç”¨äº†ï¼Œç¬¬äºŒæ¬¡ä¹‹åå°±æ˜¯å…å¯†ç™»å…¥\n\n```\ndocker login 192.168.48.100\n```\n\n![image-20240505172454889](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/972ff9da32eb962e1e8fa9785fddaf5b697559838.png)\n\nå…å¯†ç™»å…¥æˆåŠŸï¼\n\n## éƒ¨ç½²jenkins\n\næ“ä½œèŠ‚ç‚¹:[masetr1]\n\n### åˆ›å»ºrabcéªŒè¯\n\n```yaml\ncd \ncd jenkins\ncat > jenkins-rabc.yaml << \"EOF\"\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: jenkins-admin\n  namespace: jenkins\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: jenkins-admin\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: jenkins-admin\n  namespace: jenkins\nEOF\n\nkubectl apply -f jenkins-rabc.yaml\n```\n\n### åˆ›å»ºjenkinsç”¨æˆ·çš„secret\n\n```yaml\ncd \ncd jenkins\ncat >jenkins-admin-secret.yaml << \"EOF\"\napiVersion: v1\nkind: Secret\nmetadata:\n  name: jenkins-admin-secret\n  namespace: jenkins\n  annotations:\n    kubernetes.io/service-account.name: jenkins-admin\ntype: kubernetes.io/service-account-token\nEOF\nkubectl apply -f jenkins-admin-secret.yaml\nkubectl get secret -n jenkins\n\n[root@master1 jenkins]# kubectl get secret -n jenkins\nNAME                   TYPE                                  DATA   AGE\njenkins-admin-secret   kubernetes.io/service-account-token   3      15s\n\n```\n\n### åˆ›å»ºpvc\n\n```yaml\n#åˆ›å»ºå‘½åç©ºé—´\ncd\nkubectl create namespace jenkins\nmkdir jenkins\ncd jenkins\ncat > pvc.yaml << EOF\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: jenkins-pvc\n  namespace: jenkins\nspec:\n  storageClassName: rook-cephfs-sc  #è¿™ä¸ªæ˜¯ç¬¬4æ­¥éƒ¨ç½²å®Œcephé›†ç¾¤åˆ›å»ºçš„Storageclass\n  resources:\n    requests:\n      storage: 3Gi\n  accessModes:\n  - ReadWriteMany\nEOF\nkubectl apply -f pvc.yaml\nkubectl get pvc -n jenkins\n```\n\n![image-20240914162447149](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/a1b6f6efe993f8ba675b5b8a8e36f7a6697559838.png)\n\n### éƒ¨ç½²jenkins\n\nè‡ªè¡Œåœ¨harborä»“åº“åˆ›å»ºå¥½cicdä»“åº“\n\n![image-20240505231349308](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/46d5e045cb2dbfc4c06a2e5ed806a093697559838.png)\n\næ„å»ºjenkinsé•œåƒ\n\n```\ndocker pull jenkins/jenkins\n```\n\nå¯èƒ½ä¼šå‡ºç°æ‹‰å–ç¼“æ…¢ç°è±¡ï¼Œä¹Ÿå¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œæ„å»º\n\n[åŸºäºé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ„å»ºç§äººdockeré•œåƒ - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/54563/)\n\næ„å»ºä¹‹åå°±è¦è¿›è¡Œæ‹‰å–ä¸‹è½½æ‰“æ ‡ç­¾ï¼Œä»¥ä¸‹æ˜¯æˆ‘è‡ªå·±æ„å»ºçš„ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ª\n\n```\n#ä¸‹è½½é•œåƒ\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/jenkins:latest\n\n#æ‰“æ ‡ç­¾\ndocker tag registry.cn-hangzhou.aliyuncs.com/qianyios/jenkins:latest 192.168.48.100/cicd/jenkins:latest\n\n#æŸ¥çœ‹é•œåƒ\n[root@master1 jenkins]# docker images | grep jenk\n192.168.48.100/cicd/jenkins                                            latest    786c9e8a0cb8   6 days ago      472MB\nregistry.cn-hangzhou.aliyuncs.com/qianyios/jenkins                     latest    786c9e8a0cb8   6 days ago      472MB\n[root@master1 jenkins]#\n\n\n#æ¨é€é•œåƒåˆ°harborä»“åº“\ndocker push 192.168.48.100/cicd/jenkins:latest\n```\n\n![image-20240505231712011](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/ae7ab0b491aa633847aef399c8dfea57697559838.png)\n\n```\n#ç»™æ‰€æœ‰masterèŠ‚ç‚¹æ‰“ä¸Šmasteræ ‡ç­¾\nkubectl label node master1 k8s-type=master\nkubectl label node master2 k8s-type=master\nkubectl label node master3 k8s-type=master\n```\n\n```yaml\ncd \ncd jenkins\ncat >jenkins-deploy.yaml << \"EOF\"\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: jenkins\n  namespace: jenkins\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: jenkins-server\n  template:\n    metadata:\n      labels:\n        app: jenkins-server\n    spec:\n      securityContext:\n            fsGroup: 995\n            runAsUser: 1000\n      serviceAccountName: jenkins-admin\n      nodeSelector:\n        k8s-type: master\n      containers:\n        - name: jenkins\n          image: 192.168.48.100/cicd/jenkins:latest\n          imagePullPolicy: IfNotPresent\n          resources:\n            limits:\n              memory: \"2Gi\"\n              cpu: \"1000m\"\n            requests:\n              memory: \"500Mi\"\n              cpu: \"500m\"\n          ports:\n            - name: httpport\n              containerPort: 8080\n            - name: jnlpport\n              containerPort: 50000\n          livenessProbe:\n            httpGet:\n              path: \"/login\"\n              port: 8080\n            initialDelaySeconds: 90\n            periodSeconds: 10\n            timeoutSeconds: 5\n            failureThreshold: 5\n          readinessProbe:\n            httpGet:\n              path: \"/login\"\n              port: 8080\n            initialDelaySeconds: 60\n            periodSeconds: 10\n            timeoutSeconds: 5\n            failureThreshold: 3\n          volumeMounts:\n            - name: jenkins-data\n              mountPath: /var/jenkins_home\n            - name: kubectl\n              mountPath: /usr/bin/kubectl\n            - name: kube-config\n              mountPath: /root/.kube\n            - name: docker\n              mountPath: /usr/bin/docker\n            - name: docker-sock\n              mountPath: /var/run/docker.sock\n      volumes:\n        - name: jenkins-data\n          persistentVolumeClaim:\n              claimName: jenkins-pvc\n        - name: kubectl\n          hostPath:\n            path: /usr/bin/kubectl\n        - name: kube-config\n          hostPath:\n            path: /root/.kube\n        - name: docker\n          hostPath:\n            path: /usr/bin/docker\n        - name: docker-sock\n          hostPath:\n            path: /var/run/docker.sock\nEOF\nkubectl apply -f jenkins-deploy.yaml \nkubectl get pods -n jenkins\n```\n\n### åˆ›å»ºsvc\n\n```\ncd \ncd jenkins\ncat >jenkins-svc.yaml << \"EOF\"\napiVersion: v1\nkind: Service\nmetadata:\n  name: jenkins-service\n  namespace: jenkins\n  annotations:\n      prometheus.io/scrape: 'true'\n      prometheus.io/path:   /\n      prometheus.io/port:   '8080'\nspec:\n  selector:\n    app: jenkins-server\n  type: NodePort\n  ports:\n  - port: 8080\n    targetPort: 8080\n    nodePort: 32000\n    name: httpport\n  - name: jnlpport\n    port: 50000\n    targetPort: 50000\nEOF\nkubectl apply -f jenkins-svc.yaml\nkubectl get svc -n jenkins\n```\n\n### è®¿é—®é¡µé¢\n\n```\nhttp://192.168.48.200:32000/\n```\n\n![image-20240505235348080](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/f331ea4ab75c72cf7571526a60a28063697559838.png)\n\n```\nkubectl get pods -n jenkins\n#æŸ¥çœ‹ä½ çš„podåå­—æ›¿æ¢ä¸‹é¢çš„åå­—å³å¯(jenkins-799dc7cd88-d2n4k)\n\n#è¿›å…¥å®¹å™¨\nkubectl exec -it -n jenkins jenkins-799dc7cd88-d2n4k -- bash\n\n#ä¿®æ”¹Update Centeræº\nsed -i 's#https://updates.jenkins.io/update-center.json#http://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json#g' /var/jenkins_home/hudson.model.UpdateCenter.xml\n \n#æ›¿æ¢æ’ä»¶æºåœ°å€ï¼š \nsed -i 's#https://updates.jenkins.io/download#http://mirrors.aliyun.com/jenkins#g' /var/jenkins_home/updates/default.json\n#æ›¿æ¢è°·æ­Œåœ°å€ï¼š \nsed -i 's#http://www.google.com#http://www.baidu.com#g' /var/jenkins_home/updates/default.json\n\n\n#æŸ¥çœ‹ç½‘é¡µå¯†ç \njenkins@jenkins-546cf958bd-kq5f2:~$ cat /var/jenkins_home/secrets/initialAdminPassword\n\nebfc1b12835f43c8a8c2677728e4aa55\n\n```\n\n![image-20240506000643463](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/2f2db2a27d4a0dd3d92e857870278526697559838.png)\n\nå…ˆç‚¹æ— ï¼Œè¿™é‡Œå…ˆä¸å®‰è£…ï¼Œåé¢å†å®‰è£…\n\n![image-20240928203306616](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/a425a18e9ecb98b0a4723c128312ab51697559838.png)\n\nä½¿ç”¨adminè´¦æˆ·ç»§ç»­\n\n![image-20240506001948294](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/1e989f1a5689f8f4553543ffc7c59867697559838.png)\n\né»˜è®¤ä¸‹ä¸€æ­¥\n\n![image-20240506002019436](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/bb4f8222efce7330d25b4e8d18973466697559838.png)\n\nè‡ªè¡Œå»è®¾ç½®ä¿®æ”¹adminå¯†ç \n\n![image-20240506002313407](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/eeb716caa3cf3919a39af3f80d2b7848697559838.png)\n\n### é…ç½®k8sç­‰æ’ä»¶å’Œå®ç°åŠŸèƒ½\n\n#### å®‰è£…æ’ä»¶\n\n```\nå®‰è£…æ’ä»¶ï¼šGit / Git Parameter/Pipeline/Config File Provider/Gitlab/Generic Webhook Trigger/Blue Ocean/Localization: Chinese /Kubernetes\n```\n\nåœ¨é¦–é¡µç‚¹å‡»ç³»ç»Ÿç®¡ç†ç„¶åç‚¹å‡»æ’ä»¶ç®¡ç†-----å®‰è£…Kubernetesæ’ä»¶\n\n![image-20240506002747172](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/9bfce81b43fd7ab943762a4d6cbbc455697559838.png)\n\nå®‰è£…ä¹‹åéœ€è¦ç­‰å¾…ä»–é‡å¯\n\n![image-20240506003015735](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/2c83d8d8cb866cc6de3f9c8130bcf8e1697559838.png)\n\n![image-20240506003148720](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/444846662a1acfce590742d4f47b2abd697559838.png)\n\n#### é…ç½®K8sä»£ç†èŠ‚ç‚¹\n\né…ç½®jenkinsè¿æ¥kubernetes\n\nç‚¹å‡»ç³»ç»Ÿç®¡ç†-cloud\n\n![image-20240928213206053](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/cf008758ec9195ff1ec5f56b3c0ae4db697559838.png)\n\nç‚¹å‡»Clouds-æ·»åŠ New cloud\n\n![image-20240928213240693](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/69c95d344dca55dea99b62a293aa8948697559838.png)\n\nç‚¹å‡»create\n\n![image-20240928213328017](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/8e27c7fe9c9e9e0905c7fee4fbe1e1bc697559838.png)\n\næŸ¥çœ‹Kubernetes æœåŠ¡è¯ä¹¦ key\n\n    [root@master1 jenkins]# cat /etc/kubernetes/pki/ca.crt\n    -----BEGIN CERTIFICATE-----\n    MIIDBTCCAe2gAwIBAgIIcJ+z+Wx0m20wDQYJKoZIhvcNAQELBQAwFTETMBEGA1UE\n    AxMKa3ViZXJuZXRlczAeFw0yNDA5MjgxMTI5NDJaFw0zNDA5MjYxMTM0NDJaMBUx\n    EzARBgNVBAMTCmt1YmVybmV0ZXMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK\n    AoIBAQDYeRyEbAJRMqWyAmQf0LfK9wecWoQSyKYX+gHDUvZMaQK/nkAfrEme5Wot\n    J8lcODlNAj0OImRRKkCzfBwlZl5WMYH3Roonn8z9j4hkUAX/EgTwMun1q0G/D1yV\n    zxcRSUxxiFDKlRCVsPxIsuHIUvTrAHkU0qpz1S4cITisF9o9hCvqZZZ/5fCudn7I\n    sLlDhxzL1TAI5R2hqZKFdondpoGxYF5oc2wuk+0g/3GJZeaGEO/9p5ySX/glamil\n    e5npU/EvLsG4er2UQqB7dc9wfxOT2p0Qlj7UjHcqgY8E6ufhd7GqYVKNDXSmKXiP\n    BZI5ba6/kZJj0nsSz3GnVdhFxUD1AgMBAAGjWTBXMA4GA1UdDwEB/wQEAwICpDAP\n    BgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBT5qTcFwRrY/VSJtfAZK85ZCp2ViTAV\n    BgNVHREEDjAMggprdWJlcm5ldGVzMA0GCSqGSIb3DQEBCwUAA4IBAQDX+1q8NXKb\n    HWnfR75MORrQJ898B9M1FBoHfLRdsmmCJVrSQXbBbKn1zVoJL6YLdjDOx2NfWa8o\n    f1Y7KSme9Z6B4j57tGFQ/4LST4Cwk4PPh1v6nrwVesW6xE6ClHVZ0N1S4ggZi8ll\n    Wcv3ZCgdGrjSQm15xsRr4oN7XGY/B1kAZWU4defpcxhtIMtLQ7/m74hfYo/P5L/b\n    Wu1knzRSs1/Cna2GFkWx3BYfbG78ZPBIh17mN4vFAt/x8ZOZCJ+bb0Ey6upYnhjP\n    H2jiNrHcyJVnnDO4N6kMII9sh2n+gYvK45u+/Vw8nPElf72LkHFHOyQc8QD9opXF\n    LC9bmhoJuU9v\n    -----END CERTIFICATE-----\n\n![image-20240928213425808](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/91f86a090ce50d4e913757901517361f697559838.png)\n\nè·å–å‡­è¯\n\n> ä¸æ˜¯ä½ç‰ˆæœ¬ï¼Œè¯·è·³åˆ°ä¸‹ä¸€æ­¥ï¼ï¼ï¼ï¼\n>\n> ä½ç‰ˆæœ¬è·å–å‡­è¯æ–¹æ³•ï¼Œä½ç‰ˆæœ¬ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªsecret\n\n    [root@master1 ~]# SECRET_NAME=$(kubectl get serviceaccount jenkins-admin  -o=jsonpath='{.secrets[0].name}' -n jenkins)\n    [root@master1 ~]# kubectl get secrets $SECRET_NAME  -o=jsonpath='{.data.token}' -n jenkins | base64 -d\n\n> k8s1.28è·å–å‡­è¯æ–¹æ³•ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºsecret\n>\n> ä½¿ç”¨kubectl create tokenè·å–çš„tokenä¼šè¿‡æœŸ\n>\n> è¿™é‡Œæ‰‹åŠ¨åˆ›å»ºsecretï¼Œå¹¶æŸ¥çœ‹ç›¸å…³tokenå€¼\n\nç¼–å†™jenkins-adminç”¨æˆ·secretæ¸…å•,å¹¶åˆ›å»º\n\n    cd /root/jenkins\n    cat >jenkins-admin-secret.yaml<< \"EOF\"\n    apiVersion: v1\n    kind: Secret\n    metadata:\n      name: jenkins-admin-secret\n      namespace: jenkins\n      annotations:\n        kubernetes.io/service-account.name: jenkins-admin\n    type: kubernetes.io/service-account-token\n    EOF\n     kubectl apply -f jenkins-admin-secret.yaml\n\næŸ¥çœ‹secret\n\n    kubectl get secret -n jenkins\n\n![image-20240928213605321](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/1029a221f55fb41ac9127d7e05ac64d4697559838.png)\n\nè·å–token\n\n    [root@master1 jenkins]# kubectl get secrets jenkins-admin-secret  -o=jsonpath='{.data.token}' -n jenkins | base64 -d\n    eyJhbGciOiJSUzI1NiIsImtpZCI6ImpaNkJTN3d0M0pFblBCSVBaaGFoNzdUTVNLMHZiTERxY09Ibmg4WEtFNTQifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJqZW5raW5zIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImplbmtpbnMtYWRtaW4tc2VjcmV0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImplbmtpbnMtYWRtaW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI3MTg2Mzg1Mi1jNDkwLTQyMDEtYTA2OS1lM2ZhOTcyNTgwODYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6amVua2luczpqZW5raW5zLWFkbWluIn0.sfofmctQos9fcEAf0hZEfEKN2WiG7GklOW6NMEdXbiJHkg5SNe8-MuJK4c4JtubyIA9IFhHo6PfQoFl8-2smuFaojjSKZKn2esJJ5enT_WNsbIdXmu4tg8a2571EikotiGKLpGHuLEZOLdTyswTsQW-FSQH7K16VmfUSzHCkKjV5eXNK3gpRj9p3voGWlBRQ3Jqfm6NWSKp_1_XZqFyi_KM8DOaMHhffN24ejwC2lvIzKNcZp80yY2rW4BkCI0dLN2GqUNlzB9QXYUslLtsigObukCdjY8EefCc34Rh68kq2UQVpXb9eTkyK50J9HEFJtLiuameD3Yx8gNE9xWJ4Vw\n\n![image-20240928213838987](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/5d35fd472547195b51a88ab988d01702697559838.png)\n\né…ç½®kubernetesç›¸å…³ä¿¡æ¯\n\n- > **Name**: è¿™ä¸ªè‡ªå®šä¹‰ï¼Œ é»˜è®¤çš„æ˜¯`kubernetes`\n\n- > **Kubernetes URL**: `https://kubernetes.default`- è¿™ä¸ªä¸€èˆ¬æ˜¯ä»ä½ çš„ service account è‡ªåŠ¨é…ç½®çš„\n\n- > **Kubernetes æœåŠ¡è¯ä¹¦ key**ï¼š å¦‚æœæ‚¨æœ‰ Kubernetes é›†ç¾¤ CA è¯ä¹¦ï¼Œæ‚¨å¯ä»¥æ·»åŠ å®ƒä»¥å®ç°å®‰å…¨è¿æ¥ã€‚æ‚¨å¯ä»¥ä» pod ä½ç½®è·å–è¯ä¹¦/var/run/secrets/kubernetes.io/serviceaccount/ca.crtã€‚å¦‚æœæ‚¨æ²¡æœ‰è¯ä¹¦ï¼Œæ‚¨å¯ä»¥å¯ç”¨â€œ disable https certificate checkâ€(ç¦ç”¨HTTPSè¯ä¹¦æ£€æŸ¥)é€‰é¡¹\n\n- > **Kubernetes Namespace**: ä¸€èˆ¬æ˜¯ `default` é™¤éä½ è¦åœ¨ä¸€ä¸ªç‰¹æ®Šçš„å‘½åç©ºé—´ ï¼Œå¦åˆ™ä¸è¦åŠ¨ä»–.å› ä¸ºæˆ‘çš„jenkinséƒ¨ç½²åœ¨äº†jenkinå‘½åç©ºé—´ï¼Œå°±ç”¨äº†jenkins\n\n- > **Credentialsï¼ˆå‡­æ®ï¼‰**: ä¸ºäº†è®© Jenkins ä¸ Kubernetes é›†ç¾¤é€šä¿¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœåŠ¡å¸æˆ·ä»¤ç‰Œï¼Œè¯¥ä»¤ç‰Œå…·æœ‰åœ¨è®¾ç½®çš„å‘½åç©ºé—´ä¸­éƒ¨ç½² pod çš„æƒé™\n\n- > **Jenkins URL**: `http://<your_jenkins_hostname>:port`\n\n- > **Jenkins tunnel**: `<your_jenkins_hostname>:50000` - è¿™å°±æ˜¯ç”¨æ¥å’Œ Jenkins å¯åŠ¨çš„ agent è¿›è¡Œäº¤äº’çš„ç«¯å£\n\nä¿®æ”¹åç§°å’Œkubernetesåœ°å€åŠæœåŠ¡è¯ä¹¦key\n\n> æ­¤Kubernetesç”±äºJenkins æœåŠ¡å™¨åœ¨åŒä¸€ä¸ª Kubernetes é›†ç¾¤ä¸­è¿è¡Œï¼Œè¿™é‡Œç›´æ¥é€šè¿‡serviceè¿›è¡Œé€šè®¯\n>\n> æ­¤æœåŠ¡è¯ä¹¦keyå°±æ˜¯å‰å‡ æ­¥è·å–çš„key\n\næ·»åŠ å‡­è¯\n\nç‚¹å‡»æ·»åŠ -\\>jenkins\n\n![image-20240928214022992](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/88c7b458474ca8db5d89bec785d81fc2697559838.png)\n\n> é€‰æ‹©Domainä¸ºå…¨å±€å‡­æ®\n>\n> ç±»å‹é€‰æ‹©ä¸ºsecret txt\n>\n> èŒƒå›´é€‰æ‹©ä¸ºå…¨å±€\n>\n> secretå°±æ˜¯åˆšæ‰è·å–çš„å‡­æ®\n>\n> æè¿° å°±æ˜¯å‡­æ®çš„åç§°\n\n![image-20240928214459767](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/db974a377f80c3958d46484be433e830697559838.png)\n\nç‚¹å‡»æ·»åŠ \n\né€‰æ‹©å‡­æ®ä¸ºåˆšæ‰æ·»åŠ çš„,ç‚¹å‡»æµ‹è¯•é“¾æ¥ï¼ŒéªŒè¯ Kubernetes é›†ç¾¤çš„è¿æ¥æ€§\n\n![image-20240928214608024](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/c311dab5e0e86a2698f4f9ed84d9c0c3697559838.png)\n\né…ç½® Jenkins URL è¯¦ç»†ä¿¡æ¯\n\n> å¯¹äºåœ¨k8sé›†ç¾¤å†…éƒ¨è¿è¡Œçš„ Jenkins masterï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Kubernetes é›†ç¾¤çš„ Service ç«¯ç‚¹ä½œä¸º Jenkins URLï¼Œå› ä¸ºä»£ç† pod å¯ä»¥é€šè¿‡å†…éƒ¨æœåŠ¡ DNS è¿æ¥åˆ°é›†ç¾¤\n>\n> urlè¯­æ³•ï¼šhttp://.:8080\n>\n> jenkins-service.jenkins:8080\n>\n> æ³¨æ„ï¼šJenkins é€šé“ï¼ˆJenkins tunnelï¼‰é“¾æ¥ä¸éœ€è¦åŠ http://ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸é€šè®¯\n\n![image-20240928214829511](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/adc17f12dcabbcdeaf52ed546e6d431c697559838.png)\n\nåˆ›å»ºæˆåŠŸ\n\n![image-20240928214845932](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/2c5236e38fe3963d8a4e50ce094400e6697559838.png)\n\n#### åˆ›å»ºJenkinsä»£ç†é•œåƒ\n\næ‹‰å–jenkinsä»£ç†é•œåƒå¹¶ä¸Šä¼ åˆ°harborä»“åº“\n\n    docker pull jenkins/inbound-agent\n    #å¦‚æœä¸‹ä¸åˆ°å¯ä»¥ç”¨æˆ‘çš„\n    docker pull registry.cn-hangzhou.aliyuncs.com/qianyios/inbound-agent:latest\n    docker tag registry.cn-hangzhou.aliyuncs.com/qianyios/inbound-agent:latest 192.168.48.100/library/inbound-agent:latest\n    docker push 192.168.48.100/library/inbound-agent:latest\n    docker images | grep inbound\n\n## éƒ¨ç½²gitlab\n\n### åˆ›å»ºgitlabçš„secret\n\n```\n#é•¿åº¦ä¸º8ä¸ªå­—ç¬¦\n[root@master1 ~]# echo -n 'qianyios' | base64\ncWlhbnlpb3M=\n#qianyioså°†ä¼šæˆä¸ºgitlabé¡µé¢çš„ç™»å…¥å¯†ç \n```\n\n```\nmkdir /root/gitlab\ncd /root/gitlab\n#åˆ›å»ºnamespace\nkubectl create namespace gitlab\n```\n\n```yaml\ncat >gitlab-secret-pwd.yaml << \"EOF\"\napiVersion: v1\ndata:\n  password: cWlhbnlpb3M=  #æ¢æˆåˆšåˆšå‰é¢ç”Ÿæˆçš„å¯†ç \nkind: Secret\nmetadata:\n  creationTimestamp: null\n  name: gitlab-pwd\n  namespace: gitlab\nEOF\nkubectl apply -f gitlab-secret-pwd.yaml\nkubectl get secret -n gitlab\n```\n\n![image-20240928215102453](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/87d17c22886bf21b7dfffd601007c06a697559838.png)\n\n### åˆ›å»ºpvc\n\n```\ncat > gitlab-pvc.yaml <<\"EOF\"\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: gitlab-pvc-logs\n  namespace: gitlab\nspec:\n  storageClassName: rook-cephfs-sc\n  resources:\n    requests:\n      storage: 5Gi\n  accessModes:\n  - ReadWriteOnce\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: gitlab-pvc-config\n  namespace: gitlab\nspec:\n  storageClassName: rook-cephfs-sc\n  resources:\n    requests:\n      storage: 1Gi\n  accessModes:\n  - ReadWriteOnce\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: gitlab-pvc-data\n  namespace: gitlab\nspec:\n  storageClassName: rook-cephfs-sc\n  resources:\n    requests:\n      storage: 10Gi\n  accessModes:\n  - ReadWriteOnce\nEOF\n  \nkubectl apply -f gitlab-pvc.yaml \nkubectl get pvc -n gitlab\n```\n\n![image-20240510195549565](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/06a3898e71f0a5443a8c3e4e5f614558697559838.png)\n\n### éƒ¨ç½²gitlab\n\n```\n#ä¸‹è½½gitlab-ceé•œåƒï¼Œé•œåƒå¾ˆå¤§è¦1ä¸ªGå¤š\n docker pull gitlab/gitlab-ce\n# å¦‚æœä¸‹ä¸äº†ç”¨æˆ‘æ„å»ºçš„é•œåƒ\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/gitlab:latest\n\n\n#é•œåƒæ‰“æ ‡ç­¾#è¿™ä¸ªé‡Œæˆ‘ç”¨äº†è‡ªå·±æ„å»ºçš„é•œåƒï¼Œä½ è¦æ˜¯ç”¨è¿™ä¸ªgitlab/gitlab-ceè‡ªè¡Œæ›¿æ¢\ndocker tag registry.cn-hangzhou.aliyuncs.com/qianyios/gitlab:latest 192.168.48.100/cicd/gitlab:latest\n\n#æ¨é€é•œåƒ\ndocker push 192.168.48.100/cicd/gitlab:latest\n```\n\n```\nç»™nodeèŠ‚ç‚¹æ‰“ä¸Šk8s-type=nodeæ ‡ç­¾\nkubectl label nodes node01 k8s-type=node\n```\n\n```\ncat > gitlab-deploy.yaml << \"EOF\"\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: gitlab\n  name: gitlab\n  namespace: gitlab\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: gitlab\n  strategy: {}\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: gitlab\n    spec:\n      nodeSelector:\n        k8s-type: node\n      containers:\n      - image: 192.168.48.100/cicd/gitlab:latest  #æ›´æ¢é•œåƒ\n        imagePullPolicy: IfNotPresent\n        name: gitlab-ce\n        env:\n        - name: GITLAB_ROOT_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: gitlab-pwd\n              key: password\n        - name: GITLAB_ROOT_MAIL\n          value: xiaoohu2002@126.com\n        ports:\n        - name: gitlab80\n          containerPort: 80\n        - name: gitlab22\n          containerPort: 22\n        - name: gitlab443\n          containerPort: 443\n        volumeMounts:\n        - name: gitlab-logs\n          mountPath: /var/log/gitlab\n        - name: gitlab-config\n          mountPath: /etc/gitlab\n        - name: gitlab-data\n          mountPath: /var/opt/gitlab\n      volumes:\n      - name: gitlab-logs\n        persistentVolumeClaim:\n          claimName: gitlab-pvc-logs\n      - name: gitlab-config\n        persistentVolumeClaim:\n          claimName: gitlab-pvc-config\n      - name: gitlab-data\n        persistentVolumeClaim:\n          claimName: gitlab-pvc-data\nstatus: {}\n\nEOF\nkubectl apply -f  gitlab-deploy.yaml\nkubectl get pod -n gitlab\n```\n\n### åˆ›å»ºsvc\n\n```\ncat > gitlab-svc.yaml << \"EOF\"\napiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: gitlab\n  name: gitlab\n  namespace: gitlab\nspec:\n  ports:\n  - name: 80-80\n    port: 80\n    protocol: TCP\n    targetPort: 80\n    nodePort: 30880\n  - name: 443-443\n    port: 443\n    protocol: TCP\n    targetPort: 443\n  - name: 22-22\n    port: 22\n    protocol: TCP\n    targetPort: 22\n  selector:\n    app: gitlab\n  type: NodePort\nstatus:\n  loadBalancer: {}\n\nEOF\nkubectl apply -f  gitlab-svc.yaml\nkubectl get svc -n gitlab\n```\n\nè®¿é—®é¡µé¢\n\n```\nhttp://192.168.48.200:30880/\n```\n\n![image-20240510211753542](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/969b19b798d53ed377c1c2b6ca9d0d2c697559838.png)\n\n### é¡µé¢æµ‹è¯•\n\n#### è®¾ç½®ä¸­æ–‡\n\n![sp20240920_184829_245](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/e040569c710147601f16d05900f35bcc697559838.png)\n\n\n\n#### åˆ›å»ºé¡¹ç›®\n\n![image-20240920185232410](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/c79d7f3b59233ef180d9a4651917e311697559838.png)\n\n![image-20240920185329957](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/f487ee08b53753e3839e9650926bd7eb697559838.png)\n\n#### é¡¹ç›®æ¨é€\n\næ“ä½œèŠ‚ç‚¹:[master1]\n\n```\nyum install -y git\nmkdir /root/cicd/\ncd /root/cicd/\nmkdir chatgpt && cd chatgpt/\n```\n\nä¸Šä¼ Chatgpté•œåƒç«™æºç \n\né¡¹ç›®åœ°å€ï¼š[ChatGPTNextWeb](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web)\n\n```\ncd /root/cicd/chatgpt/\nwget https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/archive/refs/heads/main.zip\n```\n\n```\n[root@master1 chatgpt]# ls main.zip\n```\n\nè§£å‹æºä»£ç å‹ç¼©åŒ…\n\n```\nunzip /root/cicd/chatgpt/main.zip\nmv ChatGPT-Next-Web-main/* ./\nrm -rf ChatGPT-Next-Web-main main.zip\n```\n\nGitå…¨å±€è®¾ç½®\n\n```\ngit config --global user.name \"Administrator\"\ngit config --global user.email \"XiaooHu2002@163.com\"\n```\n\næ·»åŠ ç‰ˆæœ¬åº“\n\n```\ncd /root/cicd/chatgpt/\ngit init\n```\n\næ·»åŠ è¿œç¨‹ä»“åº“\n\nè¦æ³¨æ„æ˜¯å“ªä¸ªä¸»åˆ†æ”¯å“¦ï¼è¿™é‡Œçš„æ˜¯main\n\n![image-20240920192141173](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/81d9c2fdd2282841face7bc23cbebb3f697559838.png)\n\n\n\n```bash\ngit remote add origin http://192.168.48.200:30880/root/chatgpt.git\n#è·Ÿè¸ªæ‰€æœ‰æ”¹åŠ¨è¿‡çš„æ–‡ä»¶\ngit add . \n#æäº¤æ‰€æœ‰æ›´æ–°è¿‡çš„æ–‡ä»¶\ngit commit -m \"first commit\"\n#å°†ä»£ç æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆä¸»åˆ†æ”¯mainï¼‰\n#å¦‚æœä¸»åˆ†æ”¯æ˜¯mainåˆ™ç›´æ¥æ‰§è¡Œä¸‹ä¸€æ­¥\n#é¦–å…ˆæˆ‘æœ¬åœ°çš„ä¸»åˆ†æ”¯æ˜¯masterï¼Œæˆ‘éœ€è¦åˆ‡æ¢ï¼Œå¯ä»¥é€šè¿‡git branchæŸ¥çœ‹\ngit branch -m master main\n#æ¨é€mainåˆ†æ”¯\ngit push -u origin main\n\n#ä¼šæç¤ºä½ è®©ä½ è¾“å…¥gitlabçš„è´¦å·å¯†ç \nUsername for 'http://192.168.48.200:30880': root\nPassword for 'http://root@192.168.48.200:30880':\n#å¯†ç æ˜¯qianyios\n```\n\n![image-20240928221810920](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/d37dd6861d7882ee071e71ee2e8f332a697559838.png)\n\n![image-20240928221824375](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/d4aa005daac2902cfba88cc454ef488c697559838.png)\n\n## Jenkinså¯¹æ¥gitlab\n\n### åˆ›å»ºgitlab Secretä»¤ç‰Œ\n\nè¿›å…¥gitlabåˆ›å»ºSecretä»¤ç‰Œ\n\n![image-20240928232433171](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/a82a765978bcf39cb1997f6e6d9d28cd697559838.png)\n\n![image-20240928232523788](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/ba7d24a30096e859452519103d31bd9c697559838.png)\n\nåˆ›å»ºæˆåŠŸSecretä»¤ç‰Œï¼Œå¹¶å¤åˆ¶ä»¤ç‰Œ\n\n> æ­¤ä»¤ç‰Œéœ€è¦ä¿å­˜å¥½ï¼Œåé¢jenkinsè¿˜éœ€è¦ç”¨åˆ°\n>\n> glpat-vLZgV6Z1nbC_96yyZdyp\n\n![image-20240928232604113](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/862de2cc8598bac9f54951ff4d3c6fa6697559838.png)\n\n### Jenkinsåˆ›å»ºæµæ°´çº¿\n\nç‚¹å‡»æ–°å»ºä»»åŠ¡ï¼Œè¾“å…¥åç§°å¹¶é€‰æ‹©ä¸ºæµæ°´çº¿ï¼Œå¹¶ç‚¹å‡»ç¡®å®š\n\n![image-20240928232711976](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/67f45551ed6670814d2b93f0914baa20697559838.png)\n\nåœ¨generalä¸­æ‰¾åˆ°Generic Webhook Trigger å¹¶å‹¾é€‰ä¸”å¤åˆ¶webhooké“¾æ¥\n\n> http://JENKINS_URL/generic-webhook-trigger/invoke\n\n![image-20240928232844592](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/65caaf702957698297fefe7b0a8c47d4697559838.png)\n\næ·»åŠ gitlabå‡­æ®\n\n![image-20240928233042430](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/6c0891a031bd660647e2bd36bc72036d697559838.png)\n\n![image-20240928233233174](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/a05a08721f9d77983116845433f6a86a697559838.png)\n\n![image-20240928233322636](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/61ae798e294383757346bb23d86fb8d8697559838.png)\n\n#### é…ç½®Webhook\n\né…ç½®å…è®¸Webhookå’ŒæœåŠ¡å¯¹æœ¬åœ°ç½‘ç»œçš„è¯·æ±‚\n\nè¿›å…¥ç®¡ç†å‘˜-è®¾ç½®-ç½‘ç»œ\n\n![image-20240928233445339](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/73d1d1479e2f5b73d8c2d1b31dcd88c0697559838.png)\n\nå‹¾é€‰å…è®¸æ¥è‡ª webhooks å’Œé›†æˆå¯¹æœ¬åœ°ç½‘ç»œçš„è¯·æ±‚å¹¶ä¿å­˜æ›´æ”¹å³å¯\n\n![image-20240928233549420](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/131fa8a88fe4f5fd7fa4a77cebe3a22a697559838.png)\n\næ¥ä¸‹æ¥é…ç½®webhooks\n\nè¿›å…¥åˆ°é¡¹ç›®ä¸­\n\n![image-20240928233715393](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/a44c0ad8409ea4f5ba76072c9ada0c91697559838.png)\n\nå¡«å†™ç›¸å…³ä¿¡æ¯\n\n> ç½‘å€ï¼šå°±æ˜¯åˆšæ‰jenkinsåˆ›å»ºé¡¹ç›®çš„æ—¶å€™å¤åˆ¶çš„é“¾æ¥ï¼Œè¿™é‡Œåªæ˜¯å¯¹å…¶è¿›è¡Œä¿®æ”¹äº†ï¼Œå› ä¸ºjenkinså’Œgitlabéƒ½æ˜¯éƒ¨ç½²åœ¨åŒä¸€ä¸ªk8sé›†ç¾¤ä¸­æˆ‘è¿™é‡Œå°†åŸŸåä¿®æ”¹æˆäº†serviceçš„åœ°å€\n>\n> åŸåœ°å€ï¼šhttp://JENKINS_URL/generic-webhook-trigger/invoke\n>\n> ä¿®æ”¹åçš„åœ°å€:http://jenkins-service.jenkins:8080/generic-webhook-trigger/invoke\n>\n> - **`jenkins-service`**ï¼šè¿™æ˜¯æœåŠ¡çš„åç§°ï¼Œå®ƒåœ¨ Kubernetes é›†ç¾¤å†…éƒ¨ç”¨äºæ ‡è¯† Jenkins æœåŠ¡ã€‚\n> - **`.jenkins`**ï¼šè¿™æ˜¯ Jenkins æœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ã€‚åœ¨ Kubernetes ä¸­ï¼ŒæœåŠ¡çš„ DNS åç§°ä¼šåŒ…å«å…¶å‘½åç©ºé—´ã€‚\n> - **`:8080`**ï¼šè¿™æ˜¯æœåŠ¡æš´éœ²çš„ç«¯å£å·ï¼ŒJenkins é»˜è®¤ä½¿ç”¨ 8080 ç«¯å£æä¾› Web æœåŠ¡ã€‚\n>\n> `è‡ªå·±å¯ä»¥æ ¹æ®è‡ªå·±çš„deploymentå»ä¿®æ”¹`\n>\n> Secret ä»¤ç‰Œï¼šå°±æ˜¯åˆšåˆ›å»ºçš„ä¸ªäººä»¤ç‰Œ\n>\n> æ¨é€äº‹ä»¶ï¼šæŒ‡å®šåªæœ‰æ¨é€åˆ°æŸä¸ªä»“åº“æ—¶æ‰è§¦å‘ï¼Œç•™ç©ºåˆ™å…¨éƒ¨åˆ†æ”¯\n\nå…ˆçœ‹æ›´æ”¹åœ°å€ï¼Œè¿™ä¸€æ­¥ä¸éœ€è¦æ“ä½œä»€ä¹ˆï¼Œçœ‹æ¸…æ¥šï¼Œæ›¿æ¢äº†å•¥JENKINS_URLâ¡ï¸jenkins-service.jenkins:8080\n\n![image-20240928234842712](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/3b4750bf2bc83def18803dc94f5833e0697559838.png)\n\néƒ¨ç½²webhook\n\n![image-20240928235008407](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/49d0585b109c99ac2e4f7bbcbbc75a17697559838.png)\n\n![image-20240928234156662](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/f0dde55be4a78a5e03ab6998ade02c23697559838.png)\n\nç„¶åæ·»åŠ webhookå³å¯ï¼Œç„¶åæµ‹è¯•æ¨é€äº‹ä»¶\n\n![image-20240928235306092](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/31c356b4b6ac9022eb25d7caf142b444697559838.png)\n\n### é…ç½®jenkinsæµæ°´çº¿\n\n#### æ·»åŠ harborç”¨æˆ·\n\n![image-20240928235427264](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/3fda7a4b1043d4eba49619872d48cd5f697559838.png)\n\n![image-20240928235449242](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/dfd2d67aec2724ec510c8e0df619d957697559838.png)\n\nè¾“å…¥ç›¸å…³ä¿¡æ¯å¹¶ç‚¹å‡»createåˆ›å»º\n\n> ç±»å‹é€‰æ‹©Username with password\n>\n> èŒƒå›´é€‰æ‹©å…¨å±€\n>\n> ç”¨æˆ·åä¸ºHarborä»“åº“ç”¨æˆ·å\n>\n> å¯†ç ä¸ºHarborä»“åº“ç”¨æˆ·å¯†ç \n>\n> æè¿°ä¸ºæ­¤å‡­æ®çš„åç§°\n\n![image-20240928235632916](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/f414413c293dd15bb9ab3553f49ede43697559838.png)\n\n![image-20240928235646179](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/e9948bdccb4263609f078117a3ca72b4697559838.png)\n\nåˆ›å»ºå¥½åï¼Œæ¥ä¸‹æ¥é…ç½®æµæ°´çº¿\n\nå…ˆè·å–é¡¹ç›®ä»“åº“åœ°å€\n\n![image-20240929000356404](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/e8aa9cfc053f08e019a4f526f0e1d1c7697559838.png)\n\nä½†æ˜¯æˆ‘ä»¬è¦å¯¹å…¶ä¸­çš„åœ°å€æ”¹ä¸€ä¸‹ï¼Œæ”¹æˆ\n\n> http://gitlab.gitlab/root/chatgpt.git\n\nå›åˆ°jenkinsä»»åŠ¡\n\nç‚¹å‡»Dashboard->ChatGPT->è®¾ç½®->å¹¶ç‚¹å‡»æµæ°´çº¿\n\n![image-20240928235754557](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/f0306952bcd18ffa427235deca6af3f1697559838.png)\n\n![image-20240929002051798](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/8330554bf1e3c1fed45cfc5879951ddf697559838.png)\n\nç‚¹å‡»æ·»åŠ å‡­æ®\n\n> Domain é€‰æ‹©å…¨å±€å‡­æ®\n>\n> ç±»å‹é€‰æ‹©Username with password\n>\n> èŒƒå›´é€‰æ‹©å…¨å±€\n>\n> ç”¨æˆ·åå³æ˜¯gitlabè´¦å·\n>\n> å¯†ç å³æ˜¯gitlabè´¦å·å¯†ç \n>\n> æè¿°ä¸ºæ­¤å‡­æ®çš„åç§°\n\n![image-20240929002313733](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/fedfa1d6622d973dda0b1c7e0f7d05f9697559838.png)\n\nå¾€ä¸‹æ»‘\n\n![image-20240929002527605](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/c810fe11e41ce90a1f52eb5aa66af647697559838.png)\n\nä¿å­˜å³å¯\n\n#### harboræ–°å»ºé¡¹ç›®\n\nè¾“å…¥ç›¸å…³ä¿¡æ¯å¹¶ç‚¹å‡»ç¡®å®š\n\n> ç”¨äºå­˜æ”¾ä¸šåŠ¡é•œåƒ\n>\n> è®¿é—®çº§åˆ«è®¾ç½®æˆå…¬å¼€\n>\n> å­˜å‚¨å®¹é‡ä¸º-1å³ä»£è¡¨ä¸é™åˆ¶å­˜å‚¨å®¹é‡\n\n![image-20240929002628378](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/1c9300e55119c68fcdcd887228087659697559838.png)\n\n#### é¡¹ç›®é•œåƒå‡†å¤‡\n\n```\ndocker pull node:18-alpine\n#å¦‚æœä¸‹è½½ä¸äº†å¯ä»¥ç”¨æˆ‘çš„\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/node:18-alpine\ndocker tag registry.cn-hangzhou.aliyuncs.com/qianyios/node:18-alpine 192.168.48.100/library/node:18-alpine\ndocker push 192.168.48.100/library/node:18-alpine\n```\n\n#### ç¼–å†™ä¸šåŠ¡éƒ¨ç½²æ¸…å•\n\n```\n[root@master1 ~]# echo -n \"https://xiaoai.plus\" | base64\naHR0cHM6Ly94aWFvYWkucGx1cw==\n\n[root@master1 ~]# echo -n \"sk-K19c1kSqZZ92sXp13d042aD4E2B74a60B749E717Ed69449e\" | base64\n\nc2stSzE5YzFrU3FaWjkyc1hwMTNkMDQyYUQ0RTJCNzRhNjBCNzQ5RTcxN0VkNjk0NDll\n```\n\nkeyæ˜¯ChatGPTkeyï¼Œè¿™é‡Œå·²ç»å¯¹å…¶base64åŠ å¯†\n\nbaseurlæ˜¯chatgptç¬¬ä¸‰æ–¹æœåŠ¡å•†æä¾›çš„ä»£ç†åœ°å€ï¼Œè¿™é‡Œå·²ç»å¯¹å…¶base64åŠ å¯†\n\n```\ncd /root/cicd/chatgpt\nkubectl create deploy chatgpt --image=chatgpt-next-web --dry-run=client -oyaml\nkubectl create svc nodeport  chatgpt --tcp=3000:3000 --dry-run=client -oyaml >> deploy.yaml\nvim deploy.yaml\n```\n\n```\napiVersion: v1\ndata:\n  key: c2stSzE5YzFrU3FaWjkyc1hwMTNkMDQyYUQ0RTJCNzRhNjBCNzQ5RTcxN0VkNjk0NDll\n  baseurl: aHR0cHM6Ly94aWFvYWkucGx1cw==\nkind: Secret\nmetadata:\n  creationTimestamp: null\n  name: chat-config\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: chatgpt\n  name: chatgpt\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: chatgpt\n  strategy: {}\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: chatgpt\n    spec:\n      containers:\n      - image: chatgpt-next-web\n        name: chatgpt\n        ports:\n        - containerPort: 3000\n        imagePullPolicy: IfNotPresent\n        env:\n        - name: OPENAI_API_KEY\n          valueFrom:\n            secretKeyRef:\n              name: chat-config\n              key: key\n        - name: BASE_URL\n          valueFrom:\n            secretKeyRef:\n              name: chat-config\n              key: baseurl\n---\napiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: chatgpt\n  name: chatgpt\nspec:\n  ports:\n  - name: 3000-3000\n    port: 3000\n    protocol: TCP\n    targetPort: 3000\n  selector:\n    app: chatgpt\n  type: NodePort\nstatus:\n  loadBalancer: {}\n```\n\n#### ç¼–å†™é•œåƒæ„å»ºæ–‡ä»¶\n\n```\ncd /root/cicd/chatgpt\nsed -i 's|https://registry.yarnpkg.com/|https://registry.npmmirror.com/|g' yarn.lock\ncat > Dockerfile <<\"EOF\"\n# åŸºç¡€é•œåƒ\nFROM 192.168.48.100/library/node:18-alpine AS base\n\n\n# è®¾ç½®å›½å†…é•œåƒæº\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories\nRUN apk add --no-cache libc6-compat proxychains-ng\n\nWORKDIR /app\n\n# ä¾èµ–é˜¶æ®µ\nCOPY package.json yarn.lock ./\nRUN npm config set registry https://registry.npmmirror.com\nRUN yarn config set registry https://registry.npmmirror.com --global\n\n# æ›¿æ¢ yarn.lock æ–‡ä»¶ä¸­çš„æºåœ°å€\nRUN sed -i 's|https://registry.yarnpkg.com/|https://registry.npmmirror.com/|g' yarn.lock\nRUN sed -i 's|https://registry.npmjs.org/|https://registry.npmmirror.com/|g' yarn.lock\n\n# æ¸…é™¤ç¼“å­˜å¹¶å®‰è£…ä¾èµ–\nRUN yarn config list  # æŸ¥çœ‹å½“å‰çš„ Yarn é…ç½®\nRUN yarn install\n\n# æ›´æ–° caniuse-lite\nRUN npx update-browserslist-db@latest\n\n# æ„å»ºé˜¶æ®µ\nFROM base AS builder\nRUN apk update && apk add --no-cache git\nENV OPENAI_API_KEY=\"\"\nENV BASE_URL=\"\"\n\nWORKDIR /app\nCOPY . .\nRUN yarn add @svgr/webpack@latest --frozen-lockfile\nRUN yarn add sharp  # æ·»åŠ  sharp åŒ…\nRUN yarn build\n\n# è¿è¡Œé˜¶æ®µ\nFROM base AS runner\nWORKDIR /app\nRUN apk add proxychains-ng\n\nENV PROXY_URL=\"\"\nENV OPENAI_API_KEY=\"\"\nENV BASE_URL=\"\"\n\nCOPY --from=builder /app/public ./public\nCOPY --from=builder /app/.next/standalone ./\nCOPY --from=builder /app/.next/static ./.next/static\nCOPY --from=builder /app/.next/server ./.next/server\n\nEXPOSE 3000\n\nCMD if [ -n \"$PROXY_URL\" ]; then \\\n        export HOSTNAME=\"127.0.0.1\"; \\\n        protocol=$(echo $PROXY_URL | cut -d: -f1); \\\n        host=$(echo $PROXY_URL | cut -d/ -f3 | cut -d: -f1); \\\n        port=$(echo $PROXY_URL | cut -d: -f3); \\\n        conf=/etc/proxychains.conf; \\\n        echo \"strict_chain\" > $conf; \\\n        echo \"proxy_dns\" >> $conf; \\\n        echo \"remote_dns_subnet 224\" >> $conf; \\\n        echo \"tcp_read_time_out 15000\" >> $conf; \\\n        echo \"tcp_connect_time_out 8000\" >> $conf; \\\n        echo \"localnet 127.0.0.0/255.0.0.0\" >> $conf; \\\n        echo \"localnet ::1/128\" >> $conf; \\\n        echo \"[ProxyList]\" >> $conf; \\\n        echo \"$protocol $host $port\" >> $conf; \\\n        cat /etc/proxychains.conf; \\\n        proxychains -f $conf node server.js; \\\n    else \\\n        node server.js; \\\n    fi\nEOF\n```\n\n#### ç¼–å†™æµæ°´çº¿è„šæœ¬\n\n> `withCredentials` å—æ¥å¼•ç”¨ä¸€ä¸ªåä¸º `my-credentials` çš„å‡­æ®ï¼Œè¯¥å‡­æ®çš„ç±»å‹æ˜¯ç”¨æˆ·åå¯†ç ã€‚`usernameVariable` å’Œ `passwordVariable` å‚æ•°åˆ†åˆ«æŒ‡å®šäº†åœ¨ä»£ç å—ä¸­ä½¿ç”¨å‡­æ®æ—¶çš„å˜é‡åã€‚\n>\n> åœ¨ `withCredentials` å—å†…éƒ¨ï¼Œä½ å¯ä»¥æ‰§è¡Œéœ€è¦ä½¿ç”¨å‡­æ®çš„æ“ä½œï¼Œæ¯”å¦‚åœ¨ Shell è„šæœ¬ä¸­ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚\n>\n> è¯·æ³¨æ„ï¼Œ`credentialsId` å‚æ•°éœ€è¦æŒ‡å®šä½ åœ¨ Jenkins ä¸­åˆ›å»ºçš„å‡­æ®çš„ IDã€‚ç¡®ä¿å‡­æ® ID æ­£ç¡®ï¼Œå¹¶ä¸”å…·æœ‰è®¿é—®è¯¥å‡­æ®çš„æƒé™ã€‚\n>\n> ä½¿ç”¨ `withCredentials` å—å¯ä»¥ç¡®ä¿å‡­æ®çš„å®‰å…¨æ€§ï¼Œå› ä¸ºå‡­æ®çš„å€¼ä¸ä¼šæ˜æ–‡æ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­ï¼Œè€Œæ˜¯ä»¥å˜é‡çš„å½¢å¼ä¼ é€’ç»™ä»£ç å—ä¸­çš„æ“ä½œã€‚è¿™æ ·å¯ä»¥é¿å…å‡­æ®æ³„éœ²çš„é£é™©ã€‚\n>\n> ä»¥ä¸‹å†…å®¹ï¼Œè‡ªè¡Œä¿®æ”¹ï¼Œå¯¹ç…§ï¼Œæ¯ä¸€è¡Œéƒ½å»çœ‹\n>\n> Harbor-passwdæ˜¯jenkinsåˆ›å»ºçš„harborçš„ç”¨æˆ·å‡­æ®\n\n```\ncd /root/cicd/chatgpt\ncat > Jenkinsfile<<\"EOF\"\npipeline{\n    agent {\n        kubernetes {\n            inheritFrom \"jenkins-slave\"\n            yaml '''\napiVersion: v1\nkind: Pod\nmetadata:\n  name: jenkins-slave\nspec:\n  securityContext:\n    fsGroup: 0\n    runAsUser: 0\n  nodeSelector:\n    k8s-type: master\n  containers:\n  - name: jnlp\n    image: \"192.168.48.100/library/inbound-agent:latest\"\n    imagePullPolicy: IfNotPresent\n    volumeMounts:\n    - name: kubectl\n      mountPath: /usr/bin/kubectl\n    - name: kube-config\n      mountPath: /root/.kube\n    - name: docker\n      mountPath: /usr/bin/docker\n    - name: docker-sock\n      mountPath: /var/run/docker.sock\n  volumes:\n  - name: kubectl\n    hostPath:\n      path: /usr/bin/kubectl\n  - name: kube-config\n    hostPath:\n      path: /root/.kube\n  - name: docker\n    hostPath:\n      path: /usr/bin/docker\n  - name: docker-sock\n    hostPath:\n      path: /var/run/docker.sock\n'''\n        }\n    }\n    environment {\n        NPM_REGISTRY = \"https://registry.npmmirror.com/\"\n        YARN_REGISTRY = \"https://registry.npmmirror.com/\"\n    }\n    stages{\n        stage('git clone') {\n            steps {\n                sh 'git version'\n            }\n        }\n        stage('image-build'){\n            steps{\n                withCredentials([usernamePassword(credentialsId: 'Harbor-passwd', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')] {\n                    sh 'docker build -t 192.168.48.100/chatgpt/chatgpt:v1-$BUILD_NUMBER -f Dockerfile .'\n                    sh 'docker login 192.168.48.100 -u $USERNAME -p $PASSWORD'\n                    sh 'docker push 192.168.48.100/chatgpt/chatgpt:v1-$BUILD_NUMBER'\n                }\n            }\n        }\n        stage('cloud-deploy'){\n            steps{\n                sh 'sed -i \"s#chatgpt-next-web#192.168.48.100/chatgpt/chatgpt:v1-$BUILD_NUMBER#g\" deploy.yaml'\n                sh 'cat deploy.yaml'\n                sh 'kubectl get pod -A'\n                sh 'kubectl get secret,deploy,svc -A'\n                sh 'kubectl apply -f deploy.yaml'\n                sh 'kubectl get -f deploy.yaml'\n            }\n        }\n    }\n}\nEOF\n```\n\n#### é€šè¿‡gitä¸Šä¼ ä»£ç \n\n```\ncd /root/cicd/chatgpt\ngit add .\ngit commit -m \"add Jenkinsfile Dockerfile and deploy.yaml\"\ngit push -u origin main\nUsername for 'http://192.168.48.200:30880': root\nPassword for 'http://root@192.168.48.200:30880':\n```\n\n![image-20240929010336567](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/8641cf25c809b82fa7a4f086be92b13155933597.png)\n\n![image-20241111191551671](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/8d570ba3605ce1e3cf7233f1b99c6d8255933597.png)\n\n## æµ‹è¯•\n\né€šè¿‡åˆšåˆšçš„ä¸Šä¼ deploy.yamlï¼Œæµæ°´çº¿å·²ç»å¼€å§‹æ‰§è¡Œ\n\nè¿›å…¥jenkinsé¡µé¢å¯ä»¥çœ‹åˆ°jenkinså»ºçš„é¡¹ç›®æ­£åœ¨æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°å³ä¸‹è§’æœ‰ä¸€ä¸ªjenkinsä»£ç†ï¼Œè¯´æ˜æ–°å»ºäº†ä¸€ä¸ªjenkinsä»£ç†æ‰§è¡Œ\n\n![image-20241111191226574](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/13986a41cf360dcad0b1575bd025080d55933597.png)\n\n![image-20241111191618626](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/23687c5d5c1a9fdf736d50a183e851f955933597.png)\n\nHarborä»“åº“ä¹Ÿæœ‰æ„å»ºå¥½çš„é•œåƒ\n\n![image-20241111191702364](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/22dcd97b43b316bcdb3946b07ad6800955933597.png)\n\næµ‹è¯•é¡¹ç›®éƒ¨ç½²æˆåŠŸ\n\n![image-20241111191752588](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/223a7c5e6db6f6ae554840983e30777155933597.png)\n\njenkinséƒ¨ç½²æ—¥å¿—ä¹Ÿæ˜¾ç¤ºæˆåŠŸ\n\n![image-20241111191840330](../img/%E5%9F%BA%E4%BA%8EK8S%E7%9A%84CICD%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/image-20241111191840330.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Ceph","OpenEuler","Harbor","K8s","Jenkins","Gitlab"],"categories":["äº‘åŸç”Ÿ"]},{"title":"Harborå…±äº«å­˜å‚¨é«˜å¯ç”¨","url":"/posts/40301/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Harborå…±äº«å­˜å‚¨é«˜å¯ç”¨\n\n## ä¸»æœºæ‹“æ‰‘\n\n| è§’è‰²                                | ä¸»æœºå         | ip             | ç³»ç»Ÿ              | èµ„æºæœ€ä½è¦æ±‚                            |\n| ----------------------------------- | -------------- | -------------- | ----------------- | --------------------------------------- |\n| Harbor1<br />nginx<br />Keepalived1 | harbor1        | 192.168.48.106 | OpenEuler22.03LTS | CPUï¼š4æ ¸ <br />å†…å­˜ï¼š2G <br />ç¡¬ç›˜ï¼š40G |\n| Harbor2<br />nginx<br />Keepalived2 | harbor2        | 192.168.48.107 | OpenEuler22.03LTS | CPUï¼š4æ ¸ <br />å†…å­˜ï¼š2G <br />ç¡¬ç›˜ï¼š40G |\n| postgresql<br />Redis<br />NFSå…±äº«  | zujian         | 192.168.48.108 | OpenEuler22.03LTS | CPUï¼š4æ ¸ <br />å†…å­˜ï¼š2G <br />ç¡¬ç›˜ï¼š40G |\n| é«˜å¯ç”¨ip                            | 192.168.48.100 |                |                   |                                         |\n\n`ç³»ç»Ÿæ¶æ„å›¾`\n\n![image-20240430185108978](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/bbbf97d46f5255a4d83e886388f87b33697559838.png)\n\n## åŸºæœ¬é…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1ï¼Œharbour2ï¼Œzujian]\n\n```\nvi jichu_init.sh\n```\n\nå°†ä»¥ä¸‹è„šæœ¬å†…å®¹æ·»åŠ è¿›å»\n\n```\n\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens160è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\necho \"2.æ­£åœ¨å…³é—­firewalldã€dnsmasqã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl disable dnsmasq &> /dev/null\nsystemctl stop firewalld\nsystemctl stop dnsmasq\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n\necho \"3.æ­£åœ¨è®¾ç½®ens160ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens160 <<EOF\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nNAME=ens160\nUUID=53b402ff-5865-47dd-a853-7afcd6521738\nDEVICE=ens160\nONBOOT=yes\nIPADDR=192.168.48.$2\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS1=192.168.48.2\nDNS2=114.114.114.114\n\nnmcli c reload\nnmcli c up ens 160\n\necho \"4.ä¼˜åŒ–ssh\"\nsed -i \"s#\\#UseDNS yes#UseDNS no#g\" /etc/ssh/sshd_config\nsed -i \"s#GSSAPIAuthentication yes#GSSAPIAuthentication no#g\" /etc/ssh/sshd_config\nsystemctl restart sshd\n\necho \"5.æ›´æ”¹æ¬§æ‹‰æºä¸ºåä¸ºäº‘æºï¼Œé€Ÿåº¦å¿«ä¸€ç‚¹\"\nsed -i 's/\\$basearch/x86_64/g' /etc/yum.repos.d/openEuler.repo\nsed -i 's/http\\:\\/\\/repo.openeuler.org/https\\:\\/\\/mirrors.huaweicloud.com\\/openeuler/g' /etc/yum.repos.d/openEuler.repo\n\n\necho \"6.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\nyum clean all && yum makecache\ndnf update -y\n\necho \"7.ä¿®æ”¹historyæ ¼å¼åŠè®°å½•æ•°\"\nsed -i \"s#HISTSIZE=1000##g\" /etc/profile\ncat >> /etc/profile <<EOF\nshopt -s histappend\nUSER_IP=`who -u am i 2>/dev/null| awk '{print $NF}'|sed -e 's/[()]//g'`\nexport HISTFILE=~/.commandline_warrior\nexport HISTTIMEFORMAT=\"%Y-%m-%d %H:%M:%S  `whoami`@${USER_IP}: \"\nexport HISTSIZE=200000\nexport HISTFILESIZE=1000000\nexport PROMPT_COMMAND=\"history -a\"\nEOF\nsource /etc/profile\n\n\necho \"8.æ·»åŠ hostsè§£æ\"\ncat > /etc/hosts <<EOF\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.106 harbor1\n192.168.48.107 harbor2\n192.168.48.108 zujian\nEOF\n\n\necho \"10.å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\"\ndnf install chrony -y\nsystemctl start chronyd\nsystemctl enable chronyd\nchronyc sources\nchronyc sources\n\necho \"11ã€å®‰è£…ä¾èµ–åŒ…\"\ndnf install -y cmake gcc gcc-c++ perl readline readline-devel openssl openssl-devel zlib zlib-devel ncurses-devel readline readline-devel zlib zlib-devel\n\nreboot\n```\n\n\n\n```\næ‰§è¡Œè„šæœ¬å‘½ä»¤æ ¼å¼ï¼šsh jichu_init.sh ä¸»æœºå ä¸»æœºä½\n[harbor1] sh jichu_init.sh harbor1 106\n\n[harbor2] sh jichu_init.sh harbor2 107\n\n[zujian] sh jichu_init.sh zujian 108\n\n```\n\né…ç½®sshå…å¯†\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1ï¼Œharbour2ï¼Œzujian]\n\n```\ndnf install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"harbor1\" \"harbor2\" \"zujian\")\n# å¯†ç \npassword=\"Lj201840.\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## å®‰è£…é«˜å¯ç”¨ç»„ä»¶\n\næ“ä½œèŠ‚ç‚¹:[harbor1ï¼Œharbour2]\n\n```\ndnf install -y keepalived nginx\n```\n\n### å®‰è£…nginx\n\næ“ä½œèŠ‚ç‚¹:[harbor1ï¼Œharbour2]\n\n```\ncat > /etc/nginx/nginx.conf <<\"EOF\"\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log notice;\npid /run/nginx.pid;\ninclude /usr/share/nginx/modules/*.conf;\nevents {\n    worker_connections 1024;\n}\nstream {\n    log_format  main  '$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent';\n    access_log  /var/log/nginx/harbor-access.log  main;\n    upstream harbor{\n       server 192.168.48.106:8081;   #harbor1\n       server 192.168.48.107:8081;   #harbor2\n    }\n    server {\n       listen  80;\n       proxy_pass harbor;\n    }\n}\nhttp {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n    access_log  /var/log/nginx/access.log  main;\n    sendfile            on;\n    tcp_nopush          on;\n    keepalive_timeout   65;\n    types_hash_max_size 4096;\n    include             /etc/nginx/mime.types;\n    default_type        application/octet-stream;\n    \n    include /etc/nginx/conf.d/*.conf;\n    server {\n        listen       8888 default_server;\n        server_name  _;\n        location / {\n        }\n    }\n}\nEOF\nsystemctl enable --now nginx\nnginx -s reload\n```\n\n\n\n### å®‰è£…å®‰è£…keepalived\n\næ“ä½œèŠ‚ç‚¹:[harbor1]\n\n```\ncat >/etc/keepalived/keepalived.conf << \"EOF\"\n! Configuration File for keepalived\n\nglobal_defs {\n   notification_email {\n     qianyios@qq.com\n   }\n   router_id harbor1\n}\n\nvrrp_instance zh {\n    state MASTER\n    interface ens160\n    mcast_src_ip 192.168.48.106\n    virtual_router_id 107\n    priority 100\n    advert_int 1\n    nopreempt\n    authentication {\n        auth_type PASS\n        auth_pass 1111\n    }\n    virtual_ipaddress {\n        192.168.48.100/24\n    }\n    track_script {\n        chk_nginx\n    }\n}\nvrrp_script chk_nginx {\n    script \"/etc/keepalived/check_nginx.sh\"\n    interval 2\n    weight -20\n}\nEOF\n```\n\n\n\næ“ä½œèŠ‚ç‚¹:[harbor2]\n\n```\ncat >/etc/keepalived/keepalived.conf << \"EOF\"\n! Configuration File for keepalived\n\nglobal_defs {\n   notification_email {\n     qianyios@qq.com\n   }\n   router_id harbor2\n}\n\nvrrp_instance zh {\n    state BACKUP\n    interface ens160\n    mcast_src_ip 192.168.48.107\n    virtual_router_id 107\n    priority 99\n    advert_int 1\n    nopreempt\n    authentication {\n        auth_type PASS\n        auth_pass 1111\n    }\n    virtual_ipaddress {\n        192.168.48.100/24\n    }\n    track_script {\n        chk_nginx\n    }\n}\nvrrp_script chk_nginx {\n    script \"/etc/keepalived/check_nginx.sh\"\n    interval 2\n    weight -20\n}\nEOF\n```\n\n\n\né…ç½®æ£€æŸ¥è„šæœ¬\n\næ“ä½œèŠ‚ç‚¹:[harbor1ï¼Œharbour2]\n\n```\ncat >/etc/keepalived/check_nginx.sh <<\"EOF\"\n#!/bin/bash\ncounter=`ps -C nginx --no-header | wc -l`\nif [ $counter -eq 0 ]; then\n    systemctl start nginx\n    sleep 2\n    counter=`ps -C nginx --no-header | wc -l`\n    if [ $counter -eq 0 ]; then\n        systemctl stop keepalived\n    fi\nfi\n\nEOF\n```\n\nå¯åŠ¨æœåŠ¡\n\n```\nsystemctl enable --now nginx keepalived\nnginx -s reload\n```\n\næŸ¥çœ‹VIPè™šæ‹Ÿip\n\n```\n[root@harbor1 ~]# ip a\n.............\n2: ens160: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether 00:0c:29:af:76:8c brd ff:ff:ff:ff:ff:ff\n    inet 192.168.48.106/24 brd 192.168.48.255 scope global noprefixroute ens160\n       valid_lft forever preferred_lft forever\n    inet 192.168.48.100/24 scope global secondary ens160   ###192.168.48.100/24å°±æ˜¯åˆšåˆšè®¾ç½®çš„é«˜å¯ç”¨ip\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:feaf:768c/64 scope link noprefixroute\n       valid_lft forever preferred_lft forever\n\n```\n\n## å®‰è£…postgresql\n\næ“ä½œèŠ‚ç‚¹ï¼š[zujian]\n\n### å®‰è£…\n\n```\n#åˆ›å»ºpostgresç”¨æˆ·\nuseradd postgres\npasswd postgres\n#è®¾ç½®å¯†ç 123456\n\n\n#ç¼–è¯‘å®‰è£…postgresql\nwget https://ftp.postgresql.org/pub/source/v16.2/postgresql-16.2.tar.gz\ntar zxvf postgresql-16.2.tar.gz -C /usr/local/bin/\ncd /usr/local/bin/postgresql-16.2/\n./configure --prefix=/usr/local/postgresql\nmake && make install\n\n#å»ºç«‹æ•°æ®ç›®å½•\nmkdir -p /data/postgresql/data\n#åˆ›å»ºæ—¥å¿—ç›®å½•\nmkdir -p /data/postgresql/log\n#åˆ›å»ºsocketç›®å½•\nmkdir -p /data/postgresql/tmp\n#æˆæƒ\nchown -R postgres:postgres /usr/local/postgresql/\nchown -R postgres:postgres /data/postgresql\n\n#è®¾ç½®postgresç¯å¢ƒ\nsu - postgres\ncd\ncat << \"EOF\" >> ~/.bash_profile\nPGHOME=/usr/local/postgresql\nexport PGHOME\nPGDATA=/data/postgresql/data\nexport PGDATA\nPATH=$PATH:$HOME/bin:$HOME/.local/bin:$PGHOME/bin\nexport PATH\nEOF\nsource ~/.bash_profile\npsql -V\n\n#åˆå§‹åŒ–æ•°æ®åº“\ninitdb --username=postgres -D /data/postgresql/data\n#ä¼šæœ‰Success. You can now start the database server using:      #è¡¨ç¤ºåˆå§‹åŒ–æˆåŠŸ\n\n\n#ä¿®æ”¹åˆå§‹åŒ–çš„é…ç½®æ–‡ä»¶\ncat > /data/postgresql/data/postgresql.conf << \"EOF\"\nmax_connections = 100                   # å…è®¸æœ€å¤§è¿æ¥æ•°\nshared_buffers = 128MB                  # å†…å­˜å¤§å°\ndynamic_shared_memory_type = posix      # the default is usually the first option\nmax_wal_size = 1GB\nmin_wal_size = 80MB\nlog_timezone = 'Asia/Shanghai'\ndatestyle = 'iso, mdy'\ntimezone = 'Asia/Shanghai'\nlc_messages = 'en_US.UTF-8'             # locale for system error message\nlc_monetary = 'en_US.UTF-8'             # locale for monetary formatting\nlc_numeric = 'en_US.UTF-8'              # locale for number formatting\nlc_time = 'en_US.UTF-8'                 # locale for time formatting\ndefault_text_search_config = 'pg_catalog.english'\nlisten_addresses = '*' #ç›‘å¬æ‰€æœ‰åœ°å€\ndata_directory = '/data/postgresql/data'  # æ•°æ®ç›®å½•æŒ‡å®š\nport = 5432\nunix_socket_directories = '/data/postgresql/tmp'\nunix_socket_group = ''\nunix_socket_permissions = 0777\nlogging_collector = on\nlog_directory = '/data/postgresql/log'\nlog_rotation_size = 1GB\nlog_timezone = 'Asia/Shanghai'\nlog_min_duration_statement = 100\n\nEOF\n#è®¾ç½®è¿œç¨‹è¿æ¥\ncat >> /data/postgresql/data/pg_hba.conf << EOF\nlocal   all             all                                     trust\nhost    all             all             0.0.0.0/0               password\nhost    all             all             ::1/128                 password\nhost    all             postgres             0.0.0.0/0           trust\nEOF\n\n\n#å¯åŠ¨PostgreSQL\npg_ctl -D /data/postgresql/data -l logfile start\n\n```\n\n### è¿›å…¥æ•°æ®åº“\n\n```\npsql -h 127.0.0.1 -p 5432 -U postgres\n\npostgres=# \\password\nEnter new password for user \"postgres\":\nEnter it again:\n#è¾“å…¥å¯†ç 123456\npostgres=# exit\n\n#é‡æ–°å¯åŠ¨\npg_ctl -D /data/postgresql/data -l /data/postgresql/data/postgresql.log restart\n\n#æç¤ºä¸€ä¸‹ä¿¡æ¯æˆåŠŸï¼ˆä¸æ˜¯å‘½ä»¤å“ˆï¼Œä¸è¦å»è¿è¡Œï¼‰\npg_ctl: old server process (PID: 25461) seems to be gone\nstarting server anyway\nwaiting for server to start.... done\nserver started\n\npsql -h 127.0.0.1 -p 5432 -U postgres\n#è¾“å…¥å¯†ç 123456\n\nCREATE DATABASE registry;\nCREATE DATABASE notary_signer;\nCREATE DATABASE notary_servers;\n\\l\ncreate user server with password '123456';\ncreate user signer with password '123456';\n\\du\nGRANT ALL PRIVILEGES ON DATABASE registry to postgres;   \nGRANT ALL PRIVILEGES ON DATABASE notary_signer to postgres;   \nGRANT ALL PRIVILEGES ON DATABASE notary_servers to postgres;   \nexit\n```\n\n![image-20240421010122073](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/7c0a0a771ab21ffe0c5347b8e7bc0739697559838.png)\n\n![image-20240421010045648](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/9716f9bd02ccfaf957d1da80f1ed6b71697559838.png)\n\n### è®¾ç½®å¯åŠ¨æœåŠ¡\n\næ“ä½œèŠ‚ç‚¹[zujian]\n\n```\n#å›åˆ°rootç”¨æˆ·ä¸‹æ‰§è¡Œ\nsu - root\ncat >/etc/init.d/PG-start.sh<< \"EOF\"\nsudo -u postgres /usr/local/postgresql/bin/pg_ctl -D /data/postgresql/data start\nEOF\n\ncat >/etc/init.d/PG-stop.sh<< \"EOF\"\nsudo -u postgres /usr/local/postgresql/bin/pg_ctl -D /data/postgresql/data stop\nEOF\n\ncat >/etc/init.d/PG-restart.sh<<\"EOF\"\nsudo -u postgres /usr/local/postgresql/bin/pg_ctl -D /data/postgresql/data restart\nEOF\n\nsudo chmod +x /etc/init.d/PG-start.sh\nsudo chmod +x /etc/init.d/PG-stop.sh\nsudo chmod +x /etc/init.d/PG-restart.sh\n\ncat >/etc/systemd/system/postgresql.service << \"EOF\"\n[Unit]\nDescription=postgresql Service\n\n[Service]\nType=oneshot\nuser=root\nRemainAfterExit=true\nExecStart=/usr/bin/sudo /etc/init.d/PG-start.sh\nExecStop=/usr/bin/sudo /etc/init.d/PG-stop.sh\nExecRestart=/usr/bin/sudo /etc/init.d/PG-restart.sh\n\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl daemon-reload\nsystemctl enable --now postgresql\n\n```\n\né”™è¯¯ç§¯ç´¯\n\n```\n#æ¯æ¬¡æˆ‘å¯åŠ¨pgsqlçš„æ—¶å€™å°±æœ‰è¿™ä¸ªä¸œè¥¿\n\n2024-09-14 14:34:03.196 CST [17746] HINT:  Is another postmaster (PID 16042) running in data directory \"/data/postgresql/data\"?\n stopped waiting\npg_ctl: could not start server\n\n#æ„æ€æ˜¯æœ‰ä¸ªpidè¿›ç¨‹åœ¨è¿è¡Œï¼Œæ€æ‰å®ƒå°±è¡Œäº†\nsudo kill -9 16042\n```\n\n## å®‰è£…redis\n\næ“ä½œèŠ‚ç‚¹ï¼š[zujian]\n\n### å®‰è£…redis\n\n```\nwget https://download.redis.io/releases/redis-7.2.4.tar.gz\ntar zxvf redis-7.2.4.tar.gz \nmv redis-7.2.4 /usr/local/bin/\ncd /usr/local/bin/redis-7.2.4\nmake && make install\n```\n\n### ä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```\nvi /usr/local/bin/redis-7.2.4/redis.conf\n\n#bind 127.0.0.1 -::1 Â #æ³¨é‡Šæ‰bindçš„è¡Œï¼Œå…è®¸ä»»ä½•ä¸»æœºè¿æ¥ï¼›\ndaemonizeÂ yesÂ Â Â Â Â Â Â #å°†noä¿®æ”¹ä¸ºyesï¼Œä½¿rediså¯ä»¥ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹æ–¹å¼å¯åŠ¨ï¼›\nrequirepassÂ 123456Â Â Â #æ·»åŠ è¿™è¡Œï¼Œè®¾ç½®redisè¿æ¥çš„authå¯†ç ï¼ˆ123456ï¼‰\nprotected-mode no  #ç¦ç”¨ä¿æŠ¤æ¨¡å¼\n\nä»¥ä¸‹æ˜¯ä¸€æ­¥åˆ°ä½å°†ä»¥ä¸Šå››ä¸ªå‘½ä»¤å…¨éƒ¨å®ç°\nsed -i 's/^bind 127.0.0.1 -::1/#bind 127.0.0.1 -::1/' /usr/local/bin/redis-7.2.4/redis.conf\nsed -i 's/^daemonize no/daemonize yes/' /usr/local/bin/redis-7.2.4/redis.conf\necho -e \"\\nrequirepass 123456\" >> /usr/local/bin/redis-7.2.4/redis.conf\nsed -i 's/^protected-mode yes/protected-mode no/' /usr/local/bin/redis-7.2.4/redis.conf\n\n```\n\n### å¯åŠ¨æœåŠ¡\n\n```\nredis-server redis.conf\n```\n\n```\n[root@zujian redis-7.2.4]# redis-server redis.conf\n2226:C 20 Apr 2024 17:10:45.039 # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n```\n\nRedisåœ¨å¯åŠ¨æ—¶å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æ—¥å¿—ï¼šåœ¨åˆ†æè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œ é¦–å…ˆè¦å¼„æ¸…æ¥šä»€ä¹ˆæ˜¯overcommitï¼Ÿ `Linuxæ“ä½œç³»ç»Ÿå¯¹å¤§éƒ¨åˆ†ç”³è¯·å†…å­˜çš„è¯·æ±‚éƒ½å›å¤yes`ï¼Œ` ä»¥ä¾¿èƒ½è¿è¡Œæ›´å¤šçš„ç¨‹åº`ã€‚ å› ä¸ºç”³è¯·å†…å­˜åï¼Œ å¹¶ä¸ä¼šé©¬ä¸Šä½¿ç”¨å†…å­˜ï¼Œ è¿™ç§æŠ€æœ¯å«åš`overcommit`ã€‚å¦‚æœRedisåœ¨å¯åŠ¨æ—¶æœ‰ä¸Šé¢çš„æ—¥å¿—ï¼Œ è¯´æ˜vm.overcommit_memory=0ï¼Œ Redisæç¤ºæŠŠå®ƒè®¾ç½®ä¸º1ã€‚\nvm.overcommit_memoryç”¨æ¥è®¾ç½®å†…å­˜åˆ†é…ç­–ç•¥ï¼Œ æœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼Œ å¦‚è¡¨ï¼šå¯ç”¨å†…å­˜ä»£è¡¨ç‰©ç†å†…å­˜ä¸swapä¹‹å’Œ\n\n![image-20240420171525086](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/de0356ab6f8115130d1a379524ade373697559838.png)\n\nè§£å†³åŠæ³•ï¼š\n\n```\necho \"vm.overcommit_memory=1\" >> /etc/sysctl.conf\nsysctl vm.overcommit_memory=1\nredis-server redis.conf\n```\n\nå†é‡æ–°å¯åŠ¨å°±å¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬å’Œç«¯å£å·äº†\n\n```shell\n[root@zujian redis-7.2.4]# redis-cli -v\nredis-cli 7.2.4\n[root@zujian redis-7.2.4]# ps aux |grep 6379\nroot        2227  0.0  0.3  68412 10888 ?        Ssl  17:10   0:00 redis-server *:6379\nroot        5427  0.0  0.0  22096  2300 pts/0    S+   17:19   0:00 grep --color=auto 6379\n#redis-serveræœ‰è¿™ä¸ªå°±è¡Œ\n```\n\nå…³é—­æœåŠ¡ï¼ˆåªæ˜¯æ™®åŠçŸ¥è¯†ï¼Œæµ‹è¯•å¯ç”¨ï¼Œä¸è¦éšæ„å…³é—­ï¼‰\n\n```\nredis-cli shutdown\n```\n\n### å®¢æˆ·ç«¯è¿æ¥redis\n\næ“ä½œèŠ‚ç‚¹ï¼š[zujian]\n\nå°†redis-cliçš„å·¥å…·å¤åˆ¶åˆ°Harbor1ï¼Œharbor2\n\næŸ¥çœ‹redis-cliå·¥å…·ä½ç½®\n\n```\n[root@zujian]# which redis-cli\n/usr/local/bin/redis-cli\n```\n\nå¤åˆ¶\n\n```\nwhich redis-cli\nscp /usr/local/bin/redis-cli harbor1:/usr/local/bin/\nscp /usr/local/bin/redis-cli harbor2:/usr/local/bin/\n```\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1,harbor2]\n\n```\nredis-cli -h 192.168.48.108 -p 6379 -a 123456\n```\n\n![image-20240420232245510](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/f6e078d51551d5805c25eaf9282418c9697559838.png)\n\n![image-20240420232257725](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/b51dc2d41ba515a7cbe4b11f86158148697559838.png)\n\nåˆ°æ­¤rediså®‰è£…æˆåŠŸ\n\n### è®¾ç½®å¯åŠ¨æœåŠ¡\n\n```\ncat >/etc/init.d/redis-start.sh<< \"EOF\"\n/usr/local/bin/redis-server /usr/local/bin/redis-7.2.4/redis.conf\nEOF\ncat >/etc/init.d/redis-stop.sh<< \"EOF\"\n/usr/local/bin/redis-cli -a 123456 shutdown\nEOF\n\nsudo chmod +x /etc/init.d/redis-start.sh\nsudo chmod +x /etc/init.d/redis-stop.sh\n\ncat >/etc/systemd/system/redis.service << \"EOF\"\n[Unit]\nDescription=redis Service\n\n[Service]\nType=oneshot\nuser=root\nRemainAfterExit=true\nExecStart=/usr/bin/sudo /etc/init.d/redis-start.sh\nExecStop=/usr/bin/sudo /etc/init.d/redis-stop.sh\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl daemon-reload\nsystemctl enable --now redis\n```\n\n## NFSå…±äº«å­˜å‚¨å®‰è£…\n\næ“ä½œèŠ‚ç‚¹ï¼š[zujian]\n\n```\ndnf install -y nfs-utils\nsystemctl enable --now nfs\n#åˆ›å»ºè¿œç¨‹å…±äº«ç›®å½•\nmkdir -p /data/harbor_data\n\ncat >> /etc/exports << \"EOF\"\n/data/harbor_data 192.168.48.0/24(rw,no_root_squash)\nEOF\n#ä½¿é…ç½®ç”Ÿæ•ˆ\nexportfs -arv\n\n#ç”Ÿæ•ˆç»“æœ\n[root@zujian ~]# showmount -e\nExport list for zujian:\n/data/harbor_data 192.168.48.0/24\n\n```\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1,harbor2]\n\nHarbor1ã€harbor2æœºå™¨ä¸Šå®‰è£…nfs-utilså®¢æˆ·ç«¯å¹¶æŒ‚è½½å…±äº«å­˜å‚¨\n\n```\ndnf install -y nfs-utils\nsystemctl enable --now nfs\nmkdir -p /data/harbor_data\ncat >>/etc/fstab<<\"EOF\"\n192.168.48.108:/data/harbor_data /data/harbor_data nfs defaults 0 0\nEOF\nmount -a\ndf -h | grep harbor\n#ä»¥ä¸‹æ˜¯æŒ‚è½½æˆåŠŸ\n[root@harbor1 ~]# df -h | grep harbor\n192.168.48.108:/data/harbor_data   63G  3.0G   57G   6% /data/harbor_data\n\n[root@harbor2 ~]# df -h | grep harbor\n192.168.48.108:/data/harbor_data   63G  3.0G   57G   6% /data/harbor_data\n\n```\n\n## harborä»“åº“å®‰è£…\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1,harbor2]\n\n### å®‰è£…docker\n\n```\nwget https://download.docker.com/linux/static/stable/x86_64/docker-26.0.1.tgz\ntar xf docker-*.tgz\ncp docker/* /usr/bin/\n#åˆ›å»ºcontainerdçš„serviceæ–‡ä»¶,å¹¶ä¸”å¯åŠ¨\ncat >/etc/systemd/system/containerd.service <<EOF\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=1048576\nTasksMax=infinity\nOOMScoreAdjust=-999\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl enable --now containerd.service\n\n#å‡†å¤‡dockerçš„serviceæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.service <<EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service containerd.service\nWants=network-online.target\nRequires=docker.socket containerd.service\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\nOOMScoreAdjust=-500\n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å‡†å¤‡dockerçš„socketæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.socket <<EOF\n[Unit]\nDescription=Docker Socket for the API\n[Socket]\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n[Install]\nWantedBy=sockets.target\nEOF\ngroupadd docker\n\nsystemctl enable --now docker.socket  && systemctl enable --now docker.service\n\n\n#éªŒè¯\nmkdir /etc/docker\ncat >/etc/docker/daemon.json <<EOF\n{\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"registry-mirrors\": [\n    \"https://docker.mirrors.ustc.edu.cn\",\n    \"http://hub-mirror.c.163.com\",\n    \"https://pw860av8.mirror.aliyuncs.com\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"500m\",\n    \"max-file\": \"3\"\n    },\n  \"data-root\": \"/var/lib/docker\"\n}\nEOF\nsystemctl restart docker\ndocker -v\n\n```\n\n### å®‰è£…docker-compose\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1,harbor2]\n\n```\nwget https://github.com/docker/compose/releases/download/v2.26.1/docker-compose-linux-x86_64\nmv docker-compose-linux-x86_64 /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\ndocker-compose version\n```\n\n### é…ç½®å†…æ ¸å‚æ•°å¹¶ä½¿ä¹‹ç”Ÿæ•ˆ\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1,harbor2]\n\n```\nmodprobe br_netfilter\ncat >> /etc/sysctl.conf <<EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1 #è·¯ç”±è½¬å‘\nEOF\nsysctl -p\n```\n\n### ä¸‹è½½harboråŒ…å¹¶é…ç½®æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1,harbor2]\n\nä¸‹è½½ç¦»çº¿åŒ…offlineå­—æ ·\n\n```\nwget https://github.com/goharbor/harbor/releases/download/v2.9.4/harbor-offline-installer-v2.9.4.tgz\ntar zxvf harbor-offline-installer-v2.9.4.tgz\nmv harbor /var/\ncd /var/harbor/\n\n[root@harbor1 harbor]# ls\ncommon.sh  harbor.v2.9.4.tar.gz  harbor.yml.tmpl  install.sh  LICENSE  prepare\n\ncp harbor.yml.tmpl harbor.yml\n```\n\né…ç½®harboræ–‡ä»¶\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹ï¼š[harbor1]</font>\n\n```\nvi /var/harbor/harbor.yml\n```\n\n```yml\nhostname: 192.168.48.106  #harbor1\nhttp:\n  port: 8081\n  \n#https:       #å…ˆæ³¨é‡Šhttpsåè®®ï¼Œåé¢å†å®ç°\n # port: 443\n # certificate: /your/certificate/path\n # private_key: /your/private/key/path\n\n## å¯ç”¨å¤–éƒ¨ä»£ç†ï¼Œå¯ç”¨åhostnameå°†ä¸å†ä½¿ç”¨\nexternal_url: https://192.168.48.100\n\n#harboré¡µé¢å¯†ç \nharbor_admin_password: Harbor12345\n\n\n#é…ç½®NFSå…±äº«å­˜å‚¨\ndata_volume: /data/harbor_data\n_version: 2.9.0\n#é…ç½®æ•°æ®åº“\nexternal_database:\n  harbor:\n    host: 192.168.48.108  # æ•°æ®åº“ä¸»æœºåœ°å€\n    port: 5432              # æ•°æ®åº“ç«¯å£\n    db_name: registry    # æ•°æ®åº“åç§°\n    username: postgres        # è¿æ¥è¯¥æ•°æ®åº“çš„ç”¨æˆ·å\n    password: 123456    # è¿æ¥æ•°æ®åº“çš„å¯†ç \n    ssl_mode: disable\n    max_idle_conns: 50\n    max_open_conns: 100\n  notary_server:\n    host: 192.168.48.108\n    port: 5432\n    db_name: notary_server\n    username: postgres\n    password: 123456\n    ssl_mode: disable\n  notary_signer:\n    host: 192.168.48.108\n    port: 5432\n    db_name: notary_signer\n    username: postgres\n    password: 123456\n    ssl_mode: disable \n#é…ç½®redis\nexternal_redis:\n  host: 192.168.48.108:6379 #redisæœåŠ¡IPåœ°å€å’Œç«¯å£å·\n  password: 123456   #è¿æ¥å¤–éƒ¨redisæœåŠ¡çš„å¯†ç \n  registry_db_index: 1  \n  jobservice_db_index: 2 #jobæœåŠ¡çš„æ•°æ®åº“ç´¢å¼•\n  chartmuseum_db_index: 3  #chartmuseumæ’ä»¶çš„Redisç´¢å¼•\n  trivy_db_index: 5   #Trivyæ‰«æå™¨çš„æ•°æ®ç´¢å¼•\n  idle_timeout_seconds: 30  #è¶…æ—¶æ—¶é—´\n\n#å¯ç”¨metricsæ•°æ®é‡‡é›†æ’ä»¶\nmetric:\n  enabled: false\n  port: 9090\n  path: /metrics\n\ntrivy:\n  ignore_unfixed: false\n  skip_update: false\n  skip_java_db_update: false\n  offline_scan: false\n  security_check: vuln\n  insecure: false\njobservice:\n  max_job_workers: 10\n  job_loggers:\n    - STD_OUTPUT\n    - FILE\n  logger_sweeper_duration: 1 #days\nnotification:\n  webhook_job_max_retry: 3\n  webhook_job_http_client_timeout: 3 #seconds\nlog:\n  level: info\n  local:\n    rotate_count: 50\n    rotate_size: 200M\n    location: /var/log/harbor\nproxy:\n  http_proxy:\n  https_proxy:\n  no_proxy:\n  components:\n    - core\n    - jobservice\n    - trivy\nupload_purging:\n  enabled: true\n  age: 168h\n  interval: 24h\n  dryrun: false\ncache:\n  enabled: false\n  expire_hours: 24\n```\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹ï¼š[harbor2]</font>\n\n```\nvi /var/harbor/harbor.yml\n```\n\n```yaml\nhostname: 192.168.48.107  #harbor2\nhttp:\n  port: 8081\n  \n#https:       #å…ˆæ³¨é‡Šhttpsåè®®ï¼Œåé¢å†å®ç°\n # port: 443\n # certificate: /your/certificate/path\n # private_key: /your/private/key/path\n\n## å¯ç”¨å¤–éƒ¨ä»£ç†ï¼Œå¯ç”¨åhostnameå°†ä¸å†ä½¿ç”¨\nexternal_url: https://192.168.48.100\n\n#harboré¡µé¢å¯†ç \nharbor_admin_password: Harbor12345\n\n#é…ç½®NFSå…±äº«å­˜å‚¨\ndata_volume: /data/harbor_data\n_version: 2.9.0\n#é…ç½®æ•°æ®åº“\nexternal_database:\n  harbor:\n    host: 192.168.48.108  # æ•°æ®åº“ä¸»æœºåœ°å€\n    port: 5432              # æ•°æ®åº“ç«¯å£\n    db_name: registry    # æ•°æ®åº“åç§°\n    username: postgres        # è¿æ¥è¯¥æ•°æ®åº“çš„ç”¨æˆ·å\n    password: 123456    # è¿æ¥æ•°æ®åº“çš„å¯†ç \n    ssl_mode: disable\n    max_idle_conns: 2\n    max_open_conns: 0\nnotary_server:\n  host: 192.168.48.108\n  port: 5432\n  db_name: notary_server\n  username: postgres\n  password: 123456\n  ssl_mode: disable\nnotary_signer:\n  host: 192.168.48.108\n  port: 5432\n  db_name: notary_signer\n  username: postgres\n  password: 123456\n  ssl_mode: disable \n#é…ç½®redis\nexternal_redis:\n  host: 192.168.48.108:6379 #redisæœåŠ¡IPåœ°å€å’Œç«¯å£å·\n  password: 123456   #è¿æ¥å¤–éƒ¨redisæœåŠ¡çš„å¯†ç \n  registry_db_index: 1  \n  jobservice_db_index: 2 #jobæœåŠ¡çš„æ•°æ®åº“ç´¢å¼•\n  chartmuseum_db_index: 3  #chartmuseumæ’ä»¶çš„Redisç´¢å¼•\n  trivy_db_index: 5   #Trivyæ‰«æå™¨çš„æ•°æ®ç´¢å¼•\n  idle_timeout_seconds: 30  #è¶…æ—¶æ—¶é—´\n\n#å¯ç”¨metricsæ•°æ®é‡‡é›†æ’ä»¶\nmetric:\n  enabled: false\n  port: 9090\n  path: /metrics\n\ntrivy:\n  ignore_unfixed: false\n  skip_update: false\n  skip_java_db_update: false\n  offline_scan: false\n  security_check: vuln\n  insecure: false\njobservice:\n  max_job_workers: 10\n  job_loggers:\n    - STD_OUTPUT\n    - FILE\n  logger_sweeper_duration: 1 #days\nnotification:\n  webhook_job_max_retry: 3\n  webhook_job_http_client_timeout: 3 #seconds\nlog:\n  level: info\n  local:\n    rotate_count: 50\n    rotate_size: 200M\n    location: /var/log/harbor\nproxy:\n  http_proxy:\n  https_proxy:\n  no_proxy:\n  components:\n    - core\n    - jobservice\n    - trivy\nupload_purging:\n  enabled: true\n  age: 168h\n  interval: 24h\n  dryrun: false\ncache:\n  enabled: false\n  expire_hours: 24\n```\n\n### å°†é…ç½®æ–‡ä»¶æ³¨å…¥åˆ°å„çº§ä»¶ä¸­å¹¶å®‰è£…\n\nå…ˆæå‰ä¸‹è½½é•œåƒå§ï¼Œè¿™é‡Œç”¨åšä¸»æ„å»ºçš„é•œåƒé€Ÿåº¦ä¼šå¿«ä¸€ç‚¹\n\n```\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/prepare:v2.9.4\ndocker tag registry.cn-hangzhou.aliyuncs.com/qianyios/prepare:v2.9.4 goharbor/prepare:v2.9.4\n```\n\nå¼€å§‹æ³¨å…¥\n\n```\ncd /var/harbor/\n./prepare\n```\n\n![image-20240420230001756](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/a93d124f3f2f71fe2c608ef2859ee748697559838.png)\n\nå¼€å§‹å®‰è£…\n\n```\ncd /var/harbor/\n./install.sh\n```\n\n![image-20240420230138644](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/7f5f1281ed43826bd2b9f0176373f41d697559838.png)\n\n### é…ç½®è‡ªå¯åŠ¨\n\n```\ncat >/usr/lib/systemd/system/harbor.service << \"EOF\"\n[Unit]\nDescription=Harbor\nAfter=docker.service systemd-networkd.service systemd-resolved.service nfs-server.service\nRequires=docker.service\nDocumentation=http://github.com/vmware/harbor\n[Service]\nType=simple\nRestart=on-failure\nRestartSec=5\nExecStart=/usr/local/bin/docker-compose -f /var/harbor/docker-compose.yml up\nExecStop=/usr/local/bin/docker-compose -f /var/harbor/docker-compose.yml down\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl daemon-reload\nsystemctl enable harbor --now\n```\n\n`å¤§å‘æ¥äº†ï¼Œä¹‹å‰æ‰¾äº†ä¸¤ä¸ªæ˜ŸæœŸéƒ½æ²¡è§£å†³çš„`\n\nåˆ°æ­¤ï¼Œharborå®‰è£…å®Œæˆï¼Œ`ä½†æ˜¯ä½ åœ¨ç½‘é¡µå¯èƒ½ä¼šå‡ºç°ä¸èƒ½ç”¨adminç™»å…¥ï¼Œä¼šæ˜¾ç¤ºå¯†ç é”™è¯¯`ä½ éœ€è¦è¿›è¡Œä¸‹ä¸€æ­¥å®‰è£…è¯ä¹¦\n\nåŸå› ï¼šé¦–å…ˆpgæ•°æ®åº“åœ¨å®‰è£…harboræ—¶åˆ›å»ºçš„adminæ˜¯ç”¨sha256åè®®åŠ å¯†çš„\n\n![image-20240430182121148](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/cfdab591f116133f0e3db41a0992bd9f697559838.png)\n\nè€Œåœ¨æˆ‘ä»¬harboré¡µé¢ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰é…ç½®sslè¯ä¹¦ï¼Œæ˜¯httpæ–¹å¼è®¿é—®å¹¶æ²¡æœ‰sha256åŠ å¯†åè®®ï¼Œæ„å‘³ç€harborå†ç™»å…¥çš„æ—¶å€™ï¼Œä¼šå‡ºç°å¯†ç é”™è¯¯ï¼Œå°±æ˜¯ï¼šç½‘é¡µç™»å…¥éªŒè¯`===/===`pgæ•°æ®åº“éªŒè¯ï¼Œé…ç½®opensslè¯ä¹¦ï¼Œå¯ä»¥è§£å†³æ­¤é—®é¢˜,opensslåŒ…å«sha256åè®®ï¼Œè¿™æ ·å°±å¯ä»¥ç™»å…¥äº†ã€‚\n\nOpenSSLæ˜¯ä¸€ä¸ª`å¼ºå¤§çš„åŠ å¯†åº“`ï¼Œå¹¿æ³›åº”ç”¨äºäº’è”ç½‘çš„å„ä¸ªè§’è½ï¼Œç”¨äºä¿æŠ¤æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚å®ƒå®ç°äº†SSLå’ŒTLSåè®®ï¼Œè¿™äº›åè®®æ˜¯ç°ä»£ç½‘ç»œå®‰å…¨çš„åŸºçŸ³ã€‚\n\n## é…ç½®sslè¯ä¹¦\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1,harbor2]\n\n### ç”Ÿæˆcaè¯ä¹¦\n\nåˆ›å»ºä¸€ä¸ªæ”¾ç½®è¯ä¹¦ç›¸å…³çš„ç›®å½•ï¼Œå¹¶ä½¿ç”¨cdè¿›å…¥è¯¥ç›®å½•\n\n```\nmkdir /var/harbor/cert&& cd  /var/harbor/cert\n## 1. ç”ŸæˆCAè¯ä¹¦ç§é’¥\nopenssl genrsa -out ca.key 4096\n## 2. ç”ŸæˆCAè¯ä¹¦ï¼Œå¯è°ƒæ•´ -subj é€‰é¡¹æ¥è¡¨æ˜åŸŸååç§°ç­‰ä¿¡æ¯\nopenssl req -x509 -new -nodes -sha512 -days 3650 \\\n -subj \"/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=192.168.48.100\" \\\n -key ca.key \\\n -out ca.crt\n```\n\n### ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦\n\nè®¤è¯è¯ä¹¦é€šå¸¸åŒ…å«è¯ä¹¦è¯·æ±‚`.csr`æ–‡ä»¶ã€ç­¾åè¯ä¹¦`.crt`æ–‡ä»¶åŠç§é’¥`.key`æ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œharboré…ç½®çš„hostnameæ˜¯192.168.48.100ï¼Œæ‰€ä»¥æœ€ç»ˆéœ€è¦ç”Ÿæˆ`192.168.48.100.crtã€192.168.48.100.csrã€192.168.48.100.key`ä¸‰ä¸ªæ–‡ä»¶ã€‚\n\n- keyï¼šè¯ä¹¦ç§é’¥ï¼Œä¸€èˆ¬åˆ©ç”¨rsaç­‰ç®—æ³•ç”Ÿæˆ\n- csrï¼šè¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œåˆ©ç”¨è¯ä¹¦ç§é’¥ç”Ÿæˆè¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†æœåŠ¡å™¨å’Œåœ°å€ç­‰ä¿¡æ¯ï¼Œç”³è¯·äººå°†è¯¥æ–‡ä»¶æäº¤ç»™CAæœºæ„ï¼ŒCAæœºæ„ä¼šæ ¹æ®è¯¥æ–‡ä»¶æ‰€æºå¸¦çš„ç§é’¥ä¿¡æ¯æ¥è¿›è¡Œç­¾åç”Ÿæˆè¯ä¹¦\n- crtï¼šè¯ä¹¦æ–‡ä»¶\n\n```\n## 1. ç”Ÿæˆç§é’¥\nopenssl genrsa -out 192.168.48.100.key 4096\n## 2. ç”Ÿæˆcsræ–‡ä»¶\nopenssl req -sha512 -new \\\n    -subj \"/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=192.168.48.100\" \\\n    -key 192.168.48.100.key \\\n    -out 192.168.48.100.csr\n## 3. ç”ŸæˆsslåŒ¹é…å¤šåŸŸåæ–‡ï¼Œä¾‹å¦‚æ—¢æƒ³ä½¿ç”¨åŸŸååˆéœ€è¦é€šè¿‡127.0.0.1æœ¬åœ°åœ°å€ç™»é™†æµ‹è¯•ï¼Œå¯ä½¿ç”¨subjectAltNameå‚æ•°æ¥è¿›è¡Œé…ç½®\ncat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1=192.168.48.100\nDNS.2=127.0.0.1\nIP.1=192.168.48.100\nEOF\n## 4. æ ¹æ®v3.extåŠcsræ–‡ä»¶è¯·æ±‚ç”Ÿæˆcrtè¯ä¹¦æ–‡ä»¶\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in 192.168.48.100.csr \\\n    -out 192.168.48.100.crt\n```\n\n### ä¿®æ”¹harboré…ç½®æ–‡ä»¶\n\n```yaml\ncat >> /var/harbor/harbor.yml << \"EOF\"\nhttps:\n  port: 443\n  certificate: /var/harbor/cert/192.168.48.100.crt\n  private_key: /var/harbor/cert/192.168.48.100.key\nEOF\n```\n\né‡æ–°å¯åŠ¨\n\n```\ncd /var/harbor\ndocker-compose down -v\n./prepare\ndocker-compose up -d\n```\n\n## é•œåƒä¸Šä¼ åŠæ‹‰å–æµ‹è¯•\n\næ“ä½œèŠ‚ç‚¹ï¼š[harbor1,harbor2,zujian,qianyiosï¼ˆæµ‹è¯•å®¢æˆ·ç«¯ï¼‰]\n\næ‰¾ä¸€å°å®¢æˆ·ç«¯è£…å¥½`docker`è¿›è¡Œæµ‹è¯•\n\n```\n[root@qianyios ~]# docker -v\nDocker version 26.0.1, build d260a54\n```\n\n### æ–°å»ºç§æœ‰é•œåƒä»“åº“\n\n![image-20240429225926063](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/4fb7f4c6485f304c8148230cdd17cb5e697559838.png)\n\n### å®¢æˆ·ç«¯å…httpsç™»é™†\n\n```bash\n# æ­¤æ—¶ç›´æ¥ä½¿ç”¨docker loginç™»é™†åˆ°harborä¸­ï¼Œä¼šæŠ¥é”™ï¼Œä¸‹é¢hostnameå’Œportæ˜¯harborçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„åç§°åŠç«¯å£\n#ä»¥ä¸‹æ˜¯æ ¼å¼\n[root@xxxx harbor]# docker login [hostname]:[port]\n\nå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µ\n#192.168.48.100æ˜¯é«˜å¯ç”¨vip\n[root@harbor1 ~]# docker login 192.168.48.100\nUsername: admin\nPassword:\nError response from daemon: Get \"https://192.168.48.100/v2/\": tls: failed to verify certificate: x509: certificate signed by unknown authority\n\n[root@qianyios ~]# docker login 192.168.48.106:8081\nUsername: admin\nPassword:\nError response from daemon: Get \"https://192.168.48.106:8081/v2/\": http: server gave HTTP response to HTTPS client\n[root@qianyios ~]#\n\n# å®¢æˆ·ç«¯é»˜è®¤ä½¿ç”¨çš„æ˜¯httpsåè®®ï¼Œæ‰€ä»¥éœ€è¦å¯¹dockeråšä»¥ä¸‹ä¿®æ”¹,åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ insecure-registries\n[root@qianyios ~]# vim /etc/docker/daemon.json\n{\n   ................\n  \"registry-mirrors\": [],#æ— å…³ç´§è¦ï¼Œä¸ç”¨çœ‹,\n  \"insecure-registries\": [ \"192.168.48.100\" ],#é‡è¦åŠ è¿™è¡Œï¼Œåˆ«å¿˜äº†å¦‚æœä»–ä¸æ˜¯æœ€åä¸€è¡Œä¸€å®šè¦åœ¨æœ«å°¾åŠ é€—å·\n ................\n}\n\n# ä¿®æ”¹åï¼Œé‡å¯dockerä½¿å…¶ç”Ÿæ•ˆ\nsystemctl daemon-reload\nsystemctl restart docker\n\n# åˆ©ç”¨docker infoæŸ¥çœ‹æ˜¯å¦æ·»åŠ ä¸Š\n[root@qianyios ~]# docker info\nContainers: 10\n Running: 1\n Paused: 0\n Stopped: 9\nImages: 37\n...\n Experimental: false\n Insecure Registries:\n  192.168.48.100   ###è¦ç¡®ä¿æœ‰è¿™ä¸ªæ‰è¡Œ\n  127.0.0.0/8\n Registry Mirrors:\n\n\n```\n\n### æ‰©å±•çŸ¥è¯†-containerdç§æœ‰ä»“åº“é…ç½®ï¼ˆå¯ç•¥è¿‡ï¼‰\n\nåœ¨ä»Šåçš„K8sç‰ˆæœ¬å¯èƒ½ä¹Ÿä¼šç”¨containerdåšä¸ºk8sçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œé‚£ä¹ˆé…ç½®ç§æœ‰ä»“åº“ä¹Ÿæ˜¯ä¸€ä¸ªå¤´ç–¼çš„äº‹æƒ…ã€‚\n\nåœ¨/etc/containerd/config.tomlä¼šæœ‰ä»¥ä¸‹ä¸¤ä¸ªä¿¡æ¯ï¼Œå¯ä»¥å®šä½\n\n```\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors]\n```\n\nè¦åœ¨ä»¥ä¸Šä¸¤ä¸ªä¿¡æ¯ä¸‹é…ç½®ä¸œè¥¿å¦‚ä¸‹ï¼šï¼ˆç†è§£ï¼Œæˆ‘ä¸‹é¢æœ‰ä¸€æ­¥åˆ°ä½å‘½ä»¤ï¼Œä¸ç”¨æ‰‹åŠ¨åŠ ï¼‰\n\n```\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs]\n  [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"192.168.48.100\".tls]\n    insecure_skip_verify = true  # æ˜¯å¦è·³è¿‡å®‰å…¨è®¤è¯\n  [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"192.168.48.100\".auth]\n    username = \"admin\"\n    password = \"Harbor12345\"\n\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors]\n  [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\n    endpoint = [\"https://registry-1.docker.io\"]\n  [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"192.168.48.100\"]\n    endpoint = [\"http://192.168.48.100\"]\n```\n\n![image-20241009163343160](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/e7d8228511bde2282b1d458025a5170f697559838.png)\n\næ·»åŠ Harborä¿¡æ¯\n\n```bash\nsed -i '/\\[plugins.\"io.containerd.grpc.v1.cri\".registry.configs\\]/a \\\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"192.168.48.100\".tls]\\\n          insecure_skip_verify = true  # æ˜¯å¦è·³è¿‡å®‰å…¨è®¤è¯\\\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"192.168.48.100\".auth]\\\n          username = \"admin\"\\\n          password = \"Harbor12345\"' /etc/containerd/config.toml\nsed -i '/\\[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors\\]/a \\\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\\\n          endpoint = [\"https://registry-1.docker.io\"]\\\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"192.168.48.100\"]\\\n          endpoint = [\"http://192.168.48.100\"]' /etc/containerd/config.toml\n```\n\næœ€åå°è¯•ä¸‹è½½é•œåƒ\n\n```\ncrictl pull 192.168.48.100/cicd/jenkins:latest\n```\n\nè¿™ä¸ªæ˜¯æˆ‘è‡ªå·±ä¸Šä¼ çš„é•œåƒï¼Œå·²ç»åœ¨harborä»“åº“äº†ï¼Œæˆ‘ç°åœ¨åœ¨æœ‰containerdçš„å®¢æˆ·ç«¯è¿›è¡Œæ‹‰å–çœ‹çœ‹èƒ½ä¸èƒ½æˆåŠŸ\n\n![image-20241009164535687](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/d2038f19baeadc7ad16d1028310d4b5f697559838.png)\n\næ˜¾ç„¶å·²ç»æˆåŠŸ\n\n### è¿›è¡Œç™»å…¥æµ‹è¯•\n\n```bash\ndocker login 192.168.48.100\n\n[root@harbor1 ~]# docker login 192.168.48.100\nUsername: admin\nPassword:\nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n\n[root@qianyios ~]# docker login 192.168.48.100\nUsername: admin\nPassword:\nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n\n##ç»è¿‡æµ‹è¯•ï¼Œé€šè¿‡æ·»åŠ \"insecure-registries\": [ \"192.168.48.100\" ]å¯ä»¥å…é™¤httpsç™»å…¥\n\n```\n\n### ä¸Šä¼ é•œåƒæµ‹è¯•\n\n```bash\n#ä¸‹è½½ä¸€ä¸ªnginxé•œåƒï¼Œç„¶åtagï¼Œå†ä¸Šä¼ \n[root@qianyios ~]# docker pull nginx\nUsing default tag: latest\nlatest: Pulling from library/nginx\na2abf6c4d29d: Pull complete\na9edb18cadd1: Pull complete\n589b7251471a: Pull complete\n186b1aaa4aa6: Pull complete\nb4df32aa5a72: Pull complete\na0bcbecc962e: Pull complete\nDigest: sha256:0d17b565c37bcbd895e9d92315a05c1c3c9a29f762b011a10c54a66cd53c9b31\nStatus: Downloaded newer image for nginx:latest\ndocker.io/library/nginx:latest\n#åœ¨æ­¤ä¸‹è½½äº†æœ€æ–°ç‰ˆçš„nginxé•œåƒtagä¸ºlastest\n```\n\næˆ‘ä»¬è¿›å…¥å½“åˆšåˆšåˆ›å»ºçš„ä»“åº“ï¼Œç‚¹æ¨é€æŒ‡ä»¤\n\n```\n#æ¨é€é•œåƒå‘½ä»¤æ ¼å¼\n#docker tag æºé•œåƒå[:TAG] 192.168.48.100/qianyios/æ–°é•œåƒå[:TAG]\ndocker tag SOURCE_IMAGE[:TAG] 192.168.48.100/qianyios/REPOSITORY[:TAG]\n```\n\n![image-20240430180549537](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/c1a6a7b6fecf5f740f5be385ab2efc19697559838.png)\n\n```\n#æˆ‘ä»¬å°†nginxé•œåƒæ‰“ä¸Štag   \n[root@qianyios ~]# docker images\nREPOSITORY   TAG       IMAGE ID       CREATED       SIZE\nnginx        latest    605c77e624dd   2 years ago   141MB\n#605çš„æ„æ€æ˜¯é•œåƒidçš„å‰ä¸‰ä½æ•°å­—ï¼Œæˆ‘ä»¬æŒ‡å®šä¸ºV1æ ‡ç­¾ï¼Œç›¸å½“äºç‰ˆæœ¬å·ã€‚\n[root@qianyios ~]# docker tag 605 192.168.48.100/qianyios/nginx:V1\n[root@qianyios ~]# docker images\nREPOSITORY                      TAG       IMAGE ID       CREATED       SIZE\n192.168.48.100/qianyios/nginx   V1        605c77e624dd   2 years ago   141MB\nnginx                           latest    605c77e624dd   2 years ago   141MB\n#å¼€å§‹ä¸Šä¼ \n[root@qianyios ~]# docker push 192.168.48.100/qianyios/nginx:V1\nThe push refers to repository [192.168.48.100/qianyios/nginx]\nd874fd2bc83b: Pushed\n32ce5f6a5106: Pushed\nf1db227348d0: Pushed\nb8d6e692a25e: Pushed\ne379e8aedd4d: Pushed\n2edcec3590a4: Pushed\nV1: digest: sha256:ee89b00528ff4f02f2405e4ee221743ebc3f8e8dd0bfd5c4c20a2fa2aaa7ede3 size: 1570\n#å»é¡µé¢æŸ¥çœ‹\n```\n\n![image-20240430181509733](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/b1a7eca729d06f4371d5234181428e20697559838.png)\n\n![image-20240430181528902](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/d161a1df048d0256c3c33f9b5289ac05697559838.png)\n\næˆ‘ä»¬å»harbor1æµ‹è¯•æ‹‰å–é•œåƒï¼Œä¼šå‘ç°ä¸‹è½½æ•°å˜æˆäº†`1`\n\n```\n[root@harbor1 ~]# docker pull 192.168.48.100/qianyios/nginx:V1\nV1: Pulling from qianyios/nginx\na2abf6c4d29d: Pull complete\na9edb18cadd1: Pull complete\n589b7251471a: Pull complete\n186b1aaa4aa6: Pull complete\nb4df32aa5a72: Pull complete\na0bcbecc962e: Pull complete\nDigest: sha256:ee89b00528ff4f02f2405e4ee221743ebc3f8e8dd0bfd5c4c20a2fa2aaa7ede3\nStatus: Downloaded newer image for 192.168.48.100/qianyios/nginx:V1\n192.168.48.100/qianyios/nginx:V1\n[root@harbor1 ~]#\n```\n\n![image-20240430181626605](../img/Harbor%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E9%AB%98%E5%8F%AF%E7%94%A8/fc75695e91827f976cf7cc6c74abeabe697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["OpenEuler","Harbor"],"categories":["äº‘åŸç”Ÿ"]},{"title":"OpenEuler-K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå†…éƒ¨etcdï¼‰","url":"/posts/62904/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# OpenEuler-éƒ¨ç½²K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå†…éƒ¨etcdï¼‰\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå  | ip1ï¼ˆNATï¼‰     | ç³»ç»Ÿ                | ç£ç›˜ | å†…å­˜ |\n| ------- | -------------- | ------------------- | ---- | ---- |\n| master1 | 192.168.48.101 | OpenEuler-22.03-LTS | 100G | 4G   |\n| master2 | 192.168.48.102 | OpenEuler-22.03-LTS | 100G | 4G   |\n| master3 | 192.168.48.103 | OpenEuler-22.03-LTS | 100G | 4G   |\n| node01  | 192.168.48.104 | OpenEuler-22.03-LTS | 100G | 8G   |\n\né•œåƒä¸‹è½½åœ°å€ï¼š[OpenEuler-22.03-LTS](https://mirrors.nju.edu.cn/openeuler/openEuler-22.03-LTS-SP4/ISO/x86_64/)\n\nä¸‹è½½åä¸ºopenEuler-22.03-LTS-SP4-x86_64-dvd.iso\n\n## åŸºç¡€é…ç½®\n\nOpeneuleré€šè¿‡å•ç‹¬å®‰è£…ï¼Œéå…‹éš†ã€‚å®‰è£…å®Œåè¿›è¡ŒåŸºæœ¬ç¯å¢ƒçš„é…ç½®ï¼Œé…ç½®ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n1. è®¾ç½®ä¸»æœºå\n2. å…³é—­firewalldã€dnsmasqã€selinux\n3. è®¾ç½®ens33\n6. å¤‡ä»½å¹¶æ–°å¢ã€docker-ceæºã€k8sæº\n7. æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\n9. æ·»åŠ hostsè§£æ\n10. å…³é—­swapåˆ†åŒº\n11. å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\n12. é…ç½®limits.conf\n13. å®‰è£…å¿…å¤‡å·¥å…·\n14. å‡çº§ç³»ç»Ÿå¹¶é‡å¯\n\næ“ä½œä¸»æœºï¼š[master1,master2,master3,node01]\n\n```\n#å°†ä»¥ä¸‹è„šæœ¬å†…å®¹æ·»åŠ è¿›å»\nvi k8s_system_init.sh\n```\n\n```\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\necho \"2.æ­£åœ¨å…³é—­firewalldã€dnsmasqã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl disable dnsmasq &> /dev/null\nsystemctl stop firewalld\nsystemctl stop dnsmasq\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nNAME=ens33\nUUID=53b402ff-5865-47dd-a853-7afcd6521738\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS1=192.168.48.2\nDNS2=114.114.114.114\nEOF\nnmcli c reload\nnmcli c up ens33\n\n\necho \"4.æ–°å¢docker-ceæºã€k8sæº\"\nmkdir /etc/yum.repos.d/bak/\ncp /etc/yum.repos.d/* /etc/yum.repos.d/bak/\nsleep 3\ncat > /etc/yum.repos.d/kubernetes.repo <<EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg \nEOF\n#åˆ‡æ¢ä¸ºåä¸ºäº‘ï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿«\nsed -i 's/\\$basearch/x86_64/g' /etc/yum.repos.d/openEuler.repo\nsed -i 's/http\\:\\/\\/repo.openeuler.org/https\\:\\/\\/mirrors.huaweicloud.com\\/openeuler/g' /etc/yum.repos.d/openEuler.repo\n\ncurl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsed -i 's/\\$releasever/7/g' /etc/yum.repos.d/docker-ce.repo\n\necho \"5.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\n yum clean all && yum makecache\n\necho \"6.æ·»åŠ hostsè§£æ\"\ncat > /etc/hosts <<EOF\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.101 master1\n192.168.48.102 master2\n192.168.48.103 master3\n192.168.48.104 node01\n192.168.48.105 node02\nEOF\n\n\necho \"7.å…³é—­swapåˆ†åŒº\"\nswapoff -a && sysctl -w vm.swappiness=0 &> /dev/null\nsed -ri '/^[^#]*swap/s@^@#@' /etc/fstab\n\n\necho \"8.å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\"\nyum install chrony -y\nsystemctl start chronyd\nsystemctl enable chronyd\nchronyc sources\nchronyc sources\n\necho \"9.é…ç½®limits.conf\"\nulimit -SHn 65535\ncat >> /etc/security/limits.conf <<EOF\n* soft nofile 65536\n* hard nofile 131072\n* soft nproc 65535\n* hard nproc 655350\n* soft memlock unlimited\n* hard memlock unlimited\nEOF\n\n\necho \"10.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet device-mapper-persistent-data lvm2 git -y\n\n\necho \"11.é‡å¯\"\nreboot\n\n```\n\n```\nsh k8s_system_init.sh ä¸»æœºå  ä¸»æœºä½\n[master1] sh k8s_system_init.sh master1 101\n\n[master2] sh k8s_system_init.sh master2 102\n\n[master3] sh k8s_system_init.sh master3 103\n\n[node01] sh k8s_system_init.sh node01 104\n\n```\n\n### é…ç½®sshå…å¯†\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"master1\" \"master2\" \"master3\" \"node01\")\n# å¯†ç \npassword=\"Lj201840.\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## å†…æ ¸åŠipvsæ¨¡å—é…ç½®\n\næ­¤æ­¥éª¤æ˜¯é…ç½®ipvsæ¨¡å—ï¼Œå¼€å¯ä¸€äº›k8sé›†ç¾¤ä¸­å¿…é¡»çš„å†…æ ¸å‚æ•°ã€‚é…ç½®ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n1. æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº\n2. å®‰è£…ipvsadm\n3. é…ç½®ipvsæ¨¡å—\n4. å¼€å¯k8sé›†ç¾¤å¿…é¡»çš„å†…æ ¸å‚æ•°\n5. é…ç½®å®Œå†…æ ¸ï¼Œé‡å¯æœåŠ¡å™¨\n\næ“ä½œä¸»æœºï¼š[master1,master2,master3,node01]\n\n```\nvi kernel_update.sh\n```\n\n```\n#!/bin/bash\n\necho \"1.æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº\"\ngrub2-set-default  0 && grub2-mkconfig -o /etc/grub2.cfg\ngrubby --args=\"user_namespace.enable=1\" --update-kernel=\"$(grubby --default-kernel)\"\n\necho \"2.å®‰è£…ipvsadm\"\nyum install ipvsadm ipset sysstat conntrack libseccomp -y &> /dev/null\n\n\necho \"3.é…ç½®ipvsæ¨¡å—\"\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack\n\ncat >> /etc/modules-load.d/ipvs.conf <<EOF\nip_vs\nip_vs_lc\nip_vs_wlc\nip_vs_rr\nip_vs_wrr\nip_vs_lblc\nip_vs_lblcr\nip_vs_dh\nip_vs_sh\nip_vs_fo\nip_vs_nq\nip_vs_sed\nip_vs_ftp\nip_vs_sh\nnf_conntrack\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\nEOF\nsystemctl enable --now systemd-modules-load.service &> /dev/null\n\n\necho \"4.å¼€å¯k8sé›†ç¾¤å¿…é¡»çš„å†…æ ¸å‚æ•°\"\ncat <<EOF > /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_nonlocal_bind = 1 \nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nfs.may_detach_mounts = 1\nnet.ipv4.conf.all.route_localnet = 1\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.netfilter.nf_conntrack_max=2310720\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl =15\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_orphans = 327680\nnet.ipv4.tcp_orphan_retries = 3\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.ip_conntrack_max = 65536\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_timestamps = 0\nnet.core.somaxconn = 16384\nEOF\nsysctl --system\n\n\necho \"5.é…ç½®å®Œå†…æ ¸ï¼Œé‡å¯æœåŠ¡å™¨ï¼\"\nreboot\n\n```\n\n```\nsh kernel_update.sh\n```\n\n## æ£€æŸ¥ipvsåŠ è½½ã€å†…æ ¸ç‰ˆæœ¬éªŒè¯\n\n```\nlsmod | grep --color=auto -e ip_vs -e nf_conntrack\nuname -a\n```\n\n![image-20231201233238841](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/1325a5766ef497cc896d29b1ef00b5de697559838.png)\n\n##  é«˜å¯ç”¨ç»„ä»¶å®‰è£…\n\n### haproxyé…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\n```\nyum install keepalived haproxy -y\n```\n\næ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®HAProxyï¼Œæ‰€æœ‰MasterèŠ‚ç‚¹çš„HAProxyé…ç½®ç›¸åŒã€‚\n\n```yaml\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2ï¼Œmaster3]\ncat > /etc/haproxy/haproxy.cfg <<\"EOF\"\n\nglobal\n  maxconn  2000\n  ulimit-n  16384\n  log  127.0.0.1 local0 err\n  stats timeout 30s\n\ndefaults\n  log global\n  mode  http\n  option  httplog\n  timeout connect 5000\n  timeout client  50000\n  timeout server  50000\n  timeout http-request 15s\n  timeout http-keep-alive 15s\n\nfrontend monitor-in\n  bind *:33305\n  mode http\n  option httplog\n  monitor-uri /monitor\n\nfrontend k8s-master\n  bind 0.0.0.0:16443\n  bind 127.0.0.1:16443\n  mode tcp\n  option tcplog\n  tcp-request inspect-delay 5s\n  default_backend k8s-master\n\nbackend k8s-master\n  mode tcp\n  option tcplog\n  option tcp-check\n  balance roundrobin\n  default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100\n  server master1   192.168.48.101:6443  check\n  server master2   192.168.48.102:6443  check\n  server master3   192.168.48.103:6443  check\nEOF\n```\n\n### Keepalivedé…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\næ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®Keepalivedï¼Œä»¥ä¸‹ä¸‰ä¸ªMasterèŠ‚ç‚¹é…ç½®æ³¨æ„ipå’Œç½‘å¡ã€‚\n\n```\ncat > /etc/keepalived/keepalived.conf << \"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n    script_user root\n    enable_script_security\n}\n\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2\n    rise 1\n}\n\nvrrp_instance VI_1 {\n    state MASTER\n    interface ens33\n    mcast_src_ip 192.168.48.101\n    virtual_router_id 51\n    priority 201\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass 1111 # é™åˆ¶åœ¨8ä¸ªå­—ç¬¦ä»¥å†…\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n        chk_apiserver\n    }\n}\nEOF\n```\n\n```\ncat > /etc/keepalived/keepalived.conf << \"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n    script_user root\n    enable_script_security\n}\n\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2\n    rise 1\n}\n\nvrrp_instance VI_1 {\n    state BACKUP\n    interface ens33\n    mcast_src_ip 192.168.48.102\n    virtual_router_id 51\n    priority 150\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass 1111 # é™åˆ¶åœ¨8ä¸ªå­—ç¬¦ä»¥å†…\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n        chk_apiserver\n    }\n}\nEOF\n```\n\n```\ncat > /etc/keepalived/keepalived.conf << \"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n    script_user root\n    enable_script_security\n}\n\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2\n    rise 1\n}\n\nvrrp_instance VI_1 {\n    state BACKUP\n    interface ens33\n    mcast_src_ip 192.168.48.103\n    virtual_router_id 51\n    priority 99\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass 1111 # é™åˆ¶åœ¨8ä¸ªå­—ç¬¦ä»¥å†…\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n        chk_apiserver\n    }\n}\nEOF\n```\n\n### é…ç½®Keepalivedå¥åº·æ£€æŸ¥æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\n```\ncat > /etc/keepalived/check_apiserver.sh << \"EOF\"\n#!/bin/bash\n\nerr=0\nfor k in \\$(seq 1 3)\ndo\n    check_code=\\$(pgrep haproxy)\n    if [[ \\$check_code == \"\" ]]; then\n        err=\\$(expr \\$err + 1)\n        sleep 1\n        continue\n    else\n        err=0\n        break\n    fi\ndone\n\nif [[ \\$err != \"0\" ]]; then\n    echo \"Stopping keepalived due to haproxy failure.\"\n    /usr/bin/systemctl stop keepalived\n    exit 1\nelse\n    exit 0\nfi\nEOF\n\nchmod +x /etc/keepalived/check_apiserver.sh\n```\n\n### å¯åŠ¨haproxyå’Œkeepalived\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[masterï¼Œmaster2,master3]\nsystemctl daemon-reload\nsystemctl enable --now haproxy\nsystemctl enable --now keepalived\nsystemctl restart haproxy keepalived\n```\n\n### æµ‹è¯•é›†ç¾¤è´Ÿè½½å‡è¡¡é«˜å¯ç”¨\n\næŸ¥çœ‹master1çš„vip\n\n```\nip a\n```\n\n![image-20231109232708584](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/d419111a4b7e1cecb92fe4c934c15324697559838.png)\n\næ¨¡æ‹Ÿmaster1çš„å®•æœºæµ‹è¯•ï¼Œçœ‹çœ‹vipä¼šä¸ä¼šæ¼‚ç§»åˆ°master2å»\n\n```\n[master1] poweroff\n```\n\n![image-20231109232803276](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/fde8cea0a4bc27255f880d21601fdb8c697559838.png)\n\nè¿™æ—¶å€™æŸ¥çœ‹master2çš„ipåˆ—è¡¨\n\n```\n[master2] ip a\n```\n\n![image-20231109232825999](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/d4019c6f8cdc38d93404b9c6277c7369697559838.png)\n\nç»“è®ºï¼šè¿™æ—¶å¯ä»¥çŸ¥é“ï¼Œè´Ÿè½½å‡è¡¡é›†ç¾¤æˆåŠŸï¼Œå½“master1å‡ºç°å®•æœºæƒ…å†µï¼Œvipä¼šä»master1æ¼‚ç§»åˆ°master2\n\n## dockerå®‰è£…\n\n### å®‰è£…docker\n\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\n```\nwget https://download.docker.com/linux/static/stable/x86_64/docker-24.0.7.tgz\ntar xf docker-*.tgz\ncp -rf docker/* /usr/bin/\n#åˆ›å»ºcontainerdçš„serviceæ–‡ä»¶,å¹¶ä¸”å¯åŠ¨\ncat >/etc/systemd/system/containerd.service <<EOF\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=1048576\nTasksMax=infinity\nOOMScoreAdjust=-999\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl enable --now containerd.service\n\n#å‡†å¤‡dockerçš„serviceæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.service <<EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service containerd.service\nWants=network-online.target\nRequires=docker.socket containerd.service\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd --config-file=/etc/docker/daemon.json -H fd://\ncontainerd=/run/containerd/containerd.sock\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\nOOMScoreAdjust=-500\n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å‡†å¤‡dockerçš„socketæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.socket <<EOF\n[Unit]\nDescription=Docker Socket for the API\n[Socket]\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n[Install]\nWantedBy=sockets.target\nEOF\ngroupadd docker\n\nsystemctl enable --now docker.socket  && systemctl enable --now docker.service\n\n\n#éªŒè¯\nmkdir /etc/docker\nsudo tee /etc/docker/daemon.json > /dev/null <<'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.xuanyuan.me\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://docker.1panel.live\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n\t\t\"https://docker.qianyios.top\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  },\n  \"data-root\": \"/var/lib/docker\"\n}\nEOF\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n### å®‰è£…cri-docker\n\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\n```\nwget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.12/cri-dockerd-0.3.12.amd64.tgz\n\ntar -zxvf cri-dockerd-0.3.*.amd64.tgz\ncp cri-dockerd/cri-dockerd  /usr/bin/\nchmod +x /usr/bin/cri-dockerd\n\n\n#å†™å…¥å¯åŠ¨é…ç½®æ–‡ä»¶\ncat >  /usr/lib/systemd/system/cri-docker.service <<EOF\n[Unit]\nDescription=CRI Interface for Docker Application Container Engine\nDocumentation=https://docs.mirantis.com\nAfter=network-online.target firewalld.service docker.service\nWants=network-online.target\nRequires=cri-docker.socket\n \n[Service]\nType=notify\nExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.9\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\n \nStartLimitBurst=3\n \nStartLimitInterval=60s\n \nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\n \nTasksMax=infinity\nDelegate=yes\nKillMode=process\n \n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å†™å…¥socketé…ç½®æ–‡ä»¶\ncat > /usr/lib/systemd/system/cri-docker.socket <<EOF\n[Unit]\nDescription=CRI Docker Socket for the API\nPartOf=cri-docker.service\n \n[Socket]\nListenStream=%t/cri-dockerd.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n \n[Install]\nWantedBy=sockets.target\nEOF\n\nsystemctl daemon-reload && systemctl enable cri-docker --now\n```\n\n## K8Sé›†ç¾¤å®‰è£…\n\n### å®‰è£…k8sæ‰€éœ€çš„å·¥å…·\n\n```\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\nyum -y install  kubeadm kubelet kubectl\n\n#ä¸ºäº†å®ç°dockerä½¿ç”¨çš„cgroupdriverä¸kubeletä½¿ç”¨çš„cgroupçš„ä¸€è‡´æ€§ï¼Œé…ç½®å¦‚ä¸‹ï¼š\nsed -i 's/^KUBELET_EXTRA_ARGS=/KUBELET_EXTRA_ARGS=\"--cgroup-driver=systemd\"/g' /etc/sysconfig/kubelet\n\n#è®¾ç½®kubeletä¸ºå¼€æœºè‡ªå¯åŠ¨å³å¯ï¼Œç”±äºæ²¡æœ‰ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé›†ç¾¤åˆå§‹åŒ–åè‡ªåŠ¨å¯åŠ¨\nsystemctl enable kubelet\nsystemctl enable kubelet.service\n```\n\n### é›†ç¾¤åˆå§‹åŒ–\n\n```yaml\næ“ä½œèŠ‚ç‚¹[master1,master2,master3]\n\ncat > kubeadm-config.yaml << EOF\napiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 192.168.48.101\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/cri-dockerd.sock\n  imagePullPolicy: IfNotPresent\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns: {}\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: registry.aliyuncs.com/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.28.2\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 10.244.0.0/16\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\ncontrolPlaneEndpoint: \"192.168.48.200:16443\"\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nbindAddress: 0.0.0.0\nbindAddressHardFail: false\nclientConnection:\n  acceptContentTypes: \"\"\n  burst: 0\n  contentType: \"\"\n  kubeconfig: /var/lib/kube-proxy/kubeconfig.conf\n  qps: 0\nclusterCIDR: \"\"\nconfigSyncPeriod: 0s\nconntrack:\n  maxPerCore: null\n  min: null\n  tcpCloseWaitTimeout: null\n  tcpEstablishedTimeout: null\ndetectLocal:\n  bridgeInterface: \"\"\n  interfaceNamePrefix: \"\"\ndetectLocalMode: \"\"\nenableProfiling: false\nhealthzBindAddress: \"\"\nhostnameOverride: \"\"\niptables:\n  localhostNodePorts: null\n  masqueradeAll: false\n  masqueradeBit: null\n  minSyncPeriod: 0s\n  syncPeriod: 0s\nipvs:\n  excludeCIDRs: null\n  minSyncPeriod: 0s\n  scheduler: \"\"\n  strictARP: false\n  syncPeriod: 0s\n  tcpFinTimeout: 0s\n  tcpTimeout: 0s\n  udpTimeout: 0s\nkind: KubeProxyConfiguration\nlogging:\n  flushFrequency: 0\n  options:\n    json:\n      infoBufferSize: \"0\"\n  verbosity: 0\nmetricsBindAddress: \"\"\nmode: \"ipvs\" #æŒ‡å®šipvsæ¨¡å¼\nnodePortAddresses: null\noomScoreAdj: null\nportRange: \"\"\nshowHiddenMetricsForVersion: \"\"\nwinkernel:\n  enableDSR: false\n  forwardHealthCheckVip: false\n  networkName: \"\"\n  rootHnsEndpointName: \"\"\n  sourceVip: \"\"\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\ncgroupDriver: systemd\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncontainerRuntimeEndpoint: \"\"\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging:\n  flushFrequency: 0\n  options:\n    json:\n      infoBufferSize: \"0\"\n  verbosity: 0\nmemorySwap: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\n\nEOF\n\nkubeadm config migrate --old-config kubeadm-config.yaml --new-config new.yaml\n\n```\n\n### å‡†å¤‡k8sæ‰€éœ€çš„é•œåƒ\n\n```\næ“ä½œèŠ‚ç‚¹[master1,master2,master3]\n\nkubeadm config images pull --config /root/new.yaml \n```\n\n![image-20231110100341121](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/15d685625b3cf3eb0b5ec8f67347f298697559838.png)\n\n### master1èŠ‚ç‚¹åˆå§‹åŒ–\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nkubeadm init --config /root/new.yaml  --upload-certs\n```\n\nä¼šç”Ÿæˆä¿¡æ¯\n\n![image-20231110175843902](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/845bd1bac6bcf6ef286522b7c49f1672697559838.png)\n\nè®°å½•ä¿¡æ¯åé¢ä¼šç”¨åˆ°\n\nåˆå§‹åŒ–æˆåŠŸä»¥åï¼Œä¼šäº§ç”ŸTokenå€¼ï¼Œç”¨äºå…¶ä»–èŠ‚ç‚¹åŠ å…¥æ—¶ä½¿ç”¨ï¼Œå› æ­¤è¦è®°å½•ä¸‹åˆå§‹åŒ–æˆåŠŸç”Ÿæˆçš„tokenå€¼ï¼ˆä»¤ç‰Œå€¼ï¼‰ï¼Œ**æœ‰æ•ˆæœŸ24å°æ—¶ï¼Œåç»­éœ€è¦æ“ä½œå¯ä»¥é‡æ–°ç”ŸæˆToken**\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:fd91b75286ce9d50c840f380117e25961ad743a8962f3a9f2c80d74c928e1497 \\\n        --control-plane --certificate-key 0dfa57d943f4a2b8b55840d17f67de731b137e11ca4720f7bf9bfd75d8247e22\n\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:fd91b75286ce9d50c840f380117e25961ad743a8962f3a9f2c80d74c928e1497\n```\n\n`æ“ä½œkubectæŠ¥é”™ï¼š`\n\n![image-20231110180035297](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/f7e9c2c31bb5f7dab653a744542e5f95697559838.png)\n\næ­¤æ—¶é€šè¿‡kubectlæ“ä½œï¼Œä¼šå‡ºç°å¤±è´¥ï¼Œå› ä¸ºè¿˜æ²¡æœ‰å°†é›†ç¾¤çš„\"é’¥åŒ™\"äº¤ç»™rootç”¨æˆ·ã€‚`/etc/kubernetes/admin.conf` æ–‡ä»¶æ˜¯ Kubernetesï¼ˆK8sï¼‰é›†ç¾¤ä¸­çš„ç®¡ç†å‘˜é…ç½®æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ç”¨äºç®¡ç†é›†ç¾¤çš„èº«ä»½éªŒè¯å’Œè®¿é—®ä¿¡æ¯ã€‚æ‰€ä»¥ä¸‹é¢è¿›è¡Œé…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®Kubernetesé›†ç¾¤ï¼š\n\n`æ·»åŠ ç¯å¢ƒå˜é‡`\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n### æ·»åŠ å…¶ä»–masterèŠ‚ç‚¹è‡³é›†ç¾¤ä¸­\n\næ“ä½œèŠ‚ç‚¹[master2,master3]\n\n```\næ“ä½œèŠ‚ç‚¹[master2,master3]\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:fd91b75286ce9d50c840f380117e25961ad743a8962f3a9f2c80d74c928e1497 \\\n        --control-plane --certificate-key 0dfa57d943f4a2b8b55840d17f67de731b137e11ca4720f7bf9bfd75d8247e22 \\\n        --cri-socket unix:///var/run/cri-dockerd.sock \n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\næ¥ç€ç»™`master2`æ·»åŠ ç¯å¢ƒå˜é‡\n\n```\næ“ä½œèŠ‚ç‚¹[master2,master3]\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n![image-20231110180919008](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/069369188589ae7cde679b64eb6cf342697559838.png)\n\nè¿™é‡Œæ²¡æœ‰å±•ç¤ºmaster3çš„å›¾ç‰‡ï¼Œä½†æ˜¯æ­¥éª¤ä¸€æ ·çš„\n\n### æ¨¡æ‹ŸTokenè¿‡æœŸé‡æ–°ç”Ÿæˆå¹¶åŠ å…¥NodeèŠ‚ç‚¹\n\nå‡è®¾åŠ å…¥é›†ç¾¤çš„tokenè¿‡æœŸäº†ã€‚node01æ— æ³•åŠ å…¥äº†ï¼Œè¿™é‡Œå°±æ¨¡æ‹Ÿä¸€ä¸‹è¿™ç§æƒ…å†µ\n\n1. Tokenè¿‡æœŸåç”Ÿæˆæ–°çš„tokenï¼š\n\n```bash\nkubeadm token create --print-join-command\n```\n\n```\n[root@master1 ~]# kubeadm token create --print-join-command\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n\n```\n\nå…¶ä¸­ï¼Œ`192.168.48.200:16443` æ˜¯ä½ çš„ Kubernetes API æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ï¼Œ`tn5q1b.7w1jj77ewup7k2in` æ˜¯æ–°çš„ä»¤ç‰Œï¼Œ`sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f` æ˜¯ä»¤ç‰Œçš„ CA è¯ä¹¦å“ˆå¸Œå€¼ã€‚\n\n2. Masteréœ€è¦ç”Ÿæˆ--certificate-keyï¼š\n\n```bash\nkubeadm init phase upload-certs --upload-certs\n```\n\n```\n[root@master1 ~]# kubeadm init phase upload-certs --upload-certs\nW1110 18:12:03.426245   10185 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW1110 18:12:03.426320   10185 version.go:105] falling back to the local client version: v1.28.2\n[upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n[upload-certs] Using certificate key:\n5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nå…¶ä¸­ï¼Œ`5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128` æ˜¯è¯ä¹¦å¯†é’¥ã€‚\n\n3. ç”Ÿæˆæ–°çš„Tokenç”¨äºé›†ç¾¤æ·»åŠ æ–°NodeèŠ‚ç‚¹\n\næ“ä½œèŠ‚ç‚¹[node01]\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f  \\\n        --cri-socket unix:///var/run/cri-dockerd.sock \n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\n![image-20231110181623386](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/cf859df3d82366d7f606598d038aa610697559838.png)\n\nè¿™æ—¶åœ¨masteræŸ¥çœ‹nodeçŠ¶æ€ï¼ˆæ˜¾ç¤ºä¸ºnotreadyä¸å½±å“ï¼‰\n\n![image-20231111145807000](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/7b38ac6fd6804d8cb1ee144e43fbad45697559838.png)\n\n### æ¨¡æ‹Ÿæ–°åŠ masterèŠ‚ç‚¹çš„åŠ å…¥K8Sé›†ç¾¤ä¸­\n\nå‡è®¾æˆ‘ä»¬æ–°åŠ masterèŠ‚ç‚¹çš„è¯ï¼Œå°±æ‹¼æ¥tokenï¼Œ`ä»åˆšåˆšç”Ÿæˆçš„tokenæ‹¼æ¥`\n\n```\n[root@master1 ~]# kubeadm token create --print-join-command\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n```\n\nè¿™é‡Œæå–ä¿¡æ¯1\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n```\n\næ¥ç€\n\n```\n[root@master1 ~]# kubeadm init phase upload-certs --upload-certs\nW1110 18:12:03.426245   10185 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW1110 18:12:03.426320   10185 version.go:105] falling back to the local client version: v1.28.2\n[upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n[upload-certs] Using certificate key:\n5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nè¿™é‡Œæå–ä¿¡æ¯2ï¼šè¿™é‡Œå‰é¢è¦åŠ ä¸Š`--control-plane --certificate-key`\n\n```\n--control-plane --certificate-key 5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nåˆæˆ\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f  \\\n        --control-plane --certificate-key 5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128 \\\n        --cri-socket unix:///var/run/cri-dockerd.sock\n        \n        \nkubeadm join 192.168.48.200:16443 --token lnkno8.u4v1l8n9pahzf0kj \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f \\\n        --control-plane --certificate-key 41e441fe56cb4bdfcc2fc0291958e6b1da54d01f4649b6651471c07583f85cdf \\\n        --cri-socket unix:///var/run/cri-dockerd.sock\n\n\n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\nå›¾ç¤º\n\n![image-20231110182741430](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/9b12e9d1b72ed9ed9378712e1d5ca792697559838.png)\n\n## å®‰è£…calicoç½‘ç»œæ’ä»¶\n\næ“ä½œèŠ‚ç‚¹[master1]\n\næ·»åŠ è§£æè®°å½•ï¼Œå¦åˆ™æ— æ³•è®¿é—®\n\n```\necho '185.199.108.133 raw.githubusercontent.com' >> /etc/hosts\n```\n\n### åº”ç”¨operatorèµ„æºæ¸…å•æ–‡ä»¶\n\nç½‘ç»œç»„ä»¶æœ‰å¾ˆå¤šç§ï¼Œåªéœ€è¦éƒ¨ç½²å…¶ä¸­ä¸€ä¸ªå³å¯ï¼Œæ¨èCalicoã€‚ \nCalicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼ŒCalicoæ”¯æŒå¹¿æ³›çš„å¹³å°ï¼ŒåŒ…æ‹¬Kubernetesã€OpenStackç­‰ã€‚ \nCalico åœ¨æ¯ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹åˆ©ç”¨ Linux Kernel å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„è™šæ‹Ÿè·¯ç”±å™¨ï¼ˆ vRouterï¼‰ æ¥è´Ÿè´£æ•°æ®è½¬å‘ï¼Œè€Œæ¯ä¸ª vRouter é€šè¿‡ BGP åè®®è´Ÿè´£æŠŠè‡ªå·±ä¸Šè¿è¡Œçš„ workload çš„è·¯ç”±ä¿¡æ¯å‘æ•´ä¸ª Calico ç½‘ç»œå†…ä¼ æ’­ã€‚ \næ­¤å¤–ï¼ŒCalico é¡¹ç›®è¿˜å®ç°äº† Kubernetes ç½‘ç»œç­–ç•¥ï¼Œæä¾›ACLåŠŸèƒ½ã€‚\n\n```\ncurl https://raw.githubusercontent.com/projectcalico/calico/v3.25.1/manifests/calico.yaml -O\n```\n\n```yaml\n[root@master1 ~]# vim calico.yaml\n#å‚è€ƒä¿¡æ¯\n - name: WAIT_FOR_DATASTORE\n  value: \"true\"\n#æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œ\n- name: IP_AUTODETECTION_METHOD\n  value: interface=ens33\n\n#ens33æ˜¯ä½ çš„ç½‘å¡\n```\n\n![image-20231110183944854](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/ce136d73e7af87b3d00f77d5eb9572cb697559838.png)\n\n```\nsed -i 's| docker.io/calico/| registry.cn-hangzhou.aliyuncs.com/qianyios/|' calico.yaml\nkubectl apply -f calico.yaml\n```\n\n![image-20231110184031455](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/ce8e8fec52aa29431e7cb6dd10bb987c697559838.png)\n\n### ç›‘è§†kube-systemå‘½åç©ºé—´ä¸­podè¿è¡Œæƒ…å†µ\n\nç­‰å¾…ä¼°è®¡20åˆ†é’Ÿå·¦å³å§(ç¡®ä¿å…¨éƒ¨running)\n\n```\nkubectl get pods -n kube-system\n```\n\n![image-20231110193921266](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/8f8108ea428f175038feb979c1915446697559838.png)\n\n### æ‹¿æ‰masterèŠ‚ç‚¹çš„æ±¡ç‚¹\n\nèŠ‚ç‚¹ master1 å’Œ master2 éƒ½æœ‰ä¸€ä¸ªåä¸º `node-role.kubernetes.io/control-plane:NoSchedule` çš„æ±¡ç‚¹ã€‚è¿™ä¸ªæ±¡ç‚¹çš„ä½œç”¨æ˜¯é˜»æ­¢æ™®é€šçš„ Pod è¢«è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šï¼Œåªå…è®¸ç‰¹å®šçš„æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆå¦‚ kube-apiserverã€kube-controller-manager å’Œ kube-schedulerï¼‰åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n\nè¿™ç§è®¾ç½®æœ‰åŠ©äºç¡®ä¿æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸“é—¨ç”¨äºè¿è¡Œ Kubernetes çš„æ ¸å¿ƒç»„ä»¶ï¼Œè€Œä¸ä¼šè¢«æ™®é€šçš„å·¥ä½œè´Ÿè½½å ç”¨ã€‚é€šè¿‡å°†æ±¡ç‚¹æ·»åŠ åˆ°èŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥ç¡®ä¿åªæœ‰è¢«æˆæƒçš„æ§åˆ¶å¹³é¢ç»„ä»¶æ‰èƒ½åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n\n```\nkubectl describe node master1 | grep -i taint\nkubectl describe node master2 | grep -i taint\nkubectl describe node master3 | grep -i taint\n```\n\n![image-20231111152324023](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/8b8acf56d0f0a8e48e0818575a12568b697559838.png)\n\nå»é™¤æ±¡ç‚¹\n\n```\nkubectl taint node master1 node-role.kubernetes.io/control-plane:NoSchedule-\nkubectl taint node master2 node-role.kubernetes.io/control-plane:NoSchedule-\nkubectl taint node master3 node-role.kubernetes.io/control-plane:NoSchedule-\n```\n\n![image-20231111152342956](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/4505f1906390d4d0c6092eed8db765f9697559838.png)\n\n## å®‰è£…dashboard\n\næ“ä½œèŠ‚ç‚¹[master1]\n\nä¸‹è½½æ–‡ä»¶\n\nhttps://github.com/kubernetes/dashboard/releases/tag/v2.7.0\n\nç›®å‰æœ€æ–°ç‰ˆæœ¬v2.7.0 \n\n```\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml\nsed -i 's/kubernetesui\\/dashboard:v2.7.0/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/dashboard:v2.7.0/g' recommended.yaml\nsed -i 's/kubernetesui\\/metrics-scraper:v1.0.8/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/metrics-scraper:v1.0.8/g' recommended.yaml\n```\n\n![image-20231014174400992](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/e5b7e6cd0c2a3d031b42e3471e220bbf697559838.png)\n\nä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```yaml\nvim recommended.yaml\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30001\n  type: NodePort\n  selector:\n    app: kubernetes-dashboard\n\n---\n```\n\n![image-20231014174511047](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/3327017a27ffdc97149d004b33a692a7697559838.png)\n\nè¿è¡Œdashboard\n\n```\nkubectl apply -f recommended.yaml\n```\n\n![image-20231014174622344](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/b1237cb08df67405f40a6670c3e1f80c697559838.png)\n\næ£€æŸ¥è¿è¡ŒçŠ¶æ€\n\n```\nkubectl get pods -n kubernetes-dashboard\nkubectl get pod,svc -o wide -n kubernetes-dashboard\n```\n\n![image-20231111025752605](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/941f9c38bede63a9ac31ad12ebef40d5697559838.png)\n\n### åˆ›å»ºcluster-adminç”¨æˆ·\n\n```\nåˆ›å»ºservice accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜ç¾¤è§’è‰²\n#åˆ›å»ºç”¨æˆ·\nkubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n#ç”¨æˆ·æˆæƒ\nkubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n#è·å–ç”¨æˆ·Token\nkubectl create token dashboard-admin -n kubernetes-dashboard\n```\n\n![image-20231111025817854](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/f47b22eb887a88cef935bd76a21af939697559838.png)\n\nè®°å½•token\n\n```\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJxb21sRTZSckhEZ09FMnlvWU5IY3dfTTRIWDEzRUpsQ000MThhSWxYNDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjk5NjQ2Mjg3LCJpYXQiOjE2OTk2NDI2ODcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIyNTBhNTQ2MS03MGJlLTRhZTItOWY2Yi1hMDQwOWE1NWJhMTMifX0sIm5iZiI6MTY5OTY0MjY4Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.U-lH9_sRU4TVrpAznqS60INNSev9NxHu61igGUTzTBoaWo7WjPG7vzTnpZYhvsoglTzMEKhfranJkkkn95pe-prkvSasaAL6kXHw0jQjlSMzcYiF7DoLdkOtDJSukuALEubidf9eIwZXFZ-sezZdZHm4hnk5nWme5YtdOmYOJPh5sv1dzRvM1XuOHknJPTA1BbdZuVAtSGHSjkhwx-wl-41uuQoROW5GjJs0bz4zLBFn1w_pWaSMCn7pjGJNcbr6IuDV41km_etpwwxacWyfAcxNykzCtIiE1abJj7m-e944GvAn_eqxz3wCZD6Bgt41FWRzyMHjrppJfDjk7FaHNw\n\n```\n\n### ç™»å½•æµè§ˆå™¨è®¿é—®\n\n```\nhttps://192.168.48.200:30001\n\nè¾“å…¥tokenï¼š\n----\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJxb21sRTZSckhEZ09FMnlvWU5IY3dfTTRIWDEzRUpsQ000MThhSWxYNDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjk5NjQ2Mjg3LCJpYXQiOjE2OTk2NDI2ODcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIyNTBhNTQ2MS03MGJlLTRhZTItOWY2Yi1hMDQwOWE1NWJhMTMifX0sIm5iZiI6MTY5OTY0MjY4Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.U-lH9_sRU4TVrpAznqS60INNSev9NxHu61igGUTzTBoaWo7WjPG7vzTnpZYhvsoglTzMEKhfranJkkkn95pe-prkvSasaAL6kXHw0jQjlSMzcYiF7DoLdkOtDJSukuALEubidf9eIwZXFZ-sezZdZHm4hnk5nWme5YtdOmYOJPh5sv1dzRvM1XuOHknJPTA1BbdZuVAtSGHSjkhwx-wl-41uuQoROW5GjJs0bz4zLBFn1w_pWaSMCn7pjGJNcbr6IuDV41km_etpwwxacWyfAcxNykzCtIiE1abJj7m-e944GvAn_eqxz3wCZD6Bgt41FWRzyMHjrppJfDjk7FaHNw\n\n----\n\n```\n\n![image-20231111025910110](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/0a7bbc42f311f76a92caaaf48e6c5328697559838.png)\n\n### éƒ¨ç½²ä¸€ä¸ªnginxæµ‹è¯•\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```yaml\nvim web.yaml\n\nkind: Deployment\n#apiVersion: extensions/v1beta1\napiVersion: apps/v1\nmetadata:\n  labels:\n    app: web-deployment-label\n  name: web-deployment\n  namespace: default\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-selector\n  template:\n    metadata:\n      labels:\n        app: web-selector\n    spec:\n      containers:\n      - name: web-container\n        image: nginx:latest\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 80\n          protocol: TCP\n          name: http\n        - containerPort: 443\n          protocol: TCP\n          name: https\n\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: web-service-label\n  name: web-service\n  namespace: default\nspec:\n  type: NodePort\n  ports:\n  - name: http\n    port: 80\n    protocol: TCP\n    targetPort: 80\n    nodePort: 30080\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: 443\n    nodePort: 30443\n  selector:\n    app: web-selector\n    \nkubectl apply -f web.yaml \n```\n\n![image-20231014180923818](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/f23a00d645442660869b7e461fa8909b697559838.png)\n\n```\n### æŸ¥çœ‹nginxçš„pod çš„è¯¦ç»†ä¿¡æ¯\nkubectl get deploy,svc,pod -o wide\n```\n\n![image-20231016203536987](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/188449aa6759f72c7a7bdb9843828ba3697559838.png)\n\nè®¿é—®nginxç½‘ç«™\n\n```\nhttp://192.168.48.200:30080\n```\n\n![image-20231111030413487](../img/OpenEuler-K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/b3740a04d81e31f25f486291feea4944697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["OpenEuler","K8s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"OpenEuler-K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå¤–éƒ¨etcdï¼‰","url":"/posts/2459/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# OpenEuler-éƒ¨ç½²K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå¤–éƒ¨etcdï¼‰\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå  | ip1ï¼ˆNATï¼‰     | ç³»ç»Ÿ                | ç£ç›˜ | å†…å­˜ |\n| ------- | -------------- | ------------------- | ---- | ---- |\n| master1 | 192.168.48.101 | OpenEuler-22.03-LTS | 100G | 4G   |\n| master2 | 192.168.48.102 | OpenEuler-22.03-LTS | 100G | 4G   |\n| master3 | 192.168.48.103 | OpenEuler-22.03-LTS | 100G | 4G   |\n| node01  | 192.168.48.104 | OpenEuler-22.03-LTS | 100G | 8G   |\n\né•œåƒä¸‹è½½åœ°å€ï¼š[OpenEuler-22.03-LTS](https://mirrors.nju.edu.cn/openeuler/openEuler-22.03-LTS-SP4/ISO/x86_64/)\n\nä¸‹è½½åä¸ºopenEuler-22.03-LTS-SP4-x86_64-dvd.iso\n\n## åŸºç¡€é…ç½®\n\nOpeneuleré€šè¿‡å•ç‹¬å®‰è£…ï¼Œéå…‹éš†ã€‚å®‰è£…å®Œåè¿›è¡ŒåŸºæœ¬ç¯å¢ƒçš„é…ç½®ï¼Œé…ç½®ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n1. è®¾ç½®ä¸»æœºå\n2. å…³é—­firewalldã€dnsmasqã€selinux\n3. è®¾ç½®ens33\n4. å¤‡ä»½å¹¶æ–°å¢ã€docker-ceæºã€k8sæº\n5. æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\n6. æ·»åŠ hostsè§£æ\n7. å…³é—­swapåˆ†åŒº\n8. å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\n9. é…ç½®limits.conf\n10. å®‰è£…å¿…å¤‡å·¥å…·\n11. å‡çº§ç³»ç»Ÿå¹¶é‡å¯\n\næ“ä½œä¸»æœºï¼š[master1,master2,master3,node01]\n\n```\n#å°†ä»¥ä¸‹è„šæœ¬å†…å®¹æ·»åŠ è¿›å»\nvi k8s_system_init.sh\n```\n\n```\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\necho \"2.æ­£åœ¨å…³é—­firewalldã€dnsmasqã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl disable dnsmasq &> /dev/null\nsystemctl stop firewalld\nsystemctl stop dnsmasq\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nNAME=ens33\nUUID=53b402ff-5865-47dd-a853-7afcd6521738\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS1=192.168.48.2\nDNS2=114.114.114.114\nEOF\nnmcli c reload\nnmcli c up ens33\n\n\necho \"4.æ–°å¢docker-ceæºã€k8sæº\"\nmkdir /etc/yum.repos.d/bak/\ncp /etc/yum.repos.d/* /etc/yum.repos.d/bak/\nsleep 3\ncat > /etc/yum.repos.d/kubernetes.repo <<EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg \nEOF\n#åˆ‡æ¢ä¸ºåä¸ºäº‘ï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿«\nsed -i 's/\\$basearch/x86_64/g' /etc/yum.repos.d/openEuler.repo\nsed -i 's/http\\:\\/\\/repo.openeuler.org/https\\:\\/\\/mirrors.huaweicloud.com\\/openeuler/g' /etc/yum.repos.d/openEuler.repo\n\ncurl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsed -i 's/\\$releasever/7/g' /etc/yum.repos.d/docker-ce.repo\n\necho \"5.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\n yum clean all && yum makecache\n\necho \"6.æ·»åŠ hostsè§£æ\"\ncat > /etc/hosts <<EOF\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.101 master1\n192.168.48.102 master2\n192.168.48.103 master3\n192.168.48.104 node01\n192.168.48.105 node02\nEOF\n\n\necho \"7.å…³é—­swapåˆ†åŒº\"\nswapoff -a && sysctl -w vm.swappiness=0 &> /dev/null\nsed -ri '/^[^#]*swap/s@^@#@' /etc/fstab\n\n\necho \"8.å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\"\nyum install chrony -y\nsystemctl start chronyd\nsystemctl enable chronyd\nchronyc sources\nchronyc sources\n\necho \"9.é…ç½®limits.conf\"\nulimit -SHn 65535\ncat >> /etc/security/limits.conf <<EOF\n* soft nofile 65536\n* hard nofile 131072\n* soft nproc 65535\n* hard nproc 655350\n* soft memlock unlimited\n* hard memlock unlimited\nEOF\n\n\necho \"10.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet device-mapper-persistent-data lvm2 git -y\n\n\necho \"11.é‡å¯\"\nreboot\n```\n\n```\nsh k8s_system_init.sh ä¸»æœºå  ä¸»æœºä½\n[master1] sh k8s_system_init.sh master1 101\n\n[master2] sh k8s_system_init.sh master2 102\n\n[master3] sh k8s_system_init.sh master3 103\n\n[node01] sh k8s_system_init.sh node01 104\n\n```\n\n### é…ç½®sshå…å¯†\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"master1\" \"master2\" \"master3\" \"node01\")\n# å¯†ç \npassword=\"Lj201840.\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## å†…æ ¸åŠipvsæ¨¡å—é…ç½®\n\næ­¤æ­¥éª¤æ˜¯é…ç½®ipvsæ¨¡å—ï¼Œå¼€å¯ä¸€äº›k8sé›†ç¾¤ä¸­å¿…é¡»çš„å†…æ ¸å‚æ•°ã€‚é…ç½®ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n1. æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº\n2. å®‰è£…ipvsadm\n3. é…ç½®ipvsæ¨¡å—\n4. å¼€å¯k8sé›†ç¾¤å¿…é¡»çš„å†…æ ¸å‚æ•°\n5. é…ç½®å®Œå†…æ ¸ï¼Œé‡å¯æœåŠ¡å™¨\n\næ“ä½œä¸»æœºï¼š[master1,master2,master3,node01]\n\n```\nvi kernel_update.sh\n```\n\n```\n#!/bin/bash\n\necho \"1.æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº\"\ngrub2-set-default  0 && grub2-mkconfig -o /etc/grub2.cfg\ngrubby --args=\"user_namespace.enable=1\" --update-kernel=\"$(grubby --default-kernel)\"\n\necho \"2.å®‰è£…ipvsadm\"\nyum install ipvsadm ipset sysstat conntrack libseccomp -y &> /dev/null\n\n\necho \"3.é…ç½®ipvsæ¨¡å—\"\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack\n\ncat >> /etc/modules-load.d/ipvs.conf <<EOF\nip_vs\nip_vs_lc\nip_vs_wlc\nip_vs_rr\nip_vs_wrr\nip_vs_lblc\nip_vs_lblcr\nip_vs_dh\nip_vs_sh\nip_vs_fo\nip_vs_nq\nip_vs_sed\nip_vs_ftp\nip_vs_sh\nnf_conntrack\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\nEOF\nsystemctl enable --now systemd-modules-load.service &> /dev/null\n\n\necho \"4.å¼€å¯k8sé›†ç¾¤å¿…é¡»çš„å†…æ ¸å‚æ•°\"\ncat <<EOF > /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_nonlocal_bind = 1 \nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nfs.may_detach_mounts = 1\nnet.ipv4.conf.all.route_localnet = 1\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.netfilter.nf_conntrack_max=2310720\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl =15\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_orphans = 327680\nnet.ipv4.tcp_orphan_retries = 3\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.ip_conntrack_max = 65536\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_timestamps = 0\nnet.core.somaxconn = 16384\nEOF\nsysctl --system\n\n\necho \"5.é…ç½®å®Œå†…æ ¸ï¼Œé‡å¯æœåŠ¡å™¨ï¼\"\nreboot\n\n```\n\n```\nsh kernel_update.sh\n```\n\n## æ£€æŸ¥ipvsåŠ è½½ã€å†…æ ¸ç‰ˆæœ¬éªŒè¯\n\n```\nlsmod | grep --color=auto -e ip_vs -e nf_conntrack\nuname -a\n```\n\n![image-20231201233238841](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/172c341f6eb660349513110db6396f8a697559838.png)\n\n## éƒ¨ç½²ETCDé›†ç¾¤\n\næœ¬æ¬¡åœ¨master1ã€master2ã€master3ä¸Šè¿›è¡Œetcdé›†ç¾¤éƒ¨ç½²\n\n### å®‰è£…etcd\n\n#### ä¸‹è½½å®‰è£…åŒ…\n\n```\nwget https://github.com/etcd-io/etcd/releases/download/v3.5.13/etcd-v3.5.13-linux-amd64.tar.gz\n```\n\n![image-20240415172117528](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/11286bc829bf03be81ded0fad06d517c697559838.png)\n\n#### è§£å‹\n\n```\ntar xf etcd-v3.5.13-linux-amd64.tar.gz\nmv etcd-v3.5.13-linux-amd64 /tmp/etcd\ncp /tmp/etcd/etcd* /usr/local/bin/\n```\n\n![image-20240415172055623](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/2f7ad631cf19c2667d0705ebe99592d0697559838.png)\n\n#### æ·»åŠ ç¯å¢ƒå˜é‡\n\nå°†æ–‡ä»¶å¤¹ä¸­**etcd**å’Œ**etcdctl**ä¸¤ä¸ªæ–‡ä»¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­\n\n```\nmkdir -p /var/lib/etcd/\nmkdir -p /etc/etcd/\nchmod 700 /var/lib/etcd\n```\n\n![image-20231015012808701](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/a4a8fc0d3df4db52ff269165d72b3d2a697559838.png)\n\n#### åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶\n\n```\ncat <<EOF | sudo tee /etc/etcd/etcd.conf\n#èŠ‚ç‚¹åç§°\nETCD_NAME=$(hostname -s)\n#æ•°æ®å­˜æ”¾ä½ç½®\nETCD_DATA_DIR=/var/lib/etcd\nEOF\n```\n\n![image-20231015012819394](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/8f2cb9b53e68cac0cf269016f0cbee01697559838.png)\n\n#### åˆ›å»ºetcdæœåŠ¡\n\n```\ncat <<EOF | sudo tee /etc/systemd/system/etcd.service\n \n[Unit]\nDescription=Etcd Server\nDocumentation=https://github.com/coreos/etcd\nAfter=network.target\n \n[Service]\nUser=root\nType=notify\nEnvironmentFile=-/etc/etcd/etcd.conf\nExecStart=/usr/local/bin/etcd\nRestart=on-failure\nRestartSec=10s\nLimitNOFILE=40000\n \n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n![image-20231015012847141](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/5641c565bdf99103532207244fcf0c14697559838.png)\n\n#### å¼€å¯æœåŠ¡\n\n```\nsystemctl daemon-reload && systemctl enable etcd && systemctl start etcd\n```\n\n![image-20231015012901227](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/055cf2ac1363668a505d2a1e70d0adbb697559838.png)\n\n#### **æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯**\n\n```\netcd -version\n```\n\n![image-20231201234123720](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/c4e6dc2a872878b201e356076ed65799697559838.png)\n\n### åœ¨<font color='red'>master1</font>èŠ‚ç‚¹ä¸Šç”Ÿæˆetcdé…ç½®æ–‡ä»¶\n\n```\nvim etcd_install.sh\n```\n\n```\netcd1=192.168.48.101\netcd2=192.168.48.102\netcd3=192.168.48.103\n\nTOKEN=smartgo\nETCDHOSTS=($etcd1 $etcd2 $etcd3)\nNAMES=(\"master1\" \"master2\" \"master3\")\nfor i in \"${!ETCDHOSTS[@]}\"; do\nHOST=${ETCDHOSTS[$i]}\nNAME=${NAMES[$i]}\ncat << EOF > /tmp/$NAME.conf\n# [member]\nETCD_NAME=$NAME\nETCD_DATA_DIR=\"/var/lib/etcd/default.etcd\"\nETCD_LISTEN_PEER_URLS=\"http://$HOST:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://$HOST:2379,http://127.0.0.1:2379\"\n#[cluster]\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://$HOST:2380\"\nETCD_INITIAL_CLUSTER=\"${NAMES[0]}=http://${ETCDHOSTS[0]}:2380,${NAMES[1]}=http://${ETCDHOSTS[1]}:2380,${NAMES[2]}=http://${ETCDHOSTS[2]}:2380\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\nETCD_INITIAL_CLUSTER_TOKEN=\"$TOKEN\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://$HOST:2379\"\nEOF\ndone\nls /tmp/master*\nscp /tmp/master2.conf $etcd2:/etc/etcd/etcd.conf\nscp /tmp/master3.conf $etcd3:/etc/etcd/etcd.conf\ncp /tmp/master1.conf /etc/etcd/etcd.conf\nrm -f /tmp/master*.conf\n```\n\n![image-20231014195615912](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/7897e265466dc29664ceeca604116fc2697559838.png)\n\n```\nsh etcd_install.sh\n```\n\n![image-20231014195602840](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/0cae78bd52f7275854186f864d3f7387697559838.png)\n\n### åœ¨k8sé›†ç¾¤masterèŠ‚ç‚¹ä¸Šå¯åŠ¨etcd\n\n```\nsystemctl restart etcd\nsystemctl enable --now etcd\n```\n\n![image-20231014195712942](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/9ef822be06209ae69f5e0c898e2a321c697559838.png)\n\n### æ£€æŸ¥etcdé›†ç¾¤æ˜¯å¦æ­£å¸¸\n\n```\netcdctl member list\netcdctl endpoint health\n```\n\n![image-20231015013040955](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/165629df49d6688aaa227ead76653327697559838.png)\n\n![image-20231015013053386](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/7f3a5409aa09bd3ece2b527e05c623ba697559838.png)\n\n![image-20231015013100578](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/4aaef3d61e5580590a0e0d148136a2ec697559838.png)\n\n##  é«˜å¯ç”¨ç»„ä»¶å®‰è£…\n\n### haproxyé…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\n```\nyum install keepalived haproxy -y\n```\n\næ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®HAProxyï¼Œæ‰€æœ‰MasterèŠ‚ç‚¹çš„HAProxyé…ç½®ç›¸åŒã€‚\n\n```yaml\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2, master3]\ncat > /etc/haproxy/haproxy.cfg <<\"EOF\"\n\nglobal\n  maxconn  2000\n  ulimit-n  16384\n  log  127.0.0.1 local0 err\n  stats timeout 30s\n\ndefaults\n  log global\n  mode  http\n  option  httplog\n  timeout connect 5000\n  timeout client  50000\n  timeout server  50000\n  timeout http-request 15s\n  timeout http-keep-alive 15s\n\nfrontend monitor-in\n  bind *:33305\n  mode http\n  option httplog\n  monitor-uri /monitor\n\nfrontend k8s-master\n  bind 0.0.0.0:16443\n  bind 127.0.0.1:16443\n  mode tcp\n  option tcplog\n  tcp-request inspect-delay 5s\n  default_backend k8s-master\n\nbackend k8s-master\n  mode tcp\n  option tcplog\n  option tcp-check\n  balance roundrobin\n  default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100\n  server master1   192.168.48.101:6443  check\n  server master2   192.168.48.102:6443  check\n  server master3   192.168.48.103:6443  check\nEOF\n```\n\n### Keepalivedé…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\næ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®Keepalivedï¼Œä»¥ä¸‹ä¸‰ä¸ªMasterèŠ‚ç‚¹é…ç½®æ³¨æ„ipå’Œç½‘å¡ã€‚\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master1]\n\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state MASTER\n    interface ens33\n    mcast_src_ip 192.168.48.101\n    virtual_router_id 51\n    priority 101\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master2]\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state BACKUP\n    interface ens33\n    mcast_src_ip 192.168.48.102\n    virtual_router_id 51\n    priority 100\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master3]\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state BACKUP\n    interface ens33\n    mcast_src_ip 192.168.48.103\n    virtual_router_id 51\n    priority 99\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n### é…ç½®Keepalivedå¥åº·æ£€æŸ¥æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\n```\ncat > /etc/keepalived/check_apiserver.sh <<\"EOF\"\n #!/bin/bash\n err=0\n for k in $(seq 1 3)\n do\n    check_code=$(pgrep haproxy)\n    if [[ $check_code == \"\" ]]; then\n        err=$(expr $err + 1)\n        sleep 1\n        continue\n    else\n        err=0\n        break\n    fi\n done\n \n if [[ $err != \"0\" ]]; then\n    echo \"systemctl stop keepalived\"\n    /usr/bin/systemctl stop keepalived\n    exit 1\n else\n    exit 0\n fi\nEOF\n\nchmod +x /etc/keepalived/check_apiserver.sh\n```\n\n### å¯åŠ¨haproxyå’Œkeepalived\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[masterï¼Œmaster2,master3]\nsystemctl daemon-reload\nsystemctl enable --now haproxy\nsystemctl enable --now keepalived\n```\n\n### æµ‹è¯•é›†ç¾¤è´Ÿè½½å‡è¡¡é«˜å¯ç”¨\n\næŸ¥çœ‹master1çš„vip\n\n```\nip a\n```\n\n![image-20231109232708584](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/c056fd53ea94319afdcbfd30f2bd32bf697559838.png)\n\næ¨¡æ‹Ÿmaster1çš„å®•æœºæµ‹è¯•ï¼Œçœ‹çœ‹vipä¼šä¸ä¼šæ¼‚ç§»åˆ°master2å»\n\n```\n[master1] poweroff\n```\n\n![image-20231109232803276](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/e38cdfec8d2832c3b0cc5fda8a1dfa47697559838.png)\n\nè¿™æ—¶å€™æŸ¥çœ‹master2çš„ipåˆ—è¡¨\n\n```\n[master2] ip a\n```\n\n![image-20231109232825999](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/cfbcf94ba4e1a5ee2b56eedfd315202d697559838.png)\n\nç»“è®ºï¼šè¿™æ—¶å¯ä»¥çŸ¥é“ï¼Œè´Ÿè½½å‡è¡¡é›†ç¾¤æˆåŠŸï¼Œå½“master1å‡ºç°å®•æœºæƒ…å†µï¼Œvipä¼šä»master1æ¼‚ç§»åˆ°master2\n\n## dockerå®‰è£…\n\n### å®‰è£…docker\n\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\n```\nwget https://download.docker.com/linux/static/stable/x86_64/docker-24.0.7.tgz\ntar xf docker-*.tgz\ncp -rf docker/* /usr/bin/\n#åˆ›å»ºcontainerdçš„serviceæ–‡ä»¶,å¹¶ä¸”å¯åŠ¨\ncat >/etc/systemd/system/containerd.service <<EOF\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=1048576\nTasksMax=infinity\nOOMScoreAdjust=-999\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl enable --now containerd.service\n\n#å‡†å¤‡dockerçš„serviceæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.service <<EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service containerd.service\nWants=network-online.target\nRequires=docker.socket containerd.service\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd --config-file=/etc/docker/daemon.json -H fd://\ncontainerd=/run/containerd/containerd.sock\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\nOOMScoreAdjust=-500\n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å‡†å¤‡dockerçš„socketæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.socket <<EOF\n[Unit]\nDescription=Docker Socket for the API\n[Socket]\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n[Install]\nWantedBy=sockets.target\nEOF\ngroupadd docker\n\nsystemctl enable --now docker.socket  && systemctl enable --now docker.service\n\n\n#éªŒè¯\nmkdir /etc/docker\nsudo tee /etc/docker/daemon.json > /dev/null <<'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.xuanyuan.me\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://docker.1panel.live\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n\t\t\"https://docker.qianyios.top\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  },\n  \"data-root\": \"/var/lib/docker\"\n}\nEOF\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n### å®‰è£…cri-docker\n\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\n```\nwget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.12/cri-dockerd-0.3.12.amd64.tgz\n\ntar -zxvf cri-dockerd-0.3.12.amd64.tgz\ncp cri-dockerd/cri-dockerd  /usr/bin/\nchmod +x /usr/bin/cri-dockerd\n\n\n#å†™å…¥å¯åŠ¨é…ç½®æ–‡ä»¶\ncat >  /usr/lib/systemd/system/cri-docker.service <<EOF\n[Unit]\nDescription=CRI Interface for Docker Application Container Engine\nDocumentation=https://docs.mirantis.com\nAfter=network-online.target firewalld.service docker.service\nWants=network-online.target\nRequires=cri-docker.socket\n \n[Service]\nType=notify\nExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.9\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\n \nStartLimitBurst=3\n \nStartLimitInterval=60s\n \nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\n \nTasksMax=infinity\nDelegate=yes\nKillMode=process\n \n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å†™å…¥socketé…ç½®æ–‡ä»¶\ncat > /usr/lib/systemd/system/cri-docker.socket <<EOF\n[Unit]\nDescription=CRI Docker Socket for the API\nPartOf=cri-docker.service\n \n[Socket]\nListenStream=%t/cri-dockerd.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n \n[Install]\nWantedBy=sockets.target\nEOF\n\nsystemctl daemon-reload && systemctl enable cri-docker --now\n```\n\n## K8Sé›†ç¾¤å®‰è£…\n\n### å®‰è£…k8sæ‰€éœ€çš„å·¥å…·\n\n```\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\nyum -y install  kubeadm kubelet kubectl\n\n#ä¸ºäº†å®ç°dockerä½¿ç”¨çš„cgroupdriverä¸kubeletä½¿ç”¨çš„cgroupçš„ä¸€è‡´æ€§ï¼Œé…ç½®å¦‚ä¸‹ï¼š\nsed -i 's/^KUBELET_EXTRA_ARGS=/KUBELET_EXTRA_ARGS=\"--cgroup-driver=systemd\"/g' /etc/sysconfig/kubelet\n\n#è®¾ç½®kubeletä¸ºå¼€æœºè‡ªå¯åŠ¨å³å¯ï¼Œç”±äºæ²¡æœ‰ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé›†ç¾¤åˆå§‹åŒ–åè‡ªåŠ¨å¯åŠ¨\nsystemctl enable kubelet\nsystemctl enable kubelet.service\n```\n\n### åˆå§‹åŒ–é›†ç¾¤\n\n```\ncat > kubeadm-config.yaml << EOF\n---\napiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 192.168.48.101\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/cri-dockerd.sock\n---\napiVersion: kubeadm.k8s.io/v1beta3\nkind: ClusterConfiguration\nkubernetesVersion: 1.28.2\nimageRepository: registry.aliyuncs.com/google_containers\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 10.244.0.0/16\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\napiServerCertSANs:\n- 192.168.48.200\ncontrolPlaneEndpoint: \"192.168.48.200:16443\"\netcd:\n  external:\n    endpoints:\n      - http://192.168.48.101:2379\n      - http://192.168.48.102:2379\n      - http://192.168.48.103:2379\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nfeatureGates:\n  # SupportIPVSProxyMode: false\nmode: ipvs\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\ncgroupDriver: systemd\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging:\n  flushFrequency: 0\n  options:\n    json:\n      infoBufferSize: \"0\"\n  verbosity: 0\nmemorySwap: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\nEOF\n\n```\n\n### å‡†å¤‡k8sæ‰€éœ€çš„é•œåƒ\n\n```\næ“ä½œèŠ‚ç‚¹[master1]\n\nkubeadm config images pull --config kubeadm-config.yaml\n```\n\n![image-20231202000515399](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/9fedff61048258078e518d11118b9251697559838.png)\n\n### master1èŠ‚ç‚¹åˆå§‹åŒ–\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nkubeadm init --config kubeadm-config.yaml --upload-certs --v=9\n```\n\nä¼šç”Ÿæˆä¿¡æ¯\n\n![image-20231202000611013](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/5829c27c107b54a0d91955190139d113697559838.png)\n\nè®°å½•ä¿¡æ¯åé¢ä¼šç”¨åˆ°\n\nåˆå§‹åŒ–æˆåŠŸä»¥åï¼Œä¼šäº§ç”ŸTokenå€¼ï¼Œç”¨äºå…¶ä»–èŠ‚ç‚¹åŠ å…¥æ—¶ä½¿ç”¨ï¼Œå› æ­¤è¦è®°å½•ä¸‹åˆå§‹åŒ–æˆåŠŸç”Ÿæˆçš„tokenå€¼ï¼ˆä»¤ç‰Œå€¼ï¼‰ï¼Œ**æœ‰æ•ˆæœŸ24å°æ—¶ï¼Œåç»­éœ€è¦æ“ä½œå¯ä»¥é‡æ–°ç”ŸæˆToken**\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612 \\\n        --control-plane --certificate-key 37b1370abd3584c354517603bf97e10c795e3367e05e5ff3f2f6ca14288d8054\n\n\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612\n```\n\n`æ“ä½œkubectæŠ¥é”™ï¼š`\n\n![image-20231110180035297](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/fefa374e5d13878092f01fb03ed253a6697559838.png)\n\næ­¤æ—¶é€šè¿‡kubectlæ“ä½œï¼Œä¼šå‡ºç°å¤±è´¥ï¼Œå› ä¸ºè¿˜æ²¡æœ‰å°†é›†ç¾¤çš„\"é’¥åŒ™\"äº¤ç»™rootç”¨æˆ·ã€‚`/etc/kubernetes/admin.conf` æ–‡ä»¶æ˜¯ Kubernetesï¼ˆK8sï¼‰é›†ç¾¤ä¸­çš„ç®¡ç†å‘˜é…ç½®æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ç”¨äºç®¡ç†é›†ç¾¤çš„èº«ä»½éªŒè¯å’Œè®¿é—®ä¿¡æ¯ã€‚æ‰€ä»¥ä¸‹é¢è¿›è¡Œé…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®Kubernetesé›†ç¾¤ï¼š\n\n`æ·»åŠ ç¯å¢ƒå˜é‡`\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n### æ·»åŠ å…¶ä»–masterèŠ‚ç‚¹è‡³é›†ç¾¤ä¸­\n\næ“ä½œèŠ‚ç‚¹[master2,master3]\n\n```\næ“ä½œèŠ‚ç‚¹[master2,master3]\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612 \\\n        --control-plane --certificate-key 37b1370abd3584c354517603bf97e10c795e3367e05e5ff3f2f6ca14288d8054 \\\n        --cri-socket unix:///var/run/cri-dockerd.sock \n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\næ¥ç€ç»™`master2`æ·»åŠ ç¯å¢ƒå˜é‡\n\n```\næ“ä½œèŠ‚ç‚¹[master2,master3]\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n![image-20231110180919008](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/f28981c217fe0f91573bcac90ed8e152697559838.png)\n\nè¿™é‡Œæ²¡æœ‰å±•ç¤ºmaster3çš„å›¾ç‰‡ï¼Œä½†æ˜¯æ­¥éª¤ä¸€æ ·çš„\n\n### æ¨¡æ‹ŸTokenè¿‡æœŸé‡æ–°ç”Ÿæˆå¹¶åŠ å…¥NodeèŠ‚ç‚¹\n\nå‡è®¾åŠ å…¥é›†ç¾¤çš„tokenè¿‡æœŸäº†ã€‚node01æ— æ³•åŠ å…¥äº†ï¼Œè¿™é‡Œå°±æ¨¡æ‹Ÿä¸€ä¸‹è¿™ç§æƒ…å†µ\n\n1. Tokenè¿‡æœŸåç”Ÿæˆæ–°çš„tokenï¼š\n\n```bash\nkubeadm token create --print-join-command\n```\n\n```\n[root@master1 ~]# kubeadm token create --print-join-command\nkubeadm join 192.168.48.200:16443 --token ke773y.6hv9utk33to4vwfy --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612\n[root@master1 ~]#\n\n```\n\nå…¶ä¸­ï¼Œ`192.168.48.200:16443` æ˜¯ä½ çš„ Kubernetes API æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ï¼Œ`ke773y.6hv9utk33to4vwfy` æ˜¯æ–°çš„ä»¤ç‰Œï¼Œ`sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612` æ˜¯ä»¤ç‰Œçš„ CA è¯ä¹¦å“ˆå¸Œå€¼ã€‚\n\n2. Masteréœ€è¦ç”Ÿæˆ--certificate-keyï¼š\n\n```bash\nkubeadm init phase upload-certs --upload-certs\n```\n\n```\n[root@master1 ~]# kubeadm init phase upload-certs --upload-certs\nW1110 18:12:03.426245   10185 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW1110 18:12:03.426320   10185 version.go:105] falling back to the local client version: v1.28.2\n[upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n[upload-certs] Using certificate key:\n5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nå…¶ä¸­ï¼Œ`5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128` æ˜¯è¯ä¹¦å¯†é’¥ã€‚\n\n3. ç”Ÿæˆæ–°çš„Tokenç”¨äºé›†ç¾¤æ·»åŠ æ–°NodeèŠ‚ç‚¹\n\næ“ä½œèŠ‚ç‚¹[node01]\n\n```\nkubeadm join 192.168.48.200:16443 \\\n        --token ke773y.6hv9utk33to4vwfy \\\n        --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612  \\\n        --cri-socket unix:///var/run/cri-dockerd.sock \n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\n![image-20231110181623386](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/0a11667e5c9aa7d99b42b680cf28ef43697559838.png)\n\nè¿™æ—¶åœ¨masteræŸ¥çœ‹nodeçŠ¶æ€ï¼ˆæ˜¾ç¤ºä¸ºnotreadyä¸å½±å“ï¼‰\n\n![image-20231111145807000](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/fd5c8370fdba5ace21ff70b1bd7a623d697559838.png)\n\n### æ¨¡æ‹Ÿæ–°åŠ masterèŠ‚ç‚¹çš„åŠ å…¥K8Sé›†ç¾¤ä¸­\n\nå‡è®¾æˆ‘ä»¬æ–°åŠ masterèŠ‚ç‚¹çš„è¯ï¼Œå°±æ‹¼æ¥tokenï¼Œ`ä»åˆšåˆšç”Ÿæˆçš„tokenæ‹¼æ¥`\n\n```\n[root@master1 ~]# kubeadm token create --print-join-command\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n```\n\nè¿™é‡Œæå–ä¿¡æ¯1\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n```\n\næ¥ç€\n\n```\n[root@master1 ~]# kubeadm init phase upload-certs --upload-certs\nW1110 18:12:03.426245   10185 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW1110 18:12:03.426320   10185 version.go:105] falling back to the local client version: v1.28.2\n[upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n[upload-certs] Using certificate key:\n5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nè¿™é‡Œæå–ä¿¡æ¯2ï¼šè¿™é‡Œå‰é¢è¦åŠ ä¸Š`--control-plane --certificate-key`\n\n```\n--control-plane --certificate-key 5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nåˆæˆ\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f  \\\n        --control-plane --certificate-key 5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128 \\\n        --cri-socket unix:///var/run/cri-dockerd.sock\n        \n        \nkubeadm join 192.168.48.200:16443 --token lnkno8.u4v1l8n9pahzf0kj \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f \\\n        --control-plane --certificate-key 41e441fe56cb4bdfcc2fc0291958e6b1da54d01f4649b6651471c07583f85cdf \\\n        --cri-socket unix:///var/run/cri-dockerd.sock\n\n\n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\nå›¾ç¤º\n\n![image-20231110182741430](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/4a97b357d8fcf1ab20396d46fa4207e7697559838.png)\n\n## å®‰è£…calicoç½‘ç»œæ’ä»¶\n\næ“ä½œèŠ‚ç‚¹[master1]\n\næ·»åŠ è§£æè®°å½•ï¼Œå¦åˆ™æ— æ³•è®¿é—®\n\n```\necho '185.199.108.133 raw.githubusercontent.com' >> /etc/hosts\n```\n\n### åº”ç”¨operatorèµ„æºæ¸…å•æ–‡ä»¶\n\nç½‘ç»œç»„ä»¶æœ‰å¾ˆå¤šç§ï¼Œåªéœ€è¦éƒ¨ç½²å…¶ä¸­ä¸€ä¸ªå³å¯ï¼Œæ¨èCalicoã€‚ \nCalicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼ŒCalicoæ”¯æŒå¹¿æ³›çš„å¹³å°ï¼ŒåŒ…æ‹¬Kubernetesã€OpenStackç­‰ã€‚ \nCalico åœ¨æ¯ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹åˆ©ç”¨ Linux Kernel å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„è™šæ‹Ÿè·¯ç”±å™¨ï¼ˆ vRouterï¼‰ æ¥è´Ÿè´£æ•°æ®è½¬å‘ï¼Œè€Œæ¯ä¸ª vRouter é€šè¿‡ BGP åè®®è´Ÿè´£æŠŠè‡ªå·±ä¸Šè¿è¡Œçš„ workload çš„è·¯ç”±ä¿¡æ¯å‘æ•´ä¸ª Calico ç½‘ç»œå†…ä¼ æ’­ã€‚ \næ­¤å¤–ï¼ŒCalico é¡¹ç›®è¿˜å®ç°äº† Kubernetes ç½‘ç»œç­–ç•¥ï¼Œæä¾›ACLåŠŸèƒ½ã€‚\n\n```\ncurl https://raw.githubusercontent.com/projectcalico/calico/v3.25.1/manifests/calico.yaml -O\n```\n\n```yaml\n[root@master1 ~]# vim calico.yaml\nã€‚ã€‚ã€‚ã€‚ã€‚\n- name: WAIT_FOR_DATASTORE\n  value: \"true\"\n  #æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œ\n- name: IP_AUTODETECTION_METHOD\n  value: interface=ens33\n#ens33æ˜¯ä½ çš„ç½‘å¡\n```\n\n![image-20231110183944854](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/7d33aa399268a12dfbb757f1436c6a8a697559838.png)\n\n```\nsed -i 's| docker.io/calico/| registry.cn-hangzhou.aliyuncs.com/qianyios/|' calico.yaml\nkubectl apply -f calico.yaml\n```\n\n![image-20231110184031455](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/5deef971f2349641bcbd972ecb01be1a697559838.png)\n\n### ç›‘è§†kube-systemå‘½åç©ºé—´ä¸­podè¿è¡Œæƒ…å†µ\n\nç­‰å¾…ä¼°è®¡20åˆ†é’Ÿå·¦å³å§(ç¡®ä¿å…¨éƒ¨running)\n\n```\nkubectl get pods -n kube-system\n```\n\n![image-20231110193921266](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/3a877ccea193177ddf12995dd591ac1a697559838.png)\n\n### æ‹¿æ‰masterèŠ‚ç‚¹çš„æ±¡ç‚¹\n\nèŠ‚ç‚¹ master1 å’Œ master2 éƒ½æœ‰ä¸€ä¸ªåä¸º `node-role.kubernetes.io/control-plane:NoSchedule` çš„æ±¡ç‚¹ã€‚è¿™ä¸ªæ±¡ç‚¹çš„ä½œç”¨æ˜¯é˜»æ­¢æ™®é€šçš„ Pod è¢«è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šï¼Œåªå…è®¸ç‰¹å®šçš„æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆå¦‚ kube-apiserverã€kube-controller-manager å’Œ kube-schedulerï¼‰åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n\nè¿™ç§è®¾ç½®æœ‰åŠ©äºç¡®ä¿æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸“é—¨ç”¨äºè¿è¡Œ Kubernetes çš„æ ¸å¿ƒç»„ä»¶ï¼Œè€Œä¸ä¼šè¢«æ™®é€šçš„å·¥ä½œè´Ÿè½½å ç”¨ã€‚é€šè¿‡å°†æ±¡ç‚¹æ·»åŠ åˆ°èŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥ç¡®ä¿åªæœ‰è¢«æˆæƒçš„æ§åˆ¶å¹³é¢ç»„ä»¶æ‰èƒ½åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n\n```\nkubectl describe node master1 | grep -i taint\nkubectl describe node master2 | grep -i taint\nkubectl describe node master3 | grep -i taint\n```\n\n![image-20231111152324023](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/df8eab00f259e7857b7376580c10e265697559838.png)\n\nå»é™¤æ±¡ç‚¹\n\n```\nkubectl taint node master1 node-role.kubernetes.io/control-plane:NoSchedule-\nkubectl taint node master2 node-role.kubernetes.io/control-plane:NoSchedule-\nkubectl taint node master3 node-role.kubernetes.io/control-plane:NoSchedule-\n```\n\n![image-20231111152342956](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/440c55180b12cc13c70889f569e6df2a697559838.png)\n\n## å®‰è£…dashboard\n\næ“ä½œèŠ‚ç‚¹[master1]\n\nä¸‹è½½æ–‡ä»¶\n\nhttps://github.com/kubernetes/dashboard/releases/tag/v2.7.0\n\nç›®å‰æœ€æ–°ç‰ˆæœ¬v2.7.0 \n\n```\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml\nsed -i 's/kubernetesui\\/dashboard:v2.7.0/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/dashboard:v2.7.0/g' recommended.yaml\nsed -i 's/kubernetesui\\/metrics-scraper:v1.0.8/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/metrics-scraper:v1.0.8/g' recommended.yaml\n```\n\n![image-20231014174400992](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/dc94aa0b268990ba35b69f63ee1e4425697559838.png)\n\nä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```yaml\nvim recommended.yaml\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30001\n  type: NodePort\n  selector:\n    app: kubernetes-dashboard\n\n---\n```\n\n![image-20231014174511047](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/106f6e666e0fe6147ee3804ee807d094697559838.png)\n\nè¿è¡Œdashboard\n\n```\nkubectl apply -f recommended.yaml\n```\n\n![image-20231014174622344](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/8c81fcb3a5858585b3e3d399896be60c697559838.png)\n\næ£€æŸ¥è¿è¡ŒçŠ¶æ€\n\n```\nkubectl get pods -n kubernetes-dashboard\nkubectl get pod,svc -o wide -n kubernetes-dashboard\n```\n\n![image-20231111025752605](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/e1ca8cd9e0b98706124877b8da192bc8697559838.png)\n\n### åˆ›å»ºcluster-adminç”¨æˆ·\n\n```\nåˆ›å»ºservice accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜ç¾¤è§’è‰²\n#åˆ›å»ºç”¨æˆ·\nkubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n#ç”¨æˆ·æˆæƒ\nkubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n#è·å–ç”¨æˆ·Token\nkubectl create token dashboard-admin -n kubernetes-dashboard\n```\n\n![image-20231111025817854](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/ed6bc492c9fe47747ad7dd31483e4262697559838.png)\n\nè®°å½•token\n\n```\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJxb21sRTZSckhEZ09FMnlvWU5IY3dfTTRIWDEzRUpsQ000MThhSWxYNDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjk5NjQ2Mjg3LCJpYXQiOjE2OTk2NDI2ODcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIyNTBhNTQ2MS03MGJlLTRhZTItOWY2Yi1hMDQwOWE1NWJhMTMifX0sIm5iZiI6MTY5OTY0MjY4Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.U-lH9_sRU4TVrpAznqS60INNSev9NxHu61igGUTzTBoaWo7WjPG7vzTnpZYhvsoglTzMEKhfranJkkkn95pe-prkvSasaAL6kXHw0jQjlSMzcYiF7DoLdkOtDJSukuALEubidf9eIwZXFZ-sezZdZHm4hnk5nWme5YtdOmYOJPh5sv1dzRvM1XuOHknJPTA1BbdZuVAtSGHSjkhwx-wl-41uuQoROW5GjJs0bz4zLBFn1w_pWaSMCn7pjGJNcbr6IuDV41km_etpwwxacWyfAcxNykzCtIiE1abJj7m-e944GvAn_eqxz3wCZD6Bgt41FWRzyMHjrppJfDjk7FaHNw\n\n```\n\n### ç™»å½•æµè§ˆå™¨è®¿é—®\n\n```\nhttps://192.168.48.200:30001\n\nè¾“å…¥tokenï¼š\n----\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJxb21sRTZSckhEZ09FMnlvWU5IY3dfTTRIWDEzRUpsQ000MThhSWxYNDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjk5NjQ2Mjg3LCJpYXQiOjE2OTk2NDI2ODcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIyNTBhNTQ2MS03MGJlLTRhZTItOWY2Yi1hMDQwOWE1NWJhMTMifX0sIm5iZiI6MTY5OTY0MjY4Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.U-lH9_sRU4TVrpAznqS60INNSev9NxHu61igGUTzTBoaWo7WjPG7vzTnpZYhvsoglTzMEKhfranJkkkn95pe-prkvSasaAL6kXHw0jQjlSMzcYiF7DoLdkOtDJSukuALEubidf9eIwZXFZ-sezZdZHm4hnk5nWme5YtdOmYOJPh5sv1dzRvM1XuOHknJPTA1BbdZuVAtSGHSjkhwx-wl-41uuQoROW5GjJs0bz4zLBFn1w_pWaSMCn7pjGJNcbr6IuDV41km_etpwwxacWyfAcxNykzCtIiE1abJj7m-e944GvAn_eqxz3wCZD6Bgt41FWRzyMHjrppJfDjk7FaHNw\n\n----\n\n```\n\n![image-20231111025910110](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/7b34dc0f898a641c9ab933bed917ef3a697559838.png)\n\n### éƒ¨ç½²ä¸€ä¸ªnginxæµ‹è¯•\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```yaml\nvim web.yaml\n\nkind: Deployment\n#apiVersion: extensions/v1beta1\napiVersion: apps/v1\nmetadata:\n  labels:\n    app: web-deployment-label\n  name: web-deployment\n  namespace: default\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-selector\n  template:\n    metadata:\n      labels:\n        app: web-selector\n    spec:\n      containers:\n      - name: web-container\n        image: nginx:latest\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 80\n          protocol: TCP\n          name: http\n        - containerPort: 443\n          protocol: TCP\n          name: https\n\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: web-service-label\n  name: web-service\n  namespace: default\nspec:\n  type: NodePort\n  ports:\n  - name: http\n    port: 80\n    protocol: TCP\n    targetPort: 80\n    nodePort: 30080\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: 443\n    nodePort: 30443\n  selector:\n    app: web-selector\n    \nkubectl apply -f web.yaml \n```\n\n![image-20231014180923818](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/5181d6f7aaaf9bceb00fa35640993309697559838.png)\n\n```\n### æŸ¥çœ‹nginxçš„pod çš„è¯¦ç»†ä¿¡æ¯\nkubectl get deploy,svc,pod -o wide\n```\n\n![image-20231016203536987](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/302a4487890e97870530cc9b18b6d9f2697559838.png)\n\nè®¿é—®nginxç½‘ç«™\n\n```\nhttp://192.168.48.200:30080\n```\n\n![image-20231111030413487](../img/OpenEuler-%E9%83%A8%E7%BD%B2K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/b5a25165b9ac41398207d34177a4860a697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["OpenEuler","K8s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"Nginx1.22å®ç°å†…ç½‘è‡ªç­¾è¯ä¹¦","url":"/posts/10165/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Nginx1.22å®ç°å†…ç½‘è‡ªç­¾è¯ä¹¦\n\nHTTPSï¼ˆå…¨ç§°ï¼šHyperText Transfer Protocol Secureï¼‰æ˜¯HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„å®‰å…¨ç‰ˆæœ¬ã€‚æœ¬è´¨ä¸Šï¼ŒHTTPSåœ¨HTTPçš„åŸºç¡€ä¸Šï¼Œé€šè¿‡SSL/TLSåè®®æä¾›äº†æ•°æ®åŠ å¯†ã€å®Œæ•´æ€§ä¿æŠ¤å’Œèº«ä»½éªŒè¯ï¼Œä»¥ç¡®ä¿ç½‘ç»œæ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚HTTPSè¢«å¹¿æ³›ç”¨äºäº’è”ç½‘ä¸Šçš„å®‰å…¨é€šä¿¡ï¼Œç‰¹åˆ«æ˜¯åœ¨çº¿äº¤æ˜“å’Œå¤„ç†æ•æ„Ÿä¿¡æ¯æ—¶ï¼Œæœ¬æ–‡ä»¥Nginxä¸ºä¾‹éƒ¨ç½²è‡ªç­¾å‘httpsè¯ä¹¦ã€‚\n\n## å‰æƒ…æè¦\n\næœ¬æ¬¡å®éªŒä»…ä»…ç”¨äºå®éªŒæµ‹è¯•æœ‰ssléœ€æ±‚çš„å®éªŒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸è¦ç”¨\n\næœ¬æ¬¡å®éªŒç¯å¢ƒæ˜¯Rocky8.9ï¼ˆå’Œcentos 8 stream å¤§å·®ä¸å·®ï¼‰\n\n## å®‰è£…nginx\n\n```\ndnf update -y\ndnf module list nginx\ndnf remove @nginx\ndnf module reset nginx\ndnf module install nginx:1.22 -y\nsystemctl enable --now nginx\nnginx -V\n```\n\næŸ¥çœ‹æ˜¯å¦æœ‰`--with-http_ssl_module`\n\n`--with-http_ssl_module` æ˜¯ Nginx é…ç½®é€‰é¡¹ä¹‹ä¸€ï¼Œç”¨äºå¯ç”¨ Nginx çš„ SSL åŠŸèƒ½æ¨¡å—ã€‚å½“ Nginx ç¼–è¯‘æ—¶åŒ…å«äº† `--with-http_ssl_module` é€‰é¡¹æ—¶ï¼Œè¡¨ç¤º Nginx å°†æ”¯æŒå¤„ç† HTTPS è¯·æ±‚ï¼Œå³é€šè¿‡ SSL/TLS åŠ å¯†åè®®ä¿æŠ¤æ•°æ®ä¼ è¾“ã€‚\n\n![image-20240406194001867](../img/Nginx1.22%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6.assets/image-20240406194001867.png)\n\n## å®‰è£…openssl\n\nOpenSSL æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„åŠ å¯†åº“ï¼Œå¹¿æ³›ç”¨äºå®‰å…¨é€šä¿¡ã€åŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚å®ƒæä¾›äº†ä¸€ç»„åŠŸèƒ½ä¸°å¯Œçš„å·¥å…·å’Œåº“ï¼Œç”¨äºå¤„ç†å®‰å…¨é€šä¿¡æ‰€éœ€çš„å„ç§åŠ å¯†æ“ä½œã€‚\n\n```\ndnf install openssl\ndnf install openssl-devel\n```\n\n## ç”Ÿæˆè¯ä¹¦\n\n```\n#æ²¡æœ‰å°±åˆ›å»ºsslkeyæ–‡ä»¶å¤¹\ncd /etc/nginx/sslkey\n\n#åˆ›å»ºæœ¬åœ°ç§æœ‰å¯†é’¥\nopenssl genrsa -out ssl.key 2048\n \n#æŒ‰æç¤ºè¾“å…¥å³å¯\nopenssl req -new -key ssl.key -out ssl.csr\n\n ----------------------------------------------------------------\n å›½å®¶åç§°(2å­—æ¯ä»£ç )[XX]:CN\nCountry Name (2 letter code) [XX]:CN\n\nå·æˆ–çœå(å…¨ç§°)[]:Guangdong\nState or Province Name (full name) []:Guangdong\n\nåœ°åŒºåç§°(å¦‚åŸå¸‚)[é»˜è®¤åŸå¸‚]:å¹¿å·\nLocality Name (eg, city) [Default City]:Guangzhou\n\nç»„ç»‡æœºæ„åç§°(å¦‚å…¬å¸)ã€é»˜è®¤å…¬å¸æœ‰é™å…¬å¸ã€‘:qianyios\nOrganization Name (eg, company) [Default Company Ltd]:qianyios\n\nç»„ç»‡å•ä½åç§°(å¦‚section) []:NONE\nOrganizational Unit Name (eg, section) []:NONE\n\né€šç”¨åç§°(ä¾‹å¦‚ï¼Œæ‚¨çš„åå­—æˆ–æœåŠ¡å™¨ä¸»æœºå)[]:qianyios\nCommon Name (eg, your name or your server's hostname) []:qianyios\n\né‚®ç®±åœ°å€[]:abc@qq.com\nEmail Address []:abc@qq.com\n\nè¯·è¾“å…¥ä»¥ä¸‹â€œé¢å¤–â€å±æ€§\nPlease enter the following 'extra' attributes\n\nä¸æ‚¨çš„è¯ä¹¦è¯·æ±‚ä¸€èµ·å‘é€\nto be sent with your certificate request\n\næŒ‘æˆ˜å¯†ç []:123456\nA challenge password []:123456\n\nå¯é€‰çš„å…¬å¸åç§°[]:NONE\nAn optional company name []:NONE\n\n ----------------------------------------------------------------\n\n#åˆ›å»ºè¯ä¹¦crt\nopenssl x509 -req -days 1460 -in ssl.csr -signkey ssl.key -out ssl.crt\n \n#åˆ›å»ºè¯ä¹¦pem\nopenssl dhparam -out ssl.pem 2048\n```\n\n## Nginxé…ç½®\n\n```\nvi /etc/nginx/nginx.conf\n\n...........\ninclude /etc/nginx/sslkey/*.conf;\n...........\n\nä¿å­˜é€€å‡º\n```\n\nåœ¨nginxé»˜è®¤é…ç½®ä¸‹åŠ ä¸Š`include /etc/nginx/sslkey/*.conf;`\n\n![image-20240406194859367](../img/Nginx1.22%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6.assets/image-20240406194859367.png)\n\nç»™sslè¯ä¹¦å•ç‹¬ç”Ÿæˆä¸€ä¸ªconfã€‚\n\n```\ncat >> /etc/nginx/sslkey/ssl.conf <<\"EOF\"\nserver {\n    listen 443   ssl;\n    ssl_certificate                          /etc/nginx/sslkey/ssl.crt;\n    ssl_certificate_key                        /etc/nginx/sslkey/ssl.key;\n    ssl_session_timeout 5m;\n    ssl_protocols TLSv1.2;\n    ssl_ciphers EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!KRB5:!aECDH:!EDH+3DES;\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\";\n}\nEOF\n```\n\n<font color='red'>é‡ç‚¹ï¼ï¼ï¼</font>\n\nåœ¨ä½ éœ€è¦çš„ç½‘ç«™é…ç½®åŠ å…¥é‡å®šå‘è‡³httpsï¼Œå› ä¸ºæˆ‘ä»¬é»˜è®¤è®¿é—®nginxé¡µé¢çš„æ—¶å€™æ˜¯httpçš„ï¼Œæ‰€ä»¥è¦é‡å®šå‘ã€‚ç°åœ¨æˆ‘ä»¬æ¨¡æ‹Ÿè®¿é—®80ç«¯å£çš„é»˜è®¤ç½‘é¡µ\n\n```\nvi /etc/nginx/nginx.conf\n\n\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sslkey/*.conf;\n    server {\n        listen       80;\n        listen       [::]:80;\n        return 301 https://$host$request_uri;   #å°±åŠ è¿™ä¸€å¥\n        server_name  _;\n        root         /usr/share/nginx/html;\n\n\n```\n\n\n\n![image-20240406195448828](../img/Nginx1.22%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6.assets/image-20240406195448828.png)\n\n\n\né‡å¯nginx\n\n```\nnginx -t\nnginx -s reload\n```\n\n\n\nè¿™æ—¶å€™è®¿é—®80ç½‘é¡µï¼Œè‡ªç­¾è¯ä¹¦å·²ç»å¥½äº†ï¼Œåªæ˜¯ä¸å—ä¿¡ä»»è€Œå·²\n\n![image-20240406195703184](../img/Nginx1.22%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6.assets/image-20240406195703184.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Rocky 8","Nginx"],"categories":["è¿ç»´"]},{"title":"å¹¿å·å•†å­¦é™¢è¯¾ç¨‹ä½œä¸šå¯¼èˆª","url":"/posts/548777d4/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# å¹¿å·å•†å­¦é™¢è¯¾ç¨‹ä½œä¸šå¯¼èˆª\n\n<a href=\"https://blog.qianyios.top/posts/d721e715/\"><img src=\"https://i0.hdslb.com/bfs/article/daddec263720c95dfc5b4f53b45a96fd55933597.png\"/></a>\n\n\n<a href=\"https://blog.qianyios.top/posts/f5e08620/\"><img src=\"https://i0.hdslb.com/bfs/article/225c076d72b0942a26654c2f37dace8a55933597.png\"/></a>\n\n<a href=\"https://blog.qianyios.top/posts/f8bb3dfe/\"><img src=\"https://blog.qianyios.top/img/%E5%8D%8E%E4%B8%BAensp%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/1.webp\"/></a>\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n\n"},{"title":"OpenStack-Train-ä¸‰èŠ‚ç‚¹éƒ¨ç½²","url":"/posts/26892/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# OpenStack-Train-ä¸‰èŠ‚ç‚¹éƒ¨ç½²\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå       | ens33ï¼ˆNATï¼‰   | ens36(ä»…ä¸»æœº)   | å†…å­˜ | ç¡¬ç›˜1 | ç¡¬ç›˜2 | os        |\n| ------------ | -------------- | --------------- | ---- | ----- | ----- | --------- |\n| controller-1 | 192.168.48.101 | 192.168.148.101 | 8G   | 100G  |       | Centos7.9 |\n| computer-2   | 192.168.48.102 | 192.168.148.102 | 3G   | 100G  | 100G  | Centos7.9 |\n| computer-3   | 192.168.48.103 | 192.168.148.103 | 3G   | 100G  | 100G  | Centos7.9 |\n\nå…·ä½“å®‰è£…çš„æœåŠ¡å¦‚ä¸‹ï¼š\n\n| èŠ‚ç‚¹åç§°   | OpenStack æœåŠ¡                                               |\n| ---------- | ------------------------------------------------------------ |\n| æ§åˆ¶èŠ‚ç‚¹   | MariaDB RabbitMQ Memcache Etcd Keystone Placement Glance Nova Neutron Cinder Horizon Heat |\n| è®¡ç®—èŠ‚ç‚¹   | Nova Neutron                                                 |\n| å—å­˜å‚¨èŠ‚ç‚¹ | Cinder Swift                                                 |\n\nä¸‰å°èŠ‚ç‚¹çš„é…ç½®å¦‚ä¸‹å›¾\n\n![image-20240107003616013](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/3e7313ef3a188b5fcf69a37024a6afab697559838.png)\n\n![image-20240107003516583](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/286f41907c7aa2488dc965030d91add1697559838.png)\n\n![image-20240107003313362](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/6043b98af224a9c97503d350f935369e697559838.png)\n\nVMwareç½‘ç»œè®¾ç½®å¦‚ä¸‹å›¾\n\n![image-20240107003708588](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/972f5f1f095069468b1c8fdc0d5e3149697559838.png)\n\n## å®‰å…¨æ€§\n\n### ç‰©ç†èŠ‚ç‚¹å…³é—­é¡ºåº\n\nç»™æ¯å°æœºéƒ½åŠ ä¸Šä¸¤ä¸ªè„šæœ¬\n\n```\ncat >> stop.sh << EOF\n#!/bin/bash\n# å…³é—­æ‰€æœ‰ OpenStack èŠ‚ç‚¹\n# ä¾æ¬¡å…³é—­è®¡ç®—èŠ‚ç‚¹ã€ç½‘ç»œèŠ‚ç‚¹ã€æ§åˆ¶èŠ‚ç‚¹\nfor server in \\$(openstack server list -f value -c ID); do\n    openstack server stop \\$server\ndone\n# å…³é—­è®¡ç®—èŠ‚ç‚¹\necho \"Stopping compute services...\"\nsystemctl stop openstack-nova-compute.service\nsystemctl stop libvirtd.service\n# å…³é—­ç½‘ç»œèŠ‚ç‚¹\necho \"Stopping network services...\"\nsystemctl stop openvswitch.service\nsystemctl stop neutron-server.service\nsystemctl stop neutron-linuxbridge-agent.service\nsystemctl stop neutron-dhcp-agent.service\nsystemctl stop neutron-metadata-agent.service\nsystemctl stop neutron-l3-agent.service\n# å…³é—­æ§åˆ¶èŠ‚ç‚¹\necho \"Stopping control services...\"\nsystemctl stop mariadb.service\nsystemctl stop rabbitmq-server.service\nsystemctl stop memcached.service\nsystemctl stop httpd.service\nsystemctl stop openstack-glance-api.service\nsystemctl stop openstack-glance-registry.service\nsystemctl stop openstack-cinder-api.service\nsystemctl stop openstack-cinder-scheduler.service\nsystemctl stop openstack-cinder-volume.service\nsystemctl stop openstack-nova-api.service\nsystemctl stop openstack-nova-scheduler.service\nsystemctl stop openstack-nova-conductor.service\nsystemctl stop openstack-nova-novncproxy.service\nsystemctl stop openstack-nova-consoleauth.service\nsystemctl stop openstack-keystone.service\nsystemctl stop openstack-heat-api.service\nsystemctl stop openstack-heat-api-cfn.service\nsystemctl stop openstack-heat-engine.service\nsystemctl stop openstack-swift-proxy.service\nsystemctl stop openstack-swift-account.service\nsystemctl stop openstack-swift-container.service\nsystemctl stop openstack-swift-object.service\necho \"Stopping all services...\"\nsystemctl stop --all\n# å…³é—­ç”µæº\necho \"Shutting down the system...\"\npoweroff\nEOF\n\ncat >> start.sh << EOF\n#!/bin/bash\n# é‡æ–°å¯åŠ¨ OpenStack æœåŠ¡\n# ä¾æ¬¡å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹ã€ç½‘ç»œèŠ‚ç‚¹ã€è®¡ç®—èŠ‚ç‚¹\n# å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹\necho \"Starting control services...\"\nsystemctl start mariadb.service\nsystemctl start rabbitmq-server.service\nsystemctl start memcached.service\nsystemctl start httpd.service\nsystemctl start openstack-glance-api.service\nsystemctl start openstack-glance-registry.service\nsystemctl start openstack-cinder-api.service\nsystemctl start openstack-cinder-scheduler.service\nsystemctl start openstack-cinder-volume.service\nsystemctl start openstack-nova-api.service\nsystemctl start openstack-nova-scheduler.service\nsystemctl start openstack-nova-conductor.service\nsystemctl start openstack-nova-novncproxy.service\nsystemctl start openstack-nova-consoleauth.service\nsystemctl start openstack-keystone.service\nsystemctl start openstack-heat-api.service\nsystemctl start openstack-heat-api-cfn.service\nsystemctl start openstack-heat-engine.service\nsystemctl start openstack-swift-proxy.service\nsystemctl start openstack-swift-account.service\nsystemctl start openstack-swift-container.service\nsystemctl start openstack-swift-object.service\n# å¯åŠ¨ç½‘ç»œèŠ‚ç‚¹\necho \"Starting network services...\"\nsystemctl start openvswitch.service\nsystemctl start neutron-server.service\nsystemctl start neutron-linuxbridge-agent.service\nsystemctl start neutron-dhcp-agent.service\nsystemctl start neutron-metadata-agent.service\nsystemctl start neutron-l3-agent.service\n# å¯åŠ¨è®¡ç®—èŠ‚ç‚¹\necho \"Starting compute services...\"\nsystemctl start libvirtd.service\nsystemctl start openstack-nova-compute.service\nEOF\n```\n\n<font color='red'>ï¼ˆå…ˆç»™ä¸¤ä¸ªè®¡ç®—èŠ‚ç‚¹æ‰§è¡Œ-æœ€åç­‰è®¡ç®—èŠ‚ç‚¹å®Œå…¨å…³é—­ï¼Œå†ç»™æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰</font>\n\n```\nå…³é—­ç‰©ç†æœºçš„æ—¶å€™è¿è¡Œ\nsh stop.sh\n(è¿è¡Œçš„æ—¶å€™å¯èƒ½ä¼šæç¤ºä½ æœ‰äº›æœåŠ¡æ‰¾ä¸åˆ°ï¼ŒæŠ¥é”™ï¼Œè¿™ä¸ªæ²¡å…³ç³»ï¼Œä½†æ˜¯è¦æ˜¯å‘Šè¯‰ä½ æœ‰äº›æœåŠ¡èµ·ä¸æ¥ï¼Œè¦ä½ è‡ªå·±å»æ‰¾æŠ¥é”™äº†)ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ²¡é—®é¢˜çš„\n```\n\n### ç‰©ç†èŠ‚ç‚¹å¼€å¯é¡ºåº\n\n> <font color='red'>å…ˆå¼€controller-1å†å¼€å‰©ä¸‹çš„è®¡ç®—èŠ‚ç‚¹</font>\n\n### åŸºæœ¬ç”¨æˆ·ä¿¡æ¯\n\nOpenStack å„ç»„ä»¶éƒ½éœ€è¦åœ¨æ§åˆ¶èŠ‚ç‚¹æ•°æ®åº“ä¸­æ³¨å†Œä¸“å±è´¦æˆ·ä»¥å­˜æ”¾æ•°æ®ä¿¡æ¯ï¼Œæ•…éœ€è¦è®¾ç½®å¯†ç ï¼Œå¼ºçƒˆå»ºè®®å„ç»„ä»¶çš„å¯†ç ä»¥åŠå®¿ä¸»æœºå¯†ç å„ä¸ç›¸åŒã€‚\n\n|    OpenStack ç»„ä»¶     |         å¯†ç           |\n| :-------------------: | :-------------------: |\n|     æ§åˆ¶èŠ‚ç‚¹ root     |        123456         |\n|     è®¡ç®—èŠ‚ç‚¹ root     |        123456         |\n|  Metadata å…ƒæ•°æ®å¯†é’¥  |    METADATA_SECRET    |\n|   Mariadb root è´¦æˆ·   |     MARIADB_PASS      |\n|     RabbitMQ æœåŠ¡     |      RABBIT_PASS      |\n|    OpenStack admin    |      ADMIN_PASS       |\n|    Placement æœåŠ¡     |    PLACEMENT_PASS     |\n|    Keystone æ•°æ®åº“    |    KEYSTONE_DBPASS    |\n|      Glance æœåŠ¡      |      GLANCE_PASS      |\n|     Glance æ•°æ®åº“     |     GLANCE_DBPASS     |\n|       Nova æœåŠ¡       |       NOVA_PASS       |\n|      Nova æ•°æ®åº“      |      NOVA_DBPASS      |\n|     Neutron æœåŠ¡      |     NEUTRON_PASS      |\n|    Neutron æ•°æ®åº“     |    NEUTRON_DBPASS     |\n|      Cinder æœåŠ¡      |      CINDER_PASS      |\n|     Cinder æ•°æ®åº“     |     CINDER_DBPASS     |\n|    Horizon æ•°æ®åº“     |      DASH_DBPASS      |\n|       SwiftæœåŠ¡       |      SWIFT_PASS       |\n|       HeatæœåŠ¡        |       HEAT_PASS       |\n|    Heatæ•°æ®åº“æœåŠ¡     |      HEAT_DBPASS      |\n| heat_domain_adminç”¨æˆ· | HEAT_DOMAIN_USER_PASS |\n\n### æµ‹è¯•ç”¨æˆ·\n\n| ç”¨æˆ·    | å¯†ç    |\n| ------- | ------ |\n| admin   | 123456 |\n| use_dog | 123456 |\n\n### èº«ä»½éªŒè¯\n\næ§åˆ¶èŠ‚ç‚¹ç®¡ç† OpenStack æœåŠ¡æ—¶éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯ï¼Œå¯å°†è®¤è¯ä¿¡æ¯å¯¼å…¥åˆ°æ§åˆ¶èŠ‚ç‚¹ç¯å¢ƒå˜é‡ä¸­ï¼Œæ–¹ä¾¿åç»­å®‰è£…é…ç½®ä½¿ç”¨ã€‚\nadmin-openrcæ–‡ä»¶éœ€æå‰ç¼–å†™å¹¶æ”¾å…¥æ§åˆ¶èŠ‚ç‚¹ä¸­ï¼Œåç»­å®‰è£…å°†ä¸å†è¯´æ˜ç”±æ¥\n\n```\n#é…ç½®ç®¡ç†å‘˜å’Œæµ‹è¯•ç”¨æˆ·è´¦å·ï¼ˆå¾ˆé‡è¦ï¼‰\ncat > /root/admin-openrc <<\"EOF\"\nexport OS_USERNAME=admin\nexport OS_PASSWORD=123456\nexport OS_PROJECT_NAME=admin\nexport OS_USER_DOMAIN_NAME=Default\nexport OS_PROJECT_DOMAIN_NAME=Default\nexport OS_AUTH_URL=http://controller-1:5000/v3\nexport OS_IDENTITY_API_VERSION=3\nEOF\n\ncat >user_dog-openrc << EOF\nexport OS_USERNAME=user_dog\nexport OS_PASSWORD=123456\nexport OS_PROJECT_NAME=Train\nexport OS_USER_DOMAIN_NAME=RegionOne\nexport OS_PROJECT_DOMAIN_NAME=RegionOne\nexport OS_AUTH_URL=http://controller-1:5000/v3\nexport OS_IDENTITY_API_VERSION=3\nEOF\n\n# OS_USERNAME  ç™»å½• OpenStack æœåŠ¡çš„ç”¨æˆ·å\n# OS_PASSWORD  ç™»å½• OpenStack æœåŠ¡çš„ç”¨æˆ·å¯†ç \n# OS_PROJECT_NAME ç™»å½•æ—¶è¿›å…¥çš„é¡¹ç›®å\n# OS_USER_DOMAIN_NAME  ç™»å½•æ—¶è¿›å…¥çš„åŸŸå\n# OS_PROJECT_DOMAIN_NAME  ç™»å½•æ—¶è¿›å…¥çš„é¡¹ç›®åŸŸå\n# OS_AUTH_URL æŒ‡å®š Keystoneï¼ˆèº«ä»½è®¤è¯æœåŠ¡ï¼‰çš„ URL  \n# å¦‚æœªéƒ¨ç½² DNS æœåŠ¡å™¨ï¼Œåˆ™éœ€è¦åœ¨ hostsä¸­æŒ‡å®š controller-1 æ˜ å°„ï¼Œæˆ–å°† controller-1 ç”¨æ§åˆ¶èŠ‚ç‚¹ IP æ›¿ä»£\n# OS_IDENTITY_API_VERSION èº«ä»½è®¤è¯æœåŠ¡çš„ API ç‰ˆæœ¬å· \n```\n\n## åŸºç¡€é…ç½®\n\n### ç½‘å¡é…ç½®\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1ï¼Œcomputer-2ï¼Œcomputer-3]</font>\n\n```\nã€ens33ã€‘æ³¨æ„ä¸»æœºåï¼Œè¿™é‡Œåªå±•ç¤ºè¦ä¿®æ”¹å’Œæ·»åŠ çš„éƒ¨åˆ†\n[root@controller-1 ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33\nBOOTPROTO=static\nONBOOT=yes\nIPADDR=192.168.48.101\nPREFIX=24\nGATEWAY=192.168.48.2\nDNS1=192.168.48.2\nDNS2=114.114.114.114\n[root@computer-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33\nBOOTPROTO=static\nONBOOT=yes\nIPADDR=192.168.48.102\nPREFIX=24\nGATEWAY=192.168.48.2\nDNS1=192.168.48.2\nDNS2=114.114.114.114\n[root@computer-3 ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33\nBOOTPROTO=static\nONBOOT=yes\nIPADDR=192.168.48.103\nPREFIX=24\nGATEWAY=192.168.48.2\nDNS1=192.168.48.2\nDNS2=114.114.114.114\n\nã€ens36ã€‘æ³¨æ„ä¸»æœºåï¼Œè¿™é‡Œåªå±•ç¤ºè¦ä¿®æ”¹å’Œæ·»åŠ çš„éƒ¨åˆ†\n[root@controller-1 ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens36\nBOOTPROTO=static\nONBOOT=yes\nIPADDR=192.168.148.101\nPREFIX=24\n[root@computer-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens36\nBOOTPROTO=static\nONBOOT=yes\nIPADDR=192.168.148.102\nPREFIX=24\n[root@computer-3 ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens36\nBOOTPROTO=static\nONBOOT=yes\nIPADDR=192.168.148.103\nPREFIX=24\n```\n\n### é…ç½®ä¸»æœºå\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\nhostnamectl set-hostname controller-1 && bash\n```\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[computer-2]</font>\n\n```\nhostnamectl set-hostname computer-2 && bash\n```\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[computer-3]</font>\n\n```\nhostnamectl set-hostname computer-3 && bash\n```\n\n### åŸºç¡€é…ç½®\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[æ‰€æœ‰èŠ‚ç‚¹]</font>\n\n```\n#è®¾ç½®hosts\ncat >> /etc/hosts << EOF\n192.168.148.101 controller-1\n192.168.148.102 computer-2\n192.168.148.103 computer-3\nEOF\n#å®‰è£…openstack-train\nyum install centos-release-openstack-train -y\nyum install python-openstackclient openstack-selinux -y\n#å…³é—­é˜²ç«å¢™å’Œå…³é—­selinux\nsystemctl disable firewalld --now\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n#é…ç½®æ—¶é—´åŒæ­¥\nyum install chrony -y\nsystemctl enable chronyd --now\nchronyc sources\n\nreboot\n```\n\n### é…ç½®å…å¯†\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\n#å„èŠ‚ç‚¹\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"controller-1\" \"computer-2\" \"computer-3\")\n# å¯†ç ï¼ˆæ³¨æ„ä¿®æ”¹ï¼‰\npassword=\"123456\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## ä¾èµ–ç»„ä»¶\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n### Mariadbæ•°æ®åº“\n\n```\nyum install mariadb mariadb-server python2-PyMySQL -y\ncat >>/etc/my.cnf.d/openstack.cnf<<EOF\n[mysqld]\nbind-address =0.0.0.0\ndefault-storage-engine = innodb\ninnodb_file_per_table = on\nmax_connections =4096\ncollation-server = utf8_general_ci\ncharacter-set-server = utf8\nEOF\nsystemctl enable mariadb --now\nmysql_secure_installation\nEnter current password for root (enter for none): å›è½¦\nSet root password? [Y/n] y\n# å°†è¦æ±‚è¾“å…¥æ•°æ®åº“ root è´¦æˆ·å¯†ç  MARIADB_PASS\nRemove anonymous users? [Y/n] y\nDisallow root login remotely? [Y/n] n\nRemove test database and access to it? [Y/n] y\nReload privilege tables now? [Y/n] y\n# éªŒè¯\nmysql -u root -pMARIADB_PASS\n```\n\n### Rabbitmq\n\n```\nyum install rabbitmq-server -y\nsystemctl enable rabbitmq-server.service --now\nrabbitmqctl add_user openstack RABBIT_PASS\nrabbitmqctl set_permissions openstack \".*\" \".*\" \".*\"\n```\n\n### Memcached\n\n```\nyum install memcached python-memcached -y\nsed -i \"s/OPTIONS=\\\"-l 127.0.0.1,::1\\\"/OPTIONS=\\\"-l 127.0.0.1,::1,controller-1\\\"/g\" /etc/sysconfig/memcached\nsed -i 's/^CACHESIZE=\"64\"$/CACHESIZE=\"1024\"/' /etc/sysconfig/memcached\n#å¢åŠ  Memcached æœåŠ¡å™¨çš„ç¼“å­˜å¤§å°\nsystemctl enable memcached --now\n```\n\næ³¨æ„è¿™é‡Œçš„-l 127.0.0.1,::1,controller-1ä¸­controller-1æ˜¯ä½ çš„ä¸»æœºåï¼Œåç»­ä¸åšè§£é‡Š\n\n## keystoneï¼ˆèº«ä»½éªŒè¯æœåŠ¡ï¼‰\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE keystone;\nGRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'KEYSTONE_DBPASS';\nGRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'KEYSTONE_DBPASS';\nflush privileges;\nexit\n\nyum install yum-utils openstack-keystone httpd mod_wsgi -y\nmv /etc/keystone/keystone.conf{,.bak}\ncat> /etc/keystone/keystone.conf << EOF\n[database]\nconnection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller-1/keystone\n[token]\nprovider = fernet\nEOF\n#åŒæ­¥æœåŠ¡å™¨\nsu -s /bin/sh -c \"keystone-manage db_sync\" keystone\n#æŸ¥çœ‹æ˜¯å¦æˆåŠŸ\nmysql -u keystone -p\"KEYSTONE_DBPASS\"\nuse keystone;\nshow tables;\nexit\n#æœ‰è¡¨å°±è¡Œ\n\nkeystone-manage fernet_setup --keystone-user keystone --keystone-group keystone\nkeystone-manage credential_setup --keystone-user keystone --keystone-group keystone\nkeystone-manage bootstrap --bootstrap-password 123456 \\\n  --bootstrap-admin-url http://controller-1:5000/v3/ \\\n  --bootstrap-internal-url http://controller-1:5000/v3/ \\\n  --bootstrap-public-url http://controller-1:5000/v3/ \\\n  --bootstrap-region-id RegionOne\n  \ncp /etc/httpd/conf/httpd.conf{,.bak}\nsed -i \"s/#ServerName www.example.com:80/ServerName controller-1/g\" /etc/httpd/conf/httpd.conf\nln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/\nsystemctl enable httpd  --now\n\n#é…ç½®ç®¡ç†å‘˜å’Œæµ‹è¯•ç”¨æˆ·è´¦å·ï¼ˆå¾ˆé‡è¦ï¼‰\ncat > /root/admin-openrc <<\"EOF\"\nexport OS_USERNAME=admin\nexport OS_PASSWORD=123456\nexport OS_PROJECT_NAME=admin\nexport OS_USER_DOMAIN_NAME=Default\nexport OS_PROJECT_DOMAIN_NAME=Default\nexport OS_AUTH_URL=http://controller-1:5000/v3\nexport OS_IDENTITY_API_VERSION=3\nEOF\n\ncat >user_dog-openrc << EOF\nexport OS_USERNAME=user_dog\nexport OS_PASSWORD=123456\nexport OS_PROJECT_NAME=Train\nexport OS_USER_DOMAIN_NAME=RegionOne\nexport OS_PROJECT_DOMAIN_NAME=RegionOne\nexport OS_AUTH_URL=http://controller-1:5000/v3\nexport OS_IDENTITY_API_VERSION=3\nEOF\n\nsource admin-openrc\n\n#åˆ›å»ºåŸŸã€é¡¹ç›®ã€ç”¨æˆ·ã€è§’è‰²\n# åˆ›å»ºä¸€ä¸ª RegionOne åŸŸåä½œä¸ºåç»­äº‘å®ä¾‹åˆ›å»ºåŸŸå\nopenstack domain create --description \"RegionOne Domain\" RegionOne\n# service é¡¹ç›® åˆ›å»ºåœ¨ default ç”¨äº OpenStack æœåŠ¡\nopenstack project create --domain default \\\n  --description \"Service Project\" service\n# åœ¨ RegionOne åŸŸä¸­åˆ›å»ºä¸€ä¸ª Train é¡¹ç›®\nopenstack project create --domain RegionOne \\\n  --description \"Train Project\" Train\n  \n# åœ¨ RegionOne åŸŸä¸­åˆ›å»ºæ™®é€šç”¨æˆ· user_dog \nopenstack user create --domain RegionOne \\\n  --password 123456 user_dog\n# åˆ›å»ºæ™®é€šç”¨æˆ· user_dog  çš„è§„åˆ™ user_dog_role\nopenstack role create user_dog_role\n# å°†è§„åˆ™ä¸ç”¨æˆ·ç»‘å®š\nopenstack role add --project Train --user user_dog user_dog_role\n# æ³¨ï¼šå¯ä»¥é‡å¤ä¸Šè¾¹æ­¥éª¤ä»¥åˆ›å»ºæ›´å¤šé¡¹ç›®ã€ç”¨æˆ·åŠè§„åˆ™\n\n\n# éªŒè¯æœåŠ¡å¯ç”¨æ€§\n# å¸è½½ admin ç”¨æˆ·çš„ç¯å¢ƒ\nunset OS_AUTH_URL OS_PASSWORD\n# éªŒè¯ admin ç”¨æˆ·å¯ç”¨æ€§\nopenstack --os-auth-url http://controller-1:5000/v3 \\\n  --os-project-domain-name Default --os-user-domain-name Default --os-project-name admin --os-username admin token issue\n# è¾“å…¥åå°†è¦æ±‚è¾“å…¥ ç®¡ç†å‘˜ admin çš„å¯†ç \n# è¿”å›  token ä¿¡æ¯åˆ™æœåŠ¡æ­£å¸¸\n\n# éªŒè¯ user_dog ç”¨æˆ·å¯ç”¨æ€§\nopenstack --os-auth-url http://controller-1:5000/v3 \\\n  --os-project-domain-name RegionOne --os-user-domain-name RegionOne --os-project-name Train --os-username user_dog token issue\n\nsource admin-openrc\n# åˆ—ä¸¾å½“å‰æ‰€æœ‰åŸŸå\nopenstack domain list\n[root@controller-1 ~]# openstack domain list\n+----------------------------------+-----------+---------+--------------------+\n| ID                               | Name      | Enabled | Description        |\n+----------------------------------+-----------+---------+--------------------+\n| 4b4ebbd4e4054ed3a7be6414787c8514 | RegionOne | True    | RegionOne Domain   |\n| default                          | Default   | True    | The default domain |\n+----------------------------------+-----------+---------+--------------------+\n[root@controller-1 ~]#\n\n```\n\n## Glanceï¼ˆé•œåƒæœåŠ¡ï¼‰\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE glance;\nGRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' \\\n  IDENTIFIED BY 'GLANCE_DBPASS';\nGRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' \\\n  IDENTIFIED BY 'GLANCE_DBPASS';\nflush privileges;\nexit\n#å°† GLANCE_DBPASS æ›¿æ¢ä¸º glanceæ•°æ®åº“æœåŠ¡çš„å¯†ç \nsource admin-openrc\n#åˆ›å»ºç”¨æˆ·æœåŠ¡å’Œapiç«¯ç‚¹\nopenstack user create --domain default --password GLANCE_PASS glance\n#GLANCE_PASS ä¸º glance æœåŠ¡çš„å¯†ç \n\n# ä¸º Glance ç”¨æˆ·æ·»åŠ  admin è§„åˆ™åˆ°ç³»ç»Ÿé¡¹ç›® service\nopenstack role add --project service --user glance admin\n# æ²¡æœ‰è¾“å‡ºå†…å®¹\n\n# ä¸º Glance æ·»åŠ ç®¡ç†é•œåƒçš„æœåŠ¡\nopenstack service create --name glance \\\n  --description \"OpenStack Image\" image\n\n# ä¸º RegionOne åŸŸåæ·»åŠ æœåŠ¡æ¥å£\nopenstack endpoint create --region RegionOne \\\n  image public http://controller-1:9292\n\nopenstack endpoint create --region RegionOne \\\n  image internal http://controller-1:9292\n\nopenstack endpoint create --region RegionOne \\\n  image admin http://controller-1:9292\n\n#å®‰è£…glanceæœåŠ¡\nyum install openstack-glance -y\nmv /etc/glance/glance-api.conf{,.bak}\ncat >/etc/glance/glance-api.conf << EOF\n[DEFAULT]\nuse_keystone_quotas = True\nlog_file = /var/log/glance/glance.log\n[database]\nconnection = mysql+pymysql://glance:GLANCE_DBPASS@controller-1/glance\n# GLANCE_DBPASS ä¸º Glance æœåŠ¡çš„æ•°æ®åº“è´¦æˆ·å¯†ç \n[keystone_authtoken]\nwww_authenticate_uri  = http://controller-1:5000\nauth_url = http://controller-1:5000\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = glance\npassword = GLANCE_PASS\nservice_token_roles_required = true\n# GLANCE_PASS ä¸º Glance æœåŠ¡çš„æ•°æ®åº“è´¦æˆ·å¯†ç \n[paste_deploy]\nflavor = keystone\n[glance_store]\nstores = file,http\ndefault_store = file\ndefault_backend = {'store_one': 'http', 'store_two': 'file'}\nfilesystem_store_datadir = /var/lib/glance/images/\nEOF\n# åŒæ­¥ Glance æ•°æ®åˆ°æ•°æ®åº“\nsu -s /bin/sh -c \"glance-manage db_sync\" glance\nsystemctl enable openstack-glance-api  --now\n# éªŒè¯æœåŠ¡å¯ç”¨æ€§\nsource admin-openrc\nwget https://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img\n#å¯èƒ½ä¼šä¸‹è½½ä¸åˆ°ï¼Œå¯ä»¥å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨ä¸‹è½½ï¼Œç„¶åç§»åˆ°/root/ç›®å½•ä¸‹\nglance image-create --name \"cirros\" \\\n  --file cirros-0.6.2-x86_64-disk.img \\\n  --disk-format qcow2 --container-format bare \\\n  --visibility=public\n\nopenstack image list\n\n[root@controller-1 ~]# openstack image list\n+--------------------------------------+--------+--------+\n| ID                                   | Name   | Status |\n+--------------------------------------+--------+--------+\n| 627761da-7f8c-4780-842a-e50e62f5c464 | cirros | active |\n+--------------------------------------+--------+--------+\n\n```\n\n## Placementï¼ˆèµ„æºè°ƒåº¦ï¼‰\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE placement;\nGRANT ALL PRIVILEGES ON placement.* TO 'placement'@'localhost'  IDENTIFIED BY 'PLACEMENT_DBPASS';\nGRANT ALL PRIVILEGES ON placement.* TO 'placement'@'%' IDENTIFIED BY 'PLACEMENT_DBPASS';\nflush privileges;\nexit\n\n#PLACEMENT_DBPASS ä¸º placement æœåŠ¡çš„å¯†ç \nsource admin-openrc\nopenstack user create --domain default --password PLACEMENT_PASS placement\nopenstack role add --project service --user placement admin\nopenstack service create --name placement \\\n  --description \"Placement API\" placement\nopenstack endpoint create --region RegionOne \\\n  placement public http://controller-1:8778\nopenstack endpoint create --region RegionOne \\\n  placement internal http://controller-1:8778\nopenstack endpoint create --region RegionOne \\\n  placement admin http://controller-1:8778\nyum install openstack-placement-api -y\nmv /etc/placement/placement.conf{,.bak}\ncat > /etc/placement/placement.conf << EOF\n[placement_database]\nconnection = mysql+pymysql://placement:PLACEMENT_DBPASS@controller-1/placement\n# PLACEMENT_DBPASS ä¸º placement æœåŠ¡çš„æ•°æ®åº“è´¦æˆ·å¯†ç \n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nauth_url = http://controller-1:5000/v3\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = placement\npassword = PLACEMENT_PASS\n# PLACEMENT_PASS ä¸º placement æœåŠ¡çš„å¯†ç \nEOF\n\n#åŒæ­¥æ•°æ®åº“\nsu -s /bin/sh -c \"placement-manage db sync\" placement\ncp /etc/httpd/conf.d/00-placement-api.conf{,.bak}\ncat >> /etc/httpd/conf.d/00-placement-api.conf << EOF\n#åœ¨#SSLCertificateKeyFile ...ä¸‹æ·»åŠ \n<Directory /usr/bin>\n<IfVersion >= 2.4>\n\tRequire all granted\n</IfVersion>\n<IfVersion < 2.4>\n\tOrder allow,deny\t\n\tAllow from all\n</IfVersion>\n</Directory>\nEOF\nsystemctl restart httpd\n\n# éªŒè¯æœåŠ¡\nsource admin-openrc\nplacement-status upgrade check\n#å®‰è£…pip oscç»„ä»¶éªŒè¯èµ„æº\nyum install epel-release -y\nyum install python-pip -y\npip install osc-placement==2.2.0\nsystemctl restart httpd\n\n# éªŒè¯\nopenstack --os-placement-api-version 1.2 resource class list --sort-column name\n# +----------------------------------------+\n# | name                                   |\n# +----------------------------------------+\n# | DISK_GB                                |\n......\n\nopenstack --os-placement-api-version 1.6 trait list --sort-column name\n+---------------------------------------+\n| name                                  |\n+---------------------------------------+\n| COMPUTE_DEVICE_TAGGING                |\n| COMPUTE_GRAPHICS_MODEL_CIRRUS         |\n\n```\n\n## Novaï¼ˆè®¡ç®—æœåŠ¡ï¼‰\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\n#æ§åˆ¶èŠ‚ç‚¹controller-1\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE nova_api;\nCREATE DATABASE nova;\nCREATE DATABASE nova_cell0;\nGRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nflush privileges;\nexit\n\n# NOVA_DBPASS ä¸º nova æœåŠ¡çš„å¯†ç \n\nsource admin-openrc\nopenstack user create --domain default --password NOVA_PASS nova\nopenstack role add --project service --user nova admin\nopenstack service create --name nova \\\n  --description \"OpenStack Compute\" compute\nopenstack endpoint create --region RegionOne \\\n  compute public http://controller-1:8774/v2.1\nopenstack endpoint create --region RegionOne \\\n  compute internal http://controller-1:8774/v2.1\nopenstack endpoint create --region RegionOne \\\n  compute admin http://controller-1:8774/v2.1\nmv /etc/yum.repos.d/epel.repo{,.bak} \nyum install -y \\\n    openstack-nova-api \\\n    openstack-nova-scheduler \\\n    openstack-nova-conductor \\\n    openstack-nova-novncproxy\n#mv /etc/yum.repos.d/epel.repo{.bak,} \nmv /etc/nova/nova.conf{,.bak}\ncat > /etc/nova/nova.conf <<EOF\n[DEFAULT]\nenabled_apis = osapi_compute,metadata\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1:5672/\n# RABBIT_PASSä¸º rabbitmq å¯†ç \nmy_ip = 192.168.148.101\n# æ§åˆ¶èŠ‚ç‚¹ç®¡ç†ç½‘ç»œçš„ IP\nlog_file = /var/log/nova/nova-controller.log\nrootwrap_config = /etc/nova/rootwrap.conf\n[api_database]\nconnection = mysql+pymysql://nova:NOVA_DBPASS@controller-1/nova_api\n# NOVA_DBPASS ä¸ºæ•°æ®åº“ Nova è´¦æˆ·å¯†ç \n[database]\nconnection = mysql+pymysql://nova:NOVA_DBPASS@controller-1/nova\n# NOVA_DBPASS ä¸ºæ•°æ®åº“ Nova è´¦æˆ·å¯†ç \n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000/\nauth_url = http://controller-1:5000/\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = nova\npassword =NOVA_PASS\n# NOVA_PASS ä¸º Nova æœåŠ¡çš„å¯†ç \n[vnc]\nenabled = true\nserver_listen = \\$my_ip\nserver_proxyclient_address = \\$my_ip\n[glance]\napi_servers = http://controller-1:9292\n[oslo_concurrency]\nlock_path = /var/run/nova\n[placement]\nregion_name = RegionOne\nproject_domain_name = Default\nproject_name = service\nauth_type = password\nuser_domain_name = Default\nauth_url = http://controller-1:5000/v3\nusername = placement\npassword = PLACEMENT_PASS\n# PLACEMENT_PASS ä¸º placement æœåŠ¡çš„å¯†ç \nEOF\nsu -s /bin/sh -c \"nova-manage api_db sync\" nova\nsu -s /bin/sh -c \"nova-manage cell_v2 map_cell0\" nova\nsu -s /bin/sh -c \"nova-manage cell_v2 create_cell --name=cell1 --verbose\" nova\nsu -s /bin/sh -c \"nova-manage db sync\" nova\n\n# éªŒè¯\n\nsu -s /bin/sh -c \"nova-manage cell_v2 list_cells\" nova\n\nsystemctl enable --now \\\n    openstack-nova-api.service \\\n    openstack-nova-scheduler.service \\\n    openstack-nova-conductor.service \\\n    openstack-nova-novncproxy.service\n    \nsystemctl status \\\n    openstack-nova-api.service \\\n    openstack-nova-scheduler.service \\\n    openstack-nova-conductor.service \\\n    openstack-nova-novncproxy.service\n    \n```\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[computer-2]</font>\n\n```\n##computer-2è®¡ç®—èŠ‚ç‚¹\nyum install openstack-nova-compute -y\nmv /etc/nova/nova.conf{,.bak}\ncat > /etc/nova/nova.conf <<EOF\n[DEFAULT]\nenabled_apis = osapi_compute,metadata\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1\nmy_ip = 192.168.148.102\ncompute_driver=libvirt.LibvirtDriver\nlog_file = /var/log/nova/nova-compute.log\n# 192.168.148.102æ›¿æ¢ä¸º è®¡ç®—èŠ‚ç‚¹ç®¡ç†ç½‘ç»œ IP åœ°å€\n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000/\nauth_url = http://controller-1:5000/\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = nova\npassword = NOVA_PASS\n#NOVA_PASSä¸ºnovaæœåŠ¡å¯†ç \n[vnc]\nenabled = true\nserver_listen = 0.0.0.0\nserver_proxyclient_address = \\$my_ip\nnovncproxy_base_url = http://192.168.48.101:6080/vnc_auto.html\n# å°† 192.168.48.101ä¿®æ”¹ä¸ºæ§åˆ¶èŠ‚ç‚¹çš„å¤–éƒ¨ç½‘ç»œ IP ï¼ˆens33ï¼‰,ä¸æ˜¯ens36\n[glance]\napi_servers = http://controller-1:9292\n[oslo_concurrency]\nlock_path = /var/lib/nova/tmp\n[placement]\nregion_name = RegionOne\nproject_domain_name = Default\nproject_name = service\nauth_type = password\nuser_domain_name = Default\nauth_url = http://controller-1:5000/v3\nusername = placement\npassword = PLACEMENT_PASS\n#PLACEMENT_PASS ä¸º Placement æœåŠ¡å¯†ç \nEOF\n\negrep -c '(vmx|svm)' /proc/cpuinfo\n---------------------------------------------------------------------------------\n# å¦‚æœè¿”å›å€¼å¤§äº 1 åˆ™è¯´æ˜å·²ç»å¼€å¯ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œæ— éœ€é…ç½® qemu\n# å¦‚ç­‰äº 0 ï¼Œåˆ™éœ€è¦é…ç½® qemu ä»¥ä»£æ›¿é»˜è®¤çš„ kvm\nvi /etc/nova/nova.conf\n[libvirt]\n# ...\nvirt_type = qemu\n\n# ä»¥ä¸Šé…ç½®ä»…å½“ egrep -c '(vmx|svm)' /proc/cpuinfo ç»“æœä¸º 0 æ—¶æ‰è¿›è¡Œé…ç½®\n---------------------------------------------------------------------------------\nsystemctl enable libvirtd.service openstack-nova-compute.service --now\nsystemctl status libvirtd.service openstack-nova-compute.service \n```\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[computer-3]</font>\n\n```\nyum install openstack-nova-compute -y\nmv /etc/nova/nova.conf{,.bak}\ncat > /etc/nova/nova.conf <<EOF\n[DEFAULT]\nenabled_apis = osapi_compute,metadata\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1\nmy_ip = 192.168.148.103\ncompute_driver=libvirt.LibvirtDriver\nlog_file = /var/log/nova/nova-compute.log\n# 192.168.148.103æ›¿æ¢ä¸º è®¡ç®—èŠ‚ç‚¹ç®¡ç†ç½‘ç»œ IP åœ°å€\n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000/\nauth_url = http://controller-1:5000/\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = nova\npassword = NOVA_PASS\n#NOVA_PASSä¸ºnovaæœåŠ¡å¯†ç \n[vnc]\nenabled = true\nserver_listen = 0.0.0.0\nserver_proxyclient_address = \\$my_ip\nnovncproxy_base_url = http://192.168.48.101:6080/vnc_auto.html\n# å°† 192.168.48.101ä¿®æ”¹ä¸ºæ§åˆ¶èŠ‚ç‚¹çš„å¤–éƒ¨ç½‘ç»œ IP ï¼ˆens33ï¼‰,ä¸æ˜¯ens36\n[glance]\napi_servers = http://controller-1:9292\n[oslo_concurrency]\nlock_path = /var/lib/nova/tmp\n[placement]\nregion_name = RegionOne\nproject_domain_name = Default\nproject_name = service\nauth_type = password\nuser_domain_name = Default\nauth_url = http://controller-1:5000/v3\nusername = placement\npassword = PLACEMENT_PASS\n#PLACEMENT_PASS ä¸º Placement æœåŠ¡å¯†ç \nEOF\n\negrep -c '(vmx|svm)' /proc/cpuinfo\n---------------------------------------------------------------------------------\n# å¦‚æœè¿”å›å€¼å¤§äº 1 åˆ™è¯´æ˜å·²ç»å¼€å¯ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œæ— éœ€é…ç½® qemu\n# å¦‚ç­‰äº 0 ï¼Œåˆ™éœ€è¦é…ç½® qemu ä»¥ä»£æ›¿é»˜è®¤çš„ kvm\nvi /etc/nova/nova.conf\n[libvirt]\n# ...\nvirt_type = qemu\n\n# ä»¥ä¸Šé…ç½®ä»…å½“ egrep -c '(vmx|svm)' /proc/cpuinfo ç»“æœä¸º 0 æ—¶æ‰è¿›è¡Œé…ç½®\n---------------------------------------------------------------------------------\n\nsystemctl enable libvirtd.service openstack-nova-compute.service --now\nsystemctl status libvirtd.service openstack-nova-compute.service \n```\n\n### éªŒè¯\n\næ“ä½œèŠ‚ç‚¹[controller-1]\n\n```\nsource admin-openrc\nopenstack compute service list --service nova-compute\n\n[root@controller-1 ~]# openstack compute service list --service nova-compute\n+----+--------------+------------+------+---------+-------+----------------------------+\n| ID | Binary       | Host       | Zone | Status  | State | Updated At                 |\n+----+--------------+------------+------+---------+-------+----------------------------+\n|  9 | nova-compute | computer-2 | nova | enabled | up    | 2024-01-04T17:00:00.000000 |\n| 10 | nova-compute | computer-3 | nova | enabled | up    | 2024-01-04T17:00:06.000000 |\n+----+--------------+------------+------+---------+-------+----------------------------+\n\n# åœ¨æ§åˆ¶èŠ‚ç‚¹æ‰§è¡ŒéªŒè¯\nsu -s /bin/sh -c \"nova-manage cell_v2 discover_hosts --verbose\" nova\n[root@controller-1 ~]# su -s /bin/sh -c \"nova-manage cell_v2 discover_hosts --verbose\" nova\nFound 2 cell mappings.\nSkipping cell0 since it does not contain hosts.\nGetting computes from cell 'cell1': a1cc1ff2-388b-46c3-b8ea-b92c1182fbc8\nChecking host mapping for compute host 'computer-2': cddb3327-9712-411d-8592-eb39a5eb240e\nCreating host mapping for compute host 'computer-2': cddb3327-9712-411d-8592-eb39a5eb240e\nChecking host mapping for compute host 'computer-3': fb280b19-efde-4e26-972a-0ba060be847e\nCreating host mapping for compute host 'computer-3': fb280b19-efde-4e26-972a-0ba060be847e\n\n#è¿½åŠ åœ¨æœ«å°¾\ncat >>/etc/nova/nova.conf << EOF\n[scheduler]\ndiscover_hosts_in_cells_interval = 300\nEOF\ndiscover_hosts_in_cells_interval å‚æ•°æŒ‡å®šäº†è°ƒåº¦å™¨å‘ç°ä¸»æœºçš„é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤å€¼ä¸º 300 ç§’ï¼ˆå³ 5 åˆ†é’Ÿï¼‰ã€‚è¿™æ„å‘³ç€è°ƒåº¦å™¨æ¯éš” 5 åˆ†é’Ÿä¼šæ£€æŸ¥å¹¶å‘ç°æ–°çš„ä¸»æœºã€‚\n```\n\n## Neutronï¼ˆç½‘ç»œæœåŠ¡ï¼‰\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\n##æ§åˆ¶èŠ‚ç‚¹controller-1\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE neutron;\nGRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' \\\n  IDENTIFIED BY 'NEUTRON_DBPASS';\nGRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' \\\n  IDENTIFIED BY 'NEUTRON_DBPASS';\nflush privileges;\nexit\nsource admin-openrc\nopenstack user create --domain default --password NEUTRON_PASS neutron\nopenstack role add --project service --user neutron admin\nopenstack service create --name neutron \\\n  --description \"OpenStack Networking\" network\nopenstack endpoint create --region RegionOne \\\n  network public http://controller-1:9696\nopenstack endpoint create --region RegionOne \\\n  network internal http://controller-1:9696\nopenstack endpoint create --region RegionOne \\\n  network admin http://controller-1:9696\n# é€‰æ‹©å®‰è£… å¤§äºŒå±‚ ç½‘ç»œ\nyum install openstack-neutron openstack-neutron-ml2 \\\n  openstack-neutron-linuxbridge ebtables -y\n\nmv /etc/neutron/neutron.conf{,.bak}\ncat > /etc/neutron/neutron.conf <<EOF\n\n[database]\nconnection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller-1/neutron\n#NEUTRON_DBPASSä¸º æ•°æ®åº“ neutron è´¦æˆ·å¯†ç \n[DEFAULT]\ncore_plugin = ml2\nservice_plugins = router\nallow_overlapping_ips = true\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1\nauth_strategy = keystone\nnotify_nova_on_port_status_changes = true\nnotify_nova_on_port_data_changes = true\n# RABBIT_PASS ä¸º æ¶ˆæ¯é˜Ÿåˆ—å¯†ç \n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000\nauth_url = http://controller-1:5000\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\n# NEUTRON_PASSä¸º neutron æœåŠ¡å¯†ç \n[nova]\nauth_url = http://controller-1:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = nova\npassword = NOVA_PASS\n# [nova]  æ²¡æœ‰åˆ™æ·»åŠ \n# NOVA_PASSä¸º Nova æœåŠ¡å¯†ç \n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\nEOF\n\nmv /etc/neutron/plugins/ml2/ml2_conf.ini{,.bak}\ncat > /etc/neutron/plugins/ml2/ml2_conf.ini << EOF\n\n[ml2]\ntype_drivers = flat,vlan,vxlan\ntenant_network_types = vxlan\nmechanism_drivers = linuxbridge,l2population\nextension_drivers = port_security\n[ml2_type_flat]\nflat_networks = provider\n[ml2_type_vxlan]\nvni_ranges = 1:1000\n[securitygroup]\nenable_ipset = true\nEOF\n\nmv /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}\ncat > /etc/neutron/plugins/ml2/linuxbridge_agent.ini <<EOF\n\n[linux_bridge]\nphysical_interface_mappings = provider:ens36\n# ens36 ä¸ºç¬¬äºŒå—ç½‘å¡åç§°\n[vxlan]\nenable_vxlan = true\nlocal_ip = 192.168.148.101\nl2_population = true\n# 192.168.148.101 ä¸ºç®¡ç†ç½‘ç»œ æ§åˆ¶èŠ‚ç‚¹çš„ IP  å³ controller-1 IP\n[securitygroup]\nenable_security_group = true\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\nEOF\n\nmv /etc/neutron/l3_agent.ini{,.bak}\ncat > /etc/neutron/l3_agent.ini << EOF\n\n[DEFAULT]\ninterface_driver = linuxbridge\nEOF\n\nmv /etc/neutron/dhcp_agent.ini{,.bak}\ncat > /etc/neutron/dhcp_agent.ini << EOF\n\n[DEFAULT]\ninterface_driver = linuxbridge\ndhcp_driver = neutron.agent.linux.dhcp.Dnsmasq\nenable_isolated_metadata = true\nEOF\n\n----------------------\n\nmodprobe br_netfilter\ncat >>/etc/rc.sysinit<<EOF\n\n#!/bin/bash\nfor file in /etc/sysconfig/modules/*.modules ; do\n[ -x $file ] && $file\ndone\nEOF\necho \"modprobe br_netfilter\" >/etc/sysconfig/modules/br_netfilter.modules\nchmod 755 /etc/sysconfig/modules/br_netfilter.modules\nsysctl -a | grep net.bridge.bridge-nf-call\n----------------------\n\nmv /etc/neutron/metadata_agent.ini{,.bak}\ncat >> /etc/neutron/metadata_agent.ini << EOF\n\n[DEFAULT]\nnova_metadata_host = controller-1\nmetadata_proxy_shared_secret = METADATA_SECRET\n# METADATA_SECRET ä¸º å…ƒæ•°æ® çš„å¯†é’¥\nEOF\n\ncat >> /etc/nova/nova.conf << EOF\n\n#è¿½åŠ åœ¨æœ«å°¾\n[neutron]\nauth_url = http://controller-1:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\nservice_metadata_proxy = true\nmetadata_proxy_shared_secret = METADATA_SECRET\n#NEUTRON_PASS  ä¸º neutron æœåŠ¡çš„å¯†ç \n#METADATA_SECRET ä¸ºä¸Šè¾¹è®¾ç½®çš„å…ƒæ•°æ®å¯†é’¥\nEOF\n\n-------------------\n\nln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini\n\nsu -s /bin/sh -c \"neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head\" neutron\n\nsystemctl restart openstack-nova-api.service\n\nsystemctl enable --now neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service neutron-l3-agent.service\n\nsystemctl status neutron-server.service  neutron-linuxbridge-agent.service neutron-dhcp-agent.service   neutron-metadata-agent.service  neutron-l3-agent.service\n\n```\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[computer-2]</font>\n\n```\n###computeè®¡ç®—èŠ‚ç‚¹\nyum install openstack-neutron-linuxbridge ebtables ipset -y \n\nmv /etc/neutron/neutron.conf{,.bak}\ncat > /etc/neutron/neutron.conf << EOF\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1\n#RABBIT_PASSä¸º æ§åˆ¶èŠ‚ç‚¹ æ¶ˆæ¯é˜Ÿåˆ— å¯†ç \nauth_strategy = keystone\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000\nauth_url = http://controller-1:5000\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\n# NEUTRON_PASS  ä¸ºæ§åˆ¶èŠ‚ç‚¹ neutron æœåŠ¡å¯†ç \n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\nEOF\n\nmv /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}\ncat >> /etc/neutron/plugins/ml2/linuxbridge_agent.ini <<EOF\n[linux_bridge]\nphysical_interface_mappings = provider:ens36\n# ens36 ä¸º ç¬¬äºŒå—ç½‘å¡åå­—\n[vxlan]\nenable_vxlan = true\nlocal_ip = 192.168.148.102\nl2_population = true\n# 192.168.148.102  ä¸º computer-2 ç®¡ç†ç½‘ç»œçš„ IP åœ°å€\n[securitygroup]\nenable_security_group = true\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\nEOF\n\ncat >> /etc/nova/nova.conf << EOF\n[neutron]\nauth_url = http://controller-1:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\nservice_metadata_proxy = true\nmetadata_proxy_shared_secret = METADATA_SECRET\n# NEUTRON_PASS  ä¸º neutron æœåŠ¡çš„å¯†ç \n# METADATA_SECRET ä¸ºä¸Šè¾¹è®¾ç½®çš„å…ƒæ•°æ®å¯†é’¥\n\nEOF\n-------------------\nmodprobe br_netfilter\ncat >>/etc/rc.sysinit<<EOF\n#!/bin/bash\nfor file in /etc/sysconfig/modules/*.modules ; do\n[ -x $file ] && $file\ndone\nEOF\necho \"modprobe br_netfilter\" >/etc/sysconfig/modules/br_netfilter.modules\nchmod 755 /etc/sysconfig/modules/br_netfilter.modules\nsysctl -a | grep net.bridge.bridrge-nf-call\n-------------------\nsystemctl enable neutron-linuxbridge-agent.service --now\nsystemctl restart openstack-nova-compute.service neutron-linuxbridge-agent.service\nsystemctl status neutron-linuxbridge-agent.service\n\n```\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[computer-3]</font>\n\n```\n###computeè®¡ç®—èŠ‚ç‚¹\nyum install openstack-neutron-linuxbridge ebtables ipset -y \n\nmv /etc/neutron/neutron.conf{,.bak}\ncat > /etc/neutron/neutron.conf << EOF\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1\n#RABBIT_PASSä¸º æ§åˆ¶èŠ‚ç‚¹ æ¶ˆæ¯é˜Ÿåˆ— å¯†ç \nauth_strategy = keystone\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000\nauth_url = http://controller-1:5000\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\n# NEUTRON_PASS  ä¸ºæ§åˆ¶èŠ‚ç‚¹ neutron æœåŠ¡å¯†ç \n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\nEOF\n\nmv /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}\ncat >> /etc/neutron/plugins/ml2/linuxbridge_agent.ini <<EOF\n[linux_bridge]\nphysical_interface_mappings = provider:ens36\n# ens36 ä¸º ç¬¬äºŒå—ç½‘å¡åå­—\n[vxlan]\nenable_vxlan = true\nlocal_ip = 192.168.148.103\nl2_population = true\n# 192.168.148.103  ä¸º computer-3 ç®¡ç†ç½‘ç»œçš„ IP åœ°å€\n[securitygroup]\nenable_security_group = true\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\nEOF\n\ncat >> /etc/nova/nova.conf << EOF\n[neutron]\nauth_url = http://controller-1:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\nservice_metadata_proxy = true\nmetadata_proxy_shared_secret = METADATA_SECRET\n# NEUTRON_PASS  ä¸º neutron æœåŠ¡çš„å¯†ç \n# METADATA_SECRET ä¸ºä¸Šè¾¹è®¾ç½®çš„å…ƒæ•°æ®å¯†é’¥\n\nEOF\n-------------------\nmodprobe br_netfilter\ncat >>/etc/rc.sysinit<<EOF\n#!/bin/bash\nfor file in /etc/sysconfig/modules/*.modules ; do\n[ -x $file ] && $file\ndone\nEOF\necho \"modprobe br_netfilter\" >/etc/sysconfig/modules/br_netfilter.modules\nchmod 755 /etc/sysconfig/modules/br_netfilter.modules\nsysctl -a | grep net.bridge.bridrge-nf-call\n-------------------\nsystemctl enable neutron-linuxbridge-agent.service --now\nsystemctl restart openstack-nova-compute.service neutron-linuxbridge-agent.service\nsystemctl status neutron-linuxbridge-agent.service\n\n```\n\n### éªŒè¯\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\nsource admin-openrc\nopenstack network agent list\n#ç¡®ä¿å…­ä¸ªéƒ½æ˜¯upåœ¨åšä¸‹ä¸€æ­¥\n[root@controller-1 ~]# openstack network agent list\n+--------------------------------------+--------------------+--------------+-------------------+-------+-------+---------------------------+\n| ID                                   | Agent Type         | Host         | Availability Zone | Alive | State | Binary                    |\n+--------------------------------------+--------------------+--------------+-------------------+-------+-------+---------------------------+\n| 33e3f611-c4e6-4f0c-abe0-ba22afaa7fba | Linux bridge agent | computer-2   | None              | :-)   | UP    | neutron-linuxbridge-agent |\n| 485af228-87fd-4270-8e35-cca6562910ce | L3 agent           | controller-1 | nova              | :-)   | UP    | neutron-l3-agent          |\n| 68c8b1e7-e75a-4adb-9c92-6ceea4983b65 | Linux bridge agent | computer-3   | None              | :-)   | UP    | neutron-linuxbridge-agent |\n| 96db82bf-d658-474e-b44a-db270bf0d677 | DHCP agent         | controller-1 | nova              | :-)   | UP    | neutron-dhcp-agent        |\n| c6f55bf1-5140-43fe-a0b2-1d7248539f7e | Linux bridge agent | controller-1 | None              | :-)   | UP    | neutron-linuxbridge-agent |\n| f396cc24-9168-4fd0-aaba-869842315caf | Metadata agent     | controller-1 | None              | :-)   | UP    | neutron-metadata-agent    |\n+--------------------------------------+--------------------+--------------+-------------------+-------+-------+---------------------------+\n[root@controller-1 ~]#\n\n```\n\n## Horizonï¼ˆç•Œé¢æœåŠ¡ï¼‰\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\n###æ§åˆ¶èŠ‚ç‚¹\nyum install openstack-dashboard -y\ncp /etc/openstack-dashboard/local_settings{,.bak}\n#æ³¨é‡Šä»¥ä¸‹ä¿¡æ¯\nsed -i 's/^ALLOWED_HOSTS/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^OPENSTACK_HOST/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^OPENSTACK_KEYSTONE_URL/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^TIME_ZONE/#&/' /etc/openstack-dashboard/local_settings\n\nè¿½åŠ å†…å®¹\ncat >> /etc/openstack-dashboard/local_settings <<EOF\nALLOWED_HOSTS = ['*']\nSESSION_ENGINE = 'django.contrib.sessions.backends.cache'\nCACHES = {\n    'default': {\n         'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',\n         'LOCATION': 'controller-1:11211',\n    }\n}\nOPENSTACK_HOST = \"controller-1\"\nOPENSTACK_KEYSTONE_URL = \"http://%s:5000/identity/v3\" % OPENSTACK_HOST\nOPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True\nOPENSTACK_API_VERSIONS = {\n    \"identity\": 3,\n    \"image\": 2,\n    \"volume\": 3,\n}\nOPENSTACK_KEYSTONE_DEFAULT_DOMAIN = \"Default\"\nOPENSTACK_KEYSTONE_DEFAULT_ROLE = \"user\"\nTIME_ZONE = \"Asia/Shanghai\"\n# æœ‰åˆ™ä¿®æ”¹æ²¡æœ‰åˆ™æ·»åŠ \nEOF\necho \"WEBROOT = '/dashboard'\" >> /etc/openstack-dashboard/local_settings\nsed -i \"s/'enable_distributed_router': False,/'enable_distributed_router': True,/g\" /etc/openstack-dashboard/local_settings\nsed -i \"s/'enable_ha_router': False,/'enable_ha_router': True,/g\" /etc/openstack-dashboard/local_settings\nsed -i \"/'enable_router': True,/a 'enable_lb': True,\" /etc/openstack-dashboard/local_settings\nsed -i \"/'enable_lb': True,/a 'enable_firewall': True,\" /etc/openstack-dashboard/local_settings\nsed -i \"/'enable_firewall': True,/a 'enable_vpn': True,\" /etc/openstack-dashboard/local_settings\n\ncp /etc/httpd/conf.d/openstack-dashboard.conf{,.bak}\ncat >> /etc/httpd/conf.d/openstack-dashboard.conf << EOF\nWSGIApplicationGroup %{GLOBAL}\nEOF\n\nsystemctl restart httpd memcached\nsystemctl status httpd memcached\n\n# éªŒè¯\n# è®¿é—® http://192.168.48.101/dashboard  ï¼ˆæ§åˆ¶èŠ‚ç‚¹ipï¼‰\n# ç™»å½•ç”¨æˆ·å¯†ç  å¯ä½¿ç”¨ admin æˆ– user_dog\n# åŸŸå ä½¿ç”¨ Default\n```\n\n## Cinderï¼ˆå—å­˜å‚¨æœåŠ¡ï¼‰\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\n###æ§åˆ¶èŠ‚ç‚¹\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE cinder;\nGRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' \\\n  IDENTIFIED BY 'CINDER_DBPASS';\nGRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' \\\n  IDENTIFIED BY 'CINDER_DBPASS';\nexit\n# CINDER_DBPASS ä¸º cinder æ•°æ®åº“è´¦æˆ·å¯†ç \nsource admin-openrc\nopenstack user create --domain default --password CINDER_PASS cinder\nopenstack role add --project service --user cinder admin\n  openstack service create --name cinderv3 \\\n  --description \"OpenStack Block Storage\" volumev3\nopenstack endpoint create --region RegionOne \\\n  volumev3 public http://controller-1:8776/v3/%\\(project_id\\)s\nopenstack endpoint create --region RegionOne \\\n  volumev3 internal http://controller-1:8776/v3/%\\(project_id\\)s\nopenstack endpoint create --region RegionOne \\\n  volumev3 admin http://controller-1:8776/v3/%\\(project_id\\)s\n\nyum install openstack-cinder -y\nmv /etc/cinder/cinder.conf{,.bak}\ncat > /etc/cinder/cinder.conf << EOF\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1\nauth_strategy = keystone\nmy_ip = 192.168.148.101\n# æ§åˆ¶èŠ‚ç‚¹ç®¡ç†ç½‘ç»œ IP\n[database]\nconnection = mysql+pymysql://cinder:CINDER_DBPASS@controller-1/cinder\n# CINDER_DBPASS ä¸ºæ•°æ®åº“ Cinder è´¦æˆ·å¯†ç \n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000\nauth_url = http://controller-1:5000\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = cinder\npassword = CINDER_PASS\n# CINDER_PASS ä¸º Cinder æœåŠ¡å¯†ç \n[oslo_concurrency]\nlock_path = /var/lib/cinder/tmp\nEOF\n\nsu -s /bin/sh -c \"cinder-manage db sync\" cinder\n\nsystemctl restart openstack-nova-api.service\nsystemctl status openstack-nova-api.service\nsystemctl enable --now openstack-cinder-api.service openstack-cinder-scheduler.service\nsystemctl status openstack-cinder-api.service openstack-cinder-scheduler.service\n```\n\n###  æ·»åŠ ç‰©ç†ç£ç›˜\n\n å…³é—­æ‰€æœ‰èŠ‚ç‚¹(è¿è¡Œä¸äº†ï¼Œè¯·å›å¼€å¤´ï¼Œå¤åˆ¶å…³é—­é¡ºåºè„šæœ¬)<font color='red'>ï¼ˆæ³¨æ„å…³é—­é¡ºåºï¼Œè¿™é‡Œä¸åœ¨è¯´æ˜ï¼Œå›å¤´çœ‹ï¼‰</font>\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[æ‰€æœ‰èŠ‚ç‚¹]</font>\n\n```\nsh stop.sh\n```\n\nç»™computer-3æ·»åŠ ä¸€å—100gçš„ç£ç›˜\n\n![image-20240105171301012](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/c0a1e3c2ee116a980e5d0ad5d7926985697559838.png)\n\nåœ¨å¼€æœºæ‰§è¡Œ\n\n```\nsh start.sh\n```\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[computer-3]</font>\n\n```\n###computer-3èŠ‚ç‚¹\n\næ·»åŠ ä¸€å—ç‰©ç†ç£ç›˜\n[root@computer-3 ~]# lsblk\nNAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda               8:0    0  100G  0 disk\nâ”œâ”€sda1            8:1    0    1G  0 part /boot\nâ””â”€sda2            8:2    0   99G  0 part\n  â”œâ”€centos-root 253:0    0   50G  0 lvm  /\n  â”œâ”€centos-swap 253:1    0  3.6G  0 lvm  [SWAP]\n  â””â”€centos-home 253:2    0 45.4G  0 lvm  /home\nsdb               8:16   0  100G  0 disk       #è¿™ä¸ªå°±æ˜¯æ–°æ·»åŠ çš„ç£ç›˜\nsr0              11:0    1 1024M  0 rom\n\nyum install lvm2 device-mapper-persistent-data -y\nsystemctl enable lvm2-lvmetad.service --now\n# å¦‚æ˜¾ç¤ºä¸å­˜åœ¨åˆ™è¯´æ˜ç³»ç»Ÿé»˜è®¤å®‰è£…äº† lvm  ä»¥ä¸Šæ­¥éª¤å¯å¿½ç•¥\n\n#åˆ›å»º/dev/sdbå·ç»„\npvcreate /dev/sdb\n# Physical volume \"/dev/sdb\" successfully created.\n\nvgcreate cinder-volumes /dev/sdb\n# Volume group \"cinder-volumes\" successfully created\n# sdb ä¸ºåˆ’åˆ†ç»™å—å­˜å‚¨ä½¿ç”¨çš„ç£ç›˜\n# å¦‚æœ‰å¤šä¸ªç£ç›˜ï¼Œåˆ™éœ€é‡å¤ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤\n\n\ncp /etc/lvm/lvm.conf{,.bak}\nsed -i '130 a\\filter = [ \"a/sdb/\",\"r/.*/\"]' /etc/lvm/lvm.conf\n#sdbæ˜¯ä¸Šé¢æ·»åŠ çš„æ–°çš„ç‰©ç†ç£ç›˜\n# å¦‚æœ‰å¤šä¸ªç£ç›˜ï¼Œåˆ™å°†ç£ç›˜ç¼–å·ä»¥å›ºå®šæ ¼å¼æ·»åŠ åˆ°è¿‡æ»¤è®¾å¤‡ä¸­ï¼Œä¾‹å¦‚æœ‰ä¸¤ä¸ªç£ç›˜ sdb sdc ï¼Œåˆ™ä¸º filter = [ \"a/sdb/\", \"a/sdc/\",\"r/.*/\"]\n\n\nyum install openstack-cinder targetcli python-keystone -y\nmv /etc/cinder/cinder.conf{,.bak}\ncat >> /etc/cinder/cinder.conf << EOF\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1\nauth_strategy = keystone\nmy_ip = 192.168.148.103\nenabled_backends = lvm\nglance_api_servers = http://controller-1:9292\n# 192.168.148.103  ä¸ºå—å­˜å‚¨èŠ‚ç‚¹ computer-3ç®¡ç†ç½‘ç»œ çš„æ¥å£IP\n[database]\nconnection = mysql+pymysql://cinder:CINDER_DBPASS@controller-1/cinder\n# CINDER_DBPASS ä¸ºæ•°æ®åº“ Cinder è´¦æˆ·å¯†ç \n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000\nauth_url = http://controller-1:5000\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = cinder\npassword = CINDER_PASS\n# CINDER_PASS ä¸º cinder æ•°æ®åº“è´¦æˆ·å¯†ç \n[lvm]\nvolume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver\nvolume_group = cinder-volumes\ntarget_protocol = iscsi\ntarget_helper = lioadm\n# [lvm]  æ²¡æœ‰åˆ™æ–°å»º\n[oslo_concurrency]\nlock_path = /var/lib/cinder/tmp\nEOF\n\nsystemctl enable openstack-cinder-volume.service target.service --now\nsystemctl status openstack-cinder-volume.service target.service\n\n```\n\n### éªŒè¯\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\nsource admin-openrc\nopenstack volume service list\nsystemctl restart httpd memcached\n\n[root@controller-1 ~]# openstack volume service list\n+------------------+----------------+------+---------+-------+----------------------------+\n| Binary           | Host           | Zone | Status  | State | Updated At                 |\n+------------------+----------------+------+---------+-------+----------------------------+\n| cinder-scheduler | controller-1   | nova | enabled | up    | 2024-01-05T09:27:48.000000 |\n| cinder-volume    | computer-3@lvm | nova | enabled | up    | 2024-01-05T09:27:44.000000 |\n+------------------+----------------+------+---------+-------+----------------------------+\n\n```\n\n## Swiftï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰\n\n<font color='red'>å…³é—­æ‰€æœ‰èŠ‚ç‚¹ï¼Œå›å¤´çœ‹ç‰©ç†å…³é—­é¡ºåº</font>\n\nç»™<font color='red'>computer-3</font>æ·»åŠ 4å¼ ç¡¬ç›˜ï¼Œæ·»åŠ å®Œä¹‹åå°±å¯ä»¥å¼€æœºäº†\n\n![image-20240107001040770](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/2737f3006c57c7583f0d05ef3da5951e697559838.png)\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\n###æ§åˆ¶èŠ‚ç‚¹\nsource admin-openrc\nopenstack user create --domain default --password SWIFT_PASS swift\nopenstack role add --project service --user swift admin\n#åˆ›å»ºswiftæœåŠ¡å®ä½“ï¼š\nopenstack service create --name swift \\\n  --description \"OpenStack Object Storage\" object-store\n#åˆ›å»ºswiftæœåŠ¡å®ä½“ï¼š\nopenstack endpoint create --region RegionOne \\\nobject-store public http://controller-1:8080/v1/AUTH_%\\(project_id\\)s\n\nopenstack endpoint create --region RegionOne \\\nobject-store internal http://controller-1:8080/v1/AUTH_%\\(project_id\\)s\n\nopenstack endpoint create --region RegionOne \\\nobject-store admin http://controller-1:8080/v1\n\n#å®‰è£…swiftç»„ä»¶\nyum install -y openstack-swift-proxy python-swiftclient \\\n  python-keystoneclient python-keystonemiddleware \\\n  Memcached\n\nmv /etc/swift/proxy-server.conf{,.bak}\ncat> /etc/swift/proxy-server.conf<<EOF\n[DEFAULT]\nbind_ip = 0.0.0.0\nbind_port = 8080\nuser = swift\n[pipeline:main]\npipeline = catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit authtoken keystoneauth container-quotas account-quotas slo dlo versioned_writes proxy-logging proxy-server\n[app:proxy-server]\nuse = egg:swift#proxy\nallow_account_management = true\naccount_autocreate = true\n#Keystone auth info\n[filter:authtoken]\npaste.filter_factory = keystonemiddleware.auth_token:filter_factory\nwww_authenticate_uri = http://controller-1:5000\nauth_url = http://controller-1:5000/v3\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = swift\npassword = SWIFT_PASS\ndelay_auth_decision = true\nservice_token_roles_required = True\n[filter:keystoneauth]\nuse = egg:swift#keystoneauth\noperator_roles = admin,user\n[filter:healthcheck]\nuse = egg:swift#healthcheck\n[filter:cache]\nuse = egg:swift#memcache\nmemcache_servers = controller-1:11211\n[filter:ratelimit]\nuse = egg:swift#ratelimit\n[filter:domain_remap]\nuse = egg:swift#domain_remap\n[filter:catch_errors]\nuse = egg:swift#catch_errors\n[filter:cname_lookup]\nuse = egg:swift#cname_lookup\n[filter:staticweb]\nuse = egg:swift#staticweb\n[filter:tempurl]\nuse = egg:swift#tempurl\n[filter:formpost]\nuse = egg:swift#formpost\n[filter:name_check]\nuse = egg:swift#name_check\n[filter:list-endpoints]\nuse = egg:swift#list_endpoints\n[filter:proxy-logging]\nuse = egg:swift#proxy_logging\n[filter:bulk]\nuse = egg:swift#bulk\n[filter:slo]\nuse = egg:swift#slo\n[filter:dlo]\nuse = egg:swift#dlo\n[filter:container-quotas]\nuse = egg:swift#container_quotas\n[filter:account-quotas]\nuse = egg:swift#account_quotas\n[filter:gatekeeper]\nuse = egg:swift#gatekeeper\n[filter:container_sync]\nuse = egg:swift#container_sync\n[filter:xprofile]\nuse = egg:swift#xprofile\n[filter:versioned_writes]\nuse = egg:swift#versioned_writes\nEOF\n```\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[computer-3]</font>\n\n```\nlsblk\n```\n\n![image-20240107001422383](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/b38a836ef849a8a2ae7a15f933687430697559838.png)\n\n```\n#conpute-3èŠ‚ç‚¹\nyum install xfsprogs rsync -y\n\nlsblk\n#å°†/dev/sdbå’Œ/dev/sdcè®¾å¤‡æ ¼å¼åŒ–ä¸ºXFSï¼š\nmkfs.xfs /dev/sdc\nmkfs.xfs /dev/sdd\nmkfs.xfs /dev/sde\nmkfs.xfs /dev/sdf\n#åˆ›å»ºå®‰è£…ç‚¹ç›®å½•ç»“æ„ï¼š\nmkdir -p /srv/node/sdc\nmkdir -p /srv/node/sdd\nmkdir -p /srv/node/sde\nmkdir -p /srv/node/sdf\n\ncat >> /etc/fstab << EOF\n/dev/sdc /srv/node/sdc xfs noatime,nodiratime,nobarrier,logbufs=8 0 2\n/dev/sdd /srv/node/sdd xfs noatime,nodiratime,nobarrier,logbufs=8 0 2\n/dev/sde /srv/node/sde xfs noatime,nodiratime,nobarrier,logbufs=8 0 2\n/dev/sdf /srv/node/sdf xfs noatime,nodiratime,nobarrier,logbufs=8 0 2\nEOF\n\n#å®‰è£…è®¾å¤‡\nmount /srv/node/sdc\nmount /srv/node/sdd\nmount /srv/node/sde\nmount /srv/node/sdf\n\ncat>/etc/rsyncd.conf<<EOF\nuid = swift\ngid = swift\nlog file = /var/log/rsyncd.log\npid file = /var/run/rsyncd.pid\naddress = 192.168.148.103\n#192.168.148.103ä¸ºcomputer-3çš„ç®¡ç†ç½‘ç»œip\n[account]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/account.lock\n\n[container]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/container.lock\n\n[object]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/object.lock\nEOF\n\n#é‡å¯æœåŠ¡\nsystemctl enable rsyncd.service\nsystemctl start rsyncd.service\n\n#å®‰è£…swiftç»„ä»¶\nyum install -y openstack-swift-account openstack-swift-container \\\n  openstack-swift-object\n  \nmv /etc/swift/account-server.conf{,.bak}\ncat> /etc/swift/account-server.conf<<EOF\n[DEFAULT]\nbind_ip = 192.168.148.103\nbind_port = 6202\nuser = swift\nswift_dir = /etc/swift\ndevices = /srv/node\nmount_check = true\n[pipeline:main]\npipeline = healthcheck recon account-server\n[app:account-server]\nuse = egg:swift#account\n[filter:healthcheck]\nuse = egg:swift#healthcheck\n[filter:recon]\nuse = egg:swift#recon\nrecon_cache_path = /var/cache/swift\n[account-replicator]\n[account-auditor]\n[account-reaper]\n[filter:xprofile]\nuse = egg:swift#xprofile\nEOF\n\nmv /etc/swift/container-server.conf{,.bak}\ncat> /etc/swift/container-server.conf<<EOF\n[DEFAULT]\nbind_ip = 192.168.148.103\nbind_port = 6201\nuser = swift\nswift_dir = /etc/swift\ndevices = /srv/node\nmount_check = true\n[pipeline:main]\npipeline = healthcheck recon container-server\n[app:container-server]\nuse = egg:swift#container\n[filter:healthcheck]\nuse = egg:swift#healthcheck\n[filter:recon]\nuse = egg:swift#recon\n[container-replicator]\n[container-updater]\n[container-auditor]\n[container-sync]\n[filter:xprofile]\nuse = egg:swift#xprofile\n[container-sharder]\nEOF\n\nmv /etc/swift/object-server.conf{,.bak}\ncat> /etc/swift/object-server.conf<<EOF\n[DEFAULT]\nbind_ip = 0.0.0.0\nbind_port = 6200\nuser = swift\nswift_dir = /etc/swift\ndevices = /srv/node\nmount_check = true\n[pipeline:main]\npipeline = healthcheck recon object-server\n[app:object-server]\nuse = egg:swift#object\nrecon_cache_path = /var/cache/swift\nrecon_lock_path = /var/lock\n[filter:healthcheck]\nuse = egg:swift#healthcheck\n[filter:recon]\nuse = egg:swift#recon\n[object-replicator]\n[object-reconstructor]\n[object-updater]\n[object-expirer]\n[filter:xprofile]\nuse = egg:swift#xprofile\n[object-relinker]\n[object-auditor]\nlog_name = object-auditor\nlog_facility = LOG_LOCAL0\nlog_level = INFO\nlog_address=/dev/log   \nEOF\n#ç¡®ä¿å¯¹å®‰è£…ç‚¹ç›®å½•ç»“æ„æ‹¥æœ‰é€‚å½“çš„æ‰€æœ‰æƒï¼š\nchown -R swift:swift /srv/node\n\n#åˆ›å»ºreconç›®å½•å¹¶ç¡®ä¿å¯¹å…¶æ‹¥æœ‰é€‚å½“çš„æ‰€æœ‰æƒï¼š\n mkdir -p /var/cache/swift\n chown -R root:swift /var/cache/swift\n chmod -R 775 /var/cache/swift\n \n# åœ¨é˜²ç«å¢™ä¸­å¯ç”¨å¿…è¦çš„è®¿é—®(å®éªŒå¿½ç•¥)\nfirewall-cmd --permanent --add-port=6200/tcp\nfirewall-cmd --permanent --add-port=6201/tcp\nfirewall-cmd --permanent --add-port=6202/tcp\n\n```\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n<font color='red'>åˆ›å»ºå’Œåˆ†å‘åˆå§‹ç¯</font>\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\nè½¬åˆ°/etc/swiftç›®å½•ã€‚(æ‰€ä»¥æ“ä½œåœ¨æ­¤ç›®å½•ï¼Œæ‰§è¡Œ)\nåˆ›å»ºç”¨æˆ·ç¯account.builderæ–‡ä»¶ï¼š\ncd /etc/swift\n##ç¬¬ä¸€éƒ¨åˆ†ï¼ˆ6202ï¼‰åˆ›å»ºç”¨æˆ·ç¯\nswift-ring-builder account.builder create 10 3 1\nswift-ring-builder account.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.103 --port 6202 --device sdc --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.103 --port 6202 --device sdd --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.103 --port 6202 --device sde --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.103 --port 6202 --device sdf --weight 100\nswift-ring-builder account.builder\n##é‡æ–°å¹³è¡¡ç¯ä¸”éªŒè¯\nswift-ring-builder account.builder rebalance\nswift-ring-builder account.builder\n\n\n##ç¬¬äºŒéƒ¨åˆ†ï¼ˆ6201ï¼‰åˆ›å»ºå®¹å™¨ç¯\nswift-ring-builder container.builder create 10 3 1\nswift-ring-builder container.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.103 --port 6201 --device sdc --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.103 --port 6201 --device sdd --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.103 --port 6201 --device sde --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.103 --port 6201 --device sdf --weight 100\nswift-ring-builder container.builder\nswift-ring-builder container.builder rebalance\n\n##ç¬¬ä¸‰éƒ¨åˆ†ï¼ˆ6200ï¼‰åˆ›å»ºå¯¹è±¡ç¯\nswift-ring-builder object.builder create 10 3 1\nswift-ring-builder object.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.103 --port 6200 --device sdc --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.103 --port 6200 --device sdd --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.103 --port 6200 --device sde --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.103 --port 6200 --device sdf --weight 100\nswift-ring-builder object.builder\nswift-ring-builder object.builder rebalance\n\nå°†swiftç›®å½•ä¸‹ç”Ÿæˆä¸‰ä¸ª.gzæ–‡ä»¶å¤åˆ¶åˆ°å­˜å‚¨èŠ‚ç‚¹çš„swiftç›®å½•ä¸‹\nscp account.ring.gz container.ring.gz object.ring.gz 192.168.148.103:/etc/swift\n\n##å®Œæˆå®‰è£… controller-1\nmv  /etc/swift/swift.conf{,.bak}\ncat> /etc/swift/swift.conf<<EOF\n[swift-hash]\nswift_hash_path_suffix = swift\nswift_hash_path_prefix = swift\n[storage-policy:0]\nname = Policy-0\ndefault = yes\nEOF\n-------------------------------------------------------------------------------------\n#å°†æ§åˆ¶èŠ‚ç‚¹çš„swifté…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å­˜å‚¨èŠ‚ç‚¹ï¼ˆcomputer-3ï¼‰\nscp swift.conf 192.168.148.103:/etc/swift\n\nswift_hash_path_suffixå’Œswift_hash_path_prefixä½œä¸ºå“ˆå¸Œç®—æ³•çš„ä¸€éƒ¨åˆ†ç”¨äºç¡®å®šæ•°æ®åœ¨é›†ç¾¤ä¸­çš„ä½ç½®ã€‚\nè¿™äº›å€¼åº”è¯¥ä¿æŒæœºå¯†ï¼Œå¹¶ä¸”åœ¨éƒ¨ç½²é›†ç¾¤ä¹‹åä¸èƒ½æ›´æ”¹ä¸¢å¤±ã€‚å¯è‡ªå®šä¹‰\n-------------------------------------------------------------------------------------\nåœ¨æ‰€æœ‰èŠ‚ç‚¹ç¡®ä¿å¯¹é…ç½®ç›®å½•æ‹¥æœ‰é€‚å½“çš„æ‰€æœ‰æƒï¼š\n####å­˜å‚¨èŠ‚ç‚¹ä¸æ§åˆ¶èŠ‚ç‚¹åŒæ—¶æ‰§è¡Œï¼ˆæ³¨æ„ï¼ï¼ï¼ï¼ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶æ‰§è¡Œï¼‰\næ“ä½œèŠ‚ç‚¹[controller-1ï¼Œcomputer-3]\n\nchown -R root:swift /etc/swift \n\nåœ¨æ§åˆ¶å™¨èŠ‚ç‚¹å’Œä»»ä½•å…¶ä»–è¿è¡Œä»£ç†æœåŠ¡çš„èŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨å¯¹è±¡å­˜å‚¨ä»£ç†æœåŠ¡åŠå…¶ç›¸å…³æ€§ï¼Œå¹¶å°†å®ƒä»¬é…ç½®ä¸ºåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(å­˜å‚¨èŠ‚ç‚¹æ— ä»£ç†æœåŠ¡)\n-------------------------------------------------------------------------------------\n#é‡å¯æœåŠ¡(æ“ä½œèŠ‚ç‚¹[controller-1]\nsystemctl enable openstack-swift-proxy.service memcached.service --now\nsystemctl restart openstack-swift-proxy.service memcached.service\n```\n\n### è®¡ç®—èŠ‚ç‚¹\n\n```\nåœ¨å­˜å‚¨èŠ‚ç‚¹å¯åŠ¨æ‰€æœ‰æœåŠ¡\n systemctl enable openstack-swift-account.service openstack-swift-account-auditor.service \\\n  openstack-swift-account-reaper.service openstack-swift-account-replicator.service\n systemctl start openstack-swift-account.service openstack-swift-account-auditor.service \\\n  openstack-swift-account-reaper.service openstack-swift-account-replicator.service\n systemctl enable openstack-swift-container.service \\\n  openstack-swift-container-auditor.service openstack-swift-container-replicator.service \\\n  openstack-swift-container-updater.service\n systemctl start openstack-swift-container.service \\\n  openstack-swift-container-auditor.service openstack-swift-container-replicator.service \\\n  openstack-swift-container-updater.service\n systemctl enable openstack-swift-object.service openstack-swift-object-auditor.service \\\n  openstack-swift-object-replicator.service openstack-swift-object-updater.service\n systemctl start openstack-swift-object.service openstack-swift-object-auditor.service \\\n  openstack-swift-object-replicator.service openstack-swift-object-updater.service\n```\n\n### éªŒè¯\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\ncd /etc/swift\nswift stat\n[root@controller-1 swift]# swift stat\n               Account: AUTH_07a1ce96dca54f1bb0d3b968f1343617\n            Containers: 0\n               Objects: 0\n                 Bytes: 0\n       X-Put-Timestamp: 1684919814.32783\n           X-Timestamp: 1684919814.32783\n            X-Trans-Id: txd6f3affa0140455b935ff-00646dd605\n          Content-Type: text/plain; charset=utf-8\nX-Openstack-Request-Id: txd6f3affa0140455b935ff-00646dd605\n\n#æµ‹è¯•ä¸Šä¼ é•œåƒ\n[root@controller-1 swift]# cd\n[root@controller-1 ~]# swift upload demo cirros-0.6.2-x86_64-disk.img --object-name image\nimage\n\nsystemctl restart httpd memcached\nsystemctl status httpd memcached\n\n##é‡å¯novaæœåŠ¡\nsudo systemctl restart openstack-nova*\n\n```\n\n![image-20240107002628456](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/1f2bbbaf1bed2cb9551ccf60f442e9a1697559838.png)\n\n## Heatï¼ˆç¼–æ’ï¼‰\n\n### <font color='red'>æ“ä½œèŠ‚ç‚¹[controller-1]</font>\n\n```\n#åˆ›å»ºheatæ•°æ®åº“å’Œç”¨æˆ·\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE heat;\nGRANT ALL PRIVILEGES ON heat.* TO 'heat'@'localhost' \\\n  IDENTIFIED BY 'HEAT_DBPASS';\nGRANT ALL PRIVILEGES ON heat.* TO 'heat'@'%' \\\n  IDENTIFIED BY 'HEAT_DBPASS';\nflush privileges;\nexit\n\nsource admin-openrc\nopenstack user create --domain default --password HEAT_PASS heat\n#æ·»åŠ  admin è§’è‰²åˆ° heat ç”¨æˆ·ä¸Š\nopenstack role add --project service --user heat admin\n##åˆ›å»ºheatå’Œ heat-cfn æœåŠ¡å®ä½“\nopenstack service create --name heat \\\n  --description \"Orchestration\" orchestration\nopenstack service create --name heat-cfn \\\n  --description \"Orchestration\"  cloudformation  \n##åˆ›å»º Orchestration æœåŠ¡çš„ API ç«¯ç‚¹\nopenstack endpoint create --region RegionOne \\\n  orchestration public http://controller-1:8004/v1/%\\(tenant_id\\)s\nopenstack endpoint create --region RegionOne \\\n  orchestration internal http://controller-1:8004/v1/%\\(tenant_id\\)s\nopenstack endpoint create --region RegionOne \\\n  orchestration admin http://controller-1:8004/v1/%\\(tenant_id\\)s\n\nopenstack endpoint create --region RegionOne \\\n  cloudformation public http://controller-1:8000/v1\nopenstack endpoint create --region RegionOne \\\n  cloudformation internal http://controller-1:8000/v1\nopenstack endpoint create --region RegionOne \\\n  cloudformation admin http://controller-1:8000/v1\n```\n\nä¸ºäº†ç®¡ç†æ ˆï¼Œåœ¨è®¤è¯æœåŠ¡ä¸­Orchestrationéœ€è¦æ›´å¤šä¿¡æ¯\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\n#ä¸ºæ ˆåˆ›å»º heat åŒ…å«é¡¹ç›®å’Œç”¨æˆ·çš„åŸŸ\nopenstack domain create --description \"Stack projects and users\" heat\n\n#åœ¨ heat åŸŸä¸­åˆ›å»ºç®¡ç†é¡¹ç›®å’Œç”¨æˆ·çš„heat_domain_adminç”¨æˆ·ï¼š\nopenstack user create --domain heat --password=HEAT_DOMAIN_USER_PASS heat_domain_admin\n\n#)æ·»åŠ adminè§’è‰²åˆ° heat åŸŸ ä¸­çš„heat_domain_adminç”¨æˆ·ï¼Œå¯ç”¨heat_domain_adminç”¨æˆ·#ç®¡ç†æ ˆçš„ç®¡ç†æƒé™\nopenstack role add --domain heat --user-domain heat --user heat_domain_admin admin\n\n#ä¸ºæ ˆåˆ›å»º heat åŒ…å«é¡¹ç›®å’Œç”¨æˆ·çš„åŸŸ\nopenstack role create heat_stack_owner\n\n#æ·»åŠ heat_stack_owner è§’è‰²åˆ°demo é¡¹ç›®å’Œç”¨æˆ·ï¼Œå¯ç”¨demo ç”¨æˆ·ç®¡ç†æ ˆã€‚\nopenstack role add --project demo --user demo heat_stack_owner\n#å¿…é¡»æ·»åŠ  heat_stack_owner è§’è‰²åˆ°æ¯ä¸ªç®¡ç†æ ˆçš„ç”¨æˆ·ã€‚\n\n#heat_stack_user è§’è‰²\nopenstack role create heat_stack_user\n\n```\n\nå®‰è£…å¹¶é…ç½®Heatç»„ä»¶ç›¸å…³è½¯ä»¶\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\nyum install openstack-heat-api openstack-heat-api-cfn \\\n  openstack-heat-engine -y\n\nmv /etc/heat/heat.conf{,.bak}\ncat > /etc/heat/heat.conf << EOF\n[database]\nconnection = mysql+pymysql://heat:HEAT_DBPASS@controller-1/heat  \n#HEAT_DBPASSæ˜¯HEATæ•°æ®åº“å¯†ç \n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-1\n#RABBIT_PASSä¸ºRabbitmqæœåŠ¡å¯†ç  ç”¨æˆ·åæ˜¯openstack\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-1:5000\nauth_url = http://controller-1:5000\nmemcached_servers = controller-1:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = heat\npassword = HEAT_PASS\n#HEAT_PASSæ˜¯heatç”¨æˆ·å¯†ç \n[trustee]\nauth_type = password\nauth_url = http://controller-1:5000\nusername = heat\npassword = HEAT_PASS\n#HEAT_PASSæ˜¯heatç”¨æˆ·å¯†ç \nuser_domain_name = default\n[clients_keystone]\nauth_uri = http://controller-1:5000\n[DEFAULT]\nheat_metadata_server_url = http://controller-1:8000\nheat_waitcondition_server_url = http://controller-1:8000/v1/waitcondition\n[DEFAULT]\nstack_domain_admin = heat_domain_admin\nstack_domain_admin_password = HEAT_DOMAIN_USER_PASS\nstack_user_domain_name = heat\nEOF\n\nsu -s /bin/sh -c \"heat-manage db_sync\" heat\n##å¯åŠ¨ Orchestration ç¼–æ’æœåŠ¡heatç»„ä»¶å¹¶å°†å…¶è®¾ç½®ä¸ºéšç³»ç»Ÿå¯åŠ¨\nsystemctl enable openstack-heat-api.service \\\n  openstack-heat-api-cfn.service openstack-heat-engine.service\n\nsystemctl restart openstack-heat-api.service \\\n  openstack-heat-api-cfn.service openstack-heat-engine.service\n  \n```\n\n### éªŒè¯\n\n```\nsystemctl list-unit-files |grep openstack-heat*\n\n[root@controller-1 ~]# systemctl list-unit-files |grep openstack-heat*\nopenstack-heat-api-cfn.service                enabled\nopenstack-heat-api.service                    enabled\nopenstack-heat-engine.service                 enabled\n-------------------------------------------------------------------------------\ncd\nsource admin-openrc\nopenstack service list\nopenstack orchestration service list\nè¯¥è¾“å‡ºæ˜¾ç¤ºè¡¨æ˜åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šæœ‰åº”è¯¥å››ä¸ªheat-engineç»„ä»¶ã€‚\n\n[root@controller-1 ~]# openstack orchestration service list\n+--------------+-------------+--------------------------------------+--------------+--------+----------------------------+--------+\n| Hostname     | Binary      | Engine ID                            | Host         | Topic  | Updated At                 | Status |\n+--------------+-------------+--------------------------------------+--------------+--------+----------------------------+--------+\n| controller-1 | heat-engine | a0f45441-3550-4b59-8b69-f57d668dfbf2 | controller-1 | engine | 2024-01-06T16:00:18.000000 | up     |\n| controller-1 | heat-engine | 8fade664-a171-4f1e-9bec-6410bd3add07 | controller-1 | engine | 2024-01-06T16:00:18.000000 | up     |\n| controller-1 | heat-engine | 8318df8d-1171-40ff-b70e-1be979e6ebcc | controller-1 | engine | 2024-01-06T16:00:18.000000 | up     |\n| controller-1 | heat-engine | c843e3c0-7884-4384-9873-a7d8788b77a0 | controller-1 | engine | 2024-01-06T16:00:18.000000 | up     |\n+--------------+-------------+--------------------------------------+--------------+--------+----------------------------+--------+\n\nsystemctl restart httpd memcached\nsystemctl status httpd memcached\n\n```\n\n\n\n## åˆ›å»ºå®ä¾‹\n\n### åˆ›å»ºå®ä¾‹ç±»å‹\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»è®¡ç®—ï¼Œç‚¹å‡»å®ä¾‹ç±»å‹ï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºå®ä¾‹ç±»å‹ã€‚\n\n![image-20240106230035149](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/55d5112b942c438d89818b728d7d3062697559838.png)\n\næ ¹æ®ä»¥ä¸Šå›¾ç‰‡æ­¥éª¤ä¾æ¬¡å¡«å…¥ï¼šå®ä¾‹åç§°ã€VCPUæ•°é‡ã€å†…å­˜å¤§å°ã€æ ¹ç£ç›˜å¤§å°ï¼Œç¡®è®¤æ— è¯¯åç‚¹å‡»åˆ›å»ºå®ä¾‹ç±»å‹ã€‚\n\n### åˆ›å»ºé•œåƒ\n\næµ‹è¯•é•œåƒï¼šhttps://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img\n\n<font color='red'>æœ‰ä¸¤ç§ä¸Šä¼ æ–¹å¼ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼ï¼ï¼</font>\n\n<font color='red'>1.Windowsä¸Šä¼ é•œåƒæ–¹å¼</font>\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»è®¡ç®—ï¼Œç‚¹å‡»é•œåƒï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºé•œåƒã€‚\n\nWindowsä¸‹è½½åˆ°æœ¬åœ°å³å¯\n\n![image-20240106230649633](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/f2ea42f3b57b4b7a5fb9bd242f78e526697559838.png)\n\næ ¹æ®ä»¥ä¸Šå›¾ç‰‡æ­¥éª¤ä¾æ¬¡å¡«å…¥ï¼šé•œåƒåç§°ã€é€‰æ‹©æ–‡ä»¶ã€é•œåƒæ ¼å¼ï¼Œç¡®è®¤æ— è¯¯åç‚¹å‡»åˆ›å»ºé•œåƒã€‚\n**æ³¨**ï¼šæ¼”ç¤ºä¸Šä¼ çš„ img é•œåƒæ ¼å¼éœ€é€‰ç”¨ QCOW2 - QEMUæ¨¡æ‹Ÿå™¨ æ‰å¯æ­£å¸¸åŠ è½½ã€‚\n\n\n\n<font color='red'>2.Linuxä¸Šä¼ é•œåƒæ–¹å¼</font>\n\n```\nsource admin-openrc\nwget https://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img\n#å¯èƒ½ä¼šä¸‹è½½ä¸åˆ°ï¼Œå¯ä»¥å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨ä¸‹è½½ï¼Œç„¶åç§»åˆ°/root/ç›®å½•ä¸‹\nglance image-create --name \"cirros\" \\\n  --file cirros-0.6.2-x86_64-disk.img \\\n  --disk-format qcow2 --container-format bare \\\n  --visibility=public\n\nopenstack image list\n\n[root@controller-1 ~]# openstack image list\n+--------------------------------------+--------+--------+\n| ID                                   | Name   | Status |\n+--------------------------------------+--------+--------+\n| 627761da-7f8c-4780-842a-e50e62f5c464 | cirros | active |\n+--------------------------------------+--------+--------+\n\n```\n\n### åˆ›å»ºå†…éƒ¨ç½‘ç»œ\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºç½‘ç»œã€‚\n\n![image-20240106231124036](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/cea509bcbba7395e7c5710616943c0bd697559838.png)\n\n![image-20240106231151367](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/6bab28f65a2c56a624df71c4b9866347697559838.png)\n\n![image-20240106231323081](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/0b1b24f8d99f5c3f49662532c68ac046697559838.png)\n\n### åˆ›å»ºå¤–éƒ¨ç½‘ç»œ\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºç½‘ç»œã€‚\n\n<font color='red'>å¦‚æœä½ æ˜¯æŒ‰ç…§æœ¬æ–‡æ¡£æ­å»ºçš„ï¼Œå°±å¡«provider</font>\n\n![image-20240106231633793](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/5fbbf082bc66e60949bdd81825facd02697559838.png)\n\n![image-20240106231854446](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/070d5393f9a1b8dd7dee9d2fea10086e697559838.png)\n\n![image-20240106232011057](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/d0a471b28e40019c7fc79bc8918cda04697559838.png)\n\n### åˆ›å»ºè·¯ç”±\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»è·¯ç”±ï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºè·¯ç”±ã€‚\n\n![image-20240106232138022](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/31d170f9b1e99be47760fd014bb6809d697559838.png)\n\n\n\n![image-20240106232201129](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/cb31565a3cfeb2dc853ac38cded0043e697559838.png)\n\n![image-20240106232242376](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/ce7823ed963eca1a54ca8b97f14928e5697559838.png)\n\n### æ·»åŠ å®‰å…¨ç»„è§„åˆ™\n\n![image-20240106232342515](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/757fee2ef006d00f258da6008163fe91697559838.png)\n\n![image-20240106232725982](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/b99fadf3fe10a6ddba4ba221b3c2ff87697559838.png)\n\næœ€åæ•ˆæœé•¿è¿™æ ·\n\n![image-20240106232758711](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/485233affd839f8fbce7ea1c0ae2765d697559838.png)\n\n### åˆ›å»ºå®ä¾‹\n\n![image-20240106232939110](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/0105c7af8682dc647d6cf79473cd9fbc697559838.png)\n\n![image-20240106233038731](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/86ffdba6219b46e5a387f8b67fa5edf7697559838.png)\n\n![image-20240106233101509](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/8bf413d2923a38d956d41f905d1a4f6b697559838.png)\n\n![image-20240106233129659](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/3083c4669cd60df3c5a53b7b5f661629697559838.png)\n\nç„¶åç‚¹å‡»åˆ›å»ºå®ä¾‹\n\nåˆ†é…æµ®åŠ¨ip\n\n![image-20240106233251169](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/bfb7b78b90815059f8171048bcb0683b697559838.png)\n\n![image-20240106233418787](../img/OpenStack-Train-%E4%B8%89%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2.assets/f584f2ac4bb92bb8043c2c07c670dbf4697559838.png)\n\n<font color='red'>ç»“è®ºï¼šåˆ›å»ºå®ä¾‹æˆåŠŸ</font>\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Centos 7","OpenStack"],"categories":["äº‘åŸç”Ÿ"]},{"title":"k8séƒ¨ç½²Prometheus+Grafana","url":"/posts/25424/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# k8séƒ¨ç½²Prometheus+Grafana\n\n![image-20240107005039292](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/99194bb5049ba5669d662e158dabf24c697559838.png)\n\n| ä¸»æœºå  | ip1ï¼ˆNATï¼‰     | ç³»ç»Ÿ      | ç£ç›˜ | å†…å­˜ |\n| ------- | -------------- | --------- | ---- | ---- |\n| master1 | 192.168.48.101 | Centos7.9 | 100G | 4G   |\n| master2 | 192.168.48.102 | Centos7.9 | 100G | 4G   |\n| master3 | 192.168.48.103 | Centos7.9 | 100G | 4G   |\n| node01  | 192.168.48.104 | Centos7.9 | 100G | 6G   |\n| node02  | 192.168.48.105 | Centos7.9 | 100G | 6G   |\n\n<font color='red'>åšè¿™ä¸ªä¹‹å‰ä½ è¦æ‹¥æœ‰ä¸€ä¸ªk8sé›†ç¾¤ï¼Œå‚è€ƒä»¥ä¸‹æ•™ç¨‹</font>\n\n[K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå†…éƒ¨etcdï¼‰ - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/7158/)\n\n[K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå¤–éƒ¨etcdï¼‰ - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/59349/)\n\n## éƒ¨ç½²Prometheus\n\nåˆ›å»ºå‘½åç©ºé—´\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```\nkubectl create namespace prometheus-work\n```\n\néƒ¨ç½²Prometheus deploy\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```yaml\ncat >prome_deploy.yml<< \"EOF\"\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: prometheus\n  namespace: prometheus-work\n  labels:\n    app: prometheus\nspec:\n  selector:\n    matchLabels:\n      app: prometheus\n  template:\n    metadata:\n      labels:\n        app: prometheus\n    spec:\n      securityContext:                                   #æŒ‡å®šè¿è¡Œçš„ç”¨æˆ·ä¸ºroot\n        runAsUser: 0\n      serviceAccountName: prometheus\n      containers:\n      - image: prom/prometheus:v2.30.2\n        name: prometheus\n        args:\n        - \"--config.file=/etc/prometheus/prometheus.yml\" #é€šè¿‡volumeæŒ‚è½½prometheus.yml\n        - \"--storage.tsdb.path=/prometheus\"              #é€šè¿‡vlolumeæŒ‚è½½ç›®å½•/prometheus\n        - \"--storage.tsdb.retention.time=24h\"\n        - \"--web.enable-admin-api\"                       #æ§åˆ¶å¯¹admin HTTP APIçš„è®¿é—®\n        - \"--web.enable-lifecycle\"                       #æ”¯æŒçƒ­æ›´æ–°ï¼Œç›´æ¥æ‰§è¡Œlocalhost:9090/-/reloadç«‹å³ç”Ÿæ•ˆ\n        ports:\n        - containerPort: 9090\n          name: http\n        volumeMounts:\n        - mountPath: \"/etc/prometheus\"\n          name: config-volume\n        - mountPath: \"/prometheus\"\n          name: data\n        resources:\n          requests:\n            cpu: 100m\n            memory: 512Mi\n          limits:\n            cpu: 100m\n            memory: 512Mi\n      volumes:\n      - name: data\n        persistentVolumeClaim:\n          claimName: prometheus-data  #æœ¬åœ°å­˜å‚¨\n      - name: config-volume\n        configMap:\n          name: prometheus-config     #å®šä¹‰çš„prometeus.yaml\n\nEOF\nkubectl apply -f prome_deploy.yml\n\n```\n\néƒ¨ç½²Prometheus service\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```yaml\ncat> prome_svc.yml<< \"EOF\"\napiVersion: v1\nkind: Service\nmetadata:\n  name: prometheus\n  namespace: prometheus-work\n  labels:\n    app: prometheus\nspec:\n  selector:\n    app: prometheus\n  type: NodePort\n  ports:\n    - name: web\n      port: 9090\n      targetPort: http\nEOF\nkubectl apply -f prome_svc.yml\n\n```\n\néƒ¨ç½²configmap\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```yaml\ncat > prome_cfg.yml << \"EOF\"\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: prometheus-config\n  namespace: prometheus-work\ndata:\n  prometheus.yml: |\n    global:\n      scrape_interval: 15s\n      scrape_timeout: 15s\n    scrape_configs:\n    - job_name: 'prometheus'\n      static_configs:\n      - targets: ['localhost:9090']\n\nEOF\n kubectl apply -f prome_cfg.yml\n\n```\n\néƒ¨ç½²PVï¼ŒPVC\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[node01]</font>\n\n```\n#åœ¨node01èŠ‚ç‚¹ä¸Šæ‰§è¡Œ\nmkdir /data/k8s/prometheus -p\n```\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```yaml\ncat > prome_pvc.yml << \"EOF\"\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: prometheus-local\n  labels:\n    app: prometheus\nspec:\n  accessModes:\n  - ReadWriteOnce\n  capacity:\n    storage: 5Gi\n  storageClassName: local-storage\n  local:\n    path: /data/k8s/prometheus  #åœ¨node01èŠ‚ç‚¹åˆ›å»ºæ­¤ç›®å½•\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - node01   #æŒ‡å®šè¿è¡Œåœ¨nodeèŠ‚ç‚¹\n  persistentVolumeReclaimPolicy: Retain\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: prometheus-data\n  namespace: prometheus-work\nspec:\n  selector:\n    matchLabels:\n      app: prometheus\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 5Gi\n  storageClassName: local-storage\n\nEOF\nkubectl apply -f prome_pvc.yml\n\n```\n\né…ç½®rabc\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```yaml\ncat > prome_rabc.yml << \"EOF\"\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: prometheus\n  namespace: prometheus-work\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole        #åˆ›å»ºä¸€ä¸ªclusterrole\nmetadata:\n  name: prometheus\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  - services\n  - endpoints\n  - pods\n  - nodes/proxy\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"extensions\"\n  resources:\n    - ingresses\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - configmaps\n  - nodes/metrics\n  verbs:\n  - get\n- nonResourceURLs:\n  - /metrics\n  verbs:\n  - get\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: prometheus\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: prometheus\nsubjects:\n- kind: ServiceAccount\n  name: prometheus\n  namespace: prometheus-work\n\nEOF\nkubectl apply -f prome_rabc.yml\n\n```\n\næŸ¥çœ‹éƒ¨ç½²çš„PrometheusæœåŠ¡\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```bash\n[root@master1 ~]# kubectl get pod,svc,configmap,sa -n prometheus-work\nNAME                             READY   STATUS    RESTARTS   AGE\npod/prometheus-db4b5c549-6gb7d   1/1     Running   0          4m39s\n\nNAME                 TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\nservice/prometheus   NodePort   10.103.99.200   <none>        9090:30512/TCP   15m    #æ³¨æ„è¿™ä¸ª30512æ˜¯åé¢è¦è®¿é—®çš„ç«¯å£\n\nNAME                          DATA   AGE\nconfigmap/kube-root-ca.crt    1      17m\nconfigmap/prometheus-config   1      14m\n\nNAME                        SECRETS   AGE\nserviceaccount/default      0         17m\nserviceaccount/prometheus   0         12m\n\n```\n\nåœ¨æµè§ˆå™¨è®¿é—®Prometheus\nè®¿é—®åœ°å€æ˜¯nodeèŠ‚ç‚¹IPåŠ ä¸Šserviceçš„nodeportç«¯å£\n\n```\n192.168.48.104:30512\n```\n\n![image-20240103162100215](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/ff121d0cea6b3d700c126869c1ec57a6697559838.png)\n\n## éƒ¨ç½²grafana\n\néƒ¨ç½²deployment\n\n```yaml\ncat >grafana.yml <<\"EOF\"\nkind: Deployment\napiVersion: apps/v1\nmetadata:\n  labels:\n    app: grafana\n  name: grafana\n  namespace: prometheus-work\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app: grafana\n  template:\n    metadata:\n      labels:\n        app: grafana\n    spec:\n      securityContext:\n        runAsNonRoot: true\n        runAsUser: 10555\n        fsGroup: 10555\n      containers:\n        - name: grafana\n          image: grafana/grafana:8.4.4\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: GF_AUTH_BASIC_ENABLED\n              value: \"true\"\n            - name: GF_AUTH_ANONYMOUS_ENABLED\n              value: \"false\"\n          readinessProbe:\n            httpGet:\n              path: /login\n              port: 3000\n          volumeMounts:\n            - mountPath: /var/lib/grafana\n              name: grafana-data-volume\n          ports:\n            - containerPort: 3000\n              protocol: TCP\n      volumes:\n        - name: grafana-data-volume\n          emptyDir: {}\n\nEOF\nkubectl apply -f grafana.yml\n```\n\néƒ¨ç½²svc\n\n```\ncat >grafana_svc.yml<<\"EOF\"\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: grafana\n  name: grafana-service\n  namespace: prometheus-work\nspec:\n  ports:\n    - port: 3000\n      targetPort: 3000\n  selector:\n    app: grafana\n  type: NodePort\n\nEOF\nkubectl apply -f grafana_svc.yml\n\n```\n\næŸ¥çœ‹æœåŠ¡\n\n```\n[root@master1 ~]# kubectl get pod,svc -n prometheus-work |grep grafana\npod/grafana-5d475d9d7-ctb2t      1/1     Running   0          5m18s\nservice/grafana-service   NodePort   10.99.157.212   <none>        3000:31163/TCP   5m12s\n#æŸ¥çœ‹grafanaçš„podåœ¨å“ªä¸ªèŠ‚ç‚¹\n[root@master1 1]# kubectl describe pod -n prometheus-work grafana-5d475d9d7-ctb2t | grep Node:\nNode:             node02/192.168.48.105\n[root@master1 1]#\n```\n\nè®¿é—®é¡µé¢http://192.168.48.105:31163\n\né¦–æ¬¡ç™»å½•grafanaï¼Œ<font color='red'>ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯admin</font>ï¼Œç™»é™†ä¹‹åä¼šè¦æ±‚ä¿®æ”¹adminçš„å¯†ç ï¼Œä¹Ÿå¯ä»¥ä¸ä¿®æ”¹\n\n![image-20240103163411877](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/a7a86e95b368d4e4d5877738b9a0741f697559838.png)\n\n![image-20240103164006642](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/6fa04500240fafe21391975276fc8e6f697559838.png)\n\n![image-20240103164054258](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/164a86ddf205de933273884be556f56c697559838.png)\n\n![image-20240103164130946](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/9c15d8da3655b36cfbf47d5f8e5c0f5a697559838.png)\n\n## ç›‘æ§å¼€å§‹\n\nä»¥ä¸‹æµ‹è¯•å‡å·²ç›‘æ§node01æ¥åšæµ‹è¯•\n\n![image-20240107005309863](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/3c8cba195ef369929b216e63061be620697559838.png)\n\n[GitHub - prometheus/node_exporter: Exporter for machine metrics](https://github.com/prometheus/node_exporter)\n\n### **ç›‘æ§linuxæœåŠ¡å™¨**\n\nä¸»è¦ç›‘æ§æŒ‡æ ‡ï¼š\n\n- CPU\n- å†…å­˜\n- ç¡¬ç›˜\n- ç½‘ç»œæµé‡\n- ç³»ç»Ÿè´Ÿè½½\n- ç³»ç»ŸæœåŠ¡\n\n#### å®‰è£…é‡‡é›†å™¨\n\nä»ä¸Šå›¾å¾—çŸ¥ç›‘æ§linuxéœ€è¦ä½¿ç”¨<font color='red'>Node exporter</font>é‡‡é›†å™¨\n\nä¸‹è½½Node exporteré‡‡é›†å™¨\n\n![image-20240103164627575](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/adadb2a4fdae2245309f74f48c037a2d697559838.png)\n\næ“ä½œèŠ‚ç‚¹[node01]\n\n```\nwget -P /usr/local/ https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz\n#ä¹Ÿå¯ä»¥è‡ªå·±å…ˆä¸‹è½½ä¸Šä¼ åˆ°/usr/local/ ä¸‹\n```\n\n```\ncd /usr/local/\ntar -xvf node_exporter-1.7.0.linux-amd64.tar.gz\nmv node_exporter-1.7.0.linux-amd64 node_exporter\ncd /usr/local/node_exporter\n./node_exporter\n```\n\nå‡ºç°ä»¥ä¸‹æ²¡å…³ç³»\n\n![image-20240103165243667](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/78c7408333844d4be10795b9faaeb494697559838.png)\n\nè®¿é—®é‡‡é›†å™¨\n\n```\nhttp://192.168.48.104:9100/\n```\n\n![image-20240103165201596](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/c2700241ef8440f353b2e2d68e84e832697559838.png)\n\n#### è®¾ç½®é‡‡é›†å™¨å¼€æœºè‡ªå¯åŠ¨\n\n**åŠ å…¥systemdç®¡ç†**\n\n```\ncat > /usr/lib/systemd/system/node_exporter.service << \"EOF\"\n[Unit]\nDescription=node_exporter\n[Service]\n#ExecStart=/usr/local/node_exporter/node_exporter --web.config=/usr/local/node_exporter/config.yml\nExecStart=/usr/local/node_exporter/node_exporter\nExecReload=/bin/kill -HUP $MAINPID\nKillMode=process\nRestart=on-failure\n[Install]\nWantedBy=multi-user.target\nEOF\n# é‡æ–°åŠ è½½\nsystemctl daemon-reload\n# å¯åŠ¨\nsystemctl start node_exporter\n# åŠ å…¥å¼€æœºè‡ªå¯\nsystemctl enable node_exporter\n```\n\n#### Prometheusé…ç½®\n\n**é…ç½®æ–‡ä»¶ä¿®æ”¹**\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```\nåœ¨Prometheusé…ç½®æ–‡ä»¶æ·»åŠ è¢«ç›‘æ§ç«¯\ncat > prome_cfg.yml << \"EOF\"\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: prometheus-config\n  namespace: prometheus-work\ndata:\n  prometheus.yml: |\n    global:\n      scrape_interval: 15s\n      scrape_timeout: 15s\n    scrape_configs:\n    - job_name: 'prometheus'\n      static_configs:\n      - targets: ['localhost:9090']\n    - job_name: 'test'\n      static_configs:\n      - targets: ['192.168.48.104:9100']\n\nEOF\nkubectl apply -f prome_cfg.yml\n```\n\nçƒ­åŠ è½½æ›´æ–°\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[node01]</font>åŠ çš„æ˜¯å“ªä¸ªèŠ‚ç‚¹å°±åœ¨å“ªä¸ªèŠ‚ç‚¹è¿›è¡Œçƒ­åŠ è½½\n\n```\n#å®ç°Prometheusçƒ­æ›´æ–°\ncurl -X POST http://192.168.48.104:30512/-/reload\n```\n\nè®¿é—®prometheusé¡µé¢æŸ¥çœ‹http://192.168.48.104:30512\n\n![image-20240103192048627](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/0bc9c1e585fc8faa1024148d386db551697559838.png)\n\nå¯ä»¥çœ‹åˆ°æœ‰è®°å½•äº†\n\n#### Grafanaå±•ç¤º\n\nå±•ç¤ºæ•°æ®éœ€è¦é…ç½®ä»ªè¡¨ç›˜ï¼Œä»ªè¡¨ç›˜å¯ä»¥è‡ªå·±åˆ¶ä½œå¯¼å…¥ï¼Œä¹Ÿå¯ä»¥ä»å®˜æ–¹ä¸‹è½½ä½¿ç”¨ã€‚\n\nè¿›å…¥grafana  http://192.168.48.105:31163\n\n![image-20240103192229794](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/68ce702e3a54fc010b5eed8a2f8a9445697559838.png)\n\nè¿™é‡Œç›´æ¥è¾“å…¥9276ä»ªè¡¨ç›˜idï¼Œç„¶åç‚¹å‡»load\n\n![image-20240103192353726](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/bc89d64827561e2d817129c323b6135c697559838.png)\n\n![image-20240103192457219](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/7e68cce07a77c185791f1a78e4d020de697559838.png)\n\n![image-20240103192553778](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/e8173f303cf08d29d0c2cf67148a372c697559838.png)\n\né»˜è®¤æƒ…å†µä¸‹ç½‘ç»œè¿™éƒ¨åˆ†æ˜¯æ²¡æœ‰æ•°æ®çš„\n\n![image-20240103192648040](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/6fb716206070e90ad7dbddb15fe7a439697559838.png)\n\n![image-20240103192728841](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/f7a3d89ddccd5d543b1cc85c8c096b9f697559838.png)\n\n![image-20240103192904616](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/7253c84bd73260228ace9c4eceeec130697559838.png)\n\nç‚¹å‡»å³ä¸Šè§’çš„saveä¿å­˜\n\n![image-20240103193009248](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/9a9b29f404b4e471832b80c35bea3094697559838.png)\n\n![image-20240103193028376](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/3fe3b746ea84bb1e57106ed40bb8db6e697559838.png)\n\n![image-20240103193049630](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/065c6e6e0252f22fe4190059064d58a9697559838.png)\n\n### ç›‘æ§å¤šå°linux\n\n- **å¤åˆ¶å®‰è£…æ–‡ä»¶**\n\nè¿œç¨‹å¤åˆ¶åˆ°æ–°å¢çš„æœºå™¨\n\n<font color='red'>å‡è®¾æˆ‘è¿˜è¦ç›‘æ§node02</font>\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[node01]</font>\n\n```\nscp -r /usr/local/node_exporter root@192.168.48.105:/usr/local/\nscp /usr/lib/systemd/system/node_exporter.service root@192.168.48.105:/usr/lib/systemd/system/\n```\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[node02]</font>\n\n```\n# é‡æ–°åŠ è½½\nsystemctl daemon-reload\n# å¯åŠ¨\nsystemctl start node_exporter\n# åŠ å…¥å¼€æœºè‡ªå¯\nsystemctl enable node_exporter\n```\n\næ·»åŠ é‡‡é›†å™¨ä¿¡æ¯\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[master1]</font>\n\n```yaml\nåœ¨Prometheusé…ç½®æ–‡ä»¶æ·»åŠ è¢«ç›‘æ§ç«¯\ncat > prome_cfg.yml << \"EOF\"\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: prometheus-config\n  namespace: prometheus-work\ndata:\n  prometheus.yml: |\n    global:\n      scrape_interval: 15s\n      scrape_timeout: 15s\n    scrape_configs:\n    - job_name: 'prometheus'\n      static_configs:\n      - targets: ['localhost:9090']\n    - job_name: 'test'\n      static_configs:\n      - targets: ['192.168.48.104:9100','192.168.48.105:9100']\n#ä»¥é€—å·åˆ†å‰²æ·»åŠ æ–°çš„node02åœ°å€çš„é‡‡é›†å™¨\nEOF\nkubectl apply -f prome_cfg.yml\n```\n\nçƒ­åŠ è½½æ›´æ–°\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[node02]</font>\n\n```\n#å®ç°Prometheusçƒ­æ›´æ–°\ncurl -X POST http://192.168.48.104:30512/-/reload\n```\n\n![image-20240103195032856](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/e128ae8ca854893d5824a025b0458b5d697559838.png)\n\n![image-20240103195105169](../img/k8s%E9%83%A8%E7%BD%B2Prometheus+Grafana.assets/e76669ac7347997d5111c26e452a98e9697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Centos 7","K8s","Prometheus","Grafana"],"categories":["äº‘åŸç”Ÿ"]},{"title":"åŸºäºCentOS Stream 8ä¸€é”®å®‰è£…OpenStack Yogaç‰ˆæœ¬","url":"/posts/11354/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# åŸºäºCentOS Stream 8ä¸€é”®å®‰è£…OpenStack Yogaç‰ˆæœ¬\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå    | ip             | å†…å­˜ | cpu  | ç¡¬ç›˜      | OS              |\n| --------- | -------------- | ---- | ---- | --------- | --------------- |\n| openstack | 192.168.48.100 | 8G   | 2v2c | 100G+100G | CentOS Stream 8 |\n\n![image-20231229212257188](../img/%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%8D%95%E8%8A%82%E7%82%B9openstack-Yoga.assets/image-20231229212257188.png)\n\næœ¬æœºé•œåƒå¯ä»¥è¿›å…¥è¿™é‡Œä¸‹è½½[CentOS-Stream-8-x86_64-latest-boot.iso](https://mirrors.aliyun.com/centos-vault/8-stream/isos/x86_64/CentOS-Stream-8-20240603.0-x86_64-dvd1.iso)\n\næ³¨æ„ï¼Centos Stream 8å·²ç»åœæ­¢æ›´æ–°äº†ï¼Œæ­¤å®éªŒå¯ä»¥ç”¨ä½œæµ‹è¯•ï¼Œä¸å¯ç”¨äºç”Ÿäº§\n\n## ç½‘ç»œé…ç½®\n\n```\n[root@localhost ~]# vi /etc/sysconfig/network-scripts/ifcfg-ens160\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nIPV6_ADDR_GEN_MODE=eui64\nNAME=ens160\nUUID=025bf07f-8fc9-41eb-b26e-13218b0d434b\nDEVICE=ens160\nONBOOT=yes\nIPADDR=192.168.48.100\nPREFIX=24\nGATEWAY=192.168.48.2\nDNS1=192.168.48.2\nDNS2=114.114.114.114\n```\n\n## åŸºç¡€é…ç½®\n\n```\n#è®¾ç½®ä¸»æœºå\nhostnamectl set-hostname openstack && bash\n\n#æ·»åŠ æœ¬åœ°åç§°è§£æ\ncat >>/etc/hosts << \"EOF\"\n192.168.48.100 openstack \nEOF\n#å…³é—­é˜²ç«å¢™\nsystemctl disable firewalld --now\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n#å€¼å¾—éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œopenstackä¸å…è®¸ä½¿ç”¨NetworkManagerï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨Networkï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…Networkçš„æœåŠ¡ã€‚\ndnf install -y network-scripts \nsystemctl disable --now NetworkManager\nsystemctl restart network\nsystemctl enable --now network\n\n#å¯ç”¨powertoolsåº“\ndnf config-manager --enable powertools\n\n#é‡å»ºä»¥ä¸‹ç¼“å­˜\ndnf clean all && dnf makecache \n\n#å‡çº§è½¯ä»¶åŒ…\ndnf -y update\nreboot\n\n```\n\n## å®‰è£…openstack\n\n```\n[root@openstack ~]#  dnf search release-openstack\n........\ncentos-release-openstack-yoga.noarch : OpenStack from the CentOS Cloud SIG repo configs\n\n#å®‰è£…æœ€æ–°çš„yogaç‰ˆæœ¬\ndnf install -y centos-release-openstack-yoga.noarch\n\n#å®‰è£…packstackè½¯ä»¶åŒ…å¹¶ç”Ÿæˆåº”ç­”æ–‡ä»¶\ndnf install -y openstack-packstack\npackstack --gen-answer-file /root/openstack-answer.txt\n\n#ä¿®æ”¹åº”ç­”æ–‡ä»¶\n#ä¸€é”®æ›¿æ¢ï¼Œè‹¥æœ‰å…¶ä»–éœ€è¦æ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹å…¶ä¸­çš„å€¼\nsed -i 's/CONFIG_HEAT_INSTALL=n/CONFIG_HEAT_INSTALL=y/g; s/CONFIG_PROVISION_DEMO=y/CONFIG_PROVISION_DEMO=n/g; s/CONFIG_NEUTRON_OVN_BRIDGE_IFACES=/CONFIG_NEUTRON_OVN_BRIDGE_IFACES=br-ex:ens160/g' /root/openstack-answer.txt\n\nsed -i 's/CONFIG_KEYSTONE_ADMIN_PW=.*/CONFIG_KEYSTONE_ADMIN_PW=admin/g' /root/openstack-answer.txt\n\n#ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ›¿æ¢\nvi /root/openstack-answer.txt\n-------------------------\nCONFIG_HEAT_INSTALL=y           #å®‰è£…heatæ¨¡æ¿æœåŠ¡\nCONFIG_PROVISION_DEMO=n         #æˆ‘ä»¬ä¸è¦æä¾›çš„demoé¡¹ç›®\nCONFIG_KEYSTONE_ADMIN_PW=admin  #è®¾ç½®ç™»é™†å¯†ç \nCONFIG_NEUTRON_OVN_BRIDGE_IFACES=br-ex:ens160            #OVNç«¯å£æ˜ å°„ï¼Œå°±æ˜¯äº‘ä¸»æœºè¿æ¥å¤–ç½‘æ—¶é€šè¿‡é‚£å—ç½‘å¡è¿›è¡Œæ•°æ®åŒ…çš„è½¬å‘\n-------------------------\n\n#å¼€å§‹å®‰è£…\npackstack --answer-file /root/openstack-answer.txt \n```\n\nç„¶åä½ å°±å¯ä»¥é€šè¿‡http://192.168.48.100/dashboardè®¿é—®é¡µé¢äº†\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Centos 8 stream","OpenStack"],"categories":["äº‘åŸç”Ÿ"]},{"title":"Cephé›†ç¾¤åˆ†å¸ƒå¼é›†ç¾¤","url":"/posts/43453/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Cephé›†ç¾¤åˆ†å¸ƒå¼é›†ç¾¤\n\næœ¬ç¯‡æ•™ç¨‹é’ˆå¯¹<font color='red'>å¤–éƒ¨</font>cephé›†ç¾¤ä»‹ç»æ•™ç¨‹ï¼Œå¦‚æœæ˜¯åŸºäºK8S<font color='red'>å†…éƒ¨</font>cephè¯·å‰å¾€[åŸºäºK8S1.28.2å®éªŒrookéƒ¨ç½²ceph - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/58032/)\n\n## æœºå™¨æ‹“æ‰‘\n\n| ä¸»æœºå | ip             | ç¡¬ç›˜1 | ç¡¬ç›˜2 | å†…å­˜ | cpu  | è½¯ä»¶                                                      | OS              |\n| ------ | -------------- | ----- | ----- | ---- | ---- | --------------------------------------------------------- | --------------- |\n| ceph1  | 192.168.48.101 | 100G  | 100G  | 2G   | 1v   | Docker 24.0.7<br />epelæœ€æ–°ç‰ˆæœ¬<br />cephï¼ˆreefã€18.2.0ï¼‰ | Centos stream 9 |\n| ceph2  | 192.168.48.102 | 100G  | 100G  | 2G   | 1v   | Docker 24.0.7<br />epelæœ€æ–°ç‰ˆæœ¬<br />cephï¼ˆreefã€18.2.0ï¼‰ | Centos stream 9 |\n| ceph3  | 192.168.48.103 | 100G  | 100G  | 2G   | 1v   | Docker 24.0.7<br />epelæœ€æ–°ç‰ˆæœ¬<br />cephï¼ˆreefã€18.2.0ï¼‰ | Centos stream 9 |\n\nå·²ç»<font color='red'>æµ‹è¯•è¿‡</font>äº†ï¼Œ<font color='red'>æœ€å°é…ç½®</font>ï¼Œå¯ä»¥æ»¡è¶³<font color='red'>æ¯•è®¾</font>éœ€æ±‚ï¼Œåé¢å¯è‡ªè¡Œæ ¹æ®éœ€è¦è°ƒæ•´\n\n![image-20231222141636094](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/ee4eca61c8df08d1a105e1140609e13f697559838.png)\n\n## åŸºç¡€é…ç½®\n\n### ç³»ç»ŸåŸºç¡€é…ç½®\n\né…ç½®ä¸»æœºå\n\nceph1\n\n```\nhostnamectl set-hostname ceph1 && bash\n```\n\nceph2\n\n```\nhostnamectl set-hostname ceph2 && bash\n```\n\nceph3\n\n```\nhostnamectl set-hostname ceph3 && bash\n```\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[æ‰€æœ‰èŠ‚ç‚¹]</font>\n\n```\n#å…³é—­é˜²ç«å¢™å’Œselinux\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\nsystemctl disable --now firewalld\n\n#è®¾ç½®æ—¶é—´åŒæ­¥\nyum install chrony -y\nsystemctl start chronyd\nsystemctl enable chronyd\nchronyc sources\nchronyc sources\n\n#é…ç½®hosts\ncat << EOF > /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.101 ceph1\n192.168.48.102 ceph2\n192.168.48.103 ceph3\nEOF\n\n#é…ç½®yum\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\ncat > /etc/yum.repos.d/centos9.repo<< \"EOF\"\n[BaseOS]\nname=Baseos\nbaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os\ngpgcheck=0\nenabled=1\n\n[AppStream]\nname=AppStream\nbaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os/\ngpgcheck=0\nenabled=1\n\n[extras-common]\nname=extras-common\nbaseurl=https://mirrors.aliyun.com/centos-stream/SIGs/9-stream/extras/x86_64/extras-common/\ngpgcheck=0\nenabled=0\n\n[ceph-reef]\nname=ceph-reef\nbaseurl=https://mirrors.aliyun.com/ceph/rpm-reef/el9/x86_64/\ngpgcheck=0\nenabled=1\n\n[epel]\nname=epel\nbaseurl=https://mirrors.aliyun.com/epel/9/Everything/x86_64/\ngpgcheck=0\nenabled=1\n\n[ceph-reef-noarch]\nname=ceph-reef-noarch\nbaseurl=https://mirrors.aliyun.com/ceph/rpm-reef/el9/noarch/\ngpgcheck=0\nenabled=1\n\nEOF\n\n# å†…æ ¸å‚æ•°è®¾ç½®ï¼šå¼€å¯IPè½¬å‘ï¼Œå…è®¸iptableså¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç† \ncat << EOF > /etc/sysctl.conf \nnet.ipv4.ip_nonlocal_bind = 1\nnet.ipv4.ip_forward = 1\nEOF\n\ncat << EOF > /etc/sysctl.d/ceph.conf \nkernel.pid_max = 4194303 \nvm.swappiness = 0 \nEOF\n\nsysctl -p\n\n#æ›´æ–°yumæº\ndnf clean all && dnf makecache\n\n#å®‰è£…è½¯ä»¶\ndnf install vim net-tools wget lsof python3 yum-utils device-mapper-persistent-data lvm2 -y\n```\n\n### é…ç½®sshå…å¯†\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[ceph1]</font>\n\n```yaml\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"ceph1\" \"ceph2\" \"ceph3\")  #å°±æ”¹è¿™ä¸ª\n# ä¸»æœºå¯†ç \npassword=\"123456\"                    #å°±æ”¹è¿™ä¸ª\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## å®‰è£…docker\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[æ‰€æœ‰èŠ‚ç‚¹]</font>\n\n```\nyum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\ndnf install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\nsystemctl enable --now docker\nmkdir -p /etc/docker\ntee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://pw860av8.mirror.aliyuncs.com\"]\n}\nEOF\nsystemctl daemon-reload\nsystemctl restart docker\ndocker info\n```\n\n## å®‰è£…cephadm\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[æ‰€æœ‰èŠ‚ç‚¹]</font>\n\n```\ndnf install --assumeyes cephadm\nwhich cephadm\n```\n\n## å®‰è£…cephé›†ç¾¤\n\n### å¯åŠ¨ä¸€ä¸ªé›†ç¾¤\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[ceph1]</font>\n\nåœ¨ ceph1 ä¸Šå¯åŠ¨ cephadm bootstrap\n\n```\ncephadm bootstrap --mon-ip 192.168.48.101\n```\n\nä¸Šè¿°æŒ‡ä»¤ä¼šä¸ºæˆ‘ä»¬å®Œæˆä»¥ä¸‹å·¥ä½œï¼š\n\n- åˆ›å»ºmon\n- åˆ›å»ºssh keyå¹¶ä¸”æ·»åŠ åˆ° /root/.ssh/authorized_keys æ–‡ä»¶\n- å°†é›†ç¾¤é—´é€šä¿¡çš„æœ€å°é…ç½®å†™å…¥/etc/ceph/ceph.conf\n- å°†client.adminç®¡ç†secretå¯†é’¥çš„å‰¯æœ¬å†™å…¥/etc/ceph/ceph.client.admin.keyringã€‚\n- å°†å…¬ç”¨å¯†é’¥çš„å‰¯æœ¬å†™å…¥/etc/ceph/ceph.pub\n\næ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š\n\næ¡†æ¡†ä¸­çš„æ˜¯cephé¡µé¢çš„è´¦å·å¯†ç \n\n![image-20231222140050214](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/452e9a762119d38b6bf2d09c4cf5871f697559838.png)\n\n<font color='red'>è®¿é—®é¡µé¢å¹¶ç”¨ä¸Šé¢çš„è´¦å·å¯†ç ç™»å…¥ï¼Œå°±ä¼šæç¤ºä½ ä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹æˆä½ è‡ªå·±çš„å¯†ç </font>\n\n```\nhttps://192.168.48.101:8443/\n```\n\n![image-20231222140150112](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/06d8cf6ce8eee0d48374ed664e384c67697559838.png)\n\nè¿è¡ŒcephæŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶æ€\n\n```\n[root@ceph1 ~]# ceph -s\nbash: ceph: command not found\n```\n\nè¿™é‡Œä¼šæ˜¾ç¤º<font color='red'>æŠ¥é”™</font>ï¼Œæˆ‘ä»¬è¦åœ¨<font color='red'>æ‰€æœ‰èŠ‚ç‚¹</font>éœ€è¦å®‰è£…ceph-common\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[æ‰€æœ‰èŠ‚ç‚¹]</font>\n\n```\ncephadm add-repo --release reef\ndnf install -y liburing\n# å®‰è£…ceph-commonåŒ…\ndnf install -y librbd1 ceph-common\n# æŸ¥çœ‹ceph-commonæ˜¯å¦æ­£å¸¸å®‰è£…\nceph -v\n```\n\nå†æ¬¡åœ¨<font color='red'>ceph1</font>æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ\n\n```\nceph -s\n```\n\n![image-20231222140331471](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/1b57598993c2effa3fb0f3c7f30edb34697559838.png)\n\nè¿™é‡Œæœ‰æŠ¥é”™æç¤º<font color='red'>HEALTH_WARN</font>æš‚æ—¶ä¸ç”¨ç®¡\n\n### æ·»åŠ cephèŠ‚ç‚¹\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[ceph1]</font>\n\n```bash\n#æ‹·è´ceph1çš„Ceph é›†ç¾¤çš„å…¬é’¥è‡³å…¶ä»–èŠ‚ç‚¹ï¼Œä»¥ä¾¿åŠ å…¥é›†ç¾¤\nssh-copy-id -f -i /etc/ceph/ceph.pub root@ceph2\nssh-copy-id -f -i /etc/ceph/ceph.pub root@ceph3\n# æ·»åŠ cephèŠ‚ç‚¹\nceph orch host add ceph2 192.168.48.102\nceph orch host add ceph3 192.168.48.103\n\nåˆ é™¤å¯ä»¥ç”¨\nceph orch host rm ceph3\n# æŸ¥çœ‹ç°åœ¨çš„èŠ‚ç‚¹æƒ…å†µ\nceph orch host ls\n# æ·»åŠ labelåå¯ä»¥å…è®¸è¯¥èŠ‚ç‚¹è¿è¡Œceph cliï¼ˆæ¯”å¦‚cephadm shellå‘½ä»¤ï¼‰\nceph orch host label add ceph2 _admin\nceph orch host label add ceph3 _admin\n# è®¾ç½® mon èŠ‚ç‚¹\nceph orch apply mon 3\nceph orch apply mon ceph1,ceph2,ceph3\n# æŸ¥çœ‹ mon è¯¦æƒ…\n[root@ceph1 ~]#  ceph mon dump\nepoch 3\nfsid 233c64c8-9e76-11ee-86fc-000c2965f5d0\nlast_changed 2023-12-19T14:13:02.000188+0000\ncreated 2023-12-19T13:56:10.829244+0000\nmin_mon_release 18 (reef)\nelection_strategy: 1\n0: [v2:192.168.48.101:3300/0,v1:192.168.48.101:6789/0] mon.ceph1\n1: [v2:192.168.48.103:3300/0,v1:192.168.48.103:6789/0] mon.ceph3\n2: [v2:192.168.48.102:3300/0,v1:192.168.48.102:6789/0] mon.ceph2\ndumped monmap epoch 3\n\n# è®¾ç½® mgr èŠ‚ç‚¹\nceph orch apply mgr 3\nceph orch apply mgr ceph1,ceph2,ceph3\n[root@ceph1 ~]#  ceph -s\n  cluster:\n    id:     233c64c8-9e76-11ee-86fc-000c2965f5d0\n    health: HEALTH_WARN\n            OSD count 0 < osd_pool_default_size 3\n\n  services:\n    mon: 3 daemons, quorum ceph1,ceph3,ceph2 (age 7m)\n    mgr: ceph1.gtejkn(active, since 18m), standbys: ceph2.rvzimn, ceph3.pbajtu\n    osd: 0 osds: 0 up, 0 in\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 B\n    usage:   0 B used, 0 B / 0 B avail\n    pgs:\n\n```\n\n### æ·»åŠ OSD\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[ceph1]</font>\n\n![image-20231222141243608](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/4b77a3a2f519ba8c01195299653efa24697559838.png)\n\n```\nceph orch daemon add osd ceph1:/dev/nvme0n2\nceph orch daemon add osd ceph2:/dev/nvme0n2\nceph orch daemon add osd ceph3:/dev/nvme0n2\n```\n\næŸ¥çœ‹çŠ¶æ€\n\n```bash\n[root@ceph1 ~]# ceph -s\n  cluster:\n    id:     233c64c8-9e76-11ee-86fc-000c2965f5d0\n    health: HEALTH_OK\n\n  services:\n    mon: 3 daemons, quorum ceph1,ceph3,ceph2 (age 25m)\n    mgr: ceph1.gtejkn(active, since 36m), standbys: ceph2.rvzimn, ceph3.pbajtu\n    osd: 3 osds: 3 up (since 20s), 3 in (since 33s)\n\n  data:\n    pools:   1 pools, 1 pgs\n    objects: 2 objects, 449 KiB\n    usage:   81 MiB used, 300 GiB / 300 GiB avail\n    pgs:     1 active+clean\n\n[root@ceph1 ~]#\n```\n\n<font color='green'>è‡³æ­¤cephé›†ç¾¤éƒ¨ç½²æˆæœ</font>\n\n## cephå­˜å‚¨çš„ä½¿ç”¨\n\n| å­˜å‚¨ç±»å‹           | ç‰¹å¾                                                         | åº”ç”¨åœºæ™¯          | å…¸å‹è®¾å¤‡  |\n| :----------------- | :----------------------------------------------------------- | :---------------- | :-------- |\n| å—å­˜å‚¨ï¼ˆRBDï¼‰      | å­˜å‚¨é€Ÿåº¦è¾ƒå¿« ä¸æ”¯æŒå…±äº«å­˜å‚¨ [**ReadWriteOnce**]              | è™šæ‹Ÿæœºç¡¬ç›˜        | ç¡¬ç›˜ Raid |\n| æ–‡ä»¶å­˜å‚¨ï¼ˆCephFSï¼‰ | å­˜å‚¨é€Ÿåº¦æ…¢ï¼ˆéœ€ç»æ“ä½œç³»ç»Ÿå¤„ç†å†è½¬ä¸ºå—å­˜å‚¨ï¼‰ æ”¯æŒå…±äº«å­˜å‚¨ [**ReadWriteMany**] | æ–‡ä»¶å…±äº«          | FTP NFS   |\n| å¯¹è±¡å­˜å‚¨ï¼ˆObjectï¼‰ | å…·å¤‡å—å­˜å‚¨çš„è¯»å†™æ€§èƒ½å’Œæ–‡ä»¶å­˜å‚¨çš„å…±äº«ç‰¹æ€§ æ“ä½œç³»ç»Ÿä¸èƒ½ç›´æ¥è®¿é—®ï¼Œåªèƒ½é€šè¿‡åº”ç”¨ç¨‹åºçº§åˆ«çš„APIè®¿é—® | å›¾ç‰‡å­˜å‚¨ è§†é¢‘å­˜å‚¨ | OSS       |\n\n### å—å­˜å‚¨(RBD)\n\n#### é…ç½®rbd\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[ceph1]</font>\n\n```bash\n------------------------------------------------------\n#åˆ›å»ºåä¸ºqianyios-rbdçš„å­˜å‚¨æ± pool\nceph osd pool create qianyios-rbd 128 128 \n\n[root@ceph1 ~]# ceph osd pool create qianyios-rbd 128 128\npool 'qianyios-rbd' created\n\n\n#åˆ é™¤poolç”¨è¿™ä¸ª\nceph osd pool delete qianyios-rbd qianyios-rbd --yes-i-really-really-mean-it\n------------------------------------------------------\n#æŸ¥çœ‹åˆ—è¡¨\nceph osd pool ls\n\n[root@ceph1 ~]# ceph osd pool ls\n.mgr\nqianyios-rbd\n------------------------------------------------------\n#å°†ç±»å‹ä¸ºå­˜å‚¨æ± çš„poolï¼ˆqianyios-rbdï¼‰è½¬æ¢ä¸ºrbdç±»å‹\nceph osd pool application enable qianyios-rbd rbd\n\n[root@ceph1 ~]# ceph osd pool application enable qianyios-rbd rbd\nenabled application 'rbd' on pool 'qianyios-rbd'\n\n------------------------------------------------------\n#åˆå§‹åŒ–qianyios-rbdå­˜å‚¨æ± \nrbd pool init qianyios-rbd\n------------------------------------------------------\n#åˆ›å»ºä¸€ä¸ªåä¸º \"qy-rbd-img\" çš„ RBD é•œåƒï¼Œå­˜å‚¨åœ¨ \"qianyios-rbd\" å­˜å‚¨æ± ä¸­ï¼Œé•œåƒçš„å¤§å°ä¸º 10GBã€‚\nrbd create -p qianyios-rbd --image qy-rbd-img --size 10G\næˆ–è€…ï¼ˆäºŒé€‰ä¸€ï¼‰\nrbd create --size 10G qianyios-rbd/qy-rbd-img\n#åˆ é™¤é•œåƒç”¨è¿™ä¸ª\nrbd rm qianyios-rbd/qy-rbd-img\n\n------------------------------------------------------\n#æŸ¥çœ‹åˆ›å»ºçŠ¶æ€\nrbd ls qianyios-rbd\n\nrbd info qianyios-rbd/qy-rbd-img\n\n[root@ceph1 ~]# rbd ls qianyios-rbd\nqy-rbd-img\n[root@ceph1 ~]# rbd info qianyios-rbd/qy-rbd-img\nrbd image 'qy-rbd-img':\n        size 10 GiB in 2560 objects\n        order 22 (4 MiB objects)\n        snapshot_count: 0\n        id: 8589e2720f1f\n        block_name_prefix: rbd_data.8589e2720f1f\n        format: 2\n        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten\n        op_features:\n        flags:\n        create_timestamp: Thu Dec 21 23:09:33 2023\n        access_timestamp: Thu Dec 21 23:09:33 2023\n        modify_timestamp: Thu Dec 21 23:09:33 2023\n\n------------------------------------------------------\n# åˆ›å»ºrbd ç”¨æˆ·keyï¼ˆéªŒè¯æ–‡ä»¶ï¼‰\n#åˆ›å»ºä¸€ä¸ªåä¸º \"qianyios-user\" çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸ºå…¶æˆäºˆè¯»å†™qianyios-rbdå­˜å‚¨æ± çš„æƒé™\nceph auth get-or-create client.qianyios-user mon 'profile rbd' osd 'profile rbd pool=qianyios-rbd' mgr 'profile rbd pool=qianyios-rbd'\n# outputä¼šè¾“å‡ºä»¥ä¸‹å†…å®¹\n[client.qianyios-user]\n        key = AQDKVYRl1nZ8ARAAvhXZojmroyy+YIb9dnTGSw==\n\nceph auth get client.qianyios-user -o /root/ceph.client.qianyios-user.keyring\n\n[root@ceph1 ~]# cat /root/ceph.client.qianyios-user.keyring\n[client.qianyios-user]\n        key = AQDKVYRl1nZ8ARAAvhXZojmroyy+YIb9dnTGSw==\n        caps mgr = \"profile rbd pool=qianyios-rbd\"\n        caps mon = \"profile rbd\"\n        caps osd = \"profile rbd pool=qianyios-rbd\"\n------------------------------------------------------\n```\n\n<font color='red'>!è®²è§£ä¸€ä¸‹è¿™ä¸ªåˆ›å»ºç”¨æˆ·keyï¼ˆéªŒè¯æ–‡ä»¶ï¼‰</font>\n\n1. è®²è§£ï¼šé€šè¿‡è¿™ä¸ªå‘½ä»¤ï¼Œä¼šåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶åˆ†åˆ«æŒ‡å®šè¿™ä¸ªç”¨æˆ·å¯¹monã€osdã€mgrçš„æƒé™ã€‚å¦‚æœä¸åŠ pool=xxxï¼Œåˆ™è¿™ä¸ªç”¨æˆ·èƒ½ç®¡ç†æ•´ä¸ªå®ˆæŠ¤è¿›ç¨‹ã€‚\n\n2. monçš„æƒé™å¿…é¡»æ˜¯mon 'profile rbd'ï¼Œå› ä¸ºMonæœåŠ¡æœ¬èº«å°±æ˜¯åªè¯»çš„ï¼Œä½ å†é™åˆ¶ä¸€ä¸ªåªè¯»æƒé™ï¼Œè„±è£¤å­æ”¾å±ã€‚ \n\n3. å‡è®¾ä½ å†™äº† osd 'profile rbd'ï¼Œåˆ™ç”¨æˆ·èƒ½ç®¡ç†æ‰€æœ‰poolçš„osdè®¾å¤‡ã€‚\n\n4. å‡è®¾ä½ å†™äº†osd 'profile rbd pool=xxx'ï¼Œåˆ™è¿™ä¸ªç”¨æˆ·å¯ä»¥è¯»å†™åå«xxxçš„poolçš„osdè®¾å¤‡ã€‚\n\n5. å‡è®¾ä½ å†™äº†osd 'profile rbd-read-only pool=xxx'ï¼Œåˆ™è¿™ä¸ªç”¨æˆ·åªèƒ½è¯»å–åå«xxxçš„poolä¸­çš„osdæ•°æ®ï¼Œä¸èƒ½å†™å…¥ã€‚\n\n6. mgråŒç†ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦å†™mgr 'profile rbd'ï¼Œå¦åˆ™Aæ± çš„ç®¡ç†å‘˜èƒ½å¤Ÿå…³é—­Bæ± çš„libradosæ¥å£ï¼Œé‚£å°±ç³Ÿç³•äº†ã€‚\n\n<font color='red'>ä¸¾ä¾‹ï¼š</font>\n\n1. åˆ›å»ºä¸€ä¸ªvolumesç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯¹volumesæ± æ‹¥æœ‰è¯»å†™æƒé™\n\n```bash\nceph auth get-or-create client.volumes mon 'profile rbd' osd 'profile rbd pool=volumes' mgr 'profile rbd pool=volumes'\n```\n\n2. åˆ›å»ºä¸€ä¸ªvolumesç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯¹volumesæ± æ‹¥æœ‰åªè¯»æƒé™ã€‚\n\n```bash\nceph auth get-or-create client.volumes mon 'profile rbd' osd 'profile rbd-read-only pool=volumes' mgr 'profile rbd pool=volumes'\n```\n\n#### å®¢æˆ·ç«¯æŒ‚è½½\n\nè¿™é‡Œæ–°å¼€ä¸€å°å®¢æˆ·æœºcentos stream 9ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å¯ä»¥æ˜¯ä½ çš„ä»»ä½•ä¸€å°æœºè¦æŒ‚è½½çš„æœºå­\n\n##### æ·»åŠ yum\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[test]æµ‹è¯•æœº</font>\n\n```\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\ncat > /etc/yum.repos.d/centos9.repo<< \"EOF\"\n[BaseOS]\nname=Baseos\nbaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os\ngpgcheck=0\nenabled=1\n\n[AppStream]\nname=AppStream\nbaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os/\ngpgcheck=0\nenabled=1\n\n[extras-common]\nname=extras-common\nbaseurl=https://mirrors.aliyun.com/centos-stream/SIGs/9-stream/extras/x86_64/extras-common/\ngpgcheck=0\nenabled=0\n\n[ceph-reef]\nname=ceph-reef\nbaseurl=https://mirrors.aliyun.com/ceph/rpm-reef/el9/x86_64/\ngpgcheck=0\nenabled=1\n\n[epel]\nname=epel\nbaseurl=https://mirrors.aliyun.com/epel/9/Everything/x86_64/\ngpgcheck=0\nenabled=1\n\n[ceph-reef-noarch]\nname=ceph-reef-noarch\nbaseurl=https://mirrors.aliyun.com/ceph/rpm-reef/el9/noarch/\ngpgcheck=0\nenabled=1\n\nEOF\ndnf clean all && dnf makecache\n```\n\n##### å®¢æˆ·ç«¯å®‰è£…cephadmå’Œceph-common\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[test]æµ‹è¯•æœº</font>\n\n```\ndnf install -y cephadm ceph-common\n```\n\n##### æ‹·è´ceph1çš„è¯ä¹¦è‡³å®¢æˆ·ç«¯\n\næŠŠceph1åˆ›å»ºçš„`ceph.client.qianyios-user.keyring `å’Œ`ceph.conf`å¤åˆ¶åˆ°å®¢æˆ·ç«¯ï¼ˆ192.168.48.128ï¼‰\n\n```\nscp /root/ceph.client.qianyios-user.keyring /etc/ceph/ceph.conf 192.168.48.128:/etc/ceph/\n```\n\n![image-20231221234526458](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/8dfd15373ce9782a78fce4cd6c6fab04697559838.png)\n\n```\n[root@test ~]# ll /etc/ceph/\ntotal 12\n-rw-r--r-- 1 root root 185 Dec 21 23:45 ceph.client.qianyios-user.keyring\n-rw-r--r-- 1 root root 283 Dec 21 23:45 ceph.conf\n-rw-r--r-- 1 root root  92 Dec 12 08:01 rbdmap\n[root@test ~]#\n\n```\n\n##### å¼€å§‹æŒ‚è½½\n\n```\nlsblk\n```\n\n![image-20231221234732781](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/7b9e98b0b89aaee9ebe74e3b00e327c9697559838.png)\n\n```bash\n#æŒ‚è½½å—å­˜å‚¨\nrbd map qianyios-rbd/qy-rbd-img --keyring /etc/ceph/ceph.client.qianyios-user.keyring --id qianyios-user\n-----\n/dev/rbd0\n-----\nlsblk\n```\n\n![image-20231221235206886](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/beeceb41666f2a645bae6ef99ea31e79697559838.png)\n\næ­¤æ—¶çš„/dev/rbd0å¹¶ä¸èƒ½ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ ¼å¼åŒ–ï¼Œå¹¶ä¸”æŒ‚è½½åˆ°æœ¬æœº\n\n```\n#æ ¼å¼åŒ–\nmkfs.xfs /dev/rbd0\n```\n\n![image-20231221235300388](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/2895454912e2a32aef8bd9a44bc84524697559838.png)\n\n```bash\n#åˆ›å»ºæŒ‚è½½ç‚¹\nmkdir /opt/qianyios-rbd\nmount /dev/rbd0 /opt/qianyios-rbd\necho \"qianyios-rbd\" > /opt/qianyios-rbd/qianyios-rbd.txt\ncat /opt/qianyios-rbd/qianyios-rbd.txt\n#èƒ½å†™å…¥æ•°æ®çš„\n```\n\n##### å–æ¶ˆæŒ‚è½½\n\n```\numount /opt/qianyios-rbd\nrbd unmap qianyios-rbd/qy-rbd-img\nlsblk\n```\n\n![image-20231221235845353](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/6c15b24a872dc2c10e18c919d93f4be6697559838.png)\n\n### æ–‡ä»¶å­˜å‚¨(CephFS)\n\n#### åˆ›å»ºcephfs\n\néƒ¨ç½²å…ƒæ•°æ®æœåŠ¡å™¨ï¼Œåˆ›å»ºä¸€ä¸ªCephFS(æ–‡ä»¶ç³»ç»Ÿ), åå­—ä¸ºqianyios-fs\n\n```\nceph fs volume create qianyios-fs --placement=\"3 ceph1 ceph2 ceph3\"\n# æŸ¥çœ‹çŠ¶æ€\nceph fs volume ls\nceph orch ps --daemon-type mds\nceph fs status qianyios-fs\nceph mds stat\n```\n\n![image-20231222130830482](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/f7d4c00cc9aa778e7644ec48f9295b50697559838.png)\n\n#### è®¾ç½®nfsé«˜å¯ç”¨\n\nå…ˆç”Ÿæˆnfså’Œnfs_ingressé…ç½®æ–‡ä»¶ã€‚å…¶ä¸­nfs_ingressæ˜¯ä¸ºäº†nfsé«˜å¯ç”¨é…ç½®çš„ã€‚\n\n```yaml\ncat <<EOF > nfs.yaml\nservice_type: nfs\nservice_id: nkonfs\nplacement:\n  hosts:\n    - ceph1\n    - ceph2\n    - ceph3\nspec:\n  port: 2048\nEOF\n\ncat <<EOF >nfs_ingress.yaml\nservice_type: ingress\nservice_id: nfs.nkonfs\nplacement:\n  count: 3\nspec:\n  backend_service: nfs.nkonfs\n  frontend_port: 2049\n  monitor_port: 9001\n  virtual_ip: 192.168.48.200/24#é«˜å¯ç”¨vip\nEOF\n```\n\n```\nceph orch apply -i nfs.yaml\nceph orch apply -i nfs_ingress.yaml\n\nceph orch ls --service_name=nfs.nkonfs\nceph orch ls --service_name=ingress.nfs.nkonfs\nceph nfs cluster ls\nceph nfs cluster info nkonfs\n```\n\n![image-20231222131458220](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/0c06c480d86468cb6fbd5af2477d7993697559838.png)\n\n#### å¯¼å‡ºnfs\n\n```\nceph nfs export create cephfs --cluster-id nkonfs --pseudo-path /qy-fs --fsname qianyios-fs\n# æŸ¥çœ‹è¯¦æƒ…\nceph nfs export info nkonfs /qy-fs\n```\n\n![image-20231222131516871](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/714155b3d6f26119cc937353e4d58155697559838.png)\n\n#### å®¢æˆ·ç«¯æŒ‚è½½NFS\n\næ³¨æ„ï¼šåªæ”¯æŒ NFS v4.0+ çš„åè®®ã€‚\nç”±äºshowmount ä¸æ”¯æŒ NFS v4ï¼Œçº¯ NFSv4åˆä¸æä¾›å…¶ä»–è·å–å¯¼å‡ºåˆ—è¡¨çš„æ–¹æ³•ï¼Œåªèƒ½æœŸæœ›æŒ‚è½½çš„æ—¶å€™å‘½ä»¤ä¸è¦è¾“é”™äº†ã€‚\nåœ¨å®¢æˆ·ç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\ndnf install -y nfs-utils\nmkdir /qy-fs-data\nmount -t nfs -o nfsvers=4.1,proto=tcp 192.168.48.200:/qy-fs /qy-fs-data\n```\n\n![image-20231222131709705](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/128567c29eeefce480d478ec756a75b2697559838.png)\n\n#### æµ‹è¯•æ–‡ä»¶å†™å…¥\n\n```\ntar zcf etc.tar.gz /etc\n \n#æµ‹è¯•æ–‡ä»¶å†™å…¥\ncp etc.tar.gz /qy-fs-data/\nll /qy-fs-data/\n \n#ç”Ÿæˆ500Må¤§æ–‡ä»¶å†™å…¥\ndd if=/dev/zero of=/qy-fs-data/testfile bs=1M count=500\n\n#æŸ¥çœ‹åˆ†åŒºä½¿ç”¨\ndf -h /fsdata\n```\n\n![image-20231222132148957](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/c892100f0204746bde00a42e9659133c697559838.png)\n\n### å¯¹è±¡å­˜å‚¨(RGW)\n\n`RGWï¼ˆRADOS Gatewayï¼‰`æ˜¯Cephå­˜å‚¨ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª`å¯¹è±¡å­˜å‚¨æœåŠ¡`\n\n`RGW`å¯ä»¥ä½œä¸ºä¸€ä¸ª`ç‹¬ç«‹çš„æœåŠ¡è¿è¡Œ`ï¼Œ`ä¹Ÿå¯ä»¥ä¸Cephé›†ç¾¤çš„å…¶ä»–ç»„ä»¶ï¼ˆå¦‚OSDå’ŒMONï¼‰ä¸€èµ·éƒ¨ç½²`ã€‚\n\n`åŒºåŸŸï¼ˆzoneï¼‰`: ä¸€ä¸ªcephé›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªåŒºåŸŸï¼Œä¸€ä¸ªåŒºåŸŸåªå±äºä¸€ä¸ªé›†ç¾¤ï¼Œä¸€ä¸ªåŒºåŸŸå¯ä»¥æœ‰å¤šä¸ªRGW\n\n`åŒºåŸŸç»„ï¼ˆzonegroupï¼‰`ï¼šç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒºåŸŸç»„æˆï¼ŒåŒ…å«ä¸€ä¸ªä¸»åŒºåŸŸï¼ˆmaster zoneï¼‰ï¼Œå…¶ä»–åŒºåŸŸç§°ä¸ºSecondary Zoneï¼ŒåŒºåŸŸç»„å†…çš„æ‰€æœ‰åŒºåŸŸä¹‹é—´åŒæ­¥æ•°æ®\n\n`åŸŸï¼ˆrealmï¼‰`: åŒä¸€ä¸ªæˆ–å¤šä¸ªåŒºåŸŸç»„ç»„æˆï¼ŒåŒ…å«ä¸€ä¸ªä¸»åŒºåŸŸç»„ï¼Œå…¶ä»–éƒ½æ¬¡åŒºåŸŸç»„ã€‚åŸŸä¸­çš„æ‰€æœ‰radosç½‘å…³éƒ½ä»ä½äºä¸»åŒºåŸŸç»„å’Œä¸»åŒºåŸŸä¸­çš„radosç½‘å…³æ‹‰å–é…ç½®\n\n#### è®¾ç½®radosgwåŒºåŸŸå’Œç”¨æˆ·\n\n![image-20231220233812600](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/4c29c4111ef003546990e4512d6019df697559838.png)\n\nåœ¨<font color='red'>æ‰€æœ‰èŠ‚ç‚¹</font>éƒ¨ç½²qianyiosé¢†åŸŸå’Œqianyios-shenzhen åŒºåŸŸçš„rgwå®ˆæŠ¤ç¨‹åºï¼š\n\n<font color='red'>æ“ä½œèŠ‚ç‚¹[æ‰€æœ‰èŠ‚ç‚¹]</font>\n\n```bash\n1.# å¦‚æœå°šæœªåˆ›å»º realmï¼ˆé¢†åŸŸï¼‰ï¼Œè¯·é¦–å…ˆåˆ›å»ºä¸€ä¸ªåå­—ä¸ºqianyiosçš„ realmï¼ˆé¢†åŸŸï¼‰ ï¼š\nradosgw-admin realm create --rgw-realm=qianyios\nradosgw-admin realm list\n\n2.# æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ zonegroupï¼ˆåŒºåŸŸç»„ï¼‰ï¼š\nradosgw-admin zonegroup create --rgw-zonegroup=qianyios-shenzhen  --master\nradosgw-admin zonegroup list\n\n3.#æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ª zoneï¼š\nradosgw-admin zone create --rgw-zonegroup=qianyios-shenzhen --rgw-zone=qianyios-shenzhen-zone1 --master\n#è¿™ä¸ªå‘½ä»¤ç”¨äºåˆ›å»ºä¸€ä¸ªåä¸º qianyios-shenzhen-zone1 çš„ RadosGW åŒºåŸŸï¼ˆZoneï¼‰ï¼Œå¹¶å°†å®ƒå½’å±äº qianyios-shenzhen çš„åŒºåŸŸç»„ï¼ˆZone Groupï¼‰ã€‚\nradosgw-admin zone list\n\n4.#è¿™ä¸ªå‘½ä»¤ç”¨äºæ›´æ–°æŒ‡å®šçš„ RadosGW åŸŸï¼ˆRealmï¼‰çš„å‘¨æœŸï¼ˆPeriodï¼‰ã€‚--rgw-realm=qianyios å‚æ•°æŒ‡å®šè¦æ›´æ–°çš„ RadosGW åŸŸçš„åç§°ä¸º qianyios\nradosgw-admin period update --rgw-realm=qianyios --commit\n\n\n5.#åœ¨ Ceph é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªåä¸º qianyios-rgw çš„ RadosGW å®ä¾‹ï¼Œå¹¶å°†å…¶å…³è”åˆ°æŒ‡å®šçš„åŸŸï¼ˆRealmï¼‰ã€åŒºåŸŸç»„ï¼ˆZone Groupï¼‰å’ŒåŒºåŸŸï¼ˆZoneï¼‰ï¼Œå¹¶æŒ‡å®šäº†å­˜å‚¨ä½ç½®ã€‚\nceph orch apply rgw qianyios-rgw --realm=qianyios --zonegroup=qianyios-shenzhen --zone=qianyios-shenzhen-zone1 --placement=\"3 ceph1 ceph2 ceph3\" --port=8080\n\n#åˆ é™¤å®ä¾‹ç”¨è¿™ä¸ª\nceph orch rm rgw.qianyios-rgw\n\n6.# æŸ¥çœ‹å„èŠ‚ç‚¹ rgw æ˜¯å¦å¯åŠ¨\nceph orch ps --daemon-type rgw\n\n7.# åˆ›å»ºåˆ›å»º radosgw ç”¨æˆ·åä¸ºadminï¼Œæ˜¾ç¤ºåç§°ä¸ºadmin user\nradosgw-admin user create --uid=\"admin\" --display-name=\"admin user\"\n\n8.# åˆ›å»ºå®Œæˆä¹‹åéœ€è¦æŠŠaccess_keyå’Œsecret_keyä¿å­˜ä¸‹æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹\nradosgw-admin user info --uid=admin\n\n\"keys\": [\n        {\n            \"user\": \"admin\",\n            \"access_key\": \"LAI14X0RJVJG3QGR16FP\",\n            \"secret_key\": \"t11PVzqYtEvb22ajctD0U5tCN5d0CaDPkZENiqTb\"\n        }\n    ],\n```\n\nä½¿ç”¨[s3 browserç‚¹å‡»è¿™é‡Œè®¿é—®å®˜ç½‘ä¸‹è½½è½¯ä»¶](https://s3browser.com/)ï¼Œå°†ä»¥ä¸Šaccess_key,secret_keyå¡«ä¸Šï¼Œå¯ä»¥æ­£å¸¸è¿æ¥ï¼Œä½†æ˜¯æ²¡æœ‰æ¡¶ï¼Œæ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæ¡¶ï¼Œå¹¶ä¸Šä¼ æ–‡ä»¶ï¼Œæ­£å¸¸ã€‚\n\n![image-20231221001128450](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/76a3ec58bebf509d1f3d142a7199d1cb697559838.png)\n\næ­¤æ—¶ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œåˆ›å»ºä¸€ä¸ªæ¡¶\n\n![image-20231221001200312](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/3fd0f612edc0de586159ff4b9515acfe697559838.png)\n\n![image-20231221001228678](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/8d6133baba34facea5a5023c32e0b8e5697559838.png)\n\nåœ¨æ¡Œé¢åˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶ç§»è¿›å»\n\n![image-20231221001351913](../img/Cephé›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤/99676066de089ffb0795d766a676149f697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Centos 9 stream","Ceph"],"categories":["äº‘åŸç”Ÿ"]},{"title":"K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå†…éƒ¨etcdï¼‰","url":"/posts/7158/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå†…éƒ¨etcdï¼‰\n\nä»¥ä¸‹ä¼šç”¨åˆ°çš„èµ„æº[K8s1.28.2ï¼ˆå†…å¤–éƒ¨etcdé«˜å¯ç”¨ï¼‰æ‰€éœ€èµ„æº](https://www.123pan.com/s/MYnLVv-gLp4.html)\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå  | ip1ï¼ˆNATï¼‰     | ç³»ç»Ÿ      | ç£ç›˜ | å†…å­˜ |\n| ------- | -------------- | --------- | ---- | ---- |\n| master1 | 192.168.48.101 | Centos7.9 | 100G | 4G   |\n| master2 | 192.168.48.102 | Centos7.9 | 100G | 4G   |\n| master3 | 192.168.48.103 | Centos7.9 | 100G | 4G   |\n| node01  | 192.168.48.104 | Centos7.9 | 100G | 8G   |\n\n## åŸºç¡€é…ç½®\n\ncentosé€šè¿‡å•ç‹¬å®‰è£…ï¼Œéå…‹éš†ã€‚å®‰è£…å®Œåè¿›è¡ŒåŸºæœ¬ç¯å¢ƒçš„é…ç½®ï¼Œé…ç½®ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n1. è®¾ç½®ä¸»æœºå\n2. å…³é—­NetworkManagerã€firewalldã€dnsmasqã€selinux\n3. è®¾ç½®ens33\n4. ä¼˜åŒ–ssh\n6. å¤‡ä»½å¹¶æ–°å¢æ¸…åyumæºã€epelæºã€docker-ceæºã€k8sæº\n7. æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\n8. ä¿®æ”¹historyæ ¼å¼åŠè®°å½•æ•°\n9. æ·»åŠ hostsè§£æ\n10. å…³é—­swapåˆ†åŒº\n11. å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\n12. é…ç½®limits.conf\n13. å®‰è£…å¿…å¤‡å·¥å…·\n14. å‡çº§ç³»ç»Ÿå¹¶é‡å¯\n\næ“ä½œä¸»æœºï¼š[master1,master2,master3,node01]\n\n```\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\n\necho \"2.æ­£åœ¨å…³é—­NetworkManagerã€firewalldã€dnsmasqã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl disable NetworkManager &> /dev/null\nsystemctl disable dnsmasq &> /dev/null\nsystemctl stop firewalld\nsystemctl stop NetworkManager\nsystemctl stop dnsmasq\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=ensernet\nBOOTPROTO=static\nDEFROUTE=yes\nNAME=ens33\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nNETMASK=255.255.255.0\nGATEWAY=192.168.48.2\nDNS1=114.114.114.114\nEOF\nsystemctl restart network\n\n\necho \"4.ä¼˜åŒ–ssh\"\nsed -i \"s#\\#UseDNS yes#UseDNS no#g\" /etc/ssh/sshd_config\nsed -i \"s#GSSAPIAuthentication yes#GSSAPIAuthentication no#g\" /etc/ssh/sshd_config\nsystemctl restart sshd\n\necho \"5.å¤‡ä»½å¹¶æ–°å¢æ¸…åyumæºã€epelæºã€docker-ceæºã€k8sæº\"\nrm -rf /etc/yum.repos.d/*\ncat > /etc/yum.repos.d/Centos-Base.repo <<EOF\n[base]\nname=CentOS-$releasever - Base\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/\\$releasever/os/\\$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n[updates]\nname=CentOS-$releasever - Updates\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/\\$releasever/updates/\\$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n[extras]\nname=CentOS-$releasever - Extras\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/\\$releasever/extras/\\$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n[centosplus]\nname=CentOS-$releasever - Plus\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/\\$releasever/centosplus/\\$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\nEOF\n\ncat > /etc/yum.repos.d/epel.repo <<EOF\n[epel]\nname=Extra Packages for Enterprise Linux 7 - \\$basearch\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/\\$basearch\nfailovermensod=priority\nenabled=1\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7\n\n[epel-debuginfo]\nname=Extra Packages for Enterprise Linux 7 - \\$basearch - Debug\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/\\$basearch/debug\nfailovermensod=priority\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7\ngpgcheck=1\n\n[epel-source]\nname=Extra Packages for Enterprise Linux 7 - \\$basearch - Source\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/SRPMS\nfailovermensod=priority\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7\ngpgcheck=1\nEOF\n\ncat > /etc/yum.repos.d/kubernetes.repo <<EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\ncurl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\necho \"6.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\n yum clean all && yum makecache\n\n\necho \"7.ä¿®æ”¹historyæ ¼å¼åŠè®°å½•æ•°\"\nsed -i \"s#HISTSIZE=1000##g\" /etc/profile\ncat >> /etc/profile <<EOF\nshopt -s histappend\nUSER_IP=`who -u am i 2>/dev/null| awk '{print $NF}'|sed -e 's/[()]//g'`\nexport HISTFILE=~/.commandline_warrior\nexport HISTTIMEFORMAT=\"%Y-%m-%d %H:%M:%S  `whoami`@${USER_IP}: \"\nexport HISTSIZE=200000\nexport HISTFILESIZE=1000000\nexport PROMPT_COMMAND=\"history -a\"\nEOF\nsource /etc/profile\n\n\necho \"8.æ·»åŠ hostsè§£æ\"\ncat >> /etc/hosts <<EOF\n192.168.48.101 master1\n192.168.48.102 master2\n192.168.48.103 master3\n192.168.48.104 node01\nEOF\n\n\necho \"9.å…³é—­swapåˆ†åŒº\"\nswapoff -a && sysctl -w vm.swappiness=0 &> /dev/null\nsed -ri '/^[^#]*swap/s@^@#@' /etc/fstab\n\n\necho \"10.å®‰è£…ntpdateæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\"\nyum install chrony -y\nsystemctl start chronyd\nsystemctl enable chronyd\nchronyc sources\nchronyc sources\n\necho \"11.é…ç½®limits.conf\"\nulimit -SHn 65535\ncat >> /etc/security/limits.conf <<EOF\n* soft nofile 65536\n* hard nofile 131072\n* soft nproc 65535\n* hard nproc 655350\n* soft memlock unlimited\n* hard memlock unlimited\nEOF\n\n\necho \"12.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet yum-utils device-mapper-persistent-data lvm2 git -y\n\n\necho \"13.å‡çº§ç³»ç»Ÿå¹¶é‡å¯\"\nyum update -y --exclude=kernel* && reboot\n\n```\n\n```\nsh k8s_system_init.sh ä¸»æœºå ä¸»æœºä½\n[master1] sh k8s_system_init.sh master1 101\n\n[master2] sh k8s_system_init.sh master2 102\n\n[master3] sh k8s_system_init.sh master3 103\n\n[node01] sh k8s_system_init.sh node01 104\n\n```\n\n### é…ç½®sshå…å¯†\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"master1\" \"master2\" \"master3\" \"node01\")\n# å¯†ç \npassword=\"123456\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## å†…æ ¸åŠipvsæ¨¡å—é…ç½®\n\næ­¤æ­¥éª¤æ˜¯å‡çº§å†…æ ¸ã€é…ç½®ipvsæ¨¡å—ï¼Œå¼€å¯ä¸€äº›k8sé›†ç¾¤ä¸­å¿…é¡»çš„å†…æ ¸å‚æ•°ã€‚é…ç½®ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n1. ä¸‹è½½å®‰è£…åŒ…åˆ°/server/soft\n2. å®‰è£…kernel\n3. æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº\n4. å®‰è£…ipvsadm\n5. é…ç½®ipvsæ¨¡å—\n6. å¼€å¯k8sé›†ç¾¤å¿…é¡»çš„å†…æ ¸å‚æ•°\n7. é…ç½®å®Œå†…æ ¸ï¼Œé‡å¯æœåŠ¡å™¨\n\næ“ä½œä¸»æœºï¼š[master1,master2,master3,node01]\n\n```\nvi kernel_update.sh\n\n#!/bin/bash\necho \"1.ä¸‹è½½å®‰è£…åŒ…åˆ°/server/soft\"\nmkdir -p /server/soft ; cd /server/soft\nwget https://mirrors.aliyun.com/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-6.6.3-1.el7.elrepo.x86_64.rpm\nwget https://mirrors.aliyun.com/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-6.6.3-1.el7.elrepo.x86_64.rpm\n\n\necho \"2.æ­£åœ¨å®‰è£…kernel\"\nyum localinstall -y kernel-ml*\n\n\necho \"3.æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº\"\ngrub2-set-default  0 && grub2-mkconfig -o /etc/grub2.cfg\ngrubby --args=\"user_namespace.enable=1\" --update-kernel=\"$(grubby --default-kernel)\"\n\n\necho \"4.è¾“å‡ºç°åœ¨å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯\"\ngrubby --default-kernel\n\n\necho \"5.å®‰è£…ipvsadm\"\nyum install ipvsadm ipset sysstat conntrack libseccomp -y &> /dev/null\n\n\necho \"6.é…ç½®ipvsæ¨¡å—\"\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack\n\ncat >> /etc/modules-load.d/ipvs.conf <<EOF\nip_vs\nip_vs_lc\nip_vs_wlc\nip_vs_rr\nip_vs_wrr\nip_vs_lblc\nip_vs_lblcr\nip_vs_dh\nip_vs_sh\nip_vs_fo\nip_vs_nq\nip_vs_sed\nip_vs_ftp\nip_vs_sh\nnf_conntrack\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\nEOF\nsystemctl enable --now systemd-modules-load.service &> /dev/null\n\n\necho \"7.å¼€å¯k8sé›†ç¾¤å¿…é¡»çš„å†…æ ¸å‚æ•°\"\ncat <<EOF > /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nfs.may_detach_mounts = 1\nnet.ipv4.conf.all.route_localnet = 1\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.netfilter.nf_conntrack_max=2310720\n\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl =15\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_orphans = 327680\nnet.ipv4.tcp_orphan_retries = 3\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.ip_conntrack_max = 65536\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_timestamps = 0\nnet.core.somaxconn = 16384\nEOF\nsysctl --system\n\n\necho \"8.é…ç½®å®Œå†…æ ¸ï¼Œé‡å¯æœåŠ¡å™¨ï¼\"\nreboot\n\n```\n\n```\nsh kernel_update.sh\n```\n\n## æ£€æŸ¥ipvsåŠ è½½ã€å†…æ ¸ç‰ˆæœ¬éªŒè¯\n\n```\nlsmod | grep --color=auto -e ip_vs -e nf_conntrack\nuname -a\n```\n\n![image-20231201233238841](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/7b6a9d8f90a78eced6f8ae1d42bbdec5697559838-1758977411837-3.png)\n\n##  é«˜å¯ç”¨ç»„ä»¶å®‰è£…\n\n### haproxyé…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\n```\nyum install keepalived haproxy -y\n```\n\næ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®HAProxyï¼Œæ‰€æœ‰MasterèŠ‚ç‚¹çš„HAProxyé…ç½®ç›¸åŒã€‚\n\n```yaml\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2]\ncat > /etc/haproxy/haproxy.cfg <<\"EOF\"\n\nglobal\n  maxconn  2000\n  ulimit-n  16384\n  log  127.0.0.1 local0 err\n  stats timeout 30s\n\ndefaults\n  log global\n  mode  http\n  option  httplog\n  timeout connect 5000\n  timeout client  50000\n  timeout server  50000\n  timeout http-request 15s\n  timeout http-keep-alive 15s\n\nfrontend monitor-in\n  bind *:33305\n  mode http\n  option httplog\n  monitor-uri /monitor\n\nfrontend k8s-master\n  bind 0.0.0.0:16443\n  bind 127.0.0.1:16443\n  mode tcp\n  option tcplog\n  tcp-request inspect-delay 5s\n  default_backend k8s-master\n\nbackend k8s-master\n  mode tcp\n  option tcplog\n  option tcp-check\n  balance roundrobin\n  default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100\n  server master1   192.168.48.101:6443  check\n  server master2   192.168.48.102:6443  check\n  server master3   192.168.48.103:6443  check\nEOF\n```\n\n### Keepalivedé…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\næ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®Keepalivedï¼Œä»¥ä¸‹ä¸‰ä¸ªMasterèŠ‚ç‚¹é…ç½®æ³¨æ„ipå’Œç½‘å¡ã€‚\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master1]\n\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state MASTER\n    interface ens33\n    mcast_src_ip 192.168.48.101\n    virtual_router_id 51\n    priority 101\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master2]\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state BACKUP\n    interface ens33\n    mcast_src_ip 192.168.48.102\n    virtual_router_id 51\n    priority 100\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master3]\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state BACKUP\n    interface ens33\n    mcast_src_ip 192.168.48.103\n    virtual_router_id 51\n    priority 99\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n\n\n### é…ç½®Keepalivedå¥åº·æ£€æŸ¥æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\n```\ncat > /etc/keepalived/check_apiserver.sh <<\"EOF\"\n #!/bin/bash\n err=0\n for k in $(seq 1 3)\n do\n    check_code=$(pgrep haproxy)\n    if [[ $check_code == \"\" ]]; then\n        err=$(expr $err + 1)\n        sleep 1\n        continue\n    else\n        err=0\n        break\n    fi\n done\n \n if [[ $err != \"0\" ]]; then\n    echo \"systemctl stop keepalived\"\n    /usr/bin/systemctl stop keepalived\n    exit 1\n else\n    exit 0\n fi\nEOF\n\nchmod +x /etc/keepalived/check_apiserver.sh\n```\n\n### å¯åŠ¨haproxyå’Œkeepalived\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[masterï¼Œmaster2,master3]\nsystemctl daemon-reload\nsystemctl enable --now haproxy\nsystemctl enable --now keepalived\n```\n\n### æµ‹è¯•é›†ç¾¤è´Ÿè½½å‡è¡¡é«˜å¯ç”¨\n\næŸ¥çœ‹master1çš„vip\n\n```\nip a\n```\n\n![image-20231109232708584](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/0176020d9bcd8b4c85ea2e4f8d6b4afa697559838-1758977411837-2.png)\n\næ¨¡æ‹Ÿmaster1çš„å®•æœºæµ‹è¯•ï¼Œçœ‹çœ‹vipä¼šä¸ä¼šæ¼‚ç§»åˆ°master2å»\n\n```\n[master1] poweroff\n```\n\n![image-20231109232803276](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/126a03a1112b6ab1ae01e0603ac0023b697559838-1758977411837-4.png)\n\nè¿™æ—¶å€™æŸ¥çœ‹master2çš„ipåˆ—è¡¨\n\n```\n[master2] ip a\n```\n\n![image-20231109232825999](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/2a02b2b0a2310908a960dff95daf55d8697559838-1758977411837-5.png)\n\nç»“è®ºï¼šè¿™æ—¶å¯ä»¥çŸ¥é“ï¼Œè´Ÿè½½å‡è¡¡é›†ç¾¤æˆåŠŸï¼Œå½“master1å‡ºç°å®•æœºæƒ…å†µï¼Œvipä¼šä»master1æ¼‚ç§»åˆ°master2\n\n## dockerå®‰è£…\n\n### å®‰è£…docker\n\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\n```bash\nwget https://download.docker.com/linux/static/stable/x86_64/docker-24.0.7.tgz\ntar xf docker-*.tgz\ncp -rf docker/* /usr/bin/\n#åˆ›å»ºcontainerdçš„serviceæ–‡ä»¶,å¹¶ä¸”å¯åŠ¨\ncat >/etc/systemd/system/containerd.service <<EOF\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=1048576\nTasksMax=infinity\nOOMScoreAdjust=-999\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl enable --now containerd.service\n\n#å‡†å¤‡dockerçš„serviceæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.service <<EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service containerd.service\nWants=network-online.target\nRequires=docker.socket containerd.service\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd --config-file=/etc/docker/daemon.json -H fd://\ncontainerd=/run/containerd/containerd.sock\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\nOOMScoreAdjust=-500\n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å‡†å¤‡dockerçš„socketæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.socket <<EOF\n[Unit]\nDescription=Docker Socket for the API\n[Socket]\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n[Install]\nWantedBy=sockets.target\nEOF\ngroupadd docker\n\nsystemctl enable --now docker.socket  && systemctl enable --now docker.service\n\n\n#éªŒè¯\nmkdir /etc/docker\nsudo tee /etc/docker/daemon.json > /dev/null <<'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.xuanyuan.me\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://docker.1panel.live\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n\t\t\"https://docker.qianyios.top\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  },\n  \"data-root\": \"/var/lib/docker\"\n}\nEOF\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n### å®‰è£…cri-docker\n\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\n```\nwget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.7/cri-dockerd-0.3.7.amd64.tgz\n\ntar -zxvf cri-dockerd-0.3.7.amd64.tgz\ncp cri-dockerd/cri-dockerd  /usr/bin/\nchmod +x /usr/bin/cri-dockerd\n\n\n#å†™å…¥å¯åŠ¨é…ç½®æ–‡ä»¶\ncat >  /usr/lib/systemd/system/cri-docker.service <<EOF\n[Unit]\nDescription=CRI Interface for Docker Application Container Engine\nDocumentation=https://docs.mirantis.com\nAfter=network-online.target firewalld.service docker.service\nWants=network-online.target\nRequires=cri-docker.socket\n \n[Service]\nType=notify\nExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.9\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\n \nStartLimitBurst=3\n \nStartLimitInterval=60s\n \nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\n \nTasksMax=infinity\nDelegate=yes\nKillMode=process\n \n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å†™å…¥socketé…ç½®æ–‡ä»¶\ncat > /usr/lib/systemd/system/cri-docker.socket <<EOF\n[Unit]\nDescription=CRI Docker Socket for the API\nPartOf=cri-docker.service\n \n[Socket]\nListenStream=%t/cri-dockerd.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n \n[Install]\nWantedBy=sockets.target\nEOF\n\nsystemctl daemon-reload && systemctl enable cri-docker --now\n```\n\n## K8Sé›†ç¾¤å®‰è£…\n\n### å®‰è£…k8sæ‰€éœ€çš„å·¥å…·\n\n```\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\nyum -y install  kubeadm kubelet kubectl\n\n#ä¸ºäº†å®ç°dockerä½¿ç”¨çš„cgroupdriverä¸kubeletä½¿ç”¨çš„cgroupçš„ä¸€è‡´æ€§ï¼Œé…ç½®å¦‚ä¸‹ï¼š\nsed -i 's/^KUBELET_EXTRA_ARGS=/KUBELET_EXTRA_ARGS=\"--cgroup-driver=systemd\"/g' /etc/sysconfig/kubelet\n\n#è®¾ç½®kubeletä¸ºå¼€æœºè‡ªå¯åŠ¨å³å¯ï¼Œç”±äºæ²¡æœ‰ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé›†ç¾¤åˆå§‹åŒ–åè‡ªåŠ¨å¯åŠ¨\nsystemctl enable kubelet\nsystemctl enable kubelet.service\n```\n\n### é›†ç¾¤åˆå§‹åŒ–\n\n```yaml\næ“ä½œèŠ‚ç‚¹[master1]\n\ncat > kubeadm-config.yaml << EOF\napiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 192.168.48.101\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/cri-dockerd.sock\n  imagePullPolicy: IfNotPresent\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns: {}\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: registry.aliyuncs.com/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.28.2\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 10.244.0.0/16\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\ncontrolPlaneEndpoint: \"192.168.48.200:16443\"\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nbindAddress: 0.0.0.0\nbindAddressHardFail: false\nclientConnection:\n  acceptContentTypes: \"\"\n  burst: 0\n  contentType: \"\"\n  kubeconfig: /var/lib/kube-proxy/kubeconfig.conf\n  qps: 0\nclusterCIDR: \"\"\nconfigSyncPeriod: 0s\nconntrack:\n  maxPerCore: null\n  min: null\n  tcpCloseWaitTimeout: null\n  tcpEstablishedTimeout: null\ndetectLocal:\n  bridgeInterface: \"\"\n  interfaceNamePrefix: \"\"\ndetectLocalMode: \"\"\nenableProfiling: false\nhealthzBindAddress: \"\"\nhostnameOverride: \"\"\niptables:\n  localhostNodePorts: null\n  masqueradeAll: false\n  masqueradeBit: null\n  minSyncPeriod: 0s\n  syncPeriod: 0s\nipvs:\n  excludeCIDRs: null\n  minSyncPeriod: 0s\n  scheduler: \"\"\n  strictARP: false\n  syncPeriod: 0s\n  tcpFinTimeout: 0s\n  tcpTimeout: 0s\n  udpTimeout: 0s\nkind: KubeProxyConfiguration\nlogging:\n  flushFrequency: 0\n  options:\n    json:\n      infoBufferSize: \"0\"\n  verbosity: 0\nmetricsBindAddress: \"\"\nmode: \"\"\nnodePortAddresses: null\noomScoreAdj: null\nportRange: \"\"\nshowHiddenMetricsForVersion: \"\"\nwinkernel:\n  enableDSR: false\n  forwardHealthCheckVip: false\n  networkName: \"\"\n  rootHnsEndpointName: \"\"\n  sourceVip: \"\"\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\ncgroupDriver: systemd\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncontainerRuntimeEndpoint: \"\"\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging:\n  flushFrequency: 0\n  options:\n    json:\n      infoBufferSize: \"0\"\n  verbosity: 0\nmemorySwap: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\n\nEOF\n\nkubeadm config migrate --old-config kubeadm-config.yaml --new-config new.yaml\n\n```\n\n### å‡†å¤‡k8sæ‰€éœ€çš„é•œåƒ\n\n```\næ“ä½œèŠ‚ç‚¹[master1,master2,master3]\n\nkubeadm config images pull --config /root/new.yaml \n```\n\n![image-20231110100341121](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/39a6655a68e7fb689d3d256f91e8074c697559838-1758977411837-7.png)\n\n### master1èŠ‚ç‚¹åˆå§‹åŒ–\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nkubeadm init --config /root/new.yaml  --upload-certs\n```\n\nä¼šç”Ÿæˆä¿¡æ¯\n\n![image-20231110175843902](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/71204e272d141fb2f7ef41d1d6a37658697559838-1758977411837-6.png)\n\nè®°å½•ä¿¡æ¯åé¢ä¼šç”¨åˆ°\n\nåˆå§‹åŒ–æˆåŠŸä»¥åï¼Œä¼šäº§ç”ŸTokenå€¼ï¼Œç”¨äºå…¶ä»–èŠ‚ç‚¹åŠ å…¥æ—¶ä½¿ç”¨ï¼Œå› æ­¤è¦è®°å½•ä¸‹åˆå§‹åŒ–æˆåŠŸç”Ÿæˆçš„tokenå€¼ï¼ˆä»¤ç‰Œå€¼ï¼‰ï¼Œ**æœ‰æ•ˆæœŸ24å°æ—¶ï¼Œåç»­éœ€è¦æ“ä½œå¯ä»¥é‡æ–°ç”ŸæˆToken**\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f \\\n        --control-plane --certificate-key 45eeadfc9135a368d08582a90c779c0934d24c54f56134c65d67516f5e6f981d\n\n\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n\n```\n\n`æ“ä½œkubectæŠ¥é”™ï¼š`\n\n![image-20231110180035297](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/0ea7d75c613d48f13e34f481c6cf08b0697559838-1758977411837-8.png)\n\næ­¤æ—¶é€šè¿‡kubectlæ“ä½œï¼Œä¼šå‡ºç°å¤±è´¥ï¼Œå› ä¸ºè¿˜æ²¡æœ‰å°†é›†ç¾¤çš„\"é’¥åŒ™\"äº¤ç»™rootç”¨æˆ·ã€‚`/etc/kubernetes/admin.conf` æ–‡ä»¶æ˜¯ Kubernetesï¼ˆK8sï¼‰é›†ç¾¤ä¸­çš„ç®¡ç†å‘˜é…ç½®æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ç”¨äºç®¡ç†é›†ç¾¤çš„èº«ä»½éªŒè¯å’Œè®¿é—®ä¿¡æ¯ã€‚æ‰€ä»¥ä¸‹é¢è¿›è¡Œé…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®Kubernetesé›†ç¾¤ï¼š\n\n`æ·»åŠ ç¯å¢ƒå˜é‡`\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n### æ·»åŠ å…¶ä»–masterèŠ‚ç‚¹è‡³é›†ç¾¤ä¸­\n\næ“ä½œèŠ‚ç‚¹[master2,master3]\n\n```\næ“ä½œèŠ‚ç‚¹[master2,master3]\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f \\\n        --control-plane --certificate-key 45eeadfc9135a368d08582a90c779c0934d24c54f56134c65d67516f5e6f981d \\\n        --cri-socket unix:///var/run/cri-dockerd.sock \n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\næ¥ç€ç»™`master2`æ·»åŠ ç¯å¢ƒå˜é‡\n\n```\næ“ä½œèŠ‚ç‚¹[master2,master3]\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n![image-20231110180919008](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/3f20e99d3edff4874993811b81d45783697559838-1758977411837-9.png)\n\nè¿™é‡Œæ²¡æœ‰å±•ç¤ºmaster3çš„å›¾ç‰‡ï¼Œä½†æ˜¯æ­¥éª¤ä¸€æ ·çš„\n\n### æ¨¡æ‹ŸTokenè¿‡æœŸé‡æ–°ç”Ÿæˆå¹¶åŠ å…¥NodeèŠ‚ç‚¹\n\nå‡è®¾åŠ å…¥é›†ç¾¤çš„tokenè¿‡æœŸäº†ã€‚node01æ— æ³•åŠ å…¥äº†ï¼Œè¿™é‡Œå°±æ¨¡æ‹Ÿä¸€ä¸‹è¿™ç§æƒ…å†µ\n\n1. Tokenè¿‡æœŸåç”Ÿæˆæ–°çš„tokenï¼š\n\n```bash\nkubeadm token create --print-join-command\n```\n\n```\n[root@master1 ~]# kubeadm token create --print-join-command\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n\n```\n\nå…¶ä¸­ï¼Œ`192.168.48.200:16443` æ˜¯ä½ çš„ Kubernetes API æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ï¼Œ`tn5q1b.7w1jj77ewup7k2in` æ˜¯æ–°çš„ä»¤ç‰Œï¼Œ`sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f` æ˜¯ä»¤ç‰Œçš„ CA è¯ä¹¦å“ˆå¸Œå€¼ã€‚\n\n2. Masteréœ€è¦ç”Ÿæˆ--certificate-keyï¼š\n\n```bash\nkubeadm init phase upload-certs --upload-certs\n```\n\n```\n[root@master1 ~]# kubeadm init phase upload-certs --upload-certs\nW1110 18:12:03.426245   10185 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW1110 18:12:03.426320   10185 version.go:105] falling back to the local client version: v1.28.2\n[upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n[upload-certs] Using certificate key:\n5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nå…¶ä¸­ï¼Œ`5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128` æ˜¯è¯ä¹¦å¯†é’¥ã€‚\n\n3. ç”Ÿæˆæ–°çš„Tokenç”¨äºé›†ç¾¤æ·»åŠ æ–°NodeèŠ‚ç‚¹\n\næ“ä½œèŠ‚ç‚¹[node01]\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f  \\\n        --cri-socket unix:///var/run/cri-dockerd.sock \n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\n![image-20231110181623386](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/3e809e4e0ccbd1d84b7563de484600dc697559838-1758977411837-10.png)\n\nè¿™æ—¶åœ¨masteræŸ¥çœ‹nodeçŠ¶æ€ï¼ˆæ˜¾ç¤ºä¸ºnotreadyä¸å½±å“ï¼‰\n\n![image-20231111145807000](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/35ee9666e8251b54f20eec2a53ff9058697559838-1758977411837-11.png)\n\n### æ¨¡æ‹Ÿæ–°åŠ masterèŠ‚ç‚¹çš„åŠ å…¥K8Sé›†ç¾¤ä¸­\n\nå‡è®¾æˆ‘ä»¬æ–°åŠ masterèŠ‚ç‚¹çš„è¯ï¼Œå°±æ‹¼æ¥tokenï¼Œ`ä»åˆšåˆšç”Ÿæˆçš„tokenæ‹¼æ¥`\n\n```\n[root@master1 ~]# kubeadm token create --print-join-command\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n```\n\nè¿™é‡Œæå–ä¿¡æ¯1\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n```\n\næ¥ç€\n\n```\n[root@master1 ~]# kubeadm init phase upload-certs --upload-certs\nW1110 18:12:03.426245   10185 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW1110 18:12:03.426320   10185 version.go:105] falling back to the local client version: v1.28.2\n[upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n[upload-certs] Using certificate key:\n5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nè¿™é‡Œæå–ä¿¡æ¯2ï¼šè¿™é‡Œå‰é¢è¦åŠ ä¸Š`--control-plane --certificate-key`\n\n```\n--control-plane --certificate-key 5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nåˆæˆ\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f  \\\n        --control-plane --certificate-key 5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128 \\\n        --cri-socket unix:///var/run/cri-dockerd.sock\n        \n        \nkubeadm join 192.168.48.200:16443 --token lnkno8.u4v1l8n9pahzf0kj \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f \\\n        --control-plane --certificate-key 41e441fe56cb4bdfcc2fc0291958e6b1da54d01f4649b6651471c07583f85cdf \\\n        --cri-socket unix:///var/run/cri-dockerd.sock\n\n\n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\nå›¾ç¤º\n\n![image-20231110182741430](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/7dcec71d06d286a5b7b1fcebbef15a7b697559838-1758977411837-12.png)\n\n## å®‰è£…calicoç½‘ç»œæ’ä»¶\n\næ“ä½œèŠ‚ç‚¹[master1]\n\næ·»åŠ è§£æè®°å½•ï¼Œå¦åˆ™æ— æ³•è®¿é—®\n\n```\necho '185.199.108.133 raw.githubusercontent.com' >> /etc/hosts\n```\n\n### åº”ç”¨operatorèµ„æºæ¸…å•æ–‡ä»¶\n\nç½‘ç»œç»„ä»¶æœ‰å¾ˆå¤šç§ï¼Œåªéœ€è¦éƒ¨ç½²å…¶ä¸­ä¸€ä¸ªå³å¯ï¼Œæ¨èCalicoã€‚ \nCalicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼ŒCalicoæ”¯æŒå¹¿æ³›çš„å¹³å°ï¼ŒåŒ…æ‹¬Kubernetesã€OpenStackç­‰ã€‚ \nCalico åœ¨æ¯ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹åˆ©ç”¨ Linux Kernel å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„è™šæ‹Ÿè·¯ç”±å™¨ï¼ˆ vRouterï¼‰ æ¥è´Ÿè´£æ•°æ®è½¬å‘ï¼Œè€Œæ¯ä¸ª vRouter é€šè¿‡ BGP åè®®è´Ÿè´£æŠŠè‡ªå·±ä¸Šè¿è¡Œçš„ workload çš„è·¯ç”±ä¿¡æ¯å‘æ•´ä¸ª Calico ç½‘ç»œå†…ä¼ æ’­ã€‚ \næ­¤å¤–ï¼ŒCalico é¡¹ç›®è¿˜å®ç°äº† Kubernetes ç½‘ç»œç­–ç•¥ï¼Œæä¾›ACLåŠŸèƒ½ã€‚\n\n```\ncurl https://raw.githubusercontent.com/projectcalico/calico/v3.25.1/manifests/calico.yaml -O\n```\n\n```yaml\n[root@master1 ~]# vim calico.yaml\n#æ·»åŠ ä¸¤è¡Œ\n- name: IP_AUTODETECTION_METHOD\n  value: interface=ens33\n\n#ens33æ˜¯ä½ çš„ç½‘å¡\n```\n\n![image-20231110183944854](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/12da23b4f8d928a8ac610de1419f8f01697559838-1758977411837-14.png)\n\n```\nsed -i 's| docker.io/calico/| registry.cn-hangzhou.aliyuncs.com/qianyios/|' calico.yaml\nkubectl apply -f calico.yaml\n```\n\n![image-20231110184031455](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/515614f130cb327d7e301ddff0ea1b75697559838-1758977411837-13.png)\n\n### ç›‘è§†kube-systemå‘½åç©ºé—´ä¸­podè¿è¡Œæƒ…å†µ\n\nç­‰å¾…ä¼°è®¡20åˆ†é’Ÿå·¦å³å§(ç¡®ä¿å…¨éƒ¨running)\n\n```\nkubectl get pods -n kube-system\n```\n\n![image-20231110193921266](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/65e576c8a0ad30192f63c585bda21254697559838-1758977411837-15.png)\n\n### æ‹¿æ‰masterèŠ‚ç‚¹çš„æ±¡ç‚¹\n\nèŠ‚ç‚¹ master1 å’Œ master2 éƒ½æœ‰ä¸€ä¸ªåä¸º `node-role.kubernetes.io/control-plane:NoSchedule` çš„æ±¡ç‚¹ã€‚è¿™ä¸ªæ±¡ç‚¹çš„ä½œç”¨æ˜¯é˜»æ­¢æ™®é€šçš„ Pod è¢«è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šï¼Œåªå…è®¸ç‰¹å®šçš„æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆå¦‚ kube-apiserverã€kube-controller-manager å’Œ kube-schedulerï¼‰åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n\nè¿™ç§è®¾ç½®æœ‰åŠ©äºç¡®ä¿æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸“é—¨ç”¨äºè¿è¡Œ Kubernetes çš„æ ¸å¿ƒç»„ä»¶ï¼Œè€Œä¸ä¼šè¢«æ™®é€šçš„å·¥ä½œè´Ÿè½½å ç”¨ã€‚é€šè¿‡å°†æ±¡ç‚¹æ·»åŠ åˆ°èŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥ç¡®ä¿åªæœ‰è¢«æˆæƒçš„æ§åˆ¶å¹³é¢ç»„ä»¶æ‰èƒ½åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n\n```\nkubectl describe node master1 | grep -i taint\nkubectl describe node master2 | grep -i taint\nkubectl describe node master3 | grep -i taint\n```\n\n![image-20231111152324023](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/7e79bf5ee514955fa2bc88a482aeace0697559838-1758977411838-16.png)\n\nå»é™¤æ±¡ç‚¹\n\n```\nkubectl taint node master1 node-role.kubernetes.io/control-plane:NoSchedule-\nkubectl taint node master2 node-role.kubernetes.io/control-plane:NoSchedule-\nkubectl taint node master3 node-role.kubernetes.io/control-plane:NoSchedule-\n```\n\n![image-20231111152342956](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/787ed2d5c1bfbafd6bf56ca9127c4d59697559838-1758977411838-17.png)\n\n## å®‰è£…dashboard\n\næ“ä½œèŠ‚ç‚¹[master1]\n\nä¸‹è½½æ–‡ä»¶\n\nhttps://github.com/kubernetes/dashboard/releases/tag/v2.7.0\n\nç›®å‰æœ€æ–°ç‰ˆæœ¬v2.7.0 \n\n```\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml\nsed -i 's/kubernetesui\\/dashboard:v2.7.0/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/dashboard:v2.7.0/g' recommended.yaml\nsed -i 's/kubernetesui\\/metrics-scraper:v1.0.8/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/metrics-scraper:v1.0.8/g' recommended.yaml\n```\n\n![image-20231014174400992](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/765d82d207c2fefcc00048060c4d1146697559838-1758977411838-19.png)\n\nä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```yaml\nvim recommended.yaml\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30001\n  type: NodePort\n  selector:\n    app: kubernetes-dashboard\n\n---\n```\n\n![image-20231014174511047](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/33ac61c500136a4ce86567aafd1c1382697559838-1758977411838-18.png)\n\nè¿è¡Œdashboard\n\n```\nkubectl apply -f recommended.yaml\n```\n\n![image-20231014174622344](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/2332124844a312fa6b5261eb90fb2c26697559838-1758977411838-20.png)\n\næ£€æŸ¥è¿è¡ŒçŠ¶æ€\n\n```\nkubectl get pods -n kubernetes-dashboard\nkubectl get pod,svc -o wide -n kubernetes-dashboard\n```\n\n![image-20231111025752605](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/39d745dff08f596e4d810445df33dbdc697559838-1758977411838-21.png)\n\n### åˆ›å»ºcluster-adminç”¨æˆ·\n\n```\nåˆ›å»ºservice accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜ç¾¤è§’è‰²\n#åˆ›å»ºç”¨æˆ·\nkubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n#ç”¨æˆ·æˆæƒ\nkubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n#è·å–ç”¨æˆ·Token\nkubectl create token dashboard-admin -n kubernetes-dashboard\n```\n\n![image-20231111025817854](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/5e1825e420253c9b7aaba3307e80d3ef697559838-1758977411838-22.png)\n\nè®°å½•token\n\n```\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJxb21sRTZSckhEZ09FMnlvWU5IY3dfTTRIWDEzRUpsQ000MThhSWxYNDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjk5NjQ2Mjg3LCJpYXQiOjE2OTk2NDI2ODcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIyNTBhNTQ2MS03MGJlLTRhZTItOWY2Yi1hMDQwOWE1NWJhMTMifX0sIm5iZiI6MTY5OTY0MjY4Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.U-lH9_sRU4TVrpAznqS60INNSev9NxHu61igGUTzTBoaWo7WjPG7vzTnpZYhvsoglTzMEKhfranJkkkn95pe-prkvSasaAL6kXHw0jQjlSMzcYiF7DoLdkOtDJSukuALEubidf9eIwZXFZ-sezZdZHm4hnk5nWme5YtdOmYOJPh5sv1dzRvM1XuOHknJPTA1BbdZuVAtSGHSjkhwx-wl-41uuQoROW5GjJs0bz4zLBFn1w_pWaSMCn7pjGJNcbr6IuDV41km_etpwwxacWyfAcxNykzCtIiE1abJj7m-e944GvAn_eqxz3wCZD6Bgt41FWRzyMHjrppJfDjk7FaHNw\n\n```\n\n### ç™»å½•æµè§ˆå™¨è®¿é—®\n\n```\nhttps://192.168.48.200:30001\n\nè¾“å…¥tokenï¼š\n----\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJxb21sRTZSckhEZ09FMnlvWU5IY3dfTTRIWDEzRUpsQ000MThhSWxYNDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjk5NjQ2Mjg3LCJpYXQiOjE2OTk2NDI2ODcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIyNTBhNTQ2MS03MGJlLTRhZTItOWY2Yi1hMDQwOWE1NWJhMTMifX0sIm5iZiI6MTY5OTY0MjY4Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.U-lH9_sRU4TVrpAznqS60INNSev9NxHu61igGUTzTBoaWo7WjPG7vzTnpZYhvsoglTzMEKhfranJkkkn95pe-prkvSasaAL6kXHw0jQjlSMzcYiF7DoLdkOtDJSukuALEubidf9eIwZXFZ-sezZdZHm4hnk5nWme5YtdOmYOJPh5sv1dzRvM1XuOHknJPTA1BbdZuVAtSGHSjkhwx-wl-41uuQoROW5GjJs0bz4zLBFn1w_pWaSMCn7pjGJNcbr6IuDV41km_etpwwxacWyfAcxNykzCtIiE1abJj7m-e944GvAn_eqxz3wCZD6Bgt41FWRzyMHjrppJfDjk7FaHNw\n\n----\n\n```\n\n![image-20231111025910110](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/d9e668b5905d26157c9377c9462266e5697559838-1758977411838-23.png)\n\n### éƒ¨ç½²ä¸€ä¸ªnginxæµ‹è¯•\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```yaml\nvim web.yaml\n\nkind: Deployment\n#apiVersion: extensions/v1beta1\napiVersion: apps/v1\nmetadata:\n  labels:\n    app: web-deployment-label\n  name: web-deployment\n  namespace: default\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-selector\n  template:\n    metadata:\n      labels:\n        app: web-selector\n    spec:\n      containers:\n      - name: web-container\n        image: nginx:latest\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 80\n          protocol: TCP\n          name: http\n        - containerPort: 443\n          protocol: TCP\n          name: https\n\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: web-service-label\n  name: web-service\n  namespace: default\nspec:\n  type: NodePort\n  ports:\n  - name: http\n    port: 80\n    protocol: TCP\n    targetPort: 80\n    nodePort: 30080\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: 443\n    nodePort: 30443\n  selector:\n    app: web-selector\n    \nkubectl apply -f web.yaml \n```\n\n![image-20231014180923818](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/a43ccc12f086a6b24663f4030e058d51697559838-1758977411838-24.png)\n\n```\n### æŸ¥çœ‹nginxçš„pod çš„è¯¦ç»†ä¿¡æ¯\nkubectl get deploy,svc,pod -o wide\n```\n\n![image-20231016203536987](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/6061b13260d568766dd53ec7fc3036ce697559838-1758977411838-25.png)\n\nè®¿é—®nginxç½‘ç«™\n\n```\nhttp://192.168.48.200:30080\n```\n\n![image-20231111030413487](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/e162ff6ccabaf5e49f416b7a1974777c697559838-1758977411838-26.png)\n\n## ä¿®æ”¹modeæ”¯æŒipvs\n\nä¿®æ”¹å™¨è¯·ç¡®è®¤ä½ çš„æœºå­æ˜¯å¦æ”¯æŒipvsï¼Œæˆ‘å·²ç»åœ¨`2.2 ç³»ç»Ÿåˆå§‹åŒ–`çš„è„šæœ¬é‡Œè®¾ç½®äº†ipvsåŠŸèƒ½ï¼Œä½ è¦æ˜¯æ²¡ç”¨æˆ‘çš„ï¼Œä½ å¯ä»¥è‡ªè¡Œçœ‹çœ‹è„šæœ¬ï¼Œæˆ–è€…è‡ªè¡Œé…ç½®\n\n```bash\nroot@master1:~# kubectl get configmap kube-proxy -n kube-system -o yaml | grep mode\n    mode: \"\" #å¯èƒ½ä¸ºç©ºï¼Œä¹Ÿå¯èƒ½æ˜¯iptables\n```\n\né‚£è¿™æ ·ä»–æ˜¯ä¸æ”¯æŒipvsè¦è¿›è¡Œä¿®æ”¹\n\n```bash\nkubectl edit configmap kube-proxy -n kube-system\n```\n\nç„¶åä¿®æ”¹ä¸º`mode: \"ipvs\"`\n\n![image-20250927203606943](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%86%85%E9%83%A8etcd%EF%BC%89/fe6af7c42906d9732fd1de7540d3fb8b697559838.png)\n\né‡å¯kube-proxy Pods\n\n```bash\nkubectl delete pod -n kube-system -l k8s-app=kube-proxy\n```\n\næ£€æŸ¥æ˜¯å¦å¯ç”¨\n\n```bash\n#ç„¶åä½ å°±ä¼šçœ‹è§ä¸€å¤§å †çš„è§„åˆ™ï¼Œé‚£ä»–è¡¨ç¤º IPVS å·²å¯ç”¨ã€‚\nroot@master1:~# ipvsadm -L -n\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  172.17.0.1:30001 rr\n  -> 10.244.196.158:8443          Masq    1      0          0\nTCP  172.17.0.1:30080 rr\n  -> 10.244.196.159:80            Masq    1      0          0\n  -> 10.244.196.160:80            Masq    1      0          0\nTCP  192.168.48.128:30001 rr\n  -> 10.244.196.158:8443          Masq    1      0          0\nTCP  192.168.48.128:30080 rr\n  -> 10.244.196.159:80            Masq    1      0          0\n  -> 10.244.196.160:80            Masq    1      0          0\nTCP  10.96.0.1:443 rr\n  -> 192.168.48.128:6443          Masq    1      8          0\nTCP  10.96.0.10:53 rr\n  -> 10.244.137.89:53             Masq    1      0          0\n  -> 10.244.137.90:53             Masq    1      0          0\nTCP  10.96.0.10:9153 rr\n......\n```\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Centos 7","K8s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå¤–éƒ¨etcdï¼‰","url":"/posts/59349/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# K8Sé«˜å¯ç”¨é›†ç¾¤ï¼ˆå¤–éƒ¨etcdï¼‰\n\nä»¥ä¸‹ä¼šç”¨åˆ°çš„èµ„æº[K8s1.28.2ï¼ˆå†…å¤–éƒ¨etcdé«˜å¯ç”¨ï¼‰æ‰€éœ€èµ„æº](https://www.123pan.com/s/MYnLVv-gLp4.html)\n\n## ä¸»æœºæ‹“æ‰‘\n\n| ä¸»æœºå  | ip1ï¼ˆNATï¼‰     | ç³»ç»Ÿ      | ç£ç›˜ | å†…å­˜ |\n| ------- | -------------- | --------- | ---- | ---- |\n| master1 | 192.168.48.101 | Centos7.9 | 100G | 4G   |\n| master2 | 192.168.48.102 | Centos7.9 | 100G | 4G   |\n| master3 | 192.168.48.103 | Centos7.9 | 100G | 4G   |\n| node01  | 192.168.48.104 | Centos7.9 | 100G | 8G   |\n\n## åŸºç¡€é…ç½®\n\ncentosé€šè¿‡å•ç‹¬å®‰è£…ï¼Œéå…‹éš†ã€‚å®‰è£…å®Œåè¿›è¡ŒåŸºæœ¬ç¯å¢ƒçš„é…ç½®ï¼Œé…ç½®ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n1. è®¾ç½®ä¸»æœºå\n2. å…³é—­NetworkManagerã€firewalldã€dnsmasqã€selinux\n3. è®¾ç½®ens33\n4. ä¼˜åŒ–ssh\n5. å¤‡ä»½å¹¶æ–°å¢æ¸…åyumæºã€epelæºã€docker-ceæºã€k8sæº\n6. æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\n7. ä¿®æ”¹historyæ ¼å¼åŠè®°å½•æ•°\n8. æ·»åŠ hostsè§£æ\n9. å…³é—­swapåˆ†åŒº\n10. å®‰è£…chronyæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\n11. é…ç½®limits.conf\n12. å®‰è£…å¿…å¤‡å·¥å…·\n13. å‡çº§ç³»ç»Ÿå¹¶é‡å¯\n\næ“ä½œä¸»æœºï¼š[master1,master2,master3,node01]\n\n```\nvim k8s_system_init.sh\n```\n\n```\n#!/bin/bash\nif [ $# -eq 2 ];then\n  echo \"è®¾ç½®ä¸»æœºåä¸ºï¼š$1\"\n  echo \"ens33è®¾ç½®IPåœ°å€ä¸ºï¼š192.168.48.$2\"\nelse\n  echo  \"ä½¿ç”¨æ–¹æ³•ï¼šsh $0 ä¸»æœºå ä¸»æœºä½\"\n  exit 2\nfi\n\necho \"--------------------------------------\"\necho \"1.æ­£åœ¨è®¾ç½®ä¸»æœºåï¼š$1\"\nhostnamectl set-hostname $1\n\n\necho \"2.æ­£åœ¨å…³é—­NetworkManagerã€firewalldã€dnsmasqã€selinux\"\nsystemctl disable firewalld &> /dev/null\nsystemctl disable NetworkManager &> /dev/null\nsystemctl disable dnsmasq &> /dev/null\nsystemctl stop firewalld\nsystemctl stop NetworkManager\nsystemctl stop dnsmasq\nsed -i \"s#SELINUX=enforcing#SELINUX=disabled#g\" /etc/selinux/config\nsetenforce 0\n\n\necho \"3.æ­£åœ¨è®¾ç½®ens33ï¼š192.168.48.$2\"\ncat > /etc/sysconfig/network-scripts/ifcfg-ens33 <<EOF\nTYPE=ensernet\nBOOTPROTO=static\nDEFROUTE=yes\nNAME=ens33\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.48.$2\nNETMASK=255.255.255.0\nGATEWAY=192.168.48.2\nDNS1=114.114.114.114\nEOF\nsystemctl restart network\n\n\necho \"4.ä¼˜åŒ–ssh\"\nsed -i \"s#\\#UseDNS yes#UseDNS no#g\" /etc/ssh/sshd_config\nsed -i \"s#GSSAPIAuthentication yes#GSSAPIAuthentication no#g\" /etc/ssh/sshd_config\nsystemctl restart sshd\n\necho \"5.å¤‡ä»½å¹¶æ–°å¢æ¸…åyumæºã€epelæºã€docker-ceæºã€k8sæº\"\nrm -rf /etc/yum.repos.d/*\ncat > /etc/yum.repos.d/Centos-Base.repo <<EOF\n[base]\nname=CentOS-$releasever - Base\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/\\$releasever/os/\\$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n[updates]\nname=CentOS-$releasever - Updates\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/\\$releasever/updates/\\$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n[extras]\nname=CentOS-$releasever - Extras\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/\\$releasever/extras/\\$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n[centosplus]\nname=CentOS-$releasever - Plus\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/\\$releasever/centosplus/\\$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\nEOF\n\ncat > /etc/yum.repos.d/epel.repo <<EOF\n[epel]\nname=Extra Packages for Enterprise Linux 7 - \\$basearch\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/\\$basearch\nfailovermensod=priority\nenabled=1\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7\n\n[epel-debuginfo]\nname=Extra Packages for Enterprise Linux 7 - \\$basearch - Debug\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/\\$basearch/debug\nfailovermensod=priority\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7\ngpgcheck=1\n\n[epel-source]\nname=Extra Packages for Enterprise Linux 7 - \\$basearch - Source\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/SRPMS\nfailovermensod=priority\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7\ngpgcheck=1\nEOF\n\ncat > /etc/yum.repos.d/kubernetes.repo <<EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\ncurl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\necho \"6.æ›´æ–°yumæºè½¯ä»¶åŒ…ç¼“å­˜\"\n yum clean all && yum makecache\n\n\necho \"7.ä¿®æ”¹historyæ ¼å¼åŠè®°å½•æ•°\"\nsed -i \"s#HISTSIZE=1000##g\" /etc/profile\ncat >> /etc/profile <<EOF\nshopt -s histappend\nUSER_IP=`who -u am i 2>/dev/null| awk '{print $NF}'|sed -e 's/[()]//g'`\nexport HISTFILE=~/.commandline_warrior\nexport HISTTIMEFORMAT=\"%Y-%m-%d %H:%M:%S  `whoami`@${USER_IP}: \"\nexport HISTSIZE=200000\nexport HISTFILESIZE=1000000\nexport PROMPT_COMMAND=\"history -a\"\nEOF\nsource /etc/profile\n\n\necho \"8.æ·»åŠ hostsè§£æ\"\ncat >> /etc/hosts <<EOF\n192.168.48.101 master1\n192.168.48.102 master2\n192.168.48.103 master3\n192.168.48.104 node01\nEOF\n\n\necho \"9.å…³é—­swapåˆ†åŒº\"\nswapoff -a && sysctl -w vm.swappiness=0 &> /dev/null\nsed -ri '/^[^#]*swap/s@^@#@' /etc/fstab\n\n\necho \"10.å®‰è£…ntpdateæœåŠ¡ï¼Œå¹¶åŒæ­¥æ—¶é—´\"\nyum install chrony -y\nsystemctl start chronyd\nsystemctl enable chronyd\nchronyc sources\nchronyc sources\n\necho \"11.é…ç½®limits.conf\"\nulimit -SHn 65535\ncat >> /etc/security/limits.conf <<EOF\n* soft nofile 65536\n* hard nofile 131072\n* soft nproc 65535\n* hard nproc 655350\n* soft memlock unlimited\n* hard memlock unlimited\nEOF\n\n\necho \"12.å¿…å¤‡å·¥å…·å®‰è£…\"\nyum install wget psmisc vim net-tools telnet yum-utils device-mapper-persistent-data lvm2 git -y\n\n\necho \"13.å‡çº§ç³»ç»Ÿå¹¶é‡å¯\"\nyum update -y --exclude=kernel* && reboot\n\n```\n\n```\nsh k8s_system_init.sh ä¸»æœºå ä¸»æœºä½\n[master1] sh k8s_system_init.sh master1 101\n\n[master2] sh k8s_system_init.sh master2 102\n\n[master3] sh k8s_system_init.sh master3 103\n\n[node01] sh k8s_system_init.sh node01 104\n\n```\n\n### é…ç½®sshå…å¯†\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"master1\" \"master2\" \"master3\" \"node01\")\n# å¯†ç \npassword=\"123456\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n\n\n## å†…æ ¸åŠipvsæ¨¡å—é…ç½®\n\næ­¤æ­¥éª¤æ˜¯å‡çº§å†…æ ¸ã€é…ç½®ipvsæ¨¡å—ï¼Œå¼€å¯ä¸€äº›k8sé›†ç¾¤ä¸­å¿…é¡»çš„å†…æ ¸å‚æ•°ã€‚é…ç½®ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n1. ä¸‹è½½å®‰è£…åŒ…åˆ°/server/soft\n2. å®‰è£…kernel\n3. æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº\n4. å®‰è£…ipvsadm\n5. é…ç½®ipvsæ¨¡å—\n6. å¼€å¯k8sé›†ç¾¤å¿…é¡»çš„å†…æ ¸å‚æ•°\n7. é…ç½®å®Œå†…æ ¸ï¼Œé‡å¯æœåŠ¡å™¨\n\næ“ä½œä¸»æœºï¼š[master1,master2,master3,node01]\n\n```\nvi kernel_update.sh\n\n#!/bin/bash\necho \"1.ä¸‹è½½å®‰è£…åŒ…åˆ°/server/soft\"\nmkdir -p /server/soft ; cd /server/soft\nwget https://mirrors.aliyun.com/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-6.6.3-1.el7.elrepo.x86_64.rpm\nwget https://mirrors.aliyun.com/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-6.6.3-1.el7.elrepo.x86_64.rpm\n\n\necho \"2.æ­£åœ¨å®‰è£…kernel\"\nyum localinstall -y kernel-ml*\n\n\necho \"3.æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº\"\ngrub2-set-default  0 && grub2-mkconfig -o /etc/grub2.cfg\ngrubby --args=\"user_namespace.enable=1\" --update-kernel=\"$(grubby --default-kernel)\"\n\n\necho \"4.è¾“å‡ºç°åœ¨å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯\"\ngrubby --default-kernel\n\n\necho \"5.å®‰è£…ipvsadm\"\nyum install ipvsadm ipset sysstat conntrack libseccomp -y &> /dev/null\n\n\necho \"6.é…ç½®ipvsæ¨¡å—\"\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack\n\ncat >> /etc/modules-load.d/ipvs.conf <<EOF\nip_vs\nip_vs_lc\nip_vs_wlc\nip_vs_rr\nip_vs_wrr\nip_vs_lblc\nip_vs_lblcr\nip_vs_dh\nip_vs_sh\nip_vs_fo\nip_vs_nq\nip_vs_sed\nip_vs_ftp\nip_vs_sh\nnf_conntrack\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\nEOF\nsystemctl enable --now systemd-modules-load.service &> /dev/null\n\n\necho \"7.å¼€å¯k8sé›†ç¾¤å¿…é¡»çš„å†…æ ¸å‚æ•°\"\ncat <<EOF > /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nfs.may_detach_mounts = 1\nnet.ipv4.conf.all.route_localnet = 1\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.netfilter.nf_conntrack_max=2310720\n\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl =15\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_orphans = 327680\nnet.ipv4.tcp_orphan_retries = 3\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.ip_conntrack_max = 65536\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_timestamps = 0\nnet.core.somaxconn = 16384\nEOF\nsysctl --system\n\n\necho \"8.é…ç½®å®Œå†…æ ¸ï¼Œé‡å¯æœåŠ¡å™¨ï¼\"\nreboot\n\n```\n\n```\nsh kernel_update.sh\n```\n\n## æ£€æŸ¥ipvsåŠ è½½ã€å†…æ ¸ç‰ˆæœ¬éªŒè¯\n\n```\nlsmod | grep --color=auto -e ip_vs -e nf_conntrack\nuname -a\n```\n\n![image-20231201233238841](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/7b6a9d8f90a78eced6f8ae1d42bbdec5697559838.png)\n\n## éƒ¨ç½²ETCDé›†ç¾¤\n\næœ¬æ¬¡åœ¨master1ã€master2ã€master3ä¸Šè¿›è¡Œetcdé›†ç¾¤éƒ¨ç½²\n\n### å®‰è£…etcd\n\n#### ä¸‹è½½å®‰è£…åŒ…\n\n```\nwget https://github.com/etcd-io/etcd/releases/download/v3.5.10/etcd-v3.5.10-linux-amd64.tar.gz --no-check-certificate\n```\n\n![image-20231201233751721](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/e651e3d7cbd00991c8afa5ad082945cc697559838.png)\n\n#### è§£å‹\n\n```\ntar xf etcd-v3.5.10-linux-amd64.tar.gz\nmv etcd-v3.5.10-linux-amd64 /tmp/etcd\ncp /tmp/etcd/etcd* /usr/local/bin/\n```\n\n![image-20231201234030329](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/67d93a3046dffd6ee8c251428424acac697559838.png)\n\n![image-20231015012712425](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/8771daaf594a82a3d312ac6e55254ecc697559838.png)\n\n#### æ·»åŠ ç¯å¢ƒå˜é‡\n\nå°†æ–‡ä»¶å¤¹ä¸­**etcd**å’Œ**etcdctl**ä¸¤ä¸ªæ–‡ä»¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­\n\n```\nmkdir -p /var/lib/etcd/\nmkdir -p /etc/etcd/\nchmod 700 /var/lib/etcd\n```\n\n![image-20231015012808701](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/ca7ff97219be392c73ce9e36ebe09b40697559838.png)\n\n#### åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶\n\n```\ncat <<EOF | sudo tee /etc/etcd/etcd.conf\n#èŠ‚ç‚¹åç§°\nETCD_NAME=$(hostname -s)\n#æ•°æ®å­˜æ”¾ä½ç½®\nETCD_DATA_DIR=/var/lib/etcd\nEOF\n```\n\n![image-20231015012819394](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/ab7af0c23088dfbd6083947b7b59c127697559838.png)\n\n#### åˆ›å»ºetcdæœåŠ¡\n\n```\ncat <<EOF | sudo tee /etc/systemd/system/etcd.service\n \n[Unit]\nDescription=Etcd Server\nDocumentation=https://github.com/coreos/etcd\nAfter=network.target\n \n[Service]\nUser=root\nType=notify\nEnvironmentFile=-/etc/etcd/etcd.conf\nExecStart=/usr/local/bin/etcd\nRestart=on-failure\nRestartSec=10s\nLimitNOFILE=40000\n \n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n![image-20231015012847141](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/de5dec2c81df4b27cbb395f0da812217697559838.png)\n\n#### å¼€å¯æœåŠ¡\n\n```\nsystemctl daemon-reload && systemctl enable etcd && systemctl start etcd\n```\n\n![image-20231015012901227](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/e6dd7c1044841ed87f880586044f817f697559838.png)\n\n#### **æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯**\n\n```\netcd -version\n```\n\n![image-20231201234123720](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/a2a7efe249c90e8a65947102b5aec717697559838.png)\n\n### åœ¨<font color='red'>master1</font>èŠ‚ç‚¹ä¸Šç”Ÿæˆetcdé…ç½®æ–‡ä»¶\n\n```\nvim etcd_install.sh\n\netcd1=192.168.48.101\netcd2=192.168.48.102\netcd3=192.168.48.103\n\nTOKEN=smartgo\nETCDHOSTS=($etcd1 $etcd2 $etcd3)\nNAMES=(\"master1\" \"master2\" \"master3\")\nfor i in \"${!ETCDHOSTS[@]}\"; do\nHOST=${ETCDHOSTS[$i]}\nNAME=${NAMES[$i]}\ncat << EOF > /tmp/$NAME.conf\n# [member]\nETCD_NAME=$NAME\nETCD_DATA_DIR=\"/var/lib/etcd/default.etcd\"\nETCD_LISTEN_PEER_URLS=\"http://$HOST:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://$HOST:2379,http://127.0.0.1:2379\"\n#[cluster]\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://$HOST:2380\"\nETCD_INITIAL_CLUSTER=\"${NAMES[0]}=http://${ETCDHOSTS[0]}:2380,${NAMES[1]}=http://${ETCDHOSTS[1]}:2380,${NAMES[2]}=http://${ETCDHOSTS[2]}:2380\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\nETCD_INITIAL_CLUSTER_TOKEN=\"$TOKEN\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://$HOST:2379\"\nEOF\ndone\nls /tmp/master*\nscp /tmp/master2.conf $etcd2:/etc/etcd/etcd.conf\nscp /tmp/master3.conf $etcd3:/etc/etcd/etcd.conf\ncp /tmp/master1.conf /etc/etcd/etcd.conf\nrm -f /tmp/master*.conf\n```\n\n![image-20231014195615912](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/01b659900a16525724d55fa35984fbf1697559838.png)\n\n```\nsh etcd_install.sh\n```\n\n![image-20231014195602840](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/0b062e64c96a5015d933f85645d66577697559838.png)\n\n### åœ¨k8sé›†ç¾¤masterèŠ‚ç‚¹ä¸Šå¯åŠ¨etcd\n\n```\nsystemctl restart etcd\nsystemctl enable --now etcd\n```\n\n![image-20231014195712942](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/9fa6cc52778a5f76435e622e12b340d5697559838.png)\n\n### æ£€æŸ¥etcdé›†ç¾¤æ˜¯å¦æ­£å¸¸\n\n```\netcdctl member list\netcdctl endpoint health\n```\n\n![image-20231015013040955](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/e5f0c10de8411ddb2b53def5a838e744697559838.png)\n\n![image-20231015013053386](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/a92e88f10383a90ed89a0c0f843d29bd697559838.png)\n\n![image-20231015013100578](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/5dd106819d20f456f21da551140a8039697559838.png)\n\n##  é«˜å¯ç”¨ç»„ä»¶å®‰è£…\n\n### haproxyé…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\n```\nyum install keepalived haproxy -y\n```\n\næ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®HAProxyï¼Œæ‰€æœ‰MasterèŠ‚ç‚¹çš„HAProxyé…ç½®ç›¸åŒã€‚\n\n```yaml\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2]\ncat > /etc/haproxy/haproxy.cfg <<\"EOF\"\n\nglobal\n  maxconn  2000\n  ulimit-n  16384\n  log  127.0.0.1 local0 err\n  stats timeout 30s\n\ndefaults\n  log global\n  mode  http\n  option  httplog\n  timeout connect 5000\n  timeout client  50000\n  timeout server  50000\n  timeout http-request 15s\n  timeout http-keep-alive 15s\n\nfrontend monitor-in\n  bind *:33305\n  mode http\n  option httplog\n  monitor-uri /monitor\n\nfrontend k8s-master\n  bind 0.0.0.0:16443\n  bind 127.0.0.1:16443\n  mode tcp\n  option tcplog\n  tcp-request inspect-delay 5s\n  default_backend k8s-master\n\nbackend k8s-master\n  mode tcp\n  option tcplog\n  option tcp-check\n  balance roundrobin\n  default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100\n  server master1   192.168.48.101:6443  check\n  server master2   192.168.48.102:6443  check\n  server master3   192.168.48.103:6443  check\nEOF\n```\n\n### Keepalivedé…ç½®\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\næ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®Keepalivedï¼Œä»¥ä¸‹ä¸‰ä¸ªMasterèŠ‚ç‚¹é…ç½®æ³¨æ„ipå’Œç½‘å¡ã€‚\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master1]\n\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state MASTER\n    interface ens33\n    mcast_src_ip 192.168.48.101\n    virtual_router_id 51\n    priority 101\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master2]\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state BACKUP\n    interface ens33\n    mcast_src_ip 192.168.48.102\n    virtual_router_id 51\n    priority 100\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[master3]\ncat >/etc/keepalived/keepalived.conf  <<\"EOF\"\n\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\nscript_user root\n    enable_script_security\n}\nvrrp_script chk_apiserver {\n    script \"/etc/keepalived/check_apiserver.sh\"\n    interval 5\n    weight -5\n    fall 2  \nrise 1\n}\nvrrp_instance VI_1 {\n    state BACKUP\n    interface ens33\n    mcast_src_ip 192.168.48.103\n    virtual_router_id 51\n    priority 99\n    advert_int 2\n    authentication {\n        auth_type PASS\n        auth_pass K8SHA_KA_AUTH\n    }\n    virtual_ipaddress {\n        192.168.48.200\n    }\n    track_script {\n       chk_apiserver\n    }\n}\nEOF\n```\n\n### é…ç½®Keepalivedå¥åº·æ£€æŸ¥æ–‡ä»¶\n\næ“ä½œèŠ‚ç‚¹ï¼š[master1ï¼Œmaster2,master3]\n\n```\ncat > /etc/keepalived/check_apiserver.sh <<\"EOF\"\n #!/bin/bash\n err=0\n for k in $(seq 1 3)\n do\n    check_code=$(pgrep haproxy)\n    if [[ $check_code == \"\" ]]; then\n        err=$(expr $err + 1)\n        sleep 1\n        continue\n    else\n        err=0\n        break\n    fi\n done\n \n if [[ $err != \"0\" ]]; then\n    echo \"systemctl stop keepalived\"\n    /usr/bin/systemctl stop keepalived\n    exit 1\n else\n    exit 0\n fi\nEOF\n\nchmod +x /etc/keepalived/check_apiserver.sh\n```\n\n### å¯åŠ¨haproxyå’Œkeepalived\n\n```\næ“ä½œèŠ‚ç‚¹ï¼š[masterï¼Œmaster2,master3]\nsystemctl daemon-reload\nsystemctl enable --now haproxy\nsystemctl enable --now keepalived\n```\n\n### æµ‹è¯•é›†ç¾¤è´Ÿè½½å‡è¡¡é«˜å¯ç”¨\n\næŸ¥çœ‹master1çš„vip\n\n```\nip a\n```\n\n![image-20231109232708584](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/0176020d9bcd8b4c85ea2e4f8d6b4afa697559838.png)\n\næ¨¡æ‹Ÿmaster1çš„å®•æœºæµ‹è¯•ï¼Œçœ‹çœ‹vipä¼šä¸ä¼šæ¼‚ç§»åˆ°master2å»\n\n```\n[master1] poweroff\n```\n\n![image-20231109232803276](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/126a03a1112b6ab1ae01e0603ac0023b697559838.png)\n\nè¿™æ—¶å€™æŸ¥çœ‹master2çš„ipåˆ—è¡¨\n\n```\n[master2] ip a\n```\n\n![image-20231109232825999](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/2a02b2b0a2310908a960dff95daf55d8697559838.png)\n\nç»“è®ºï¼šè¿™æ—¶å¯ä»¥çŸ¥é“ï¼Œè´Ÿè½½å‡è¡¡é›†ç¾¤æˆåŠŸï¼Œå½“master1å‡ºç°å®•æœºæƒ…å†µï¼Œvipä¼šä»master1æ¼‚ç§»åˆ°master2\n\n## dockerå®‰è£…\n\n### å®‰è£…docker\n\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\n```\nwget https://download.docker.com/linux/static/stable/x86_64/docker-24.0.7.tgz\ntar xf docker-*.tgz\ncp -rf docker/* /usr/bin/\n#åˆ›å»ºcontainerdçš„serviceæ–‡ä»¶,å¹¶ä¸”å¯åŠ¨\ncat >/etc/systemd/system/containerd.service <<EOF\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=1048576\nTasksMax=infinity\nOOMScoreAdjust=-999\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl enable --now containerd.service\n\n#å‡†å¤‡dockerçš„serviceæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.service <<EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service containerd.service\nWants=network-online.target\nRequires=docker.socket containerd.service\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd --config-file=/etc/docker/daemon.json -H fd://\ncontainerd=/run/containerd/containerd.sock\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\nOOMScoreAdjust=-500\n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å‡†å¤‡dockerçš„socketæ–‡ä»¶\n\ncat > /etc/systemd/system/docker.socket <<EOF\n[Unit]\nDescription=Docker Socket for the API\n[Socket]\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n[Install]\nWantedBy=sockets.target\nEOF\ngroupadd docker\n\nsystemctl enable --now docker.socket  && systemctl enable --now docker.service\n\n\n#éªŒè¯\nmkdir /etc/docker\nsudo tee /etc/docker/daemon.json > /dev/null <<'EOF'\n{\n  \"registry-mirrors\": [\n    \"https://docker.xuanyuan.me\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://docker.1panel.live\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n\t\t\"https://docker.qianyios.top\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n  },\n  \"data-root\": \"/var/lib/docker\"\n}\nEOF\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n### å®‰è£…cri-docker\n\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\n```\nwget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.7/cri-dockerd-0.3.7.amd64.tgz\n\ntar -zxvf cri-dockerd-0.3.7.amd64.tgz\ncp cri-dockerd/cri-dockerd  /usr/bin/\nchmod +x /usr/bin/cri-dockerd\n\n\n#å†™å…¥å¯åŠ¨é…ç½®æ–‡ä»¶\ncat >  /usr/lib/systemd/system/cri-docker.service <<EOF\n[Unit]\nDescription=CRI Interface for Docker Application Container Engine\nDocumentation=https://docs.mirantis.com\nAfter=network-online.target firewalld.service docker.service\nWants=network-online.target\nRequires=cri-docker.socket\n \n[Service]\nType=notify\nExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.9\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\n \nStartLimitBurst=3\n \nStartLimitInterval=60s\n \nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\n \nTasksMax=infinity\nDelegate=yes\nKillMode=process\n \n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n#å†™å…¥socketé…ç½®æ–‡ä»¶\ncat > /usr/lib/systemd/system/cri-docker.socket <<EOF\n[Unit]\nDescription=CRI Docker Socket for the API\nPartOf=cri-docker.service\n \n[Socket]\nListenStream=%t/cri-dockerd.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n \n[Install]\nWantedBy=sockets.target\nEOF\n\nsystemctl daemon-reload && systemctl enable cri-docker --now\n```\n\n## K8Sé›†ç¾¤å®‰è£…\n\n### å®‰è£…k8sæ‰€éœ€çš„å·¥å…·\n\n```\næ“ä½œèŠ‚ç‚¹[master1ï¼Œmaster2ï¼Œmaster3,node01]\n\nyum -y install  kubeadm kubelet kubectl\n\n#ä¸ºäº†å®ç°dockerä½¿ç”¨çš„cgroupdriverä¸kubeletä½¿ç”¨çš„cgroupçš„ä¸€è‡´æ€§ï¼Œé…ç½®å¦‚ä¸‹ï¼š\nsed -i 's/^KUBELET_EXTRA_ARGS=/KUBELET_EXTRA_ARGS=\"--cgroup-driver=systemd\"/g' /etc/sysconfig/kubelet\n\n#è®¾ç½®kubeletä¸ºå¼€æœºè‡ªå¯åŠ¨å³å¯ï¼Œç”±äºæ²¡æœ‰ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé›†ç¾¤åˆå§‹åŒ–åè‡ªåŠ¨å¯åŠ¨\nsystemctl enable kubelet\nsystemctl enable kubelet.service\n```\n\n### åˆå§‹åŒ–é›†ç¾¤\n\n```yaml\ncat > kubeadm-config.yaml << EOF\n---\napiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 192.168.48.101\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/cri-dockerd.sock\n---\napiVersion: kubeadm.k8s.io/v1beta3\nkind: ClusterConfiguration\nkubernetesVersion: 1.28.2\nimageRepository: registry.aliyuncs.com/google_containers\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 10.244.0.0/16\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\napiServerCertSANs:\n- 192.168.48.200\ncontrolPlaneEndpoint: \"192.168.48.200:16443\"\netcd:\n  external:\n    endpoints:\n      - http://192.168.48.101:2379\n      - http://192.168.48.102:2379\n      - http://192.168.48.103:2379\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nfeatureGates:\n  # SupportIPVSProxyMode: false\nmode: ipvs  #æŒ‡å®šipvsæ¨¡å¼\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\ncgroupDriver: systemd\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging:\n  flushFrequency: 0\n  options:\n    json:\n      infoBufferSize: \"0\"\n  verbosity: 0\nmemorySwap: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\nEOF\n\n```\n\n### å‡†å¤‡k8sæ‰€éœ€çš„é•œåƒ\n\n```\næ“ä½œèŠ‚ç‚¹[master1]\n\nkubeadm config images pull --config kubeadm-config.yaml\n```\n\n![image-20231202000515399](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/ce115b5b28cc5ab3ebcd567294737a43697559838.png)\n\n### master1èŠ‚ç‚¹åˆå§‹åŒ–\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nkubeadm init --config kubeadm-config.yaml --upload-certs --v=9\n```\n\nä¼šç”Ÿæˆä¿¡æ¯\n\n![image-20231202000611013](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/7f60e65f8637a54135d92dd6a756595f697559838.png)\n\nè®°å½•ä¿¡æ¯åé¢ä¼šç”¨åˆ°\n\nåˆå§‹åŒ–æˆåŠŸä»¥åï¼Œä¼šäº§ç”ŸTokenå€¼ï¼Œç”¨äºå…¶ä»–èŠ‚ç‚¹åŠ å…¥æ—¶ä½¿ç”¨ï¼Œå› æ­¤è¦è®°å½•ä¸‹åˆå§‹åŒ–æˆåŠŸç”Ÿæˆçš„tokenå€¼ï¼ˆä»¤ç‰Œå€¼ï¼‰ï¼Œ**æœ‰æ•ˆæœŸ24å°æ—¶ï¼Œåç»­éœ€è¦æ“ä½œå¯ä»¥é‡æ–°ç”ŸæˆToken**\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612 \\\n        --control-plane --certificate-key 37b1370abd3584c354517603bf97e10c795e3367e05e5ff3f2f6ca14288d8054\n\n\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612\n```\n\n`æ“ä½œkubectæŠ¥é”™ï¼š`\n\n![image-20231110180035297](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/0ea7d75c613d48f13e34f481c6cf08b0697559838.png)\n\næ­¤æ—¶é€šè¿‡kubectlæ“ä½œï¼Œä¼šå‡ºç°å¤±è´¥ï¼Œå› ä¸ºè¿˜æ²¡æœ‰å°†é›†ç¾¤çš„\"é’¥åŒ™\"äº¤ç»™rootç”¨æˆ·ã€‚`/etc/kubernetes/admin.conf` æ–‡ä»¶æ˜¯ Kubernetesï¼ˆK8sï¼‰é›†ç¾¤ä¸­çš„ç®¡ç†å‘˜é…ç½®æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ç”¨äºç®¡ç†é›†ç¾¤çš„èº«ä»½éªŒè¯å’Œè®¿é—®ä¿¡æ¯ã€‚æ‰€ä»¥ä¸‹é¢è¿›è¡Œé…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®Kubernetesé›†ç¾¤ï¼š\n\n`æ·»åŠ ç¯å¢ƒå˜é‡`\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n### æ·»åŠ å…¶ä»–masterèŠ‚ç‚¹è‡³é›†ç¾¤ä¸­\n\næ“ä½œèŠ‚ç‚¹[master2,master3]\n\n```\næ“ä½œèŠ‚ç‚¹[master2,master3]\nkubeadm join 192.168.48.200:16443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612 \\\n        --control-plane --certificate-key 37b1370abd3584c354517603bf97e10c795e3367e05e5ff3f2f6ca14288d8054 \\\n        --cri-socket unix:///var/run/cri-dockerd.sock \n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\næ¥ç€ç»™`master2`æ·»åŠ ç¯å¢ƒå˜é‡\n\n```\næ“ä½œèŠ‚ç‚¹[master2,master3]\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n![image-20231110180919008](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/3f20e99d3edff4874993811b81d45783697559838.png)\n\nè¿™é‡Œæ²¡æœ‰å±•ç¤ºmaster3çš„å›¾ç‰‡ï¼Œä½†æ˜¯æ­¥éª¤ä¸€æ ·çš„\n\n### æ¨¡æ‹ŸTokenè¿‡æœŸé‡æ–°ç”Ÿæˆå¹¶åŠ å…¥NodeèŠ‚ç‚¹\n\nå‡è®¾åŠ å…¥é›†ç¾¤çš„tokenè¿‡æœŸäº†ã€‚node01æ— æ³•åŠ å…¥äº†ï¼Œè¿™é‡Œå°±æ¨¡æ‹Ÿä¸€ä¸‹è¿™ç§æƒ…å†µ\n\n1. Tokenè¿‡æœŸåç”Ÿæˆæ–°çš„tokenï¼š\n\n```bash\nkubeadm token create --print-join-command\n```\n\n```\n[root@master1 ~]# kubeadm token create --print-join-command\nkubeadm join 192.168.48.200:16443 --token ke773y.6hv9utk33to4vwfy --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612\n[root@master1 ~]#\n\n```\n\nå…¶ä¸­ï¼Œ`192.168.48.200:16443` æ˜¯ä½ çš„ Kubernetes API æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ï¼Œ`ke773y.6hv9utk33to4vwfy` æ˜¯æ–°çš„ä»¤ç‰Œï¼Œ`sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612` æ˜¯ä»¤ç‰Œçš„ CA è¯ä¹¦å“ˆå¸Œå€¼ã€‚\n\n2. Masteréœ€è¦ç”Ÿæˆ--certificate-keyï¼š\n\n```bash\nkubeadm init phase upload-certs --upload-certs\n```\n\n```\n[root@master1 ~]# kubeadm init phase upload-certs --upload-certs\nW1110 18:12:03.426245   10185 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW1110 18:12:03.426320   10185 version.go:105] falling back to the local client version: v1.28.2\n[upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n[upload-certs] Using certificate key:\n5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nå…¶ä¸­ï¼Œ`5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128` æ˜¯è¯ä¹¦å¯†é’¥ã€‚\n\n3. ç”Ÿæˆæ–°çš„Tokenç”¨äºé›†ç¾¤æ·»åŠ æ–°NodeèŠ‚ç‚¹\n\næ“ä½œèŠ‚ç‚¹[node01]\n\n```\nkubeadm join 192.168.48.200:16443 \\\n        --token ke773y.6hv9utk33to4vwfy \\\n        --discovery-token-ca-cert-hash sha256:bc27d821932d27bb4b49c187ddd412569ead01b14009e03b6d03aa3ea54e4612  \\\n        --cri-socket unix:///var/run/cri-dockerd.sock \n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\n![image-20231110181623386](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/3e809e4e0ccbd1d84b7563de484600dc697559838.png)\n\nè¿™æ—¶åœ¨masteræŸ¥çœ‹nodeçŠ¶æ€ï¼ˆæ˜¾ç¤ºä¸ºnotreadyä¸å½±å“ï¼‰\n\n![image-20231111145807000](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/35ee9666e8251b54f20eec2a53ff9058697559838.png)\n\n### æ¨¡æ‹Ÿæ–°åŠ masterèŠ‚ç‚¹çš„åŠ å…¥K8Sé›†ç¾¤ä¸­\n\nå‡è®¾æˆ‘ä»¬æ–°åŠ masterèŠ‚ç‚¹çš„è¯ï¼Œå°±æ‹¼æ¥tokenï¼Œ`ä»åˆšåˆšç”Ÿæˆçš„tokenæ‹¼æ¥`\n\n```\n[root@master1 ~]# kubeadm token create --print-join-command\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n```\n\nè¿™é‡Œæå–ä¿¡æ¯1\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f\n```\n\næ¥ç€\n\n```\n[root@master1 ~]# kubeadm init phase upload-certs --upload-certs\nW1110 18:12:03.426245   10185 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW1110 18:12:03.426320   10185 version.go:105] falling back to the local client version: v1.28.2\n[upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n[upload-certs] Using certificate key:\n5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nè¿™é‡Œæå–ä¿¡æ¯2ï¼šè¿™é‡Œå‰é¢è¦åŠ ä¸Š`--control-plane --certificate-key`\n\n```\n--control-plane --certificate-key 5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128\n```\n\nåˆæˆ\n\n```\nkubeadm join 192.168.48.200:16443 --token tn5q1b.7w1jj77ewup7k2in \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f  \\\n        --control-plane --certificate-key 5d3706028d5e569324a4c456c81ae0f5551ece88b3132f03917668c6b0605128 \\\n        --cri-socket unix:///var/run/cri-dockerd.sock\n        \n        \nkubeadm join 192.168.48.200:16443 --token lnkno8.u4v1l8n9pahzf0kj \\\n        --discovery-token-ca-cert-hash sha256:cc5427e0e133d95250ab0aa90976fea2c383278b6345fd7e8c28702ac8dfc61f \\\n        --control-plane --certificate-key 41e441fe56cb4bdfcc2fc0291958e6b1da54d01f4649b6651471c07583f85cdf \\\n        --cri-socket unix:///var/run/cri-dockerd.sock\n\n\n```\n\næ³¨æ„ï¼šè¿™é‡Œæœ«å°¾æ·»åŠ äº†`--cri-socket unix:///var/run/cri-dockerd.sock `\n\nå›¾ç¤º\n\n![image-20231110182741430](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/7dcec71d06d286a5b7b1fcebbef15a7b697559838.png)\n\n## å®‰è£…calicoç½‘ç»œæ’ä»¶\n\næ“ä½œèŠ‚ç‚¹[master1]\n\næ·»åŠ è§£æè®°å½•ï¼Œå¦åˆ™æ— æ³•è®¿é—®\n\n```\necho '185.199.108.133 raw.githubusercontent.com' >> /etc/hosts\n```\n\n### åº”ç”¨operatorèµ„æºæ¸…å•æ–‡ä»¶\n\nç½‘ç»œç»„ä»¶æœ‰å¾ˆå¤šç§ï¼Œåªéœ€è¦éƒ¨ç½²å…¶ä¸­ä¸€ä¸ªå³å¯ï¼Œæ¨èCalicoã€‚ \nCalicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼ŒCalicoæ”¯æŒå¹¿æ³›çš„å¹³å°ï¼ŒåŒ…æ‹¬Kubernetesã€OpenStackç­‰ã€‚ \nCalico åœ¨æ¯ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹åˆ©ç”¨ Linux Kernel å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„è™šæ‹Ÿè·¯ç”±å™¨ï¼ˆ vRouterï¼‰ æ¥è´Ÿè´£æ•°æ®è½¬å‘ï¼Œè€Œæ¯ä¸ª vRouter é€šè¿‡ BGP åè®®è´Ÿè´£æŠŠè‡ªå·±ä¸Šè¿è¡Œçš„ workload çš„è·¯ç”±ä¿¡æ¯å‘æ•´ä¸ª Calico ç½‘ç»œå†…ä¼ æ’­ã€‚ \næ­¤å¤–ï¼ŒCalico é¡¹ç›®è¿˜å®ç°äº† Kubernetes ç½‘ç»œç­–ç•¥ï¼Œæä¾›ACLåŠŸèƒ½ã€‚\n\n```\ncurl https://raw.githubusercontent.com/projectcalico/calico/v3.25.1/manifests/calico.yaml -O\n```\n\n```yaml\n[root@master1 ~]# vim calico.yaml\n#æ·»åŠ ä¸¤è¡Œ\n- name: WAIT_FOR_DATASTORE\n  value: \"true\"\n- name: IP_AUTODETECTION_METHOD\n  value: interface=ens33\n#ens33æ˜¯ä½ çš„ç½‘å¡\n```\n\n![image-20231110183944854](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/12da23b4f8d928a8ac610de1419f8f01697559838.png)\n\n```\nsed -i 's| docker.io/calico/| registry.cn-hangzhou.aliyuncs.com/qianyios/|' calico.yaml\nkubectl apply -f calico.yaml\n```\n\n![image-20231110184031455](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/515614f130cb327d7e301ddff0ea1b75697559838.png)\n\n### ç›‘è§†kube-systemå‘½åç©ºé—´ä¸­podè¿è¡Œæƒ…å†µ\n\nç­‰å¾…ä¼°è®¡20åˆ†é’Ÿå·¦å³å§(ç¡®ä¿å…¨éƒ¨running)\n\n```\nkubectl get pods -n kube-system\n```\n\n![image-20231110193921266](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/65e576c8a0ad30192f63c585bda21254697559838.png)\n\n### æ‹¿æ‰masterèŠ‚ç‚¹çš„æ±¡ç‚¹\n\nèŠ‚ç‚¹ master1 å’Œ master2 éƒ½æœ‰ä¸€ä¸ªåä¸º `node-role.kubernetes.io/control-plane:NoSchedule` çš„æ±¡ç‚¹ã€‚è¿™ä¸ªæ±¡ç‚¹çš„ä½œç”¨æ˜¯é˜»æ­¢æ™®é€šçš„ Pod è¢«è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šï¼Œåªå…è®¸ç‰¹å®šçš„æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆå¦‚ kube-apiserverã€kube-controller-manager å’Œ kube-schedulerï¼‰åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n\nè¿™ç§è®¾ç½®æœ‰åŠ©äºç¡®ä¿æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸“é—¨ç”¨äºè¿è¡Œ Kubernetes çš„æ ¸å¿ƒç»„ä»¶ï¼Œè€Œä¸ä¼šè¢«æ™®é€šçš„å·¥ä½œè´Ÿè½½å ç”¨ã€‚é€šè¿‡å°†æ±¡ç‚¹æ·»åŠ åˆ°èŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥ç¡®ä¿åªæœ‰è¢«æˆæƒçš„æ§åˆ¶å¹³é¢ç»„ä»¶æ‰èƒ½åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n\n```\nkubectl describe node master1 | grep -i taint\nkubectl describe node master2 | grep -i taint\nkubectl describe node master3 | grep -i taint\n```\n\n![image-20231111152324023](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/7e79bf5ee514955fa2bc88a482aeace0697559838.png)\n\nå»é™¤æ±¡ç‚¹\n\n```\nkubectl taint node master1 node-role.kubernetes.io/control-plane:NoSchedule-\nkubectl taint node master2 node-role.kubernetes.io/control-plane:NoSchedule-\nkubectl taint node master3 node-role.kubernetes.io/control-plane:NoSchedule-\n```\n\n![image-20231111152342956](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/787ed2d5c1bfbafd6bf56ca9127c4d59697559838.png)\n\n## å®‰è£…dashboard\n\næ“ä½œèŠ‚ç‚¹[master1]\n\nä¸‹è½½æ–‡ä»¶\n\nhttps://github.com/kubernetes/dashboard/releases/tag/v2.7.0\n\nç›®å‰æœ€æ–°ç‰ˆæœ¬v2.7.0 \n\n```\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml\nsed -i 's/kubernetesui\\/dashboard:v2.7.0/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/dashboard:v2.7.0/g' recommended.yaml\nsed -i 's/kubernetesui\\/metrics-scraper:v1.0.8/registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/metrics-scraper:v1.0.8/g' recommended.yaml\n```\n\n![image-20231014174400992](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/765d82d207c2fefcc00048060c4d1146697559838.png)\n\nä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```yaml\nvim recommended.yaml\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30001\n  type: NodePort\n  selector:\n    app: kubernetes-dashboard\n\n---\n```\n\n![image-20231014174511047](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/33ac61c500136a4ce86567aafd1c1382697559838.png)\n\nè¿è¡Œdashboard\n\n```\nkubectl apply -f recommended.yaml\n```\n\n![image-20231014174622344](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/2332124844a312fa6b5261eb90fb2c26697559838.png)\n\næ£€æŸ¥è¿è¡ŒçŠ¶æ€\n\n```\nkubectl get pods -n kubernetes-dashboard\nkubectl get pod,svc -o wide -n kubernetes-dashboard\n```\n\n![image-20231111025752605](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/39d745dff08f596e4d810445df33dbdc697559838.png)\n\n### åˆ›å»ºcluster-adminç”¨æˆ·\n\n```\nåˆ›å»ºservice accountå¹¶ç»‘å®šé»˜è®¤cluster-adminç®¡ç†å‘˜ç¾¤è§’è‰²\n#åˆ›å»ºç”¨æˆ·\nkubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n#ç”¨æˆ·æˆæƒ\nkubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n#è·å–ç”¨æˆ·Token\nkubectl create token dashboard-admin -n kubernetes-dashboard\n```\n\n![image-20231111025817854](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/5e1825e420253c9b7aaba3307e80d3ef697559838.png)\n\nè®°å½•token\n\n```\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJxb21sRTZSckhEZ09FMnlvWU5IY3dfTTRIWDEzRUpsQ000MThhSWxYNDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjk5NjQ2Mjg3LCJpYXQiOjE2OTk2NDI2ODcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIyNTBhNTQ2MS03MGJlLTRhZTItOWY2Yi1hMDQwOWE1NWJhMTMifX0sIm5iZiI6MTY5OTY0MjY4Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.U-lH9_sRU4TVrpAznqS60INNSev9NxHu61igGUTzTBoaWo7WjPG7vzTnpZYhvsoglTzMEKhfranJkkkn95pe-prkvSasaAL6kXHw0jQjlSMzcYiF7DoLdkOtDJSukuALEubidf9eIwZXFZ-sezZdZHm4hnk5nWme5YtdOmYOJPh5sv1dzRvM1XuOHknJPTA1BbdZuVAtSGHSjkhwx-wl-41uuQoROW5GjJs0bz4zLBFn1w_pWaSMCn7pjGJNcbr6IuDV41km_etpwwxacWyfAcxNykzCtIiE1abJj7m-e944GvAn_eqxz3wCZD6Bgt41FWRzyMHjrppJfDjk7FaHNw\n\n```\n\n### ç™»å½•æµè§ˆå™¨è®¿é—®\n\n```\nhttps://192.168.48.200:30001\n\nè¾“å…¥tokenï¼š\n----\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJxb21sRTZSckhEZ09FMnlvWU5IY3dfTTRIWDEzRUpsQ000MThhSWxYNDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjk5NjQ2Mjg3LCJpYXQiOjE2OTk2NDI2ODcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJkYXNoYm9hcmQtYWRtaW4iLCJ1aWQiOiIyNTBhNTQ2MS03MGJlLTRhZTItOWY2Yi1hMDQwOWE1NWJhMTMifX0sIm5iZiI6MTY5OTY0MjY4Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.U-lH9_sRU4TVrpAznqS60INNSev9NxHu61igGUTzTBoaWo7WjPG7vzTnpZYhvsoglTzMEKhfranJkkkn95pe-prkvSasaAL6kXHw0jQjlSMzcYiF7DoLdkOtDJSukuALEubidf9eIwZXFZ-sezZdZHm4hnk5nWme5YtdOmYOJPh5sv1dzRvM1XuOHknJPTA1BbdZuVAtSGHSjkhwx-wl-41uuQoROW5GjJs0bz4zLBFn1w_pWaSMCn7pjGJNcbr6IuDV41km_etpwwxacWyfAcxNykzCtIiE1abJj7m-e944GvAn_eqxz3wCZD6Bgt41FWRzyMHjrppJfDjk7FaHNw\n\n----\n\n```\n\n![image-20231111025910110](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/d9e668b5905d26157c9377c9462266e5697559838.png)\n\n### éƒ¨ç½²ä¸€ä¸ªnginxæµ‹è¯•\n\næ“ä½œèŠ‚ç‚¹[master1]\n\n```yaml\nvim web.yaml\n\nkind: Deployment\n#apiVersion: extensions/v1beta1\napiVersion: apps/v1\nmetadata:\n  labels:\n    app: web-deployment-label\n  name: web-deployment\n  namespace: default\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-selector\n  template:\n    metadata:\n      labels:\n        app: web-selector\n    spec:\n      containers:\n      - name: web-container\n        image: nginx:latest\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 80\n          protocol: TCP\n          name: http\n        - containerPort: 443\n          protocol: TCP\n          name: https\n\n---\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    app: web-service-label\n  name: web-service\n  namespace: default\nspec:\n  type: NodePort\n  ports:\n  - name: http\n    port: 80\n    protocol: TCP\n    targetPort: 80\n    nodePort: 30080\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: 443\n    nodePort: 30443\n  selector:\n    app: web-selector\n    \nkubectl apply -f web.yaml \n```\n\n![image-20231014180923818](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/a43ccc12f086a6b24663f4030e058d51697559838.png)\n\n```\n### æŸ¥çœ‹nginxçš„pod çš„è¯¦ç»†ä¿¡æ¯\nkubectl get deploy,svc,pod -o wide\n```\n\n![image-20231016203536987](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/6061b13260d568766dd53ec7fc3036ce697559838.png)\n\nè®¿é—®nginxç½‘ç«™\n\n```\nhttp://192.168.48.200:30080\n```\n\n![image-20231111030413487](../img/K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%A4%96%E9%83%A8etcd%EF%BC%89/e162ff6ccabaf5e49f416b7a1974777c697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Centos 7","K8s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"åŸºäºé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ„å»ºç§äººdockeré•œåƒ","url":"/posts/54563/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# åŸºäºé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ„å»ºç§äººdockeré•œåƒ\n\n## å‰æƒ…æè¦\n\nä½ æ˜¯å¦è¢«<font color='red'>å›½å¤–é•œåƒ</font>æ‹‰å–é€Ÿåº¦<font color='red'>æ…¢</font>çš„æƒ…å†µæ‰€æŠ˜ç£¨ï¼Œç”šè‡³ä¸€ä¸ªå°æ—¶éƒ½æœªå¿…èƒ½ä¸‹è½½å¥½æˆ–è€…ä¸‹è½½ä¸åˆ°ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ„å»ºè¿™äº›<font color='red'>æµ·å¤–é•œåƒ</font>ä¸º<font color='red'>ç§äººé•œåƒ</font>\n\n![image-20231130213622452](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/962688b00e6628fafeca069533d9ff87697559838.png)\n\n<font color='red'>ä½¿ç”¨ä¹‹å‰ï¼Œè¦æœ‰è‡ªå·±çš„é˜¿é‡Œäº‘è´¦æˆ·ï¼Œä¸”è¦æœ‰ä¸€å®šçš„dockerfileçŸ¥è¯†</font>\n\n[Dockerç¬”è®° - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/27092/)\n\nåŸç†å›¾ï¼š\n\n![image-20231130220200466](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/1b2e659b30bdb217780825f7cb56c865697559838.png)\n\n## åˆ›å»ºæµ·å¤–é•œåƒDockerfile\n\n[Codeup Â· ä¼ä¸šçº§ä»£ç ç®¡ç†å¹³å° (aliyun.com)](https://codeup.aliyun.com/)\n\næ³¨å†Œè´¦å·è¿‡ç¨‹ä¸è§£é‡Šï¼Œè‡ªè¡Œæ¢ç´¢\n\n![image-20231130212602525](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/9f50e6ef0965a3bf02c2ac801a958b48697559838.png)\n\næ·»åŠ æ–‡ä»¶\n\n![image-20231130212529981](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/a2d705e5c71361d13f0ff1d99bd6e7df697559838.png)\n\nåˆ›å»ºdockerfile\n\nå‡è®¾è¿™é‡Œæ˜¯ä½ é‡åˆ°çš„æµ·å¤–é•œåƒï¼Œæ‹‰å–å¾ˆæ…¢çš„é•œåƒ\n\n![image-20231130213751443](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/024b2f811e483b26d56cb03fc5e79c70697559838.png)\n\næäº¤ä¹‹åæˆ‘ä»¬å°±å¯ä»¥çœ‹è§æ–‡ä»¶äº†\n\n![image-20231130213811247](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/0db126c45476ef2593b6cbd9c9b6afab697559838.png)\n\nå»ä¸ªäººä¸­å¿ƒè®¾ç½®é‡Œè®¾ç½®ä½ çš„å…‹éš†å¯†ç \n\n![image-20231130214355804](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/d2a8b4fcc14ae81839a9e5f8f6ebbb17697559838.png)\n\n![image-20231130214422020](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/cd3acb1ed8dc41133a49c25a986f3b34697559838.png)\n\nåˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œ\n\n![image-20231130214730356](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/8e8a098fe3436944d6534fe735726ee0697559838.png)\n\n![image-20231130214749060](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/37b23cc0c76e4be9636bb7aa7afaab92697559838.png)\n\nä¸‹é¢æ„å»ºé•œåƒè¦ç”¨åˆ°è¿™ä¸ªä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆ<font color='red'>è¿™ä¸ªåªä¼šå‡ºç°ä¸€æ¬¡ï¼Œè¦è®°ä¸‹æ¥</font>ï¼‰\n\n## é˜¿é‡Œå®¹å™¨æœåŠ¡æ„å»ºé•œåƒ\n\n[å®¹å™¨é•œåƒæœåŠ¡ (aliyun.com)](https://cr.console.aliyun.com/cn-hangzhou/instances)\n\nåŒæ ·ï¼Œæ³¨å†Œè´¦å·è¿‡ç¨‹ä¸åšè§£é‡Š\n\nåˆ›å»ºä¸ªäººå®ä¾‹ï¼Œå¹¶ç‚¹å‡»\n\n![image-20231130213006943](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/338968eb03407a98fd073e2f50b6f259697559838.png)\n\nåˆ›å»ºå‘½åç©ºé—´\n\n![image-20231130213103002](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/4e02ec7838fb97dfecb3d328b94cc9be697559838.png)\n\nåˆ›å»ºé•œåƒä»“åº“ï¼ˆä»“åº“åç§°=dockeré•œåƒåç§°ï¼‰ï¼Œå¹¶ç‚¹å‡»è¿›å»\n\n![image-20231130213902477](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/73d9479c86d63a7b49d22e41eba6c7a8697559838.png)\n\nç»‘å®šä»£ç æºï¼ˆä¸€å®šè¦å‹¾é€‰æµ·å¤–æ„å»ºé•œåƒï¼‰\n\n![image-20231130214016359](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/8f6823af84aa3eb0c19b072d54dcf775697559838.png)\n\nç”¨codeupè·å–çš„å…‹éš†è´¦å·\n\n![image-20231130214912189](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/bd980a3805f988ee058f9c305360be5e697559838.png)\n\n![image-20231130215146722](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/e25c874218fec925ba4f9ffdc74a62b6697559838.png)\n\nå¡«å†™ä¿¡æ¯\n\n![image-20231130215527348](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/0f64618ec6dd79a76180fd1e77dc4d1f697559838.png)\n\næ„å»ºé•œåƒï¼Œè¿‡ä¸€ä¼šä»–ä¼šè‡ªå·±æ„å»ºå¥½\n\n![image-20231130215727359](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/ed9dc9e6f70bb80d4dfcab01517216ed697559838.png)\n\nè·å–é•œåƒåœ°å€\n\n![image-20231130215810561](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/e8bcea4dc207821759287b73db662bd1697559838.png)\n\n```\nregistry.cn-hangzhou.aliyuncs.com/qianyios/pause:3.1\n```\n\n## éªŒè¯\n\n```\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/pause:3.1\n```\n\n![image-20231130215905914](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/7ce31274e625643173f8de8e36b51a16697559838.png)\n\n<font color='red'>ä½ ä¼šå‘ç°å·²ç»ä¸‹è½½å¥½äº†ï¼è¿˜å¾ˆå¿«ï¼</font>\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªk8séƒ¨ç½²å®ä¾‹æ–‡ä»¶ï¼Œæœ‰æ—¶å€™ä¼šå› ä¸ºé•œåƒæ‹‰å–æ…¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå·±æ„å»ºçš„é•œåƒ\n\n![image-20231130220355498](../img/åŸºäºé˜¿é‡Œäº‘å®¹å™¨ç§äººdockeré•œåƒ/fb9aa1ccf6eeba72514434d916fd35ee697559838.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Docker"],"categories":["Docker"]},{"title":"Lsky Proå›¾åºŠ","url":"/posts/6726/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Lsky Proå›¾åºŠ\n\nç³»ç»Ÿï¼šcentos 8 stream  ipï¼š192.168.48.11\n\n## ä»‹ç»\n\n-  æ”¯æŒ`æœ¬åœ°`ç­‰å¤šç§ç¬¬ä¸‰æ–¹äº‘å‚¨å­˜ `AWS S3`ã€`é˜¿é‡Œäº‘ OSS`ã€`è…¾è®¯äº‘ COS`ã€`ä¸ƒç‰›äº‘`ã€`åˆæ‹äº‘`ã€`SFTP`ã€`FTP`ã€`WebDav`ã€`Minio`\n-  å¤šç§æ•°æ®åº“é©±åŠ¨æ”¯æŒï¼Œ`MySQL 5.7+`ã€`PostgreSQL 9.6+`ã€`SQLite 3.8.8+`ã€`SQL Server 2017+`\n-  æ”¯æŒé…ç½®ä½¿ç”¨å¤šç§ç¼“å­˜é©±åŠ¨ï¼Œ`Memcached`ã€`Redis`ã€`DynamoDB`ã€ç­‰å…¶ä»–å…³ç³»å‹æ•°æ®åº“ï¼Œé»˜è®¤ä»¥æ–‡ä»¶çš„æ–¹å¼ç¼“å­˜\n-  å¤šå›¾ä¸Šä¼ ã€æ‹–æ‹½ä¸Šä¼ ã€ç²˜è´´ä¸Šä¼ ã€åŠ¨æ€è®¾ç½®ç­–ç•¥ä¸Šä¼ ã€å¤åˆ¶ã€ä¸€é”®å¤åˆ¶é“¾æ¥\n-  å¼ºå¤§çš„å›¾ç‰‡ç®¡ç†åŠŸèƒ½ï¼Œç€‘å¸ƒæµå±•ç¤ºï¼Œæ”¯æŒé¼ æ ‡å³é”®ã€å•é€‰å¤šé€‰ã€é‡å‘½åç­‰æ“ä½œ\n-  è‡ªç”±åº¦æé«˜çš„è§’è‰²ç»„é…ç½®ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªç»„é…ç½®å¤šä¸ªå‚¨å­˜ç­–ç•¥ï¼ŒåŒæ—¶å‚¨å­˜ç­–ç•¥å¯ä»¥é…ç½®å¤šä¸ªè§’è‰²ç»„\n-  å¯é’ˆå¯¹è§’è‰²ç»„è®¾ç½®ä¸Šä¼ æ–‡ä»¶ã€æ–‡ä»¶å¤¹è·¯å¾„å‘½åè§„åˆ™ã€ä¸Šä¼ é¢‘ç‡é™åˆ¶ã€å›¾ç‰‡å®¡æ ¸ç­‰åŠŸèƒ½\n-  æ”¯æŒå›¾ç‰‡æ°´å°ã€æ–‡å­—æ°´å°ã€æ°´å°å¹³é“ºã€è®¾ç½®æ°´å°ä½ç½®ã€X/y è½´åç§»é‡è®¾ç½®ã€æ—‹è½¬è§’åº¦ç­‰\n-  æ”¯æŒé€šè¿‡æ¥å£ä¸Šä¼ ã€ç®¡ç†å›¾ç‰‡ã€ç®¡ç†ç›¸å†Œ\n-  æ”¯æŒåœ¨çº¿å¢é‡æ›´æ–°ã€è·¨ç‰ˆæœ¬æ›´æ–°\n-  å›¾ç‰‡å¹¿åœº\n\n## è¦æ±‚\n\n- PHP >= 8.0.2\n- BCMath PHP æ‰©å±•\n- Ctype PHP æ‰©å±•\n- DOM PHP æ‹“å±•\n- Fileinfo PHP æ‰©å±•\n- JSON PHP æ‰©å±•\n- Mbstring PHP æ‰©å±•\n- OpenSSL PHP æ‰©å±•\n- PDO PHP æ‰©å±•\n- Tokenizer PHP æ‰©å±•\n- XML PHP æ‰©å±•\n- Imagick æ‹“å±•\n- execã€shell_exec å‡½æ•°\n- readlinkã€symlink å‡½æ•°\n- putenvã€getenv å‡½æ•°\n- chmodã€chownã€fileperms å‡½æ•°\n\n## å®‰è£…Lsky Pro\n\n### ä¸‹è½½Lsky Proé¡¹ç›®æ–‡ä»¶\n\né¡¹ç›®åœ°å€:[Releases Â· lsky-org/lsky-pro (github.com)](https://github.com/lsky-org/lsky-pro/releases)\n\n```\nwget https://github.com/lsky-org/lsky-pro/releases/download/2.1/lsky-pro-2.1.zip\nunzip lsky-pro-2.1.zip -d /var/www/html/lsky\nchmod 755 -R /var/www/html/lsky\nchown -R nginx:nginx /var/www/html/lsky\n```\n\n### å®‰è£…nginx\n\n```\nsudo dnf upgrade --refresh -y\nsudo dnf install \\\n   https://dl.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/e/epel-release-8-19.el8.noarch.rpm \\\n   https://dl.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/e/epel-next-release-8-19.el8.noarch.rpm \\\n   http://rpms.remirepo.net/enterprise/remi-release-8.8.rpm \\\n   dnf-utils -y\ndnf module list | grep php\n\n# åˆ é™¤ PHP\nsudo dnf -y remove php php-fpm\n   \n# åˆ é™¤ç›¸å…³æ‰©å±•åŒ…\nsudo dnf -y remove php*\n   \n# é‡ç½® PHP æ¨¡å—åˆ—è¡¨\nsudo dnf -y module reset php\n\nå¯ç”¨ï¼ˆå®‰è£…ï¼‰PHP 8.0\nsudo dnf -y module enable php:remi-8.0\n\nsudo dnf -y install php php-fpm\n\nsudo dnf install php-cli php-fpm php-curl php-mysqlnd php-gd php-opcache php-zip php-intl php-common php-bcmath php-imagick php-xmlrpc php-json php-readline php-memcached php-redis php-mbstring php-apcu php-xml php-dom php-redis php-memcached php-memcache php-devel php-ctype php-fileinfo  php-openssl php-pdo php-tokenizer -y\n\nsed -i 's/user = apache/user = nginx/; s/group = apache/group = nginx/' /etc/php-fpm.d/www.conf\n\ndnf install -y http://nginx.org/packages/rhel/8/x86_64/RPMS/nginx-1.24.0-1.el8.ngx.x86_64.rpm\nsystemctl\tenable --now nginx\nsudo systemctl restart php-fpm.service\n\n```\n\n### å®‰è£…mysql\n\n```\nsudo dnf install mysql-server mysql -y\nsystemctl enable --now mysqld\n#mysqlåˆå§‹åŒ–\nsudo mysql_secure_installation\næ ¹æ®è‡ªèº«éœ€è¦è®¾ç½®\nmysql -uroot -p\n```\n\n### è®¾ç½®å…°ç©ºé¡µé¢\n\n```\n[root@localhost ~]# cat /etc/nginx/conf.d/default.conf\nserver {\n    listen       80;\n    server_name  localhost;\n    root          /var/www/html/lsky/public/;\n    index        index.php;\n    location / {\n      try_files $uri $uri/ /index.php?$query_string;\n    }\n    location ~ \\.php$ {\n      root           /var/www/html/lsky/public/;\n      fastcgi_pass   unix:/run/php-fpm/www.sock;\n      fastcgi_index  index.php;\n      fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n      include        fastcgi_params;\n    }\n}\n\n#é‡å¯nginx\nnginx -s reload\n\n\n```\n\nè®¿é—®é¡µé¢192.168.48.11\n\n![image-20231130195414702](../img/Lsky-por/image-20231130195414702.png)\n\n![image-20231130195439402](../img/Lsky-por/image-20231130195439402.png)\n\n## åˆ©ç”¨postmanè·å–token\n\nå®˜ç½‘ï¼š[Postman API Platform](https://www.postman.com/)\n\nè‡ªå·±æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œå¹¶ä¸”ä¸‹è½½æ¡Œé¢ç‰ˆçš„postmanï¼ˆå¦‚æœä½ çš„é¡¹ç›®éƒ¨ç½²åœ¨æœåŠ¡å™¨ï¼Œå¯ä»¥ä¸ç”¨ä¸‹è½½ï¼Œç›´æ¥ä»ç¬¬äºŒæ­¥å¼€å§‹ï¼‰\n\nè½¯ä»¶ä¸‹è½½ï¼š[Download Postman | Get Started for Free](https://www.postman.com/downloads/)\n\n### ä¸‹è½½è½¯ä»¶å¹¶åŒå‡»è¿è¡Œ\n\n![image-20231130201640225](../img/Lsky-por/image-20231130201640225.png)\n\n![image-20231130201704089](../img/Lsky-por/image-20231130201704089.png)\n\n### æ‰“å¼€é¡µé¢\n\n![image-20231130201727276](../img/Lsky-por/image-20231130201727276.png)\n\n![image-20231130202249851](../img/Lsky-por/image-20231130202249851.png)\n\n```\n6|0kKPF29VXPv2Kv6lEqu1chyxHjTpjiiEdwwkRE0T\n```\n\n## å®ç°typroè‡ªåŠ¨ä¸Šä¼ \n\n[Releases Â· ygxbnet/lsky-upload (github.com)](https://github.com/ygxbnet/lsky-upload/releases)\n\n### ä¸‹è½½è‡ªåŠ¨ä¸Šä¼ é¡¹ç›®\n\nhttps://github.com/ygxbnet/lsky-upload/releases/download/0.3.0/lsky-upload_0.3.0_windows_amd64.zip\n\n![image-20231130194623114](../img/Lsky-por/image-20231130194623114.png)\n\næ‰“å¼€é…ç½®æ–‡ä»¶å¯ä»¥çœ‹è§ä¸€ä¸‹ä¿¡æ¯ï¼Œæ›´æ¢ä¸ºå‰é¢çš„è·å–çš„token\n\n![image-20231130203425977](../img/Lsky-por/6568818d78139.png)\n\n### éªŒè¯èƒ½å¦è‡ªåŠ¨ä¸Šä¼ \n\næ‰“å¼€typroa\n\n![image-20231130203326580](../img/Lsky-por/656881521a4d8.png)\n\n![image-20231130203516988](../img/Lsky-por/656881c07f24c.png)\n\nå†å»çœ‹çœ‹åå°å›¾åº“\n\n![image-20231130203549871](../img/Lsky-por/656881e175d77.png)\n\nè‡³æ­¤é¡¹ç›®æˆåŠŸ\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Centos 8 stream","Lsky Pro"],"categories":["æ‚é¡¹"]},{"title":"åŸºäºK8S1.28.2å®éªŒrookéƒ¨ç½²ceph","url":"/posts/58032/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# åŸºäºK8S1.28.2å®éªŒrookéƒ¨ç½²ceph\n\nRook æ”¯æŒ Kubernetes **v1.22** æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚\n\nrookç‰ˆæœ¬1.12.8\n\nK8Sç‰ˆæœ¬1.28.2\n\néƒ¨ç½²å‡ºæ¥cephç‰ˆæœ¬æ˜¯quincyç‰ˆæœ¬\n\n| ä¸»æœºå  | ip1ï¼ˆNATï¼‰     | ç³»ç»Ÿ      | æ–°ç¡¬ç›˜ | ç£ç›˜ | å†…å­˜ |\n| ------- | -------------- | --------- | ------ | ---- | ---- |\n| master1 | 192.168.48.101 | Centos7.9 | 100G   | 100G | 4G   |\n| master2 | 192.168.48.102 | Centos7.9 |        | 100G | 4G   |\n| master3 | 192.168.48.103 | Centos7.9 |        | 100G | 4G   |\n| node01  | 192.168.48.104 | Centos7.9 | 100G   | 100G | 6G   |\n| node02  | 192.168.48.105 | Centos7.9 | 100G   | 100G | 6G   |\n\næˆ‘è¿™é‡Œæ˜¯äº”å°æœºï¼Œæœ¬åº”è¯¥cephï¼ˆä¸‰èŠ‚ç‚¹ï¼‰æ˜¯éœ€è¦éƒ¨ç½²åœ¨ä¸‰å°nodeä¸Šçš„ï¼Œè¿™é‡Œä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œ<font color='red'>ä»…éƒ¨ç½²åœ¨master1ï¼Œnode01ï¼Œnode02ä¸Šæ‰€ä»¥éœ€è¦ç»™è¿™ä¸‰å°åŠ ä¸€ä¸ªç‰©ç†ç¡¬ç›˜</font>\n\næ³¨æ„ï¼ä½¿ç”¨ä¹‹å‰ï¼Œè¯·ç¡®å®šæ˜¯å¦å»æ‰masterèŠ‚ç‚¹çš„æ±¡ç‚¹\n\n[ã€å»æ±¡ç‚¹æ–¹æ³•ã€‘](https://blog.qianyios.top/posts/7158/#æ‹¿æ‰masterèŠ‚ç‚¹çš„æ±¡ç‚¹)\n\n<font color='red'>ä»¥ä¸‹æ‰€æœ‰æ“ä½œéƒ½åœ¨masterè¿›è¡Œ</font>\n\n## å‰æœŸå‡†å¤‡\n\n### å…‹éš†ä»“åº“\n\n```\ngit clone --single-branch --branch v1.12.8 https://github.com/rook/rook.git\ncd rook/deploy/examples\n```\n\n### æŸ¥çœ‹æ‰€éœ€é•œåƒ\n\n```\n[root@master1 examples]# cat operator.yaml | grep IMAGE:\n  # ROOK_CSI_CEPH_IMAGE: \"quay.io/cephcsi/cephcsi:v3.9.0\"\n  # ROOK_CSI_REGISTRAR_IMAGE: \"registry.k8s.io/sig-storage/csi-node-driver-registrar:v2.8.0\"\n  # ROOK_CSI_RESIZER_IMAGE: \"registry.k8s.io/sig-storage/csi-resizer:v1.8.0\"\n  # ROOK_CSI_PROVISIONER_IMAGE: \"registry.k8s.io/sig-storage/csi-provisioner:v3.5.0\"\n  # ROOK_CSI_SNAPSHOTTER_IMAGE: \"registry.k8s.io/sig-storage/csi-snapshotter:v6.2.2\"\n  # ROOK_CSI_ATTACHER_IMAGE: \"registry.k8s.io/sig-storage/csi-attacher:v4.3.0\"\n  # ROOK_CSIADDONS_IMAGE: \"quay.io/csiaddons/k8s-sidecar:v0.7.0\"\n  \n[root@master1 examples]# cat operator.yaml | grep image:\n          image: rook/ceph:v1.12.8\n```\n\n![image-20231119001814854](../img/rookéƒ¨ç½²ceph/e8d02f5e7e6cffb17ea83b39794b45b6697559838.png)\n\n![image-20231122001213717](../img/rookéƒ¨ç½²ceph/99bdb183c537ef879eb2ac4a6bc59914697559838.png)\n\nåŸºæœ¬éƒ½æ˜¯å›½å¤–çš„é•œåƒï¼Œåœ¨è¿™é‡Œé€šè¿‡é˜¿é‡Œäº‘+githubæ–¹å¼æ„å»ºé•œåƒä»“åº“è§£å†³ï¼ˆä»¥ä¸‹æ˜¯æ·»åŠ ä¸ºè‡ªå·±ç§äººæ„å»ºçš„é•œåƒï¼‰\n\n```yaml\nsed -i 's/# ROOK_CSI_CEPH_IMAGE: \"quay.io\\/cephcsi\\/cephcsi:v3.9.0\"/ROOK_CSI_CEPH_IMAGE: \"registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/cephcsi:v3.9.0\"/g' operator.yaml\n\nsed -i 's/# ROOK_CSI_REGISTRAR_IMAGE: \"registry.k8s.io\\/sig-storage\\/csi-node-driver-registrar:v2.8.0\"/ROOK_CSI_REGISTRAR_IMAGE: \"registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/csi-node-driver-registrar:v2.8.0\"/g' operator.yaml\n\nsed -i 's/# ROOK_CSI_RESIZER_IMAGE: \"registry.k8s.io\\/sig-storage\\/csi-resizer:v1.8.0\"/ROOK_CSI_RESIZER_IMAGE: \"registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/csi-resizer:v1.8.0\"/g' operator.yaml\n\nsed -i 's/# ROOK_CSI_PROVISIONER_IMAGE: \"registry.k8s.io\\/sig-storage\\/csi-provisioner:v3.5.0\"/ROOK_CSI_PROVISIONER_IMAGE: \"registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/csi-provisioner:v3.5.0\"/g' operator.yaml\n\nsed -i 's/# ROOK_CSI_SNAPSHOTTER_IMAGE: \"registry.k8s.io\\/sig-storage\\/csi-snapshotter:v6.2.2\"/ROOK_CSI_SNAPSHOTTER_IMAGE: \"registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/csi-snapshotter:v6.2.2\"/g' operator.yaml\n\nsed -i 's/# ROOK_CSI_ATTACHER_IMAGE: \"registry.k8s.io\\/sig-storage\\/csi-attacher:v4.3.0\"/ROOK_CSI_ATTACHER_IMAGE: \"registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/csi-attacher:v4.3.0\"/g' operator.yaml\n\nsed -i 's/# ROOK_CSIADDONS_IMAGE: \"quay.io\\/csiaddons\\/k8s-sidecar:v0.7.0\"/ROOK_CSIADDONS_IMAGE: \"registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/k8s-sidecar:v0.7.0\"/g' operator.yaml\n\nsed -i 's/image: rook\\/ceph:v1.12.8/image: registry.cn-hangzhou.aliyuncs.com\\/qianyios\\/ceph:v1.12.8/g' operator.yaml\n\n```\n\nå¼€å¯è‡ªåŠ¨å‘ç°ç£ç›˜ï¼ˆç”¨äºåæœŸæ‰©å±•ï¼‰\n\n```\nsed -i 's/ROOK_ENABLE_DISCOVERY_DAEMON: \"false\"/ROOK_ENABLE_DISCOVERY_DAEMON: \"true\"/' /root/rook/deploy/examples/operator.yaml\n```\n\nå»ºè®®æå‰ä¸‹è½½é•œåƒ\n\n```\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/cephcsi:v3.9.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/csi-node-driver-registrar:v2.8.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/csi-resizer:v1.8.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/csi-provisioner:v3.5.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/csi-snapshotter:v6.2.2\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/csi-attacher:v4.3.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/k8s-sidecar:v0.7.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/qianyios/ceph:v1.12.8\n```\n\n## å®‰è£…rook+cephé›†ç¾¤\n\n### å¼€å§‹éƒ¨ç½²\n\n1. åˆ›å»ºcrd&common&operator\n\n```\nkubectl create -f crds.yaml -f common.yaml -f operator.yaml\n```\n\n![image-20231119182815198](../img/rookéƒ¨ç½²ceph/4482ea21f7f87a432695f6fcd5e48880697559838.png)\n\n2. åˆ›å»ºclusterï¼ˆcephï¼‰\n\n<font color='red'>ä¿®æ”¹é…ç½®ï¼š</font>ç­‰å¾…operatorå®¹å™¨å’Œdiscoverå®¹å™¨<font color='red'>å¯åŠ¨</font>ï¼Œé…ç½®osdèŠ‚ç‚¹\n\nå…ˆæ³¨æ„ä¸€ä¸‹è‡ªå·±çš„ç£ç›˜ï¼ˆlsblkï¼‰æ ¹æ®è‡ªèº«æƒ…å†µä¿®æ”¹ä¸‹é¢çš„é…ç½®æ–‡ä»¶\n\n![image-20231119011441790](../img/rookéƒ¨ç½²ceph/c9ffdcc25e86bb74b11a58deed32eccf697559838.png)\n\n```\n#æ›´æ”¹ä¸ºå›½å†…é•œåƒ\nsed -i 's#image: quay.io/ceph/ceph:v17.2.6#image: registry.cn-hangzhou.aliyuncs.com/qianyios/ceph:v17.2.6#' cluster.yaml\n```\n\n```yaml\nvim cluster.yaml\n-------------------------------------\n \n- ä¿®æ”¹é•œåƒ\n    image: registry.cn-hangzhou.aliyuncs.com/qianyios/ceph:v17.2.6\n \n- æ”¹ä¸ºfalseï¼Œå¹¶éä½¿ç”¨æ‰€æœ‰èŠ‚ç‚¹æ‰€æœ‰ç£ç›˜ä½œä¸ºosd\n- å¯ç”¨deviceFilter\n- æŒ‰éœ€é…ç½®config\n- ä¼šè‡ªåŠ¨è·³è¿‡éè£¸ç›˜\n  storage: # cluster level storage configuration and selection\n    useAllNodes: false\n    useAllDevices: false\n    deviceFilter:\n    config:\n    nodes:\n      - name: \"master1\"\n        deviceFilter: \"sda\"\n      - name: \"node01\"\n        deviceFilter: \"sda\"\n      - name: \"node02\"\n        deviceFilter: \"^sd.\"  #è‡ªåŠ¨åŒ¹é…sdå¼€å¤´çš„è£¸ç›˜\n```\n\nè¿™é‡Œçš„ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯æˆ‘ä»¬å¼€å¤´è®²åˆ°çš„ä¸‰å°æœºï¼Œè‡ªè¡Œæ ¹æ®ä¿®æ”¹è°ƒæ•´ï¼Œæ³¨æ„è¿™é‡Œçš„åå­—æ˜¯k8sé›†ç¾¤çš„åå­—å¯ä»¥åœ¨<font color='red'>kubectl get nodes</font>æŸ¥çœ‹\n\n![image-20231119011622231](../img/rookéƒ¨ç½²ceph/8defa12ca29d58735dd919b3cd62897f697559838.png)\n\n![image-20231119011844526](../img/rookéƒ¨ç½²ceph/1f4a6c053724354ce60c86d5c5233631697559838.png)\n\néƒ¨ç½²cluster\n\n```\nkubectl create -f cluster.yaml\n```\n\n### æŸ¥çœ‹çŠ¶æ€\n\n```\n- å®æ—¶æŸ¥çœ‹podåˆ›å»ºè¿›åº¦\nkubectl get pod -n rook-ceph -w\n \n- å®æ—¶æŸ¥çœ‹é›†ç¾¤åˆ›å»ºè¿›åº¦\nkubectl get cephcluster -n rook-ceph rook-ceph -w\n \n- è¯¦ç»†æè¿°\nkubectl describe cephcluster -n rook-ceph rook-ceph\n```\n\n![image-20231119184740824](../img/rookéƒ¨ç½²ceph/a8a6ca303cfdcd6afe66ac9cbf0157fd697559838.png)\n\nå®‰è£…cephå®¢æˆ·ç«¯å·¥å…·\n\n```\n- è¿›å…¥å·¥ä½œç›®å½•\ncd rook/deploy/examples/\n\n- æŸ¥çœ‹æ‰€éœ€é•œåƒ\n[root@master1 examples]# cat toolbox.yaml | grep image:\n          image: quay.io/ceph/ceph:v17.2.6\n- æ›´æ”¹ä¸ºå›½å†…é•œåƒ\n\nsed -i 's#image: quay.io/ceph/ceph:v17.2.6#image: registry.cn-hangzhou.aliyuncs.com/qianyios/ceph:v17.2.6#' toolbox.yaml\n\n- åˆ›å»ºtoolbox\nkubectl  create -f toolbox.yaml -n rook-ceph\n \n- æŸ¥çœ‹pod\nkubectl  get pod -n rook-ceph -l app=rook-ceph-tools\n \n- è¿›å…¥pod\nkubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- bash\n \n- æŸ¥çœ‹é›†ç¾¤çŠ¶æ€\nceph status\n \n- æŸ¥çœ‹osdçŠ¶æ€\nceph osd status\n \n- é›†ç¾¤ç©ºé—´ç”¨é‡\nceph df\n```\n\n![image-20231119185510701](../img/rookéƒ¨ç½²ceph/db949d4f6d00b47903b66498f1e892a4697559838.png)\n\n![image-20231119185604869](../img/rookéƒ¨ç½²ceph/2c7745862a1dd2c9ef38fd73af0e9e9d697559838.png)\n\n### æš´éœ²dashboard\n\n```\ncat > rook-dashboard.yaml << EOF\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: rook-ceph-mgr\n    ceph_daemon_id: a\n    rook_cluster: rook-ceph\n  name: rook-ceph-mgr-dashboard-np\n  namespace: rook-ceph\nspec:\n  ports:\n  - name: http-dashboard\n    port: 8443\n    protocol: TCP\n    targetPort: 8443\n    nodePort: 30700\n  selector:\n    app: rook-ceph-mgr\n    ceph_daemon_id: a\n  sessionAffinity: None\n  type: NodePort\nEOF\n\nkubectl apply -f rook-dashboard.yaml\n```\n\næŸ¥çœ‹dashboardå¯†ç \n\n```\nkubectl -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath=\"{['data']['password']}\" | base64 --decode && echo\n\nQmu/!$ZvfQTAd-aCuHF+\n```\n\nè®¿é—®dashboard\n\n```\nhttps://192.168.48.200:30700\n```\n\n![image-20231119194020314](../img/rookéƒ¨ç½²ceph/970359409249d0b62859dc76b67e5a05697559838.png)\n\nå¦‚æœå‡ºç°ä»¥ä¸‹æŠ¥é”™ï¼ˆå¯ä»¥æŒ‰ä¸‹é¢è§£å†³ï¼Œåä¹‹è·³è¿‡ï¼‰\n\næ¶ˆé™¤HEALTH_WARNè­¦å‘Š\n\n- æŸ¥çœ‹è­¦å‘Šè¯¦æƒ…\n  - AUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED: mons are allowing insecure global_id reclaim\n  - MON_DISK_LOW: mons a,b,c are low on available space\n\n![image-20210621191403196](../img/rook%E9%83%A8%E7%BD%B2ceph/f363d6115f47d3be9b65b691e8676c62.png)\n\n> å®˜æ–¹è§£å†³æ–¹æ¡ˆï¼šhttps://docs.ceph.com/en/latest/rados/operations/health-checks/\n\n- AUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED\n\n```yaml\næ–¹æ³•ä¸€ï¼š\n- è¿›å…¥toolbox\n\nkubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- bash\n\nceph config set mon auth_allow_insecure_global_id_reclaim false\n\næ–¹æ³•äºŒï¼š\nkubectl get configmap rook-config-override -n rook-ceph -o yaml\nkubectl edit configmap rook-config-override -n rook-ceph -o yaml\n\n\nconfig: |\n    [global]\n    mon clock drift allowed = 1\n    \n#åˆ é™¤pod\nkubectl -n rook-ceph delete pod $(kubectl -n rook-ceph get pods -o custom-columns=NAME:.metadata.name --no-headers| grep mon)\n#æ˜¾ç¤ºä¸€ä¸‹ä¿¡æ¯\npod \"rook-ceph-mon-a-557d88c-6ksmg\" deleted\npod \"rook-ceph-mon-b-748dcc9b89-j8l24\" deleted\npod \"rook-ceph-mon-c-5d47c664-p855m\" deleted\n#æœ€åæŸ¥çœ‹å¥åº·å€¼\nceph -s\n```\n\n![image-20231203203949171](../img/rook%E9%83%A8%E7%BD%B2ceph/a1e3b048a1ff9259316edb8f3b7a7df9697559838.png)\n\n- MON_DISK_LOWï¼šæ ¹åˆ†åŒºä½¿ç”¨ç‡è¿‡é«˜ï¼Œæ¸…ç†å³å¯ã€‚\n\n![image-20210621195325516](../img/rook%E9%83%A8%E7%BD%B2ceph/261190930bee367b1a07ee81a311b3e2.png)\n\n## Cephå­˜å‚¨ä½¿ç”¨\n\n### ä¸‰ç§å­˜å‚¨ç±»å‹\n\n| å­˜å‚¨ç±»å‹           | ç‰¹å¾                                                         | åº”ç”¨åœºæ™¯          | å…¸å‹è®¾å¤‡  |\n| :----------------- | :----------------------------------------------------------- | :---------------- | :-------- |\n| å—å­˜å‚¨ï¼ˆRBDï¼‰      | å­˜å‚¨é€Ÿåº¦è¾ƒå¿« ä¸æ”¯æŒå…±äº«å­˜å‚¨ [**ReadWriteOnce**]              | è™šæ‹Ÿæœºç¡¬ç›˜        | ç¡¬ç›˜ Raid |\n| æ–‡ä»¶å­˜å‚¨ï¼ˆCephFSï¼‰ | å­˜å‚¨é€Ÿåº¦æ…¢ï¼ˆéœ€ç»æ“ä½œç³»ç»Ÿå¤„ç†å†è½¬ä¸ºå—å­˜å‚¨ï¼‰ æ”¯æŒå…±äº«å­˜å‚¨ [**ReadWriteMany**] | æ–‡ä»¶å…±äº«          | FTP NFS   |\n| å¯¹è±¡å­˜å‚¨ï¼ˆObjectï¼‰ | å…·å¤‡å—å­˜å‚¨çš„è¯»å†™æ€§èƒ½å’Œæ–‡ä»¶å­˜å‚¨çš„å…±äº«ç‰¹æ€§ æ“ä½œç³»ç»Ÿä¸èƒ½ç›´æ¥è®¿é—®ï¼Œåªèƒ½é€šè¿‡åº”ç”¨ç¨‹åºçº§åˆ«çš„APIè®¿é—® | å›¾ç‰‡å­˜å‚¨ è§†é¢‘å­˜å‚¨ | OSS       |\n\n### å—å­˜å‚¨\n\n#### åˆ›å»ºCephBlockPoolå’ŒStorageClass\n\n- æ–‡ä»¶è·¯å¾„ï¼š`/root/rook/deploy/examples/csi/rbd/storageclass.yaml`\n- CephBlockPoolå’ŒStorageClasséƒ½ä½äºstorageclass.yaml æ–‡ä»¶\n- é…ç½®æ–‡ä»¶ç®€è¦è§£è¯»ï¼š\n\n```\ncd /root/rook/deploy/examples/csi/rbd\n[root@master1 rbd]# grep -vE '^\\s*(#|$)' storageclass.yaml\napiVersion: ceph.rook.io/v1\nkind: CephBlockPool\nmetadata:\n  name: replicapool\n  namespace: rook-ceph # namespace:cluster\nspec:\n  failureDomain: host              # hostçº§å®¹ç¾\n  replicated:\n    size: 3                              # é»˜è®¤ä¸‰ä¸ªå‰¯æœ¬\n    requireSafeReplicaSize: true\n---\napiVersion: storage.k8s.io/v1\nkind: StorageClass                 # scæ— éœ€æŒ‡å®šå‘½åç©ºé—´\nmetadata:\n  name: rook-ceph-block\nprovisioner: rook-ceph.rbd.csi.ceph.com    # å­˜å‚¨é©±åŠ¨\nparameters:\n  clusterID: rook-ceph # namespace:cluster\n  pool: replicapool                  # å…³è”åˆ°CephBlockPool\n  imageFormat: \"2\"\n  imageFeatures: layering\n  csi.storage.k8s.io/provisioner-secret-name: rook-csi-rbd-provisioner\n  csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph # namespace:cluster\n  csi.storage.k8s.io/controller-expand-secret-name: rook-csi-rbd-provisioner\n  csi.storage.k8s.io/controller-expand-secret-namespace: rook-ceph # namespace:cluster\n  csi.storage.k8s.io/node-stage-secret-name: rook-csi-rbd-node\n  csi.storage.k8s.io/node-stage-secret-namespace: rook-ceph # namespace:cluster\n  csi.storage.k8s.io/fstype: ext4\nallowVolumeExpansion: true                          # æ˜¯å¦å…è®¸æ‰©å®¹\nreclaimPolicy: Delete                                    # PVå›æ”¶ç­–ç•¥\n[root@master1 rbd]#\n\n```\n\nåˆ›å»ºCephBlockPoolå’ŒStorageClass\n\n```\nkubectl create -f storageclass.yaml\n```\n\næŸ¥çœ‹\n\n```\n- æŸ¥çœ‹sc\nkubectl get sc\n \n- æŸ¥çœ‹CephBlockPoolï¼ˆä¹Ÿå¯åœ¨dashboardä¸­æŸ¥çœ‹ï¼‰\nkubectl get cephblockpools -n rook-ceph\n```\n\n![image-20231119195332077](../img/rookéƒ¨ç½²ceph/8eb33944dd86046d203aefd8da82cf26697559838.png)\n\n![image-20231119195400264](../img/rookéƒ¨ç½²ceph/cd95d62d7f3131ac890383048257ed3c697559838.png)\n\n#### å—å­˜å‚¨ä½¿ç”¨ç¤ºä¾‹\n\n- **Deployment**å•å‰¯æœ¬+**PersistentVolumeClaim**\n\n```yaml\ncat > nginx-deploy-rbd.yaml << \"EOF\"\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: nginx-deploy-rbd\n  name: nginx-deploy-rbd\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx-deploy-rbd\n  template:\n    metadata:\n      labels:\n        app: nginx-deploy-rbd\n    spec:\n      containers:\n      - image: registry.cn-hangzhou.aliyuncs.com/qianyios/nginx:latest\n        name: nginx\n        volumeMounts:\n        - name: data\n          mountPath: /usr/share/nginx/html\n      volumes:\n      - name: data\n        persistentVolumeClaim:\n          claimName: nginx-rbd-pvc\n\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nginx-rbd-pvc\nspec:\n  storageClassName: \"rook-ceph-block\"   #å°±æ˜¯è¿™é‡ŒæŒ‡å®šäº†å‰é¢çš„åˆ›å»ºçš„sc\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 5Gi\n\nEOF\n```\n\n```\nkubectl create -f nginx-deploy-rbd.yaml\nkubectl exec -it nginx-deploy-rbd-7886bf6666-qhw74 bash\necho \"hello,nginx-deploy-rbd\" > /usr/share/nginx/html/index.html\nexit\n\nkubectl get pod -o wide | grep nginx\n\n#æµ‹è¯•å®Œå°±åˆ é™¤\nkubectl delete -f nginx-deploy-rbd.yaml\n```\n\n![image-20231119203414038](../img/rookéƒ¨ç½²ceph/78427bca0ed2e464f619a1d20b9bca9d697559838.png)\n\n![image-20231119203735080](../img/rookéƒ¨ç½²ceph/47d21207397036100c7d1e4969615e7b697559838.png)\n\n![image-20231119203755919](../img/rookéƒ¨ç½²ceph/cf68495385eb2de397cda2f6c851f1d4697559838.png)\n\n- **StatefulSet**å¤šå‰¯æœ¬+**volumeClaimTemplates**\n\n```yaml\ncat > nginx-ss-rbd.yaml << \"EOF\"\n \napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: nginx-ss-rbd\nspec:\n  selector:\n    matchLabels:\n      app: nginx-ss-rbd \n  serviceName: \"nginx\"\n  replicas: 3 \n  template:\n    metadata:\n      labels:\n        app: nginx-ss-rbd \n    spec:\n      containers:\n      - name: nginx\n        image: registry.cn-hangzhou.aliyuncs.com/qianyios/nginx:latest\n        ports:\n        - containerPort: 80\n          name: web\n        volumeMounts:\n        - name: www\n          mountPath: /usr/share/nginx/html\n  volumeClaimTemplates:\n  - metadata:\n      name: www\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      storageClassName: \"rook-ceph-block\"  #å°±æ˜¯è¿™é‡ŒæŒ‡å®šäº†å‰é¢çš„åˆ›å»ºçš„sc\n      resources:\n        requests:\n          storage: 2Gi\nEOF\n```\n\néƒ¨ç½²\n\n```\nkubectl create -f nginx-ss-rbd.yaml\n\nkubectl get pod -o wide | grep nginx-ss\n\nkubectl exec -it nginx-ss-rbd-0 bash\necho \"hello,nginx-ss-rbd-0\" > /usr/share/nginx/html/index.html && exit\n\nkubectl exec -it nginx-ss-rbd-1 bash\necho \"hello,nginx-ss-rbd-1\" > /usr/share/nginx/html/index.html && exit\n\nkubectl exec -it nginx-ss-rbd-2 bash\necho \"hello,nginx-ss-rbd-2\" > /usr/share/nginx/html/index.html && exit\n\n#æµ‹è¯•å®Œå°±åˆ é™¤\nkubectl delete -f nginx-ss-rbd.yaml\n\nè¿™é‡Œå¯èƒ½éœ€è¦æ‰‹åŠ¨åˆ é™¤ä¸€ä¸‹pvc\n[root@master1 ~]# kubectl get pvc\nNAME                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE\nwww-nginx-ss-rbd-0   Bound    pvc-4a75f201-eec0-47fa-990c-353c52fe14f4   2Gi        RWO            rook-ceph-block   6m27s\nwww-nginx-ss-rbd-1   Bound    pvc-d5f7e29f-79e4-4d1e-bcbb-65ece15a8172   2Gi        RWO            rook-ceph-block   6m21s\nwww-nginx-ss-rbd-2   Bound    pvc-8cce06e9-dfe4-429d-ae44-878f8e4665e0   2Gi        RWO            rook-ceph-block   5m53s\n[root@master1 ~]# kubectl delete  pvc www-nginx-ss-rbd-0\npersistentvolumeclaim \"www-nginx-ss-rbd-0\" deleted\n[root@master1 ~]# kubectl delete  pvc www-nginx-ss-rbd-1\npersistentvolumeclaim \"www-nginx-ss-rbd-1\" deleted\n[root@master1 ~]# kubectl delete  pvc www-nginx-ss-rbd-2\npersistentvolumeclaim \"www-nginx-ss-rbd-2\" deleted\n\n```\n\n![image-20231119204319948](../img/rookéƒ¨ç½²ceph/491fde79a9bd682388bda9159e9f7053697559838.png)\n\n![image-20231119204602188](../img/rookéƒ¨ç½²ceph/4fcb24bea5788cb9245410d95ec051ce697559838.png)\n\n### å…±äº«æ–‡ä»¶å­˜å‚¨\n\n#### éƒ¨ç½²MDSæœåŠ¡\n\nåˆ›å»ºCephfsæ–‡ä»¶ç³»ç»Ÿéœ€è¦å…ˆéƒ¨ç½²MDSæœåŠ¡ï¼Œè¯¥æœåŠ¡è´Ÿè´£å¤„ç†æ–‡ä»¶ç³»ç»Ÿä¸­çš„å…ƒæ•°æ®ã€‚\n\n- æ–‡ä»¶è·¯å¾„ï¼š`/root/rook/deploy/examples/filesystem.yaml`\n\né…ç½®æ–‡ä»¶è§£è¯»\n\n```\ncd /root/rook/deploy/examples\n[root@master1 examples]# grep -vE '^\\s*(#|$)' filesystem.yaml\napiVersion: ceph.rook.io/v1\nkind: CephFilesystem\nmetadata:\n  name: myfs\n  namespace: rook-ceph # namespace:cluster\nspec:\n  metadataPool:\n    replicated:\n      size: 3            # å…ƒæ•°æ®å‰¯æœ¬æ•°\n      requireSafeReplicaSize: true\n    parameters:\n      compression_mode:\n        none\n  dataPools:\n    - name: replicated\n      failureDomain: host\n      replicated:\n        size: 3             # å­˜å‚¨æ•°æ®çš„å‰¯æœ¬æ•°\n        requireSafeReplicaSize: true\n      parameters:\n        compression_mode:\n          none\n  preserveFilesystemOnDelete: true\n  metadataServer:\n    activeCount: 1        # MDSå®ä¾‹çš„å‰¯æœ¬æ•°ï¼Œé»˜è®¤1ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®ä¸º3\n    activeStandby: true\n  ......çœç•¥\n\nkubectl create -f filesystem.yaml\nkubectl get pod -n rook-ceph | grep mds\n```\n\n![image-20231119210143026](../img/rookéƒ¨ç½²ceph/380a84c6e412e69d84beba5b6b7e47f3697559838.png)\n\n```\n- è¿›å…¥pod\nkubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- bash\n \n- æŸ¥çœ‹é›†ç¾¤çŠ¶æ€\nceph status\n```\n\n![image-20231119210339096](../img/rookéƒ¨ç½²ceph/5b4dd656122e2b64787fb30b8a20a97c697559838.png)\n\n#### é…ç½®å­˜å‚¨(StorageClass)\n\né…ç½®æ–‡ä»¶ï¼š`/root/rook/deploy/examples/csi/cephfs/storageclass.yaml`\n\n```\ncd /root/rook/deploy/examples/csi/cephfs\nkubectl apply -f storageclass.yaml\n```\n\n![image-20231119210625832](../img/rookéƒ¨ç½²ceph/19ede1d5988df074b7b8bd884ce5feb1697559838.png)\n\n#### å…±äº«æ–‡ä»¶å­˜å‚¨ä½¿ç”¨ç¤ºä¾‹\n\n```\ncat > nginx-deploy-cephfs.yaml << \"EOF\"\n \napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: nginx-deploy-cephfs\n  name: nginx-deploy-cephfs\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-deploy-cephfs\n  template:\n    metadata:\n      labels:\n        app: nginx-deploy-cephfs\n    spec:\n      containers:\n      - image: registry.cn-hangzhou.aliyuncs.com/qianyios/nginx:latest\n        name: nginx\n        volumeMounts:\n        - name: data\n          mountPath: /usr/share/nginx/html\n      volumes:\n      - name: data\n        persistentVolumeClaim:\n          claimName: nginx-cephfs-pvc\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nginx-cephfs-pvc\nspec:\n  storageClassName: \"rook-cephfs\"\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\nEOF\nkubectl apply -f nginx-deploy-cephfs.yaml\nkubectl get pod -o wide | grep cephfs\nkubectl exec -it nginx-deploy-cephfs-6dc8797866-4s564 bash\necho \"hello cephfs\" > /usr/share/nginx/html/index.html && exit\n\n#æµ‹è¯•å®Œåˆ é™¤ \nkubectl delete -f nginx-deploy-cephfs.yaml\n```\n\n![image-20231119215220294](../img/rookéƒ¨ç½²ceph/a6ab12847a41e35c1564805a5246d9af697559838.png)\n\n## åœ¨K8Sä¸­ç›´æ¥è°ƒç”¨å‡ºcephå‘½ä»¤\n\n```\n#å®‰è£…epelæº\nyum install epel-release -y\n\n#å®‰è£…cephä»“åº“\nyum install https://mirrors.aliyun.com/ceph/rpm-octopus/el7/noarch/ceph-release-1-1.el7.noarch.rpm -y\nyum list ceph-common  --showduplicates |sort -r\n\n#å®‰è£…cephå®¢æˆ·ç«¯\nyum install ceph-common -y\n```\n\nåŒæ­¥cephä¸­çš„è®¤è¯æ–‡ä»¶\n\n```\nkubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- bash\n\n[root@master1 ~]# kubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- bash\n\nbash-4.4$  cat /etc/ceph/ceph.conf\n[global]\nmon_host = 10.97.121.57:6789,10.104.235.210:6789,10.96.136.90:6789\n\n[client.admin]\nkeyring = /etc/ceph/keyring\n\nbash-4.4$ cat /etc/ceph/keyring\n[client.admin]\nkey = AQC241lltDbVKBAANrzwgqZd1A2eY+8h1A+BOg==\nbash-4.4$\n\n\næ³¨æ„è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¤åˆ¶å†…å®¹ä¹‹åexité€€å‡º\n\n```\n\n![image-20231119221441175](../img/rookéƒ¨ç½²ceph/226133fd1f73556b78ec0135527d2750697559838.png)\n\n```\n\nç›´æ¥åœ¨master1åˆ›å»ºè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼ˆè¿™é‡Œçš„master1æ˜¯æŒ‡æˆ‘è¦åœ¨master1å¯ä»¥è°ƒç”¨cephçš„å®¢æˆ·ç«¯ï¼‰\n\ncat > /etc/ceph/ceph.conf << \"EOF\"\n[global]\nmon_host = 10.97.121.57:6789,10.104.235.210:6789,10.96.136.90:6789\n\n[client.admin]\nkeyring = /etc/ceph/keyring\nEOF\n\ncat > /etc/ceph/keyring << \"EOF\"\n[client.admin]\nkey = AQC241lltDbVKBAANrzwgqZd1A2eY+8h1A+BOg==\nEOF\n```\n\nå½“ä½ æ·»åŠ å®Œä¹‹åç›´æ¥è°ƒç”¨cephçš„å‘½ä»¤\n\n![image-20231119221546943](../img/rookéƒ¨ç½²ceph/697b4f16bd1e1a5d7ec359d02c91ff73697559838.png)\n\n## åˆ é™¤pvcï¼ŒscåŠå¯¹åº”çš„å­˜å‚¨èµ„æº\n\n```\n- æŒ‰éœ€åˆ é™¤pvcã€pv\nkubectl get pvc -n [namespace] | awk '{print $1};' | xargs kubectl delete pvc -n [namespace]\nkubectl get pv | grep Released | awk '{print $1};' | xargs kubectl delete pv\n \n- åˆ é™¤å—å­˜å‚¨åŠSC\nkubectl delete -n rook-ceph cephblockpool replicapool\nkubectl delete storageclass rook-ceph-block\n\n```\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Ceph","K8s"],"categories":["äº‘åŸç”Ÿ"]},{"title":"Python-æ€»æ‰‹å†Œ","url":"/posts/28626/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Python-æ€»æ‰‹å†Œ\n\n1. [Pythonç¯å¢ƒå‡†å¤‡](#Pythonç¯å¢ƒå‡†å¤‡)\n2. [Pythonç¨‹åºæ‰‹å†Œ](#Pythonç¨‹åºæ‰‹å†Œ)\n\n# Pythonç¯å¢ƒå‡†å¤‡\n\n## Thonnyï¼ˆé¦–æ¨ï¼Œè‡ªç”¨ï¼ï¼ï¼‰\n\nThonny ç”±çˆ±æ²™å°¼äºšçš„ Tartu å¤§å­¦å¼€å‘ï¼Œå®ƒé‡‡ç”¨äº†ä¸åŒçš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒçš„è°ƒè¯•å™¨æ˜¯ä¸“ä¸ºå­¦ä¹ å’Œæ•™å­¦ç¼–ç¨‹è€Œè®¾è®¡çš„ã€‚\n\nè¯¥è½¯ä»¶åŸºäºpythonå†…ç½®å›¾å½¢åº“tkinterå¼€å‘ï¼Œä½“ç§¯å°å·§ï¼Œç•Œé¢ç›´è§‚ï¼Œæ”¯æŒè¯­æ³•ç€è‰²ã€ä»£ç è‡ªåŠ¨è¡¥å…¨ã€debugç­‰å¼ºåŠ²åŠŸèƒ½ï¼Œå¹¶å…·å¤‡äº†ä¸€ä¸ªå‹å¥½çš„IDEï¼Œä¸ºæ‚¨æä¾›äº†å‡ ä¸ªæœ‰ç”¨çš„å­¦ä¹ å·¥å…·ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ‰“åŒ…æˆä¸€ä¸ªç›´è§‚çš„GUIï¼Œèƒ½å¤Ÿè®©ä½ æ›´å¿«çš„ç†Ÿæ‚‰Pythonç¼–ç¨‹è¯­è¨€ã€‚åŒæ—¶ï¼Œthonnyå†…ç½®äº†Python3.7ï¼Œå› æ­¤åªéœ€è¦ä¸€ä¸ªç®€å•çš„å®‰è£…ç¨‹åºï¼Œæ‚¨å°±å¯ä»¥å­¦ä¹ ç¼–ç¨‹äº†ï¼Œå¯è°“ç§°çš„ä¸Šæ˜¯æœ€å¥½çš„è‡ªåŠ©æœåŠ¡æ•™å­¦å·¥å…·ã€‚\n\nå®˜ç½‘åœ°å€ï¼š[Thonnyï¼ŒPython IDEåˆå­¦è€…](https://thonny.org/)\n\n### è¿›å…¥å®˜ç½‘ä¸‹è½½\n\n![image-20230911213459655](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/c8099719e962a1986f0b3477afea6fcfbfe04452-1726156094788-20.png)\n\n\n\n![image-20230911213655489](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/6759a1f4d67e3298d0c193e35a60fd204188bfd8-1726156094788-21.png)\n\n\n\n### åŒå‡»è¿è¡Œ\n\n![image-20230911213731514](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/3693e61e00196c4b1793c6da94c58e8e8bfc6455-1726156094788-22.png)\n\n![image-20230911213742866](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/e80b8f094dcc85c7166f4501bbf7b800a7000005-1726156094788-23.png)\n\n### æ¥å—å®‰è£…åè®®ï¼Œå®‰è£…\n\n<font color='red'>è¯·é€‰æ‹©ä¸€ä¸ªä¸å¸¦ä¸­æ–‡çš„è·¯å¾„å­˜æ”¾ä»–</font>\n\nè¿™é‡Œçš„cç›˜ä»…åšæµ‹è¯•\n\n![image-20230911213952417](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/7c8b64d86fb9a2e895589168f52b199b46313408-1726156094788-24.png)\n\n### åˆ›å»ºæ¡Œé¢å›¾æ ‡\n\n![image-20230911213946121](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/a5c15b9f02c7fefbe07ffc0d9209be056fd79212-1726156094788-25.png)\n\n### é€‰æ‹©ä¸­æ–‡\n\n![image-20230911214016041](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ec46eaeb9444c467ebd7bd2c720a25927d4d8ea4-1726156094788-26.png)\n\n### å®‰è£…æˆåŠŸ\n\n![image-20230911214038572](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ccf69f4daeb9b05d21cd0bd9af7648651c37daf3-1726156094788-27.png)\n\n\n\n## Centos7éƒ¨ç½²Python\n\nåœ¨ CentOS 7.9 ä¸Šå®‰è£… Pythonï¼Œä½ å¯ä»¥ä½¿ç”¨ yum åŒ…ç®¡ç†å™¨å’Œ EPEL å­˜å‚¨åº“æ¥å®Œæˆã€‚ä»¥ä¸‹æ˜¯å®‰è£…çš„æ­¥éª¤ï¼š\n\n1. é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ç³»ç»Ÿå·²ç»å®‰è£…äº† EPEL å­˜å‚¨åº“ã€‚EPEL æ˜¯ä¸€ä¸ªé¢å¤–çš„è½¯ä»¶æºï¼Œæä¾›äº†è®¸å¤šé¢å¤–çš„è½¯ä»¶åŒ…ã€‚å¦‚æœä½ çš„ç³»ç»Ÿå°šæœªå®‰è£… EPEL å­˜å‚¨åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…å®ƒï¼š\n\n```\nsudo yum update -y\nsudo yum install epel-release\n```\n\n<font color='red'>è‡ªé€‰ç‰ˆæœ¬</font>\n\n2. å®‰è£… Python 3ï¼šCentOS 7 é»˜è®¤ä½¿ç”¨ Python 2.7ï¼Œä½†æ˜¯ä½ å¯ä»¥å®‰è£… Python 3ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… Python 3ï¼š\n\n```\nsudo yum install python3\n```\n\n3. å®‰è£… Python 2ï¼šå¦‚æœä½ è¿˜éœ€è¦å®‰è£… Python 2ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\n\n```\nsudo yum install python2\n```\n\n4. éªŒè¯å®‰è£…ï¼šå®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯ Python çš„å®‰è£…ï¼š\n\n```\npython3 --version\npython2 --version\n```\n\nè¿™äº›å‘½ä»¤å°†æ˜¾ç¤ºå®‰è£…çš„ Python ç‰ˆæœ¬å·ï¼Œç¡®è®¤å®‰è£…æˆåŠŸã€‚\n\n### ä½¿ç”¨python\n\n```\npython\n```\n\n## Pycham\n\nå®‰è£…æ•™ç¨‹ï¼š[PyCharm2024.1å®‰è£…æ•™ç¨‹ - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/cf6ce79f/)\n\nå®˜ç½‘åœ°å€[PyCharmï¼šJetBrainsä¸ºä¸“ä¸šå¼€å‘è€…æä¾›çš„Python IDE](https://www.jetbrains.com/zh-cn/pycharm/)\n\n\n\n# Pythonç¨‹åºæ‰‹å†Œ\n\n## Pythonç¨‹åºåŸºç¡€\n\n### åˆè¯†Pythonç¨‹åº\n\næ–°å»ºä¸€ä¸ªhello.py\n\n![image-20230911221032751](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/be107876f089bb105714edeb908e55abfcda36e7-1726156094788-28.png)â†’![image-20230911221044375](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/23da562133d5d5abda87fe9795d3c3ea1df500d9-1726156094789-29.png) \n\næ‰“å¼€è¾“å…¥ä»£ç â†’è¿è¡Œ\n\n![image-20230911220949326](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/f0141934281be1baa7c85c7518c754bd7c169225-1726156094789-30.png)\n\n```\n#æ ¼å¼\nprint(è¾“å‡ºé¡¹1,è¾“å‡ºé¡¹2,Â·Â·Â·Â·Â·Â·)\n```\n\næ¯ä¸ªè¾“å‡ºé¡¹å¯ä»¥æ˜¯æ•°å€¼ï¼Œå­—ç¬¦ä¸²ç­‰\n\n### Pythonç¨‹åºé£æ ¼\n\nä¸€ä¸ªç¨‹åºå¾€å¾€æœ‰è¾“å…¥è¾“å‡ºè¯­å¥ï¼Œè¿˜å¸¦æœ‰é€»è¾‘åˆ¤æ–­ï¼Œç°åœ¨ä»‹ç»ä¸€ä¸ªç¨‹åº\n\nä¾‹2.1 è¾“å…¥ä¸€ä¸ªæ•°ï¼Œè®¡ç®—å¹³æ–¹æ ¹\n\n```\nimport math\ns=input(\"è¯·è¾“å…¥ä¸€ä¸ªæ•°ï¼š\")\ns=float(s)\nif s>=0:\n    s=math.sqrt(s)\n    print(\"å¹³æ–¹æ ¹æ˜¯ï¼š\",s)\nelse:\n    print(\"è´Ÿæ•°ä¸æ˜¯å¹³æ–¹æ ¹\")\nprint(\"The End\")\n```\n\nåœ¨è¿™å¯ä»¥å¾ˆæ¸…æ™°çœ‹åˆ°pythonç¨‹åºçš„é£æ ¼ï¼Œä¸ä¼šåƒcè¯­è¨€ï¼Œéœ€è¦å…ˆå£°æ˜å˜é‡ç±»å‹ï¼Œæ‰å¯ä»¥ä½¿ç”¨\n\nå¦‚ï¼š\n\ncè¯­è¨€ï¼š(å¯ä»¥çœ‹è§æ²¡è¡Œè¯­å¥ï¼Œéœ€è¦ä¸€ä¸ª<font color='red'>åˆ†å·</font>)\n\n```\nint s\nprintf(\"è¯·è¾“å…¥ä¸€ä¸ªæ•°:\");\nscanf(\"%d\",&s);\n```\n\n> <font color='red'>åœ¨è¿™æ˜¾å¾—pythonæ›´åŠ ç®€å•å¿«æ·</font>\n\n![image-20230911222208194](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/3517eb301ba0893c47a45d706a69832457a8fb91-1726156094789-31.png)\n\n#### å¼€å§‹åˆ†è§£\n\n1. è¾“å…¥è¯­å¥\n\n```\ns=input(\"è¯·è¾“å…¥ä¸€ä¸ªæ•°ï¼š\")\n```\n\næ­¤æ—¶è¾“å…¥4ä¹‹åï¼Œä¼šå­˜å…¥åˆ°sï¼Œ<font color='red'>ä½†æ˜¯æ­¤æ—¶çš„sæ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œè¿˜ä¸æ˜¯æ•°å€¼ï¼Œä¸èƒ½è¿›è¡Œè®¡ç®—ï¼Œéœ€è¦è½¬æ¢ç±»å‹</font>\n\n2. è½¬åŒ–ç±»å‹\n\n```\ns=float(s)\n```\n\nåœ¨è¿™ï¼Œéœ€è¦å°†sï¼ˆå­—ç¬¦ä¸²ï¼‰è½¬åŒ–ä¸ºå®æ•°ï¼Œæ‰å¯ä»¥è®¡ç®—\n\n3. ç¼©è¿›\n\nè¦æ³¨æ„ç¼©è¿›é‡ï¼Œå¦åˆ™ä»£ç ä¼šä¸²è¡Œ\n\n![image-20230911223018053](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/19d939fc05daa6e3edbc5d6daacfe2655649fb3a-1726156094789-32.png)\n\n<font color='red'>å¦‚ï¼š</font>\n\n<font color='red'>é”™è¯¯ä»£ç ï¼š</font>\n\n![image-20230911223124209](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/774e6e9ba7c39b3e91bbf630cd75ecd8ff4b53ac-1726156094789-33.png)\n\næ­£ç¡®æ˜¾ç¤ºç»“æœï¼š\n\n![image-20230911223204576](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/c7d90cc45856724a926dec270e52bfb0b71df666-1726156094789-34.png)\n\né€šè¿‡ä¹‹å‰ä¿®æ”¹ä»£ç å˜æˆelseçš„è¯­å¥ä¹‹åï¼Œå°±æ²¡æ˜¾ç¤ºäº†ï¼Œ\n\n![image-20230911223230379](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/a2ba8b96b8ba4a661030846962909c1f29633d26-1726156094789-35.png)\n\nå¿…é¡»è¾“å…¥è´Ÿæ•°ä¹‹åæ‰æ˜¾ç¤ºå‡ºæ¥\n\n![image-20230911223314908](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/647fd0495ae122968576879b645ed79277f45d22-1726156094789-36.png)\n\næ‰€ä»¥è¦æ³¨æ„ç¼©è¿›é‡\n\n### Pythonæ³¨é‡Š\n\nåœ¨ Python ä¸­ï¼Œæ³¨é‡Šç”¨äºåœ¨ä»£ç ä¸­æ·»åŠ è§£é‡Šã€è¯´æ˜æˆ–æä¾›æ–‡æ¡£ã€‚Python æ”¯æŒä¸¤ç§ç±»å‹çš„æ³¨é‡Šï¼šå•è¡Œæ³¨é‡Šå’Œå¤šè¡Œæ³¨é‡Šã€‚\n\n1. å•è¡Œæ³¨é‡Šï¼šä»¥ `#` å¼€å¤´ï¼Œç”¨äºåœ¨ä¸€è¡Œä¸­æ·»åŠ æ³¨é‡Šã€‚\n\n```python\n# è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Š\n```\n\n2. å¤šè¡Œæ³¨é‡Šï¼šç”¨ä¸‰ä¸ªå•å¼•å· `'''` æˆ–ä¸‰ä¸ªåŒå¼•å· `\"\"\"` åŒ…å›´çš„å¤šè¡Œæ–‡æœ¬ï¼Œç”¨äºæ·»åŠ å¤šè¡Œæ³¨é‡Šã€‚\n\n```python\n'''\nè¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šã€‚\nå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å¤šè¡Œçš„è¯´æ˜ã€‚\n'''\n```\n\næˆ–è€…\n\n```python\n\"\"\"\nè¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šã€‚\nå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å¤šè¡Œçš„è¯´æ˜ã€‚\n\"\"\"\n```\n\næ³¨é‡Šæ˜¯éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å®ƒä»¬å¯ä»¥ç”¨äºè§£é‡Šä»£ç çš„ç›®çš„ã€ç®—æ³•ã€å‚æ•°ã€è¿”å›å€¼ç­‰ä¿¡æ¯ï¼Œä½¿å…¶ä»–äººæ›´å®¹æ˜“ç†è§£å’Œä½¿ç”¨ä½ çš„ä»£ç ã€‚\n\nè¯·æ³¨æ„ï¼Œæ³¨é‡Šä¸ä¼šè¢« Python è§£é‡Šå™¨æ‰§è¡Œï¼Œå®ƒä»¬åªæ˜¯ç”¨äºä»£ç çš„è§£é‡Šå’Œæ–‡æ¡£ç›®çš„ã€‚åœ¨è¿è¡Œç¨‹åºæ—¶ï¼Œæ³¨é‡Šéƒ¨åˆ†ä¼šè¢«å¿½ç•¥ã€‚\n\n### Pythonæ•°æ®ç±»å‹\n\n#### æ•°æ®ç±»å‹\n\n##### å¸¸é‡ï¼š\n\nPython ä¸­æœ‰è®¸å¤šå†…ç½®çš„æ•°æ®ç±»å‹ï¼Œç”¨äºå­˜å‚¨å’Œæ“ä½œä¸åŒç±»å‹çš„æ•°æ®ã€‚ä¸‹é¢æ˜¯ Python çš„ä¸€äº›å¸¸è§æ•°æ®ç±»å‹ï¼š\n\n1. æ•´æ•°ï¼ˆintï¼‰ï¼šç”¨äºè¡¨ç¤ºæ•´æ•°å€¼ï¼Œä¾‹å¦‚ `42`ã€`-10`ã€`0` ç­‰ã€‚\n2. æµ®ç‚¹æ•°ï¼ˆfloatï¼‰ï¼šç”¨äºè¡¨ç¤ºå¸¦æœ‰å°æ•°éƒ¨åˆ†çš„æ•°å€¼ï¼Œä¾‹å¦‚ `3.14`ã€`-0.5` ç­‰ã€‚\n3. å­—ç¬¦ä¸²ï¼ˆstrï¼‰ï¼šç”¨äºè¡¨ç¤ºæ–‡æœ¬æ•°æ®ï¼Œç”±ä¸€ç³»åˆ—å­—ç¬¦ç»„æˆï¼Œä¾‹å¦‚ `\"Hello, World!\"`ã€`'Python'` ç­‰ã€‚\n4. åˆ—è¡¨ï¼ˆlistï¼‰ï¼šç”¨äºå­˜å‚¨å¤šä¸ªæœ‰åºçš„å…ƒç´ ï¼Œå¯ä»¥åŒ…å«ä¸åŒç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚ `[1, 2, 3]`ã€`['apple', 'banana', 'cherry']` ç­‰ã€‚\n\n##### å˜é‡ï¼š\n\n1. å˜é‡å‘½åè§„åˆ™ï¼š\n\n- å˜é‡åç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆã€‚\n- å˜é‡åå¿…é¡»ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼Œä¸èƒ½ä»¥<font color='red'>æ•°å­—</font>å¼€å¤´ã€‚\n- å˜é‡ååŒºåˆ†å¤§å°å†™ï¼Œä¾‹å¦‚ `count` å’Œ `Count` æ˜¯ä¸åŒçš„å˜é‡åã€‚\n- é¿å…ä½¿ç”¨ Python çš„å…³é”®å­—ï¼ˆå¦‚ `if`ã€`for`ã€`while` ç­‰ï¼‰ä½œä¸ºå˜é‡åã€‚\n- å»ºè®®ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚\n\n2. å˜é‡èµ‹å€¼ï¼š\n\n- ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦ `=` å°†ä¸€ä¸ªå€¼èµ‹ç»™ä¸€ä¸ªå˜é‡ã€‚\n- å˜é‡åœ¨é¦–æ¬¡èµ‹å€¼æ—¶è¢«åˆ›å»ºï¼Œå¹¶æ ¹æ®èµ‹å€¼çš„å€¼ç¡®å®šå…¶æ•°æ®ç±»å‹ã€‚\n- å¯ä»¥å°†ä¸åŒç±»å‹çš„æ•°æ®èµ‹ç»™åŒä¸€ä¸ªå˜é‡ï¼Œå˜é‡çš„ç±»å‹ä¼šéšç€èµ‹å€¼è€Œæ”¹å˜ã€‚\n\n```python\nx = 42  # æ•´æ•°\ny = 3.14  # æµ®ç‚¹æ•°\nname = \"Alice\"  # å­—ç¬¦ä¸²\n```\n\n3. å˜é‡ä½¿ç”¨ï¼š\n\n- å¯ä»¥ä½¿ç”¨å˜é‡åæ¥è®¿é—®å­˜å‚¨åœ¨å˜é‡ä¸­çš„å€¼ã€‚\n- å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨å˜é‡ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ“ä½œã€‚\n- å˜é‡çš„å€¼å¯ä»¥éšæ—¶æ”¹å˜ï¼Œå¯ä»¥é‡æ–°èµ‹å€¼ç»™åŒä¸€ä¸ªå˜é‡ã€‚\n\n```python\nx = 10\ny = x + 5\nprint(y)  # è¾“å‡ºï¼š15\n\nx = 20\nprint(x)  # è¾“å‡ºï¼š20\n```\n\nå˜é‡åœ¨ Python ä¸­æ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»¬å…è®¸æˆ‘ä»¬å­˜å‚¨å’Œæ“ä½œæ•°æ®ã€‚é€šè¿‡åˆç†ä½¿ç”¨å˜é‡ï¼Œå¯ä»¥ä½¿ä»£ç æ›´çµæ´»ã€å¯è¯»æ€§æ›´å¥½ï¼Œå¹¶ä¸”å¯ä»¥å‡å°‘é‡å¤ä»£ç ã€‚\n\n#### æ•°æ®ç±»å‹çš„è½¬æ¢\n\n1.æ•°å€¼è½¬æ¢å­—ç¬¦ä¸²\n\n```\na=1\nb=1.2\nx=str(a)\ny=str(b)\n#æ­¤æ—¶ï¼Œè¦æ˜¯è¾“å‡ºï¼Œä»–ä»¬åœ¨ç³»ç»Ÿä¸­æ˜¯å¸¦å¼•å·çš„å­—ç¬¦ä¸²\n#  \"1\",\"1.2\"\n```\n\n2.å­—ç¬¦ä¸²è½¬æ¢æ•°å€¼\n\n```\na=\"1\"\nb=\"1.2\"\nx=int(a)\ny=float(b)  #å®æ•°ï¼ˆå¸¦å°æ•°ï¼‰\n#æ­¤æ—¶ï¼Œè¦æ˜¯è¾“å‡ºï¼Œä»–ä»¬åœ¨ç³»ç»Ÿä¸­æ˜¯æ•°å€¼\n#  1,1.2\n```\n\n<font color='red'>é”™è¯¯å½¢æ€ï¼š</font>\n\n```\ns=\"1a\"\na=int(s)\n```\n\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸² `\"1a\"` åŒ…å«äº†å­—æ¯ `\"a\"`ï¼Œå› æ­¤æ— æ³•å°†å…¶è½¬æ¢ä¸ºæ•´æ•°ã€‚å¦‚æœä½ æƒ³è¦å°†ä¸€ä¸ªåˆæ³•çš„æ•´æ•°å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼Œç¡®ä¿å­—ç¬¦ä¸²åªåŒ…å«æ•°å­—å­—ç¬¦ã€‚\n\n#### æ•´æ•°æ ¼å¼åŒ–è¾“å‡º\n\n1. ä½¿ç”¨ `format()` æ–¹æ³•æ ¼å¼åŒ–è¾“å‡ºæ•´æ•°çš„ç¤ºä¾‹ï¼š\n\n```python\nx = 10\ny = 20\nprint(\"x: {}, y: {}\".format(x, y))\n```\n\nè¾“å‡ºç»“æœä¸ºï¼š\n\n```\nx: 10, y: 20\n```\n\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `\"x: {}, y: {}\"` è¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºæ ¼å¼åŒ–æ¨¡æ¿ã€‚åœ¨æ¨¡æ¿ä¸­çš„ `{}` éƒ¨åˆ†ä¼šè¢« `format()` æ–¹æ³•ä¸­çš„å‚æ•°ä¾æ¬¡æ›¿æ¢ã€‚\n\n2. ä½¿ç”¨ f-stringã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ f-string æ ¼å¼åŒ–è¾“å‡ºæ•´æ•°çš„ç¤ºä¾‹ï¼š\n\n```python\nx = 10\ny = 20\nprint(f\"x: {x}, y: {y}\")\n```\n\nè¾“å‡ºç»“æœä¹Ÿæ˜¯ï¼š\n\n```\nx: 10, y: 20\n```\n\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨å­—ç¬¦ä¸²å‰é¢åŠ ä¸Šäº† `f`ï¼Œç„¶ååœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨èŠ±æ‹¬å· `{}` æ¥å¼•ç”¨å˜é‡ã€‚\n\n![image-20230911230031082](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/f624bcf9ec2c15c1f787856894b11bf23ece130d-1726156094789-37.png)\n\n3. ä½¿ç”¨ä½¿ç”¨ `%` ç¬¦å·è¿›è¡Œæ ¼å¼åŒ–è¾“å‡ºæ•´æ•°çš„ç¤ºä¾‹ï¼š\n\n```python\nx = 10\ny = 20\nprint(\"x: %d, y: %d\" % (x, y))\n```\n\nè¾“å‡ºç»“æœä¸ºï¼š\n\n```\nx: 10, y: 20\n```\n\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `\"x: %d, y: %d\"` è¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºæ ¼å¼åŒ–æ¨¡æ¿ã€‚`%d` æ˜¯æ•´æ•°çš„å ä½ç¬¦ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¦æ ¼å¼åŒ–çš„æ•´æ•°å€¼ `(x, y)` ä½œä¸ºå…ƒç»„ä¼ é€’ç»™ `%` è¿ç®—ç¬¦ã€‚\n\nä¾‹ï¼š1.4.3.1è¾“å‡ºå¹´æœˆæ—¥\n\n![image-20230911225550413](../img/Python-%E6%80%BB%E6%89%8B%E5%86%8C.assets/5c31f48eaab585c33f0ddd127b4e042f92ccf368-1726156094789-38.png)\n\n#### æµ®ç‚¹æ•°æ ¼å¼åŒ–è¾“å‡º\n\nä½¿ç”¨ `%` ç¬¦å·é…åˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥å®ç°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š\n\n```python\nnum = 3.14159\nprint(\"æµ®ç‚¹æ•°ï¼š%.2f\" % num)\n```\n\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`%.2f` æ˜¯æµ®ç‚¹æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚`%` ç¬¦å·åçš„ `.2f` è¡¨ç¤ºå°†æµ®ç‚¹æ•°ä¿ç•™ä¸¤ä½å°æ•°è¿›è¡Œè¾“å‡ºã€‚å¦‚æœè¦ä¿ç•™æ›´å¤šæˆ–æ›´å°‘çš„å°æ•°ä½æ•°ï¼Œåªéœ€ç›¸åº”åœ°è°ƒæ•´æ•°å­—å³å¯ã€‚\n\nè¾“å‡ºç»“æœä¸ºï¼š\n\n```\næµ®ç‚¹æ•°ï¼š3.14\n```\n\nè¿™æ ·å°±å®ç°äº†å°†æµ®ç‚¹æ•°æ ¼å¼åŒ–è¾“å‡ºå¹¶ä¿ç•™æŒ‡å®šå°æ•°ä½æ•°ã€‚\n\n### Pythonè¡¨è¾¾å¼\n\n| ç±»åˆ«       | è¿ç®—ç¬¦ | æè¿°                   | å®ä¾‹                                          |\n| ---------- | ------ | ---------------------- | --------------------------------------------- |\n| ç®—æœ¯è¿ç®—ç¬¦ | +      | åŠ æ³•                   | 2 + 3 = 5                                     |\n|            | -      | å‡æ³•                   | 5 - 2 = 3                                     |\n|            | *      | ä¹˜æ³•                   | 2 * 3 = 6                                     |\n|            | /      | é™¤æ³•                   | 6 / 2 = 3                                     |\n|            | %      | å–æ¨¡ï¼ˆå–ä½™æ•°ï¼‰         | 7 % 3 = 1                                     |\n|            | **     | å¹‚è¿ç®—                 | 2 ** 3 = 8                                    |\n|            | //     | æ•´é™¤ï¼ˆå–å•†çš„æ•´æ•°éƒ¨åˆ†ï¼‰ | 7 // 3 = 2                                    |\n| èµ‹å€¼è¿ç®—ç¬¦ | =      | èµ‹å€¼                   | x = 5                                         |\n|            | +=     | åŠ æ³•èµ‹å€¼               | x += 3 ï¼ˆç­‰ä»·äº x = x + 3ï¼‰                   |\n|            | -=     | å‡æ³•èµ‹å€¼               | x -= 2 ï¼ˆç­‰ä»·äº x = x - 2ï¼‰                   |\n|            | *=     | ä¹˜æ³•èµ‹å€¼               | x *= 2 ï¼ˆç­‰ä»·äº x = x * 2ï¼‰                   |\n|            | /=     | é™¤æ³•èµ‹å€¼               | x /= 4 ï¼ˆç­‰ä»·äº x = x / 4ï¼‰                   |\n|            | %=     | å–æ¨¡èµ‹å€¼               | x %= 3 ï¼ˆç­‰ä»·äº x = x % 3ï¼‰                   |\n| æ¯”è¾ƒè¿ç®—ç¬¦ | ==     | ç­‰äº                   | 3 == 3 ï¼ˆè¿”å› Trueï¼‰                          |\n|            | !=     | ä¸ç­‰äº                 | 2 != 3 ï¼ˆè¿”å› Trueï¼‰                          |\n|            | >      | å¤§äº                   | 5 > 2 ï¼ˆè¿”å› Trueï¼‰                           |\n|            | <      | å°äº                   | 2 < 5 ï¼ˆè¿”å› Trueï¼‰                           |\n|            | >=     | å¤§äºç­‰äº               | 5 >= 5 ï¼ˆè¿”å› Trueï¼‰                          |\n|            | <=     | å°äºç­‰äº               | 2 <= 5 ï¼ˆè¿”å› Trueï¼‰                          |\n| é€»è¾‘è¿ç®—ç¬¦ | and    | ä¸                     | True and False ï¼ˆè¿”å› Falseï¼‰ä¸¤è€…ä¸ºçœŸæ‰ä¸ºçœŸ   |\n|            | or     | æˆ–                     | True or False ï¼ˆè¿”å› Trueï¼‰ä¸€ä¸ªä¸ºçœŸå°±ä¸ºçœŸ     |\n|            | not    | é                     | not True ï¼ˆè¿”å› Falseï¼‰                       |\n| æˆå‘˜è¿ç®—ç¬¦ | in     | å­˜åœ¨äº                 | 2 in [1, 2, 3] ï¼ˆè¿”å› Trueï¼‰                  |\n|            | not in | ä¸å­˜åœ¨äº               | 4 not in [1, 2, 3] ï¼ˆè¿”å› Trueï¼‰              |\n| èº«ä»½è¿ç®—ç¬¦ | is     | æ˜¯                     | x is None ï¼ˆè¿”å› Trueï¼Œå¦‚æœ x ä¸º Noneï¼‰       |\n|            | is not | ä¸æ˜¯                   | x is not None ï¼ˆè¿”å› Trueï¼Œå¦‚æœ x ä¸ä¸º Noneï¼‰ |\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Python"],"categories":["ç¼–ç¨‹"]},{"title":"Ansible-æ€»æ‰‹å†Œ","url":"/posts/27532/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Ansible-æ€»æ‰‹å†Œ\n\n1. [Ansibleä¸‰æœºéƒ¨ç½²](#Ansibleä¸‰æœºéƒ¨ç½²)\n2. [Ansibleé…ç½®åŠç›¸å…³æŒ‡ä»¤](#Ansibleé…ç½®åŠç›¸å…³æŒ‡ä»¤)\n3. [ç”¨æˆ·çº§ansibleç¯å¢ƒæ„å»ºï¼ˆå°ç»ƒä¹ ï¼‰](#ç”¨æˆ·çº§ansibleç¯å¢ƒæ„å»º)\n4. [Ansible-å¸¸ç”¨æ¨¡å—](#Ansible-å¸¸ç”¨æ¨¡å—)\n5. [Ansible-playblock](#Ansible-Playbook)\n6. [Ansible-templates](#Ansible-templates)\n7. [Ansible-Roles](#Roles)\n8. [å®éªŒä»»åŠ¡ï¼šå®‰è£…httpdæœåŠ¡](#å®éªŒä»»åŠ¡ï¼šå®‰è£…httpdæœåŠ¡)\n\n# Ansibleä¸‰æœºéƒ¨ç½²\n\n## å…³äº\n\nã€€ansibleæ˜¯æ–°å‡ºç°çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼ŒåŸºäºPythonå¼€å‘ï¼Œé›†åˆäº†ä¼—å¤šè¿ç»´å·¥å…·ï¼ˆpuppetã€chefã€funcã€fabricï¼‰çš„ä¼˜ç‚¹ï¼Œå®ç°äº†æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ã€‚\nã€€ã€€ansibleæ˜¯åŸºäº paramiko å¼€å‘çš„,å¹¶ä¸”åŸºäºæ¨¡å—åŒ–å·¥ä½œï¼Œæœ¬èº«æ²¡æœ‰æ‰¹é‡éƒ¨ç½²çš„èƒ½åŠ›ã€‚çœŸæ­£å…·æœ‰æ‰¹é‡éƒ¨ç½²çš„æ˜¯ansibleæ‰€è¿è¡Œçš„æ¨¡å—ï¼Œansibleåªæ˜¯æä¾›ä¸€ç§æ¡†æ¶ã€‚ansibleä¸éœ€è¦åœ¨è¿œç¨‹ä¸»æœºä¸Šå®‰è£…client/agentsï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŸºäºsshæ¥å’Œè¿œ\nç¨‹ä¸»æœºé€šè®¯çš„ã€‚ansibleç›®å‰å·²ç»å·²ç»è¢«çº¢å¸½å®˜æ–¹æ”¶è´­ï¼Œæ˜¯è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¸­å¤§å®¶è®¤å¯åº¦æœ€é«˜çš„ï¼Œå¹¶ä¸”ä¸Šæ‰‹å®¹æ˜“ï¼Œå­¦ä¹ ç®€å•ã€‚æ˜¯æ¯ä½è¿ç»´å·¥ç¨‹å¸ˆå¿…é¡»æŒæ¡çš„æŠ€èƒ½ä¹‹ä¸€ã€‚\n\n## ä¸»æœºåˆ†å¸ƒ\n\n| ä¸»æœºå     | ip             | ç³»ç»Ÿ      | å†…å­˜ | ç¡¬ç›˜ |\n| ---------- | -------------- | --------- | ---- | ---- |\n| controller | 192.168.48.100 | Centos7.9 | 4G   | 100G |\n| node01     | 192.168.48.101 | Centos7.9 | 4G   | 100G |\n| node02     | 192.168.48.102 | Centos7.9 | 4G   | 100G |\n\n## ä¿®æ”¹ä¸»æœºå\n\n`controlle`\n\n```\nhostnamectl set-hostname controller && bash\n```\n\n`node01`\n\n```\nhostnamectl set-hostname node01 && bash\n```\n\n`node02`\n\n```\nhostnamectl set-hostname node02 && bash\n```\n\n`ä¸‰å°æœºåŠ å…¥hosts`\n\n```\ncat >> /etc/hosts << EOF\n192.168.48.100 controller\n192.168.48.101 node01\n192.168.48.102 node02\nEOF\n```\n\n## è®¾ç½®é˜¿é‡Œyum\n\n```\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\nwget -O /etc/yum.repos.d/CentOSBase.repo https://mirrors.aliyun.com/repo/Centos-7.repo\nyum clean all && yum makecache\nsystemctl disable firewalld --now\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\nyum update -y\n```\n\n## å®‰è£…python\n\n`å·²å®‰è£…å¯ä»¥å¿½ç•¥ã€‚`\n\n`ç¡®ä¿pythonç‰ˆæœ¬>=2.6`\n\n```\nsudo yum install epel-release\nsudo yum install https://centos7.iuscommunity.org/ius-release.rpm\nsudo yum install python27\n```\n\n```\n[root@controller ~]# python --version\nPython 2.7.5\n#æœ‰æ˜¾ç¤ºè¯´æ˜pythonå®‰è£…æˆåŠŸ\n```\n\n## å®‰è£…Ansible\n\n```\nsudo yum install epel-release ansible openssh\n\n[root@controller ~]# ansible --version\nansible 2.9.27\n  config file = /etc/ansible/ansible.cfg\n  configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']\n  ansible python module location = /usr/lib/python2.7/site-packages/ansible\n  executable location = /usr/bin/ansible\n  python version = 2.7.5 (default, Oct 14 2020, 14:45:30) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]\n\n```\n\n## æµ‹è¯•\n\n### æµ‹è¯•ä¸»æœºæ˜¯å¦å­˜æ´»\n\n```\nvim /etc/ansible/hosts\n\n#åœ¨æœ«å°¾æ·»åŠ ip\n192.168.48.101\n192.168.48.102\n-----------------------\n```\n\n```\nansible 192.168.48.101 -m ping -k\nansible 192.168.48.102 -m ping -k\n```\n\nå¦‚æœcontrolleræ²¡æœ‰é¦–æ¬¡è¿›è¡Œsshè‡³node01-02èŠ‚ç‚¹ï¼Œåˆ™ansibleä¼šå‡ºé”™ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![image-20230909230311692](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/d532cd4e257c3d44938697760ad2984a697559838-1726155218419-20.png)\n\n![image-20230909230328295](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/17b123269de38e723b5fadf4bb900190697559838-1726155218419-21.png)\n\næ‰€ä»¥æˆ‘ä»¬å¿…é¡»å…ˆsshè‡³å„èŠ‚ç‚¹ï¼Œè®©å…¶ç”Ÿæˆç¼“å­˜ä¿¡æ¯\n\n```\n[root@controller ~]# ssh 192.168.48.101\n##è¾“å…¥å¯†ç \n\n[root@node01 ~]# exit\n\n\n[root@controller ~]# ssh 192.168.48.102\n##è¾“å…¥å¯†ç \n\n[root@node02 ~]# exit\n```\n\nè¿™æ—¶æˆ‘ä»¬åœ¨è¿›è¡Œæµ‹è¯•\n\n![image-20230909230535153](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/8f2e0efd9625bb551134c558141fb934697559838-1726155218420-22.png)\n\n\n\n## SSHå…å¯†é…ç½®\n\n```\nssh-keygen   ï¼ˆä¸€è·¯å›è½¦ï¼Œä¸‰æ¬¡ï¼‰\n[root@controller ~]# ls -al ~/.ssh\ntotal 12\ndrwx------  2 root root   57 Sep  6 00:43 .\ndr-xr-x---. 8 root root  236 Sep  9 23:05 ..\n-rw-------  1 root root 1675 Sep  6 00:42 id_rsa\n-rw-r--r--  1 root root  397 Sep  6 00:42 id_rsa.pub\n-rw-r--r--  1 root root  352 Sep  6 00:35 known_hosts\n#æœ‰å¯†é’¥æ–‡ä»¶äº†\n\n#å°†å¯†é’¥æ–‡ä»¶å¤åˆ¶åˆ°node01-02èŠ‚ç‚¹ï¼Œå®ç°sshå…å¯†ç™»å…¥\n(å…ˆyes ç„¶åè¾“å…¥å¯†ç å³å¯)\nssh-copy-id root@192.168.48.101\n\nssh-copy-id root@192.168.48.102\n```\n\næœ€åæˆ‘ä»¬åœ¨è¿›è¡Œæµ‹è¯•\n\n![image-20230909231047461](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/83de0f2327321a1b510793c35eb218cb697559838-1726155218420-23.png)\n\n![image-20230909231103976](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/f7125008aaa709e1106fa073483995bc697559838-1726155218420-24.png)\n\n# Ansibleé…ç½®åŠç›¸å…³æŒ‡ä»¤\n\n## ansible ç¨‹åºç»“æ„\n\nå®‰è£…ç›®å½•å¦‚ä¸‹(yumå®‰è£…)ï¼š\nã€€ã€€é…ç½®æ–‡ä»¶ç›®å½•ï¼š/etc/ansible/\nã€€ã€€æ‰§è¡Œæ–‡ä»¶ç›®å½•ï¼š/usr/bin/\nã€€ã€€Libåº“ä¾èµ–ç›®å½•ï¼š/usr/lib/pythonX.X/site-packages/ansible/\nã€€ã€€Helpæ–‡æ¡£ç›®å½•ï¼š/usr/share/doc/ansible-X.X.X/\nã€€ã€€Manæ–‡æ¡£ç›®å½•ï¼š/usr/share/man/man1/\n\n## ansibleé…ç½®æ–‡ä»¶æŸ¥æ‰¾é¡ºåº\n\nansibleä¸æˆ‘ä»¬å…¶ä»–çš„æœåŠ¡åœ¨è¿™ä¸€ç‚¹ä¸Šæœ‰å¾ˆå¤§ä¸åŒï¼Œè¿™é‡Œçš„é…ç½®æ–‡ä»¶æŸ¥æ‰¾æ˜¯ä»å¤šä¸ªåœ°æ–¹æ‰¾çš„ï¼Œé¡ºåºå¦‚ä¸‹ï¼š\n\n1. æ£€æŸ¥ç¯å¢ƒå˜é‡`ANSIBLE_CONFIG`æŒ‡å‘çš„è·¯å¾„æ–‡ä»¶\n   (export ANSIBLE_CONFIG=/etc/ansible.cfg)ï¼›\n\n2. `~/.ansible.cfg`ï¼Œæ£€æŸ¥å½“å‰ç›®å½•ä¸‹çš„ansible.cfgé…ç½®æ–‡ä»¶ï¼›\n\n3. `/etc/ansible.cfg`æ£€æŸ¥etcç›®å½•çš„é…ç½®æ–‡ä»¶ã€‚\n\n## ansibleé…ç½®æ–‡ä»¶\n\nã€€ansible çš„é…ç½®æ–‡ä»¶ä¸º`/etc/ansible/ansible.cfg`ï¼Œansible æœ‰è®¸å¤šå‚æ•°ï¼Œä¸‹é¢æˆ‘ä»¬åˆ—å‡ºä¸€äº›å¸¸è§çš„å‚æ•°ï¼š\n\n```\n[defaults]\n \n#inventory      = /etc/ansible/hosts   //å®šä¹‰Inventory\n#library        = /usr/share/my_modules/  //è‡ªå®šä¹‰libåº“å­˜æ”¾ç›®å½• \n#remote_tmp     = ~/.ansible/tmp       //é›¶æ—¶æ–‡ä»¶è¿œç¨‹ä¸»æœºå­˜æ”¾ç›®å½•\n#local_tmp      = ~/.ansible/tmp       //é›¶æ—¶æ–‡ä»¶æœ¬åœ°å­˜æ”¾ç›®å½•\n#forks          = 5                    //é»˜è®¤å¼€å¯çš„å¹¶å‘æ•°\n#poll_interval  = 15                   //é»˜è®¤è½®è¯¢æ—¶é—´é—´éš”\n#sudo_user      = root                 //é»˜è®¤sudoç”¨æˆ·\n#ask_sudo_pass = True                  //æ˜¯å¦éœ€è¦sudoå¯†ç \n#ask_pass      = True                  //æ˜¯å¦éœ€è¦å¯†ç \n#host_key_checking = False             //é¦–æ¬¡è¿æ¥æ˜¯å¦æ£€æŸ¥keyè®¤è¯\n#roles_path    = /etc/ansible/roles    //é»˜è®¤ä¸‹è½½çš„Roleså­˜æ”¾çš„ç›®å½•\n#log_path = /var/log/ansible.log       //æ‰§è¡Œæ—¥å¿—å­˜æ”¾ç›®å½•\n#module_name = command                 //é»˜è®¤æ‰§è¡Œçš„æ¨¡å—\n#action_plugins     = /usr/share/ansible/plugins/action //actionæ’ä»¶å­˜æ”¾ç›®å½•\n#callback_plugins   = /usr/share/ansible/plugins/callback //callbackæ’ä»¶å­˜æ”¾ç›®å½•\n#connection_plugins = /usr/share/ansible/plugins/connection  //connectionæ’ä»¶å­˜æ”¾ç›®å½•\n#lookup_plugins     = /usr/share/ansible/plugins/lookup //lookupæ’ä»¶å­˜æ”¾ç›®å½•\n#vars_plugins       = /usr/share/ansible/plugins/vars //varsæ’ä»¶å­˜æ”¾ç›®å½•\n#filter_plugins     = /usr/share/ansible/plugins/filter //filteræ’ä»¶å­˜æ”¾ç›®å½•\n#test_plugins       = /usr/share/ansible/plugins/test //testæ’ä»¶å­˜æ”¾ç›®å½•\n#strategy_plugins   = /usr/share/ansible/plugins/strategy //strategyæ’ä»¶å­˜æ”¾ç›®å½•\n#fact_caching = memory                 //getfactç¼“å­˜çš„ä¸»æœºä¿¡æ¯å­˜æ”¾æ–¹å¼\n#retry_files_enabled = False              \n#retry_files_save_path = ~/.ansible-retry  //é”™è¯¯é‡å¯æ–‡ä»¶å­˜æ”¾ç›®å½•\n```\n\n### é…ç½®æ–‡ä»¶çš„åˆ†ç±»ä¸ä¼˜å…ˆçº§\n\nAnsibleåªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ansible.cfgï¼Œä½†é…ç½®æ–‡ä»¶å¯ä»¥å­˜åœ¨ä¸åŒçš„ä½ç½®ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªå¯ç”¨ (æ•°å­—ä»£è¡¨ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä»£è¡¨ä¼˜å…ˆçº§è¶Šé«˜) :\n\n![image-20230912232830688](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/bf211db73aea2394ac38fa2bb217ca34697559838.png)\n\n### é…ç½®æ–‡ä»¶é€‰é¡¹\n\n![image-20230912232950364](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/3ddb17ad5a833513f53be5cf483f51a5697559838.png)\n\n![image-20230912233003740](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/c4e994cdce2311a90a1f20272421ff40697559838.png)\n\n![image-20230912233019308](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/6ce1bdfe949bd22740329bf08f66d443697559838.png)\n\nå®˜ç½‘é…ç½®å‚è€ƒç½‘å€\n\n[Ansible Configuration Settings â€” Ansible Documentation](https://docs.ansible.com/ansible/2.9/reference_appendices/config.html)\n\n![image-20230912233124916](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/aadcbffa6a3f0cd1d2da9f4ee3a9d950697559838.png)\n\n## ansubleä¸»æœºæ¸…å•\n\n```\n1ã€ å®šä¹‰å•ç‹¬ä¸»æœºï¼š\n\t## green.example.com#\n\t# blue.example.com#\n\t# 192.168.100.1\n\t# 192.168.100.10\n2ã€ å®šä¹‰ä¸€ä¸ªä¸»æœºç»„[ç»„å]æŠŠåœ°å€æˆ–ä¸»æœºååŠ è¿›å»\n\t[mysql_test]\n\t192.168.253.159\n\t192.168.253.160\n\t192.168.253.153\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„`ç»„æˆå‘˜å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…`ï¼Œè¿™æ ·å¯¹äºä¸€äº›æ ‡å‡†åŒ–çš„ç®¡ç†æ¥è¯´å°±å¾ˆè½»æ¾æ–¹ä¾¿äº†ã€‚\nã€€ã€€æˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ¥é…ç½®æˆ‘ä»¬çš„ä¸»æœºåˆ—è¡¨ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š\n\n```\n[root@server ~]# vim /etc/ansible/hosts\n\t[web]\n\t192.168.37.122\n\t192.168.37.133\n```\n\n```\n3ã€ å®šä¹‰åµŒå¥—ç»„\n    [web-mysql]\n       mysql_test\n       web\n4ã€ å®šä¹‰èŒƒå›´åŒ–ip\n    172.16.[0:4].[2:254]  \n```\n\n\n\n## ansible å¸¸ç”¨å‘½ä»¤\n\n> `/usr/bin/ansible`ã€€ã€€Ansibe AD-Hoc ä¸´æ—¶å‘½ä»¤æ‰§è¡Œå·¥å…·ï¼Œå¸¸ç”¨äºä¸´æ—¶å‘½ä»¤çš„æ‰§è¡Œ\n> `/usr/bin/ansible-doc` ã€€Ansible æ¨¡å—åŠŸèƒ½æŸ¥çœ‹å·¥å…·\n> `/usr/bin/ansible-galaxy`ã€€ã€€ä¸‹è½½/ä¸Šä¼ ä¼˜ç§€ä»£ç æˆ–Rolesæ¨¡å— çš„å®˜ç½‘å¹³å°ï¼ŒåŸºäºç½‘ç»œçš„\n> `/usr/bin/ansible-playbook`ã€€ã€€Ansible å®šåˆ¶è‡ªåŠ¨åŒ–çš„ä»»åŠ¡é›†ç¼–æ’å·¥å…·\n> `/usr/bin/ansible-pull`ã€€ã€€Ansibleè¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„å·¥å…·ï¼Œæ‹‰å–é…ç½®è€Œéæ¨é€é…ç½®ï¼ˆä½¿ç”¨è¾ƒå°‘ï¼Œæµ·é‡æœºå™¨æ—¶ä½¿ç”¨ï¼Œå¯¹è¿ç»´çš„æ¶æ„èƒ½åŠ›è¦æ±‚è¾ƒé«˜ï¼‰\n> `/usr/bin/ansible-vault`ã€€ã€€Ansible æ–‡ä»¶åŠ å¯†å·¥å…·\n> `/usr/bin/ansible-console`ã€€ã€€AnsibleåŸºäºLinux Consobleç•Œé¢å¯ä¸ç”¨æˆ·äº¤äº’çš„å‘½ä»¤æ‰§è¡Œå·¥å…·\n\nã€€ã€€å…¶ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯`/usr/bin/ansible`å’Œ`/usr/bin/ansible-playbook`ã€‚\n\n### ansible å‘½ä»¤è¯¦è§£\n\nå‘½ä»¤çš„å…·ä½“æ ¼å¼å¦‚ä¸‹ï¼š\n\n```css\nansible <host-pattern> [-f forks] [-m module_name] [-a args]\n```\n\nã€€ã€€ä¹Ÿå¯ä»¥é€šè¿‡`ansible -h`æ¥æŸ¥çœ‹å¸®åŠ©ï¼Œä¸‹é¢æˆ‘ä»¬åˆ—å‡ºä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„é€‰é¡¹ï¼Œå¹¶è§£é‡Šå…¶å«ä¹‰ï¼š\n\n> `-a MODULE_ARGS`ã€€ã€€ã€€#æ¨¡å—çš„å‚æ•°ï¼Œå¦‚æœæ‰§è¡Œé»˜è®¤COMMANDçš„æ¨¡å—ï¼Œå³æ˜¯å‘½ä»¤å‚æ•°ï¼Œå¦‚ï¼š â€œdateâ€ï¼Œâ€œpwdâ€ç­‰ç­‰\n> `-k`ï¼Œ`--ask-pass` #ask for SSH passwordã€‚ç™»å½•å¯†ç ï¼Œæç¤ºè¾“å…¥SSHå¯†ç è€Œä¸æ˜¯å‡è®¾åŸºäºå¯†é’¥çš„éªŒè¯\n> `--ask-su-pass` #ask for su passwordã€‚suåˆ‡æ¢å¯†ç \n> `-K`ï¼Œ`--ask-sudo-pass` #ask for sudo passwordã€‚æç¤ºå¯†ç ä½¿ç”¨sudoï¼Œsudoè¡¨ç¤ºææƒæ“ä½œ\n> `--ask-vault-pass` #ask for vault passwordã€‚å‡è®¾æˆ‘ä»¬è®¾å®šäº†åŠ å¯†çš„å¯†ç ï¼Œåˆ™ç”¨è¯¥é€‰é¡¹è¿›è¡Œè®¿é—®\n> `-B SECONDS` #åå°è¿è¡Œè¶…æ—¶æ—¶é—´\n> `-C` #æ¨¡æ‹Ÿè¿è¡Œç¯å¢ƒå¹¶è¿›è¡Œé¢„è¿è¡Œï¼Œå¯ä»¥è¿›è¡ŒæŸ¥é”™æµ‹è¯•\n> `-c CONNECTION` #è¿æ¥ç±»å‹ä½¿ç”¨\n> `-f FORKS` #å¹¶è¡Œä»»åŠ¡æ•°ï¼Œé»˜è®¤ä¸º5\n> `-i INVENTORY` #æŒ‡å®šä¸»æœºæ¸…å•çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º`/etc/ansible/hosts`\n> `--list-hosts` #æŸ¥çœ‹æœ‰å“ªäº›ä¸»æœºç»„\n> `-m MODULE_NAME` #æ‰§è¡Œæ¨¡å—çš„åå­—ï¼Œé»˜è®¤ä½¿ç”¨ command æ¨¡å—ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åªæ‰§è¡Œå•ä¸€å‘½ä»¤å¯ä»¥ä¸ç”¨ -må‚æ•°\n> `-o` #å‹ç¼©è¾“å‡ºï¼Œå°è¯•å°†æ‰€æœ‰ç»“æœåœ¨ä¸€è¡Œè¾“å‡ºï¼Œä¸€èˆ¬é’ˆå¯¹æ”¶é›†å·¥å…·ä½¿ç”¨\n> `-S` #ç”¨ su å‘½ä»¤\n> `-R SU_USER` #æŒ‡å®š su çš„ç”¨æˆ·ï¼Œé»˜è®¤ä¸º root ç”¨æˆ·\n> `-s` #ç”¨ sudo å‘½ä»¤\n> `-U SUDO_USER` #æŒ‡å®š sudo åˆ°å“ªä¸ªç”¨æˆ·ï¼Œé»˜è®¤ä¸º root ç”¨æˆ·\n> `-T TIMEOUT` #æŒ‡å®š ssh é»˜è®¤è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º10sï¼Œä¹Ÿå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹\n> `-u REMOTE_USER` #è¿œç¨‹ç”¨æˆ·ï¼Œé»˜è®¤ä¸º root ç”¨æˆ·\n> `-v` #æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒæ—¶æ”¯æŒ`-vvv`ï¼Œ`-vvvv`å¯æŸ¥çœ‹æ›´è¯¦ç»†ä¿¡æ¯\n\n## ansible é…ç½®å…¬ç§é’¥\n\nã€€ã€€ä¸Šé¢æˆ‘ä»¬å·²ç»æåˆ°è¿‡ ansible æ˜¯åŸºäº ssh åè®®å®ç°çš„ï¼Œæ‰€ä»¥å…¶é…ç½®å…¬ç§é’¥çš„æ–¹å¼ä¸ ssh åè®®çš„æ–¹å¼ç›¸åŒï¼Œå…·ä½“æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n\n```csharp\n#1.ç”Ÿæˆç§é’¥\n[root@server ~]# ssh-keygen \n#2.å‘ä¸»æœºåˆ†å‘ç§é’¥\n[root@server ~]# ssh-copy-id root@192.168.48.101\n[root@server ~]# ssh-copy-id root@192.168.48.102\n```\n\n`192.168.48.101ä¸ºnode01çš„ipåœ°å€`\n\nè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°æ— å¯†ç ç™»å½•ï¼Œæˆ‘ä»¬çš„å®éªŒè¿‡ç¨‹ä¹Ÿä¼šé¡ºç•…å¾ˆå¤šã€‚\nã€€ã€€æ³¨æ„ï¼Œå¦‚æœå‡ºç°äº†ä¸€ä¸‹æŠ¥é”™ï¼š\n\n```dockerfile\n-bash: ssh-copy-id: command not found\n```\n\nã€€ã€€é‚£ä¹ˆå°±è¯æ˜æˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªåŒ…ï¼š\n\n```markdown\nyum -y install openssh\n```\n\nã€€ã€€æŠŠåŒ…å®‰è£…ä¸Šå³å¯ã€‚\n\næ³¨æ„ï¼šå…ˆssh 192.168.48.101å’Œssh 192.168.48.102å„èŠ‚ç‚¹ï¼Œç”Ÿæˆç¼“å­˜ä¿¡æ¯ï¼Œæ‰èƒ½è¿›è¡Œ`ä¸»æœºè¿é€šæ€§æµ‹è¯•`\n\n## ansible pingæ¨¡å—\n\n### ä¸»æœºè¿é€šæ€§æµ‹è¯•\n\nã€€ã€€æˆ‘ä»¬ä½¿ç”¨`ansible web -m ping`å‘½ä»¤æ¥è¿›è¡Œä¸»æœºè¿é€šæ€§æµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n\n```ruby\n[root@server ~]# ansible web -m ping\n192.168.48.101 | SUCCESS => {\n    \"changed\": false, \n    \"ping\": \"pong\"\n}\n192.168.48.102 | SUCCESS => {\n    \"changed\": false, \n    \"ping\": \"pong\"\n}\n```\n\nã€€ã€€è¿™æ ·å°±è¯´æ˜æˆ‘ä»¬çš„ä¸»æœºæ˜¯è¿é€šçŠ¶æ€çš„ã€‚æ¥ä¸‹æ¥çš„æ“ä½œæ‰å¯ä»¥æ­£å¸¸è¿›è¡Œã€‚\n\n# ç”¨æˆ·çº§ansibleç¯å¢ƒæ„å»º\n\n## ä¸»æœºåˆ†å¸ƒ\n\n| ä¸»æœºå     | ip             | ç³»ç»Ÿ      | å†…å­˜ | ç¡¬ç›˜ |\n| ---------- | -------------- | --------- | ---- | ---- |\n| controller | 192.168.48.100 | Centos7.9 | 4G   | 100G |\n| node01     | 192.168.48.101 | Centos7.9 | 4G   | 100G |\n| node02     | 192.168.48.102 | Centos7.9 | 4G   | 100G |\n\n## åˆ›å»ºstudentç”¨æˆ·\n\n<font color='red'>ä¸‰å°æœºåˆ›å»ºstudentç”¨æˆ·</font>\n\n```\n#åˆ›å»ºstudentç”¨æˆ·\nuseradd student\npasswd student\n123456\n```\n\n## controlleråˆ›å»ºstudentç”¨æˆ·å·¥ä½œç›®å½•\n\n```\n#åˆ‡æ¢studentç”¨æˆ·ï¼Œåˆ›å»ºå·¥ä½œç›®å½•ï¼Œæ–°å»ºansible.cfgé…ç½®æ–‡ä»¶ï¼ŒéªŒè¯é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚\nsu student\ncd \n#åˆ›å»ºèµ„äº§æ¸…å• \nmkdir ansible\ncat >> /home/student/ansible/inventory <<EOF\n[servers]\n192.168.48.101\n192.168.48.102\nEOF\n```\n\n## controllerç¼–è¾‘é…ç½®æ–‡ä»¶ansible.cfg\n\n```\ncd ansible\ncat >> /home/student/ansible/ansible.cfg <<EOF\n[defaults]\ninventory=/home/student/ansible/inventory\nremote_port=22\nremote_user=root\n#æŒ‡å®šè¿œç¨‹ç”¨æˆ·ä¸ºroot\nask_pass=True\nEOF\n```\n\n## éªŒè¯æ¸…å•ä¸»æœºå­˜æ´»ï¼ˆæŒ‡å®šrootï¼‰\n\néªŒè¯æ¸…å•ä¸»æœºå­˜æ´» ,æ‰§è¡Œå‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ¯æ¬¡æ‰§è¡Œansibleæ—¶éƒ½ä¼šè¯¢é—®è¿æ¥ç”¨æˆ·çš„å¯†ç ï¼ˆç›¸ å½“äº-Kå‚æ•°ï¼‰\n\n```\nansible all --list\n\n[student@controller ansible]$ ansible all --list\nSSH password:\n  hosts (2):\n    192.168.48.101\n    192.168.48.102\n[student@controller ansible]$\n#æˆåŠŸ\n```\n\nå¦‚æœä¸æƒ³è¾“å…¥å¯†ç ï¼Œé‚£éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š\n\n```\nvi /home/student/ansible/ansible.cfg\nÂ·Â·Â·Â·Â·Â·\nask_pass=False\n```\n\n![image-20230912224807001](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/e1d902512d1ed9c395ad0dc927a3211e04e28fba-1726155218420-25.png)\n\n```\n[student@controller ansible]$ ansible all --list\n  hosts (2):\n    192.168.48.101\n    192.168.48.102\n[student@controller ansible]$\n#æ— è¾“å…¥å¯†ç é€‰é¡¹\n```\n\n## å®ä¾‹ï¼ˆæŒ‡å®šstudentï¼‰\n\n<font color='red'>è¿œç¨‹ç”¨æˆ·æŒ‡å®šä¸ºæ™®é€šç”¨æˆ·ï¼ˆstudentï¼‰</font>\n\n```\n[student@controller ansible]$ vim ansible.cfg\n[defaults]\ninventory=/home/student/ansible/inventory\nremote_port=22\nremote_user=student\n#æŒ‡å®šè¿œç¨‹ç”¨æˆ·ä¸ºstudent\nask_pass=False\n```\n\nè¿™æ—¶å€™æ‰§è¡Œpingä¼šæŠ¥é”™\n\n```\nansible all -m ping\n```\n\n![image-20230912225310702](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/36030bdebb9cbe2cb9cf85a57f527991fc70eba3-1726155218420-26.png)\n\n![image-20230912225331509](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/093cb2bedadf9dacdf83186c216de62efbbea1bb-1726155218420-27.png)\n\nè¿™æ—¶å€™æˆ‘ä»¬è¦é…ç½®å…å¯†ç™»å…¥ï¼ˆè¿™é‡Œçš„å¯†é’¥æ˜¯studentç”¨æˆ·çš„ï¼Œå’Œrootä¸ä¸€æ ·ï¼Œä¸ä¼šè¦†ç›–rootç”¨æˆ·çš„ï¼Œè¿™æ˜¯åœ¨studentç”¨æˆ·ä¸‹æ‰§è¡Œçš„å‘½ä»¤ï¼‰\n\n```\n[student@controller ansible]$ ssh-keygen\n#å›è½¦ä¸‰æ¬¡\n[student@controller ansible]$ ssh-copy-id student@192.168.48.101\n#è¾“å…¥yeså’Œnode1çš„rootå¯†ç \n\n[student@controller ansible]$ ssh-copy-id student@192.168.48.102\n#è¾“å…¥yeså’Œnode2çš„rootå¯†ç \n```\n\nè¿™æ˜¯æ‰§è¡Œpingå‘½ä»¤\n\n```\n ansible all -m ping\n```\n\n![image-20230912230245638](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/fbfb0421bf54c003e1a9cc2e28ffd60fea8755cf-1726155218420-28.png)\n\n## æµ‹è¯•æå–æ–‡ä»¶\n\nè¿™ä¸ªæ™®é€šç”¨æˆ·ï¼ˆstudentï¼‰å¹¶ä¸èƒ½æ‰§è¡Œæ‰€æœ‰çš„æ“ä½œï¼Œæ¯”å¦‚ansibleä»¥studentèº«ä»½ç™»å½•ï¼Œæ‰§è¡Œï¼ˆls /rootï¼‰å‘æ™®é€šç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œ\n\n```\nansible all -m shell -a \"ls /root\"\n```\n\n![image-20230912230504092](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/dcc6b723a386323cf562bade58b2cf2a8957be6f-1726155218420-29.png)\n\nè§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ææƒï¼šsudo ææƒ\n\nåœ¨å—æ§ä¸»æœº(<font color='red'>node01ã€node02</font>)ä¸Šæ‰§è¡Œvisudoï¼ˆé…ç½® /etc/sudoersï¼‰\n\n<font color='red'>node01æœºå­</font>\n\n```\n[root@node01 ~]# visudo\n```\n\n![image-20230912230747742](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/91e2a38e7ef071a3cb51f5b89dc133df750e339c-1726155218420-30.png)\n\n<font color='red'>node02æœºå­</font>\n\n```\n[root@node02 ~]# visudo\n```\n\n![image-20230912230906568](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/645d2da0ea2f30c86fe3f4719053de461825fd10-1726155218420-31.png)\n\næˆ–è€…(<font color='red'>node01å’Œnode02æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤</font>)\n\n```\ncat >>/etc/sudoers.d/student << EOF \nstudent          ALL=(ALL)        NOPASSWD: ALL\nEOF\n```\n\nåœ¨<font color='red'>æ§åˆ¶ä¸»æœºï¼ˆcontrollerï¼‰</font>ä¸Š(<font color='red'>studentç”¨æˆ·</font>)ä¿®æ”¹ansible.cfgé…ç½®æ–‡ä»¶ææƒ\n\n```\n[student@controller ansible]$ vim ansible.cfg\n[defaults]\ninventory=/home/student/ansible/inventory\nremote_port=22\nremote_user=student\nask_pass=False\n[privilege_escalation]\nbecome=True\nbecome_method=sudo\nbecome_user=root\nbecome_ask_pass=False\n```\n\n![image-20230912231556770](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/0575ae46b3b79b6f7beffd757fd79427cee52b0e-1726155218420-32.png)\n\néªŒè¯\n\n```\nansible all -m shell -a \"ls /root\"\n```\n\n![image-20230912231635877](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/5e66812c14fd8690a9025e8436b5d6d3edd08ccf-1726155218420-33.png)\n\n<font color='red'>#åœ¨æ§åˆ¶èŠ‚ç‚¹çš„studentç»è¿‡sudoææƒä¹‹åå¯ä»¥è¯»å–/rootç›®å½•äº†</font>\n\n# Ansible-å¸¸ç”¨æ¨¡å—\n\n## commandæ¨¡å—\n\nlinuxå‘½ä»¤ï¼Œä¸æ”¯æŒç®¡é“ã€é‡å®šå‘ç­‰ï¼Œä¸å»ºè®®ä½¿ç”¨\n\n```\nansible all -m command -a \"pwd\"\nansible all -m command -a \"ls\"\nansible all -m command -a \"cat /etc/passwd |grep student\" #è¿™ä¸ªä¸èƒ½æ­£å¸¸ä½¿ç”¨ ansible all -m command -a \"echo bb >>/tmp/testansible\"\nansible all -m command -a \"cat /tmp/testansible\"\n```\n\n#é‡å®šå‘ä¹Ÿæ— æ³•æ­£å¸¸ä½¿ç”¨\n\nè¯¾å ‚ç»ƒä¹ ï¼š\n\nä½¿ç”¨commandå‘½ä»¤æŸ¥è¯¢å„ä¸»æœºç£ç›˜çŠ¶æ€ã€æŸ¥è¯¢å†…å­˜çŠ¶æ€\n\n```\nansible all -m command -a \"df -h\"\nansible all -m command -a \"free -m\"\n```\n\n## shellæ¨¡å—\n\næ”¯æŒç®¡é“ã€é‡å®šå‘ç­‰ï¼Œå¸¸ç”¨æ¨¡å—\n\n```\nansible all -m shell -a \"cat /etc/passwd | grep student\" #æ”¯æŒç®¡é“\nansible all -m shell -a \"echo bb >>/tmp/testansible\"\nansible all -m shell -a \"cat /tmp/testansible\"\n```\n\n\\#æ”¯æŒé‡å®šå‘\n\nè¯¾å ‚ç»ƒä¹ ï¼š\n\nä½¿ç”¨shellæ¨¡å—æŸ¥çœ‹selinuxçŠ¶æ€\n\n```\nansible all -m shell -a \"getenforce\"\n```\n\né€šè¿‡shellæ¨¡å—æ‰¹é‡å…³é—­selinux\n\n```\nä¸´æ—¶å…³é—­ï¼š\n\nansible all -m shell -a \"setenforce 0\"\n\næ°¸ä¹…å…³é—­ï¼š\n\nansible all -m shell -a \"sed -ri 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\"\n\nansible all -m shell -a \"reboot\"\n\n```\n\n## æ–‡ä»¶æ¨¡å—\n\n###  copyæ¨¡å—\n\nä»ä¸»æ§ç«¯å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœº\n\n```\nansible-doc copy\n```\n\n<font color='red'>å¸¸ç”¨å‚æ•°</font>\n\n<font color='red'>src</font>ï¼šsourceæºè·¯å¾„æ–‡ä»¶/ç›®å½•ã€‚å³è¦å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶åœ¨æœ¬åœ°çš„åœ°å€ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå®ƒå°†é€’å½’å¤åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<font color='red'>å¦‚æœè·¯å¾„ä½¿ç”¨\"/\"æ¥ç»“å°¾ï¼Œåˆ™åªå¤åˆ¶ç›®å½•é‡Œçš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨\"/\"æ¥ç»“å°¾ï¼Œåˆ™åŒ…å«ç›®å½•åœ¨å†…çš„æ•´ä¸ªå†…å®¹å…¨éƒ¨å¤åˆ¶ã€‚</font>\n\n<font color='red'>dest</font>ï¼šdestnationå—ç®¡ä¸»æœºä¸Šçš„ä¸€ä¸ªç›®æ ‡è·¯å¾„ï¼Œå³è¦å°†æºæ–‡ä»¶å¤åˆ¶åˆ°çš„è¿œç¨‹ä¸»æœºçš„ç»å¯¹è·¯å¾„ï¼Œ<font color='red'>å¦‚æœæºæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„ä¹Ÿå¿…é¡»æ˜¯ä¸ªç›®å½•ï¼ˆå¿…é¡»ï¼‰</font>\n\n<font color='red'>content</font>ï¼šä»£æ›¿srcï¼Œå°†æœ¬æœºæŒ‡å®šå†…å®¹ä¼ è‡³è¿œç¨‹ä¸»æœºå¹¶ç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼Œç›¸å½“äº echo é‡å®šå‘å†…å®¹åˆ°æ–‡ä»¶\n\n<font color='red'>mode</font>ï¼šæ–‡ä»¶æƒé™ï¼ˆchmodï¼‰\n\nlinuxæƒé™å›é¡¾\n\n![image-20230919103608153](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/52827ecf0f65ab744206c34f261d3a9a697559838.png)\n\nownerï¼šæ–‡ä»¶å±ä¸»ï¼ˆchownï¼‰\ngroupï¼šæ–‡ä»¶å±ç»„ï¼ˆchgrpï¼‰\nbackupï¼šåœ¨è¦†ç›–ä¹‹å‰å°†åŸæ–‡ä»¶å¤‡ä»½ï¼Œå¤‡ä»½æ–‡ä»¶åŒ…å«æ—¶é—´ä¿¡æ¯ã€‚\ndirectory_modeï¼š é€’å½’åœ°è®¾å®šç›®å½•çš„æƒé™ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿé»˜è®¤æƒé™\nforceï¼š è‹¥ç›®æ ‡ä¸»æœºåŒ…å«è¯¥æ–‡ä»¶ï¼Œä½†å†…å®¹ä¸åŒï¼Œå¦‚æœè®¾ç½®ä¸ºyesï¼Œåˆ™å¼ºåˆ¶è¦†ç›–ï¼Œå¦‚æœä¸ºnoï¼Œåˆ™åªæœ‰å½“ç›®æ ‡ ä¸»æœºçš„å­˜æ”¾ä½ç½®ä¸å­˜åœ¨è¯¥æ–‡ä»¶æ—¶ï¼Œæ‰å¤åˆ¶ã€‚é»˜è®¤ä¸ºyes\n\n#### ä½¿ç”¨æ¡ˆä¾‹\n\n-----------------------------------------------\n\n1. å¤åˆ¶dir1ç›®å½•åŠå…¶æ–‡ä»¶åˆ°å—æ§ä¸»æœº/tmp/ä¸‹ï¼ˆæ— æ–œæ -æ“ä½œæ•´ä¸ªç›®å½•ï¼‰\n\næ³¨ï¼šå…³äºsrcç›®å½•åŠ ä¸åŠ /çš„æ¼”ç¤º\n\n```\n#å¤åˆ¶dir1ç›®å½•åŠå…¶æ–‡ä»¶åˆ°å—æ§ä¸»æœº/tmp/ä¸‹\nsu student\ncd ~\nll\nmkdir ansible\ncd ansible/\nmkdir dir1\necho \"123\" >dir1/file1\nansible 192.168.48.101 -m copy -a \"src='dir1' dest=/tmp/\" \n```\n\n![image-20230919104532341](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/26297293d1c6d55d60a07ba276b8f34d697559838.png)\n\næŸ¥çœ‹å—æ§ä¸»æœºæ˜¯å¦å¤åˆ¶æˆåŠŸ\n\n![image-20230919104230231](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/8ac7e84618a6a21b32f22fd0ddd6293c697559838.png)\n\næˆåŠŸ\n\n------------------------------------------------------\n\n2.ä»…å¤åˆ¶dir1ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ˆæœ‰æ–œæ -æ“ä½œç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸å¤åˆ¶ç›®å½•ï¼‰\n\n```\nansible 192.168.48.101 -m copy -a\"src='dir1/' dest=/tmp/\"\n```\n\n![image-20230919104627377](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/aeb91a6fcfd4c46cab9b2f1753021736697559838.png)\n\n--------------------------\n\n#### ç»ƒä¹ \n\n1. å°†æ§åˆ¶ä¸»æœºçš„copyfile<font color='red'>æ–‡ä»¶</font>å¤åˆ¶åˆ°å—ç®¡ä¸»æœºçš„ /tmp ç›®å½•\n\n```\necho '123' > copyfile\nansible 192.168.48.101 -m copy -a 'src=copyfile dest=/tmp'\n```\n\n![image-20230919104938353](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/5f44b73d5f3a76ac330e4c548dd2a4a4697559838.png)\n\n2. ç›´æ¥åœ¨å—ç®¡ä¸»æœºä¸Šç”Ÿæˆä¸€ä¸ªæŒ‡å®šå†…å®¹çš„æ–‡ä»¶æ–‡ä»¶\n\n```\nansible 192.168.48.101 -m copy -a \"content='test copy\\n' dest=/tmp/f1\"\n```\n\n![image-20230919105205728](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/a3c76e0b0aec925240c70f4cb5eee82a697559838.png)\n\n3. åœ¨å—ç®¡ä¸»æœºä¸Šç”ŸæˆæŒ‡å®šå±æ€§å’Œå†…å®¹çš„æ–‡ä»¶\n\n```\nansible 192.168.48.101 -m copy -a \"content='test copy 2\\n' dest=/tmp/f2 mode=0644 owner=student group=student\"\n```\n\n![image-20230919105358641](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/fb9ee5353f0251d1948b1c0c4c231262697559838.png)\n\n4. åœ¨æ–‡ä»¶è¦†ç›–å‰ç”Ÿæˆå¤‡ä»½æ–‡ä»¶\n\n```\nansible 192.168.48.101 -m copy -a \"content='test copy 1\\n' dest=/tmp/f1 backup=yes\"\n\nansible 192.168.48.101 -m shell -a \"ls -l /tmp/f1*\"\n```\n\n![image-20230919105648041](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/b5e4b14ac0ca160bde8ddf210cb96ab7697559838.png)\n\n![image-20230919105803096](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/70416fb0306aabae0a84614e1dd8616c697559838.png)\n\n### scriptæ¨¡å—\n\nåœ¨è¿œç¨‹ä¸»æœºä¸Šè¿è¡ŒansibleæœåŠ¡å™¨ä¸Šçš„è„šæœ¬ï¼Œä¼˜ç‚¹æ˜¯ä¸éœ€æ‰‹åŠ¨ä¼ é€è„šæœ¬è‡³æ¯ä¸ªæœåŠ¡å™¨ã€‚\n\nå…¶å®æ˜¯ansibleè‡ªåŠ¨ä¼ åˆ°è¿œç¨‹ä¸»æœºã€æ‰§è¡Œç„¶åå†åˆ é™¤è„šæœ¬ï¼šcopy+shell+delete\n\n```\ncat >> tesh.sh << EOF\n#ï¼/bin/bash \necho hello\nEOF\nansible all -m script -a tesh.sh\n```\n\n![image-20230919110133298](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/982643f18a7e268bacd57c50e218c612697559838.png)\n\næ‰§è¡Œç»“æœæ˜¾ç¤ºäº†æ¯å°ä¸»æœºçš„æ‰§è¡Œæƒ…å†µã€‚\n\n`CHANGED` è¡¨ç¤ºæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†å˜åŒ–ï¼Œå³è„šæœ¬è¢«æˆåŠŸæ‰§è¡Œã€‚\n\n`rc` å­—æ®µæ˜¾ç¤ºè¿”å›ç ä¸º 0ï¼Œè¡¨ç¤ºæ‰§è¡ŒæˆåŠŸã€‚\n\n`stderr` å­—æ®µæ˜¾ç¤ºäº†æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå…¶ä¸­åŒ…å«äº†è¿æ¥å…³é—­çš„ä¿¡æ¯ã€‚\n\n`stdout` å­—æ®µæ˜¾ç¤ºäº†æ ‡å‡†è¾“å‡ºï¼Œå…¶ä¸­åŒ…å«äº†è„šæœ¬æ‰§è¡Œçš„ç»“æœï¼Œå³ \"hello\"ã€‚\n\n```\ncat >>  ansible_ntp.sh << EOF\n#!/bin/bash\nsystemctl status ntpd >/dev/null 2>&1\nif [ \\$? == 0 ]; then\n\techo \"ntp service has been installed\"\n\texit\nfi\nyum install -y ntp >/dev/null 2>&1\nif [ \\$? == 0 ]; then\n\tsystemctl start ntpd\n\tsystemctl enabled ntpd >/dev/null 2>&1\n\tsleep 5\n\tntpq -p\nelse\n\techo \"ntp service install failed,check network or yum\"\nfi\nEOF\n\nè¿™æ¡å‘½ä»¤çš„æ„æ€å°±æ˜¯åœ¨åå°æ‰§è¡Œè¿™ä¸ªç¨‹åº,å¹¶å°†é”™è¯¯è¾“å‡º2é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º1,ç„¶åå°†æ ‡å‡†è¾“å‡º1å…¨éƒ¨æ”¾ åˆ°/dev/nullæ–‡ä»¶,ä¹Ÿå°±æ˜¯æ¸…ç©º.\næ‰€ä»¥å¯ä»¥çœ‹å‡º\" >/dev/null 2>&1 \"å¸¸ç”¨æ¥é¿å…shellå‘½ä»¤æˆ–è€…ç¨‹åºç­‰è¿è¡Œä¸­æœ‰å†…å®¹è¾“å‡ºã€‚\n\nchmod 777 ansible_ntp.sh\n\nansible all -m script -a \"ansible_ntp.sh\"\n```\n\n![image-20230919112000710](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/9fbb36b86b4fd085fa37a09953f27fd7697559838.png)\n\n### fetchæ¨¡å—\n\nä»å—ç®¡ä¸»æœºä¸Šï¼Œæ‹‰å–æ–‡ä»¶åˆ°æ§åˆ¶èŠ‚ç‚¹ï¼ˆç›®å‰ä¸æ”¯æŒç›®å½•,å¯ä»¥å…ˆæ‰“åŒ…,å†æå–æ–‡ä»¶ï¼‰\n\nå¸¸è§å‚æ•°\n\n<font color='red'>dest</font>ï¼šæ§åˆ¶èŠ‚ç‚¹çš„ä¿å­˜è·¯å¾„\n\n<font color='red'>src</font>ï¼šå—ç®¡èŠ‚ç‚¹è¦æ‹‰å–æ–‡ä»¶çš„è·¯å¾„ï¼ˆå¿…é¡»æ˜¯æ–‡ä»¶ï¼Œä¸èƒ½æ˜¯ç›®å½•ï¼‰\n\n<font color='red'>flat</font>ï¼šç›´æ¥ä¿å­˜åˆ°ç›®æ ‡æŒ‡å®šä½ç½®ï¼Œè€Œä¸æ˜¯åœ¨å—ç®¡ä¸»æœºåä¸‹çš„æ–‡ä»¶è·¯å¾„ä¸­ã€‚\n\n<font color='cornflowerblue'>ä½¿ç”¨æ¡ˆä¾‹</font>\n\n1. ä»å—ç®¡ä¸»æœºæ‹‰å–æŒ‡å®šæ–‡ä»¶\n\n```\nansible 192.168.48.101 -m fetch -a \"src=/etc/hosts dest=/home/student/ansible\"\n```\n\nç´¢å–åˆ°æœ¬åœ°ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼š<font color='red'>è‡ªåŠ¨ç”Ÿæˆä¸ç›®æ ‡ä¸»æœºçš„åŸŸåæˆ–IPåœ°å€çš„ç›®å½•</font>å­˜æ”¾ç´¢å–çš„æ–‡ä»¶\n\n![image-20230919122430880](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/4fdb0ca42f7652416648856e326af850697559838.png)\n\n\n\n2. ç›´æ¥æ‹‰å–å—ç®¡ä¸»æœºæ–‡ä»¶åˆ°æ§åˆ¶èŠ‚ç‚¹æŒ‡å®šä½ç½®\n\n<font color='red'>flat</font>ï¼šç›´æ¥ä¿å­˜åˆ°ç›®æ ‡æŒ‡å®šä½ç½®ï¼Œè€Œä¸æ˜¯åœ¨å—ç®¡ä¸»æœºåä¸‹çš„æ–‡ä»¶è·¯å¾„ä¸­ã€‚\n\n```\nansible 192.168.48.101 -m fetch -a \"src=/etc/hosts dest=/home/student/ansible/file1 flat=yes\"\n```\n\n![image-20230919124219445](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/945aaa435a8d0362f4d908f5f76ffea0697559838.png)\n\n\n\n3. æ‰“åŒ…ç›®å½•å¹¶æ‰€æœ‰å†…å®¹åˆ°æ§åˆ¶èŠ‚ç‚¹æŒ‡å®šä½ç½®\n\n```\nansible 192.168.48.101 -m shell -a 'pwd'\n\nansible 192.168.48.101 -m shell -a 'tar cf test.tar.gz /var/log'\nansible 192.168.48.101 -m shell -a 'ls -l /home/student/'\nansible 192.168.48.101 -m fetch -a \"src=/home/student/test.tar.gz dest=/home/student/ansible/ flat=yes\"\n```\n\n![image-20230919124935075](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/32d69277b0e420ee14c86f38bbf177f7697559838.png)\n\n![image-20230919125130417](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/896d2a405049a0e8f4dcf8bcd147ef62697559838.png)\n\n### fileæ¨¡å—\n\nfile æ¨¡å—å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆä¸€äº›å¯¹æ–‡ä»¶çš„åŸºæœ¬æ“ä½œã€‚æ¯”å¦‚ï¼Œåˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•ã€åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€ä¿®æ”¹æ–‡ ä»¶æƒé™ç­‰ã€‚\n\n<font color='red'>å¸¸ç”¨å‚æ•°</font>\n\n<font color='red'>mode</font>ï¼š å®šä¹‰æ–‡ä»¶/ç›®å½•çš„æƒé™,æ¯”å¦‚ï¼Œå¦‚æœæƒ³è¦å°†æ–‡ä»¶æƒé™è®¾ç½®ä¸º\"rw-r-x---\"ï¼Œåˆ™å¯ä»¥ä½¿ç”¨mode=650è¿›è¡Œ è®¾ç½®ï¼Œæˆ–è€…ä½¿ç”¨mode=0650ï¼Œæ•ˆæœä¹Ÿæ˜¯ç›¸åŒçš„ã€‚\n<font color='red'>owner</font>ï¼š å®šä¹‰æ–‡ä»¶/ç›®å½•çš„æ‰€æœ‰è€…,å±ä¸»å¯¹åº”çš„ç”¨æˆ·å¿…é¡»åœ¨è¿œç¨‹ä¸»æœºä¸­å­˜åœ¨,å¦åˆ™ä¼šæŠ¥é”™ã€‚\n<font color='red'>group</font>ï¼š å®šä¹‰æ–‡ä»¶/ç›®å½•çš„å±ç»„,å±ç»„å¯¹åº”çš„ç»„å¿…é¡»åœ¨è¿œç¨‹ä¸»æœºä¸­å­˜åœ¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚\n<font color='red'>path</font>ï¼š å¿…é€‰é¡¹ï¼Œå®šä¹‰å—ç®¡ä¸»æœºçš„æ–‡ä»¶/ç›®å½•çš„è·¯å¾„\n<font color='red'>recurse</font>ï¼š é€’å½’åœ°è®¾ç½®æ–‡ä»¶çš„å±æ€§ï¼Œåªå¯¹ç›®å½•æœ‰æ•ˆ\n<font color='red'>src</font>ï¼š è¦è¢«é“¾æ¥çš„æºæ–‡ä»¶çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstate=hard/linkçš„æƒ…å†µ \n<font color='red'>dest</font>ï¼š è¢«é“¾æ¥åˆ°çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstate=hard/linkçš„æƒ…å†µã€‚\n<font color='red'>state</font>ï¼š æ“ä½œæ–¹æ³•\n\t<font color='red'>directory</font>ï¼šå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½• \n   <font color='red'>file</font>ï¼šå³ä½¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šè¢«åˆ›å»ºï¼ˆåªèƒ½æŒ‡å®šå·²å­˜åœ¨çš„æ–‡ä»¶ï¼‰ \n   <font color='red'>touch</font>ï¼šå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æˆ–ç›®å½•å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶æœ€åä¿®æ”¹æ—¶é—´ \n\t<font color='red'>link</font>ï¼šåˆ›å»ºè½¯é“¾æ¥\n\t<font color='red'>hard</font>ï¼šåˆ›å»ºç¡¬é“¾æ¥ \n\t<font color='red'>absent</font>ï¼šåˆ é™¤ç›®å½•ã€æ–‡ä»¶æˆ–è€…å–æ¶ˆé“¾æ¥æ–‡ä»¶ï¼Œç›¸å½“äºrm -rf\n<font color='red'>force</font>ï¼š åªåº”ç”¨äºstate=hard/linkçš„æƒ…å†µï¼Œè‹¥éœ€è¦åœ¨ä¸¤ç§æƒ…å†µä¸‹<font color='red'>å¼ºåˆ¶åˆ›å»ºè½¯é“¾æ¥</font>ï¼Œä¸€ç§æ˜¯æºæ–‡ä»¶ä¸å­˜åœ¨ä½† ä¹‹åä¼šå»ºç«‹çš„æƒ…å†µä¸‹ï¼›å¦ä¸€ç§æ˜¯ç›®æ ‡è½¯é“¾æ¥å·²å­˜åœ¨ï¼Œéœ€è¦å…ˆå–æ¶ˆä¹‹å‰çš„è½¯é“¾ï¼Œç„¶ååˆ›å»ºæ–°çš„è½¯é“¾ï¼Œæœ‰ä¸¤ä¸ªé€‰ é¡¹ï¼šyes|no\n\n<font color='cornflowerblue'>ä½¿ç”¨æ¡ˆä¾‹</font>\n\n1. åˆ›å»ºæŒ‡å®šæ–‡ä»¶å±æ€§çš„ç©ºç›®å½•\n\n```\nansible 192.168.48.101 -m file -a \"path=/tmp/dir2 state=directory owner=student group=student mode=0755\"\n\nansible 192.168.48.101 -m shell -a \"ls -l /tmp/\"\n```\n\n![image-20230919130328712](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/d119b1a6c075c04724ea0b5d18b24ff6697559838.png)\n\n\n\n2. åˆ›å»ºæŒ‡å®šæ–‡ä»¶å±æ€§çš„ç©ºæ–‡ä»¶\n\n```\nansible 192.168.48.101 -m file -a \"path=/tmp/file2 state=touch owner=student group=student mode=0755\"\nansible 192.168.48.101 -m shell -a \"ls -l /tmp/\"\n```\n\n![image-20230919130652157](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/f919f4d5b5a8b68e20e4f95ccb967700697559838.png)\n\n<font color='red'>æ³¨æ„ï¼šä¸ºä½•ä¸èƒ½ç”¨state=file</font>\n\n<font color='red'>file</font>ï¼šå³ä½¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šè¢«åˆ›å»ºï¼ˆåªèƒ½æŒ‡å®šå·²å­˜åœ¨çš„æ–‡ä»¶ï¼‰ \n\nfile3ä¸å­˜åœ¨\n\n```\nansible 192.168.48.101 -m file -a \"path=/tmp/file3 state=file owner=student group=student mode=0755\"\n```\n\n![image-20230919131409780](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/1619642d3c6cc025192515591e26ace8697559838.png)\n\nå¦‚æœæŒ‡å®šfile1ï¼ˆå·²å­˜åœ¨ï¼‰å‘¢ï¼ˆå°†rootç”¨æˆ·å±ç»„æ”¹æˆstudentï¼‰\n\n```\nansible 192.168.48.101 -m file -a \"path=/tmp/file1 state=file owner=student group=student mode=0755\"\n```\n\n![image-20230919131653294](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/e5f778ea43b30d28fd675e0a6a864038697559838.png)\n\n\n\n3. åˆ é™¤ç›®å½•ã€åˆ é™¤æ–‡ä»¶\n\n```\nansible 192.168.48.101 -m file -a \"path=/tmp/dir1 state=absent\"\nansible 192.168.48.101 -m file -a \"path=/tmp/file1 state=absent\"\nansible 192.168.48.101 -m shell -a \"ls -l /tmp/\"\n```\n\n![image-20230919131825229](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/c3c6450ce672a745e0d7d65a0a3bd3ac697559838.png)\n\n\n\n4. åˆ›å»ºé“¾æ¥æ–‡ä»¶\n\nè½¯é“¾æ¥ï¼šå¿«æ·æ–¹å¼\nfile2â†’file1ï¼ˆlinkï¼‰\n\nç”Ÿæˆfile1ï¼ˆ<font color='red'>å¦‚æœå·²å­˜åœ¨å°±å¿½ç•¥è¿™æ­¥</font>ï¼‰\n\n```\nansible 192.168.48.101 -m copy -a \"content='123 \\n' dest=/tmp/file1\"\n```\n\n![image-20230919132425256](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/35c2e36d03caece46fbd21381a3800a7697559838.png)\n\nç”Ÿæˆè½¯é“¾æ¥\n\n```\nansible 192.168.48.101 -m file -a \"src=/tmp/file1 path=/tmp/file2 state=link force=true\"\n```\n\n![image-20230919132542883](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ac380dd1f6da597ec6270ef6ca593bf9697559838.png)\n\nå–æ¶ˆè½¯è¿æ¥\n\n```\nansible 192.168.48.101 -m file -a \"path=/tmp/file2 state=absent\"\n```\n\n![image-20230919132733624](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/98bf109db0eb83ac92dc76a4cddb0777697559838.png)\n\nç¡¬é“¾æ¥ï¼šæŒ‡å‘åŒä¸€ä¸ªinode\n\nfile3â†’file1ï¼ˆhardï¼‰\n\nfile3ä¸å­˜åœ¨\n\n```\nansible 192.168.48.101 -m file -a \"src=/tmp/file1 path=/tmp/file3 state=hard\"\n```\n\n![image-20230919132952435](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/3e287d7e0e2660964cd890ef1adc3c72697559838.png)\n\n#### è¯¾å ‚ç»ƒä¹ \n\n1ã€åœ¨/tmp/ä¸‹åˆ›å»ºç›®å½•ansiblefile,å¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºtest.txtæ–‡ä»¶ï¼ŒæŒ‡å®šå±ä¸»student,èµ‹äºˆæƒé™0700\n\n```\nansible all -m shell -a \"useradd student\"\t#åˆ›å»ºä¸€ä¸ªç”¨æˆ·ä¸ç»„\nansible 192.168.48.101 -m file -a 'path=/tmp/ansiblefile state=directory'\nansible 192.168.48.101 -m file -a 'path=/tmp/ansiblefile/test.txt state=touch owner=student mode=0700'\n```\n\n![image-20230919133407177](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/cdef89811e66ad695a1c99667c0c89b2697559838.png)\n\n2ã€åˆ é™¤è¿œç¨‹æœºå™¨ä¸Šçš„æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•(åˆ é™¤è¿œç¨‹ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼š/tmp/ansiblefile/test.txt\n\n```\nansible 192.168.48.101 -m file -a 'path=/tmp/ansiblefile/test.txt state=absent'\n```\n\n![image-20230919133445932](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/e93984ad9e575561dbec75452154899b697559838.png)\n\n\n\n### lineinfileæ¨¡å—\n\nå¢åŠ æˆ–ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼ˆä»¥è¡Œä¸ºå•ä½åšæµå¼å¤„ç†ï¼‰ï¼Œè¯¥æ¨¡å—åœ¨è‡ªåŠ¨åŒ–è¿ç»´ä¸­éå¸¸é‡è¦,ä»–å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾ å¼æ›¿æ¢æŒ‡å®šæ–‡æœ¬;ä¾‹å¦‚å¼€å¯ä¸€äº›é…ç½®é€‰é¡¹ç­‰å¯ä»¥æ–°åŠ ä¸€è¡Œæ–‡æœ¬,æˆ–è€…æ˜¯åˆ é™¤æŒ‡å®šçš„è¡Œ,æœ¬å‘½ä»¤ä¸€å®šè®¤çœŸæŒæ¡ ä¸‹æ¥.\n\n***\\*å¸¸è§å‚æ•°\\****\n\n<font color='red'>path</font>ï¼šå¿…é¡»å‚æ•°ï¼Œè¿œç«¯æ–‡ä»¶è·¯å¾„ \n\n<font color='red'>line</font>ï¼šå¿…é¡»å‚æ•°ï¼Œä¿®æ”¹åçš„å†…å®¹ï¼ˆæŒ‰è¡Œå†™å…¥ï¼‰ï¼Œè¿½åŠ  \n\n<font color='red'>regexp</font>ï¼šï¼ˆå®šä½ï¼‰åŒ¹é…æ­£åˆ™è¯­å¥,ä¸è¦è¿‡æ»¤çš„å…³é”®å­— \n\n<font color='red'>state</font>ï¼šæ–‡ä»¶ä¿®æ”¹çŠ¶æ€ï¼ˆpresent æ·»åŠ ç”Ÿæ•ˆ / absent åˆ é™¤ï¼‰ \n\n<font color='red'>replace</font>ï¼šæ›¿æ¢æ–‡ä»¶å†…å®¹ \n\n<font color='red'>create</font>ï¼šå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œæ˜¯å¦åˆ›å»ºå¯¹åº”æ–‡ä»¶ \n\n<font color='red'>backup</font>ï¼šè‹¥æ–‡ä»¶æ›´æ–°æ—¶åˆ›å»ºå¤‡ä»½å‰¯æœ¬ \n\n<font color='red'>insertafter</font>ï¼šåœ¨æŒ‡å®šä½ç½®çš„ä¸‹ä¸€è¡Œæ’å…¥ï¼ˆå®šä½ï¼‰ \n\n<font color='red'>insertbefore</font>ï¼šåœ¨æŒ‡å®šä½ç½®çš„ä¸Šä¸€è¡Œæ’å…¥ï¼ˆå®šä½ï¼‰\n\n\n\n<font color='orange'>ä½¿ç”¨æ¡ˆä¾‹</font>\n\n\n\nå‡è®¾å‰æï¼šå°†æ§åˆ¶èŠ‚ç‚¹çš„/etc/selinux/configæ–‡ä»¶å¤åˆ¶åˆ°å—ç®¡ä¸»æœº192.168.48.101ï¼Œå¦å­˜ä¸º/tmp/selinuxæ–‡ä»¶\n\n```\nansible 192.168.48.101 -m copy -a \"src=/etc/selinux/config dest=/tmp/selinux\"\nansible 192.168.48.101 -m shell -a \"cat /tmp/selinux\"\n```\n\n![image-20230919134240077](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/756073d3a371c5ad80ed9d2b96cc0735697559838.png)\n\n![image-20230919134251941](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/3fbdf2b0b76d46ef1cbd8df403861593697559838.png)\n\n1. ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼šè€ƒè™‘ä¸¤ä¸ªé—®é¢˜ï¼Œä¿®æ”¹å“ªä¸ªéƒ¨åˆ†ï¼Œä¿®æ”¹æˆä»€ä¹ˆå†…å®¹\n\nä¿®æ”¹SELINUXå¼€å¤´çš„è¡Œï¼Œæ›´æ–°å†…å®¹ä¸ºï¼šSELINUX=disabled\n\n```\nansible 192.168.48.101 -m lineinfile -a \"path=/tmp/selinux regexp='^SELINUX=' line='SELINUX=disabled' \"\nansible 192.168.48.101 -m shell -a \"cat /tmp/selinux\"\n```\n\n![image-20230919134315158](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ff41c79a4849ffafdc9c6cc72a4b5209697559838.png)\n\n2.å¢åŠ æ–‡ä»¶å†…å®¹ï¼šè€ƒè™‘ä¸¤ä¸ªé—®é¢˜ï¼Œå¢åŠ ä»€ä¹ˆå†…å®¹ï¼Œå¢åŠ åœ¨å“ªä¸ªä½ç½®ï¼ˆä¸Šä¸€è¡Œæˆ–ä¸‹ä¸€è¡Œï¼‰\n\nåœ¨SELINUXå¼€å¤´çš„è¡Œï¼Œåœ¨ä¸‹ä¸€è¡ŒåŠ ä¸ªæ³¨é‡Šï¼Œå¹¶ä¸”åº”ç”¨ç”Ÿæ•ˆ\n\n```\nansible 192.168.48.101 -m lineinfile -a \"path=/tmp/selinux insertafter='^SELINUX=' line='##Disabled SELINUX' \"\n```\n\n![image-20230919134429117](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/001e419cf858d7c28354f565a2791a01697559838.png)\n\né€šè¿‡æ­£åˆ™åŒ¹é…æŸ¥æ‰¾/tmp/selinuxæ–‡æœ¬,å¹¶åœ¨æ–‡æœ¬æœ«å°¾æ’å…¥ä¸€è¡Œ##end\n\n```\nansible 192.168.48.101 -m lineinfile -a 'path=/tmp/selinux regexp=\"EOF\" line=\"#end\"'\n```\n\n![image-20230919134600319](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/a47131b7c20e123dfee16dcde867fb21697559838.png)\n\n\n\n3.åˆ é™¤æ–‡ä»¶å†…å®¹:æŠŠåˆšæ‰æ·»åŠ çš„â€œ<font color='orange'>##disabled selinux</font>â€æ³¨é‡Šå»æ‰ï¼ˆåˆ é™¤æ‰€åœ¨è¡Œï¼‰\n\n```\nansible 192.168.48.101 -m lineinfile -a \"path=/tmp/selinux regexp='^##Disa' state=absent\"\nansible 192.168.48.101 -m shell -a \"cat /tmp/selinux\"\n```\n\n![image-20230919134741516](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/8388d27ba2f82a7ac5c10deb1cd88c1d697559838.png)\n\n![image-20230919134748069](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/1538eecbf87fa1ebe7ae12f47572f272697559838.png)\n\n\n\n4. å¤‡ä»½æ–‡ä»¶:åœ¨SELINUXå¼€å¤´çš„è¡Œï¼Œå‰ä¸€è¡ŒåŠ ä¸ªæ³¨é‡Šï¼Œå¹¶ä¸”ç”Ÿæ•ˆï¼Œç”Ÿæˆå¤‡ä»½æ–‡ä»¶\n\n```\nansible 192.168.48.101 -m lineinfile -a \"path=/tmp/selinux insertbefore='^SELINUX=' line='##Disabled SELINUX' backup=yes state=present\"\nansible 192.168.48.101 -m shell -a \"ls -l /tmp/selinux*\"\n```\n\n![image-20230919134951862](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/d0ae22dee29f7c9fedf16e8d93de70bb697559838.png)\n\n![image-20230919135043656](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/3ac6894ea15fb06f10ad21e6a0e48994697559838.png)\n\n\n\nè¯¾å ‚ç»ƒä¹ ï¼š\n\nä¿®æ”¹192.168.48.101ä¸»æœºçš„/etc/hostsæ–‡ä»¶ï¼Œ\n\n1ã€å¢åŠ å†…å®¹192.168.48.102 node03,éªŒè¯å¢åŠ æˆåŠŸ\n\n```\nansible 192.168.48.101 -m lineinfile -a \"path=/etc/hosts line='192.168.48.102 node03' \"\nansible 192.168.48.101 -m shell -a \"cat /etc/hosts\"\n```\n\n![image-20230919143706370](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/3480653ecbfb7b45c39bfe37641abe94697559838.png)\n\n2ã€åŒ¹é…ä»¥192å¼€å¤´çš„è¡Œï¼Œä¿®æ”¹192.168.48.102 å¯¹åº”çš„ åŸŸåä¸ºnode02ï¼ŒéªŒè¯å¢åŠ æˆåŠŸ\n\n```\nansible 192.168.48.101 -m lineinfile -a \"path=/etc/hosts regexp='^192' line='192.168.48.102 node02' \"\n```\n\n![image-20230919143745061](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/82f79ccd0582587791246c164466ddfe697559838.png)\n\n3ã€åŒ¹é…ä»¥192å¼€å¤´çš„è¡Œä¹‹å‰å¢åŠ  192.168.48.101 node01 ï¼ŒéªŒè¯å¢åŠ æˆåŠŸ\n\n```\nansible 192.168.48.101 -m lineinfile -a \"path=/etc/hosts insertbefore='^192' line='192.168.48.101 node01' \"\n```\n\n![image-20230919143806128](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/fbf2e090c6d8759eb5147754e3ef2e95697559838.png)\n\n4ã€åœ¨æ–‡æ¡£ç»“å°¾å¢åŠ  192.168.48.100 controller\n\n```\nansible 192.168.48.101 -m lineinfile -a 'path=/etc/hosts regexp=\"EOF\" line=\"192.168.48.100 controller\"'\n```\n\n![image-20230919143820201](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/fc1024bf695130888d3ec14f3358268e697559838.png)\n\n5ã€åˆ é™¤æ­¥éª¤1-3åŠ å…¥çš„å†…å®¹\n\n```\nansible 192.168.48.101 -m lineinfile -a \"path=/etc/hosts regexp='^192.' state=absent\"\nansible 192.168.48.101 -m shell -a \"cat /etc/hosts\"\n```\n\n![image-20230919143831042](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/85dcd9c0186a3eb51446a05cb9dc497c697559838.png)\n\n## è½¯ä»¶åŒ…æ¨¡å—\n\n### yumæ¨¡å—\n\n***\\*å¸¸ç”¨å‚æ•°\\****\n\nnameï¼šè½¯ä»¶åŒ…åç§°ï¼ˆå¿…å¡«ï¼‰ \n\nstateï¼š\n\nlatestï¼ˆæ›´æ–°åˆ°æœ€æ–°ï¼‰ \n\npresentï¼ˆå®‰è£…ï¼‰ \n\nversionï¼ˆç‰ˆæœ¬ï¼‰ \n\nabsentï¼ˆå¸è½½ï¼‰\n\næŸ¥çœ‹æ˜¯å¦å®‰è£…äº†æŸä¸ªæœåŠ¡ rpm -qa|grep httpd\n\n***\\*ä½¿ç”¨æ¡ˆä¾‹\\****\n\nç»™node01å®‰è£…httpdæœåŠ¡\n\n```\nansible 192.168.48.101 -m yum -a 'name=httpd state=present'\n```\n\n![image-20230919144212748](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/077acbe660f8d5467cead949a6261b86697559838.png)\n\néªŒè¯å®‰è£…\n\n```\nansible 192.168.48.101 -m shell -a 'rpm -qa|grep httpd'\n```\n\nå¸è½½ state=absent\n\n```\nansible 192.168.48.101 -m yum -a 'name=httpd state=absent'\n```\n\næ›´æ–°è½¯ä»¶state=latest\n\n```\nansible 192.168.48.101 -m yum -a 'name='httpd' state=latest'\n```\n\n## ç³»ç»Ÿæ¨¡å—\n\n### useræ¨¡å—\n\n<font color='red'>å¸¸ç”¨å‚æ•°</font>\n\n```\ncommentï¼šæ³¨é‡Šä¿¡æ¯\ngroupï¼šä¸»è¦ç»„\ngroupsï¼šé™„åŠ ç»„\nstateï¼špresent/absent\ngenerate_ssh_keyï¼šç”ŸæˆSSHéªŒè¯å¯†é’¥\nnameï¼šç”¨æˆ·å\nshellï¼šShellç±»å‹\nuidï¼šUID\n```\n\n<font color='red'>ä½¿ç”¨æ¡ˆä¾‹</font>\n\n1ã€åœ¨node1ä¸Šåˆ›å»ºç”¨æˆ· test_user UID=1010\n\n```\nansible 192.168.48.101 -m user -a \"name=test_user  uid=1010 comment='ansible_test_user' shell=/bin/bash generate_ssh_key=yes  state=present\"\n```\n\n```\nansible 192.168.48.101 -m shell -a 'id test_user'\n```\n\n![image-20230920001519202](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/9fcc14b7641e8a2a1cbbc2c8f89b9ce4697559838.png)\n\n2ã€åˆ é™¤ç”¨æˆ·test_userï¼ˆuserdel test_userï¼‰\n\n```\nansible 192.168.48.101 -m user -a \"name=test_user  state=absent force=yes\"\nansible 192.168.48.101 -m shell -a 'getent passwd |grep test_user'\n```\n\n![image-20230920001533536](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ecb24faf569f346c43de8b49d857ad39697559838.png)\n\n### groupç»„æ¨¡å—\n\n1ã€åˆ›å»ºç»„test_group (groupadd -g 1010 test_groupï¼‰\n\n```\nansible 192.168.48.101 -m group -a \"name=test_group  gid=1010  state=present\"\nansible 192.168.48.101 -m shell -a 'getent group|grep test_group'\n```\n\n![image-20230920001545680](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/f14a0dfa0cd30c96aa4d1d88602dbf29697559838.png)\n\n2ã€åˆ é™¤ç»„test_group ï¼ˆgroupdel test_groupï¼‰\n\n```\nansible 192.168.48.101 -m group -a \"name=test_group   state=absent\"\nansible 192.168.48.101 -m shell -a 'getent group|grep test_group'\n```\n\n![image-20230920001557200](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/984c33ed39dd849a2495d5bfce57835b697559838.png)\n\n### serviceæ¨¡å—\n\nå¯ç”¨/å¯åŠ¨/åœæ­¢æŒ‡å®šçš„æœåŠ¡\n\n<font color='red'>å¸¸ç”¨å‚æ•°</font>\n\n```\nnameï¼šæœåŠ¡åï¼ˆç¡®å®šæœåŠ¡å­˜åœ¨ï¼‰ï¼ˆå¿…é€‰é¡¹ï¼‰\nstateï¼šæœåŠ¡ç›®æ ‡çŠ¶æ€\n\tï¼ˆstate=started/stopped/restarted/...ï¼‰ï¼ˆå¿…é€‰é¡¹ï¼‰\nenabledï¼šæ˜¯å¦å¼€æœºå¯åŠ¨(yes/no)\n```\n\n1ã€åœ¨node01ä¸Šå®‰è£…å’Œå¯ç”¨httpdæœåŠ¡ï¼ˆç›¸å½“äºsystemctl enable --now httpdï¼‰\n\nå®‰è£…\n\n```\nansible 192.168.48.101 -m yum -a 'name=httpd state=present'\n```\n\nå¯ç”¨\n\n```\nansible 192.168.48.101 -m service -a \"name=httpd state=started  enabled=yes\"\n```\n\n```\nansible 192.168.48.101 -m shell -a 'systemctl status httpd'\n```\n\n![image-20230920001809879](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ebf18d1d264fdb90968c717a86e6888d697559838.png)\n\n![image-20230920001826386](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/b42ddf38524dddc14e86d4c710d97922697559838.png)\n\n2ã€åœæ­¢æœåŠ¡\n\n```\nansible 192.168.48.101 -m service -a 'name=httpd state=stopped'\n```\n\n![image-20230920001941649](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/7ddf22463363605d6f0e87cf6ff1e725697559838.png)\n\n3ã€é‡å¯æœåŠ¡\n\n```\nansible 192.168.48.101 -m service -a 'name=httpd state=restarted'\n```\n\n![image-20230920002005593](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/d80886bd03e975c2b785a9498f3376a3697559838.png)\n\n### firewalldæ¨¡å—\n\n<font color='red'>å¸¸è§å‚æ•°</font>\n\n```\nsourceï¼šæ•°æ®æºï¼ˆç›¸å½“äº--add-sourceï¼‰\ninterfaceï¼šç«¯å£ï¼ˆç›¸å½“äº--add-portï¼‰\nserviceï¼šæœåŠ¡ï¼ˆç›¸å½“äº--add-serviceï¼‰\nzoneï¼šå…³è”åŒºåŸŸï¼ˆç›¸å½“äº--zoneï¼‰\npermanentï¼šæ°¸ä¹…ç”Ÿæ•ˆï¼ˆç›¸å½“äº--permanentï¼‰\nimmediateï¼šç«‹å³ç”Ÿæ•ˆï¼ˆç›¸å½“äºæ‰§è¡Œäº†firewall-cmd --reloadï¼‰\nstateï¼šé˜²ç«å¢™è§„åˆ™çŠ¶æ€ï¼ˆenabled | disabledï¼‰ï¼ˆå¿…å¡«é¡¹ï¼‰\nrich_ruleï¼šå¯Œè§„åˆ™ï¼ˆç›¸å½“äº--add-rich-rule=''ï¼‰\n```\n\n<font color='red'>ä½¿ç”¨æ¡ˆä¾‹</font>\n\n1ã€æ·»åŠ åŸºæœ¬è§„åˆ™\n\nåœ¨node1ä¸­å°†httpæœåŠ¡è¿›è¡Œæ”¾è¡Œï¼Œå¹¶å…³è”åˆ°publicåŒºåŸŸä¸­ï¼Œç«‹å³ç”Ÿæ•ˆä¸”æ°¸ä¹…ç”Ÿæ•ˆ\n\n```\nansible 192.168.48.101 -m firewalld -a 'zone=public service=http permanent=yes immediate=yes state=enabled'\n```\n\n## ç»¼åˆç»ƒä¹ \n\nï¼ˆ1ï¼‰åœ¨node01ä¸Šåˆ›å»ºä¸€ä¸ªç”¨æˆ·devopsï¼š\n\n```shell\nansible node01 -m user -a \"name=devops state=present\"\n```\n\n![image-20230919211657605](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/43311590cf4293eebf8e6c6e4525fe7f697559838.png)\n\nï¼ˆ2ï¼‰åœ¨node01ä¸Šåˆ›å»ºä¸€ä¸ªç›®å½• /devopsï¼Œè®¾ç½®æ‰€å±ç»„ã€æƒé™ï¼š\n\n```shell\nansible node01 -m file -a \"path=/devops state=directory owner=devops group=devops mode=0755\"\n ansible node01 -m shell -a \"ls -l /\"  \n```\n\n![image-20230919211756676](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/c070db8ae1c1081b3afa5ce73bfd475c697559838.png)\n\nï¼ˆ3ï¼‰å®‰è£…httpdæœåŠ¡ï¼Œè®¾å®šå¼€æœºè‡ªå¯åŠ¨ï¼ŒéªŒè¯æœåŠ¡çŠ¶æ€ä¸ºå¯åŠ¨ï¼š\n\n```shell\nansible node01 -m yum -a \"name=httpd state=present\"\nansible node01 -m service -a \"name=httpd state=started enabled=yes\"\n```\n\n![image-20230912173234830](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/e161fc889e76fee81d98bb5f76ab6b4f697559838.png)\n\n![image-20230912173228899](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/2945a200e016c4bdc2785f2b5616d9e5697559838.png)\n\nï¼ˆ4ï¼‰åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ /devops/index.html åŒ…å«ä¸€è¡Œå†…å®¹ï¼šDevOpsï¼š\n\n```shell\nansible node01 -m copy -a \"content='DevOps\\n' dest=/devops/index.html\"\n```\n\n![image-20230919211916628](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/e5ca64b7e2b60729b8f77919d2cbe9fd697559838.png)\n\nï¼ˆ5ï¼‰åˆ›å»ºè½¯é“¾æ¥ï¼š/var/www/html/index.html åˆ° /devops/index.htmlï¼š\n\n```shell\nansible node01 -m file -a \"src=/devops/index.html dest=/var/www/html/index.html state=link force=true\"\n```\n\n![image-20230919211928515](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/1459bab864fc683648b370727a50ab0e697559838.png)\n\nï¼ˆ6ï¼‰éªŒè¯è½¯é“¾æ¥ï¼š\n\n```shell\nansible node01 -m shell -a \"ls -l  /var/www/html/index.html\"\n```\n\n![image-20230919211941716](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/6a902872ae6c3a772f771257ad5ebdca697559838.png)\n\nï¼ˆ7ï¼‰å–æ¶ˆè½¯é“¾æ¥ï¼Œæ–°å»º/var/www/html/index.html æ–‡æ¡£ï¼Œè®¿é—®ç½‘é¡µï¼š\n\n```shell\nansible node01 -m file -a \"path=/var/www/html/index.html state=absent\"\nansible node01 -m copy -a \"content='Hello World' dest=/var/www/html/index.html\"\n```\n\n![image-20230919212000893](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/942dcfaf88048644ec1383c6aaf454c5697559838.png)\n\n![image-20230919212022836](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/25c4d54e6951d50a51ae34425952395e697559838.png)\n\nä½¿ç”¨æµè§ˆå™¨è®¿é—®http://192.168.48.101éªŒè¯ä¸»é¡µä¿¡æ¯\n\n# Ansible-Playbook\n\n## ä»‹ç»\n\n> playbookæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ª\"play\"ç»„æˆçš„åˆ—è¡¨\n> playçš„ä¸»è¦åŠŸèƒ½åœ¨äºå°†é¢„å®šä¹‰çš„ä¸€ç»„ä¸»æœºï¼Œè£…æ‰®æˆäº‹å…ˆé€šè¿‡ansibleä¸­çš„taskå®šä¹‰å¥½çš„è§’è‰²ã€‚\n> Taskå®é™…æ˜¯è°ƒç”¨ansibleçš„ä¸€ä¸ªmoduleï¼Œå°†å¤šä¸ªplayç»„ç»‡åœ¨ä¸€ä¸ªplaybookä¸­ï¼Œ\n> å³å¯ä»¥è®©å®ƒä»¬è”åˆèµ·æ¥ï¼ŒæŒ‰äº‹å…ˆç¼–æ’çš„æœºåˆ¶æ‰§è¡Œé¢„å®šä¹‰çš„åŠ¨ä½œ\n> Playbooké‡‡ç”¨YAMLè¯­è¨€ç¼–å†™\n\n```\nç”¨æˆ·é€šè¿‡ansibleå‘½ä»¤ç›´æ¥è°ƒç”¨ymlè¯­è¨€å†™å¥½çš„playbook,playbookç”±å¤šæ¡playç»„æˆ\næ¯æ¡playéƒ½æœ‰ä¸€ä¸ªä»»åŠ¡(task)ç›¸å¯¹åº”çš„æ“ä½œ,ç„¶åè°ƒç”¨æ¨¡å—modulesï¼Œåº”ç”¨åœ¨ä¸»æœºæ¸…å•ä¸Š,é€šè¿‡sshè¿œç¨‹è¿æ¥\nä»è€Œæ§åˆ¶è¿œç¨‹ä¸»æœºæˆ–è€…ç½‘ç»œè®¾å¤‡\n```\n\n## YAMLè¯­æ³•\n\n```\n> åœ¨å•ä¸€æ¡£æ¡ˆä¸­ï¼Œå¯ç”¨è¿ç»­ä¸‰ä¸ªè¿å­—å·ï¼ˆ---ï¼‰åŒºåˆ†å¤šä¸ªæ¡£æ¡ˆã€‚\n  å¦å¤–ï¼Œè¿˜æœ‰é€‰æ‹©æ€§çš„è¿ç»­ä¸‰ä¸ªç‚¹å·( ... )ç”¨æ¥è¡¨ç¤ºæ¡£æ¡ˆç»“å°¾\n> æ¬¡è¡Œå¼€å§‹æ­£å¸¸å†™Playbookçš„å†…å®¹ï¼Œä¸€èˆ¬å»ºè®®å†™æ˜è¯¥Playbookçš„åŠŸèƒ½\n> ä½¿ç”¨#å·æ³¨é‡Šä»£ç \n> ç¼©è¿›å¿…é¡»æ˜¯ç»Ÿä¸€çš„ï¼Œä¸èƒ½ç©ºæ ¼å’Œtabæ··ç”¨ï¼Œä¸€èˆ¬ç¼©è¿›2ä¸ªç©ºæ ¼\n> ç¼©è¿›çš„çº§åˆ«ä¹Ÿå¿…é¡»æ˜¯ä¸€è‡´çš„ï¼ŒåŒæ ·çš„ç¼©è¿›ä»£è¡¨åŒæ ·çš„çº§åˆ«ï¼Œç¨‹åºåˆ¤åˆ«é…ç½®çš„çº§åˆ«æ˜¯é€šè¿‡ç¼©è¿›ç»“åˆæ¢è¡Œæ¥å®ç°çš„\n> YAMLæ–‡ä»¶å†…å®¹æ˜¯åŒºåˆ«å¤§å°å†™çš„ï¼Œkey/valueçš„å€¼å‡éœ€å¤§å°å†™æ•æ„Ÿ\n> å¤šä¸ªkey/valueå¯åŒè¡Œå†™ä¹Ÿå¯æ¢è¡Œå†™ï¼ŒåŒè¡Œä½¿ç”¨:åˆ†éš”ï¼ŒåŒä¸€è¡Œä½¿ç”¨ , é€—å·åˆ†éš”\n> valueå¯ä»¥æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯æ˜¯å¦ä¸€ä¸ªåˆ—è¡¨[]\n> ä¸€ä¸ªå®Œæ•´çš„ä»£ç å—åŠŸèƒ½éœ€æœ€å°‘å…ƒç´ éœ€åŒ…æ‹¬ name å’Œ task\n> ä¸€ä¸ªnameåªèƒ½åŒ…æ‹¬ä¸€ä¸ªtask\n> YAMLä¸­ä¸å…è®¸åœ¨åŒå¼•å·ä¸­å‡ºç°è½¬ä¹‰ç¬¦å·ï¼Œæ‰€ä»¥éƒ½æ˜¯ä»¥å•å¼•å·æ¥é¿å…è½¬ä¹‰ç¬¦é”™è¯¯\n> ä½¿ç”¨ | å’Œ > æ¥åˆ†éš”å¤šè¡Œï¼Œå®é™…ä¸Šè¿™åªæ˜¯ä¸€è¡Œã€‚ \n> YAMLæ–‡ä»¶æ‰©å±•åé€šå¸¸ä¸ºymlæˆ–yaml\n```\n\nä¸‰ç§å¸¸è§çš„æ•°æ®äº¤æ¢æ ¼å¼\n\n![7](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/0b09dccd30360520c75ca7cf06f2027a697559838.png)\n\n```\nYAMLçš„è¯­æ³•å’Œå…¶ä»–é«˜é˜¶è¯­è¨€ç±»ä¼¼ï¼Œå¹¶ä¸”å¯ä»¥ç®€å•è¡¨è¾¾æ¸…å•ã€æ•£åˆ—è¡¨ã€æ ‡é‡ç­‰æ•°æ®ç»“æ„ã€‚\nåºåˆ—ï¼ˆSequenceï¼‰é‡Œçš„é¡¹ç”¨\"-\"æ¥ä»£è¡¨ï¼ŒMapé‡Œçš„é”®å€¼å¯¹ï¼ˆå­—å…¸ï¼‰ç”¨\":\"åˆ†éš”\nç¤ºä¾‹\n    name: John Smith\n    age: 41\n    gender: Male\n    spouse:\n      name: Jane Smith\n      age: 37\n      gender: Female\n    children:\n      - name: Jimmy Smith\n        age: 17\n        gender: Male\n      - name: Jenny Smith\n        age 13\n        gender: Female\n```\n\n## ä¿®æ”¹vim\n\n```\nvim ~/.vimrc\nset nu       \nset paste    \nset cursorline \nset cursorcolumn \nautocmd FileType yaml setlocal ai et ts=2 sw=2 \n\n\nset nu       #æ˜¾ç¤ºè¡Œå·\nset paste    #é»è´´å†…å®¹ä¿ç•™æ ¼å¼\nset cursorline #è¡Œå®šä½\nset cursorcolumn #åˆ—å®šä½\nautocmd FileType yaml setlocal ai et ts=2 sw=2 \n#FileType ä»£è¡¨æ–‡ä»¶ç±»å‹,åè¾¹è·Ÿå‚æ•°yamlï¼Œå°±æ˜¯è¿™ä¸ªä½œç”¨äºyamlæ–‡ä»¶ï¼Œç¼–å†™å…¶ä»–æ–‡ä»¶æ—¶ä¸èµ·ä½œç”¨\n#ts=2æ˜¯tabstop=2çš„ç¼©å†™ï¼Œè¡¨ç¤ºä½¿ç”¨2ä¸ªç©ºæ ¼è‡ªåŠ¨ä»£æ›¿tabé”®\n#et=expandtab è¡¨ç¤ºtabé”®çš„ç¼©å†™\n#sw=2 æ˜¯shiftwidth=2çš„ç¼©å†™ï¼Œè¡¨ç¤ºå¼€å¯è‡ªåŠ¨ç¼©è¿›å¯¹é½ï¼Œç¼©è¿›å®½åº¦ä¸º2ä¸ªç©ºæ ¼\n#ai=auto indent   è‡ªåŠ¨é€€æ ¼å¯¹é½\\\n\n```\n\nå°†è¿™æ®µä»£ç æ·»åŠ åˆ° `~/.vimrc` æ–‡ä»¶ä¸­ï¼Œä»¥ä½¿ Vim åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åº”ç”¨è¿™äº›è®¾ç½®\n\n## playbookåŸºç¡€ç»„ä»¶\n\nä¸€ä¸ªç®€å•çš„å‰§æœ¬æ¨¡å‹ï¼ˆYAMLè¯­è¨€ï¼‰ \n\n1> ç¼©è¿›ï¼šç”¨ä¸¤ä¸ªç©ºæ ¼ç¼©è¿› \n\n2> åˆ—è¡¨ï¼šç”¨ - \n\n3> å­—å…¸ï¼škey: value \n\n```\n--- \n- hosts: YYY          #å¾…æ“ä½œä¸»æœºé›†ï¼Œå¯ä»¥ä¸å†™ï¼Œæ‰§è¡Œæ—¶é€šè¿‡ -i è°ƒç”¨hostæ–‡ä»¶\n  remote_userï¼š root  #åœ¨è¿œç«¯ä½¿ç”¨å“ªä¸ªç”¨æˆ·æ‰§è¡Œ\n  tasks:              #ä»»åŠ¡é›†ï¼ˆå¿…é¡»ï¼‰\n  - name: task1       #åªæ˜¯ä¸€ä¸ªæ–‡æœ¬æç¤ºï¼Œæ‰§è¡Œæ—¶ä¼šè¾“å‡ºå…¶ä¸­å†…å®¹ï¼ˆä¾‹å¦‚è¾“å‡ºInstall httpdï¼‰\n    module1:          #çœŸæ­£å¹²æ´»çš„éƒ¨åˆ†ï¼Œå…¶å®å°±æ˜¯å‰é¢è®²è¿‡çš„ansibleå„ç§æ¨¡å—\n      argument1 : value1 \n      argument2 : value2 \n  - name: task2 \n    module2:\n      argument1 : value1 \n      argument2 : value2 \n... \n```\n\nè§£é‡Šï¼š\n\n```\nHostsï¼š\n    > playbookä¸­çš„æ¯ä¸€ä¸ªplayçš„ç›®çš„éƒ½æ˜¯ä¸ºäº†è®©ç‰¹å®šä¸»æœºä»¥æŸä¸ªæŒ‡å®šçš„ç”¨æˆ·èº«ä»½æ‰§è¡Œä»»åŠ¡ã€‚\n      hostsç”¨äºæŒ‡å®šè¦æ‰§è¡ŒæŒ‡å®šä»»åŠ¡çš„ä¸»æœºï¼Œé¡»äº‹å…ˆå®šä¹‰åœ¨ä¸»æœºæ¸…å•ä¸­\n\n```\n\n```\nremote_user: \n    å¯ç”¨äºHostå’Œtaskä¸­ã€‚\n    ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå…¶é€šè¿‡sudoçš„æ–¹å¼åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡ï¼Œå…¶å¯ç”¨äºplayå…¨å±€æˆ–æŸä»»åŠ¡ï¼›\n    æ­¤å¤–ï¼Œç”šè‡³å¯ä»¥åœ¨sudoæ—¶ä½¿ç”¨sudo_useræŒ‡å®šsudoæ—¶åˆ‡æ¢çš„ç”¨æˆ·\n    - hosts: all\n      remote_user: root   (å¯çœç•¥,é»˜è®¤ä¸ºroot)  ä»¥rootèº«ä»½è¿æ¥\n      tasks:    æŒ‡å®šä»»åŠ¡\n      - name: test connection\n        ping:\n          remote_user: magedu\n          sudo: yes           é»˜è®¤sudoä¸ºroot\n          sudo_user:wang      sudoä¸ºwang\n```\n\n```\ntaskåˆ—è¡¨å’Œaction\n    ä»»åŠ¡åˆ—è¡¨task:ç”±å¤šä¸ªåŠ¨ä½œ,å¤šä¸ªä»»åŠ¡ç»„åˆèµ·æ¥çš„,æ¯ä¸ªä»»åŠ¡éƒ½è°ƒç”¨çš„æ¨¡å—,ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ¨¡å—æ‰§è¡Œ\n    1> playçš„ä¸»ä½“éƒ¨åˆ†æ˜¯task listï¼Œtask listä¸­çš„å„ä»»åŠ¡æŒ‰æ¬¡åºé€ä¸ªåœ¨hostsä¸­æŒ‡å®šçš„æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œï¼Œ\n       å³åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®Œæˆç¬¬ä¸€ä¸ªä»»åŠ¡åï¼Œå†å¼€å§‹ç¬¬äºŒä¸ªä»»åŠ¡\n\n    2> taskçš„ç›®çš„æ˜¯ä½¿ç”¨æŒ‡å®šçš„å‚æ•°æ‰§è¡Œæ¨¡å—ï¼Œè€Œåœ¨æ¨¡å—å‚æ•°ä¸­å¯ä»¥ä½¿ç”¨å˜é‡ã€‚\n   æ¨¡å—æ‰§è¡Œæ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€å¤šæ¬¡æ‰§è¡Œæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå…¶ç»“æœå‡ä¸€è‡´\n\n    3> æ¯ä¸ªtaskéƒ½åº”è¯¥æœ‰å…¶nameï¼Œç”¨äºplaybookçš„æ‰§è¡Œç»“æœè¾“å‡ºï¼Œå»ºè®®å…¶å†…å®¹èƒ½æ¸…æ™°åœ°æè¿°ä»»åŠ¡æ‰§è¡Œæ­¥éª¤ã€‚\n   å¦‚æœæœªæä¾›nameï¼Œåˆ™actionçš„ç»“æœå°†ç”¨äºè¾“å‡º\n```\n\n## playbookä¹¦å†™é£æ ¼\n\nç®€å•æ¡ˆä¾‹ï¼š\n\nç¼–å†™echo.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹\n\n```\nvim echo.yaml\n---\n- hosts: 192.168.48.102\n  tasks:\n  - name: è¾“å‡º1\n    shell: echo \"1\"\n  - name: è¾“å‡º2\n    shell: echo \"2\"\n...\n#æ‰§è¡Œè¯¥å‰§æœ¬æ–‡ä»¶ï¼š\nansible-playbook echo.yaml  \n```\n\nå‘½ä»¤æ‰§è¡Œè¿”å›çš„ç»“æœ:\n\nç¬¬ä¸€è¡ŒPLAYè¡¨ç¤ºæ‰§è¡Œçš„ä¸»æœºæˆ–è€…ä¸»æœºç»„ã€‚\nç¬¬äºŒè¡ŒTASK[Gathering Facts]ï¼Œåœ¨ Playbook ä¸­å¹¶æ²¡æœ‰å®šä¹‰ï¼Œè¿™æ˜¯Ansibleè‡ªå¸¦çš„task æ”¶é›†ä¸»æœºçš„ä¿¡æ¯ï¼Œæ­¤åŠŸèƒ½éå¸¸å®ç”¨ï¼Œåé¢çš„ä»»åŠ¡ä¸­ä¼šè¯¦ç»†è®²è§£ã€‚è¿™é‡Œä»…éœ€çŸ¥æ™“taskä¸ºAnsibleè‡ªå¸¦çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡Playbookä¸­æ·»åŠ  gather_facts: no è¿›è¡Œå…³é—­ã€‚\nä¸‹é¢ä¸¤ä¸ªtaskæ˜¯è‡ªè¡Œç¼–è¾‘çš„taskï¼Œå¯ä»¥å‘ç°æ²¡æœ‰è¿”å›ç»“æœï¼Œä½†æ˜¯å½“å‡ºç°é»„è‰²çš„changedæ—¶ä»£è¡¨æ‰§è¡Œæˆ–è€…ä¿®æ”¹æˆåŠŸã€‚changedä»£è¡¨å‰åçŠ¶æ€å‘ç”Ÿæ”¹å˜,ä¾‹å¦‚ä½¿ç”¨copyæ¨¡å—ï¼Œæ‹·è´åŒä¸€ä¸ªä¸œè¥¿ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡ŒæˆåŠŸçš„æ—¶å€™æ˜¯changedçŠ¶æ€ï¼Œç¬¬äºŒæ¬¡å†æ‰§è¡Œçš„æ—¶å€™å°±æ˜¯okçŠ¶æ€ã€‚okçŠ¶æ€ä»£è¡¨:Ansibleæ£€æŸ¥äº†éœ€è¦æ›´æ”¹çš„å†…å®¹å‘ç°å‰åæ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›okçŠ¶æ€ï¼Œå®é™…ä¸Š Ansibleå¹¶æ²¡æœ‰å»æ‰§è¡Œè¯¥æ“ä½œã€‚æœ€åä»£è¡¨çŠ¶æ€,å³ Playbookçš„æ‰§è¡Œç»“æœã€‚okè¡¨ç¤ºæ£€æŸ¥äº†ä½†ä¸éœ€è¦æ“ä½œçš„ä»»åŠ¡é‡ã€‚failedè¡¨ç¤ºæ‰§è¡Œå¤±è´¥çš„æ•°é‡ï¼ŒchangRedä»£è¡¨çŠ¶unreachableè¡¨ç¤ºä¸å¯è¾¾çš„ä¸»æœºæ•°æ€æ›´æ”¹çš„æ•°é‡ï¼Œok+changed æ‰ä»£è¡¨æ‰§è¡Œå®Œæˆçš„ä»»åŠ¡æ•°é‡ã€‚\n\n## ç¼–å†™playbook\n\n```yaml\nvim httpd.yaml\n--- ##åˆ—å‡ºç¬¬ä¸€ä¸ªplay \n- name: Install httpd package and start httpd service ##æ ‡æ˜ è¯¥playçš„ç”¨é€” \n  hosts: 192.168.142.101 ##æŒ‡å®šå¯¹å…¶è¿è¡Œplayä¸­ä»»åŠ¡çš„ä¸»æœºï¼ˆå¿…å¡«é¡¹ï¼ŒæŒ‡å®šå¤šå°ä¸»æœºå¯ä»¥ä½¿ç”¨åˆ†ç»„ï¼Œæˆ–è€… , åˆ†éš”ï¼‰ \n  tasks: ##playçš„ä»»åŠ¡åˆ—è¡¨ \n  - name: Install httpd package ##ä»»åŠ¡1çš„æè¿° \n    yum: ##ä»»åŠ¡1è°ƒç”¨yumæ¨¡å—ï¼Œæ¨¡å—å†…å®¹å¾€ä¸‹å†™ \n      name: httpd ##å‚æ•°1ï¼šyumæ¨¡å—éœ€è¦ä½¿ç”¨çš„è½¯ä»¶åŒ… \n      state: present ##å‚æ•°2ï¼šå®‰è£…è½¯ä»¶åŒ…#ä»¥ä¸Šä»»åŠ¡ç­‰åŒäº ansible 192.168.142.101 -m yum -a \"name=httpd state=present\" \n\n  - name: Start httpd service ##ä»»åŠ¡2çš„æè¿° \n    service: ##ä»»åŠ¡2è°ƒç”¨æœåŠ¡æ¨¡å— \n      name: httpd ##å‚æ•°1ï¼šserviceè°ƒç”¨çš„æœåŠ¡åç§° \n      state: started ##å‚æ•°2ï¼šserviceè°ƒç”¨æœåŠ¡è¦è¾¾åˆ°çš„ç›®æ ‡çŠ¶æ€ \n      enabled: yes ##å‚æ•°3ï¼šè°ƒç”¨çš„æœåŠ¡å¼€æœºå¯åŠ¨ \n#ä»¥ä¸Šä»»åŠ¡ç­‰åŒäº ansible 192.168.142.101 -m service -a \"name=httpd state=started enabled=yes\" \n```\n\n![image-20221114191416282](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/d3e9b9147d35e3d3f3456b1054e3fafa697559838.png)\n\n## è¿è¡Œplaybook\n\n```\nè¿è¡Œplaybookçš„æ–¹å¼\n    ansible-playbook <filename.yaml> ... [options]\n\nå¸¸è§é€‰é¡¹\n    --check -C       åªæ£€æµ‹å¯èƒ½ä¼šå‘ç”Ÿçš„æ”¹å˜ï¼Œä½†ä¸çœŸæ­£æ‰§è¡Œæ“ä½œ \n                     (åªæ£€æŸ¥è¯­æ³•,å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜,-Cæ— æ³•æ£€æµ‹å‡ºæ¥)\n                     (æ‰§è¡Œplaybookç”Ÿæˆçš„æ–‡ä»¶ä¸å­˜åœ¨,åé¢çš„ç¨‹åºå¦‚æœä¾èµ–è¿™äº›æ–‡ä»¶,ä¹Ÿä¼šå¯¼è‡´æ£€æµ‹å¤±è´¥)\n    --list-hosts     åˆ—å‡ºè¿è¡Œä»»åŠ¡çš„ä¸»æœº\n    --list-tags      åˆ—å‡ºtag  (åˆ—å‡ºæ ‡ç­¾)\n    --list-tasks     åˆ—å‡ºtask (åˆ—å‡ºä»»åŠ¡)\n    --limit ä¸»æœºåˆ—è¡¨ åªé’ˆå¯¹ä¸»æœºåˆ—è¡¨ä¸­çš„ä¸»æœºæ‰§è¡Œ\n    -v -vv -vvv      æ˜¾ç¤ºè¿‡ç¨‹\n\nç¤ºä¾‹\n    ansible-playbook hello.yaml --check åªæ£€æµ‹\n    ansible-playbook hello.yaml --list-hosts  æ˜¾ç¤ºè¿è¡Œä»»åŠ¡çš„ä¸»æœº\n    ansible-playbook hello.yaml --limit 192.168.142.101  é™åˆ¶ä¸»æœº\n    ansible-playbook hello.yaml --list-tasks  æ˜¾ç¤ºè¿è¡Œä»»åŠ¡çš„ä¸»æœº\n\n```\n\n**1ã€åœ¨ansibleå·¥ä½œç›®å½•è¿è¡Œ** å®Œæ•´å‰§æœ¬ï¼šhttpd.yaml\n\n```\næ‰§è¡Œå‰§æœ¬\nansible-playbook playbooks/httpd.yaml\néªŒè¯æœåŠ¡\nansible 192.168.142.101 -m shell -a 'rpm -qa |grep httpd'\nansible 192.168.142.101 -m shell -a 'netstat -ntulp |grep 80'\n```\n\n![image-20221025160724333](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/7f7fc00f8a894e4ae4cd203a40586c6f697559838.png)\n\n**2.æé«˜è¾“å‡ºçš„è¯¦ç»†ç¨‹åº¦**\n\n![image-20221025160900182](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/fd3bad2b52a5e7a286d566f404cd32c3697559838.png)\n\næ³¨ï¼šé€šå¸¸ä½¿ç”¨ ansible-playbook -v å³å¯ã€‚\n\n![image-20221025160914676](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ebc8eb622e0c51ce411c8fc6e565b080697559838.png)\n\n**3.æ‰§è¡Œç©ºè¿è¡Œï¼ˆå†’çƒŸè¿è¡Œï¼‰**\n\n![image-20221025160948414](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/fa4468962ea4914e6af8862b73fc400c697559838.png)\n\n![image-20221025160959873](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/8dc2f2b09e7590c3e41c6707c5e3cbcd697559838.png)\n\n## handlers+notify\n\nHandlers å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª<font color='red'>è§¦å‘</font>å™¨ï¼Œæ˜¯taskåˆ—è¡¨ï¼Œè¿™äº›taskä¸å‰è¿°çš„taskå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒ,ç”¨äºå½“å…³æ³¨çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡‡å–ä¸€å®šçš„æ“ä½œã€‚ä»»åŠ¡éƒ½æœ‰çŠ¶æ€changedæˆ–è€…okï¼Œåªæœ‰åœ¨ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ä¸ºchangeæ—¶ï¼Œæ‰æ‰§è¡Œè¯¥ä»»åŠ¡è°ƒç”¨çš„handlerã€‚\n\nNotifyæ­¤actionå¯ç”¨äºåœ¨æ¯ä¸ªplayçš„æœ€åè¢«è§¦å‘ï¼Œè¿™æ ·å¯é¿å…å¤šæ¬¡æœ‰æ”¹å˜å‘ç”Ÿæ—¶æ¯æ¬¡éƒ½æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œä»…åœ¨æ‰€æœ‰çš„å˜åŒ–å‘ç”Ÿå®Œæˆåä¸€æ¬¡æ€§åœ°æ‰§è¡ŒæŒ‡å®šæ“ä½œã€‚åœ¨notifyä¸­åˆ—å‡ºçš„æ“ä½œç§°ä¸ºhandlerï¼Œä¹Ÿ<font color='red'>å³notifyä¸­è°ƒç”¨handlerä¸­å®šä¹‰çš„æ“ä½œ</font>\n\n\n\n<font color='red'>ç¤ºä¾‹1ï¼š</font>\n\n1. ä½¿ç”¨playbookå®‰è£…httpdï¼Œå¹¶éªŒè¯æœåŠ¡å¯åŠ¨ï¼ŒæŸ¥çœ‹httpdä½¿ç”¨çš„ç«¯å£\n\n```shell\nvim httpd3.yaml\n---\n- hosts: all\n  remote_user: root\n\n  tasks:\n  - name: Install httpd\n    yum:\n      name: httpd\n      state: present\n  - name: ensure apache is running\n    service:\n      name: httpd\n      state: started\n      enabled: yes\n\nansible-playbook httpd3.yaml\nansible all -m shell -a 'systemctl status httpd'\nansible all -m shell -a 'netstat -tunlp|grep httpd'\n```\n\n2. åœ¨è¢«æ§ç«¯ï¼ˆ<font color='red'>ä¸¤å°æœº</font>ï¼‰ä¿®æ”¹httpdçš„confæ–‡ä»¶ï¼Œç›‘å¬ç«¯å£æ”¹æˆ8080\n\n```yaml\nmkdir -p /root/ansible/files\ncp /etc/httpd/conf/httpd.conf  /root/ansible/files\n#å¦‚æœå‰é¢httpd3è¿è¡ŒæˆåŠŸï¼Œè¯´æ˜æˆåŠŸå®‰è£…httpdï¼Œåˆ™httpd.confä¼šå­˜åœ¨\nvim /root/ansible/files/httpd.conf\n#å°†Listen 80 ä¿®æ”¹ä¸ºListen 8080\n```\n\n3. ä¿®æ”¹å‰§æœ¬æ–‡ä»¶ï¼Œå¢åŠ æ‹·è´é…ç½®æ–‡ä»¶çš„taskï¼Œå¹¶é‡æ–°æ‰§è¡Œå‰§æœ¬ã€‚\n\n```yaml\nvim httpd4.yaml\n---\n- hosts: all\n  remote_user: root\n  tasks:   \n  - name: Install httpd\n    yum:\n      name: httpd\n      state: present\n  - name: backup httpd.conf\n    shell: cp /etc/httpd/conf/httpd.conf{,.bak}\n  #å¤‡ä»½åŸæ–‡ä»¶\n  - name: copy configure file\n    copy: \n      src: /root/ansible/files/httpd.conf \n      dest: /etc/httpd/conf/\n      backup: yes\n  #ç¬¬äºŒæ­¥ä¿®æ”¹äº†8080ç«¯å£ï¼Œå°†æ–‡ä»¶ç§»å›åŸå¤„è¦†ç›–æºæ–‡ä»¶\n  - name: ensure apache is running\n    service:\n      name: httpd\n      state: started\n      enabled: yes\n\nansible-playbook httpd4.yaml\nansible all -m shell -a 'cat /etc/httpd/conf/httpd.conf|grep 8080'\nansible all -m shell -a 'systemctl status httpd'\nansible all -m shell -a 'netstat -tunlp|grep httpd'\n#å‘ç°ä¿®æ”¹é…ç½®ï¼Œä½†æ²¡æœ‰ç”Ÿæ•ˆï¼Œå› ä¸ºæ²¡æœ‰é‡å¯httpdåº”ç”¨\n```\n\n3. å¢åŠ handlerså’Œnotify\n\n```yaml\nvim httpd4.yaml\n---\n- hosts: all\n  remote_user: root\n  tasks:   \n  - name: Install httpd\n    yum:\n      name: httpd\n      state: present\n  - name: copy configure file\n    copy: \n      src: /root/ansible/files/httpd.conf \n      dest: /etc/httpd/conf/\n      backup: yes\n    #è°ƒç”¨è§¦å‘åˆ—è¡¨é‡Œçš„ restart httpdä»»åŠ¡ï¼Œè°ƒç”¨ä¹‹åé‡å¯httpdï¼Œé…ç½®æ–‡ä»¶å³åˆ»ç”Ÿæ•ˆ\n    notify: restart httpd\n  - name: ensure apache is running\n    service:\n      name: httpd\n      state: started\n      enabled: yes\n#è§¦å‘å™¨åˆ—è¡¨\n  handlers:\n  - name: restart httpd\n    service: \n      name: httpd \n      state: restarted\n        \n        \nansible-playbook httpd4.yaml\nansible all -m shell -a 'netstat -tunlp|grep httpd'\nå‘ç°ç«¯å£æ˜¯8080ï¼ˆå³æˆåŠŸï¼‰\n```\n\nä¿®æ”¹/root/ansible/files/httpd.conf ï¼Œå°†ç«¯å£ä¿®æ”¹ä¸º8081ï¼Œé‡æ–°æ‰§è¡Œhttpd4.yamlï¼Œå¹¶éªŒè¯æœåŠ¡ç«¯å£å·²ç»æ”¹å˜ã€‚\n\n```\nansible-playbook httpd4.yaml\nansible all -m shell -a 'netstat -tunlp|grep httpd'\n```\n\nå‘ç°ç«¯å£å˜æˆ8081ï¼Œè¯´æ˜åªæœ‰åœ¨ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ä¸ºchangeæ—¶ï¼Œæ‰æ‰§è¡Œè¯¥ä»»åŠ¡è°ƒç”¨çš„handlerã€‚\n\n## TAGS\n\n<font color='red'>tage: æ·»åŠ æ ‡ç­¾ </font>\n<font color='orange'>å¯ä»¥æŒ‡å®šæŸä¸€ä¸ªä»»åŠ¡æ·»åŠ ä¸€ä¸ªæ ‡ç­¾,æ·»åŠ æ ‡ç­¾ä»¥å,æƒ³æ‰§è¡ŒæŸä¸ªåŠ¨ä½œå¯ä»¥åšå‡ºæŒ‘é€‰æ¥æ‰§è¡Œ,å¤šä¸ªåŠ¨ä½œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªæ ‡ç­¾</font>\n\nåœæ­¢httpdæœåŠ¡\n\n```\nansible all -m service -a 'name=httpd  state=stopped'\nansible all -m shell -a 'ss -tln |grep :8081'\n```\n\n```yaml\n[root@controller ~]# vi httpd5.yaml\n---\n- hosts: all\n  remote_user: root\n  tasks:\n  - name: install httpd\n    yum:\n      name: httpd\n      state: present\n    tags: install #installæ ‡ç­¾\n  - name: set listen8080\n    shell: sed -i \"s/Listen 80/Listen 8080/g\" /etc/httpd/conf/httpd.conf\n    tags: set8080 #è®¾ç½®8080æ ‡ç­¾\n  - name: backup cofing\n    copy:\n      src: /etc/httpd/conf/httpd.conf\n      dest: /etc/httpd/conf/httpd.conf\n      backup: yes\n    notify: restart httpd\n    tags: backup #å¤‡ä»½æ ‡ç­¾\n  - name: é…ç½® httpd æœåŠ¡\n    service:\n      name: httpd\n      state: started\n      enabled: yes\n    tags: started #å¼€å¯httpdæœåŠ¡æ ‡ç­¾\n  handlers:\n  - name: restart httpd\n    service:\n      name: httpd\n      state: restarted\n    tags: restart  #é‡å¯æœåŠ¡æ ‡ç­¾\n...\n\n```\n\n```yaml\nansible-playbook -tstarted httpd5.yaml   \n#æŒ‡å®šæ‰§è¡Œstarted è¿™ä¸ªæ ‡ç­¾\nansible all -m shell -a 'ss -tln |grep :8080'\nansible-playbook -t install,conf httpd.yaml   \n#æŒ‡å®šæ‰§è¡Œinstall,backup ä¸¤ä¸ªæ ‡ç­¾\n```\n\n## ç®¡ç†å˜é‡\n\n![image-20221025165509586](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ae1d61c9756b2d4c0b078b277db79758697559838.png)\n\nå˜é‡å®šä¹‰ï¼škey=value\n    ç¤ºä¾‹ï¼šhttp_port=80\n\nå˜é‡è°ƒç”¨æ–¹å¼ï¼š\n    1> é€šè¿‡{{ variable_name }} è°ƒç”¨å˜é‡ï¼Œ<font color='red'>ä¸”å˜é‡åå‰åå¿…é¡»æœ‰ç©ºæ ¼</font>ï¼Œæœ‰æ—¶ç”¨\"{{ variable_name }}\"æ‰ç”Ÿæ•ˆ (<font color='red'>å¼•å·</font>ï¼‰\n\n### åœ¨playbookä¸­å®šä¹‰\n\nvarsè¯­å¥å®šä¹‰å…¨å±€å˜é‡ï¼ˆè¯¥å˜é‡ä½œç”¨äºæ•´ä¸ªPlayï¼‰ \n\n```yaml\nvim test_vars.yaml\n\n---\n- name: test_var\n  hosts: all\n  vars:\n    username: test_user1\n  tasks:\n  - name:  create user via a variable file\n    user:\n      name: \"{{ username }}\"    \n      #å†’å·åé¢ä¸èƒ½ä»¥{å¼€å¤´ï¼Œä¸ç„¶ä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼Œéœ€è¦åŠ ä¸Šå¼•å·ã€‚\n      state: present\n#åˆ›å»ºä¸€ä¸ªtest_user1çš„ç”¨æˆ·\n \n ansible-playbook -v test_vars.yaml \n \n ansible all -m shell -a 'getent passwd test_user1'\n```\n\n![image-20221025165757353](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/474483b4ac7c6bae8c1f67e44e1488a2697559838.png)\n\næ‰§è¡Œç»“æœï¼š \n\n![image-20221025165815465](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/6a81099b1493d280df6d9bc47ddc7034697559838.png)\n\n#### è¯¾å ‚ç»ƒä¹ \n\né€šè¿‡playbookä¸­å®šä¹‰ç”¨æˆ·åå’Œç»„åï¼Œå®ç°å˜é‡å¼•ç”¨ï¼Œåˆ›å»ºç”¨æˆ·å’Œç»„ã€‚\n\n```yaml\nvim var.yaml\n---\n- hosts: all\n  remote_user: root\n  vars:\n  - username: user1\n  - groupname: group1\n  tasks:\n  - name: create group\n    group: \n      name: \"{{ groupname }}\" \n      state: present\n  - name: create user\n    user: \n      name: \"{{ username }}\" \n      state: present\n\nansible-playbook -v var.yaml\nansible all -m shell -a 'getent passwd user1'\nansible all -m shell -a 'getent group group1'\n```\n\n2.\n\n```yaml\nå¼€å¯é˜²ç«å¢™\nansible all -m shell -a 'systemctl start firewalld'\n\nvim firewall.yaml\n---\n- hosts: all\n  remote_user: root\n  vars:\n  - http_port: 80\n  tasks:\n  - name: insert firewalld rule for httpd\n    firewalld: \n      port: \"{{ http_port }}/tcp\" \n      permanent: true \n      state: enabled \n      immediate: yes\n    \nansible-playbook -v firewall.yaml\n\nansible all -m shell -a 'systemctl stop firewalld'\nansible all -m shell -a 'firewall-cmd --query-port=80/tcp'  \n```\n\n### åœ¨ç‹¬ç«‹çš„å˜é‡YAMLæ–‡ä»¶ä¸­å®šä¹‰\n\nå½“å˜é‡è¾ƒå¤šçš„æ—¶å€™ï¼Œæˆ–è€…å˜é‡éœ€è¦å¤šä¸ªplaybooké‡ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠå˜é‡æ”¾åˆ°ç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œé€šè¿‡å…³é”®å­—\"var_files\"æŠŠæ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡å¼•ç”¨åˆ°playbookä¸­ã€‚\n\nvars_files å¼•ç”¨å˜é‡æ–‡ä»¶ï¼ˆåªèƒ½æ‰€ç”¨äºPlayå…¨å±€ï¼Œä¸èƒ½åœ¨æŸä¸ªtaskä¸­å•ç‹¬è¢«å¼•ç”¨ï¼‰\n\n```yaml\nvim var_file.yaml\nusername: test_user3\n\nvim test_var_file.yaml\n---\n- name: test_var_file\n  hosts: all\n  vars_files:\n  - /root/var_file.yaml\n  tasks:\n  - name:  create user via a variable file\n    user:\n      name: \"{{ username }}\"\n      state: present\n...\n \n ansible-playbook -v test_var_file.yaml\n \n ansible all -m shell -a 'getent passwd test_user3'\n\n```\n\nç»ƒä¹ ï¼šå°†é˜²ç«å¢™ç«¯å£å†™å…¥\n\n```yaml\nå°†å˜é‡å†™è¿›å•ç‹¬çš„é…ç½®æ–‡ä»¶ä¸­å¼•ç”¨\ntest_var_file.yaml\n---\n- hosts: all\n  remote_user: root\n  vars_files:\n  - /root/var_file.yaml\n  tasks:\n  - name: insert firewalld rule for httpd\n    firewalld: \n      port: \"{{ http_port }}/tcp\" \n      permanent: true \n      state: enabled \n      immediate: yes\n...\nvim var_file.yaml\nhttp_port: 78\n\nansible-playbook -v test_var_file.yaml\nansible all -m shell -a 'firewall-cmd --query-port=78/tcp'  \n```\n\n### è¿œç¨‹ä¸»æœºä¸Šçš„ç³»ç»Ÿå˜é‡ï¼ˆFactsäº‹å®ï¼‰\n\nansibleä¼šé€šè¿‡setupæ¨¡å—æ¥æœé›†ä¸»æœºçš„ç³»ç»Ÿä¿¡æ¯ï¼Œè¿™äº›æœé›†åˆ°çš„ç³»ç»Ÿä¿¡æ¯å«åšFactsã€‚\n\n![image-20221026102238684](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/24c7b2090b6a9419a3aefc79545adba5697559838.png)\n\næ¯ä¸ªplaybookåœ¨æ‰§è¡Œå‰éƒ½ä¼šé»˜è®¤æ‰§è¡Œsetupæ¨¡å—ï¼Œæ‰€ä»¥è¿™äº›factsä¿¡æ¯æ˜¯å¯ä»¥ä»¥å˜é‡çš„å½¢å¼è¢«ä½¿ç”¨ã€‚\n\n#### æŸ¥çœ‹Factså˜é‡\n\n```yaml\nansible all -m setup èƒ½æŸ¥çœ‹åˆ°nodeèŠ‚ç‚¹çš„æ‰€æœ‰ä¿¡æ¯\nansible 192.168.48.101 -m setup |grep ansible_hostname\næˆ–è€…å¯ä»¥ä½¿ç”¨filterè¿‡æ»¤ä¿¡æ¯\nansible all -m setup -a 'filter=\"ansible_hostname\"'  æŸ¥è¯¢ä¸»æœºå\nansible all -m setup -a 'filter=\"ansible_default_ipv4\"'  æŸ¥è¯¢ipv4åœ°å€\nansible all -m setup -a \"filter=ansible_memory_mb\"æŸ¥è¯¢å†…å­˜\n\n\nå…¶ä»–å¸¸ç”¨ä¿¡æ¯åˆ—å‡ºå¦‚ä¸‹ï¼š\nansible_all_ipv4_addressesï¼šä»…æ˜¾ç¤ºipv4çš„ä¿¡æ¯ã€‚\nansible_devicesï¼šä»…æ˜¾ç¤ºç£ç›˜è®¾å¤‡ä¿¡æ¯ã€‚\nansible_distributionï¼šæ˜¾ç¤ºæ˜¯ä»€ä¹ˆç³»ç»Ÿï¼Œä¾‹ï¼šcentos,suseç­‰ã€‚\nansible_distribution_major_versionï¼šæ˜¾ç¤ºæ˜¯ç³»ç»Ÿä¸»ç‰ˆæœ¬ã€‚\nansible_distribution_versionï¼šä»…æ˜¾ç¤ºç³»ç»Ÿç‰ˆæœ¬ã€‚\nansible_machineï¼šæ˜¾ç¤ºç³»ç»Ÿç±»å‹ï¼Œä¾‹ï¼š32ä½ï¼Œè¿˜æ˜¯64ä½ã€‚\nansible_eth0ï¼šä»…æ˜¾ç¤ºeth0çš„ä¿¡æ¯ã€‚\nansible_hostnameï¼šä»…æ˜¾ç¤ºä¸»æœºåã€‚\nansible_kernelï¼šä»…æ˜¾ç¤ºå†…æ ¸ç‰ˆæœ¬ã€‚\nansible_lvmï¼šæ˜¾ç¤ºlvmç›¸å…³ä¿¡æ¯ã€‚\nansible_memtotal_mbï¼šæ˜¾ç¤ºç³»ç»Ÿæ€»å†…å­˜ã€‚\nansible_memfree_mbï¼šæ˜¾ç¤ºå¯ç”¨ç³»ç»Ÿå†…å­˜ã€‚\nansible_memory_mbï¼šè¯¦ç»†æ˜¾ç¤ºå†…å­˜æƒ…å†µã€‚\nansible_swaptotal_mbï¼šæ˜¾ç¤ºæ€»çš„swapå†…å­˜ã€‚\nansible_swapfree_mbï¼šæ˜¾ç¤ºswapå†…å­˜çš„å¯ç”¨å†…å­˜ã€‚\nansible_mountsï¼šæ˜¾ç¤ºç³»ç»Ÿç£ç›˜æŒ‚è½½æƒ…å†µã€‚\nansible_processorï¼šæ˜¾ç¤ºcpuä¸ªæ•°(å…·ä½“æ˜¾ç¤ºæ¯ä¸ªcpuçš„å‹å·)ã€‚\nansible_processor_vcpusï¼šæ˜¾ç¤ºcpuä¸ªæ•°(åªæ˜¾ç¤ºæ€»çš„ä¸ªæ•°)ã€‚\n```\n\n#### ä½¿ç”¨Factså˜é‡\n\n```yaml\nvim var2.yaml\n---\n- hosts: all\n  remote_user: root\n  tasks:\n  - name: create log file\n    file: \n      name: /root/{{ ansible_hostname }} \n      state: touch\n\nansible-playbook var2.yaml\n\nansible all -m shell -a 'ls /root|grep node*'\n```\n\n#### å¤æ‚Factså˜é‡çš„ä½¿ç”¨\n\n![image-20231002194745624](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/cd3caf0b2d86c1b4b3865e00a3b021b6697559838.png)\n\næ–¹å¼1ï¼šä½¿ç”¨ä¸­æ‹¬å·\n\n```\n{{ ansible_date_time[\"date\"] }}\n```\n\næ–¹å¼2ï¼šä½¿ç”¨ç‚¹å·ï¼ˆ<font color='red'>æ¨è</font>ï¼‰\n\n```\n{{ ansible_date_time.date }}\n```\n\n```yaml\nvim var2.yaml\n---\n- hosts: all\n  remote_user: root\n  tasks:\n  - name: 22\n    copy:\n      content: \"{{ ansible_date_time.date }}\"\n      dest: /tmp/f1\n\nansible-playbook var2.yaml\n\nansible all -m shell -a 'cat /tmp/f1'\n```\n\n#### å…³é—­Facts\n\næœé›†factsä¼šæ¶ˆè€—é¢å¤–æ—¶é—´ï¼Œå¯ä»¥åœ¨å‰§æœ¬ä¸­è®¾ç½®æ˜¯å¦å¼€å¯å’Œå…³é—­factsæœé›†ã€‚\n\nå¼€å¯gather_facts:yesï¼Œå…³é—­gather_facts:no\n\n![image-20221026112345723](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/56eb52bea0d5b4c256492463c0e30800697559838.png)\n\n### åœ¨/etc/ansible/hosts(ä¸»æœºæ¸…å•)ä¸­å®šä¹‰å˜é‡\n\n<font color='red'>æ™®é€šå˜é‡</font>ï¼šä¸»æœºç»„ä¸­ä¸»æœºå•ç‹¬å®šä¹‰ï¼Œä¼˜å…ˆçº§é«˜äºå…¬å…±å˜é‡(å•ä¸ªä¸»æœº )\n<font color='red'>å…¬å…±(ç»„)å˜é‡</font>ï¼šé’ˆå¯¹ä¸»æœºç»„ä¸­æ‰€æœ‰ä¸»æœºå®šä¹‰ç»Ÿä¸€å˜é‡(ä¸€ç»„ä¸»æœºçš„åŒä¸€ç±»åˆ«)\n\nå¯ä»¥æ˜¯ä¸»æœºçº§åˆ«æˆ–è€…æ˜¯ä¸»æœºç»„çº§åˆ«çš„ \n\n**å®šä¹‰ä¸»æœºçº§åˆ«å˜é‡**\n\n```\nvim  /etc/ansible/hosts\n[all]\n192.168.48.101 username=test_user3   #ä¸»æœºçº§åˆ«å˜é‡\n192.168.48.102 username=test_user4  \n\n```\n\nç¼–è¾‘å‰§æœ¬æ–‡ä»¶\n\n```\nvim test_vars2.yaml\n---\n- name: test inventory vars\n  hosts: all\n  tasks:\n  - name:  create user via a variable file\n    user:\n      name: \"{{ username }}\"\n      state: present\n\nansible-playbook -v test_vars2.yaml \n \nansible all -m shell -a 'getent passwd test_user3'\nansible all -m shell -a 'getent passwd test_user4'\n```\n\n**ä¸»æœºç»„çº§åˆ«å®šä¹‰å˜é‡ï¼ˆç›¸å¯¹äºä¸»æœºçº§åˆ«å®šä¹‰çš„å˜é‡ï¼Œä¼˜å…ˆçº§è¾ƒä½ï¼‰**\n\n```\nvim  /etc/ansible/hosts\n[all]\n192.168.142.101 username=test_user3   #ä¸»æœºçº§åˆ«å˜é‡\n192.168.142.102   \n\n[all:vars]\nusername=test_user5\n\nansible-playbook -v test_vars2.yaml \nå‘ç°ç¬¬ä¸€å°ä¸»æœºä¸å˜ï¼Œç¬¬äºŒå°ä¸»æœºåˆ›å»ºæ–°çš„ç”¨æˆ·test_user5,è¯æ˜ä¸»æœºç»„å˜é‡æ¯”ä¸»æœºå˜é‡ä¼˜å…ˆçº§ä½\n```\n\n### é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šå˜é‡\n\n```\nansible-playbook -e å˜é‡ å‰§æœ¬ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰\n\nansible-playbook -v -e username=test_user10 test_vars2.yaml \n```\n\n![image-20231002210715495](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/263bfcf810cb6203d0f09bfc2cab051a697559838.png)\n\n\n\nå®‰è£…httpdæœåŠ¡\n\n```\nç¤ºä¾‹ï¼štest_vars3.yaml \n---\n- hosts: all\n  remote_user: root\n  tasks:\n  - name: install package\n    yum:\n      name: \"{{ pkname }}\"\n      state: present\n  - name: start service\n    service:\n      name: \"{{ pkname }}\"\n      state: started\n      enabled: yes\n\n\nansible-playbook â€“e pkname=httpd test_vars3.yaml \n```\n\n\n\n```\nç¤ºä¾‹ï¼štest_vars3.yaml \n---\n- hosts: all\n  remote_user: root\n  tasks:\n  - name: install package\n    yum: \n      name: \"{{ pkname1 }}\" \n      state: present\n  - name: install package\n    yum: \n      name: \"{{ pkname2 }}\" \n      state: present\n  \nansible-playbook -e 'pkname1=httpd pkname2=tree' -v test_vars3.yaml \n```\n\n### å¤æ‚å˜é‡çš„ä½¿ç”¨\n\n#### **æ•°ç»„**\n\nå¦‚æœæˆ‘ä»¬å®šä¹‰å˜é‡ï¼Œè€Œè¿™äº›å€¼éƒ½å±äºåŒä¸€ç±»å‹çš„å…ƒç´ ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…å®šè¦ç”¨æ•°ç»„ã€‚\n\nä¾‹å¦‚ï¼š\n\n```\nvim test_com_var.yaml\n\n---\n- hosts: all\n  vars:\n    user_name:\n    - test_user11\n    - test_user12\n    - test_user13\n    - test_user14\n  tasks:\n  - name: create users\n    user:\n      name: \"{{ user_name[1] }}\"\n      state: present\n```\n\n![image-20221115081508398](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/6f57de99c88237b43b4ccbc3a67c02d4697559838.png)\n\néªŒè¯ï¼šansible-playbook -v test_com_var.yaml\n\n![image-20221026101059249](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/b254ba1554853d1d124698f5bdd079cd697559838.png)\n\næ³¨æ„ï¼šåœ¨ç”¨useræ¨¡å—å»ºç”¨æˆ·çš„æ—¶å€™ï¼Œåªèƒ½è°ƒç”¨æ•°ç»„ä¸­çš„æŸä¸€ä¸ªå€¼ï¼Œä¸èƒ½å…¨éƒ¨è°ƒç”¨ï¼Œå¦åˆ™æŠ¥é”™â€œç”¨æˆ·åä¸åˆæ³•â€\n\n![image-20221026101118216](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/2bc27ba298e15057aac6e29976c63050697559838.png)\n\n![image-20221115081951322](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/ed1ae8495f0953b23e7e6a5944652254697559838.png)\n\n#### å­—å…¸ï¼ˆdictionaryï¼‰\n\nå¦‚æœæˆ‘ä»¬çš„å˜é‡ä¿¡æ¯ä¸­å…·å¤‡å¤šç§ä¸åŒçš„å…ƒç´ æ—¶ï¼Œé‡‡ç”¨å­—å…¸ã€‚\n\nä¾‹å¦‚ï¼š\n\n```\nvim test_com_var.yaml\n\n---\n- name: test_dict\n  hosts: all\n  vars:\n    user_info:\n      test_user20:\n        name: test_user20\n        shell: /bin/bash\n        comment: test_user20\n      test_user21:\n        name: test_user21\n        shell: /bin/bash\n        comment: test_user21\n  tasks:\n  - name: create users via dict\n    user:\n      name: \"{{ user_info['test_user20']['name'] }}\"\n      shell: \"{{ user_info['test_user20']['shell'] }}\"\n      state: present\n\n```\n\n![image-20221026101138894](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/2c0f83a584a0de9b2f45259771a498c7697559838.png)\n\n![image-20221115083012804](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/28bbd22e9a70bfe446654d04e842304e697559838.png)\n\nå˜é‡å¼•ç”¨çš„å¦ä¸€ç§å†™æ³•ï¼šå¼•ç”¨å¯¹è±¡å†™æ³•ï¼ˆpythonè¯­æ³•ï¼‰\n\n![image-20221026101222577](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/0cb84cd54a577813a2f32a666c2f2721697559838.png)\n\næ³¨æ„ï¼šä»¥ç‚¹ä½œä¸ºåˆ†éš”ï¼ˆå¼•ç”¨å¯¹è±¡ï¼‰è¿™ç§æ–¹å¼ï¼Œå¯èƒ½ä¼šå’Œpythonæœ¬èº«çš„è¯­ä¹‰å¼•èµ·å†²çªï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼\n\n### æ³¨å†Œå˜é‡\n\næ³¨å†Œå˜é‡æ˜¯æŒ‡å°†ä¸€ä¸ªä»»åŠ¡ï¼ˆtaskï¼‰çš„è¾“å‡ºç»“æœå®šä¹‰åˆ°ä¸€ä¸ªå˜é‡ä¸­ï¼Œè¿™ä¸ªå˜é‡å°±å¯ä»¥åœ¨éšåçš„ä»»åŠ¡ä¸­åƒæ™®é€šå˜é‡ä¸€æ ·ä½¿ç”¨ã€‚\nå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ³¨å†Œå˜é‡ç”¨æ¥æ”¶é›†shellçš„æ‰§è¡Œç»“æœï¼Œç»“æœä¸­åŒ…å«æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºã€‚æ¥ä¸‹æ¥ä½¿ç”¨shellæ¨¡å—æ‰§è¡Œå‘½ä»¤å°†å‘½ä»¤ç»“æœä¼ å…¥åä¸ºvar_echo çš„å˜é‡å¹¶ä½¿ç”¨debugè¿›è¡Œæ£€æµ‹ã€‚\nregister çš„ä½¿ç”¨å½¢å¦‚ register: varnameï¼Œå³ registeræ¨¡å—åç›´æ¥åŠ å˜é‡åå³å¯ï¼Œè€Œregisterè¿™ä¸€è¡Œä»…ä»…éœ€è¦å†™åœ¨éœ€è¦æ”¶é›†è¾“å‡ºçš„é‚£ä¸€è¡Œä¸‹å³å¯ã€‚\n\næ¡ˆä¾‹ï¼š\n\n```\nvim test_com_var.yaml\n\n---\n- name: test_dict\n  hosts: all\n  vars:\n    user_info:\n      test_user20:\n        name: test_user20\n        shell: /bin/bash\n        comment: test_user20\n      test_user21:\n        name: test_user21\n        shell: /bin/bash\n        comment: test_user21\n  tasks:\n  - name: create users via dict\n    user:\n      name: \"{{ user_info.test_user21.name }}\"\n      shell: \"{{ user_info.test_user21.shell }}\"\n      state: present\n\nansible-playbook test_com_var.yaml\n\n```\n\næ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š\n\n![image-20221115083847092](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/6211a906fd3492c7c9a38e99578b03ba697559838.png)\n\nä¿®æ”¹å‰§æœ¬æ–‡ä»¶ï¼ŒåŠ å…¥debugæ¨¡å—\n\n```\nvim test_com_var.yaml\n\n- name: test_dict\n  hosts: all\n  vars:\n    user_info:\n      test_user20:\n        name: test_user20\n        shell: /sbin/nologin\n        comment: test_user20\n      test_user21:\n        name: test_user21\n        shell: /sbin/nologin\n        comment: test_user21\n  tasks:\n  - name: create users via dict\n    user:\n      name: \"{{ user_info.test_user21.name }}\"\n      shell: \"{{ user_info.test_user21.shell }}\"\n      state: present\n    register: user_result\n\n  - name: debug result of user creation\n    debug:\n      msg: \"{{ user_result }}\"\n\n      \nansible-playbook test_com_var.yaml\n\n```\n\nè¿è¡Œç»“æœï¼š\n\n![image-20221115084502083](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/2a24783539db1e28f3235517339f1677697559838.png)\n\nå¯ä»¥å¼•ç”¨ç»“æœä¸­çš„éƒ¨åˆ†å…ƒç´ ï¼ˆuser_result['uid'] / user_result.uidï¼‰\n\n```\nvim test_com_var.yaml\n\n- name: test_dict\n  hosts: all\n  vars:\n    user_info:\n      test_user20:\n        name: test_user20\n        shell: /sbin/nologin\n        comment: test_user20\n      test_user21:\n        name: test_user21\n        shell: /sbin/nologin\n        comment: test_user21\n  tasks:\n  - name: create users via dict\n    user:\n      name: \"{{ user_info.test_user21.name }}\"\n      shell: \"{{ user_info.test_user21.shell }}\"\n      state: present\n    register: user_result\n\n  - name: debug result of user creation\n    debug:\n      msg: \"{{ user_result.uid }}\"\n      \n  ansible-playbook test_com_var.yaml    \n```\n\nè¿è¡Œç»“æœï¼š\n\n![image-20221115084642928](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/03f435628b2b8c8482455bb564e6bcb1697559838.png)\n\nå¯ä»¥å¯¹è¾“å‡ºç»“æœè¿›è¡Œè¿­ä»£å¼•ç”¨ï¼ˆç”¨registerå­˜åœ¨å¤šä¸ªå˜é‡ä¸­ï¼‰\n\n```\nvim test_com_var.yaml\n---\n- name: test_dict\n  hosts: all\n  vars:\n    user_info:\n      test_user20:\n        name: test_user20\n        shell: /sbin/nologin\n        comment: test_user20\n      test_user21:\n        name: test_user21\n        shell: /sbin/nologin\n        comment: test_user21\n  tasks:\n  - name: create users via dict\n    user:\n      name: \"{{ user_info.test_user21.name }}\"\n      shell: \"{{ user_info.test_user21.shell }}\"\n      state: present\n    register: user_result\n\n  - name: debug result of user creation\n    debug:\n      msg: \"{{ user_result.uid }}\"\n    register: shell_result\n  \n  - name: debug result of shell\n    debug:\n      msg: \"{{ shell_result }}\"\n      \n  ansible-playbook test_com_var.yaml    \n```\n\n\n\n![image-20221026101500419](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/afce8fc500c006fdc6c8a45e60ddfedf697559838.png)\n\n## Ansible Vaultï¼ˆAnsible ä¿ç®¡ç®±ï¼‰\n\nä½œç”¨ï¼šåŠ å¯†æ•æ„Ÿçš„æ•°æ®ã€å¯†ç ç­‰ä¿¡æ¯ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å®šä¹‰åœ¨å˜é‡å†…çš„æ•æ„Ÿä¿¡æ¯ã€‚\n\nåº”ç”¨çš„æƒ…æ™¯ï¼š\n\n1> åŠ å¯†å˜é‡æ–‡ä»¶ï¼ˆæ•æ„Ÿæ•°æ®ã€å¯†ç ä¿¡æ¯ç­‰ï¼‰\n\n2> åŠ å¯†è¯ä¹¦\n\nå‘½ä»¤ï¼šansible-vault\n\nå‘½ä»¤ç”¨æ³•ï¼š\n\n### åˆ›å»ºä¸€ä¸ªåŠ å¯†æ–‡ä»¶ï¼š\n\n**ansible-vault create sec.yaml**\n\n![image-20221026101756674](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/7e575bfdbbc81080494e244fa61c97b1697559838.png)\n\nä½¿ç”¨vim sec.ymæˆ–è€…cat sec.yamlåªèƒ½çœ‹åˆ°åŠ å¯†åçš„å†…å®¹\n\n![image-20221115085325103](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/9dfe8e950735a40ce3ba0c269e2308c4697559838.png)\n\n### å¦‚ä½•æŸ¥çœ‹åŠ å¯†è¿‡çš„æ–‡ä»¶å†…å®¹ï¼š\n\n![image-20221026101816806](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/8aae3bf08d3fcaa251077bcc3a4f3511697559838.png)\n\n### å¦‚ä½•åœ¨å‰§æœ¬ä¸­è°ƒç”¨åŠ å¯†æ–‡ä»¶\n\n```\nvim test_vault.yaml\n\n---\n- name: Create users via vault\n  hosts: all\n  vars_files:\n  - /root/sec.yaml\n  tasks:\n  - name: Create users\n    user:\n      name: \"{{ username }}\"\n      state: present\n\n```\n\næ‰§è¡Œå‰§æœ¬æ—¶æŠ¥é”™\n\n![image-20221115090123132](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/025f933f2f98e83475e47b50a770d61d697559838.png)\n\nè§£å†³æ–¹æ³•ï¼š\n\næ–¹æ³•ä¸€ï¼šansible-playbook å‘½ä»¤æ—¶å€™æ·»åŠ --ask-vault-passå‚æ•°\n\nansible-playbook --ask-vault-pass test_vault.yaml\n\n![image-20221115090305979](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/82a563fff0f7f621f16ca3d89d291984697559838.png)\n\næ–¹æ³•äºŒï¼šansible-playbook --vault-id @prompt test_vault.yamlï¼ˆ2.3ä¹‹åä½¿ç”¨ï¼Œå»ºè®®ï¼‰\n\n![image-20221115090343892](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/80a2a5817cb83a38d6b390b6527dce2b697559838.png)\n\næ–¹æ³•ä¸‰ï¼šansible-playbook --vault-password-file=pass.yaml  test_vault.yaml\n\nï¼ˆçº¯æ–‡æœ¬å½¢å¼çš„å¯†ç å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œåªèƒ½å•è¡Œå†™ä¸€ä¸ªå¯†ç ï¼Œéœ€è¦å¯¹è¯¥å¯†ç æ–‡ä»¶åŠ å¼ºå®‰å…¨æªæ–½ï¼‰\n\n```\necho 123456 > pass.yaml\n```\n\n![image-20221115090537834](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/a4679558621742cc1686f226db97fa95697559838.png)\n\n### è§£å¯†\n\n![image-20221115090755579](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/5d1b2c41b8ab4d90c396d5152562751b697559838.png)\n\n### åŠ å¯†ä¸€ä¸ªå·²å­˜åœ¨çš„æ–‡ä»¶\n\n![image-20221115090808908](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/4013570bd030a34a9106c8076dc20fb9697559838.png)\n\n### é‡ç½®åŠ å¯†æ–‡ä»¶çš„å¯†ç \n\n![image-20221115090908211](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/caf0c57add1d5190b8257e56dce85667697559838.png)\n\n### ç¼–è¾‘å·²å­˜åœ¨çš„åŠ å¯†æ–‡ä»¶\n\n![image-20221115090956109](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/89af0166415695c89a5711c014ca410f697559838.png)\n\nTipsï¼šå¦‚æœæˆ‘ä»¬ä½¿ç”¨åŠ å¯†æ–‡ä»¶ä¿å­˜å˜é‡ã€å¯†ç ç­‰æ•æ„Ÿæ•°æ®ï¼Œæœ€å¥½é‡‡ç”¨éšè—æ–‡ä»¶æ¥å­˜æ”¾ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚\n\n![image-20221115091217928](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/c691ac4b1c29f213060409edcc3de254697559838.png)\n\n![image-20221115091252760](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/498cf7e4e15fe6dfe844f225b30b41ba697559838.png)\n\n```\nansible-playbook --vault-password-file=.pass.yaml  test_vault.yaml\n```\n\n![image-20221115091403345](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/4f45d34d83e8abd8fb954cd8389cc991697559838.png)\n\n## ç»¼åˆå®è·µ\n\nç¼–è¾‘å‰§æœ¬æ–‡ä»¶å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\n\n0ã€è®¾ç½®ä¸»æœºç»„ all\n\n1ã€è®¾ç½®å˜é‡ å®šä¹‰nginxæœåŠ¡ç«¯å£ä¸º8081\n\n2ã€å…³é—­facts\n\n3ã€è°ƒç”¨serviceæ¨¡å—ï¼Œå¸è½½å—æ§ç«¯çš„httpd\n\n4ã€è°ƒç”¨SELinuxæ¨¡å—ï¼Œå…³é—­selinux\n\n5ã€è°ƒç”¨yumæ¨¡å—å®‰è£…epelæº\n\n6ã€è°ƒç”¨yumæ¨¡å—å®‰è£…nginx\n\n7ã€è°ƒç”¨lineinfileæ¨¡å—ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ä¸­çš„ç›‘å¬ç«¯å£ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„æœåŠ¡ç«¯å£å˜é‡ï¼Œå¹¶å°†ç»“æœæ³¨å†Œåˆ° port_result\n\n8ã€è°ƒç”¨serviceæ¨¡å—å¯åŠ¨nginxï¼Œå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨\n\n9ã€è°ƒç”¨debugæ¨¡å—ï¼Œmsgä¿¡æ¯ä¸ºport_result\n\n10ã€éªŒè¯å—æ§ç«¯æœåŠ¡åŠç«¯å£\n\n```\n---\n- hosts: all\n  gather_facts: no\n  vars: \n    nginx_port: \"8081\"\n  tasks:   \n  - name: uninstall httpd\n    yum:\n      name: httpd\n      state: absent\n  - name: stop selinux\n    selinux:\n      state: disabled\n  - name: install epel\n    yum:\n      name: epel-release\n      state: present\n  - name: \n    yum:\n      name: nginx\n      state: present\n  - name: set nginx_port\n    lineinfile:\n      path: /etc/nginx/nginx.conf\n      regexp: \"        listen       80;\"\n      line: \"        listen       {{ nginx_port }};\"\n    register: port_result   \n  - name: start nginx\n    service:\n      name: nginx\n      state: started\n      enabled: yes\n  - name: debug msg\n    debug:\n      msg: \"{{ port_result }}\"\n\n\nansible-playbook  install_nginx.yaml -C\n\nansible-playbook install_nginx.yaml  \n\nansible all -m shell -a  \"ps aux |grep nginx \"  \n\nansible all -m shell -a  \"netstat -lntp |grep nginx \" \n\n```\n\n![image-20230926165830835](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/aa4e8fcbb552d3e8d48e4e3e14619f90697559838.png)\n\n![image-20230926165852495](../img/Ansible-%E6%80%BB%E6%89%8B%E5%86%8C.assets/0c68702617a92029f20139bba48637ad697559838.png)\n\n# Ansible-templates\n\n## JINJA2è¯­æ³•ç®€è¦ä»‹ç»\n\nJinja2è¯­è¨€ï¼Œæ”¯æŒçš„æ•°æ®ç±»å‹ï¼š\n\n```\n    å­—ç¬¦ä¸²ï¼šä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·\n    æ•°å­—ï¼šæ•´æ•°ï¼Œæµ®ç‚¹æ•°\n    åˆ—è¡¨ï¼š[item1, item2, ...]\n    å…ƒç»„ï¼š(item1, item2, ...)\n    å­—å…¸ï¼š{key1:value1, key2:value2, ...}\n    å¸ƒå°”å‹ï¼štrue/false\n```\n\næ”¯æŒçš„è¿ç®—åŠæ“ä½œï¼š\n\n```\nç®—æœ¯è¿ç®—ï¼š+, -, *, /, //, %, **\næ¯”è¾ƒæ“ä½œï¼š==, !=, >, >=, <, <=\né€»è¾‘è¿ç®—ï¼šandï¼Œorï¼Œnot\næµè¡¨è¾¾å¼ï¼šForï¼ŒIfï¼ŒWhen\n```\n\n## Playbookçš„è¿›é˜¶åº”ç”¨\n\n### ä½¿ç”¨whenå®ç°æ¡ä»¶åˆ¤æ–­\n\næ¡ä»¶æµ‹è¯•:å¦‚æœéœ€è¦æ ¹æ®å˜é‡ã€factsæˆ–æ­¤å‰ä»»åŠ¡çš„æ‰§è¡Œç»“æœæ¥åšä¸ºæŸtaskæ‰§è¡Œä¸å¦çš„å‰ææ—¶è¦ç”¨åˆ°æ¡ä»¶æµ‹è¯•ã€‚**å‰§æœ¬ä¸­ä¸èƒ½ä½¿ç”¨ifåˆ¤æ–­ï¼Œéœ€è¦ä½¿ç”¨whenåˆ¤æ–­ã€‚**\n\nwhenè¯­å¥ï¼šåœ¨taskåæ·»åŠ whenå­å¥å³å¯ä½¿ç”¨æ¡ä»¶æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨factsæˆ–playbookä¸­å®šä¹‰çš„å˜é‡ï¼Œæ”¯æŒJinja2è¡¨è¾¾å¼è¯­æ³•\n\nç¤ºä¾‹ï¼š\n\n```\ntasks:\n  - name: \"shutdown RedHat flavored systems\"\n    command: /sbin/shutdown -h now\n    when: ansible_os_family == \"RedHat\"  å½“ç³»ç»Ÿå±äºçº¢å¸½ç³»åˆ—,æ‰§è¡Œcommandæ¨¡å—ï¼Œæ³¨æ„ï¼š'æ‰€æœ‰å˜é‡'éƒ½å¯ä»¥ç›´æ¥åœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ï¼Œè€Œæ— éœ€ä½¿ç”¨åŒå¤§æ‹¬å·\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªwhenè¿›è¡Œå¤šæ¡ä»¶åˆ¤æ–­ï¼Œç­‰æ•ˆäºandã€‚\n\n```\nvim test_when.yml\n---\n- hosts: all\n  tasks:\n  - name: copy file\n    copy:\n      src: /etc/hosts\n      dest: /root/hosts_when\n    when: ansible_hostname is match \"node1\"\t\t#whenæ”¯æŒé€šé…ç¬¦\n\nansible all --list\nansible-playbook  test_when.yml\nansible all -m shell -a \"ls -l /root/hosts_when\"\n```\n\n\n\n### ä½¿ç”¨with_itemså®ç°è¿­ä»£\n\nè¿­ä»£ï¼šå½“æœ‰éœ€è¦é‡å¤æ€§æ‰§è¡Œçš„ä»»åŠ¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£æœºåˆ¶\n    > å¯¹è¿­ä»£é¡¹çš„å¼•ç”¨ï¼Œå›ºå®šå˜é‡åä¸º\"item\"\n\n> è¦åœ¨taskä¸­ä½¿ç”¨with_itemsç»™å®šè¦è¿­ä»£çš„å…ƒç´ åˆ—è¡¨ï¼Œ\n>     > åˆ—è¡¨æ ¼å¼ï¼š\n>          å­—ç¬¦ä¸²\n>          å­—å…¸\n\n### **ç¤ºä¾‹ï¼šæ‰“å°1ã€2ã€3**\n\n```\nvim test_items.yml\n\n---\n- name: add serveral users\n  gather_facts: no\n  hosts: all\n  tasks:\n  - name: test loop\n    debug: \n      msg: \"name --- {{ item }}\" #{{ item }} ç³»ç»Ÿè‡ªå®šä¹‰å˜é‡\n    with_items:   ##with_itemså®šä¹‰{{ item }} çš„å€¼å’Œä¸ªæ•°,      ä¸€èˆ¬æ”¾åˆ°æ¨¡å—çš„æœ«å°¾ï¼Œä¸æ¨¡å—åŒä¸€ç¼©è¿›çº§åˆ«    \n    - one\n    - two\n    - three\n```\n\n### ç¤ºä¾‹ï¼šåˆ›å»ºç”¨æˆ·\n\n```\nvim test_items.yml\n\n---\n- name: add serveral users\n  hosts: all\n  tasks:\n  - user:\n      name: \"{{ item  }}\"  #{{ item }} ç³»ç»Ÿè‡ªå®šä¹‰å˜é‡\n      state: present\n    with_items:           ##with_itemså®šä¹‰{{ item }} çš„å€¼å’Œä¸ªæ•°,ä¸€èˆ¬æ”¾åˆ°æ¨¡å—çš„æœ«å°¾ï¼Œä¸æ¨¡å—åŒä¸€ç¼©è¿›çº§åˆ«    \n    - testuser1\n    - testuser2\n\nansible all --list\nansible-playbook  test_items.yml\nansible all -m shell -a \"getent passwd testuser1\"\n\nä¸Šé¢è¯­å¥çš„åŠŸèƒ½ç­‰åŒäºä¸‹é¢çš„è¯­å¥ï¼š\n- name: add user testuser1\n  user: name=testuser1 state=present \n- name: add user testuser2\n  user: name=testuser2 state=present \n```\n\n### ç¤ºä¾‹ï¼šæ‹·è´å¤šä¸ªæ–‡ä»¶\n\n```\ntouch /root/1.txt /root/2.txt\n\nvim test_items2.yml\n---\n- name: copy serveral files\n  hosts: all\n  tasks:\n  - copy:\n      src: /root/{{ item  }}\n      dest: /etc/{{ item }}\n    with_items:          \n    - 1.txt\n    - 2.txt\n\nansible-playbook  test_items2.yml\nansible all -m shell -a \"ls -l /etc/*.txt\"\n```\n\n### ç¤ºä¾‹ï¼šè¿­ä»£å­—å…¸\n\n```\nwith_itemsä¸­å¯ä»¥ä½¿ç”¨å…ƒç´ è¿˜å¯ä¸ºhashes\nç¤ºä¾‹ï¼š\nvim test_items3.yml\n---\n- name: add several users\n  gather_facts: no\n  hosts: all\n  tasks:\n  - user:\n      name: \"{{ item.name }}\"\n      state: present\n      groups: \" {{ item.groups }}\"\n    with_items:\n    - { name: 'testuser3', groups: 'wheel' }\n    - { name: 'testuser4', groups: 'root' }\n\n\nansible-playbook  test_items3.yml\nansible all -m shell -a \"getent passwd testuser3\"\nansible all -m shell -a \"id testuser3\"\nansible all -m shell -a \"getent passwd testuser4\"\nansible all -m shell -a \"id testuser4\"\n\n```\n\n### è¯¾å ‚ä½œä¸šï¼šä½¿ç”¨withâ€”itemsæ‹·è´å¤šä¸ªæ–‡ä»¶\n\nè¦æ±‚ï¼šitemåˆ—è¡¨æ¡ç›®ä¸ºå­—å…¸ç±»å‹ï¼ŒåŒ…å«srcã€destã€mode3ä¸ªé”®å€¼å¯¹ï¼Œä½¿ç”¨with_itemså®ç°å¤šä¸ªæ–‡ä»¶çš„æ‹·è´ï¼Œå¹¶èµ‹äºˆè®¾å®šçš„æƒé™ã€‚\n\n```\ntouch /root/3.txt /root/4.txt\nvim test_items4.yml\n---\n- name: copy several files\n  hosts: all\n  tasks:\n  - copy:\n      src: \"{{ item.src }}\"\n      dest: \"{{ item.dest }}\"\n      mode: \"{{ item.mode }}\"\n    with_items:          \n    - { src: \"/root/3.txt\", dest: \"/root/\", mode: \"0644\" }\n    - { src: \"/root/4.txt\", dest: \"/root/\", mode: \"0644\" }\n\nansible-playbook  test_items4.yml\nansible all -m shell -a \"ls -l /root/*.txt\"\n\n```\n\n#### whenå’Œwith itemsç»„åˆä½¿ç”¨\n\n å½“whenå’Œwith_itemsä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œæ¯ä¸ªé¡¹éƒ½ä¼šå•ç‹¬è¢«whenè¯­å¥å¤„ç†\n\n```\nvim test_when_items.yml\n---\n- hosts: all\n  tasks:\n  - command: echo {{ item }}\n    with_items: [ 1,2,3,4,5,6,8,10]\n    when: item > 5\n         \n ansible-playbook test_when_items.yml\n```\n\n\n\n## templates æ¨¡æ¿\n\ntemplatesåŠŸèƒ½ï¼šæ ¹æ®æ¨¡æ¿æ–‡ä»¶åŠ¨æ€ç”Ÿæˆå¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå‘½åå¿…é¡»ä»¥.j2ç»“å°¾ï¼Œæ”¯æŒjinja2è¯­æ³•ã€‚\n\nåœ¨å‘ˆç° JINJA2æ¨¡æ¿æ—¶ï¼Œæ–‡ä»¶ä¸­å¼•ç”¨çš„å˜é‡å’Œè¡¨è¾¾å¼è¢«æ›¿æ¢ä¸ºå¯¹åº”çš„å€¼ã€‚æ¨¡æ¿ä¸­ä½¿ç”¨çš„å˜é‡å¯ä»¥åœ¨ Playbook çš„ vars éƒ¨åˆ†ä¸­æŒ‡å®šã€‚å¯ä»¥å°†å—ç®¡ä¸»æœºçš„äº‹å®ç”¨ä½œæ¨¡æ¿ä¸­çš„å˜é‡ã€‚\n\nåˆ†éš”ç¬¦ä½¿ç”¨è§„èŒƒï¼š\n\n```\n{% EXPR %}ï¼šç”¨äºè¡¨è¾¾å¼æˆ–é€»è¾‘ï¼ˆå¦‚å¾ªç¯ã€åˆ¤æ–­ç­‰ï¼‰\n\n{{ EXPR }}ï¼šç”¨äºå‘æœ€ç»ˆç”¨æˆ·è¾“å‡ºè¡¨è¾¾å¼æˆ–å˜é‡çš„ç»“æœã€‚åœ¨å‘ˆç°æ—¶å°†è¢«æ›¿æ¢ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œå¯¹æœ€ç»ˆç”¨æˆ·å¯è§ã€‚\n\n{# COMMENT #}ï¼Œç”¨äºæ³¨é‡Šï¼Œä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆæ–‡ä»¶ä¸­ã€‚\n```\n\n### templatesçš„ä½¿ç”¨åœºæ™¯\n\nåœ¨å®é™…çš„å·¥ä½œä¸­ç”±äºæ¯å°æœåŠ¡å™¨çš„ç¯å¢ƒé…ç½®éƒ½å¯èƒ½ä¸åŒï¼Œä½†æ˜¯å¾€å¾€å¾ˆå¤šæœåŠ¡çš„é…ç½®æ–‡ä»¶éƒ½éœ€è¦æ ¹æ®æœåŠ¡å™¨ç¯å¢ƒè¿›è¡Œä¸åŒçš„é…ç½®ï¼Œæ¯”å¦‚Nginxæœ€å¤§è¿›ç¨‹æ•°ã€Redisæœ€å¤§å†…å­˜ç­‰ã€‚\n\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨Ansibleçš„templateæ¨¡å—ï¼Œè¯¥æ¨¡å—å’Œcopyæ¨¡å—ä½œç”¨åŸºæœ¬ä¸€æ ·ï¼Œéƒ½æ˜¯æŠŠç®¡ç†ç«¯çš„æ–‡ä»¶å¤åˆ¶åˆ°å®¢æˆ·ç«¯ä¸»æœºä¸Šï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºtemplateæ¨¡å—å¯ä»¥é€šè¿‡å˜é‡æ¥è·å–é…ç½®å€¼ï¼Œæ”¯æŒå¤šç§åˆ¤æ–­ã€å¾ªç¯ã€é€»è¾‘è¿ç®—ç­‰ï¼Œè€Œcopyåªèƒ½åŸå°ä¸åŠ¨çš„æŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶è¿‡å»ã€‚\n\n#### ç¤ºä¾‹ï¼šhttpd.confçš„templatesæ¨¡æ¿\n\nåˆ›å»ºå¹¶ç¼–è¾‘httpd.conf.j2æ–‡ä»¶\n\n```\nyum -y install httpd\nrpm -qa httpd\n \ncp /etc/httpd/conf/httpd.conf /root/httpd.conf.j2\n \nvim /root/httpd.conf.j2\n \n---------42è¡Œ----------\nListen {{port}}\n \n----------95è¡Œ---------\nServerName {{domain}}\n \nvim /etc/ansible/hosts\n \n[websrvs]\n192.168.142.101 port=80 domain=www.node1.com\n192.168.142.102 port=81 domain=www.node2.com\n```\n\nå¸è½½å—æ§æœºä¸Šçš„httpdæœåŠ¡\n\n```\nansible websrvs -m shell -a 'yum remove -y httpd'\nansible websrvs -m shell -a 'yum remove -y nginx'\n```\n\næ–°å»ºyamlæ–‡ä»¶\n\n```\ncd /root\nvim a.yaml\n---\n- hosts: websrvs\n  remote_user: root\n  vars:\n  - package: httpd\n  - service: httpd\n  tasks:\n  - name: install service\n    yum:\n      name: \"{{ package }}\"\n      state: latest\n\n  - name: httpd.conf\n    template:\n      src: /root/httpd.conf.j2\n      dest: /etc/httpd/conf/httpd.conf\n    notify: restart service\n\n  - name: start service\n    service:\n      name: \"{{ service }}\"\n      state: started\n      enabled: true\n \n handlers:\n  - name: restart service\n    service:\n      name: \"{{ service }}\"\n      state: restarted\n\n```\n\næ‰§è¡Œyamlæ–‡ä»¶å¹¶éªŒè¯\n\n```\nansible-playbook a.yaml --syntax-check\nansible-playbook a.yaml\nansible websrvs -a 'systemctl status httpd'\nansible websrvs -m shell -a 'ss -ntl'\nansible websrvs -m shell -a 'netstat -ntlp |grep httpd'\nansible websrvs -m shell -a 'lsof -i:80'\nansible websrvs -m shell -a 'lsof -i:81'\n```\n\n#### tamplates-for(å¾ªç¯)\n\nè¯­æ³•ï¼š\n\n```\n{% for å˜é‡ in åˆ—è¡¨ %}\n{{ æ–‡æœ¬å†…å®¹è°ƒç”¨å˜é‡ }}\n{% endfor %}\n```\n\nç¤ºä¾‹ï¼šä½¿ç”¨forå¾ªç¯éå†è°ƒç”¨usersåˆ—è¡¨å˜é‡çš„å…ƒç´ \n\n```\n{%  for user in users %}\n{{  user }}\n{% endfor %}\n```\n\n### ç¤ºä¾‹ï¼šyamlæ–‡ä»¶ä¸­å˜é‡çš„è°ƒç”¨\n\nç¼–å†™yamlæ–‡ä»¶ jinja2_for.yml\n\n```\nvim jinja2_for.yml\n---\n- name: jinja2_for example\n  hosts: all\n  remote_user: root\n  vars:\n    users:\n    - user1\n    - user2\n  tasks:\n  - name: Copy template\n    template: \n      src: /root/users.j2\n      dest: /root/users \n```\n\nç¼–å†™/root/users.j2æ–‡ä»¶\n\n```\nvim /root/users.j2\n{% for user in users %}\nusername: {{ user }}\n{% endfor %}\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```\nansible-playbook jinjia2_for.yml --syntax-check\nansible-playbook jinjia2_for.yml\nansible all -m shell -a \"cat /root/users\"\n```\n\n**æ‰©å±•ç¤ºä¾‹ï¼š**\n\nä»¥ä¸‹ç¤ºä¾‹æ¨¡æ¿ä½¿ç”¨forè¯­å¥é€ä¸€è¿è¡Œuserså˜é‡ä¸­çš„æ‰€æœ‰å€¼ï¼Œå°†useræ›¿æ¢ä¸ºå„ä¸ªå€¼ï¼Œä½†å€¼ä¸ºrootæ—¶é™¤å¤–ã€‚\n\n```\nvim users.j2\n\n{# for statement #}\n{% for user in users if not user ==\"root\" %}\nUser number {{ loop.index }}- {{ user }}\n{% endfor %}\n```\n\nloop.indexå˜é‡æ‰©å±•è‡³å¾ªç¯å½“å‰æ‰€å¤„çš„ç´¢å¼•å·ã€‚å®ƒåœ¨å¾ªç¯ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶å€¼ä¸º1ï¼Œæ¯ä¸€æ¬¡è¿­ä»£é€’å¢1.\n\n```\nansible-playbook jinjia2_for.yml --syntax-check\nansible-playbook jinjia2_for.yml\n\nansible all -m shell -a \"cat /root/users\"\n```\n\n\n\n### ç¤ºä¾‹ï¼šäº‹å®å˜é‡çš„è°ƒç”¨\n\nç¼–å†™yamlæ–‡ä»¶  jinja2_for2.yml\n\n```\nvim jinja2_for2.yml\n---\n- name: jinja2_for example2\n  hosts: all\n  remote_user: root\n  vars:\n    users:\n    - user1\n    - user2\n  tasks:\n  - name: Copy template\n    template: \n      src: /root/host.j2\n      dest: /root/hosts \n```\n\nç¼–å†™/root/host.j2æ–‡ä»¶\n\n```\nvim /root/host.j2\n{% for host in groups['websrvs'] %}\n{{ ansible_facts.default_ipv4.address }}{{ ansible_facts.fqdn }}\n{% endfor %}\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```\nansible-playbook jinjia2_for2.yml --syntax-check\nansible-playbook jinjia2_for2.yml\n\nansible websrvs -m shell -a \"cat /root/hosts\"\n```\n\n\n\n#### tamplates-ifï¼ˆåˆ¤æ–­ï¼‰\n\nJinja2ä½¿ç”¨ if è¯­å¥æ¥æä¾›æ¡ä»¶æ§åˆ¶ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œå…è®¸åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œå†…å®¹ã€‚\n\nè¯­æ³•ï¼š\n\n```\n{% if æ¡ä»¶ %}\n{{ è¯­å¥ }}\n{% endif %}\n```\n\n### ç¤ºä¾‹ï¼š\n\nç¼–å†™yamlæ–‡ä»¶ jinja2_if.yml\n\n```\nvim jinja2_if.yml\n---\n- name: jinja2_if example\n  hosts: websrvs\n  remote_user: root\n\n  tasks:\n  - name: Copy template\n    template: \n      src: /root/host2.j2\n      dest: /root/hosts2 \n```\n\nç¼–è¾‘host2.j2æ–‡ä»¶\n\n```\nvim /root/host2.j2\n\n{% if ansible_facts.default_ipv4.address =='192.168.142.101' %}\n{{ ansible_facts.default_ipv4.address }}{{ ansible_facts.fqdn }}\n{% endif %}\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```\nansible-playbook jinja2_if.yml --syntax-check\nansible-playbook jinja2_if.yml\nansible all -m shell -a \"cat /root/hosts2\"\n```\n\n\n\n## ç»¼åˆæ¡ˆä¾‹ï¼šnginx templates\n\n0ã€ç¼–è¾‘ä¸»æœºæ¸…å•ï¼Œç»„websrvsï¼ŒåŒ…å«2å°å—æ§ä¸»æœº\n\n1ã€ä¸»æ§ç«¯å®‰è£…ngxinã€æ‹·è´nginxé…ç½®æ–‡ä»¶ä¸ºnginx.conf.j2æ¨¡æ¿æ–‡ä»¶ã€‚åˆ›å»ºnginxé¦–é¡µæ¨¡ç‰ˆï¼Œå‘½åä¸ºhtml.j2,å¼•ç”¨å®äº‹å˜é‡ï¼šä¸»æœºåï¼Œæ–‡ä»¶å†…å®¹æ ¼å¼å¦‚ï¼š Welcome to {{  éœ€è¦å¼•ç”¨çš„å®äº‹å˜é‡ }}\n\n2ã€ç¼–å†™test_template.yamlæ–‡ä»¶ï¼Œè¦æ±‚tasks\n\nâ€‹      1ï¼‰å®‰è£…epelæº 2ï¼‰å®‰è£…nginx 3ï¼‰æ‹·è´nginx.conf.j2æ¨¡æ¿æ–‡ä»¶ä¸ºå—æ§ä¸»æœºçš„nginxé…ç½®æ–‡ä»¶4ï¼‰æ‹·è´html.j2æ¨¡æ¿æ–‡ä»¶ä¸ºå—æ§ä¸»æœºçš„nginxé¦–é¡µæ–‡ä»¶4ï¼‰å¼€å¯æœåŠ¡\n\n3ã€æ ¡éªŒplaybookè¯­æ³•å¹¶æ‰§è¡Œï¼ŒéªŒè¯å—æ§ä¸»æœºçš„nginxè¿›ç¨‹æ•°\\æœåŠ¡ç«¯å£\\é¦–é¡µ\n\n4ã€ä¿®æ”¹nginx.conf.j2æ¨¡æ¿æ–‡ä»¶ï¼Œé…ç½® worker_processesæ•°é‡ä¸ºå®äº‹å˜é‡ï¼šå—æ§ä¸»æœºå¤„ç†å™¨vcpuä¸ªæ•°çš„ä¸¤å€ï¼Œä¿å­˜\n\n5ã€ä¿®æ”¹test_template.yamlæ–‡ä»¶ï¼Œæ·»åŠ notifyå’Œhandlersï¼Œåœ¨é…ç½®æ–‡ä»¶å˜åŒ–æ—¶ï¼Œé‡å¯nginx\n\n6ã€æ ¡éªŒplaybookè¯­æ³•å¹¶æ‰§è¡Œï¼ŒéªŒè¯å—æ§ä¸»æœºçš„nginxè¿›ç¨‹æ•°\n\n7ã€ä¿®æ”¹hostsæ–‡ä»¶ä¸ºæ¯å°ä¸»æœºå®šä¹‰æœåŠ¡ç«¯å£å˜é‡ ç¬¬ä¸€å° 8082ï¼Œç¬¬äºŒå°8083\n\n8ã€ä¿®æ”¹test_template.yamlæ–‡ä»¶ï¼Œä¿®æ”¹ç›‘å¬ç«¯å£è¡Œï¼Œå¢åŠ ä¸»æœºç«¯å£å˜é‡çš„å¼•ç”¨\n\n9ã€æ ¡éªŒplaybookè¯­æ³•å¹¶æ‰§è¡Œï¼ŒéªŒè¯å—æ§ä¸»æœºçš„nginxæœåŠ¡ç«¯å£\n\n10ã€ä¿®æ”¹test_template.yamlï¼Œå¢åŠ ç«¯å£å˜é‡å®šä¹‰ï¼Œç«¯å£88\n\n11ã€æ ¡éªŒplaybookè¯­æ³•å¹¶æ‰§è¡Œï¼ŒéªŒè¯å—æ§ä¸»æœºçš„nginxæœåŠ¡ç«¯å£\n\n\n\n1ã€ä¸»æ§ç«¯å®‰è£…ngxinã€æ‹·è´nginxé…ç½®æ–‡ä»¶ä¸ºnginx.conf.j2æ¨¡æ¿æ–‡ä»¶\n\n```\nyum install -y nginx\ncp /etc/nginx/nginx.conf /root/nginx.conf.j2\necho \"welcome to {{ ansible_hostname  }}\" > html.j2\n\nansible all -m setup |grep hostname\nansible all -m setup |grep vcpu\n```\n\n2ã€åˆ›å»ºnginxé¦–é¡µæ¨¡ç‰ˆï¼Œå‘½åä¸ºhtml.j2,å¼•ç”¨å®äº‹å˜é‡ï¼šä¸»æœºå\n\nå†…å®¹æ ¼å¼å¦‚ï¼š Welcome to {{  éœ€è¦å¼•ç”¨çš„å®äº‹å˜é‡ }}\n\n2ã€ç¼–å†™test_template.yamlæ–‡ä»¶\n\n```\nvim test_template.yaml\n---\n- hosts: websrvs\n  remote_user: root\n  tasks:\n  - name: install epel\n    yum:\n      name: epel-release\n  - name: install package\n    yum:\n      name: nginx\n  - name: copy template\n    template:\n      src: /root/nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n  - name: copy template\n    template:\n      src: /root/html.j2\n      dest: /usr/share/nginx/html\n  - name: copy html\n    template:\n      src: /root/html.j2\n      dest: /usr/share/nginx/html/index.html    \n  - name: start service\n    service:\n      name: nginx\n      state: started\n      enabled: yes\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```\nansible-playbook test_template.yaml  --syntax-check\nansible-playbook test_template.yaml  \nansible all -m shell -a 'systemctl status nginx'\nansible all -m shell -a 'ss -ntpl|grep nginx'\n#å¯ä»¥æŸ¥çœ‹åˆ°è¿›ç¨‹ï¼Œæ¯ä¸ªcpuä¸€ä¸ª\nansible all -m shell -a 'ps aux|grep nginx'\n```\n\n\n\n3ã€ä¿®æ”¹templateæ–‡ä»¶ï¼Œä¿®æ”¹è¿›ç¨‹æ•°ä¸ºcpuå†…æ ¸çš„2å€\n\n```i\nansible websrvs -m setup|grep \"cpu\"\n\nvim nginx.conf.j2\nä¿®æ”¹ç¬¬6è¡Œ\nworker_processes {{ ansible_processor_vcpus*2  }}    #worker_processes auto\n```\n\nä¿®æ”¹test_template.yamlæ–‡ä»¶ï¼Œæ·»åŠ notifyå’Œhandlersï¼Œåœ¨é…ç½®æ–‡ä»¶å˜åŒ–æ—¶ï¼Œé‡å¯nginx\n\n```\nvim test_template.yaml\n---\n- hosts: websrvs\n  remote_user: root\n  tasks:\n  - name: install package\n    yum:\n      name: nginx\n  - name: copy template\n    template:\n      src: /root/nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify:\n    - restart service\n  - name: copy html\n    template:\n      src: /root/html.j2\n      dest: /usr/share/nginx/html/index.html    \n  - name: start service\n    service:\n      name: nginx\n      state: started\n      enabled: yes\n  handlers:\n  - name: restart service\n    service:\n      name: nginx\n      state: restarted\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```\nansible-playbook test_template.yaml\n#å¯ä»¥æŸ¥çœ‹åˆ°è¿›ç¨‹ï¼Œ\nansible all -m shell -a 'ps aux|grep nginx' #æŸ¥çœ‹nginxè¿›ç¨‹æ•°ä¸ºcpuæ ¸æ•°çš„2å€\n```\n\næ£€éªŒnginxé…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨è¯­æ³•é”™è¯¯\n\nnginx -t \n\nnginxå’ŒhttpdæœåŠ¡ï¼ŒwebæœåŠ¡ä¿è¯åªæœ‰ä¸€ä¸ªè¿è¡Œã€‚\n\n\n\n4ã€ä½¿ç”¨ä¸»æœºå˜é‡ï¼Œä¿®æ”¹æœåŠ¡ç«¯å£\n\nä¿®æ”¹hostsæ–‡ä»¶å¢åŠ ç«¯å£å˜é‡\n\n```\n#ä½¿ç”¨ä¸»æœºå˜é‡\n#ä¿®æ”¹nginxå¯¹åº”çš„ç«¯å£\nvim /etc/ansible/hosts\n[websrvs]\n192.168.142.101 http_port=8083\n192.168.142.102 http_port=8084\n```\n\nä¿®æ”¹æ¨¡æ¿æ–‡ä»¶ï¼Œå¢åŠ ç«¯å£å¼•ç”¨\n\n```\nvim nginx.conf.j2\nä¿®æ”¹39ã€40è¡Œ\nserver{\n    listen   {{ http_port }} ;\n    listen   [::]:{{  http_port  }} ;\n}\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```\nansible-playbook test_template.yaml\nansible websrvs -m shell -a 'ss -ntpl|grep nginx'\n```\n\n\n\n5ã€ä½¿ç”¨playbookå˜é‡\n\nä¿®æ”¹test_template.yamlï¼Œå¢åŠ ç«¯å£ä¿¡æ¯\n\n```\nvim test_template.yaml\n\n---\n- hosts: websrvs\n  remote_user: root\n  varsï¼š\n  - http_port: 88\n  tasks:\n  - name: install package\n    yum:\n      name: nginx\n  - name: copy template\n    template:\n      src: /root/nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify:\n    - restart service\n  - name: copy html\n    template:\n      src: /root/html.j2\n      dest: /usr/share/nginx/html/index.html   \n  - name: start service\n    service:\n      name: nginx\n      state: started\n      enabled: yes\n  handlers:\n  - name: restart service\n    service:\n      name: nginx\n      state: restarted\n\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```\nansible-playbook test_template.yaml\nansible websrvs -m shell -a 'ss -ntpl|grep nginx'\n#å‘ç°ç«¯å£å˜æˆ88\n```\n\n6ã€ä½¿ç”¨å‘½ä»¤è¡Œå˜é‡\n\n```\nansible-playbook -e \"http_port=99\"  test_template.yaml\nansible websrvs -m shell -a 'ss -ntpl|grep nginx'\n#å‘ç°ç«¯å£å˜æˆ99\n```\n\n# Roles\n\n```\nÂ·ç”±æ¥: ansibleè‡ªåŠ¨åŒ–è¿è¡Œï¼ŒåŸºç¡€ç”±AD-Hocå‘½ä»¤æ¥å®Œæˆï¼Œåœ¨å‘½ä»¤å˜å¤šæ—¶ï¼Œäº§ç”Ÿäº†playbookè¿›è¡Œç®¡ç†ä»»åŠ¡ï¼Œç®€å•ä»»åŠ¡ä½¿ç”¨playcookå¯ä»¥è½»æ¾å¤„ç†ï¼Œä½†æ˜¯æœ‰å¤æ‚ä»»åŠ¡æ—¶å•ä¸ªplaybookä¸å¯ä»¥èƒœä»»äº†ï¼Œè¿™æ—¶éœ€è¦æŠŠå¤šä¸ªplaybookè¿›è¡Œç»„åˆï¼Œå°‘é‡ç”¨includeå°†å‰§æœ¬ä¸­ä»»åŠ¡äº’ç›¸å…³è”å³å¯å®Œæˆï¼Œä½†æ˜¯playbookè¿˜åœ¨å¢å¤šçš„æƒ…å†µæ—¶å°±ä¸æ–¹ä¾¿ç®¡ç†äº†ï¼Œè¿™æ—¶å¼•å…¥roleså¯¹playbookè¿›è¡Œæœ‰æ•ˆç»„ç»‡å°±ååˆ†å¿…è¦äº†\nÂ· Roles:è§’è‰²ï¼Œæ˜¯ansibleè‡ª1.2ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„æ–°ç‰¹æ€§\nÂ·ç›®çš„:ç”¨äºå±‚æ¬¡æ€§ï¼Œç»“æ„åŒ–åœ°ç»„ç»‡playbook, rolesèƒ½å¤Ÿæ ¹æ®å±‚æ¬¡å‹ç»“æ„è‡ªåŠ¨è£…è½½å˜é‡ã€æ–‡ä»¶ã€ä»»åŠ¡ã€æ¨¡å—åŠè§¦å‘å™¨Â·æ–¹æ³•: rolesé€šè¿‡åˆ†åˆ«å°†æ”¾ç½®äºå˜é‡ã€æ–‡ä»¶ã€ä»»åŠ¡ã€æ¨¡å—åŠè§¦å‘å™¨å•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶å¯ä»¥ä¾¿æ·åœ°includeå®ƒä»¬çš„ä¸€ç§æœºåˆ¶Â·åº”ç”¨:è§’è‰²ä¸€èˆ¬ç”¨äºåŸºäºä¸»æœºæ„å»ºæœåŠ¡çš„åœºæ™¯ä¸­ã€ä½†ä¹Ÿå¯ä»¥æ˜¯ç”¨äºæ„å»ºå®ˆæŠ¤è¿›ç¨‹ç­‰åœºæ™¯ä¸­\n```\n\n## rolesé»˜è®¤è·¯å¾„è®¾ç½®\n\n```\n/etc/ansible/ansible.cfg\nroles_path= /etc/ansible/roles\n```\n\n## Roleså„ç›®å½•ç»“æ„åŠä½œç”¨\n\n```\næ¯ä¸ªè§’è‰²ï¼Œä»¥ç‰¹å®šçš„å±‚çº§ç›®å½•ç»“æ„è¿›è¡Œç»„ç»‡\nrolesç›®å½•ç»“æ„ï¼š\nplaybook.yml  è°ƒç”¨è§’è‰²\nroles/\n  project/ (è§’è‰²åç§°)\n    tasks/\n    files/\n    vars/\n    templates/\n    handlers/\n    default/ ä¸å¸¸ç”¨ï¼Œè®¾å®šé»˜è®¤å˜é‡æ—¶ä½¿ç”¨æ­¤ç›®å½•ä¸­çš„main.ymlæ–‡ä»¶\n    meta/    ä¸å¸¸ç”¨ï¼Œå®šä¹‰å½“å‰è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»,è‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼›å…¶å®ƒæ–‡ä»¶éœ€åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«\nå„ç›®å½•çš„ä½œç”¨ï¼š\n/roles/project/ :é¡¹ç›®åç§°,æœ‰ä»¥ä¸‹å­ç›®å½•ï¼Œprojectå¯ä»¥æ˜¯mysql\\httpd\\nginx\\memcachedç­‰\n    files/ ï¼šå­˜æ”¾ç”±copyæˆ–scriptæ¨¡å—ç­‰è°ƒç”¨çš„æ–‡ä»¶\n    templates/ï¼štemplateæ¨¡å—æŸ¥æ‰¾æ‰€éœ€è¦æ¨¡æ¿æ–‡ä»¶çš„ç›®å½•\n    tasks/ï¼šå®šä¹‰task,roleçš„åŸºæœ¬å…ƒç´ ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶, å…¶å®šä¹‰äº†æ­¤è§’è‰²çš„ä»»åŠ¡åˆ—è¡¨.\n             åœ¨handlerä¸­ä½¿ç”¨includeåŒ…å«çš„å…¶å®ƒçš„handleræ–‡ä»¶ä¹Ÿåº”è¯¥ä½äºæ­¤ç›®å½•ä¸­ï¼›\n    handlers/ï¼šè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼›ç”¨äºå®šä¹‰æ­¤è§’è‰²ç”¨åˆ°çš„å„handlerï¼›\n               å…¶å®ƒçš„æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«\n    vars/ï¼šå®šä¹‰å˜é‡ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶,ï¼›\n           å…¶å®ƒçš„æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«\n    meta/ï¼šå®šä¹‰å½“å‰è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»,è‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œ\n           å…¶å®ƒæ–‡ä»¶éœ€åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«, ansible1.3åŠå…¶ä»¥åçš„ç‰ˆæœ¬æ‰æ”¯æŒï¼›\n    defaults/ï¼šä¸ºå½“å‰è§’è‰²è®¾å®šé»˜è®¤å˜é‡æ—¶ä½¿ç”¨æ­¤ç›®å½•ï¼›åº”å½“åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶\n```\n\n### åˆ›å»ºroleæ¡†æ¶\n\næ‚¨å¯ä»¥ä½¿ç”¨æ ‡å‡†Linuxå‘½ä»¤åˆ›å»ºæ–°è§’è‰²æ‰€éœ€çš„æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶ã€‚\n\n```\ncd /etc/ansible/roles/\nmkdir  httpd\ncd httpd\nmkdir  tasks  handlers  vars  meta  defaults templates files \n```\n\næˆ–è€…å¯ä»¥è¿è¡Œansible-galaxy initæ¥åˆ›å»ºæ–°è§’è‰²çš„ç›®å½•ç»“æ„ã€‚æŒ‡å®šè§’è‰²çš„åç§°ä½œä¸ºå‘½ä»¤çš„å‚æ•°ï¼Œè¯¥å‘½ä»¤åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­ä¸ºæ–°è§’è‰²åˆ›å»ºå­ç›®å½•ã€‚\n\n```\ncd /etc/ansible/roles\nansible-galaxy init httpd\ntree httpd\n[root@controller roles]# tree httpd\nhttpd      #å…·ä½“çš„â¾“â¾Šé¡¹â½¬åç§°ï¼Œ   â½å¦‚nginxã€tomcatã€php  (â¾ƒç”±è®¾ç½®)\nâ”œâ”€â”€ defaults  #â½¤äºä¸ºå½“å‰â¾“â¾Šè®¾å®šé»˜è®¤å˜é‡ï¼Œ  æ­¤â½¬å½•åº”å½“åŒ…å«â¼€ä¸ªmain.ymlâ½‚ä»¶\nâ”‚Â Â  â””â”€â”€ main.yml  #ç±»ä¼¼ä»£ç ä¸­çš„ä¸»å‡½æ•°ï¼Œ  è¿›â¾ç»Ÿâ¼€ç®¡ç†\nâ”œâ”€â”€ files      #â½¤æ¥å­˜æ”¾ç”±copyæ¨¡å—æˆ–scriptæ¨¡å—ç­‰æ¨¡å—è°ƒâ½¤çš„â½‚ä»¶\nâ”œâ”€â”€ handlers    #â½¤äºå®šä¹‰æ­¤â¾“â¾Šä¸­è§¦å‘æ¡ä»¶æ—¶æ‰§â¾çš„åŠ¨ä½œï¼Œ  æ­¤â½¬å½•åº”å½“åŒ…å«â¼€ä¸ªmain.ymlâ½‚ä»¶\nâ”‚Â Â  â””â”€â”€ main.yml\nâ”œâ”€â”€ meta      #â½¤äºå®šä¹‰æ­¤â¾“â¾Šçš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»ï¼Œ  æ­¤â½¬å½•åº”å½“åŒ…å«â¼€ä¸ªmain.ymlâ½‚ä»¶\nâ”‚Â Â  â””â”€â”€ main.yml\nâ”œâ”€â”€ README.md   #è¯´æ˜â½‚ä»¶\nâ”œâ”€â”€ tasks       #â½¤äºå®šä¹‰å½“å‰â¾“â¾Šçš„ä»»åŠ¡åˆ—è¡¨ï¼Œ  æ­¤â½¬å½•åº”å½“åŒ…å«â¼€ä¸ªmain.ymlâ½‚ä»¶\nâ”‚Â Â  â””â”€â”€ main.yml\nâ”œâ”€â”€ templates  #â½¤æ¥å­˜æ”¾jinjia2æ¨¡æ¿ï¼Œtemplateæ¨¡å—ä¼šâ¾ƒåŠ¨åœ¨æ­¤â½¬å½•ä¸­å¯»æ‰¾jinjia2æ¨¡æ¿â½‚ä»¶\nâ”œâ”€â”€ tests   #â½¤äºå­˜æ”¾æµ‹è¯•roleæœ¬â¾åŠŸèƒ½çš„playbookå’Œä¸»æœºå®šä¹‰â½‚ä»¶ï¼Œ  åœ¨å¼€å‘æµ‹è¯•é˜¶æ®µâ½è¾ƒå¸¸â½¤ ,æ­¤â½¬å½•åº”å½“åŒ…å«â¼€ä¸ªmain.ymlâ½‚ä»¶å’Œâ¾ƒâ¾èµ„æºè®¾å®šinvetory\nâ”‚Â Â  â”œâ”€â”€ inventory\nâ”‚Â Â  â””â”€â”€ test.yml\nâ””â”€â”€ vars    #â½¤äºå®šä¹‰æ­¤â¾“â¾Šâ½¤åˆ°çš„å˜é‡ï¼Œ  æ­¤â½¬å½•åº”å½“åŒ…å«â¼€ä¸ªmain.ymlâ½‚ä»¶\n    â””â”€â”€ main.yml\n\n```\n\n\n\n# å®éªŒä»»åŠ¡ï¼šå®‰è£…httpdæœåŠ¡\n\nåŸå§‹çš„playbookç‰ˆæœ¬\n\n1ã€åˆ¶ä½œä¸»é¡µ\n\necho hi > index.html\n\n2ã€æ‹·è´æœ¬æœºhttpdçš„é…ç½®æ–‡ä»¶ä¸ºhttpd.conf.j2æ¨¡ç‰ˆï¼Œå¹¶ä¿®æ”¹\n\ncp /etc/httpd/conf/httpd.conf  httpd.conf.j2\n\nvim  httpd.j2   #42è¡Œ ä¿®æ”¹ä¸º\n\n```\n{% if http_port is defined %}\nListen {{ ansible_facts.default_ipv4.address }}:{{ http_port }}\n{% endif %}\n```\n\n3ã€ç¼–å†™playbookæ–‡ä»¶ï¼Œ\n\nåˆ›å»ºå˜é‡http_port: 8080\n\næ‰§è¡Œä»»åŠ¡ï¼š\n\n1)å®‰è£…httpd\n\n2)æ‹·è´ä¸»é¡µ\n\n3)æ‹·è´é…ç½®ï¼ˆåšè§¦å‘å™¨ï¼‰\n\n4)é˜²ç«å¢™æ”¾é€šè‡ªå®šä¹‰çš„ç«¯å£\n\n```\n- name: firewalld configuration\n  firewalld:  \n    port: \"{{  http_port }}/tcp\"\n    permanent: yes \n    immediate: yes \n    state: enabled\n  when: http_port is defined\n```\n\n5)å¼€å¯æœåŠ¡\n\n```\n---                                                                                                                                                                           \n- hosts: all \n  remote_user: root\n  vars:\n    http_port: 8080\n  tasks:\n  - name: install httpd package\n    yum:\n      name: httpd\n      state: present\n  - name: create a web content\n    copy:\n      src: index.html\n      dest: /var/www/html/index.html\n  - name: config file\n    template:\n      src: httpd.conf.j2\n      dest: /etc/httpd/conf/httpd.conf\n    notify: restart_httpd\n    when: http_port is defined                                                                                                                                                \n  - name: firewalld configuration\n    firewalld:                                                                   \n      port: \"{{  http_port }}/tcp\"\n      permanent: yes \n      immediate: yes \n      state: enabled\n    when: http_port is defined\n  - name: start service\n    service: \n      name: httpd \n      state: started \n      enabled: yes\n  handlers:\n  - name: restart_httpd\n    service:\n      name: httpd\n      state: restarted\n```\n\néªŒè¯ç«¯å£åŠä¸»é¡µ\n\nansible all -m shell -a \"ss -tunlp|grep httpd\" \n\n## ä»»åŠ¡åˆ†æï¼š\n\n1.é…ç½® httpd çš„æ—¶å€™ï¼Œå¯èƒ½å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶å¯èƒ½å«æœ‰å˜é‡\n\n2.å¿…è¦å˜é‡çš„å®šä¹‰\n\n3.æºç æ–‡ä»¶çš„å®šä¹‰\n\n## åˆ›å»ºhttpdè§’è‰²æ¡†æ¶\n\n```\nansible-galaxy init httpd\n```\n\næŸ¥çœ‹ç›®å½•ç»“æ„\n\n```\n[root@controller roles]# tree httpd\nhttpd\nâ”œâ”€â”€ defaults\nâ”‚  â””â”€â”€ main.yml\nâ”œâ”€â”€ files\nâ”œâ”€â”€ handlers\nâ”‚   â””â”€â”€ main.yml\nâ”œâ”€â”€ meta\nâ”‚   â””â”€â”€ main.yml\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ tasks\nâ”‚   â””â”€â”€ main.yml\nâ”œâ”€â”€ templates\nâ”œâ”€â”€ tests\nâ”‚   â”œâ”€â”€ inventory\nâ”‚   â””â”€â”€ test.yml\nâ””â”€â”€ vars\n    â””â”€â”€ main.yml\n```\n\n## éƒ¨ç½²å®Œå–„httpdè§’è‰²æ¡†æ¶\n\n```\n   cd roles/httpd/tasks/\n   touch install.yml conf_template.yml service.yml index.yml   httpd_firewalld.yml\n```\n\n## å®šä¹‰åˆ†ä»»åŠ¡(tasks/ä¸­å­˜æ”¾)\n\n```\nvim install.yml\n- name: install httpd package\n  yum: \n    name: httpd\n    state: present\n     \nvim conf_template.yml\n- name: config file\n  template: \n    src: httpd.conf.j2 \n    dest: /etc/httpd/conf/httpd.conf \n  notify: restart_httpd\n  when: http_port is defined\n         \nvim service.yml\n- name: start service\n  service: \n    name: httpd \n    state: started \n    enabled: yes\n    \nvim  index.yml\n- name: create a web content\n  copy:\n    src: index.html\n    dest: /var/www/html/index.html\n\nvim httpd_firewalld.yml\n- name: firewalld configuration\n  firewalld:\n    port: \"{{  http_port }}/tcp\"\n    permanent: yes\n    immediate: yes\n    state: enabled\n  when: http_port is defined\n```\n\n## å®šä¹‰ä¸»ä»»åŠ¡(tasks/main.yml)\n\n```\nåˆ›å»ºmain.ymlä¸»æ§æ–‡ä»¶,è°ƒç”¨ä»¥ä¸Šå•ç‹¬çš„ymlæ–‡ä»¶,main.ymlå®šä¹‰äº†è°å…ˆæ‰§è¡Œè°åæ‰§è¡Œçš„é¡ºåº\nvim main.yml\n- include: install.yml\n- include: index.yml\n- include: conf_template.yml\n- include: httpd_firewalld.yml\n- include: service.yml\n```\n\n## å®šä¹‰å˜é‡ï¼ˆvars/main.ymlï¼‰\n\n```\nvim /etc/ansible/roles/httpd/vars/main.yml\n\n---\n#vars file for httpd\nhttp_port: 8080\n```\n\n## å®šä¹‰é¦–é¡µæ–‡ä»¶ï¼ˆfiles/index.htmlï¼‰\n\n```\ncd    /etc/ansible/roles/httpd/files/\nvim index.html\n<h1> welcome to wd home <\\h1>\n```\n\n## å®šä¹‰æ¨¡æ¿(templates/httpd.conf.j2 )\n\n``` fr\nyum -y install httpd\n\ncp /etc/httpd/conf/httpd.conf  /etc/ansible/roles/httpd/templates/httpd.conf.j2 \n\nvim templates/httpd.conf.j2\nå°†LISTEN 80 è¡Œä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹\n{% if http_port is defined %}\nListen {{ ansible_facts.default_ipv4.address }}:{{ http_port }}\n{% endif %}\n```\n\n## å®šä¹‰è§’è‰²å¤„ç†ç¨‹åºï¼ˆhandlers/mail.ymlï¼‰\n\n```\nvim /etc/ansible/roles/httpd/handlers/main.yml\n- name: restart_httpd\n  service: \n    name: httpd \n    state: restarted\n```\n\n## è°ƒç”¨è§’è‰²ï¼Œé…ç½®httpdæœåŠ¡ï¼ˆroles/role_httpd.ymlï¼‰\n\n```\ncd /etc/ansidle/roles\nvim role_httpd.yml\n---\n# httpd role\n- name: httpd deployment\n  hosts: websrvs\n  remote_user: root    \n  \n  roles:       #è°ƒç”¨è§’è‰²\n  - httpd   \n```\n\n## æ£€æŸ¥è¯­æ³•åŠå†’çƒŸè¿è¡Œ\n\n```\n ansible-playbook role_httpd.yml -C\n```\n\n## æ­£å¼æ‰§è¡Œ\n\n```\n ansible-playbook role_httpd.yml\n```\n\n## éªŒè¯æœåŠ¡\n\n```\nansible all -m shell -a \"ss -tunlp |grep httpd\"\ncurl 192.168.142.101:8080\n\n```\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>\n","tags":["Centos 7","Ansible"],"categories":["è¿ç»´"]},{"title":"å…ˆç”µIaaS2.2éƒ¨ç½²OpenStack","url":"/posts/52877/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n\n\n# å…ˆç”µIaaS2.2ç§æœ‰äº‘éƒ¨ç½²OpenStack\n\n## å‰æœŸå‡†å¤‡\n\n### ipæ‹“æ‰‘\n\n|    ä¸»æœºå     |  ip1ï¼ˆNATï¼‰   | ip2ï¼ˆä»…ä¸»æœºï¼‰  | ç¡¬ç›˜ | å†…å­˜ |\n| :-----------: | :-----------: | :------------: | :--: | :--: |\n| controller-48 | 192.168.48.10 | 192.168.148.10 | 100G |  8G  |\n|  computer-48  | 192.168.48.20 | 192.168.148.20 | 100G |  3G  |\n\n### åŸºç¡€é•œåƒ\n\n[CentOS-7-x86_64-DVD-2009.iso](https://mirrors.aliyun.com/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-2009.iso?spm=a2c6h.25603864.0.0.74092d1ctaON7P)\n[chinaskills_cloud_iaas.iso](https://pan.quark.cn/s/baeeb5269112)\n\n```\n[root@localhost ~]# ll\ntotal 4758568\n-rw-r--r--  1 root root  861155328 Jun 19 03:06 CentOS-7-x86_64-DVD-2009.iso\n-rw-r--r--  1 root root 3799093248 Jun 19 03:06 chinaskills_cloud_iaas.iso\n```\n\n\n\n### è™šæ‹Ÿæœºç¡¬ä»¶é…ç½®\n\n![image-20230619160042336](../img/xiandian-openstack/2c6ee30d82a77a9207d568f1f75ebeaf539c598f.png)\n\ncontroller\n\n![](../img/xiandian-openstack/1.png)\n\ncomputer\n\n![image-20230618184522907](../img/xiandian-openstack/181f86237817db4d8a51d251d6d6138463bea45e.png)\n\n**sdbå’Œsdcæ˜¯åˆ†åˆ«ä½œä¸ºcinderæœåŠ¡å’ŒswiftæœåŠ¡çš„å­˜å‚¨ç£ç›˜ã€‚**\n\n### é…ç½®ä¸»æœºåå’Œhostsï¼Œå…³é—­é˜²ç«å¢™å’Œæ°¸ä¹…å…³é—­selinux\n\ncontroller\n\n```\nhostnamectl set-hostname controller && bash\nsystemctl disable firewalld --now\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\necho \"192.168.48.10 controller\" >> /etc/hosts\necho \"192.168.48.20 computer\" >> /etc/hosts\nsetenforce 0\n```\n\ncomputer\n\n```\nhostnamectl set-hostname computer && bash\nsystemctl disable firewalld --now\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\necho \"192.168.48.10 controller\" >> /etc/hosts\necho \"192.168.48.20 computer\" >> /etc/hosts\nsetenforce 0\n```\n\nç¡®ä¿ä¸¤è€…å¯ä»¥äº’é€šï¼\n\n### æ ¼å¼åŒ–computeç£ç›˜ï¼ˆåœ¨computeä¸­æ“ä½œï¼‰\n\n```\nmkfs.xfs /dev/sdb\nmkfs.xfs /dev/sdc\n```\n\n### é…ç½®yumæº\n\ncontroller\n\n```\nrm -rf /etc/yum.repos.d/*\ncat >> /etc/yum.repos.d/centos.repo << EOF\n[centos]\nname=centos\nbaseurl=file:///qianyios/centos\ngpgcheck=0\nenabled=1\n[iaas]\nname=iaas\nbaseurl=file:///qianyios/iaas-repo\ngpgcheck=0\nenabled=1\nEOF\n```\n\ncomputer\n\n```\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\ncat >> /etc/yum.repos.d/centos.repo << EOF\n[centos]\nname=centos\nbaseurl=ftp://192.168.48.10/centos\ngpgcheck=0\nenabled=1\n[iaas]\nname=iaas\nbaseurl=ftp://192.168.48.10/iaas-repo\ngpgcheck=0\nenabled=1\nEOF\n```\n\n### æŒ‚è½½isoé•œåƒæ–‡ä»¶\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\nmkdir /qianyios/centos -p\nmount -o loop CentOS-7-x86_64-DVD-2009.iso /mnt/\ncp -rvf /mnt/* /qianyios/centos/\numount /mnt/\nmount -o loop chinaskills_cloud_iaas.iso /mnt/\ncp -rvf /mnt/* /qianyios/\numount /mnt/\nyum clean all && yum makecache\n```\n\n### æ­å»ºftpæœåŠ¡å™¨\n\n```\næ§åˆ¶èŠ‚ç‚¹\nyum install vsftpd -y\ncat>> /etc/vsftpd/vsftpd.conf <<EOF\nanon_root=/qianyios/\nEOF\nsystemctl start vsftpd && systemctl enable vsftpd\n```\n\néªŒè¯æ“ä½œ\n\n1.æ¸…ç†yumç¼“å­˜\n\n```\n#å„èŠ‚ç‚¹\nyum clean all && yum makecache\n```\n\n2.åœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨è¾“å…¥ftp://192.168.48.10/\n\n![image-20230618192456867](../img/xiandian-openstack/e8657f54037c60e02ba43b1b9c4410e75f05a433.png)\n\n## ç¼–è¾‘xiandianå˜é‡\n\n```\n#å„èŠ‚ç‚¹\nyum install iaas-xiandian -y\n#ä½¿ç”¨sedå‘½ä»¤æ‰¹é‡å»é™¤ç¬¬ä¸€ä¸ª#æ³¨é‡Šç¬¦ä¸ºç©º\nsed -i -e 's/^#//'g /etc/xiandian/openrc.sh\nä½¿ç”¨sedå‘½ä»¤æ‰¹é‡ä¿®æ”¹å¯†ç é»˜è®¤000000\nsed -i -e 's/PASS=/PASS=000000/'g /etc/xiandian/openrc.sh\n```\n\n```\ngrep -v \"^#\" /etc/xiandian/openrc.sh | grep -v \"^$\"\nHOST_IP=192.168.48.10\nHOST_PASS=123456\n#sshç™»å…¥å¯†ç \nHOST_NAME=controller\nHOST_IP_NODE=192.168.48.20\nHOST_PASS_NODE=123456\n#sshç™»å…¥å¯†ç \nHOST_NAME_NODE=computer\nnetwork_segment_IP=192.168.48.0/24\nRABBIT_USER=openstack\nRABBIT_PASS=000000\nDB_PASS=000000\nDOMAIN_NAME=demo\nADMIN_PASS=000000\nDEMO_PASS=000000\nKEYSTONE_DBPASS=000000\nGLANCE_DBPASS=000000\nGLANCE_PASS=000000\nNOVA_DBPASS=000000\nNOVA_PASS=000000\nNEUTRON_DBPASS=000000\nNEUTRON_PASS=000000\nMETADATA_SECRET=000000\nINTERFACE_IP=192.168.48.10\n#å¤åˆ¶åˆ°ç¬¬äºŒå°æœºçš„æ—¶å€™ï¼Œè®°å¾—æ”¹æˆ192.168.48.20\nINTERFACE_NAME=ens36\n#ç¬¬äºŒå—ç½‘å¡çš„åå­—\nPhysical_NAME=provider\nminvlan=2\nmaxvlan=300\nCINDER_DBPASS=000000\nCINDER_PASS=000000\nBLOCK_DISK=sdb\nSWIFT_PASS=000000\nOBJECT_DISK=sdc\nSTORAGE_LOCAL_NET_IP=192.168.48.20\nHEAT_DBPASS=000000\nHEAT_PASS=000000\nZUN_DBPASS=000000\nZUN_PASS=000000\nKURYR_DBPASS=000000\nKURYR_PASS=000000\nCEILOMETER_DBPASS=000000\nCEILOMETER_PASS=000000\nAODH_DBPASS=000000\nAODH_PASS=000000\nBARBICAN_DBPASS=000000\nBARBICAN_PASS=000000\n\n```\n\n```\nscp /etc/xiandian/openrc.sh computer:/etc/xiandian/openrc.sh \n#ä»¥ä¸‹åœ¨è®¡ç®—èŠ‚ç‚¹\nsed -i 's/INTERFACE_IP=192.168.48.10/INTERFACE_IP=192.168.48.20/g' /etc/xiandian/openrc.sh\n```\n\n## å®‰è£…å¹³å°åŸºæœ¬æœåŠ¡\n\n```\n[root@controller ~]# iaas-pre-host.sh \n[root@compute ~]# iaas-pre-host.sh \n#åŒèŠ‚ç‚¹\nreboot\n# å¯åŒæ—¶æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ¯•åè„šæœ¬ä¼šæç¤ºé‡å¯ï¼Œä¸ç„¶rabbitmqæœåŠ¡ä¼šæŠ¥é”™ï¼ï¼ï¼æ­¤è„šæœ¬ä¼šåˆå§‹åŒ–è™šæ‹Ÿæœºç¯å¢ƒï¼Œå¦‚ä¿®æ”¹ä¸»æœº\nåã€ä¸»æœºæ˜ å°„ã€æ—¶é—´åŒæ­¥ç­‰ï¼Œè‡ªå·±å¯å»å°è¯•è§£è¯»è„šæœ¬ï¼Œæ‰‹å·¥æ­å»ºå¹³å°ï¼ï¼ï¼ï¼ï¼Œç”±äºé‡å¯å¯èƒ½å¯¼è‡´å¹³å°å‡ºç°é—®é¢˜å¯ç”¨ssh\nè¿æ¥è‡ªå·±çš„IPåœ°å€é‡æ–°ç™»é™†ï¼Œåªè¦å‡ºç°å±å¹•ç™»å½•æ—¶é—´ä»¥åŠçœ‹åˆ°å±å¹•æ¬¢è¿ç•Œé¢å³å¯\nControllerèŠ‚ç‚¹\niaas-install-mysql.sh\niaas-install-keystone.sh\niaas-install-glance.sh\n\nControllerèŠ‚ç‚¹\niaas-install-nova-controller.sh\nComputeèŠ‚ç‚¹\niaas-install-nova-compute.sh\n\nControllerèŠ‚ç‚¹\nsed -i 's/yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables -y/yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables -y --skip-broken/g' /usr/local/bin/iaas-install-neutron-controller.sh\n\niaas-install-neutron-controller.sh\nComputeèŠ‚ç‚¹\niaas-install-neutron-compute.sh\n\nControllerèŠ‚ç‚¹\niaas-install-dashboard.sh\n\nä»FtpæœåŠ¡å™¨ä¸Šä¸‹è½½é•œåƒåˆ°æœ¬åœ°ã€‚ï¼ˆåœ¨controllerä¸­æ“ä½œï¼‰\nsource /etc/keystone/admin-openrc.sh\nglance image-create --name CentOS7.5 --disk-format qcow2 --container-format bare --progress < /qianyios/images/CentOS_7.5_x86_64_XD.qcow2\n\n```\n\nè®¿é—®é¡µé¢http://192.168.48.10/dashboard/\n\n![image-20230619014112445](../img/xiandian-openstack/5080427a3e62da8a697977a9a280cce2a6c194b4.png)\n\n## æ›´å¤šæœåŠ¡\n\n```\n#æ‰€ä»¥å®‰è£…è„šæœ¬éƒ½åœ¨/usr/local/bin/ç›®å½•ä¸‹\n#æŒ‰ç…§è‡ªå·±éœ€æ±‚å®‰è£…\nå®‰è£…Swiftå¯¹è±¡å­˜å‚¨æœåŠ¡\niaas-install-swift-controller.sh\nå®‰è£…Heatç¼–é…æœåŠ¡\niaas-install-heat.sh\nå®‰è£…ZunæœåŠ¡\niaas-install-zun-controller.sh\nå®‰è£…Ceilometerç›‘æ§æœåŠ¡\niaas-install-ceilometer-controller.sh\nå®‰è£…Aodhç›‘æ§æœåŠ¡\niaas-install-aodh.sh\n```\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Centos 7","OpenStack","Iaas"],"categories":["äº‘åŸç”Ÿ"]},{"title":"å…¬å…±ç•™è¨€åŒº","url":"/posts/22484/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css\" />\n\n<div class=\"all animate__animated  animate__infinite animate__fadeIn animate__slow\" style=\"display: flex;justify-content: center;margin-bottom:30px; \">\n        <div class=\"icon\" style=\"width:36px;height: 36px;float:left;background-size: cover\">\n            <svg t=\"1684948258846\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"1080\" width=\"36\" height=\"36\"><path d=\"M334.12987 788.779221m-187.012987 0a187.012987 187.012987 0 1 0 374.025974 0 187.012987 187.012987 0 1 0-374.025974 0Z\" fill=\"#FFDEBB\" p-id=\"1081\"></path><path d=\"M114.094545 861.779117C114.094545 925.124156 164.987013 975.792208 228.608 975.792208h611.893195c63.617662 0 114.511792-50.673039 114.511792-114.013091V163.883221C955.012987 100.543169 904.118857 49.87013 840.501195 49.87013H230.925299C167.307636 49.87013 116.413506 100.543169 116.413506 163.883221v82.920727H86.336831C77.082597 246.803948 68.987013 254.866286 68.987013 264.075636v50.674702c0 9.212675 8.095584 17.276675 17.349818 17.276675H116.413506v64.493714H86.336831C77.082597 396.520727 68.987013 404.57974 68.987013 413.792416v50.674701c0 9.211013 8.095584 17.271688 17.349818 17.271688H116.413506v62.188052H86.336831C77.082597 543.926857 68.987013 551.995844 68.987013 561.205195v52.972052c0 9.216 8.095584 17.276675 17.349818 17.276675H116.413506v64.492052H86.336831C77.082597 695.945974 68.987013 704.008312 68.987013 713.219325v50.673039c0 9.212675 8.095584 17.278338 17.349818 17.278337H116.413506v54.125715l-2.313974 26.487688-0.004987-0.004987z m94.138182-164.849039H167.433974v-64.432208h40.798753c9.329039 0 17.487792-8.059013 17.487792-17.263376v-50.626494c0-9.202701-8.158753-17.25839-17.487792-17.25839H167.433974v-64.432207h40.798753c9.329039 0 17.487792-8.052364 17.487792-17.256728v-50.63148c0-9.204364-8.158753-17.25839-17.487792-17.25839H167.433974v-64.432208h40.798753c9.329039 0 17.487792-8.054026 17.487792-17.258389v-50.626494c0-9.204364-8.158753-17.261714-17.487792-17.261714H167.433974V164.200727c0-31.069091 24.481247-55.229506 55.949299-55.229506h616.610909c31.474701 0 55.950961 24.165403 55.950961 55.229506v697.260883c0 31.069091-24.47626 55.229506-55.950961 55.229507H223.384935c-31.468052 0-55.949299-24.160416-55.949299-55.229507v-80.540259h40.798754c9.329039 0 17.487792-8.052364 17.487792-17.256728v-47.17548c0-11.505039-8.158753-19.559065-17.487792-19.559065z m162.819325-272.751377h380.342857c25.357299 0 46.10161-21.274597 46.10161-47.28187V235.054545c0-26.002286-20.744312-47.28187-46.103272-47.28187H371.052052c-25.353974 0-46.10161 21.274597-46.10161 47.28187v140.660364c0 27.189195 20.744312 48.463792 46.10161 48.463792z\" fill=\"#86BC9F\" p-id=\"1082\"></path></svg>\n        </div>\n        <div class=\"wz\" style=\"padding:0 5px;line-height: 38px;height: 36px;float:left;\n        font-size: 20px;text-align: center;letter-spacing: 5px;\">\n            åƒå±¹ç•™è¨€åŒº\n        </div>\n                <div class=\"icon\" style=\"width:36px;height: 36px;float:left;background-size: cover\">\n            <svg t=\"1684948258846\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"1080\" width=\"36\" height=\"36\"><path d=\"M334.12987 788.779221m-187.012987 0a187.012987 187.012987 0 1 0 374.025974 0 187.012987 187.012987 0 1 0-374.025974 0Z\" fill=\"#FFDEBB\" p-id=\"1081\"></path><path d=\"M114.094545 861.779117C114.094545 925.124156 164.987013 975.792208 228.608 975.792208h611.893195c63.617662 0 114.511792-50.673039 114.511792-114.013091V163.883221C955.012987 100.543169 904.118857 49.87013 840.501195 49.87013H230.925299C167.307636 49.87013 116.413506 100.543169 116.413506 163.883221v82.920727H86.336831C77.082597 246.803948 68.987013 254.866286 68.987013 264.075636v50.674702c0 9.212675 8.095584 17.276675 17.349818 17.276675H116.413506v64.493714H86.336831C77.082597 396.520727 68.987013 404.57974 68.987013 413.792416v50.674701c0 9.211013 8.095584 17.271688 17.349818 17.271688H116.413506v62.188052H86.336831C77.082597 543.926857 68.987013 551.995844 68.987013 561.205195v52.972052c0 9.216 8.095584 17.276675 17.349818 17.276675H116.413506v64.492052H86.336831C77.082597 695.945974 68.987013 704.008312 68.987013 713.219325v50.673039c0 9.212675 8.095584 17.278338 17.349818 17.278337H116.413506v54.125715l-2.313974 26.487688-0.004987-0.004987z m94.138182-164.849039H167.433974v-64.432208h40.798753c9.329039 0 17.487792-8.059013 17.487792-17.263376v-50.626494c0-9.202701-8.158753-17.25839-17.487792-17.25839H167.433974v-64.432207h40.798753c9.329039 0 17.487792-8.052364 17.487792-17.256728v-50.63148c0-9.204364-8.158753-17.25839-17.487792-17.25839H167.433974v-64.432208h40.798753c9.329039 0 17.487792-8.054026 17.487792-17.258389v-50.626494c0-9.204364-8.158753-17.261714-17.487792-17.261714H167.433974V164.200727c0-31.069091 24.481247-55.229506 55.949299-55.229506h616.610909c31.474701 0 55.950961 24.165403 55.950961 55.229506v697.260883c0 31.069091-24.47626 55.229506-55.950961 55.229507H223.384935c-31.468052 0-55.949299-24.160416-55.949299-55.229507v-80.540259h40.798754c9.329039 0 17.487792-8.052364 17.487792-17.256728v-47.17548c0-11.505039-8.158753-19.559065-17.487792-19.559065z m162.819325-272.751377h380.342857c25.357299 0 46.10161-21.274597 46.10161-47.28187V235.054545c0-26.002286-20.744312-47.28187-46.103272-47.28187H371.052052c-25.353974 0-46.10161 21.274597-46.10161 47.28187v140.660364c0 27.189195 20.744312 48.463792 46.10161 48.463792z\" fill=\"#86BC9F\" p-id=\"1082\"></path></svg>\n        </div>\n    </div>\n\n\n<div class=\"animate__animated animate__slideInRight animate__slow animate__slower \"style=\"font-size: 20px;letter-spacing: 5px; text-align:center;\"> \n    è¿™é‡Œæ˜¯å…¬å…±ç•™è¨€åŒºï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å’Œå»ºè®®éƒ½å¯ä»¥ç•…æ‰€æ¬²è¨€ï¼Œåœ¨ä¸‹é¢ç•™è¨€å“¦ï¼\n</div>\n\n\n\n![image-20230525011705837](../img/åƒå±¹ç•™è¨€åŒº/462ade84ae8f233a3ac9ddf3cfad433a7c3f1f90.png)","tags":["Public"]},{"title":"GitBashç¬”è®°","url":"/posts/36392/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# GitBashç¬”è®°\n\nä¸‹è½½gitbashå·¥å…·[Git for Windows](https://gitforwindows.org/)å®‰è£…æ•™ç¨‹åœ¨**<u>æ–‡æœ«</u>**\n\nÂ·å®˜ç½‘ä¸‹è½½ https://git-scm.com/downloads\nÂ·Windowsç³»ç»Ÿç›´æ¥ç”¨https://gitforwindows.org/\n\n## åŸºæœ¬ç¯å¢ƒ\n\n### å®šä¹‰ç”¨æˆ·åå’Œé‚®ç®±\n\n```\ngit config --global user.name \"xxx\"\ngit config --global user.email \"xxx@xxx.xxx\"\n\næ£€æŸ¥è®¾å¯¹æ²¡æœ‰\ngit config user.name\ngit config user.email\n```\n\n![image-20230412004900608](../img/GitBash/58e73758ae7c606bc967c3e090df2e69550a8886.png)ç”¨æˆ·åï¼Œé‚®ç®±å°±æ˜¯ä½ ç»‘å®šçš„é‚®ç®±\n\n### ç”Ÿæˆè¿œç¨‹è¿æ¥å¯†é’¥\n\n```\nssh-keygen -t rsa -C \"xxx@xxx.xxx\"\næŸ¥çœ‹å¯†é’¥\ncat ~/.ssh/id_rsa.pub\n\nä¼šæœ‰ä¸€ä¸²å¯†å¯†éº»éº»çš„æ–‡å­—ï¼Œå…¨éƒ¨å¤åˆ¶åˆ°è¿™ ç”Ÿæˆå°±è¡Œäº†\n```\n\nå…¨å±€ä½¿ç”¨\n\n![image-20230412005423098](../img/GitBash/40216bcf81c291877129352b3e60819b7fabe274.png)\n\n### æµ‹è¯•è¿œç¨‹è¿æ¥\n\n```\nssh -T git@github.com\n```\n\n## åŸºæœ¬å‘½ä»¤\n\nå®˜æ–¹ç»™äº†ä¸€ä¸ªè¾ƒå¥½çš„è§£é‡Šæ–‡æ¡£\n\n![image-20230412022423485](../img/GitBash/60bb244f9e296e276d574e0c708e36a75f2f761d.png)\n\n### git init \n\n```\n#åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„gitä»“åº“\ngit init\n```\n\n### README.MDæ–‡ä»¶\n\næ²¡æœ‰å®ƒä¼šæŠ¥é”™ï¼Œå¦‚æœä½ æ²¡å‡†å¤‡å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤\n\n```\necho \"# 123456\" >> README.md\n```\n\n`README.md`æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œé€šå¸¸åœ¨Gité¡¹ç›®çš„æ ¹ç›®å½•ä¸­ï¼Œç”¨äºå‘å…¶ä»–äººä»‹ç»è¯¥é¡¹ç›®çš„ä¿¡æ¯ã€‚å…¶ä¸­ï¼Œ`.md`æ˜¯Markdownï¼ˆæ ‡è®°è¯­è¨€ï¼‰çš„æ–‡ä»¶æ ¼å¼ï¼Œåœ¨GitHubç­‰ç½‘ç«™ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚\n\nå…·ä½“æ¥è¯´ï¼Œ`README.md`æ–‡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š\n\n1. é¡¹ç›®åç§°å’Œæè¿°\n2. å¦‚ä½•å®‰è£…å’Œè¿è¡Œè¯¥é¡¹ç›®\n3. é¡¹ç›®çš„ä½¿ç”¨æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹\n4. è´¡çŒ®è€…çš„ä¿¡æ¯å’Œä»£ç è®¸å¯\n5. é¡¹ç›®çš„ç‰ˆæœ¬å†å²å’Œæœ€æ–°æ›´æ–°å†…å®¹ç­‰ç­‰ã€‚\n\né€šè¿‡ç¼–å†™`README.md`æ–‡ä»¶ï¼Œå¯ä»¥æä¾›ç»™å…¶ä»–äººä¸€ä¸ªç®€æ´ã€æ¸…æ™°çš„é¡¹ç›®æ¦‚è¿°ï¼Œæ–¹ä¾¿å…¶ä»–äººå¿«é€Ÿäº†è§£å’Œä½¿ç”¨è¯¥é¡¹ç›®ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹`README.md`æ–‡ä»¶æ¥æ›´æ–°å’Œç»´æŠ¤é¡¹ç›®çš„æœ€æ–°ä¿¡æ¯å’Œæ–‡æ¡£ã€‚\n\nåœ¨GitHubç­‰ç½‘ç«™ä¸­ï¼Œ`README.md`æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨æ¸²æŸ“ä¸ºç½‘é¡µæ˜¾ç¤ºï¼Œå› æ­¤å¯¹é¡¹ç›®çš„å®£ä¼ å’Œæ–‡æ¡£ç¼–å†™å…·æœ‰é‡è¦æ„ä¹‰ã€‚\n\n### git add\n\n```\nå°†æ–‡ä»¶æ·»åŠ åˆ°gitä»“åº“\ngit add <file>\nä¾‹å¦‚ ï¼š\næ³¨æ„æŒ‡ä»¤æœ«å°¾å°æ•°ç‚¹\ngit add . \n#å°†é¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“ä¸­\n```\n\n### git commit\n\n```\ngit commit -m \"message\"\næäº¤æ›´æ”¹ï¼Œå¹¶é™„ä¸Šæäº¤ä¿¡æ¯\n```\n\n### git status\n\n```\n#æŸ¥çœ‹Gitä»“åº“çŠ¶æ€\ngit status\n```\n\n### git log\n\n```\ngit log\næŸ¥çœ‹æäº¤è®°å½•\n```\n\n### git clone <url>\n\n![image-20230412012126767](../img/GitBash/98806c97ba049a4349a5c30259daf2eaf217673c.png)\n\n```\ngit clone https://github.comÂ·Â·Â·Â·Â·Â·\n#å…‹éš†ä¸€ä¸ªGitä»“åº“åˆ°æœ¬åœ°\n```\n\n### git push\n\n```\n#å°†æœ¬åœ°çš„æ›´æ”¹æ¨é€åˆ°è¿œç¨‹ä»“åº“\ngit push\n```\n\n### git pull\n\n```\n#ä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°æ›´æ”¹\ngit pull\n```\n\n### git branch\n\n```\n#æŸ¥çœ‹å’Œç®¡ç†åˆ†æ”¯\ngit branch\n```\n\n### git merge <branch>\n\n```\ngit merge\n#å°†ä¸€ä¸ªåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸­\n```\n\n### git stashï¼š\n\n```\n#å°†å½“å‰çš„æ›´æ”¹ä¿å­˜åˆ°â€œå­˜å‚¨åŒºâ€ï¼Œä»¥ä¾¿ä»¥åå†æ¬¡ä½¿ç”¨\ngit stash\n```\n\n### git remote add <name> <url>ï¼š\n\n```\n#å°†è¿œç¨‹ä»“åº“æ·»åŠ åˆ°æœ¬åœ°Gitä»“åº“ä¸­\nå…³è”æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“\n```\n\n## å®ä¾‹æ“ä½œ\n\n<span style=color:red;font-size:18px>è¯·å…ˆå®Œæˆ **1.åŸºæœ¬ç¯å¢ƒ**çš„æ‰€æœ‰æ­¥éª¤</span>\n\nå‡è®¾æˆ‘è¦ä¸Šä¼ é¡¹ç›®\n\n### GitHubå»ºå¥½ä¸€ä¸ªæ–°åº“\n\n![image-20230412021445830](../img/GitBash/534f06d9a51cf391c26370aa6132f7e8eca7fabc.png)\n\n### åœ¨æœ¬åœ°ä¹Ÿåˆ›å»ºä¸€ä¸ªæœ¬åœ°åº“\n\nå‹¾é€‰æ˜¾ç¤ºéšè—çš„é¡¹ç›®\n\n![image-20230412012857747](../img/GitBash/44c261e2a705959f8f0ceb87f35e2591e7c508c9.png)\n\n![image-20230412021542032](../img/GitBash/7daadf525c1c8828d00b1e0a4e471976ad1a8362.png)\n\nå³é”®ç©ºç™½å¤„\n\n![image-20230412021558652](../img/GitBash/86b28b1209dc8c90595fcf9864967f8190863acb.png)\n\n### åˆå§‹åŒ–æœ¬åœ°ä»“åº“\n\n```\ngit init\n```\n\n![image-20230412021648634](../img/GitBash/ff6eb402955eb345213491c87d72a15ef389ed9f.png)\n\n### å°†é¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶æ·»åŠ åˆ°æœ¬åœ°ä»“åº“ä¸­\n\n```\ngit add .\n#æ³¨æ„å°æ•°ç‚¹\n```\n\n### æ·»åŠ README.mdæ–‡ä»¶\n\nè¦æ±‚å½“å‰æ–‡ä»¶ä¸‹æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæ²¡æœ‰ä¼šæŠ¥é”™\n\n```\ngit add README.md\n```\n\n### æäº¤åˆ°ä»“åº“ï¼Œé™„ä¸Šä¿¡æ¯å¤‡æ³¨\n\n```\ngit commit -m \"ä¸Šä¼ æµ‹è¯•æ–‡ä»¶\"\n```\n\n![image-20230412021712910](../img/GitBash/bde6c3201ca433b1fef97b64df466e8d5b404985.png)\n\n### ä¿®æ”¹åˆ†æ”¯ï¼ˆåå­—è‡ªå®šï¼‰\n\n```\ngit branch -M main\n```\n\n`git branch -M main`å‘½ä»¤ç”¨äºå°†å½“å‰åˆ†æ”¯çš„åç§°ä¿®æ”¹ä¸º`main`ï¼Œå¹¶å°†æ‰€æœ‰å·²æœ‰åˆ†æ”¯æŒ‡å‘æ–°çš„ä¸»åˆ†æ”¯`main`ã€‚\n\n### å°†æœ¬åœ°ä»“åº“å…³è”åˆ°GitHubä»“åº“\n\n```\ngit remote add origin https://github.com/Â·Â·Â·Â·Â·Â·\n```\n\nhttpsçš„åœ°å€ï¼Œå¦‚æœhttpsä¸è¡Œä¹Ÿå¯ä»¥æ¢æˆsshåœ°å€\n\n![image-20230412021750914](../img/GitBash/405ae6f37791bad3e46a087d3170def4041dfd47.png)\n\n### æ‹‰å–æœ€æ–°æ›´æ”¹\n\n```\ngit pull origin main\n##ä¸Šä¼ githubä¹‹å‰pullä¸€ä¸‹,ç¬¬ä¸€æ¬¡åˆ›å»ºçš„åº“æ²¡æœ‰mainåˆ†æ”¯,æ‰€æœ‰ç¬¬ä¸€æ¬¡ä¸ç”¨æ‰“è¿™ä¸ªï¼Œä»¥åå»ºè®®ï¼Œä¹ æƒ¯çš„pullä»¥ä¸‹\n```\n\n### ä¸Šä¼ ä»£ç è‡³GitHubè¿œç¨‹ä»“åº“\n\n```\ngit push -u origin main\n```\n\n![image-20230412021831978](../img/GitBash/536ee70341cf5273432f947c3ab29f6c20f6f93f.png)\n\n![image-20230412021905011](../img/GitBash/9132fb58eda2e345b8fd5edca2e56d5b240338e1.png)\n\n## å…‹éš†ä»£ç \n\n###ä»è¿œç¨‹åº“å…‹éš†\nè¿™æ˜¯é’ˆå¯¹åœ¨æœ¬åœ°çš„ä¸€ä¸ªç©ºçš„é¡¹ç›®ï¼Œè¦ä»è¿œç¨‹åº“è€ƒä»£ç ä¸‹æ¥ï¼Œä¸€èˆ¬æœ‰**ä¸¤ä¸ª**æ­¥éª¤ï¼š\n\n**1.åœ¨æœ¬åœ°æƒ³è¦å…‹éš†çš„æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºGITç‰ˆæœ¬åº“ï¼Œä»¥åŠå»ºç«‹è¿œç¨‹åº“çš„è¿æ¥ã€‚ï¼ˆè¯¦ç»†æ­¥éª¤å¯ä»¥æŸ¥çœ‹å‰é¢ç« èŠ‚å†…å®¹ï¼‰**\n\n####å»ºå¥½æœ¬åœ°åº“ï¼ŒåŸºç¡€ç¯å¢ƒ åˆå§‹åŒ–ç­‰æ­¥éª¤ï¼Œæœ€åpullä¸€ä¸‹\n\n```\ngit init\ngit remote add origin https://github.com/Â·Â·Â·Â·Â·Â·Â·\ngit pull origin main\n```\n\n![image-20230412020003450](../img/GitBash/cd960cede63ee9bda65a9e114fb341c6375fb4b4.png)\n\n\n\n**2.ç”¨git cloneå…‹éš†è¿œç¨‹åº“æ‰€åœ¨é¡¹ç›®çš„ä»£ç ï¼Œæ¯”å¦‚è¦å…‹éš†ä¸Šä¸€èŠ‚çš„ä»£ç ï¼Œç”¨ä¸‹é¢å‘½ä»¤å³å¯**\n\n```\ngit clone https://github.com/Â·Â·Â·Â·Â·Â·Â·\n```\n\n![image-20230412021953276](../img/GitBash/97a6403c89ccd5dfd51cf2bb7844ad045d34771e.png)\n\n## æ›´æ–°ä»£ç \n\nåœ¨æœ¬åœ°ä»“åº“æ·»åŠ ä¸€ä¸ªtest2.txt\n\n![image-20230412020630452](../img/GitBash/f78640adb66874cff18c24fb1c4173118503b68e.png)\n\n1. æŸ¥çœ‹å½“å‰çš„gitä»“åº“çŠ¶æ€\n\n```\ngit status\n```\n\n2. æ›´æ–°test2.txtæ–‡ä»¶\n\n```\ngit add test2.txt\n```\n\n3. å¯¹test2.txtæ–‡ä»¶æ³¨å…¥å¤‡æ³¨ä¿¡æ¯\n\n```\ngit commit -m \"ä¸Šä¼ test2.txt\"\n```\n\n4. æ‹‰å–mainåˆ†æ”¯æœ€æ–°ä»£ç \n\n```\ngit pull origin main\n```\n\n5. pushåˆ°è¿œç¨‹mainåˆ†æ”¯ä¸Š\n\n```\ngit push origin main\n```\n\nä½ ä¹Ÿå¯ä»¥æ›´æ–°å…¨éƒ¨\n\n```\ngit add *\ngit commit -m \"ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶\"\ngit pull origin main\ngit push origin main\n```\n\næ‰“å¼€GitHubå·²ç»åŒæ­¥äº†\n\n![image-20230412020938339](../img/GitBash/c836702bafb01847aad25089b436afdfc3c8d995.png)\n\n## å®‰è£…æ•™ç¨‹\n\n### å»ºè®®æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ”¾gitï¼Œä½œä¸ºå®‰è£…è·¯å¾„\n\n![image-20230412001233082](../img/GitBash/59b310da6cac2759c4dad518aa320a35c753c388.png)\n\n![image-20230412001348748](../img/GitBash/e1ae716c98cd8f95e02e07e0d5d8f9ad75801b59.png)\n\n### æ›´æ¢è·¯å¾„\n\n![image-20230412001424892](../img/GitBash/07c2d38ab489d892fb7764a580efa632acbd2023.png)\n\n### æŒ‰éœ€è‡ªåŠ©é€‰æ‹©\n\n![image-20230412001812933](../img/GitBash/aeda6d2f6bfb12f8c73fd092fc04125883f829ca.png)\n\n![image-20230412001959068](../img/GitBash/dc57717b7f1110709dfbff07630513010c05742b.png)\n\n### é€‰æ‹©å¼€å§‹æ–‡ä»¶å¤¹\n\næ–¹æ¡†å†… Git å¯æ”¹ä¸ºå…¶ä»–åå­—ï¼Œä¹Ÿå¯ç‚¹å‡» â€œBrowseâ€¦â€ é€‰æ‹©å…¶ä»–æ–‡ä»¶å¤¹æˆ–è€…ç»™\"Donâ€™t create a Start Menu folder\" æ‰“å‹¾ä¸è¦æ–‡ä»¶å¤¹ï¼Œç‚¹å‡» [next]\n\n![image-20230412002158820](../img/GitBash/e94d7b0df64115e771ce255f7e86cab7c63c19ec.png)\n\n### Gitç¼–è¾‘å™¨\n\n![image-20230412002151766](../img/GitBash/ba491439ced78aef015bd5bbafc90dccfd5a48e9.png)\n\n### å†³å®šåˆå§‹åŒ–æ–°é¡¹ç›®(ä»“åº“)çš„ä¸»å¹²åå­—\n\n![image-20230412002328765](../img/GitBash/dddd718c71ad2392e6cfc4166d20a6e54f66f2c2.png)\n\n### è°ƒæ•´ç¯å¢ƒå˜é‡\n\n![image-20230412002502629](../img/GitBash/0ffa79254e4ef5ed0d31bf38363c4eafbe49900f.png)\n\n### é€‰æ‹©SSHæ‰§è¡Œæ–‡ä»¶\n\n![image-20230412002529388](../img/GitBash/a9841e6a5668e102ce9cc6c5dea649ef9b96bd61.png)\n\n### é€‰æ‹©HTTPSåç«¯ä¼ è¾“\n\næ³¨æ„ï¼šå¦‚æœå…·æœ‰ä¼ä¸šç®¡ç†è¯ä¹¦çš„ç»„ç»‡ä¸­ä½¿ç”¨Gitï¼Œå°±éœ€è¦ä½¿ç”¨å®‰å…¨é€šé“ã€‚\n\n![image-20230412003005628](../img/GitBash/ef6b6ebd40cfbe21eb565a0bd6107031fb9fc6de.png)\n\n### é…ç½®è¡Œå°¾ç¬¦å·è½¬æ¢\n\n![image-20230412003215788](../img/GitBash/435edd74569571f7af49772b297b2ca6a6803809.png)\n\n### é…ç½®ç»ˆç«¯æ¨¡æ‹Ÿå™¨ä»¥ä¸ Git Bash ä¸€èµ·ä½¿ç”¨\n\n![image-20230412003320788](../img/GitBash/092402ecec84b2b1d2c66d65d7dcac010d6e9091.png)\n\n### é€‰æ‹©é»˜è®¤çš„ git pull æ¨¡å¼\n\n`git pull` å°±æ˜¯è·å–æœ€æ–°çš„è¿œç¨‹ä»“åº“åˆ†æ”¯åˆ°æœ¬åœ°ï¼Œå¹¶ä¸æœ¬åœ°åˆ†æ”¯åˆå¹¶ã€‚\n\n![image-20230412003411911](../img/GitBash/c9f6c5f14c09d7640f421bb6ab19141cd33aa846.png)\n\n### é€‰æ‹©ä¸€ä¸ªå‡­è¯å¸®åŠ©ç¨‹åº\n\n![image-20230412003524413](../img/GitBash/d13036dc15fe51c408fae1c0cfc8956b68f043f4.png)\n\n### é…ç½®é¢å¤–çš„é€‰é¡¹\n\né…ç½®å»ºè®®ä¸¤ä¸ªéƒ½é€‰\n\n![image-20230412003604092](../img/GitBash/91b859e7561297074a5b07826757e8d4b47db990.png)\n\n### é…ç½®å®éªŒæ€§é€‰æ‹©\n\n![image-20230412003707549](../img/GitBash/f1ee851e62e8b3f64add0f38616858324428f4f7.png)\n\nå®‰è£…å®Œæˆï¼ï¼\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["GitBash"],"categories":["è¿ç»´"]},{"title":"Hadoopç»„ä»¶éƒ¨ç½²","url":"/posts/4909/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Hadoopç»„ä»¶éƒ¨ç½²\n\n[Hadoopéƒ¨ç½² - ä¸¥åƒå±¹ (qianyios.top)](https://blog.qianyios.top/posts/32436/)æœ¬ç¬”è®°å»ºç«‹åœ¨Hadoopä¼ªåˆ†å¸ƒæœºå­ä¸Šï¼Œå¯ä»¥å‰å¾€æŸ¥çœ‹å®‰è£…æœºå­\n\n## Zookeeper\n\nä½ éœ€è¦å…‹éš†å‡ºä¸‰å°hadoopçš„åŸºç¡€æ¨¡ç‰ˆæœºï¼Œ[è¿™é‡Œæœ‰æ•™ç¨‹å’Œè¯´æ˜](https://blog.qianyios.top/posts/32436/#%E5%AE%89%E8%A3%85Hadoop)ï¼Œç„¶åå†è¿›è¡Œå¼€å§‹æ“ä½œï¼Œè¿™ä¸ªZookeeperæ˜¯hadoopçš„ä¸€ä¸ªç»„ä»¶ï¼Œç‹¬ç«‹å‡ºæ¥äº†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„Zookeeperé›†ç¾¤ï¼ŒHbaseæ˜¯éœ€è¦åŸºäºZookeeperè¿è¡Œçš„ï¼Œå¦‚æœä½ ä¸éœ€è¦ç‹¬ç«‹çš„Zookeeperå¯ä»¥ä¸ç”¨åšè¿™ä¸ªï¼Œhbaseæœ‰è‡ªå¸¦çš„Zookeeper\n\n| åç§° |      ip       |\n| :--: | :-----------: |\n| zk01 | 192.168.48.11 |\n| zk02 | 192.168.48.12 |\n| zk03 | 192.168.48.13 |\n\n### è®¾ç½®hosts\n\n```\n[root@localhost ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.48.11 zk01\n192.168.48.12 zk02\n192.168.48.13 zk03\n```\n\n### æ›´æ”¹ä¸»æœºå\n\n```\nhostnamectl set-hostname zk01 && bash\n```\n\n### æ£€æŸ¥javaç‰ˆæœ¬\n\n```\n[root@zk01 ~]# java -version\njava version \"1.8.0_162\"\nJava(TM) SE Runtime Environment (build 1.8.0_162-b12)\nJava HotSpot(TM) 64-Bit Server VM (build 25.162-b12, mixed mode)\n```\n\n### æ£€æŸ¥hadoopç‰ˆæœ¬\n\n```\n[root@zk01 ~]# hadoop version\nHadoop 3.1.3\nSource code repository https://gitbox.apache.org/repos/asf/hadoop.git -r ba631c436b806728f8ec2f54ab1e289526c90579\nCompiled by ztang on 2019-09-12T02:47Z\nCompiled with protoc 2.5.0\nFrom source with checksum ec785077c385118ac91aadde5ec9799\nThis command was run using /usr/local/hadoop/share/hadoop/common/hadoop-common-3.1.3.jar\n```\n\n### å®‰è£…zookeeper\n\n```\ntar -xf apache-zookeeper-3.8.0-bin.tar.gz -C /opt\necho \"export ZOOKEEPER_HOME=/opt/apache-zookeeper-3.8.0-bin\" >> /etc/profile\necho \"export PATH=\\$ZOOKEEPER_HOME/bin:\\$PATH\" >> /etc/profile\nsource /etc/profile\ncd /opt/apache-zookeeper-3.8.0-bin/\ncp conf/zoo_sample.cfg conf/zoo.cfg\n\nvi conf/zoo.cfg\n    tickTime=2000\n    dataDir=/opt/apache-zookeeper-3.8.0-bin/data\n    clientPort=2181\n    initLimit=10\n    syncLimit=5\n    maxClientCnxns=60\n    server.1=zk01:2888:3888\n    server.2=zk02:2888:3888\n    server.3=zk03:2888:3888\n\nmkdir /opt/apache-zookeeper-3.8.0-bin/data\necho 1 > /opt/apache-zookeeper-3.8.0-bin/data/myid\ncat /opt/apache-zookeeper-3.8.0-bin/data/myid\n```\n\n### å…³æœºå…‹éš†å‡ºä¸¤å°æœº zk02 zk03\n\nzk02  192.168.48.12\n\n```\nvi /opt/apache-zookeeper-3.8.0-bin/data/myid\n2\n```\n\nzk03  192.168.48.13\n\n```\nvi /opt/apache-zookeeper-3.8.0-bin/data/myid\n3\n```\n\n### äº’ç›¸pingæµ‹è¯•è¿é€šæ€§\n\n```\nping zk01\nping zk02\nping zk03\n```\n\nèƒ½äº’é€šè¯´æ˜æˆåŠŸ\n\n### å¼€å¯zookeeperæœåŠ¡\n\néœ€å¼€å¯ä¸¤å°æ‰èƒ½çœ‹è§Mode: follower\n\n```\nzkServer.sh start\nzkServer.sh status\nzkServer.sh stop\n```\n\n## HBaseå®‰è£…\n\n### å®‰è£…hbase\n\n```\n[root@hadoop ~]# ll\n-rw-r--r--  1 root root 232190985 3æœˆ  17 19:37 hbase-2.2.2-bin.tar.gz\n\ntar -xf hbase-2.2.2-bin.tar.gz -C /usr/local/\nmv /usr/local/hbase-2.2.2 /usr/local/hbase\necho \"export HBASE_HOME=/usr/local/hbase\" >> /etc/profile\necho \"export PATH=\\$PATH:\\$HBASE_HOME/bin\" >> /etc/profile\nsource /etc/profile\n\n------------------------------------------------------------------------\n[root@hadoop ~]# vi /usr/local/hbase/bin/hbase\nCLASSPATH=${CLASSPATH}:$JAVA_HOME/lib/tools.jar:/usr/local/hbase/lib/*\næˆ–\n[root@hadoop ~]# sed -i \"s/CLASSPATH=\\${CLASSPATH}:\\$JAVA_HOME\\/lib\\/tools.jar/CLASSPATH=\\${CLASSPATH}:\\$JAVA_HOME\\/lib\\/tools.jar:\\/usr\\/local\\/hbase\\/lib\\/*/g\" /usr/local/hbase/bin/hbase\n------------------------------------------------------------------------\n\n[root@hadoop ~]# hbase version                                                       SLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/usr/local/hadoop/share/hadoop/common/lib/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/usr/local/hbase/lib/client-facing-thirdparty/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\nHBase 2.2.2\nSource code repository git://6ad68c41b902/opt/hbase-rm/output/hbase revision=e6513a76c91cceda95dad7af246ac81d46fa2589\nCompiled by hbase-rm on Sat Oct 19 10:10:12 UTC 2019\nFrom source with checksum 4d23f97701e395c5d34db1882ac5021b\n```\n\n### HBaseé…ç½®\n\n`HBASE_MANAGES_ZK=true`è®¾ç½®ä¸ºtrueå°±æ˜¯è¯´ç”¨hbaseè‡ªå¸¦çš„Zookeeperï¼Œå¦‚æœä½ æœ‰ç‹¬ç«‹çš„Zookeeperé›†ç¾¤ï¼Œè‡ªè¡Œè®¾ç½®\n\n```bash\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162\" >> $HBASE_HOME/conf/hbase-env.sh\necho \"export HBASE_CLASSPATH=/usr/local/hbase/conf\" >> $HBASE_HOME/conf/hbase-env.sh\necho \"export HBASE_MANAGES_ZK=true\" >> $HBASE_HOME/conf/hbase-env.sh\n\nvi $HBASE_HOME/conf/hbase-site.xml\n<configuration>\n        <property>\n                <name>hbase.rootdir</name>\n                <value>hdfs://yjx48:9000/hbase</value>\n        </property>\n        <property>\n                <name>hbase.cluster.distributed</name>\n                <value>true</value>#æ˜¯å¦åˆ†å¸ƒå¼è¿è¡Œï¼Œfalseå³ä¸ºå•æœº\n        </property>\n        <property>\n                <name>hbase.unsafe.stream.capability.enforce</name>\n                <value>false</value>\n        </property>\n</configuration>\n```\n\n### HBaseå¯åŠ¨\n\n```\nstart-all.sh \nstart-hbase.sh\n[root@hadoop hbase]# jps\n16532 ResourceManager\n22502 HMaster-----------\n15799 NameNode\n16697 NodeManager\n23097 Jps\n15962 DataNode\n22666 HRegionServer-----------\n16223 SecondaryNameNode\n22431 HQuorumPeer\n[root@hadoop ~]# hbase shell\nhbase(main):001:0> list\nTABLE\n0 row(s)\nTook 0.3118 seconds\n=> []\nhbase(main):002:0> exit\n```\n\n### è®¿é—®ç½‘é¡µ\n\nip:16010\n\n### HBaseç®¡ç†\n\n| å­¦å·ï¼ˆS_Noï¼‰ | å§“åï¼ˆS_Nameï¼‰ | æ€§åˆ«ï¼ˆS_Sexï¼‰ | å¹´é¾„ï¼ˆS_Ageï¼‰ |\n| :----------: | :------------: | :-----------: | :-----------: |\n|   2015001    |    zhangsan    |     male      |      23       |\n|   2015002    |      Mary      |    female     |      22       |\n|   2015003    |      Lisi      |     male      |      24       |\n\n#### åˆ›å»ºå­¦ç”Ÿè¡¨\n\n```\nhbase(main):004:0> create 'student','no','name','sex','age'\nCreated table student\nTook 1.3125 seconds\n=> Hbase::Table - student\nhbase(main):005:0> list\nTABLE\nstudent\n1 row(s)\nTook 0.0074 seconds\n=> [\"student\"]\n#æŸ¥çœ‹è¡¨ç»“æ„\nhbase(main):001:0> describe 'student'\nTable student is ENABLED\nstudent\nCOLUMN FAMILIES DESCRIPTION\n{NAME => 'age', VERSIONS => '1', EVICT_BLOCKS_ON_CLOSE => 'false'\n.......\n```\n\n#### æ·»åŠ æ•°æ®\n\ns001ä¸ºè¡Œé”®\n\n```\nhbase(main):001:0> scan 'student'\nROW                        COLUMN+CELL\n0 row(s)\nTook 0.2712 seconds\nhbase(main):002:0> put 'student','s001','no','2015001'\nTook 0.0236 seconds\nhbase(main):003:0> put 'student','s001','name','zhangsan'\nTook 0.0057 seconds\nhbase(main):004:0> scan 'student'\nROW                        COLUMN+CELL\n s001                      column=name:, timestamp=1679058447572, value=zhangsan\n s001                      column=no:, timestamp=1679058447550, value=2015001\n1 row(s)\nTook 0.0179 seconds\n```\n\n#### æŸ¥çœ‹æ•´è¡Œ\n\n```\nhbase(main):001:0> get 'student','s001'\nCOLUMN                     CELL\n name:                     timestamp=1679058447572, value=zhangsan\n no:                       timestamp=1679058447550, value=2015001\n1 row(s)\nTook 0.2910 seconds\n```\n\n#### æŸ¥çœ‹å•å…ƒæ ¼\n\n```\nhbase(main):008:0> get 'student','s001','name'\nCOLUMN                     CELL\n name:                     timestamp=1679058447572, value=zhangsan\n1 row(s)\nTook 0.0053 seconds\n```\n\n### è®¢å•ä¾‹å­\n\n![image-20230317212813880](../img/Hadoopç»„ä»¶éƒ¨ç½²/7105ba3fd997598b9d7de8368254d5aaf24c1aec.png)\n\n#### åˆ›å»ºorderè¡¨\n\n```\ncreate 'order','userinfo','orderinfo'\nlist\nput 'order','1','userinfo:name','sw'\nput 'order','1','userinfo:age','24'\nput 'order','1','orderinfo:id','23333'\nput 'order','1','orderinfo:money','30'\nscan 'order'\n-----------------------------------------------------------\nhbase(main):017:0* create 'order','userinfo','orderinfo'\nCreated table order\nTook 2.3102 seconds\n=> Hbase::Table - order\nhbase(main):018:0> list\nTABLE\norder\nstudent\n2 row(s)\nTook 0.0104 seconds\n=> [\"order\", \"student\"]\nhbase(main):019:0> put 'order','1','userinfo:name','sw'\nTook 0.0326 seconds\nhbase(main):020:0> put 'order','1','userinfo:age','24'\nTook 0.0031 seconds\nhbase(main):021:0> put 'order','1','orderinfo:id','23333'\nTook 0.0036 seconds\nhbase(main):022:0> put 'order','1','orderinfo:money','30'\nTook 0.0031 seconds\nhbase(main):023:0> scan 'order'\nROW                        COLUMN+CELL\n 1                         column=orderinfo:id, timestamp=1679060732699, value=23333\n 1                         column=orderinfo:money, timestamp=1679060732711, value=30\n 1                         column=userinfo:age, timestamp=1679060732685, value=24\n 1                         column=userinfo:name, timestamp=1679060732667, value=sw\n1 row(s)\nTook 0.0116 seconds\n```\n\n### ä¿®æ”¹æ•°æ®\n\n```\nhbase(main):001:0> put 'student','s001','name','zhangxiaosan'\nTook 0.2879 seconds\nhbase(main):002:0> get 'student','s001','name'\nCOLUMN                     CELL\n name:                     timestamp=1679061655288, value=zhangxiaosan\n1 row(s)\nTook 0.0280 seconds\n```\n\n### æ—¶é—´æˆ³\n\n#æ•°æ®æ·»åŠ åˆ°HBaseçš„æ—¶å€™éƒ½ä¼šè¢«è®°å½•ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œè¿™ä¸ªæ—¶é—´æˆ³è¢«æˆ‘ä»¬å½“åšä¸€ä¸ªç‰ˆæœ¬ã€‚\n\nå½“ä¿®æ”¹æŸä¸€æ¡çš„æ—¶å€™ï¼Œæœ¬è´¨ä¸Šæ˜¯å¾€é‡Œè¾¹æ–°å¢ä¸€æ¡æ•°æ®ï¼Œè®°å½•çš„ç‰ˆæœ¬åŠ ä¸€ã€‚\n\n![image-20230317220909473](../img/Hadoopç»„ä»¶éƒ¨ç½²/41ae96ec2b636400a97d0c0377d7ba5f7e4467f6.png)\n\n#ç°åœ¨è¦æŠŠè¿™æ¡è®°å½•çš„å€¼æ”¹ä¸º40ï¼Œå®é™…ä¸Šå°±æ˜¯å¤šæ·»åŠ ä¸€æ¡è®°å½•ï¼Œåœ¨è¯»çš„æ—¶å€™æŒ‰ç…§æ—¶é—´æˆ³è¯»æœ€æ–°çš„è®°å½•\n\n![image-20230317221537086](../img/Hadoopç»„ä»¶éƒ¨ç½²/b5b87b734906aa507db9aa8474c02f6856295bca.png)\n\n```\nput 'order','1','orderinfo:money','40'\nget 'order','1','orderinfo:money'\n\nhbase(main):008:0> put 'order','1','orderinfo:money','40'\nTook 0.0190 seconds\nhbase(main):009:0> get 'order','1','orderinfo:money'\nCOLUMN                     CELL\n orderinfo:money           timestamp=1679064515487, value=40\n1 row(s)\nTook 0.0096 seconds\n\n```\n\n### åˆ é™¤æ•°æ®\n\nnameä¸€å®šè¦åŠ ä¸ª`:`\n\n```\nscan 'student'\ndelete 'student','s001','name:'\nget 'student','s001','name'\n```\n\n### åˆ é™¤è¡¨\n\n```\ndisable 'student'\ndescribe 'student'\ndrop 'student'\n```\n\n### è®¿é—®ç½‘é¡µ\n\nip:16010\n\n## NoSQLæ•°æ®åº“å®‰è£…\n\nï¼ˆRedisé”®å€¼å¯¹éå…³ç³»å‹æ•°æ®åº“ï¼‰\n\n### å®‰è£…redis\n\n```\ntar -xf redis-5.0.5.tar.gz\nmv redis-5.0.5 /opt/redis\ncd /opt/redis\nyum install -y gcc automake autoconf libtool\n#ç¼–è¯‘å®‰è£…\nmake && make install\ncd src\n[root@yjx48 src]# ./redis-server\n5861:C 30 Mar 2023 08:49:48.699 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\n5861:C 30 Mar 2023 08:49:48.699 # Redis version=5.0.5, bits=64, commit=00000000, modified=0, pid=5861, just started\n5861:C 30 Mar 2023 08:49:48.699 # Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf\n5861:M 30 Mar 2023 08:49:48.699 * Increased maximum number of open files to 10032 (it was originally set to 1024).\n                _._\n           _.-``__ ''-._\n      _.-``    `.  `_.  ''-._           Redis 5.0.5 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._\n (    '      ,       .-`  | `,    )     Running in standalone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\n |    `-._   `._    /     _.-'    |     PID: 5861\n  `-._    `-._  `-./  _.-'    _.-'\n |`-._`-._    `-.__.-'    _.-'_.-'|\n |    `-._`-._        _.-'_.-'    |           http://redis.io\n  `-._    `-._`-.__.-'_.-'    _.-'\n |`-._`-._    `-.__.-'    _.-'_.-'|\n |    `-._`-._        _.-'_.-'    |\n  `-._    `-._`-.__.-'_.-'    _.-'\n      `-._    `-.__.-'    _.-'\n          `-._        _.-'\n              `-.__.-'\n\n5861:M 30 Mar 2023 08:49:48.700 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n```\n\n```\n#å¦å¼€ä¸€ä¸ªä¼šè¯\n[root@yjx48 ~]# cd /opt/redis/src\n[root@yjx48 src]# ./redis-cli\n127.0.0.1:6379> set hello world\nOK\n127.0.0.1:6379> get hello\n\"world\"\n127.0.0.1:6379> exit\n[root@yjx48 src]#\n```\n\n### æ•°æ®åº“ç®¡ç†\n\n![image-20230330112542140](../img/Hadoopç»„ä»¶éƒ¨ç½²/23833340d878c73b11cf4064c0a4ab51ecc4b4d3.png)\n\n### redisè¯­æ³•\n\n```\n#æ’å…¥æ•°æ®\nset student:2015001:sname zhangsan\nget student:2015001:sname\nset student:2015001:sex male\nget student:2015001:sex\n#ä¿®æ”¹æ•°æ®\nset student:2015001:sname zhangxiaosan\nget student:2015001:sname\n#åˆ é™¤æ•°æ®\nget set student:2015001:sname\ndel set student:2015001:sname\nget set student:2015001:sname\n#æ²¡æ•°æ®äº†\n```\n\n### Hashæ•°æ®åº“\n\nstudentè¡¨\n\n```\n2015001={\n\tname=zhangsan\n\tsex=male\n\tage=23\n}\n```\n\næ’å…¥å’ŒæŸ¥è¯¢æ•°æ®\n\n```\nhset student:2015001 name zhangsan\nhset student:2015001 sex male\nhset student:2015001 age 23\nhget student:2015001 name \nhget student:2015001 sex\nhgetall student:2015001\n```\n\nä¿®æ”¹æ•°æ®\n\n```\nhset student:2015001 sex female\nhget student:2015001 sex female\n```\n\nåˆ é™¤æ•°æ®\n\n```\nhdel student:2015001 sex\nhget student:2015001 sex\n#æ— æ•°æ®\n```\n\n## MongoDB\n\nâ€‹\t\tMongodbæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ–‡æ¡£æ•°æ®åº“ï¼Œä»‹äºå…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´ï¼Œæ˜¯éå…³ç³»æ•°\næ®åº“å½“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œã€æœ€åƒå…³ç³»æ•°æ®åº“çš„ä¸€ç§ NOSQLæ•°æ®åº“ã€‚\nâ€‹\t\tMongoæœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ”¯æŒçš„æŸ¥è¯¢è¯­è¨€éå¸¸å¼ºå¤§ï¼Œè¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºé¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œå‡ ä¹å¯ä»¥å®ç°ç±»\nä¼¼å…³ç³»æ•°æ®åº“å•è¡¨æŸ¥è¯¢çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ”¯æŒå¯¹æ•°æ®å»ºç«‹ç´¢å¼•ã€‚\nâ€‹\t\tMongodbæ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸æ¾æ•£ï¼Œæ˜¯ç±»ä¼¼jsonçš„bsonæ ¼å¼ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±»å‹ã€‚\n\n### JSONè¯­æ³•\n\nJSON è¯­æ³•æ˜¯ JavaScript è¯­æ³•çš„å­é›†ã€‚\n\n#### JSON æ•°å­—\n\nJSON æ•°å­—å¯ä»¥æ˜¯æ•´å‹æˆ–è€…æµ®ç‚¹å‹ï¼š\n{ \"age\":30 }\n\n#### JSON å¯¹è±¡\n\nJSON å¯¹è±¡åœ¨å¤§æ‹¬å· {} ä¸­ä¹¦å†™ï¼š\nå¯¹è±¡å¯ä»¥åŒ…å«å¤šä¸ªåç§°/å€¼å¯¹ï¼š\n\n#### JSON æ•°ç»„\n\nJSON æ•°ç»„åœ¨ä¸­æ‹¬å· [] ä¸­ä¹¦å†™ï¼š\næ•°ç»„å¯åŒ…å«å¤šä¸ªå¯¹è±¡ï¼š\n\n```\n[\n{ key1 : value1-1 , key2:value1-2 },\n{ key1 : value2-1 , key2:value2-2 },\n{ key1 : value3-1 , key2:value3-2 },\n...\n{ key1 : valueN-1 , key2:valueN-2 },\n]\n\n{\n\t\"sites\": [\n        { \"name\":\"èœé¸Ÿæ•™ç¨‹\" , \"url\":\"www.runoob.com\" },\n        { \"name\":\"google\" , \"url\":\"www.google.com\" },\n        { \"name\":\"å¾®åš\" , \"url\":\"www.weibo.com\" }\n       ]\n}\n```\n\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯¹è±¡ sites æ˜¯åŒ…å«ä¸‰ä¸ªå¯¹è±¡çš„æ•°ç»„ã€‚æ¯ä¸ªå¯¹è±¡ä»£è¡¨ä¸€æ¡å…³äºæŸä¸ªç½‘ç«™ï¼ˆnameã€urlï¼‰\nçš„è®°å½•ã€‚\n\n#### JSON å¸ƒå°”å€¼\n\nJSON å¸ƒå°”å€¼å¯ä»¥æ˜¯ true æˆ–è€… falseï¼š\n\n```\n{ \"flag\":true }\n```\n\n#### JSON null\n\nJSON å¯ä»¥è®¾ç½® null å€¼ï¼š\n\n```\n{ \"runoob\":null }\n```\n\n### MongoDBå®‰è£…\n\n```\ntar -xf mongodb-linux-x86_64-rhel70-5.0.5.tgz \nmv mongodb-linux-x86_64-rhel70-5.0.5 /opt/mongodb\ncd /opt/mongodb/bin\n./mongo -version\n\n#é»˜è®¤æƒ…å†µä¸‹ MongoDB å¯åŠ¨åä¼šåˆå§‹åŒ–ä»¥ä¸‹ä¸¤ä¸ªç›®å½•ï¼Œäº‹å…ˆåˆ›å»ºå¥½ï¼š\n#æ•°æ®å­˜å‚¨ç›®å½•ï¼š/var/lib/mongodb\n#æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼š/var/log/mongodb\nmkdir -p /var/lib/mongo\nmkdir -p /var/log/mongodb\n#å¯åŠ¨mongodbæœåŠ¡\ncd /opt/mongodb/bin\n./mongod --dbpath /var/lib/mongo --logpath /var/log/mongodb/mongod.log --fork\nps ax | grep mongod\n./mongo\n```\n\n### æ•°æ®åº“ç®¡ç†\n\n#### å¸¸ç”¨å‘½ä»¤\n\n#åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“\n\n```\n>show dbs\nadmin 0.000GB\nconfig 0.000GB\nlocal 0.000GB\n```\n\n#åˆ‡æ¢æ•°æ®åº“\n\n```\n>use admin\nswitched to db admin\n```\n\n#æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰é›†åˆ\n\n```\n>show collections\nsystem.version\n```\n\n#æ˜¾ç¤ºé›†åˆçš„æ‰€æœ‰æ•°æ®\n\n```\n>db.system.version.find()\n{ \"_id\" : \"featureCompatibilityVersion\", \"version\" : \"5.0\" }\n```\n\n#### åˆ›å»ºæ•°æ®åº“å’Œé›†åˆ\n\n```\n#mongodbæ²¡æœ‰åˆ›å»ºæ•°æ®åº“å‘½ä»¤\n> use school\nswitched to db school\n#åˆ›å»ºé›†åˆï¼ŒåŒæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸Šçš„æ•°æ®åº“\n> db.createCollection('student')\n{ \"ok\" : 1 }\n> show dbs\nadmin 0.000GB\nconfig 0.000GB\nlocal 0.000GB\nschool 0.000GB\n> show collections\nStudent\n```\n\n#### æ’å…¥æ•°æ®\n\n```\n#ä¸¤ç§æ–¹æ³•æ’å…¥æ•°æ®ï¼šinsertå’Œsave\n#_idå¯ä»¥æ‰‹åŠ¨è¾“å…¥ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆ\n>db.student.insert({\n  sno: 2015001,\n  name: \"zhangsan\",\n  sex: \"male\",\n  age: 23\n})\nWriteResult({ \"nInserted\" : 1 })\n\n> db.student.find()\n{ \"_id\" : ObjectId(\"642e21279c9d145e592fda70\"), \"sno\" : 2015001, \"name\" : \"zhangsan\", \"sex\" : \"male\", \"age\" : 23 }\n\n> db.student.save({sno:2015002,name:'marry',sex:'female',age:22})\nWriteResult({ \"nInserted\" : 1 })\n\n> db.student.find()\n{ \"_id\" : ObjectId(\"642e259014c45ed3f90756c0\"), \"sno\" : 2015001, \"name\" : \"zhangsan\", \"sex\" : \"male\", \"age\" : 23 }\n{ \"_id\" : ObjectId(\"642e259614c45ed3f90756c1\"), \"sno\" : 2015002, \"name\" : \"marry\", \"sex\" : \"female\", \"age\" : 22 }\n```\n\n```\n#insertå’ŒsaveåŒºåˆ«ï¼šæ‰‹åŠ¨æ’å…¥ä¸€è¡Œæ—¶ï¼Œå¦‚_idå·²ç»å­˜åœ¨ï¼Œinsertåˆ™å‡ºé”™ï¼Œsaveåˆ™æ›¿ä»£åŸå€¼ã€‚\n> db.student.insert({\"_id\": ObjectId(\"642e259014c45ed3f90756c0\"),   \"sno\": 2015001,   \"name\": \"zhangsan\",   \"sex\": \"male\",   \"age\": 23 })\n\nWriteResult({\n        \"nInserted\" : 0,\n        \"writeError\" : {\n                \"code\" : 11000,\n                \"errmsg\" : \"E11000 duplicate key error collection: test.student index: _id_ dup key: { _id: ObjectId('642e21279c9d145e592fda70') }\"\n        }\n})\n#æ›´æ”¹å¹´é¾„23â†’24\n> db.student.save({\"_id\": ObjectId(\"642e259014c45ed3f90756c0\"),   \"sno\": 2015001,   \"name\": \"zhangsan\",   \"sex\": \"male\",   \"age\": 24 })\nWriteResult({ \"nMatched\" : 1, \"nUpserted\" : 0, \"nModified\" : 1 })\n\n> db.student.find()\n{ \"_id\" : ObjectId(\"642e259014c45ed3f90756c0\"), \"sno\" : 2015001, \"name\" : \"zhangsan\", \"sex\" : \"male\", \"age\" : 24 }\n{ \"_id\" : ObjectId(\"642e259614c45ed3f90756c1\"), \"sno\" : 2015002, \"name\" : \"marry\", \"sex\" : \"female\", \"age\" : 22 }\n```\n\n#### æŸ¥æ‰¾æ•°æ®\n\n```\n#æŸ¥è¯¢\n#æŸ¥è¯¢æ ¼å¼ï¼šfind([query],[fields]ï¼Œç±»ä¼¼äºsqlçš„selectè¯­å¥ï¼Œqueryç›¸å½“äºwhereï¼Œfieldsç›¸å½“\näºæ˜¾ç¤ºçš„åˆ—\n#æŸ¥è¯¢åå­—ä¸ºzhangsançš„æ•°æ®\n> db.student.find({name:'zhangsan'})\n{ \"_id\" : ObjectId(\"642e259014c45ed3f90756c0\"), \"sno\" : 2015001, \"name\" : \"zhangsan\", \"sex\" : \"male\", \"age\" : 24 }\n#æŸ¥è¯¢åå­—ä¸ºzhangsançš„äººçš„æ€§åˆ«\n> db.student.find({name:'zhangsan'},{name:1,sex:1})\n{ \"_id\" : ObjectId(\"642e259014c45ed3f90756c0\"), \"name\" : \"zhangsan\", \"sex\" : \"male\" }\n#ä¸æ˜¾ç¤º_id\n> db.student.find({name:'zhangsan'},{_id:0,name:1,sex:1})\n{ \"name\" : \"zhangsan\", \"sex\" : \"male\" }\n#æŸ¥è¯¢æŒ‡å®šåˆ—\n> db.student.find({},{name:1})\n{ \"_id\" : ObjectId(\"642e259014c45ed3f90756c0\"), \"name\" : \"zhangsan\" }\n{ \"_id\" : ObjectId(\"642e259614c45ed3f90756c1\"), \"name\" : \"marry\" }\n#andæŸ¥è¯¢æ¡ä»¶ \n> db.student.find({name:'zhangsan',sex:'female'})\n> db.student.find({name:'zhangsan',sex:'male'})\n{ \"_id\" : ObjectId(\"642e259014c45ed3f90756c0\"), \"sno\" : 2015001, \"name\" : \"zhangsan\", \"sex\" : \"male\", \"age\" : 24 }\n>db.student.find({$or:[{age:24},{age:22}]})\n#oræŸ¥è¯¢\n> db.student.find({  $or:[{age:24},{age:22}]  })\n{ \"_id\" : ObjectId(\"642e259014c45ed3f90756c0\"), \"sno\" : 2015001, \"name\" : \"zhangsan\", \"sex\" : \"male\", \"age\" : 24 }\n{ \"_id\" : ObjectId(\"642e259614c45ed3f90756c1\"), \"sno\" : 2015002, \"name\" : \"marry\", \"sex\" : \"female\", \"age\" : 22 }\n```\n\n#### ä¿®æ”¹æ•°æ®\n\n#æ ¼å¼ï¼šupdate( query, <update object or pipeline>[, upsert_bool, multi_bool] )\n#query : updateçš„æŸ¥è¯¢æ¡ä»¶ï¼Œç±»ä¼¼sql updateæŸ¥è¯¢å†…whereåé¢çš„ã€‚\n#update : updateçš„å¯¹è±¡å’Œä¸€äº›æ›´æ–°çš„æ“ä½œç¬¦ï¼ˆå¦‚$,$inc...ï¼‰ç­‰ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºsql updateæŸ¥è¯¢å†…\nsetåé¢çš„\n#upsert : å¯é€‰ï¼Œè¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯ï¼Œå¦‚æœä¸å­˜åœ¨updateçš„è®°å½•ï¼Œæ˜¯å¦æ’å…¥objNew,trueä¸ºæ’å…¥ï¼Œé»˜è®¤æ˜¯\nfalseï¼Œä¸æ’å…¥ã€‚\n#multi : å¯é€‰ï¼Œmongodb é»˜è®¤æ˜¯false,åªæ›´æ–°æ‰¾åˆ°çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå¦‚æœè¿™ä¸ªå‚æ•°ä¸ºtrue,å°±æŠŠæŒ‰æ¡ä»¶æŸ¥\nå‡ºæ¥å¤šæ¡è®°å½•å…¨éƒ¨æ›´æ–°ã€‚\n\n```\n> db.student.update({name:'zhangsan'},{$set:{age:23}})\nWriteResult({ \"nMatched\" : 1, \"nUpserted\" : 0, \"nModified\" : 1 })\n\n> db.student.find()\n{ \"_id\" : ObjectId(\"642e259014c45ed3f90756c0\"), \"sno\" : 2015001, \"name\" : \"zhangsan\", \"sex\" : \"male\", \"age\" : 23 }\n{ \"_id\" : ObjectId(\"642e259614c45ed3f90756c1\"), \"sno\" : 2015002, \"name\" : \"marry\", \"sex\" : \"female\", \"age\" : 22 }\n```\n\n#### åˆ é™¤æ•°æ®\n\n```\n> db.student.remove({name:'zhangsan'})\nWriteResult({ \"nRemoved\" : 1 })\n> db.student.find()\n{ \"_id\" : ObjectId(\"642e259614c45ed3f90756c1\"), \"sno\" : 2015002, \"name\" : \"marry\", \"sex\" : \"female\", \"age\" : 22 }\n```\n\n#### åˆ é™¤é›†åˆ\n\n```\n> db.createCollection('course')\n{ \"ok\" : 1 }\n> show collections\ncourse\nstudent\n> db.course.drop()\ntrue\n> show collections\nstudent\n\n```\n\n## Hiveæ•°æ®ä»“åº“å®‰è£…\n\nhive æ˜¯ä¸€ç§åº•å±‚å°è£…äº†Hadoop çš„æ•°æ®ä»“åº“å¤„ç†å·¥å…·ï¼Œä½¿ç”¨ç±»SQL çš„hiveSQL è¯­è¨€å®ç°æ•°æ®æŸ¥è¯¢ï¼Œæ‰€æœ‰hive çš„æ•°æ®éƒ½å­˜å‚¨åœ¨Hadoop å…¼å®¹çš„æ–‡ä»¶ç³»ç»Ÿã€(ä¾‹å¦‚ï¼Œ[Amazon S3](https://baike.baidu.com/item/Amazon S3/10809744)ã€HDFS)ä¸­ã€‚hive åœ¨åŠ è½½æ•°æ®è¿‡ç¨‹ä¸­ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œä»»ä½•çš„ä¿®æ”¹ï¼Œåªæ˜¯å°†æ•°æ®ç§»åŠ¨åˆ°HDFS ä¸­hive è®¾å®šçš„ç›®å½•ä¸‹ï¼Œå› æ­¤ï¼Œhive ä¸æ”¯æŒå¯¹æ•°æ®çš„æ”¹å†™å’Œæ·»åŠ ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯åœ¨åŠ è½½çš„æ—¶å€™ç¡®å®šçš„ã€‚\n\n**ç”¨æˆ·æ¥å£Client**\n\nç”¨æˆ·æ¥å£ä¸»è¦æœ‰ä¸‰ä¸ªï¼šCLIï¼ŒClient å’Œ WUIã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ Cliï¼ŒCliå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåŒæ—¶å¯åŠ¨ä¸€ä¸ª hive å‰¯æœ¬ã€‚Client æ˜¯ hive çš„å®¢æˆ·ç«¯ï¼Œç”¨æˆ·è¿æ¥è‡³ hive Serverã€‚åœ¨å¯åŠ¨ Client æ¨¡å¼çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å‡º hive Server æ‰€åœ¨èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨è¯¥èŠ‚ç‚¹å¯åŠ¨ hive Serverã€‚ WUI æ˜¯é€šè¿‡æµè§ˆå™¨è®¿é—® hiveã€‚\n\n**å…ƒæ•°æ®å­˜å‚¨ Metastore**\n\nhive å°†å…ƒæ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚ mysqlã€derbyã€‚hive ä¸­çš„å…ƒæ•°æ®åŒ…æ‹¬è¡¨çš„åå­—ï¼Œè¡¨çš„åˆ—å’Œåˆ†åŒºåŠå…¶å±æ€§ï¼Œè¡¨çš„å±æ€§ï¼ˆæ˜¯å¦ä¸ºå¤–éƒ¨è¡¨ç­‰ï¼‰ï¼Œè¡¨çš„æ•°æ®æ‰€åœ¨ç›®å½•ç­‰ã€‚\n\n**é©±åŠ¨å™¨ï¼šDriver è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨**\n\nè§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å®Œæˆ HQL æŸ¥è¯¢è¯­å¥ä»è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ç¼–è¯‘ã€ä¼˜åŒ–ä»¥åŠæŸ¥è¯¢è®¡åˆ’çš„ç”Ÿæˆã€‚ç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¹¶åœ¨éšåç”± MapReduce è°ƒç”¨æ‰§è¡Œã€‚\n\n**Hadoop**\n\nhive çš„æ•°æ®å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¤§éƒ¨åˆ†çš„æŸ¥è¯¢ç”± MapReduce å®Œæˆï¼ˆä¸åŒ…å« * çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚ select * from tbl ä¸ä¼šç”Ÿæˆ MapReduce ä»»åŠ¡ï¼‰ã€‚\n\n![image-20230413095240448](../img/Hadoopç»„ä»¶éƒ¨ç½²/f79d1b048d8f3badd95b31cb952d9b151e4db804.png)\n\n![image-20230413095305455](../img/Hadoopç»„ä»¶éƒ¨ç½²/9a7cd6b9a3e1e3b57b9dde839c2a59cb113cdec9.png)\n\n### å®‰è£…hive\n\n```\ntar -xf apache-hive-3.1.2-bin.tar.gz\nmv apache-hive-3.1.2-bin /usr/local/hive\necho \"export HIVE_HOME=/usr/local/hive\" >> /etc/profile\necho \"export PATH=\\$HIVE_HOME/bin:\\$PATH\" >> /etc/profile\nsource /etc/profile\ncd /usr/local/hive/conf/\ncp hive-default.xml.template hive-default.xml\nvi hive-site.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?>\n<configuration>\n  <property>\n    <name>javax.jdo.option.ConnectionURL</name>\n    <value>jdbc:mysql://yjx48:3306/hive?useSSL=false</value>\n    <description>JDBC connect string for a JDBC metastore</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionDriverName</name>\n    <value>com.mysql.jdbc.Driver</value>\n    <description>Driver class name for a JDBC metastore</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionUserName</name>\n    <value>root</value>\n    <description>username to use against metastore database</description>\n  </property>\n  <property>\n    <name>javax.jdo.option.ConnectionPassword</name>\n    <value>Yjx@666.</value>\n    <description>password to use against metastore database</description>\n  </property>\n  <property>\n    <name>hive.exec.mode.local.auto</name>\n    <value>true</value>\n  </property>\n</configuration>\n```\n\nå…¶ä¸­Yjx@666.æ˜¯mysqlå¯†ç \n\n### å®‰è£…mysql\n\n```\ncd\nyum remove mariadb-libs.x86_64 -y\nyum install -y net-tools\nmkdir mysql\ntar -xf mysql-5.7.37-1.el7.x86_64.rpm-bundle.tar -C mysql\ncd mysql\nrpm -ivh mysql-community-common-5.7.37-1.el7.x86_64.rpm\nrpm -ivh mysql-community-libs-5.7.37-1.el7.x86_64.rpm\nrpm -ivh mysql-community-libs-compat-5.7.37-1.el7.x86_64.rpm\nrpm -ivh mysql-community-client-5.7.37-1.el7.x86_64.rpm\nrpm -ivh mysql-community-devel-5.7.37-1.el7.x86_64.rpm\nrpm -ivh mysql-community-server-5.7.37-1.el7.x86_64.rpm\nsystemctl enable --now mysqld\ngrep  'temporary password' /var/log/mysqld.log\nmysqladmin -uroot -p'darm4hb.2Rsy' password 'Yjx@666.'\nmysql -uroot -pYjx@666.\n#ç»™rootç”¨æˆ·æˆæƒ\ngrant all privileges on *.* to 'root'@'localhost' identified by 'Yjx@666.' with grant option;\ngrant all privileges on *.* to 'root'@'%' identified by 'Yjx@666.' with grant option;\nflush privileges;\ncreate database hive;\nexit\n```\n\n### é…ç½®å’Œå¯åŠ¨hive\n\n```\ncd\ntar -xf mysql-connector-java-5.1.40.tar.gz\ncp mysql-connector-java-5.1.40/mysql-connector-java-5.1.40-bin.jar /usr/local/hive/lib/\nmv /usr/local/hive/lib/guava-19.0.jar{,.bak}\ncp /usr/local/hadoop/share/hadoop/common/lib/guava-27.0-jre.jar  /usr/local/hive/lib\nstart-all.sh \nschematool -dbType mysql -initSchema\nhive\n```\n\n### Hiveæ•°æ®ç±»å‹\n\n|          ç±»å‹          |                 æè¿°                  |     ç¤ºä¾‹     |\n| :--------------------: | :-----------------------------------: | :----------: |\n|   TINYINTï¼ˆtinyintï¼‰   | ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰æœ‰ç¬¦å·æ•´æ•°ï¼Œ  -128~127 |      1       |\n|  SMALLINTï¼ˆsmallintï¼‰  | 2å­—èŠ‚ï¼ˆ16ä½ï¼‰æœ‰ç¬¦å·æ•´æ•°ï¼Œ-32768~32767 |      1       |\n|       INTï¼ˆintï¼‰       |        4å­—èŠ‚ï¼ˆ32ä½ï¼‰æœ‰ç¬¦å·æ•´æ•°        |      1       |\n|    BIGINTï¼ˆbigintï¼‰    |        8å­—èŠ‚ï¼ˆ64ä½ï¼‰æœ‰ç¬¦å·æ•´æ•°        |      1       |\n|     FLOATï¼ˆfloatï¼‰     |       4å­—èŠ‚ï¼ˆ32ä½ï¼‰å•ç²¾åº¦æµ®ç‚¹æ•°       |      1       |\n|    DOUBLEï¼ˆdoubleï¼‰    |       8å­—èŠ‚ï¼ˆ64ä½ï¼‰åŒç²¾åº¦æµ®ç‚¹æ•°       |      1       |\n|    DECIMAL(decimal)    |         ä»»æ„ç²¾åº¦çš„å¸¦ç¬¦å·å°æ•°          |      1       |\n|   BOOLEANï¼ˆbooleanï¼‰   |              true/false               |  true/false  |\n|    STRINGï¼ˆstringï¼‰    |             å­—ç¬¦ä¸²ï¼Œå˜é•¿              | â€˜aâ€™,â€˜bâ€™,â€˜1â€™  |\n|   VARCHARï¼ˆvarcharï¼‰   |              å˜é•¿å­—ç¬¦ä¸²               |     â€˜aâ€™      |\n|      CHARï¼ˆcharï¼‰      |            å›ºå®šé•¿åº¦å­—ç¬¦ä¸²             |     â€˜aâ€™      |\n|    BINANYï¼ˆbinanyï¼‰    |               å­—èŠ‚æ•°ç»„                |   æ— æ³•è¡¨ç¤º   |\n| TIMESTAMPï¼ˆtimestampï¼‰ |           æ—¶é—´æˆ³ï¼Œçº³ç§’ç²¾åº¦            | 1.22327E+11  |\n|      DATEï¼ˆdateï¼‰      |                 æ—¥æœŸ                  | â€˜2016-03-29â€™ |\n\n### hiveçš„é›†åˆæ•°æ®ç±»å‹\n\n|  ç±»å‹  |                             æè¿°                             |       ç¤ºä¾‹        |\n| :----: | :----------------------------------------------------------: | :---------------: |\n| ARRAY  |                 æœ‰åºæ•°ç»„ï¼Œå­—æ®µçš„ç±»å‹å¿…é¡»ç›¸åŒ                 |   Arrayï¼ˆ1ï¼Œ2ï¼‰   |\n|  MAP   | ä¸€ç»„æ— åºçš„é”®å€¼å¯¹ï¼Œé”®çš„ç±»å‹å¿…é¡»æ˜¯åŸå§‹æ•°æ®ç±»å‹ï¼Œä»–çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ŒåŒä¸€ä¸ªæ˜ å°„çš„é”®çš„ç±»å‹å¿…é¡»ç›¸åŒï¼Œå€¼å¾—ç±»å‹ä¹Ÿå¿…é¡»ç›¸åŒ |   Mapï¼ˆâ€˜aâ€™,1ï¼‰    |\n| STRUCT |               ä¸€ç»„å‘½åçš„å­—æ®µ,å­—æ®µç±»å‹å¯ä»¥ä¸åŒ                | Structï¼ˆâ€˜aâ€™,1,2.0 |\n| UNION  | UNIONåˆ™ç±»ä¼¼äºCè¯­è¨€ä¸­çš„UNIONç»“æ„ï¼Œåœ¨ç»™å®šçš„ä»»ä½•ä¸€ä¸ªæ—¶é—´ç‚¹ï¼ŒUNIONç±»å‹å¯ä»¥ä¿å­˜æŒ‡å®šæ•°æ®ç±»å‹ä¸­çš„ä»»æ„ä¸€ç§ |                   |\n\n### åŸºæœ¬å‘½ä»¤\n\n#### åˆ›å»ºæ•°æ®åº“å’Œè¡¨\n\n```\ncreate database hive;\nuse hive;\ncreate table usr(id int,name string,age int);\n```\n\n#### æŸ¥çœ‹å’Œæè¿°æ•°æ®åº“å’Œè¡¨\n\n```\nshow databases;\nshow tables;\ndescribe database hive;\ndescribe hive.usr;\n```\n\n#### å‘è¡¨ä¸­è£…è½½æ•°æ®\n\n```\ninsert into usr values(1,'sina',20);\n\n#ä»linuxè¯»å–æ•°æ®\n[root@yjx48 ~]# echo \"2,zhangsan,22\" >> /opt/data\nhive> use hive;\ncreate table usr1(id int,name string,age int) row format delimited fields terminated by \",\";\nload data local inpath '/opt/data' overwrite into table usr1;\n```\n\n#### ä»hdfsä¸­è¯»å–æ•°æ®\n\n```\necho \"3,lisi,25\" >> /opt/test.txt\nhdfs dfs -put /opt/test.txt /\nhive\nload data inpath 'hdfs://yjx48:9000/test.txt' overwrite into table usr1;\n```\n\n#### ä»åˆ«çš„è¡¨ä¸­è¯»å–æ•°æ®\n\n```\nhive> select * from usr;\nOK\n1       sina    20\n\nhive> select * from usr1;\nOK\n3       lisi    25\n#è¯»å–usr1çš„id=3çš„æ•°æ®åˆ°usr\ninsert overwrite table usr select * from usr1 where id=3;\n\nhive> select * from usr;\nOK\n3       lisi    25\n```\n\n#### æŸ¥è¯¢è¡¨ä¸­æ•°æ®\n\n```\nselect * from usr1;\n```\n\n### Hiveå®éªŒï¼šè¯é¢‘ç»Ÿè®¡\n\n#### åœ¨linuxä¸Šåˆ›å»ºè¾“å…¥ç›®å½•ï¼š/opt/inputï¼›\n\n```\nmkdir /opt/input\n```\n\n#### åœ¨ä»¥ä¸Šè¾“å…¥ç›®å½•ä¸­æ·»åŠ å¤šä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­æ–‡ä»¶ä¸­åŒ…å«å•è¯ï¼šå§“åå­¦å·ï¼Œä¾‹å¦‚ï¼šyjx48ï¼›\n\n```\necho \"hello1 yjx48\" >> /opt/input/text1.txt\necho \"hello2 yjx48\" >> /opt/input/text2.txt\necho \"hello3 yjx48\" >> /opt/input/text3.txt\n```\n\n#### åœ¨Hiveä¸­åˆ›å»ºè¡¨â€œdocsâ€ï¼Œå¹¶æŠŠè¾“å…¥ç›®å½•çš„æ–‡ä»¶æ•°æ®åŠ è½½åˆ°è¯¥è¡¨ä¸­ï¼›\n\n```\nhive\nuse hive;\ncreate table docs(line string);\nload data local inpath '/opt/input' overwrite into table docs;\nselect * from docs;\n```\n\n#### ç¼–å†™HiveQLè¯­å¥å¯¹è¾“å…¥ç›®å½•çš„æ–‡æœ¬è¿›è¡Œè¯é¢‘ç»Ÿè®¡ï¼Œç»Ÿè®¡å•è¯â€œå§“åå­¦å·â€å‡ºç°çš„æ¬¡æ•°ã€‚\n\n```\ncreate table word_count as\nselect word,count(1) as count from\n(select explode(split(line,' ')) as word from docs) w\ngroup by word\norder by word;\n\nselect * from word_count;\ndescribe word_count;\n```\n\n![image-20230413214018276](../img/Hadoopç»„ä»¶éƒ¨ç½²/d20f98bec8ed685fde8bfd0e4db5fb446cc84539.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Hadoop","Zookeeper","HBase","NoSQL","MongoDB","Hive"],"categories":["è¿ç»´"]},{"title":"OpenStack-TrainåŒèŠ‚ç‚¹éƒ¨ç½²","url":"/posts/56647/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# OpenStack-TrainåŒèŠ‚ç‚¹éƒ¨ç½²\n\n## èŠ‚ç‚¹æ¶æ„å›¾ï¼ˆæœ€å°é…ç½®ï¼‰\n\n|    ä¸»æœºå     |  ip1ï¼ˆNATï¼‰   | ip2ï¼ˆä»…ä¸»æœºï¼‰  | ç¡¬ç›˜ | å†…å­˜ |\n| :-----------: | :-----------: | :------------: | :--: | :--: |\n| controller-48 | 192.168.48.10 | 192.168.148.10 | 100G |  8G  |\n|  computer-48  | 192.168.48.20 | 192.168.148.20 | 100G |  3G  |\n\nåŒèŠ‚ç‚¹å‡é‡‡ç”¨[CentOS-7-x86_64-DVD-2009.iso](../img/http://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-DVD-2009.iso?spm=a2c6h.25603864.0.0.60196aeaV18bmR)è‹±æ–‡æœ€å°åŒ–å®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹ä¸åšè§£é‡Š\n\n<font color='cornflowerred'>Computer-48éœ€è¦ç‰¹åˆ«æ³¨æ„åŠ ç¡¬ç›˜</font>\n\nc<font color='red'>omputer-48éœ€è¦å‹¾é€‰å¤„ç†å™¨è™šæ‹ŸåŒ–</font>\n\n![image-20240301134940011](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301134940011-1709275202729-27.png)\n\n### ç½‘ç»œè®¾ç½®\n\n<font color='red'>æ§åˆ¶èŠ‚ç‚¹ç½‘ç»œè®¾ç½®</font>\n\n<font color='red'>ens33</font>\n\n![image-20240301140048584](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301140048584-1709275708072-155.png)\n\n<font color='red'>ens36</font>\n\n![image-20240301140239316](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301140239316-1709275708073-156.png)\n\n\n\n<font color='red'>è®¡ç®—èŠ‚ç‚¹</font>\n\nåŸç†å’Œæ§åˆ¶èŠ‚ç‚¹ä¸€æ ·ï¼Œç¬¬äºŒå¼ ç½‘å¡ä¸ç”¨è®¾ç½®ç½‘å…³\n\n<font color='red'>ens33</font>\n\n![image-20240301140500814](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301140500814-1709275708073-157.png)\n\nens36\n\n![image-20240301140612238](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301140612238-1709275708073-158.png)\n\n<font color='red'>æ¸©é¦¨æç¤ºï¼ˆå°è´´å£«ï¼‰</font>\n\n>   è¿™é‡Œå°±è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆç¬¬äºŒå¼ ä»…ä¸»æœºç½‘å¡ä¸ç”¨è®¾ç½®ç½‘å…³ï¼Œå› ä¸ºæˆ‘ä»¬æœ¬æ„æ˜¯é€šè¿‡NATè¿›è¡Œä¸å¤–ç½‘åšæ•°æ®äº¤æ¢å’Œè·å–å¤–ç½‘èµ„æºå¯ä»¥è¿æ¥äº’è”ç½‘çš„ï¼Œä»…ä¸»æœºä»…ä»…åªæ˜¯ç”¨äºè¿›è¡Œè™šæ‹Ÿæœºå†…éƒ¨èµ„æºçš„æ•°æ®äº¤æ¢ï¼Œä¸å…·å¤‡ä¸å¤–ç½‘è¿æ¥çš„ä½œç”¨ï¼Œæ˜¯æ— æ³•è®¿é—®äº’è”ç½‘çš„ï¼Œå¦‚æœä¸¤å¼ ç½‘å¡åŒæ—¶è®¾ç½®äº†ç½‘å…³ï¼Œå¯èƒ½ä¼šé€ æˆæ— æ³•è®¿é—®openstacké‡Œåˆ›å»ºçš„è™šæ‹Ÿæœºæ— æ³•è®¿é—®äº’è”ç½‘ï¼Œæˆ–è€…æœ¬æœºæ— æ³•è®¿é—®äº’è”ç½‘çš„æƒ…å†µï¼ŒåŸå› æ˜¯é»˜è®¤è·¯ç”±å¯èƒ½ä¼šä»¥ä»…ä¸»æœºç½‘å¡çš„ç½‘ç»œè¿›è¡Œä¸å¤–ç½‘é“¾æ¥ï¼Œä½†æ˜¯æ²¡åŠæ³•è”ç½‘ã€‚æ‰€ä»¥è¯·ä¸è¦åœ¨ç¬¬äºŒå—ç½‘å¡è®¾ç½®ç½‘å…³\n\n\n\nç‰ˆæœ¬å¯¹ç…§è¡¨\n\n|   OpenStack ç‰ˆæœ¬    | CentOS ç‰ˆæœ¬ |\n| :-----------------: | :---------: |\n|   Train ä»¥åŠæ›´æ—©    |      7      |\n| Ussuri and Victoria |      8      |\n|   Wallaby åˆ° Yoga   |  Stream 8   |\n\n## å®‰å…¨æ€§\n\n### åŸºæœ¬ç”¨æˆ·ä¿¡æ¯\n\nOpenStack å„ç»„ä»¶éƒ½éœ€è¦åœ¨æ§åˆ¶èŠ‚ç‚¹æ•°æ®åº“ä¸­æ³¨å†Œä¸“å±è´¦æˆ·ä»¥å­˜æ”¾æ•°æ®ä¿¡æ¯ï¼Œæ•…éœ€è¦è®¾ç½®å¯†ç ï¼Œå¼ºçƒˆå»ºè®®å„ç»„ä»¶çš„å¯†ç ä»¥åŠå®¿ä¸»æœºå¯†ç å„ä¸ç›¸åŒã€‚\n\n|    OpenStack ç»„ä»¶     |         å¯†ç           |\n| :-------------------: | :-------------------: |\n|     æ§åˆ¶èŠ‚ç‚¹ root     |        123456         |\n|     è®¡ç®—èŠ‚ç‚¹ root     |        123456         |\n|  Metadata å…ƒæ•°æ®å¯†é’¥  |    METADATA_SECRET    |\n|   Mariadb root è´¦æˆ·   |     MARIADB_PASS      |\n|     RabbitMQ æœåŠ¡     |      RABBIT_PASS      |\n|    OpenStack admin    |      ADMIN_PASS       |\n|    Placement æœåŠ¡     |    PLACEMENT_PASS     |\n|    Keystone æ•°æ®åº“    |    KEYSTONE_DBPASS    |\n|      Glance æœåŠ¡      |      GLANCE_PASS      |\n|     Glance æ•°æ®åº“     |     GLANCE_DBPASS     |\n|       Nova æœåŠ¡       |       NOVA_PASS       |\n|      Nova æ•°æ®åº“      |      NOVA_DBPASS      |\n|     Neutron æœåŠ¡      |     NEUTRON_PASS      |\n|    Neutron æ•°æ®åº“     |    NEUTRON_DBPASS     |\n|      Cinder æœåŠ¡      |      CINDER_PASS      |\n|     Cinder æ•°æ®åº“     |     CINDER_DBPASS     |\n|    Horizon æ•°æ®åº“     |      DASH_DBPASS      |\n|       SwiftæœåŠ¡       |      SWIFT_PASS       |\n|       HeatæœåŠ¡        |       HEAT_PASS       |\n|    Heatæ•°æ®åº“æœåŠ¡     |      HEAT_DBPASS      |\n| heat_domain_adminç”¨æˆ· | HEAT_DOMAIN_USER_PASS |\n\n### èº«ä»½éªŒè¯\n\næ§åˆ¶èŠ‚ç‚¹ç®¡ç† OpenStack æœåŠ¡æ—¶éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯ï¼Œå¯å°†è®¤è¯ä¿¡æ¯å¯¼å…¥åˆ°æ§åˆ¶èŠ‚ç‚¹ç¯å¢ƒå˜é‡ä¸­ï¼Œæ–¹ä¾¿åç»­å®‰è£…é…ç½®ä½¿ç”¨ã€‚\nadmin-openrc.sh æ–‡ä»¶éœ€æå‰ç¼–å†™å¹¶æ”¾å…¥æ§åˆ¶èŠ‚ç‚¹ä¸­ï¼Œåç»­å®‰è£…å°†ä¸å†è¯´æ˜ç”±æ¥\n\n```\ncat >> admin-openrc.sh << EOF\nexport OS_PROJECT_DOMAIN_NAME=Default\nexport OS_USER_DOMAIN_NAME=Default\nexport OS_PROJECT_NAME=admin\nexport OS_USERNAME=admin\nexport OS_PASSWORD=123456\nexport OS_AUTH_URL=http://controller-48:5000/v3\nexport OS_IDENTITY_API_VERSION=3\nexport OS_IMAGE_API_VERSION=2\nEOF\n\ncat >> user_dog-openrc.sh << EOF\nexport OS_USERNAME=user_dog\nexport OS_PASSWORD=123456\nexport OS_PROJECT_NAME=Train\nexport OS_USER_DOMAIN_NAME=RegionOne\nexport OS_PROJECT_DOMAIN_NAME=RegionOne\nexport OS_AUTH_URL=http://controller-48:5000/v3\nexport OS_IDENTITY_API_VERSION=3\nexport OS_IMAGE_API_VERSION=2\nEOF\n\n# OS_USERNAME  ç™»å½• OpenStack æœåŠ¡çš„ç”¨æˆ·å\n# OS_PASSWORD  ç™»å½• OpenStack æœåŠ¡çš„ç”¨æˆ·å¯†ç \n# OS_PROJECT_NAME ç™»å½•æ—¶è¿›å…¥çš„é¡¹ç›®å\n# OS_USER_DOMAIN_NAME  ç™»å½•æ—¶è¿›å…¥çš„åŸŸå\n# OS_PROJECT_DOMAIN_NAME  ç™»å½•æ—¶è¿›å…¥çš„é¡¹ç›®åŸŸå\n# OS_AUTH_URL æŒ‡å®š Keystoneï¼ˆèº«ä»½è®¤è¯æœåŠ¡ï¼‰çš„ URL  \n# å¦‚æœªéƒ¨ç½² DNS æœåŠ¡å™¨ï¼Œåˆ™éœ€è¦åœ¨ hostsä¸­æŒ‡å®š controller-48 æ˜ å°„ï¼Œæˆ–å°† controller-48 ç”¨æ§åˆ¶èŠ‚ç‚¹ IP æ›¿ä»£\n# OS_IDENTITY_API_VERSION èº«ä»½è®¤è¯æœåŠ¡çš„ API ç‰ˆæœ¬å· \n# OS_IMAGE_API_VERSION é•œåƒæœåŠ¡çš„ API ç‰ˆæœ¬å·\n```\n\n### æµ‹è¯•ç”¨æˆ·\n\n| ç”¨æˆ·    | å¯†ç    |\n| ------- | ------ |\n| admin   | 123456 |\n| use_dog | 123456 |\n\n### ç‰©ç†èŠ‚ç‚¹å…³é—­é¡ºåº\n\nç»™æ¯å°æœºéƒ½åŠ ä¸Šä¸¤ä¸ªè„šæœ¬\n\n```\ncat >> stop.sh << EOF\n#!/bin/bash\n# å…³é—­æ‰€æœ‰ OpenStack èŠ‚ç‚¹\n# ä¾æ¬¡å…³é—­è®¡ç®—èŠ‚ç‚¹ã€ç½‘ç»œèŠ‚ç‚¹ã€æ§åˆ¶èŠ‚ç‚¹\nfor server in \\$(openstack server list -f value -c ID); do\n    openstack server stop \\$server\ndone\n# å…³é—­è®¡ç®—èŠ‚ç‚¹\necho \"Stopping compute services...\"\nsystemctl stop openstack-nova-compute.service\nsystemctl stop libvirtd.service\n# å…³é—­ç½‘ç»œèŠ‚ç‚¹\necho \"Stopping network services...\"\nsystemctl stop openvswitch.service\nsystemctl stop neutron-server.service\nsystemctl stop neutron-linuxbridge-agent.service\nsystemctl stop neutron-dhcp-agent.service\nsystemctl stop neutron-metadata-agent.service\nsystemctl stop neutron-l3-agent.service\n# å…³é—­æ§åˆ¶èŠ‚ç‚¹\necho \"Stopping control services...\"\nsystemctl stop mariadb.service\nsystemctl stop rabbitmq-server.service\nsystemctl stop memcached.service\nsystemctl stop httpd.service\nsystemctl stop openstack-glance-api.service\nsystemctl stop openstack-glance-registry.service\nsystemctl stop openstack-cinder-api.service\nsystemctl stop openstack-cinder-scheduler.service\nsystemctl stop openstack-cinder-volume.service\nsystemctl stop openstack-nova-api.service\nsystemctl stop openstack-nova-scheduler.service\nsystemctl stop openstack-nova-conductor.service\nsystemctl stop openstack-nova-novncproxy.service\nsystemctl stop openstack-nova-consoleauth.service\nsystemctl stop openstack-keystone.service\nsystemctl stop openstack-heat-api.service\nsystemctl stop openstack-heat-api-cfn.service\nsystemctl stop openstack-heat-engine.service\nsystemctl stop openstack-swift-proxy.service\nsystemctl stop openstack-swift-account.service\nsystemctl stop openstack-swift-container.service\nsystemctl stop openstack-swift-object.service\necho \"Stopping all services...\"\nsystemctl stop --all\n# å…³é—­ç”µæº\necho \"Shutting down the system...\"\npoweroff\nEOF\n\ncat >> start.sh << EOF\n#!/bin/bash\n# é‡æ–°å¯åŠ¨ OpenStack æœåŠ¡\n# ä¾æ¬¡å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹ã€ç½‘ç»œèŠ‚ç‚¹ã€è®¡ç®—èŠ‚ç‚¹\n# å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹\necho \"Starting control services...\"\nsystemctl start mariadb.service\nsystemctl start rabbitmq-server.service\nsystemctl start memcached.service\nsystemctl start httpd.service\nsystemctl start openstack-glance-api.service\nsystemctl start openstack-glance-registry.service\nsystemctl start openstack-cinder-api.service\nsystemctl start openstack-cinder-scheduler.service\nsystemctl start openstack-cinder-volume.service\nsystemctl start openstack-nova-api.service\nsystemctl start openstack-nova-scheduler.service\nsystemctl start openstack-nova-conductor.service\nsystemctl start openstack-nova-novncproxy.service\nsystemctl start openstack-nova-consoleauth.service\nsystemctl start openstack-keystone.service\nsystemctl start openstack-heat-api.service\nsystemctl start openstack-heat-api-cfn.service\nsystemctl start openstack-heat-engine.service\nsystemctl start openstack-swift-proxy.service\nsystemctl start openstack-swift-account.service\nsystemctl start openstack-swift-container.service\nsystemctl start openstack-swift-object.service\n# å¯åŠ¨ç½‘ç»œèŠ‚ç‚¹\necho \"Starting network services...\"\nsystemctl start openvswitch.service\nsystemctl start neutron-server.service\nsystemctl start neutron-linuxbridge-agent.service\nsystemctl start neutron-dhcp-agent.service\nsystemctl start neutron-metadata-agent.service\nsystemctl start neutron-l3-agent.service\n# å¯åŠ¨è®¡ç®—èŠ‚ç‚¹\necho \"Starting compute services...\"\nsystemctl start libvirtd.service\nsystemctl start openstack-nova-compute.service\nEOF\n```\n\n<font color='red'>ï¼ˆå…ˆç»™ä¸¤ä¸ªè®¡ç®—èŠ‚ç‚¹æ‰§è¡Œ-æœ€åç­‰è®¡ç®—èŠ‚ç‚¹å®Œå…¨å…³é—­ï¼Œå†ç»™æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰</font>\n\n```\nå…³é—­ç‰©ç†æœºçš„æ—¶å€™è¿è¡Œ\nsh stop.sh\n(è¿è¡Œçš„æ—¶å€™å¯èƒ½ä¼šæç¤ºä½ æœ‰äº›æœåŠ¡æ‰¾ä¸åˆ°ï¼ŒæŠ¥é”™ï¼Œè¿™ä¸ªæ²¡å…³ç³»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ²¡é—®é¢˜çš„\n```\n\n### ç‰©ç†èŠ‚ç‚¹å¼€å¯é¡ºåº\n\n> <font color='red'>å…ˆç»™controller-48è¿è¡Œstart.shå†ç»™è®¡ç®—èŠ‚ç‚¹è¿è¡Œstart.sh</font>\n>\n> sh start.sh\n\n## åŸºç¡€ç¯å¢ƒ\n\n### ä¿®æ”¹ä¸»æœºåå’Œé˜²ç«å¢™\n\ncontroller-48èŠ‚ç‚¹\n\n```\nhostnamectl set-hostname controller-48 && bash\nsystemctl disable firewalld --now\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\necho \"192.168.48.10 controller-48\" >> /etc/hosts\necho \"192.168.48.20 computer-48\" >> /etc/hosts\nsetenforce 0\nreboot\n```\n\ncomputer-48èŠ‚ç‚¹\n\n```\nhostnamectl set-hostname computer-48 && bash\nsystemctl disable firewalld --now\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\necho \"192.168.48.10 controller-48\" >> /etc/hosts\necho \"192.168.48.20 computer-48\" >> /etc/hosts\nsetenforce 0\nreboot\n```\n\n### ä¿®æ”¹yum\n\ncontroller-48å’Œcomputer-48èŠ‚ç‚¹\n\n```\nrm -rf /etc/yum.repos.d/*\ncurl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\ncurl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\ncat >>/etc/yum.repos.d/openstack.repo<<EOF\n[openstack]\nname=openstack\nbaseurl=https://mirrors.aliyun.com/centos/7/cloud/x86_64/openstack-train/\ngpgcheck=0 \nenabled=1\nEOF\nyum clean all && yum makecache\nyum update -y\n```\n\n### SSHå…å¯†\n\n```\n#å„èŠ‚ç‚¹\nyum install -y sshpass \ncat > sshmianmi.sh << \"EOF\"\n#!/bin/bash\n# ç›®æ ‡ä¸»æœºåˆ—è¡¨\nhosts=(\"controller-48\" \"computer-48\")\n# å¯†ç ï¼ˆæ³¨æ„ä¿®æ”¹ï¼‰\npassword=\"123456\"\n# ç”Ÿæˆ SSH å¯†é’¥å¯¹\nssh-keygen -t rsa -N \"\" -f ~/.ssh/id_rsa\n\n# å¾ªç¯éå†ç›®æ ‡ä¸»æœº\nfor host in \"${hosts[@]}\"\ndo\n    # å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº\n    sshpass -p \"$password\" ssh-copy-id -o StrictHostKeyChecking=no \"$host\"\n    \n    # éªŒè¯å…å¯†ç™»å½•\n    sshpass -p \"$password\" ssh -o StrictHostKeyChecking=no \"$host\" \"echo 'å…å¯†ç™»å½•æˆåŠŸ'\"\ndone\nEOF\n\nsh sshmianmi.sh\n```\n\n## å®‰è£…OpenStackåŒ…\n\n```\n#å„èŠ‚ç‚¹\nyum -y install openstack-utils openstack-selinux python-openstackclient\nyum upgrade\n```\n\n## ä¾èµ–ç»„ä»¶\n\nå››ä¸ªç»„ä»¶å®‰è£…åœ¨controller-48èŠ‚ç‚¹ä¸Š\n\n### Mariadbæ•°æ®åº“\n\n```\nyum install mariadb mariadb-server python2-PyMySQL -y\ncat >>/etc/my.cnf.d/openstack.cnf<<EOF\n[mysqld]\nbind-address =192.168.48.10\ndefault-storage-engine = innodb\ninnodb_file_per_table = on\nmax_connections =4096\ncollation-server = utf8_general_ci\ncharacter-set-server = utf8\nEOF\nsystemctl enable mariadb --now\nmysql_secure_installation\nEnter current password for root (enter for none): å›è½¦\nSet root password? [Y/n] y\n# å°†è¦æ±‚è¾“å…¥æ•°æ®åº“ root è´¦æˆ·å¯†ç  MARIADB_PASS\nRemove anonymous users? [Y/n] y\nDisallow root login remotely? [Y/n] n\nRemove test database and access to it? [Y/n] y\nReload privilege tables now? [Y/n] y\n# éªŒè¯\nmysql -u root -pMARIADB_PASS\n```\n\n### Rabbitmq\n\n```\nyum install rabbitmq-server -y\nsystemctl enable rabbitmq-server --now\nrabbitmqctl add_user openstack RABBIT_PASS\n# æ³¨æ„å°† RABBIT_PASS  ä¿®æ”¹ä¸º Rabbitmqæ¶ˆæ¯é˜Ÿåˆ—å¯†ç \nrabbitmqctl set_permissions openstack \".*\" \".*\" \".*\"\n```\n\n### Memcached\n\n```\nyum install memcached python-memcached -y\nsed -i \"s/OPTIONS=\\\"-l 127.0.0.1,::1\\\"/OPTIONS=\\\"-l 127.0.0.1,::1,controller-48\\\"/g\" /etc/sysconfig/memcached\nsystemctl enable memcached --now\n```\n\næ³¨æ„è¿™é‡Œçš„-l 127.0.0.1,::1,controller-48ä¸­controller-48æ˜¯ä½ çš„ä¸»æœºåï¼Œåç»­ä¸åšè§£é‡Š\n\n### etcd\n\n```\nyum install -y etcd\nmv /etc/etcd/etcd.conf{,.bak} \ncat >> /etc/etcd/etcd.conf << EOF\n#[Member]\nETCD_DATA_DIR=\"/var/lib/etcd/default.etcd\"\nETCD_LISTEN_PEER_URLS=\"http://192.168.48.10:2380\"\nETCD_LISTEN_CLIENT_URLS=\"http://192.168.48.10:2379\"\nETCD_NAME=\"controller-48\"\n#controller-48æ˜¯ä½ çš„ä¸»æœºå\n#[Clustering]\nETCD_INITIAL_ADVERTISE_PEER_URLS=\"http://192.168.48.10:2380\"\nETCD_ADVERTISE_CLIENT_URLS=\"http://192.168.48.10:2379\"\nETCD_INITIAL_CLUSTER=\"controller-48=http://192.168.48.10:2380\"\nETCD_INITIAL_CLUSTER_TOKEN=\"etcd-cluster-01\"\nETCD_INITIAL_CLUSTER_STATE=\"new\"\nEOF\nsystemctl enable etcd --now\n```\n\n## Keystone(èº«ä»½éªŒè¯æœåŠ¡)\n\n```\n#controller-48èŠ‚ç‚¹\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE keystone;\nGRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'KEYSTONE_DBPASS';\nGRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'KEYSTONE_DBPASS';\nflush privileges;\nexit\n# KEYSTONE_DBPASS  ä¸º Keystone æ•°æ®åº“å¯†ç \nyum -y install yum-utils\nyum -y install qpid-proton-c-0.26.0-2.el7.x86_64\nyum install -y openstack-keystone httpd mod_wsgi \nmv /etc/keystone/keystone.conf{,.bak}\ncat>> /etc/keystone/keystone.conf << EOF\n[database]\nconnection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller-48/keystone\n[token]\nprovider = fernet\nEOF\n#åŒæ­¥æœåŠ¡å™¨\nsu -s /bin/sh -c \"keystone-manage db_sync\" keystone\n#æŸ¥çœ‹æ˜¯å¦æˆåŠŸ\nmysql -u keystone -p\"KEYSTONE_DBPASS\"\nuse keystone;\nshow tables;\nexit\n#æœ‰è¡¨å°±è¡Œ\n\n#é…ç½®\nkeystone-manage fernet_setup --keystone-user keystone --keystone-group keystone\nkeystone-manage credential_setup --keystone-user keystone --keystone-group keystone\nkeystone-manage bootstrap --bootstrap-password 123456 \\\n  --bootstrap-admin-url http://controller-48:5000/v3/ \\\n  --bootstrap-internal-url http://controller-48:5000/v3/ \\\n  --bootstrap-public-url http://controller-48:5000/v3/ \\\n  --bootstrap-region-id RegionOne\n# 123456 ä¸º admin è´¦æˆ·å¯†ç \n\ncp /etc/httpd/conf/httpd.conf{,.bak}\nsed -i \"s/#ServerName www.example.com:80/ServerName controller-48/g\" /etc/httpd/conf/httpd.conf\nln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/\nsystemctl enable httpd  --now\n\n#åˆ›å»ºåŸŸã€é¡¹ç›®ã€ç”¨æˆ·ã€è§’è‰²\nsource admin-openrc.sh\n# service é¡¹ç›® åˆ›å»ºåœ¨ default ç”¨äº OpenStack æœåŠ¡\nopenstack project create --domain default \\\n  --description \"Service Project\" service\n# åˆ›å»ºä¸€ä¸ª RegionOne åŸŸåä½œä¸ºåç»­äº‘å®ä¾‹åˆ›å»ºåŸŸå\nopenstack domain create --description \"RegionOne Domain\" RegionOne\n# åœ¨ RegionOne åŸŸä¸­åˆ›å»ºä¸€ä¸ª Train é¡¹ç›®\nopenstack project create --domain RegionOne \\\n  --description \"Train Project\" Train\n# åœ¨ RegionOne åŸŸä¸­åˆ›å»ºæ™®é€šç”¨æˆ· user_dog \nopenstack user create --domain RegionOne \\\n  --password 123456 user_dog\n# åˆ›å»ºæ™®é€šç”¨æˆ· user_dog  çš„è§„åˆ™ user_dog_role\nopenstack role create user_dog_role\n# å°†è§„åˆ™ä¸ç”¨æˆ·ç»‘å®š\nopenstack role add --project Train --user user_dog user_dog_role\n# æ³¨ï¼šå¯ä»¥é‡å¤ä¸Šè¾¹æ­¥éª¤ä»¥åˆ›å»ºæ›´å¤šé¡¹ç›®ã€ç”¨æˆ·åŠè§„åˆ™\n\n# éªŒè¯æœåŠ¡å¯ç”¨æ€§\n# å¸è½½ admin ç”¨æˆ·çš„ç¯å¢ƒ\nunset OS_AUTH_URL OS_PASSWORD\n# éªŒè¯ admin ç”¨æˆ·å¯ç”¨æ€§\nopenstack --os-auth-url http://controller-48:5000/v3 \\\n  --os-project-domain-name Default --os-user-domain-name Default --os-project-name admin --os-username admin token issue\n# è¾“å…¥åå°†è¦æ±‚è¾“å…¥ ç®¡ç†å‘˜ admin çš„å¯†ç \n# è¿”å›  token ä¿¡æ¯åˆ™æœåŠ¡æ­£å¸¸\n\n# éªŒè¯ user_dog ç”¨æˆ·å¯ç”¨æ€§\nopenstack --os-auth-url http://controller-48:5000/v3 \\\n  --os-project-domain-name RegionOne --os-user-domain-name RegionOne --os-project-name Train --os-username user_dog token issue\n\nsource admin-openrc.sh\n# åˆ—ä¸¾å½“å‰æ‰€æœ‰åŸŸå\nopenstack domain list\n+----------------------------------+-----------+---------+--------------------+\n| ID                               | Name      | Enabled | Description        |\n+----------------------------------+-----------+---------+--------------------+\n| 7fcb64a8c47f40a48265a9db94f0c963 | RegionOne | True    | RegionOne Domain   |\n| default                          | Default   | True    | The default domain |\n+----------------------------------+-----------+---------+--------------------+\n```\n\n## Glance(é•œåƒæœåŠ¡)\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE glance;\nGRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' \\\n  IDENTIFIED BY 'GLANCE_DBPASS';\nGRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' \\\n  IDENTIFIED BY 'GLANCE_DBPASS';\nflush privileges;\nexit\n#å°† GLANCE_DBPASS æ›¿æ¢ä¸º glanceæ•°æ®åº“æœåŠ¡çš„å¯†ç \nsource admin-openrc.sh\n#åˆ›å»ºç”¨æˆ·æœåŠ¡å’Œapiç«¯ç‚¹\nopenstack user create --domain default --password GLANCE_PASS glance\n#GLANCE_PASS ä¸º glance æœåŠ¡çš„å¯†ç \n\n# ä¸º Glance ç”¨æˆ·æ·»åŠ  admin è§„åˆ™åˆ°ç³»ç»Ÿé¡¹ç›® service\nopenstack role add --project service --user glance admin\n# æ²¡æœ‰è¾“å‡ºå†…å®¹\n\n# ä¸º Glance æ·»åŠ ç®¡ç†é•œåƒçš„æœåŠ¡\nopenstack service create --name glance \\\n  --description \"OpenStack Image\" image\n\n# ä¸º RegionOne åŸŸåæ·»åŠ æœåŠ¡æ¥å£\nopenstack endpoint create --region RegionOne \\\n  image public http://controller-48:9292\n\nopenstack endpoint create --region RegionOne \\\n  image internal http://controller-48:9292\n\nopenstack endpoint create --region RegionOne \\\n  image admin http://controller-48:9292\n\n#å®‰è£…glanceæœåŠ¡\nyum install openstack-glance -y\nmv /etc/glance/glance-api.conf{,.bak}\ncat >>/etc/glance/glance-api.conf << EOF\n[DEFAULT]\nuse_keystone_quotas = True\nlog_file = /var/log/glance/glance.log\n[database]\nconnection = mysql+pymysql://glance:GLANCE_DBPASS@controller-48/glance\n# GLANCE_DBPASS ä¸º Glance æœåŠ¡çš„æ•°æ®åº“è´¦æˆ·å¯†ç \n[keystone_authtoken]\nwww_authenticate_uri  = http://controller-48:5000\nauth_url = http://controller-48:5000\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = glance\npassword = GLANCE_PASS\nservice_token_roles_required = true\n# GLANCE_PASS ä¸º Glance æœåŠ¡çš„æ•°æ®åº“è´¦æˆ·å¯†ç \n[paste_deploy]\nflavor = keystone\n[glance_store]\nstores = file,http\ndefault_store = file\ndefault_backend = {'store_one': 'http', 'store_two': 'file'}\nfilesystem_store_datadir = /var/lib/glance/images/\nEOF\n# åŒæ­¥ Glance æ•°æ®åˆ°æ•°æ®åº“\nsu -s /bin/sh -c \"glance-manage db_sync\" glance\nsystemctl enable openstack-glance-api  --now\n# éªŒè¯æœåŠ¡å¯ç”¨æ€§\nsource admin-openrc.sh\nwget https://download.cirros-cloud.net/0.3.3/cirros-0.3.3-x86_64-disk.img\n#å¯èƒ½ä¼šæ‹‰å–å¤±è´¥ï¼Œå¯ä»¥è‡ªè¡Œå¤åˆ¶ç½‘å€ï¼Œå»æµè§ˆå™¨ä¸‹è½½ï¼Œç„¶åä¸Šä¼ åˆ°/root/ç›®å½•ä¸‹\n\nglance image-create --name \"cirros\" \\\n  --file cirros-0.3.3-x86_64-disk.img \\\n  --disk-format qcow2 --container-format bare \\\n  --visibility=public\n\nopenstack image list\n# +--------------------------------------+--------+--------+\n# | ID                                   | Name   | Status |\n# +--------------------------------------+--------+--------+\n# | 4e022193-03c2-40c4-872f-0adb606f31e4 | cirros | active |\n# +--------------------------------------+--------+--------+\n```\n\n## Placementï¼ˆèµ„æºè°ƒåº¦ï¼‰\n\n```\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE placement;\nGRANT ALL PRIVILEGES ON placement.* TO 'placement'@'localhost'  IDENTIFIED BY 'PLACEMENT_DBPASS';\nGRANT ALL PRIVILEGES ON placement.* TO 'placement'@'%' IDENTIFIED BY 'PLACEMENT_DBPASS';\nflush privileges;\nexit\n#PLACEMENT_DBPASS ä¸º placement æœåŠ¡çš„å¯†ç \nsource admin-openrc.sh\nopenstack user create --domain default --password PLACEMENT_PASS placement\nopenstack role add --project service --user placement admin\nopenstack service create --name placement \\\n  --description \"Placement API\" placement\nopenstack endpoint create --region RegionOne \\\n  placement public http://controller-48:8778\nopenstack endpoint create --region RegionOne \\\n  placement internal http://controller-48:8778\nopenstack endpoint create --region RegionOne \\\n  placement admin http://controller-48:8778\nyum install openstack-placement-api -y\nmv /etc/placement/placement.conf{,.bak}\ncat >> /etc/placement/placement.conf << EOF\n[placement_database]\nconnection = mysql+pymysql://placement:PLACEMENT_DBPASS@controller-48/placement\n# PLACEMENT_DBPASS ä¸º placement æœåŠ¡çš„æ•°æ®åº“è´¦æˆ·å¯†ç \n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nauth_url = http://controller-48:5000/v3\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = placement\npassword = PLACEMENT_PASS\n# PLACEMENT_PASS ä¸º placement æœåŠ¡çš„å¯†ç \nEOF\n\n#åŒæ­¥æ•°æ®åº“\nsu -s /bin/sh -c \"placement-manage db sync\" placement\ncp /etc/httpd/conf.d/00-placement-api.conf{,.bak}\ncat >> /etc/httpd/conf.d/00-placement-api.conf << EOF\n#åœ¨#SSLCertificateKeyFile ...ä¸‹æ·»åŠ \n<Directory /usr/bin>\n<IfVersion >= 2.4>\n\tRequire all granted\n</IfVersion>\n<IfVersion < 2.4>\n\tOrder allow,deny\t\n\tAllow from all\n</IfVersion>\n</Directory>\nEOF\nsystemctl restart httpd\n\n# éªŒè¯æœåŠ¡\nsource admin-openrc.sh\nplacement-status upgrade check\n#å®‰è£…pip oscç»„ä»¶éªŒè¯èµ„æº\nyum install python-pip -y\npip install osc-placement==2.2.0\nsystemctl restart httpd\n\n# éªŒè¯\nopenstack --os-placement-api-version 1.2 resource class list --sort-column name\n# +----------------------------------------+\n# | name                                   |\n# +----------------------------------------+\n# | DISK_GB                                |\n......\n\nopenstack --os-placement-api-version 1.6 trait list --sort-column name\n# +---------------------------------------+\n# | name                                  |\n# +---------------------------------------+\n# | computer-48_ACCELERATORS                  |\n# | computer-48_ARCH_AARCH64                  |\n# ...\n```\n\n## Nova(è®¡ç®—æœåŠ¡)\n\n### æ§åˆ¶èŠ‚ç‚¹\n\n```\n#æ§åˆ¶èŠ‚ç‚¹controller-48\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE nova_api;\nCREATE DATABASE nova;\nCREATE DATABASE nova_cell0;\nGRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nGRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' \\\n  IDENTIFIED BY 'NOVA_DBPASS';\nflush privileges;\nexit\n\n# NOVA_DBPASS ä¸º nova æœåŠ¡çš„å¯†ç \n\nsource admin-openrc.sh\nopenstack user create --domain default --password NOVA_PASS nova\nopenstack role add --project service --user nova admin\nopenstack service create --name nova \\\n  --description \"OpenStack Compute\" compute\nopenstack endpoint create --region RegionOne \\\n  compute public http://controller-48:8774/v2.1\nopenstack endpoint create --region RegionOne \\\n  compute internal http://controller-48:8774/v2.1\nopenstack endpoint create --region RegionOne \\\n  compute admin http://controller-48:8774/v2.1\nmv /etc/yum.repos.d/epel.repo{,.bak} \nyum install -y \\\n    openstack-nova-api \\\n    openstack-nova-scheduler \\\n    openstack-nova-conductor \\\n    openstack-nova-novncproxy\nmv /etc/yum.repos.d/epel.repo{.bak,} \nmv /etc/nova/nova.conf{,.bak}\ncat >> /etc/nova/nova.conf <<EOF\n[DEFAULT]\nenabled_apis = osapi_compute,metadata\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-48:5672/\n# RABBIT_PASSä¸º rabbitmq å¯†ç \nmy_ip = 192.168.48.10\n# æ§åˆ¶èŠ‚ç‚¹æ§åˆ¶ç½‘ç»œçš„ IP\nlog_file = /var/log/nova/nova-controller.log\nrootwrap_config = /etc/nova/rootwrap.conf\n[api_database]\nconnection = mysql+pymysql://nova:NOVA_DBPASS@controller-48/nova_api\n# NOVA_DBPASS ä¸ºæ•°æ®åº“ Nova è´¦æˆ·å¯†ç \n[database]\nconnection = mysql+pymysql://nova:NOVA_DBPASS@controller-48/nova\n# NOVA_DBPASS ä¸ºæ•°æ®åº“ Nova è´¦æˆ·å¯†ç \n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-48:5000/\nauth_url = http://controller-48:5000/\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = nova\npassword =NOVA_PASS\n# NOVA_PASS ä¸º Nova æœåŠ¡çš„å¯†ç \n[vnc]\nenabled = true\nserver_listen = \\$my_ip\nserver_proxyclient_address = \\$my_ip\n[glance]\napi_servers = http://controller-48:9292\n[oslo_concurrency]\nlock_path = /var/run/nova\n[placement]\nregion_name = RegionOne\nproject_domain_name = Default\nproject_name = service\nauth_type = password\nuser_domain_name = Default\nauth_url = http://controller-48:5000/v3\nusername = placement\npassword = PLACEMENT_PASS\n# PLACEMENT_PASS ä¸º placement æœåŠ¡çš„å¯†ç \nEOF\nsu -s /bin/sh -c \"nova-manage api_db sync\" nova\nsu -s /bin/sh -c \"nova-manage cell_v2 map_cell0\" nova\nsu -s /bin/sh -c \"nova-manage cell_v2 create_cell --name=cell1 --verbose\" nova\nsu -s /bin/sh -c \"nova-manage db sync\" nova\n\n# éªŒè¯\n\nsu -s /bin/sh -c \"nova-manage cell_v2 list_cells\" nova\n\nsystemctl enable --now \\\n    openstack-nova-api.service \\\n    openstack-nova-scheduler.service \\\n    openstack-nova-conductor.service \\\n    openstack-nova-novncproxy.service\n    \nsystemctl status \\\n    openstack-nova-api.service \\\n    openstack-nova-scheduler.service \\\n    openstack-nova-conductor.service \\\n    openstack-nova-novncproxy.service\n    \n```\n\n### è®¡ç®—èŠ‚ç‚¹\n\n```\n##computer-48è®¡ç®—èŠ‚ç‚¹\ncat >>/etc/yum.repos.d/CentOS-Base.repo<<EOF\n[Virt]\nname=CentOS-\\$releasever - Base\nbaseurl=http://mirrors.aliyun.com/centos/7.9.2009/virt/x86_64/kvm-common/\ngpgcheck=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\nEOF\nyum install qpid-proton-c-0.26.0-2.el7.x86_64 -y\nyum install openstack-nova-compute -y\nmv /etc/nova/nova.conf{,.bak}\ncat >> /etc/nova/nova.conf <<EOF\n[DEFAULT]\nenabled_apis = osapi_compute,metadata\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-48\nmy_ip = 192.168.48.20\ncompute_driver=libvirt.LibvirtDriver\nlog_file = /var/log/nova/nova-compute.log\n# 192.168.48.20æ›¿æ¢ä¸º è®¡ç®—èŠ‚ç‚¹ç®¡ç†ç½‘ç»œ IP åœ°å€\n[api]\nauth_strategy = keystone\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-48:5000/\nauth_url = http://controller-48:5000/\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = nova\npassword = NOVA_PASS\n#NOVA_PASSä¸ºnovaæœåŠ¡å¯†ç \n[vnc]\nenabled = true\nserver_listen = 0.0.0.0\nserver_proxyclient_address = \\$my_ip\nnovncproxy_base_url = http://192.168.48.10:6080/vnc_auto.html\n# å°† 192.168.48.10ä¿®æ”¹ä¸ºæ§åˆ¶èŠ‚ç‚¹ç®¡ç†ç½‘ç»œ IP \n[glance]\napi_servers = http://controller-48:9292\n[oslo_concurrency]\nlock_path = /var/lib/nova/tmp\n[placement]\nregion_name = RegionOne\nproject_domain_name = Default\nproject_name = service\nauth_type = password\nuser_domain_name = Default\nauth_url = http://controller-48:5000/v3\nusername = placement\npassword = PLACEMENT_PASS\n#PLACEMENT_PASS ä¸º Placement æœåŠ¡å¯†ç \n[neutron]\nauth_url = http://controller-48:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\n# NEUTRON_PASS ä¸º Neutron æœåŠ¡å¯†ç \nEOF\n\negrep -c '(vmx|svm)' /proc/cpuinfo\n---------------------------------------------------------------------------------\n# å¦‚æœè¿”å›å€¼å¤§äº 1 åˆ™è¯´æ˜å·²ç»å¼€å¯ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œæ— éœ€é…ç½® qemu\n# å¦‚ç­‰äº 0 ï¼Œåˆ™éœ€è¦é…ç½® qemu ä»¥ä»£æ›¿é»˜è®¤çš„ kvm\nvi /etc/nova/nova.conf\n[libvirt]\n# ...\nvirt_type = qemu\n\n# ä»¥ä¸Šé…ç½®ä»…å½“ egrep -c '(vmx|svm)' /proc/cpuinfo ç»“æœä¸º 0 æ—¶æ‰è¿›è¡Œé…ç½®\n---------------------------------------------------------------------------------\nsystemctl enable libvirtd.service openstack-nova-compute.service --now\nsystemctl status libvirtd.service openstack-nova-compute.service \n```\n\n### æ§åˆ¶èŠ‚ç‚¹éªŒè¯\n\n```\n# åœ¨æ§åˆ¶èŠ‚ç‚¹æ‰§è¡ŒéªŒè¯\nsource admin-openrc.sh\nopenstack compute service list --service nova-compute\n+----+--------------+----------+------+---------+-------+----------------------------+\n| ID | Binary       | Host     | Zone | Status  | State | Updated At                 |\n+----+--------------+----------+------+---------+-------+----------------------------+\n| 10 | nova-computer | computer-48 | nova | enabled | up    | 2023-04-02T17:17:08.000000 |\n+----+--------------+----------+------+---------+-------+----------------------------+\n\n# åœ¨æ§åˆ¶èŠ‚ç‚¹æ‰§è¡ŒéªŒè¯\nsu -s /bin/sh -c \"nova-manage cell_v2 discover_hosts --verbose\" nova\n####\nFound 2 cell mappings.\nSkipping cell0 since it does not contain hosts.\nGetting computer-48s from cell 'cell1': 89e02b18-2a3c-437a-8dd5-15deb98676a4\nChecking host mapping for computer-48 host 'computer-48r-48': e862bd61-8f56-4d3a-a2b2-21ab7db90ede\nCreating host mapping for computer-48 host 'computer-48r-48': e862bd61-8f56-4d3a-a2b2-21ab7db90ede\nFound 1 unmapped computer-48s in cell: 89e02b18-2a3c-437a-8dd5-15deb98676a4\n\n\nopenstack compute service list\n[root@controller-48 ~]# openstack compute service list\n+----+----------------+---------------+----------+---------+-------+----------------------------+\n| ID | Binary         | Host          | Zone     | Status  | State | Updated At                 |\n+----+----------------+---------------+----------+---------+-------+----------------------------+\n|  1 | nova-conductor | controller-48 | internal | enabled | up    | 2023-05-27T17:44:38.000000 |\n|  4 | nova-scheduler | controller-48 | internal | enabled | up    | 2023-05-27T17:44:40.000000 |\n|  5 | nova-compute   | computer-48   | nova     | enabled | up    | 2023-05-27T17:44:43.000000 |\n+----+----------------+---------------+----------+---------+-------+----------------------------+\n\nopenstack catalog list\n+-----------+-----------+----------------------------------------------------------------------+\n| Name      | Type      | Endpoints                                                            |\n+-----------+-----------+----------------------------------------------------------------------+\n| placement | placement | RegionOne                                                            |\n|           |           |   internal: http://controller-48:8778                                   |\n|           |           | RegionOne                                                            |\n|           |           |   admin: http://controller-48:8778                                      |\n|           |           | RegionOne                                                            |\n|           |           |   public: http://controller-48:8778                                     |\n|           |           |                                                                      |\n| keystone  | identity  | RegionOne                                                            |\n|           |           |   admin: http://controller-48:5000/v3/                                  |\n|           |           | RegionOne                                                            |\n|           |           |   internal: http://controller-48:5000/v3/                               |\n|           |           | RegionOne                                                            |\n|           |           |   public: http://controller-48:5000/v3/                                 |\n|           |           |                                                                      |\n| neutron   | network   | RegionOne                                                            |\n|           |           |   public: http://controller-48:9696                                     |\n|           |           | RegionOne                                                            |\n|           |           |   internal: http://controller-48:9696                                   |\n|           |           | RegionOne                                                            |\n|           |           |   admin: http://controller-48:9696                                      |\n|           |           |                                                                      |\n| glance    | image     | RegionOne                                                            |\n|           |           |   admin: http://controller-48:9292                                      |\n|           |           | RegionOne                                                            |\n|           |           |   internal: http://controller-48:9292                                   |\n|           |           | RegionOne                                                            |\n|           |           |   public: http://controller-48:9292                                     |\n|           |           |                                                                      |\n| nova      | computer-48   | RegionOne                                                            |\n|           |           |   admin: http://controller-48:8774/v2.1                                 |\n|           |           | RegionOne                                                            |\n|           |           |   internal: http://controller-48:8774/v2.1                              |\n|           |           | RegionOne                                                            |\n|           |           |   public: http://controller-48:8774/v2.1                                |\n|           |           |                                                                      |\n|           |           |                                                                      |\n+-----------+-----------+----------------------------------------------------------------------+\n\nopenstack image list\n+--------------------------------------+--------+--------+\n| ID                                   | Name   | Status |\n+--------------------------------------+--------+--------+\n| 4e022193-03c2-40c4-872f-0adb606f31e4 | cirros | active |\n+--------------------------------------+--------+--------+\n\n\nnova-status upgrade check\n[root@controller-48 ~]# nova-status upgrade check\n+--------------------------------+\n| Upgrade Check Results          |\n+--------------------------------+\n| Check: Cells v2                |\n| Result: Success                |\n| Details: None                  |\n+--------------------------------+\n| Check: Placement API           |\n| Result: Success                |\n| Details: None                  |\n+--------------------------------+\n| Check: Ironic Flavor Migration |\n| Result: Success                |\n| Details: None                  |\n+--------------------------------+\n| Check: Cinder API              |\n| Result: Success                |\n| Details: None                  |\n+--------------------------------+\n\n#åœ¨æ§åˆ¶èŠ‚ç‚¹ä¿®æ”¹è‡ªåŠ¨æ³¨å†Œnova-computer-48èŠ‚ç‚¹\ncat >> /etc/nova/nova.conf << EOF\n[scheduler]\ndiscover_hosts_in_cells_interval = 300\nEOF\n\n```\n\n## Neutronï¼ˆç½‘ç»œæœåŠ¡ï¼‰\n\n### æ§åˆ¶èŠ‚ç‚¹\n\n```\n##æ§åˆ¶èŠ‚ç‚¹controller-48\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE neutron;\nGRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' \\\n  IDENTIFIED BY 'NEUTRON_DBPASS';\nGRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' \\\n  IDENTIFIED BY 'NEUTRON_DBPASS';\nflush privileges;\nexit\nsource admin-openrc.sh\nopenstack user create --domain default --password NEUTRON_PASS neutron\nopenstack role add --project service --user neutron admin\nopenstack service create --name neutron \\\n  --description \"OpenStack Networking\" network\nopenstack endpoint create --region RegionOne \\\n  network public http://controller-48:9696\nopenstack endpoint create --region RegionOne \\\n  network internal http://controller-48:9696\nopenstack endpoint create --region RegionOne \\\n  network admin http://controller-48:9696\n# é€‰æ‹©å®‰è£… å¤§äºŒå±‚ ç½‘ç»œ\nyum install openstack-neutron openstack-neutron-ml2 \\\n  openstack-neutron-linuxbridge ebtables -y\n\nmv /etc/neutron/neutron.conf{,.bak}\ncat >> /etc/neutron/neutron.conf <<EOF\n[database]\nconnection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller-48/neutron\n#NEUTRON_DBPASSä¸º æ•°æ®åº“ neutron è´¦æˆ·å¯†ç \n[DEFAULT]\ncore_plugin = ml2\nservice_plugins = router\nallow_overlapping_ips = true\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-48\nauth_strategy = keystone\nnotify_nova_on_port_status_changes = true\nnotify_nova_on_port_data_changes = true\n# RABBIT_PASS ä¸º æ¶ˆæ¯é˜Ÿåˆ—å¯†ç \n[keystone_authtoken]\nwww_authenticate_uri = http://controller-48:5000\nauth_url = http://controller-48:5000\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\n# NEUTRON_PASSä¸º neutron æœåŠ¡å¯†ç \n[nova]\nauth_url = http://controller-48:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = nova\npassword = NOVA_PASS\n# [nova]  æ²¡æœ‰åˆ™æ·»åŠ \n# NOVA_PASSä¸º Nova æœåŠ¡å¯†ç \n[oslo_concurrency]\nEOF\n\nmv /etc/neutron/plugins/ml2/ml2_conf.ini{,.bak}\ncat >> /etc/neutron/plugins/ml2/ml2_conf.ini << EOF\n[ml2]\ntype_drivers = flat,vlan,vxlan\ntenant_network_types = vxlan\nmechanism_drivers = linuxbridge,l2population\nextension_drivers = port_security\n[ml2_type_flat]\nflat_networks = provider\n[ml2_type_vxlan]\nvni_ranges = 1:1000\n[securitygroup]\nenable_ipset = true\nEOF\n\nmv /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}\ncat >> /etc/neutron/plugins/ml2/linuxbridge_agent.ini <<EOF\n[linux_bridge]\nphysical_interface_mappings = provider:ens33\n# ens33 ä¸ºç¬¬ä¸€å—ç½‘å¡åç§°\n[vxlan]\nenable_vxlan = true\nlocal_ip = 192.168.48.10\nl2_population = true\n# 192.168.48.10 ä¸ºç®¡ç†ç½‘ç»œ æ§åˆ¶èŠ‚ç‚¹çš„ IP  å³ controller-48 IP\n[securitygroup]\nenable_security_group = true\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\nEOF\n\nmv /etc/neutron/l3_agent.ini{,.bak}\ncat >> /etc/neutron/l3_agent.ini << EOF\n[DEFAULT]\ninterface_driver = linuxbridge\nEOF\n\nmv /etc/neutron/dhcp_agent.ini{,.bak}\ncat >> /etc/neutron/dhcp_agent.ini << EOF\n[DEFAULT]\ninterface_driver = linuxbridge\ndhcp_driver = neutron.agent.linux.dhcp.Dnsmasq\nenable_isolated_metadata = true\nEOF\n\n----------------------\nmodprobe br_netfilter\ncat >>/etc/rc.sysinit<<EOF\n#!/bin/bash\nfor file in /etc/sysconfig/modules/*.modules ; do\n[ -x $file ] && $file\ndone\nEOF\necho \"modprobe br_netfilter\" >/etc/sysconfig/modules/br_netfilter.modules\nchmod 755 /etc/sysconfig/modules/br_netfilter.modules\nsysctl -a | grep net.bridge.bridge-nf-call\n----------------------\nmv /etc/neutron/metadata_agent.ini{,.bak}\ncat >> /etc/neutron/metadata_agent.ini << EOF\n[DEFAULT]\nnova_metadata_host = controller-48\nmetadata_proxy_shared_secret = METADATA_SECRET\n# METADATA_SECRET ä¸º å…ƒæ•°æ® çš„å¯†é’¥\nEOF\n\n-------------------\ncat >> /etc/nova/nova.conf << EOF\n#è¿½åŠ åœ¨æœ«å°¾\n[neutron]\nauth_url = http://controller-48:5000\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\nservice_metadata_proxy = true\nmetadata_proxy_shared_secret = METADATA_SECRET\n# NEUTRON_PASS  ä¸º neutron æœåŠ¡çš„å¯†ç \n# METADATA_SECRET ä¸ºä¸Šè¾¹è®¾ç½®çš„å…ƒæ•°æ®å¯†é’¥\nEOF\n\n-------------------\nln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini\n\nsu -s /bin/sh -c \"neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head\" neutron\n\nsudo ip route del default\nsudo ip route add default via 192.168.48.2 dev ens33\n#192.168.48.2ä¸ºens33ç½‘å…³\n\nsystemctl enable --now neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service neutron-l3-agent.service\n\nsystemctl status neutron-server.service  neutron-linuxbridge-agent.service neutron-dhcp-agent.service   neutron-metadata-agent.service  neutron-l3-agent.service\n\n```\n\n### è®¡ç®—èŠ‚ç‚¹\n\n```\n###computeè®¡ç®—èŠ‚ç‚¹\nyum install openstack-neutron-linuxbridge ebtables ipset -y \n\nmv /etc/neutron/neutron.conf{,.bak}\ncat >> /etc/neutron/neutron.conf << EOF\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-48\n#RABBIT_PASSä¸º æ§åˆ¶èŠ‚ç‚¹ æ¶ˆæ¯é˜Ÿåˆ— å¯†ç \nauth_strategy = keystone\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-48:5000\nauth_url = http://controller-48:5000\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS\n# NEUTRON_PASS  ä¸ºæ§åˆ¶èŠ‚ç‚¹ neutron æœåŠ¡å¯†ç \n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\nEOF\n\nmv /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}\ncat >> /etc/neutron/plugins/ml2/linuxbridge_agent.ini <<EOF\n[linux_bridge]\nphysical_interface_mappings = provider:ens36\n# ens36 ä¸º ç¬¬äºŒå—ç½‘å¡åå­—\n[vxlan]\nenable_vxlan = true\nlocal_ip = 192.168.48.20\nl2_population = true\n# 192.168.48.20  ä¸º è®¡ç®—èŠ‚ç‚¹ ç®¡ç†ç½‘ç»œçš„ IP åœ°å€\n[securitygroup]\nenable_security_group = true\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\nEOF\n-------------------\nmodprobe br_netfilter\ncat >>/etc/rc.sysinit<<EOF\n#!/bin/bash\nfor file in /etc/sysconfig/modules/*.modules ; do\n[ -x $file ] && $file\ndone\nEOF\necho \"modprobe br_netfilter\" >/etc/sysconfig/modules/br_netfilter.modules\nchmod 755 /etc/sysconfig/modules/br_netfilter.modules\nsysctl -a | grep net.bridge.bridrge-nf-call\n-------------------\n\nsystemctl enable neutron-linuxbridge-agent.service --now\nsystemctl restart openstack-nova-compute.service neutron-linuxbridge-agent.service\nsystemctl status neutron-linuxbridge-agent.service\n\n```\n\n### æ§åˆ¶èŠ‚ç‚¹éªŒè¯\n\n```\n# éªŒè¯\n# æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œ\nsource admin-openrc.sh\nopenstack network agent list\n###ç­‰å‡ åˆ†é’Ÿ\n[root@controller-48 ~]# openstack network agent list\n+--------------------------------------+--------------------+---------------+-------------------+-------+-------+---------------------------+\n| ID                                   | Agent Type         | Host          | Availability Zone | Alive | State | Binary                    |\n+--------------------------------------+--------------------+---------------+-------------------+-------+-------+---------------------------+\n| 201870b9-aac0-4830-9788-03da13b125c7 | Metadata agent     | controller-48 | None              | :-)   | UP    | neutron-metadata-agent    |\n| 55ae2391-4cd6-4cd1-bf4f-4465f1b561a1 | L3 agent           | controller-48 | nova              | :-)   | UP    | neutron-l3-agent          |\n| bae3fe77-a005-4cdf-aee6-8cfe3cf918ba | Linux bridge agent | controller-48 | None              | :-)   | UP    | neutron-linuxbridge-agent |\n| f0bd6fbc-2889-4558-80fa-8f2a08989b74 | Linux bridge agent | computer-48   | None              | :-)   | UP    | neutron-linuxbridge-agent |\n| f5546196-9950-4c5a-b709-060a1bba5944 | DHCP agent         | controller-48 | nova              | :-)   | UP    | neutron-dhcp-agent        |\n+--------------------------------------+--------------------+---------------+-------------------+-------+-------+---------------------------+\n\n# ç¡®ä¿ä»¥ä¸Šäº”ä¸ª Agent éƒ½ä¸º :-) åŠ UP\n\n```\n\n## Horizon(Webç®¡ç†é¡µé¢)\n\n```\nsystemctl restart neutron* openstack-nova*\n###æ§åˆ¶èŠ‚ç‚¹\nyum install openstack-dashboard -y\ncp /etc/openstack-dashboard/local_settings{,.bak}\n#æ³¨é‡Šä»¥ä¸‹ä¿¡æ¯\nsed -i 's/^ALLOWED_HOSTS/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^OPENSTACK_HOST/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^OPENSTACK_KEYSTONE_URL/#&/' /etc/openstack-dashboard/local_settings\nsed -i 's/^TIME_ZONE/#&/' /etc/openstack-dashboard/local_settings\n\nè¿½åŠ å†…å®¹\ncat >> /etc/openstack-dashboard/local_settings <<EOF\nALLOWED_HOSTS = ['*']\nSESSION_ENGINE = 'django.contrib.sessions.backends.cache'\nCACHES = {\n    'default': {\n         'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',\n         'LOCATION': 'controller-48:11211',\n    }\n}\nOPENSTACK_HOST = \"controller-48\"\nOPENSTACK_KEYSTONE_URL = \"http://%s:5000/identity/v3\" % OPENSTACK_HOST\nOPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True\nOPENSTACK_API_VERSIONS = {\n    \"identity\": 3,\n    \"image\": 2,\n    \"volume\": 3,\n}\nOPENSTACK_KEYSTONE_DEFAULT_DOMAIN = \"Default\"\nOPENSTACK_KEYSTONE_DEFAULT_ROLE = \"user\"\nTIME_ZONE = \"Asia/Shanghai\"\n# æœ‰åˆ™ä¿®æ”¹æ²¡æœ‰åˆ™æ·»åŠ \nEOF\n\ncp /etc/httpd/conf.d/openstack-dashboard.conf{,.bak}\ncat >> /etc/httpd/conf.d/openstack-dashboard.conf << EOF\nWSGIApplicationGroup %{GLOBAL}\nEOF\n------------------------------------------------------------------------------------\n#æŠŠä¸‹é¢æ‰€æœ‰æ–‡ä»¶é‡Œé¢æœ‰WEBROOT = '/' ä¸­çš„ / æ”¹æˆ /dashboard\nsed -i.bak \"s#WEBROOT\\s*=.*#WEBROOT = '/dashboard'#\" /usr/share/openstack-dashboard/openstack_dashboard/defaults.py\nsed -i.bak \"s#WEBROOT\\s*=.*#WEBROOT = '/dashboard'#\"  /usr/share/openstack-dashboard/openstack_dashboard/test/settings.py\nsed -i.bak 's|WEBROOT\\s*=.*|WEBROOT = \"/dashboard\"|' /usr/share/openstack-dashboard/static/dashboard/js/1453ede06e9f.js\n#å¦‚æœç¬¬ä¸‰æ¡ä¸è¡Œï¼Œæ³¨æ„ä¸€ä¸‹1453ede06e9f.jsæ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™çœ‹ä¸‹é¢ä¸‰ä¸ªæ–‡ä»¶ä¸­æœ‰WEBROOT = '/'æ›¿æ¢æ–‡ä»¶åå³å¯\n[root@controller-48 ~]# cd /usr/share/openstack-dashboard/static/dashboard/js/\n[root@controller-48 js]# ll\ntotal 2472   #ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ä¹Ÿè¦æ”¹ ï¼Œæˆ‘è¿™é‡Œå°±ä¸€ä¸ªæ–‡ä»¶æœ‰\n-rw-r--r-- 1 root root  606959 May 17  2021 1453ede06e9f.js\n-rw-r--r-- 1 root root 1659039 May 17  2021 b5e88d434bd1.js\n-rw-r--r-- 1 root root  254022 May 17  2021 eb687af7228a.js\n------------------------------------------------------------------------------------\nsystemctl restart httpd memcached\nsystemctl status httpd memcached\n\n\n# éªŒè¯\n# è®¿é—® http://192.168.48.10/dashboard  ï¼ˆæ§åˆ¶èŠ‚ç‚¹ipï¼‰\n# ç™»å½•ç”¨æˆ·å¯†ç  å¯ä½¿ç”¨ admin æˆ– user_dog\n# åŸŸå ä½¿ç”¨ Default\n```\n\n![image-20230402220424221](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/bf319a6ff702ffea01d5eb18616705db479b66b2-1709275202730-28.png)\n\n## cinderï¼ˆå—å­˜å‚¨æœåŠ¡ï¼‰\n\n### æ§åˆ¶èŠ‚ç‚¹\n\n```\n###æ§åˆ¶èŠ‚ç‚¹\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE cinder;\nGRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' \\\n  IDENTIFIED BY 'CINDER_DBPASS';\nGRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' \\\n  IDENTIFIED BY 'CINDER_DBPASS';\nexit\n# CINDER_DBPASS ä¸º cinder æ•°æ®åº“è´¦æˆ·å¯†ç \nsource admin-openrc.sh\nopenstack user create --domain default --password CINDER_PASS cinder\nopenstack role add --project service --user cinder admin\n  openstack service create --name cinderv3 \\\n  --description \"OpenStack Block Storage\" volumev3\nopenstack endpoint create --region RegionOne \\\n  volumev3 public http://controller-48:8776/v3/%\\(project_id\\)s\nopenstack endpoint create --region RegionOne \\\n  volumev3 internal http://controller-48:8776/v3/%\\(project_id\\)s\nopenstack endpoint create --region RegionOne \\\n  volumev3 admin http://controller-48:8776/v3/%\\(project_id\\)s\n\nyum install openstack-cinder -y\nmv /etc/cinder/cinder.conf{,.bak}\ncat >> /etc/cinder/cinder.conf << EOF\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-48\nauth_strategy = keystone\nmy_ip = 192.168.48.10\n# æ§åˆ¶èŠ‚ç‚¹ç®¡ç†ç½‘ç»œ IP\n[database]\nconnection = mysql+pymysql://cinder:CINDER_DBPASS@controller-48/cinder\n# CINDER_DBPASS ä¸ºæ•°æ®åº“ Cinder è´¦æˆ·å¯†ç \n[keystone_authtoken]\nwww_authenticate_uri = http://controller-48:5000\nauth_url = http://controller-48:5000\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = cinder\npassword = CINDER_PASS\n# CINDER_PASS ä¸º Cinder æœåŠ¡å¯†ç \n[oslo_concurrency]\nlock_path = /var/lib/cinder/tmp\nEOF\n\nsu -s /bin/sh -c \"cinder-manage db sync\" cinder\n\ncat >> /etc/nova/nova.conf << EOF\n[cinder]\nos_region_name = RegionOne\nEOF\n\nsystemctl restart openstack-nova-api.service\nsystemctl status openstack-nova-api.service\nsystemctl enable --now openstack-cinder-api.service openstack-cinder-scheduler.service\nsystemctl status openstack-cinder-api.service openstack-cinder-scheduler.service\n\n```\n\n### è®¡ç®—èŠ‚ç‚¹\n\n```\n###computer-48èŠ‚ç‚¹\n\næ·»åŠ ä¸€å—ç‰©ç†ç£ç›˜\n[root@computer-48 ~]# lsblk\nNAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda               8:0    0  100G  0 disk\nâ”œâ”€sda1            8:1    0    1G  0 part /boot\nâ””â”€sda2            8:2    0   99G  0 part\n  â”œâ”€centos-root 253:0    0   50G  0 lvm  /\n  â”œâ”€centos-swap 253:1    0  3.6G  0 lvm  [SWAP]\n  â””â”€centos-home 253:2    0 45.4G  0 lvm  /home\nsdb               8:16   0  100G  0 disk\nsr0              11:0    1 1024M  0 rom\n\nyum install lvm2 device-mapper-persistent-data -y\nsystemctl enable lvm2-lvmetad.service --now\n# å¦‚æ˜¾ç¤ºä¸å­˜åœ¨åˆ™è¯´æ˜ç³»ç»Ÿé»˜è®¤å®‰è£…äº† lvm  ä»¥ä¸Šæ­¥éª¤å¯å¿½ç•¥\n\n#åˆ›å»º/dev/sdbå·ç»„\npvcreate /dev/sdb\n# Physical volume \"/dev/sdb\" successfully created.\n\nvgcreate cinder-volumes /dev/sdb\n# Volume group \"cinder-volumes\" successfully created\n# sdb ä¸ºåˆ’åˆ†ç»™å—å­˜å‚¨ä½¿ç”¨çš„ç£ç›˜\n# å¦‚æœ‰å¤šä¸ªç£ç›˜ï¼Œåˆ™éœ€é‡å¤ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤\n\n\ncp /etc/lvm/lvm.conf{,.bak}\nsed -i '130 a\\filter = [ \"a/sdb/\",\"r/.*/\"]' /etc/lvm/lvm.conf\n#sdbæ˜¯ä¸Šé¢æ·»åŠ çš„æ–°çš„ç‰©ç†ç£ç›˜\n# å¦‚æœ‰å¤šä¸ªç£ç›˜ï¼Œåˆ™å°†ç£ç›˜ç¼–å·ä»¥å›ºå®šæ ¼å¼æ·»åŠ åˆ°è¿‡æ»¤è®¾å¤‡ä¸­ï¼Œä¾‹å¦‚æœ‰ä¸¤ä¸ªç£ç›˜ sdb sdc ï¼Œåˆ™ä¸º filter = [ \"a/sdb/\", \"a/sdc/\",\"r/.*/\"]\n\n\nyum install openstack-cinder targetcli python-keystone -y\nmv /etc/cinder/cinder.conf{,.bak}\ncat >> /etc/cinder/cinder.conf << EOF\n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-48\nauth_strategy = keystone\nmy_ip = 192.168.48.20\nenabled_backends = lvm\nglance_api_servers = http://controller-48:9292\n# 192.168.48.20  ä¸ºå—å­˜å‚¨èŠ‚ç‚¹ computer-48ç®¡ç†ç½‘ç»œ çš„æ¥å£IP\n[database]\nconnection = mysql+pymysql://cinder:CINDER_DBPASS@controller-48/cinder\n# CINDER_DBPASS ä¸ºæ•°æ®åº“ Cinder è´¦æˆ·å¯†ç \n[keystone_authtoken]\nwww_authenticate_uri = http://controller-48:5000\nauth_url = http://controller-48:5000\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = cinder\npassword = CINDER_PASS\n# CINDER_PASS ä¸º cinder æ•°æ®åº“è´¦æˆ·å¯†ç \n[lvm]\nvolume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver\nvolume_group = cinder-volumes\ntarget_protocol = iscsi\ntarget_helper = lioadm\n# [lvm]  æ²¡æœ‰åˆ™æ–°å»º\n[oslo_concurrency]\nlock_path = /var/lib/cinder/tmp\nEOF\n\nsystemctl enable openstack-cinder-volume.service target.service --now\nsystemctl status openstack-cinder-volume.service target.service\n\n```\n\n### æ§åˆ¶èŠ‚ç‚¹éªŒè¯\n\n```\n# éªŒè¯\n# æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œ\nsource admin-openrc.sh\nopenstack volume service list\nsystemctl restart httpd memcached\n[root@controller-48 ~]# openstack volume service list\n+------------------+-------------+------+---------+-------+----------------------------+\n| Binary           | Host        | Zone | Status  | State | Updated At                 |\n+------------------+-------------+------+---------+-------+----------------------------+\n| cinder-scheduler | controller-48  | nova | enabled | up    | 2023-05-24T08:24:18.000000 |\n| cinder-volume    | computer-48@lvm | nova | enabled | up    | 2023-05-24T08:24:17.000000 |\n+------------------+-------------+------+---------+-------+----------------------------+\n\n```\n\n\n\n## Swiftï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰\n\n### æ§åˆ¶èŠ‚ç‚¹\n\n```\n###æ§åˆ¶èŠ‚ç‚¹\nsource admin-openrc.sh\nopenstack user create --domain default --password SWIFT_PASS swift\nopenstack role add --project service --user swift admin\n#åˆ›å»ºswiftæœåŠ¡å®ä½“ï¼š\nopenstack service create --name swift \\\n  --description \"OpenStack Object Storage\" object-store\n#åˆ›å»ºswiftæœåŠ¡å®ä½“ï¼š\nopenstack endpoint create --region RegionOne \\\nobject-store public http://controller-48:8080/v1/AUTH_%\\(project_id\\)s\n\nopenstack endpoint create --region RegionOne \\\nobject-store internal http://controller-48:8080/v1/AUTH_%\\(project_id\\)s\n\nopenstack endpoint create --region RegionOne \\\nobject-store admin http://controller-48:8080/v1\n\n#å®‰è£…swiftç»„ä»¶\nyum install -y openstack-swift-proxy python-swiftclient \\\n  python-keystoneclient python-keystonemiddleware \\\n  Memcached\n\nmv /etc/swift/proxy-server.conf{,.bak}\ncat> /etc/swift/proxy-server.conf<<EOF\n[DEFAULT]\nbind_ip = 0.0.0.0\nbind_port = 8080\nuser = swift\n[pipeline:main]\npipeline = catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit authtoken keystoneauth container-quotas account-quotas slo dlo versioned_writes proxy-logging proxy-server\n[app:proxy-server]\nuse = egg:swift#proxy\nallow_account_management = true\naccount_autocreate = true\n#Keystone auth info\n[filter:authtoken]\npaste.filter_factory = keystonemiddleware.auth_token:filter_factory\nwww_authenticate_uri = http://controller-48:5000\nauth_url = http://controller-48:5000/v3\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = swift\npassword = SWIFT_PASS\ndelay_auth_decision = true\nservice_token_roles_required = True\n[filter:keystoneauth]\nuse = egg:swift#keystoneauth\noperator_roles = admin,user\n[filter:healthcheck]\nuse = egg:swift#healthcheck\n[filter:cache]\nuse = egg:swift#memcache\nmemcache_servers = controller-48:11211\n[filter:ratelimit]\nuse = egg:swift#ratelimit\n[filter:domain_remap]\nuse = egg:swift#domain_remap\n[filter:catch_errors]\nuse = egg:swift#catch_errors\n[filter:cname_lookup]\nuse = egg:swift#cname_lookup\n[filter:staticweb]\nuse = egg:swift#staticweb\n[filter:tempurl]\nuse = egg:swift#tempurl\n[filter:formpost]\nuse = egg:swift#formpost\n[filter:name_check]\nuse = egg:swift#name_check\n[filter:list-endpoints]\nuse = egg:swift#list_endpoints\n[filter:proxy-logging]\nuse = egg:swift#proxy_logging\n[filter:bulk]\nuse = egg:swift#bulk\n[filter:slo]\nuse = egg:swift#slo\n[filter:dlo]\nuse = egg:swift#dlo\n[filter:container-quotas]\nuse = egg:swift#container_quotas\n[filter:account-quotas]\nuse = egg:swift#account_quotas\n[filter:gatekeeper]\nuse = egg:swift#gatekeeper\n[filter:container_sync]\nuse = egg:swift#container_sync\n[filter:xprofile]\nuse = egg:swift#xprofile\n[filter:versioned_writes]\nuse = egg:swift#versioned_writes\nEOF\n```\n\n### computer-48\n\næ·»åŠ 4å¼ ç¡¬ç›˜\n\n![image-20230527155112604](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/65a2b757e9272dea0844d5ed3b29915a881521da-1709275202730-29.png)\n\n![image-20230524083115643](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/9f33d320e2c43241ab5a4c74f10441445310ecd2-1709275202730-30.png)\n\n```\n#conputeèŠ‚ç‚¹\nyum install xfsprogs rsync -y\n\nlsblk\n#å°†/dev/sdbå’Œ/dev/sdcè®¾å¤‡æ ¼å¼åŒ–ä¸ºXFSï¼š\nmkfs.xfs /dev/sdc\nmkfs.xfs /dev/sdd\nmkfs.xfs /dev/sde\nmkfs.xfs /dev/sdf\n#åˆ›å»ºå®‰è£…ç‚¹ç›®å½•ç»“æ„ï¼š\nmkdir -p /srv/node/sdc\nmkdir -p /srv/node/sdd\nmkdir -p /srv/node/sde\nmkdir -p /srv/node/sdf\n\ncat >> /etc/fstab << EOF\n/dev/sdc /srv/node/sdc xfs noatime,nodiratime,nobarrier,logbufs=8 0 2\n/dev/sdd /srv/node/sdd xfs noatime,nodiratime,nobarrier,logbufs=8 0 2\n/dev/sde /srv/node/sde xfs noatime,nodiratime,nobarrier,logbufs=8 0 2\n/dev/sdf /srv/node/sdf xfs noatime,nodiratime,nobarrier,logbufs=8 0 2\nEOF\n\n#å®‰è£…è®¾å¤‡\nmount /srv/node/sdc\nmount /srv/node/sdd\nmount /srv/node/sde\nmount /srv/node/sdf\n\ncat>/etc/rsyncd.conf<<EOF\nuid = swift\ngid = swift\nlog file = /var/log/rsyncd.log\npid file = /var/run/rsyncd.pid\naddress = 192.168.148.20\n\n[account]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/account.lock\n\n[container]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/container.lock\n\n[object]\nmax connections = 2\npath = /srv/node/\nread only = False\nlock file = /var/lock/object.lock\nEOF\n\n#é‡å¯æœåŠ¡\nsystemctl enable rsyncd.service\nsystemctl start rsyncd.service\n\n#å®‰è£…swiftç»„ä»¶\nyum install -y openstack-swift-account openstack-swift-container \\\n  openstack-swift-object\n  \nmv /etc/swift/account-server.conf{,.bak}\ncat> /etc/swift/account-server.conf<<EOF\n[DEFAULT]\nbind_ip = 192.168.148.20\nbind_port = 6202\nuser = swift\nswift_dir = /etc/swift\ndevices = /srv/node\nmount_check = true\n[pipeline:main]\npipeline = healthcheck recon account-server\n[app:account-server]\nuse = egg:swift#account\n[filter:healthcheck]\nuse = egg:swift#healthcheck\n[filter:recon]\nuse = egg:swift#recon\nrecon_cache_path = /var/cache/swift\n[account-replicator]\n[account-auditor]\n[account-reaper]\n[filter:xprofile]\nuse = egg:swift#xprofile\nEOF\n\nmv /etc/swift/container-server.conf{,.bak}\ncat> /etc/swift/container-server.conf<<EOF\n[DEFAULT]\nbind_ip = 192.168.148.20\nbind_port = 6201\nuser = swift\nswift_dir = /etc/swift\ndevices = /srv/node\nmount_check = true\n[pipeline:main]\npipeline = healthcheck recon container-server\n[app:container-server]\nuse = egg:swift#container\n[filter:healthcheck]\nuse = egg:swift#healthcheck\n[filter:recon]\nuse = egg:swift#recon\n[container-replicator]\n[container-updater]\n[container-auditor]\n[container-sync]\n[filter:xprofile]\nuse = egg:swift#xprofile\n[container-sharder]\nEOF\n\nmv /etc/swift/object-server.conf{,.bak}\ncat> /etc/swift/object-server.conf<<EOF\n[DEFAULT]\nbind_ip = 0.0.0.0\nbind_port = 6200\nuser = swift\nswift_dir = /etc/swift\ndevices = /srv/node\nmount_check = true\n[pipeline:main]\npipeline = healthcheck recon object-server\n[app:object-server]\nuse = egg:swift#object\nrecon_cache_path = /var/cache/swift\nrecon_lock_path = /var/lock\n[filter:healthcheck]\nuse = egg:swift#healthcheck\n[filter:recon]\nuse = egg:swift#recon\n[object-replicator]\n[object-reconstructor]\n[object-updater]\n[object-expirer]\n[filter:xprofile]\nuse = egg:swift#xprofile\n[object-relinker]\n[object-auditor]\nlog_name = object-auditor\nlog_facility = LOG_LOCAL0\nlog_level = INFO\nlog_address=/dev/log   \nEOF\n#ç¡®ä¿å¯¹å®‰è£…ç‚¹ç›®å½•ç»“æ„æ‹¥æœ‰é€‚å½“çš„æ‰€æœ‰æƒï¼š\nchown -R swift:swift /srv/node\n\n#åˆ›å»ºreconç›®å½•å¹¶ç¡®ä¿å¯¹å…¶æ‹¥æœ‰é€‚å½“çš„æ‰€æœ‰æƒï¼š\n mkdir -p /var/cache/swift\n chown -R root:swift /var/cache/swift\n chmod -R 775 /var/cache/swift\n \n# åœ¨é˜²ç«å¢™ä¸­å¯ç”¨å¿…è¦çš„è®¿é—®(å®éªŒå¿½ç•¥)\nfirewall-cmd --permanent --add-port=6200/tcp\nfirewall-cmd --permanent --add-port=6201/tcp\nfirewall-cmd --permanent --add-port=6202/tcp\n\n```\n\n### åˆ›å»ºå’Œåˆ†å‘åˆå§‹ç¯ controller-48\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\nè½¬åˆ°/etc/swiftç›®å½•ã€‚(æ‰€ä»¥æ“ä½œåœ¨æ­¤ç›®å½•ï¼Œæ‰§è¡Œ)\nåˆ›å»ºç”¨æˆ·ç¯account.builderæ–‡ä»¶ï¼š\ncd /etc/swift\n##ç¬¬ä¸€éƒ¨åˆ†ï¼ˆ6202ï¼‰åˆ›å»ºç”¨æˆ·ç¯\nswift-ring-builder account.builder create 10 3 1\nswift-ring-builder account.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.20 --port 6202 --device sdc --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.20 --port 6202 --device sdd --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.20 --port 6202 --device sde --weight 100\nswift-ring-builder account.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.20 --port 6202 --device sdf --weight 100\nswift-ring-builder account.builder\n##é‡æ–°å¹³è¡¡ç¯ä¸”éªŒè¯\nswift-ring-builder account.builder rebalance\nswift-ring-builder account.builder\n\n\n##ç¬¬äºŒéƒ¨åˆ†ï¼ˆ6201ï¼‰åˆ›å»ºå®¹å™¨ç¯\nswift-ring-builder container.builder create 10 3 1\nswift-ring-builder container.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.20 --port 6201 --device sdc --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.20 --port 6201 --device sdd --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.20 --port 6201 --device sde --weight 100\nswift-ring-builder container.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.20 --port 6201 --device sdf --weight 100\nswift-ring-builder container.builder\nswift-ring-builder container.builder rebalance\n\n##ç¬¬ä¸‰éƒ¨åˆ†ï¼ˆ6200ï¼‰åˆ›å»ºå¯¹è±¡ç¯\nswift-ring-builder object.builder create 10 3 1\nswift-ring-builder object.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.20 --port 6200 --device sdc --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 1 --ip 192.168.148.20 --port 6200 --device sdd --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.20 --port 6200 --device sde --weight 100\nswift-ring-builder object.builder add \\\n   --region 1 --zone 2 --ip 192.168.148.20 --port 6200 --device sdf --weight 100\nswift-ring-builder object.builder\nswift-ring-builder object.builder rebalance\n\nå°†swiftç›®å½•ä¸‹ç”Ÿæˆä¸‰ä¸ª.gzæ–‡ä»¶å¤åˆ¶åˆ°å­˜å‚¨èŠ‚ç‚¹çš„swiftç›®å½•ä¸‹\nscp account.ring.gz container.ring.gz object.ring.gz 192.168.148.20:/etc/swift\n\n##å®Œæˆå®‰è£… controller-48\nmv  /etc/swift/swift.conf{,.bak}\ncat> /etc/swift/swift.conf<<EOF\n[swift-hash]\nswift_hash_path_suffix = swift\nswift_hash_path_prefix = swift\n[storage-policy:0]\nname = Policy-0\ndefault = yes\nEOF\n\n#å¤åˆ¶åˆ°å­˜å‚¨èŠ‚ç‚¹\nscp swift.conf 192.168.148.20:/etc/swift\nswift_hash_path_suffixå’Œswift_hash_path_prefixä½œä¸ºå“ˆå¸Œç®—æ³•çš„ä¸€éƒ¨åˆ†ç”¨äºç¡®å®šæ•°æ®åœ¨é›†ç¾¤ä¸­çš„ä½ç½®ã€‚\nè¿™äº›å€¼åº”è¯¥ä¿æŒæœºå¯†ï¼Œå¹¶ä¸”åœ¨éƒ¨ç½²é›†ç¾¤ä¹‹åä¸èƒ½æ›´æ”¹ä¸¢å¤±ã€‚å¯è‡ªå®šä¹‰\nåœ¨æ‰€æœ‰èŠ‚ç‚¹ç¡®ä¿å¯¹é…ç½®ç›®å½•æ‹¥æœ‰é€‚å½“çš„æ‰€æœ‰æƒï¼š\n####å­˜å‚¨èŠ‚ç‚¹ä¸æ§åˆ¶èŠ‚ç‚¹åŒæ—¶æ‰§è¡Œï¼ˆæ³¨æ„ï¼ï¼ï¼ï¼ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶æ‰§è¡Œï¼‰\nchown -R root:swift /etc/swift \nåœ¨æ§åˆ¶å™¨èŠ‚ç‚¹å’Œä»»ä½•å…¶ä»–è¿è¡Œä»£ç†æœåŠ¡çš„èŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨å¯¹è±¡å­˜å‚¨ä»£ç†æœåŠ¡åŠå…¶ç›¸å…³æ€§ï¼Œå¹¶å°†å®ƒä»¬é…ç½®ä¸ºåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(å­˜å‚¨èŠ‚ç‚¹æ— ä»£ç†æœåŠ¡)\n\n#é‡å¯æœåŠ¡\nsystemctl enable openstack-swift-proxy.service memcached.service --now\nsystemctl restart openstack-swift-proxy.service memcached.service\n```\n\n### è®¡ç®—èŠ‚ç‚¹\n\n```\nåœ¨å­˜å‚¨èŠ‚ç‚¹å¯åŠ¨æ‰€æœ‰æœåŠ¡\n systemctl enable openstack-swift-account.service openstack-swift-account-auditor.service \\\n  openstack-swift-account-reaper.service openstack-swift-account-replicator.service\n systemctl start openstack-swift-account.service openstack-swift-account-auditor.service \\\n  openstack-swift-account-reaper.service openstack-swift-account-replicator.service\n systemctl enable openstack-swift-container.service \\\n  openstack-swift-container-auditor.service openstack-swift-container-replicator.service \\\n  openstack-swift-container-updater.service\n systemctl start openstack-swift-container.service \\\n  openstack-swift-container-auditor.service openstack-swift-container-replicator.service \\\n  openstack-swift-container-updater.service\n systemctl enable openstack-swift-object.service openstack-swift-object-auditor.service \\\n  openstack-swift-object-replicator.service openstack-swift-object-updater.service\n systemctl start openstack-swift-object.service openstack-swift-object-auditor.service \\\n  openstack-swift-object-replicator.service openstack-swift-object-updater.service\n```\n\n### éªŒè¯\n\n```\n[root@controller-48 swift]# swift stat\n               Account: AUTH_07a1ce96dca54f1bb0d3b968f1343617\n            Containers: 0\n               Objects: 0\n                 Bytes: 0\n       X-Put-Timestamp: 1684919814.32783\n           X-Timestamp: 1684919814.32783\n            X-Trans-Id: txd6f3affa0140455b935ff-00646dd605\n          Content-Type: text/plain; charset=utf-8\nX-Openstack-Request-Id: txd6f3affa0140455b935ff-00646dd605\n[root@controller-48 swift]# cd\n[root@controller-48 ~]# swift upload demo cirros-0.5.2-x86_64-disk.img --object-name image\nimage\n\n##é‡å¯novaæœåŠ¡\nsudo systemctl restart openstack-nova*\n\n```\n\n## Heatï¼ˆç¼–æ’ï¼‰\n\n### æ§åˆ¶èŠ‚ç‚¹\n\n```\n#åˆ›å»ºheatæ•°æ®åº“å’Œç”¨æˆ·\nmysql -u root -pMARIADB_PASS\nCREATE DATABASE heat;\nGRANT ALL PRIVILEGES ON heat.* TO 'heat'@'localhost' \\\n  IDENTIFIED BY 'HEAT_DBPASS';\nGRANT ALL PRIVILEGES ON heat.* TO 'heat'@'%' \\\n  IDENTIFIED BY 'HEAT_DBPASS';\nflush privileges;\nexit\n\nsource admin-openrc.sh\nopenstack user create --domain default --password HEAT_PASS heat\n#æ·»åŠ  admin è§’è‰²åˆ° heat ç”¨æˆ·ä¸Š\nopenstack role add --project service --user heat admin\n##åˆ›å»ºheatå’Œ heat-cfn æœåŠ¡å®ä½“\nopenstack service create --name heat \\\n  --description \"Orchestration\" orchestration\nopenstack service create --name heat-cfn \\\n  --description \"Orchestration\"  cloudformation  \n##åˆ›å»º Orchestration æœåŠ¡çš„ API ç«¯ç‚¹\nopenstack endpoint create --region RegionOne \\\n  orchestration public http://controller-48:8004/v1/%\\(tenant_id\\)s\nopenstack endpoint create --region RegionOne \\\n  orchestration internal http://controller-48:8004/v1/%\\(tenant_id\\)s\nopenstack endpoint create --region RegionOne \\\n  orchestration admin http://controller-48:8004/v1/%\\(tenant_id\\)s\n\nopenstack endpoint create --region RegionOne \\\n  cloudformation public http://controller-48:8000/v1\nopenstack endpoint create --region RegionOne \\\n  cloudformation internal http://controller-48:8000/v1\nopenstack endpoint create --region RegionOne \\\n  cloudformation admin http://controller-48:8000/v1\n```\n\nä¸ºäº†ç®¡ç†æ ˆï¼Œåœ¨è®¤è¯æœåŠ¡ä¸­Orchestrationéœ€è¦æ›´å¤šä¿¡æ¯\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\n#ä¸ºæ ˆåˆ›å»º heat åŒ…å«é¡¹ç›®å’Œç”¨æˆ·çš„åŸŸ\nopenstack domain create --description \"Stack projects and users\" heat\n\n#åœ¨ heat åŸŸä¸­åˆ›å»ºç®¡ç†é¡¹ç›®å’Œç”¨æˆ·çš„heat_domain_adminç”¨æˆ·ï¼š\nopenstack user create --domain heat --password=HEAT_DOMAIN_USER_PASS heat_domain_admin\n\n#)æ·»åŠ adminè§’è‰²åˆ° heat åŸŸ ä¸­çš„heat_domain_adminç”¨æˆ·ï¼Œå¯ç”¨heat_domain_adminç”¨æˆ·#ç®¡ç†æ ˆçš„ç®¡ç†æƒé™\nopenstack role add --domain heat --user-domain heat --user heat_domain_admin admin\n\n#ä¸ºæ ˆåˆ›å»º heat åŒ…å«é¡¹ç›®å’Œç”¨æˆ·çš„åŸŸ\nopenstack role create heat_stack_owner\n\n#æ·»åŠ heat_stack_owner è§’è‰²åˆ°demo é¡¹ç›®å’Œç”¨æˆ·ï¼Œå¯ç”¨demo ç”¨æˆ·ç®¡ç†æ ˆã€‚\nopenstack role add --project demo --user demo heat_stack_owner\n#å¿…é¡»æ·»åŠ  heat_stack_owner è§’è‰²åˆ°æ¯ä¸ªç®¡ç†æ ˆçš„ç”¨æˆ·ã€‚\n\n#heat_stack_user è§’è‰²\nopenstack role create heat_stack_user\n\n```\n\nå®‰è£…å¹¶é…ç½®Heatç»„ä»¶ç›¸å…³è½¯ä»¶\n\n```\n#æ§åˆ¶èŠ‚ç‚¹\nyum install openstack-heat-api openstack-heat-api-cfn \\\n  openstack-heat-engine -y\n\nmv /etc/heat/heat.conf{,.bak}\ncat >> /etc/heat/heat.conf << EOF\n[database]\nconnection = mysql+pymysql://heat:HEAT_DBPASS@controller-48/heat  \n#HEAT_DBPASSæ˜¯HEATæ•°æ®åº“å¯†ç \n[DEFAULT]\ntransport_url = rabbit://openstack:RABBIT_PASS@controller-48\n#RABBIT_PASSä¸ºRabbitmqæœåŠ¡å¯†ç  ç”¨æˆ·åæ˜¯openstack\n[keystone_authtoken]\nwww_authenticate_uri = http://controller-48:5000\nauth_url = http://controller-48:5000\nmemcached_servers = controller-48:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = heat\npassword = HEAT_PASS\n#HEAT_PASSæ˜¯heatç”¨æˆ·å¯†ç \n[trustee]\nauth_type = password\nauth_url = http://controller-48:5000\nusername = heat\npassword = HEAT_PASS\n#HEAT_PASSæ˜¯heatç”¨æˆ·å¯†ç \nuser_domain_name = default\n[clients_keystone]\nauth_uri = http://controller-48:5000\n[DEFAULT]\nheat_metadata_server_url = http://controller-48:8000\nheat_waitcondition_server_url = http://controller-48:8000/v1/waitcondition\n[DEFAULT]\nstack_domain_admin = heat_domain_admin\nstack_domain_admin_password = HEAT_DOMAIN_USER_PASS\nstack_user_domain_name = heat\nEOF\n\nsu -s /bin/sh -c \"heat-manage db_sync\" heat\n##å¯åŠ¨ Orchestration ç¼–æ’æœåŠ¡heatç»„ä»¶å¹¶å°†å…¶è®¾ç½®ä¸ºéšç³»ç»Ÿå¯åŠ¨\nsystemctl enable openstack-heat-api.service \\\n  openstack-heat-api-cfn.service openstack-heat-engine.service\n\nsystemctl restart openstack-heat-api.service \\\n  openstack-heat-api-cfn.service openstack-heat-engine.service\n  \n[root@controller-48 ~]# systemctl list-unit-files |grep openstack-heat*\nopenstack-heat-api-cfn.service                enabled\nopenstack-heat-api.service                    enabled\nopenstack-heat-engine.service                 enabled\n\n```\n\n### éªŒè¯\n\n```\ncd\nsource admin-openrc.sh\nopenstack service list\nopenstack orchestration service list\nè¯¥è¾“å‡ºæ˜¾ç¤ºè¡¨æ˜åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šæœ‰åº”è¯¥å››ä¸ªheat-engineç»„ä»¶ã€‚\n\n[root@controller-48 ~]# openstack orchestration service list\n+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+\n| Hostname   | Binary      | Engine ID                            | Host       | Topic  | Updated At                 | Status |\n+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+\n| controller-48 | heat-engine | 230ae8e8-3c9f-4b82-b0ca-caef3d5497f1 | controller-48 | engine | 2023-05-27T14:42:52.000000 | up     |\n| controller-48 | heat-engine | 626e74a4-918b-46b8-8993-d6db92eb861e | controller-48 | engine | 2023-05-27T14:42:52.000000 | up     |\n| controller-48 | heat-engine | f648e766-cdb9-4e06-b190-a713baf33df8 | controller-48 | engine | 2023-05-27T14:42:52.000000 | up     |\n| controller-48 | heat-engine | 2cb3dfd3-0636-432c-8d59-f22d850510d5 | controller-48 | engine | 2023-05-27T14:42:52.000000 | up     |\n+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+\n\n```\n\n## åˆ›å»ºå®ä¾‹\n\n### åˆ›å»ºå®ä¾‹ç±»å‹\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»è®¡ç®—ï¼Œç‚¹å‡»å®ä¾‹ç±»å‹ï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºå®ä¾‹ç±»å‹ã€‚\n\n![image-20240106230035149](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/55d5112b942c438d89818b728d7d3062697559838-1709275708073-159.png)\n\næ ¹æ®ä»¥ä¸Šå›¾ç‰‡æ­¥éª¤ä¾æ¬¡å¡«å…¥ï¼šå®ä¾‹åç§°ã€VCPUæ•°é‡ã€å†…å­˜å¤§å°ã€æ ¹ç£ç›˜å¤§å°ï¼Œç¡®è®¤æ— è¯¯åç‚¹å‡»åˆ›å»ºå®ä¾‹ç±»å‹ã€‚\n\n### åˆ›å»ºé•œåƒ\n\næµ‹è¯•é•œåƒï¼šhttps://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img\n\n<font color='red'>æœ‰ä¸¤ç§ä¸Šä¼ æ–¹å¼ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼ï¼ï¼</font>\n\n<font color='red'>1.Windowsä¸Šä¼ é•œåƒæ–¹å¼</font>\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»è®¡ç®—ï¼Œç‚¹å‡»é•œåƒï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºé•œåƒã€‚\n\nWindowsä¸‹è½½åˆ°æœ¬åœ°å³å¯\n\n![image-20240106230649633](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/f2ea42f3b57b4b7a5fb9bd242f78e526697559838-1709275708073-160.png)\n\næ ¹æ®ä»¥ä¸Šå›¾ç‰‡æ­¥éª¤ä¾æ¬¡å¡«å…¥ï¼šé•œåƒåç§°ã€é€‰æ‹©æ–‡ä»¶ã€é•œåƒæ ¼å¼ï¼Œç¡®è®¤æ— è¯¯åç‚¹å‡»åˆ›å»ºé•œåƒã€‚\n**æ³¨**ï¼šæ¼”ç¤ºä¸Šä¼ çš„ img é•œåƒæ ¼å¼éœ€é€‰ç”¨ QCOW2 - QEMUæ¨¡æ‹Ÿå™¨ æ‰å¯æ­£å¸¸åŠ è½½ã€‚\n\n\n\n<font color='red'>2.Linuxä¸Šä¼ é•œåƒæ–¹å¼</font>\n\n```\nsource admin-openrc\nwget https://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img\n#å¯èƒ½ä¼šä¸‹è½½ä¸åˆ°ï¼Œå¯ä»¥å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨ä¸‹è½½ï¼Œç„¶åç§»åˆ°/root/ç›®å½•ä¸‹\nglance image-create --name \"cirros\" \\\n  --file cirros-0.6.2-x86_64-disk.img \\\n  --disk-format qcow2 --container-format bare \\\n  --visibility=public\n\nopenstack image list\n\n[root@controller-1 ~]# openstack image list\n+--------------------------------------+--------+--------+\n| ID                                   | Name   | Status |\n+--------------------------------------+--------+--------+\n| 627761da-7f8c-4780-842a-e50e62f5c464 | cirros | active |\n+--------------------------------------+--------+--------+\n\n```\n\n### åˆ›å»ºå†…éƒ¨ç½‘ç»œ\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºç½‘ç»œã€‚\n\n![image-20240106231124036](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/cea509bcbba7395e7c5710616943c0bd697559838-1709275708073-161.png)\n\n![image-20240106231151367](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/6bab28f65a2c56a624df71c4b9866347697559838-1709275708073-162.png)\n\n![image-20240106231323081](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/0b1b24f8d99f5c3f49662532c68ac046697559838-1709275708073-163.png)\n\n### åˆ›å»ºå¤–éƒ¨ç½‘ç»œ\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºç½‘ç»œã€‚\n\n<font color='red'>å¦‚æœä½ æ˜¯æŒ‰ç…§æœ¬æ–‡æ¡£æ­å»ºçš„ï¼Œå°±å¡«provider</font>\n\n![image-20240106231633793](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/5fbbf082bc66e60949bdd81825facd02697559838-1709275708073-164.png)\n\n![image-20240106231854446](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/070d5393f9a1b8dd7dee9d2fea10086e697559838-1709275708073-165.png)\n\n![image-20240106232011057](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/d0a471b28e40019c7fc79bc8918cda04697559838-1709275708074-166.png)\n\n### åˆ›å»ºè·¯ç”±\n\nå·¦ä¾§é€‰æ‹©ç®¡ç†å‘˜ï¼Œç‚¹å‡»ç½‘ç»œï¼Œç‚¹å‡»è·¯ç”±ï¼Œå³ä¾§ç‚¹å‡»åˆ›å»ºè·¯ç”±ã€‚\n\n![image-20240106232138022](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/31d170f9b1e99be47760fd014bb6809d697559838-1709275708074-167.png)\n\n\n\n![image-20240106232201129](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/cb31565a3cfeb2dc853ac38cded0043e697559838-1709275708074-168.png)\n\n![image-20240106232242376](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/ce7823ed963eca1a54ca8b97f14928e5697559838-1709275708074-169.png)\n\n### æ·»åŠ å®‰å…¨ç»„è§„åˆ™\n\n![image-20240106232342515](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/757fee2ef006d00f258da6008163fe91697559838-1709275708074-170.png)\n\n![image-20240106232725982](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/b99fadf3fe10a6ddba4ba221b3c2ff87697559838-1709275708074-171.png)\n\næœ€åæ•ˆæœé•¿è¿™æ ·\n\n![image-20240106232758711](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/485233affd839f8fbce7ea1c0ae2765d697559838-1709275708074-172.png)\n\n### åˆ›å»ºå®ä¾‹\n\n![image-20240106232939110](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/0105c7af8682dc647d6cf79473cd9fbc697559838-1709275708074-173.png)\n\n![image-20240106233038731](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/86ffdba6219b46e5a387f8b67fa5edf7697559838-1709275708074-174.png)\n\n![image-20240106233101509](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/8bf413d2923a38d956d41f905d1a4f6b697559838-1709275708074-175.png)\n\n![image-20240106233129659](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/3083c4669cd60df3c5a53b7b5f661629697559838-1709275708074-176.png)\n\nç„¶åç‚¹å‡»åˆ›å»ºå®ä¾‹\n\nåˆ†é…æµ®åŠ¨ip\n\n![image-20240106233251169](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/bfb7b78b90815059f8171048bcb0683b697559838-1709275708074-177.png)\n\n![image-20240106233418787](../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/f584f2ac4bb92bb8043c2c07c670dbf4697559838-1709275708075-178.png)\n\n<font color='red'>ç»“è®ºï¼šåˆ›å»ºå®ä¾‹æˆåŠŸ</font>\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Centos 7","OpenStack"],"categories":["äº‘åŸç”Ÿ"]},{"title":"Dockerç¬”è®°","url":"/posts/27092/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Dockerç¬”è®°\n\nç»“åˆ[Centos 8éƒ¨ç½²Docker - ä¸¥åƒå±¹åšå®¢ (qianyios.top)](https://blog.qianyios.top/posts/51253/)æ­å»ºçš„Dockerå®ç°æœ¬æ¬¡ç¬”è®°çš„æ‰€æœ‰å†…å®¹åŠä¾‹å­\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹Centos7éƒ¨ç½²Docker CE 19.03å®ç°æœ¬å®éªŒçš„æ‰€æœ‰ä¾‹å­\n\n## Centos7éƒ¨ç½²Docker CE 19.03\n\nï¼ˆ2023å¹´4æœˆ8æ—¥01ç‚¹00åˆ†ï¼‰å½“å‰æœ€å¸¸ç”¨çš„ Docker ç‰ˆæœ¬æ˜¯ Docker CE 19.03ã€‚è¿™æ˜¯ Docker ç¤¾åŒºç‰ˆï¼ˆCommunity Editionï¼‰çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå®ƒåŒ…æ‹¬ä¸€äº›æ›´æ–°å’Œæ–°åŠŸèƒ½ï¼Œå¦‚å¤šé˜¶æ®µæ„å»ºã€Dockerfile ä¸­çš„ ARG å’Œ FROM æŒ‡ä»¤ä»¥åŠä¸ Kubernetes çš„æ›´å¥½é›†æˆç­‰ã€‚å¦å¤–ï¼ŒDocker CE 19.03 æ”¯æŒ Windowsã€MacOS å’Œ Linux æ“ä½œç³»ç»Ÿã€‚\n\n### å¸è½½æ—§ç‰ˆæœ¬\n\n```\nsudo yum -y remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-selinux \\\n                  docker-engine-selinux \\\n                  docker-engine\nsudo yum remove docker-ce docker-ce-cli containerd.io docker-compose docker-machine docker-swarm\nsudo rm /etc/yum.repos.d/docker-ce.repo\nsudo rm -rf /var/lib/docker\n```\n\n### å®‰è£…docker\n\n```\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nsudo yum install docker-ce docker-ce-cli containerd.io -y\nsudo systemctl start docker\ndocker version\nsudo curl -L \"https://github.com/docker/compose/releases/download/1.28.6/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n```\n\n## Dockerçš„å¸¸ç”¨å‘½ä»¤\n\n```\ndocker version\t\t   # æ˜¾ç¤ºdockerçš„ç‰ˆæœ¬ä¿¡æ¯\ndocker info\t\t\t   # æ˜¾ç¤ºdockerçš„ç³»ç»Ÿä¿¡æ¯,åŒ…æ‹¬é•œåƒå’Œå®¹å™¨çš„æ•°é‡\ndocker å‘½ä»¤ --help \t   # å¸®åŠ©å‘½ä»¤\n```\n\n## é•œåƒå‘½ä»¤\n\n### é•œåƒå‘½ä»¤\n\n```\ndocker images\t\t# æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°çš„ä¸»æœºä¸Šçš„é•œåƒ\n-a,--al1\t# åˆ—å‡ºæ‰€æœ‰é•œåƒ\n-q,--quiet\t# åªæ˜¾ç¤ºé•œåƒçš„id\n# è§£é‡Š\nREPOSITORY        TAG         IMAGE ID        CREATED          SIZE\né•œåƒçš„ä»“åº“æº      é•œåƒçš„æ ‡ç­¾  é•œåƒçš„id        é•œåƒçš„åˆ›å»ºæ—¶é—´   é•œåƒçš„å¤§å°\n```\n\n### æœç´¢å‘½ä»¤\n\n```\n[root@docker ~]# docker search centos\nNAME    DESCRIPTION    STARS                               OFFICIAL  AUTOMATED\ncentos  DEPRECATED;    The official build of CentOS.       7537      [OK]\næ£€ç´¢Dockerä»“åº“ä¸­çš„Ubuntué•œåƒ\n```\n\n### æ‹‰å–é•œåƒ\n\n```\n[root@docker ~]# docke pull é•œåƒå[:tag]\t\t#ä¸‹è½½é•œåƒ\n# å¦‚æœä¸å†™tagï¼Œé»˜è®¤å°±æ˜¯latest\n\n[root@docker ~]# docker pull centos\nUsing default tag: latest\nlatest: Pulling from library/centos\na1d0c7532777: Pull complete\nDigest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177\nStatus: Downloaded newer image for centos:latest\ndocker.io/library/centos:latest\nä»dockeråº“æ‹‰å»centosé•œåƒ\n[root@docker ~]# docker images\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\ncentos       latest    5d0da3dc9764   18 months ago   231MB\n\n```\n\n### åˆ é™¤é•œåƒ\n\n```\ndocker rmi -f é•œåƒå/id\t\t# åˆ é™¤æŒ‡å®šé•œåƒ\ndocker rmi -f é•œåƒå1 é•œåƒå2 é•œåƒå3\t # ä¸€æ¬¡åˆ é™¤æŒ‡å®šå¤šä¸ªé•œåƒ\ndocker rmi -f $(docker images -aq)\t\t# åˆ é™¤å…¨éƒ¨å®¹å™¨\n\n[root@docker ~]# docker images\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\ncentos       latest    5d0da3dc9764   18 months ago   231MB\n[root@docker ~]# docker rmi 5d0\nUntagged: centos:latest\nã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\nï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ åˆ é™¤é•œåƒid åªéœ€è¦è¾“å…¥å‰é¢3ä¸ªå­—ç¬¦å°±è¡Œäº†ï¼‰\n```\n\n### æŸ¥çœ‹é•œåƒåˆ†å±‚\n\n```\n[root@docker ~]# docker image inspect é•œåƒid\n```\n\n### é•œåƒèµ„æºåŒ…\n\n```\ncurl -O http://mirrors.douxuedu.com/cloud/docker.zip\nunzip docker.zip\ndocker load < é•œåƒå.tar\nä¾‹å¦‚ï¼š\n[root@localhost ~]# docker load < docker/centos_latest.tar\n```\n\n## å®¹å™¨å‘½ä»¤\n\n### æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨\n\n```\ndocker run [å¯é€‰å‚æ•°] é•œåƒå\t\t# æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨\n--name=Name\t\t# å®¹å™¨åå­—ç”¨æ¥åŒºåˆ†å®¹å™¨\n-d\t\t\t\t# åå°æ–¹å¼è¿è¡Œ\n-it\t\t\t\t# ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å®¹\n-p\t\t\t\t# æŒ‡å®šå®¹å™¨çš„ç«¯å£-p 8080:8080\n-P\t\t\t\t# éšæœºæŒ‡å®šç«¯å£\nè¿›å…¥å®¹å™¨\n[root@docker ~]# docker run -it --name test centos\n[root@4018f9ac2f33 /]# pwd\n/\nexit         # é€€å‡º\nCtrl+P+Q     # å®¹å™¨ä¸åœæ­¢é€€å‡º\n```\n\n### æŸ¥çœ‹å®¹å™¨åˆ—è¡¨\n\n```\næŸ¥çœ‹å®¹å™¨åˆ—è¡¨   ï¼ˆè‹¥åŠ  -aå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åŒ…æ‹¬ä¸ºè¿è¡Œçš„ï¼‰\n[root@docker ~]# docker ps [å¯é€‰å‚æ•°]\nCONTAINER ID   IMAGE     COMMAND       CREATED              STATUS              PORTS     NAMES\n4018f9ac2f33   centos    \"/bin/bash\"   About a minute ago   Up About a minute             test\n[å¯é€‰å‚æ•°]\n-a\t\t\t# åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨+å¸¦å‡ºå†å²è¿è¡Œè¿‡çš„å®¹å™¨\n-n=?\t\t# æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨\n-q\t\t\t# åªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å·\n```\n\n### åˆ é™¤å®¹å™¨\n\n```\nï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ åˆ é™¤å®¹å™¨id åªéœ€è¦è¾“å…¥å‰é¢3ä¸ªå­—ç¬¦å°±è¡Œäº†ï¼‰\ndocker rm å®¹å™¨id\t# åˆ é™¤æŒ‡å®šçš„å®¹å™¨ï¼Œä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¦‚æœè¦å¼ºåˆ¶åˆ é™¤ rm -f\ndocker rm -f $ (docker ps -aq)\t\t# å¼ºåˆ¶åˆ é™¤æ‰€æœ‰çš„å®¹å™¨\ndocker ps -a -q|xargs docker rm\t\t# åˆ é™¤æ‰€æœ‰çš„å®¹å™¨\n```\n\n### å¯åŠ¨å’Œåœæ­¢å®¹å™¨\n\n```\ndocker start å®¹å™¨id\t\t# å¯åŠ¨å®¹å™¨\ndocker restart å®¹å™¨id\t\t# é‡å¯å®¹å™¨\ndocker stop å®¹å™¨id\t\t# åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨\ndocker kill å®¹å™¨id\t\t# å¼ºåˆ¶åœæ­¢å½“å‰å®¹å™¨\n```\n\n### è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨\n\n```\nè¿›å…¥å®¹å™¨åå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥åœ¨é‡Œé¢æ“ä½œ\ndocker exec -it å®¹å™¨id /bin/bash\nè¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹\ndocker attach å®¹å™¨id\n```\n\n### æ‹·è´å®¹å™¨å†…çš„æ–‡ä»¶åˆ°ä¸»æœºä¸Š\n\n```\ndocker cp å®¹å™¨id:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„\n\n[root@docker ~]# docker exec -it 401 /bin/bash\n[root@4018f9ac2f33 /]# echo \"11\" > test.txt\n[root@4018f9ac2f33 /]# cat test.txt\n11\nCtrl+P+Q     # å®¹å™¨ä¸åœæ­¢é€€å‡º\n[root@docker ~]# docker cp 401:test.txt /root/\nPreparing to copy...\nSuccessfully copied 2.048kB to /root/\n[root@docker ~]# cat test.txt\n11\n\n```\n\n### åœæ­¢å®¹å™¨ï¼Œå°†å®¹å™¨æ‰“åŒ…æˆæ–°é•œåƒ\n\n```\n[root@docker ~]# docker commit [å¯é€‰å‚æ•°] å®¹å™¨id REPOSITORY:TAG\n[å¯é€‰å‚æ•°]ï¼š\n-a :æäº¤çš„é•œåƒä½œè€…ï¼›\n-c :ä½¿ç”¨DockerfileæŒ‡ä»¤æ¥åˆ›å»ºé•œåƒï¼›\n-m :æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼›\n-p :åœ¨commitæ—¶ï¼Œå°†å®¹å™¨æš‚åœã€‚\n\n\n[root@localhost ~]# docker commit -a qianyios -m \"åˆ›å»ºäº†test.txt\" 401 test/centos:v1\nsha256:29ffb8423a78853c5a49918c99e8d513239f9c3365cca06e1fc0027f589b7f59\n[root@localhost ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED         SIZE\ntest/centos   v1        29ffb8423a78   3 seconds ago   233MB\ncentos        latest    5d0da3dc9764   18 months ago   231MB\n\n```\n\n## Dockeræ•°æ®å·\n\n- æ•°æ®å·ç”¨é€”ï¼šä½¿å®¹å™¨å†…éƒ¨çš„æ–‡ä»¶è·Ÿå®¹å™¨å¤–é¢çš„æ–‡ä»¶åŒæ­¥\n- æ•°æ®å·çš„ç‰¹ç‚¹:\n  1. æ•°æ®å·å¯åœ¨å®¹å™¨ä¹‹é—´å…±äº«æˆ–é‡ç”¨æ•°æ®\n  2. å·ä¸­çš„æ›´æ”¹å¯ä»¥ç›´æ¥ç”Ÿæ•ˆ\n  3. æ•°æ®å·ä¸­çš„æ›´æ”¹ä¸ä¼šåŒ…å«åœ¨é•œåƒçš„æ›´æ–°ä¸­\n  4. æ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä¸ºæ­¢\n\n### æ•°æ®å·åŸºæœ¬å‘½ä»¤\n\n```\ndocker volume ls\t\t# æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½çš„æ•°æ®å·\ndocker volume inspect å·å\t# æŸ¥çœ‹æ•°æ®å·æ‰€åœ¨çš„è·¯å¾„\n```\n\n### æŒ‡å®šè·¯å¾„æŒ‚è½½\n\n```\ndocker run -v ä¸»æœºç›®å½•:å®¹å™¨å†…ç›®å½•\n```\n\n### å·åæŒ‚è½½\n\n```\ndocker run -v å·å(ä¸æ˜¯ç›®å½•äº†):å®¹å™¨å†… ç›®å½•\n```\n\n### åŒ¿åæŒ‚è½½\n\n```\ndocker run -v å®¹å™¨å†…ç›®å½•\n```\n\n### æ•°æ®å·æƒé™\n\n```\ndocker run -v ä¸»æœºç›®å½•:å®¹å™¨å†…ç›®å½•:ro\t\t# ro readonly åªè¯»\ndocker run -v ä¸»æœºç›®å½•:å®¹å™¨å†…ç›®å½•:rw\t\t# rw readwrite å¯è¯»å¯å†™\n# roåªèƒ½åœ¨ä¸»æœºä¸Šé¢æ¥æ“ä½œç›®å½•ï¼Œå®¹å™¨æ— æ³•æ“ä½œ\n```\n\n### æ•°æ®å·å®¹å™¨\n\n```\n--volumes-from è¦åŒæ­¥æ–‡ä»¶çš„å®¹å™¨\t\t\t# å®ç°å¤šä¸ªå®¹å™¨çš„æ•°æ®åŒæ­¥ä¸å…±äº«\n```\n\n- ä¾‹å­ï¼šä¸‰ä¸ªMySQLåŒæ­¥æ•°æ®\n\n1ã€æ•°æ®åº“1ä½¿ç”¨çš„å‘½ä»¤\n\n```\ndocker run -d -p ä¸»æœºç«¯å£:3306 /\n-v /etc/mysql/conf.d -v /var/1ib/mysql /\n-e MYSQL_ROOT_PASSWORD=æ•°æ®åº“å¯†ç  --name mysql01 mysql\n```\n\n2ã€æ•°æ®åº“2ä½¿ç”¨çš„å‘½ä»¤\n\n```\ndocker run -d -p ä¸»æœºç«¯å£:3306 /\n--volumes-from mysql01 /\n-e MYSQL_ROOT_PASSWORD=æ•°æ®åº“å¯†ç  --name mysql02 mysql\nCopy\n```\n\n3ã€æ•°æ®åº“3ä½¿ç”¨çš„å‘½ä»¤\n\n```\ndocker run -d -p ä¸»æœºç«¯å£:3306 /\n--volumes-from mysql01 /\n-e MYSQL_ROOT_PASSWORD=æ•°æ®åº“å¯†ç  --name mysql03 mysql\n```\n\n## DockerFile\n\nDockerFileæ˜¯ç”¨æ¥æ„å»ºDockeré•œåƒçš„æ„å»ºæ–‡ä»¶ã€‚\n\n### <span style=\"color:red\">!</span>æ³¨æ„äº‹é¡¹\n\n- 1ã€æ¯ä¸ªä¿ç•™å…³é”®å­—ï¼ˆæŒ‡ä»¤ï¼‰éƒ½æ˜¯å¿…é¡»æ˜¯å¤§å†™å­—æ¯\n- 2ã€æ‰§è¡Œä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ\n- 3ã€#è¡¨ç¤ºæ³¨é‡Š\n- 4ã€æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œå¹¶æäº¤\n\n<img src=\"../img/Docker node/2009e0e056c3fe3dbff4bae26643fd5eb7e965c6.png\" alt=\"image-20230325152651663\" style=\"zoom: 50%;\" />\n\n### DockerFileå‘½ä»¤\n\n```\nFROM          # åŸºç¡€é•œé•œåƒ,â€”åˆ‡ä»è¿™é‡Œå¼€å§‹æ„å»º\nMAINTAINER    # é•œåƒçš„ä½œè€…,å§“å<é‚®ç®±>\nRUN           # é•œåƒæ„å»ºçš„æ—¶å€™éœ€è¦è¿è¡Œçš„å‘½ä»¤\nADD           # æ·»åŠ å†…å®¹ï¼Œæ·»åŠ å‹ç¼©åŒ…ä¼šè‡ªåŠ¨è§£å‹\nWORKDIR\t\t # é•œåƒçš„å·¥ä½œç›®å½•\nVOLUME        # æŒ‚è½½çš„ç›®å½•\nEXPOSE        # ä¿ç•™ç«¯å£é…ç½®\nCMD\t\t\t# æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤,åªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œå¯è¢«æ›¿ä»£\nENTRYPOINT    # æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤,å¯ä»¥è¿½åŠ å‘½ä»¤\nONBUILD\t\t # å½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿DockerFileè¿™ä¸ªæ—¶å€™å°±ä¼šè¿è¡ŒONBUILD çš„æŒ‡ä»¤ã€‚è§¦å‘æŒ‡ä»¤ã€‚\nCOPY          # ç±»ä¼¼ADD ï¼Œå°†æˆ‘ä»¬æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­\nENV           # æ„å»ºçš„æ—¶å€™è®¾ç½®ç¯å¢ƒå˜é‡!\n```\n\n### ç”¨DockerFileæ–‡ä»¶åˆ›å»ºé•œåƒ\n\n```\ndocker build -f DockerFileæ–‡ä»¶å -t é•œåƒå:ç‰ˆæœ¬å· .\n# -fæŒ‡å®šDockfileæ–‡ä»¶ï¼Œè‹¥Dockerfileæ–‡ä»¶åå°±æ˜¯Dockerfileï¼Œåˆ™ä¸ç”¨-få†æŒ‡å®šã€‚ç³»ç»Ÿåˆ™è‡ªåŠ¨åˆ¤å®šæ­¤æ–‡ä»¶æ˜¯Dockerfileæ–‡ä»¶ã€‚\n# æœ€åä¸€ä¸ªæ˜¯ . ä¸€å®šåŠ ä¸Š\n```\n\nä¾‹å­ï¼š\n\n```\n[root@docker ~]# mkdir centos\n[root@docker ~]# cd centos/\n[root@docker centos]# touch DockerFile\n[root@docker centos]# vi DockerFile\n#åŸºç¡€é•œåƒä¿¡æ¯\nFROM centos:latest\n#ç»´æŠ¤è€…ä¿¡æ¯\nMAINTAINER qianyios xiaoohu2002@163.com\n#é•œåƒæ“ä½œæŒ‡ä»¤\nRUN sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*\nRUN sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*\nRUN yum install -y wget\nRUN wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo\nRUN yum clean all && yum makecache\nRUN mkdir /test \nRUN echo 'test' > /test/test.txt\n\n[root@docker centos]# docker build -f /root/centos/DockerFile -t centos-test:v1 .\n[root@docker centos]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED         SIZE\ncentos-test   v1        b1f4c91e59ee   2 minutes ago   328MB\n#æ­¤æ—¶å·²ç»æœ‰ä¸€ä¸ªé•œåƒäº†\n```\n\nç”¨è¿™ä¸ªé•œåƒåˆ›å»ºå®¹å™¨ï¼Œä¸”å°†å®¹å™¨ä¸­çš„/testæŒ‚è½½åˆ°ä¸»æœºç›®å½•ä¸‹çš„/opt/test\n\nb1fæ˜¯é•œåƒidå‰ä¸‰ä¸ªå­—ç¬¦\n\n```\ndocker run -it -v /opt/test:/test --name test -p 80:80 b1f /bin/bash\nexit\né€€å‡ºexitä¹‹åæŸ¥çœ‹/opt/testæ˜¯å¦æœ‰test.txtæ–‡ä»¶\n[root@docker ~]# cat /opt/test/test.txt\ntest\næˆåŠŸï¼ï¼ï¼\n```\n\n## é…ç½®é•œåƒåŠ é€Ÿå™¨\n\n```\n# è®¾ç½® Docker é•œåƒåŠ é€Ÿå™¨\ncat > /etc/docker/daemon.json << EOF\n{\n  \"registry-mirrors\": [\n    \"http://hub-mirror.c.163.com\",\n    \"https://docker.mirrors.ustc.edu.cn/\"\n  ],\n  \"insecure-registries\": [],\n  \"debug\": false,\n  \"experimental\": false,\n  \"features\": {\n    \"buildkit\": true\n  }\n}\nEOF\n\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n## Docker ç½‘ç»œ\n\ndockerç½‘ç»œä¸»è¦æ˜¯è§£å†³å®¹å™¨è”ç½‘é—®é¢˜ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨å®¹å™¨ä¸­æœ€é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œå¦‚æœå®¹å™¨æ²¡æœ‰ç½‘ç»œåˆ™æ— æ³•å‘ç½‘ç»œä¸­æä¾›æœåŠ¡ã€‚\n\n### ç½‘ç»œç®¡ç†å‘½ä»¤ï¼šdocker network\n\n```\n[root@docker ~]# docker network --help\nUsage:\tdocker network COMMAND\nManage networks\nCommands:\n  connect        è¿æ¥å®¹å™¨åˆ°ç½‘ç»œ\n  create          åˆ›å»ºç½‘ç»œ\n  disconnect    æ–­å¼€å®¹å™¨ä¸ç½‘ç»œçš„è¿æ¥\n  inspect         æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯\n  ls                 åˆ—è¡¨ç½‘ç»œ\n  prune           åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œ\n  rm               åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œ\n```\n\n### dockerç½‘ç»œç±»å‹\n\nåˆ›å»ºå®¹å™¨çš„æ—¶å€™å¯ä»¥é€šè¿‡â€”networkå‘½ä»¤æ¥æŒ‡å®šå®¹å™¨çš„ç½‘ç»œï¼Œç½‘ç»œç±»å‹æœ‰ä»¥ä¸‹å››ç§\n\n- bridge\n- host\n- none\n- å®¹å™¨ç½‘ç»œæˆ–è”ç›Ÿç½‘ç»œ\n\n#### bridge\n\næ¡¥æ¥ç½‘ç»œæ˜¯æŒ‡å®¹å™¨é€šè¿‡æ¡¥æ¥çš„æ–¹å¼å°†**å®¹å™¨ç½‘å¡**æ¡¥æ¥åˆ°**å®¿ä¸»æœºçš„docker0ç½‘æ¡¥**ï¼Œç„¶ååœ¨é€šè¿‡å®¿ä¸»æœºé˜²ç«å¢™çš„NATè¡¨å®ç°ä¸å¤–ç½‘çš„è”ç³»ã€‚\n\n#### å®¿ä¸»æœºdocker0ç½‘æ¡¥\n\n```\n[root@docker ~]# ifconfig \n#docker0ç½‘æ¡¥\ndocker0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255\n        inet6 fe80::42:c7ff:fe37:8e8  prefixlen 64  scopeid 0x20<link>\n        ether 02:42:c7:37:08:e8  txqueuelen 0  (Ethernet)\n        RX packets 6618  bytes 277975 (271.4 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 8152  bytes 24675021 (23.5 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n.....çœç•¥äº†æœ¬æœºçš„ç½‘å¡ä¿¡æ¯\n#å®¹å™¨ç½‘å¡ï¼Œæ¯åˆ›å»ºä¸€ä¸ªæ¡¥æ¥ç½‘ç»œçš„å®¹å™¨å°±ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ç½‘å¡\nvethf75a942: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet6 fe80::9085:f5ff:fe34:77b5  prefixlen 64  scopeid 0x20<link>\n        ether 92:85:f5:34:77:b5  txqueuelen 0  (Ethernet)\n        RX packets 2850  bytes 158484 (154.7 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 3397  bytes 11613136 (11.0 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n        \n        \n        \nå¦‚æœæƒ³çœ‹æ›´æ¸…æ¥šä¸€ä¸‹  å¯ä»¥ä½¿ç”¨  ip  add  showå‘½ä»¤\n[root@docker ~]# ip add show\n\n4: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:c7:37:08:e8 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:c7ff:fe37:8e8/64 scope link \n       valid_lft forever preferred_lft forever\n\nå®¹å™¨ç½‘å¡\n14: vethf75a942@if13: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether 92:85:f5:34:77:b5 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet6 fe80::9085:f5ff:fe34:77b5/64 scope link \n       valid_lft forever preferred_lft forever\n\n\næ³¨æ„ï¼š\nè¿™é‡Œçš„vethf75a942@if13æŒ‡çš„å°±æ˜¯å®¹å™¨ç½‘å¡ï¼ŒVä»£è¡¨è™šæ‹Ÿç½‘å¡çš„æ„æ€ï¼Œeth ä»¥å¤ªç½‘å¡ï¼Œf75a942ç½‘å¡ç¼–å·ï¼Œif13æŒ‡çš„æ˜¯å®¿ä¸»æœºç½‘æ¡¥(docekr0)çš„ä¸€ä¸ªç«¯å£ï¼Œå¯¹åº”å®¹å™¨çš„ç½‘å¡ç¼–å·åŠ ä¸€ã€‚\næ‰€ä»¥å®¹å™¨å†…çš„ç½‘å¡ç¼–å·åº”è¯¥æ˜¯ eth0@if14\n\né€šè¿‡åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤  ip add show ä¹Ÿå¯ä»¥çœ‹åˆ°\n[root@docker ~]# docker exec a5f ip add show\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n13: eth0@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n```\n\n#### é˜²ç«å¢™çš„NATè¡¨å†…å®¹\n\n```\n[root@docker ~]# iptables -t nat -L\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nDOCKER     all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL\n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \nDOCKER     all  --  anywhere            !loopback/8           ADDRTYPE match dst-type LOCAL\n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nMASQUERADE  all  --  172.17.0.0/16        anywhere            \n\nChain DOCKER (2 references)\ntarget     prot opt source               destination         \nRETURN     all  --  anywhere             anywhere        \n```\n\n#### docker0 ä¸å®¹å™¨ç½‘å¡æ¡¥æ¥\n\n```\né€šè¿‡brctl showå‘½ä»¤å¯ä»¥çœ‹åˆ°å®¹å™¨ç½‘å¡å’Œdocker0ç½‘å¡çš„æ¡¥æ¥ä¿¡æ¯\n[root@docker ~]# brctl show\nbridge name\tbridge id\t\tSTP enabled\tinterfaces\ndocker0\t\t8000.0242c73708e8\tno\t\tvethf75a942\n```\n\n**åˆ›å»ºä¸€ä¸ªç½‘ç»œä¸ºbridgeç±»å‹çš„å®¹å™¨ï¼Œä¸æŒ‡å®šé»˜è®¤ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹**\n\n```\n[root@docker ~]# docker run -d --network bridge --name centos1 baishuming2020/centos_nginx\n```\n\n### host\n\n**å®¹å™¨å’ŒçœŸæœºå…±ç”¨ç½‘å¡åŠå¯¹åº”çš„ç«¯å£ï¼Œç¼ºç‚¹å°±æ˜¯åŒä¸€ä¸ªç«¯å£åªèƒ½å®¿ä¸»æœºæˆ–è€…æŸä¸ªå®¹å™¨ä½¿ç”¨ï¼Œå…¶ä»–å®¹å™¨ä¸èƒ½ç”¨ã€‚**\n\n```\nåˆ›å»ºä¸€ä¸ªç½‘ç»œç±»å‹hostçš„å®¹å™¨\n[root@docker ~]# docker run -d --network host --name centos2 baishuming2020/centos_nginx\n```\n\n### none\n\n**å®¹å™¨ä»…æœ‰loç½‘å¡ï¼Œæ˜¯ä¸€ä¸ªä¸èƒ½è”ç½‘çš„æœ¬åœ°å®¹å™¨**\n\n```\nåˆ›å»ºä¸€ä¸ªç½‘ç»œç±»å‹ä¸ºloçš„å®¹å™¨\n[root@docker ~]# docker run -d --network none --name centos3 baishuming2020/centos_nginx\n```\n\n### å®ç°ç½‘æ¡¥ç½‘ç»œ\n\nç›®çš„ï¼šä¸åŒçš„æœåŠ¡å®¹å™¨ç»„åº”ç”¨ä¸åŒçš„ç½‘æ¡¥ï¼Œé¿å…åŒä¸€ç½‘ç»œå†…å®¹å™¨å¤ªå¤šï¼Œä¿æŒå®¹å™¨ç½‘ç»œç‹¬ç«‹æ€§ã€‚\n\nå…³äºæ–°ç½‘æ¡¥è”ç½‘é—®é¢˜ï¼šåˆ›å»ºç½‘æ¡¥åï¼Œå®¿ä¸»æœºä¼šè‡ªåŠ¨å¸®ä½ åšNATï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒè”ç½‘é—®é¢˜\n\n#### æŸ¥çœ‹ç½‘ç»œ-ls\n\n```\n[root@docker ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\n80982d2613cd        bridge              bridge              local\n40c179ab420a        docker1             bridge              local\n04aadb7475c0        docker100           bridge              local\nce79e9d7525a        host                host                local\n8f0358469e57        none                null                local\n\nNETWORK ID     ç½‘æ¡¥ID   \nNAME          \t åç§°\nDRIVER        \t ç½‘ç»œç±»å‹  \nSCOPE\t   \t   ä½œç”¨èŒƒå›´\n```\n\n#### åˆ›å»ºç½‘æ¡¥-create\n\n```\n[root@docker ~]# docker network create -d bridge --subnet 192.168.148.0/24 --gateway 192.168.148.2 a1\n6a410e27b66ea587142d967f7dff6f36c04ced3c27116a79831412f3743aba56\n\n[root@docker ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\n6ee1e928b710        bridge              bridge              local\nce79e9d7525a        host                host                local\n6a410e27b66e        mydocker0           bridge              local\n8f0358469e57        none                null                local\n\n\nä¿®æ”¹dockerç½‘æ¡¥åå­—\n1ã€ä¿®æ”¹åå­—\n[root@docker ~]# docker network rename old_name new_name\n2ã€é‡å¯dockeræœåŠ¡\n[root@docker ~]# systemctl restart docker\n```\n\n#### åˆ é™¤æœªä½¿ç”¨çš„ç½‘æ¡¥-prune\n\n```\n[root@docker ~]# docker network prune \nWARNING! This will remove all networks not used by at least one container.\nAre you sure you want to continue? [y/N] y\nDeleted Networks:\ndocker1\n```\n\n#### åˆ é™¤æŸä¸ªç½‘æ¡¥-rm\n\n```\n[root@docker ~]# docker network rm docker100\ndocker100\n\næ³¨æ„ï¼š\nä¸èƒ½è¢«æ´»åŠ¨å®¹å™¨å ç”¨\n```\n\n#### å®¹å™¨è¿æ¥åˆ°ç½‘æ¡¥\n\nå‰ææ˜¯è¯¥å®¹å™¨æ˜¯æ¡¥æ¥ç½‘ç»œ\n\n```\ndocker network connect ç½‘å¡ å®¹å™¨\n[root@docker ~]# docker network connect docker1 centos1\n[root@docker ~]# docker exec centos1 ifconfig\neth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255\n        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)\n        RX packets 8  bytes 656 (656.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\nå‘ç°centos1å®¹å™¨å¤šäº†ä¸€å—ç½‘å¡ï¼Œä½¿ç”¨çš„æ­£æ˜¯docker1çš„ç½‘æ®µ\neth1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.1.2  netmask 255.255.255.0  broadcast 192.168.1.255\n        ether 02:42:c0:a8:01:02  txqueuelen 0  (Ethernet)\n        RX packets 16  bytes 1312 (1.2 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n```\n\n#### å®¹å™¨æ–­å¼€ç½‘æ¡¥\n\n```\nå°†centos1å®¹å™¨çš„ç½‘ç»œä»docker1ç½‘æ¡¥æ–­å¼€\n[root@docker ~]# docker network disconnect docker1 centos1\n```\n\n### å¸¸è§æ•…éšœ\n\n#### FAQ1ï¼šä½¿ç”¨æ”¹ååçš„æ–°ç½‘æ¡¥çš„å®¹å™¨å¯èƒ½æ— æ³•è§£æåŸŸå\n\nåŸå› ï¼šæ²¡æœ‰é…ç½®æ–°ç½‘æ¡¥çš„DNS\n\nè§£å†³æ–¹æ³•ï¼šä¸ºå®¹å™¨æ‰‹åŠ¨é…ç½®ä¸€ä¸ªDNSåœ°å€å³å¯\n\n#### FAQ2ï¼šNetworking will not work\n\n```\n[root@docker ~]# docker run -d --network docker100 --name centos4 baishuming2020/centos_nginx\nWARNING: IPv4 forwarding is disabled. Networking will not work.\n67f2c276123c993cd66b9d7a99ba22402331a13f9ea8817e57324a934896b805\n\nè§£å†³æ–¹æ¡ˆ\n1ã€æ‰“å¼€è½¬å‘\n[root@docker ~]# echo \"net.ipv4.ip_forward=1\" >>  /usr/lib/sysctl.d/00-system.conf\n\n2ã€é‡å¯ç½‘ç»œ\n[root@docker ~]# systemctl restart network\n```\n\n### ä¸åŒä¸»æœºé—´çš„å®¹å™¨é€šä¿¡\n\n#### macvlan\n\nåœ¨ Docker ä¸­ï¼Œmacvlan æ˜¯ä¼—å¤š Docker ç½‘ç»œæ¨¡å‹ä¸­çš„ä¸€ç§ï¼Œå¹¶ä¸”æ˜¯ä¸€ç§è·¨ä¸»æœºçš„ç½‘ç»œæ¨¡å‹ï¼Œä½œä¸ºä¸€ç§é©±åŠ¨å¯ç”¨ï¼ŒDocker macvlan åªæ”¯æŒ bridge æ¨¡å¼\n\n```\n#macvlan éœ€è¦ä¸€å—ç‹¬ç«‹çš„ç½‘å¡æ¥è¿›è¡Œä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ–°æ·»åŠ ä¸€å—ç½‘å¡\n\ndocker network create -d macvlan --subnet=172.16.10.0/24 --gateway=172.16.10.1  -o parent=ens224  mtacvlan-1\n\n-o parent=ç½‘å¡åç§°  æŒ‡å®šç”¨æ¥ç»™ macvlan ç½‘ç»œä½¿ç”¨çš„ç‰©ç†ç½‘å¡\n\næ³¨æ„ï¼Œè¦åœ¨æ‰€æœ‰éœ€è¦è¿è¡Œ macvlan çš„ä¸»æœºä¸Šæ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼Œä½†æ˜¯è¦è®°å¾—æ›´æ”¹ç½‘å…³çš„åœ°å€ï¼Œé¿å…é€ æˆIPå†²çª\n\ndocker run -itd --network macvlan-1 centos /bin/bash\n```\n\n#### overlay\n\nåœ¨ Docker ä¸­ï¼Œoverlay æ˜¯ä¼—å¤š Docker ç½‘ç»œæ¨¡å‹ä¸­çš„ä¸€ç§ï¼Œå¹¶ä¸”æ˜¯ä¸€ç§è·¨ä¸»æœºçš„å…¨å±€ç½‘ç»œæ¨¡å‹ï¼Œæœ‰ä¸€ä¸ªæ•°æ®åº“ä¸“é—¨çš„æ¥å­˜å‚¨ç½‘ç»œåˆ†é…ä¿¡æ¯ï¼Œé¿å… IP å†²çªï¼ŒåŒæ—¶å†…éƒ¨è¿˜æœ‰ä¸€ä¸ªå°å‹çš„ DNS æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ä¸»æœºåè¿›è¡Œè®¿é—®\n\n```\nconsul æœåŠ¡ç«¯ï¼š\ndocker run -itd -h consul --name consul --restart=always -p 8500:8500 progrium/consul -server -bootstrap\n\n-h \t\t\t\tä¸»æœºå\nâ€“name \t\t\tå®¹å™¨å\nâ€“restart=always é‡å¯ç­–ç•¥\nprogrium/consul é•œåƒåç§°\n-server \t\tä»¥æœåŠ¡èŠ‚ç‚¹å¯åŠ¨\n-bootstrap\t\té¢„æœŸçš„å¯åŠ¨èŠ‚ç‚¹æ•°ï¼šè‡ªä¸¾\n\nåœ¨æµè§ˆå™¨å†…è¾“å…¥ IPåœ°å€+ç«¯å£å· å¯ä»¥çœ‹åˆ° web é¡µé¢\n\nåœ¨æ‰€æœ‰ä¸»æœºä¸Šç¼–è¾‘ daemon.json æ–‡ä»¶ï¼š\n{\n\"hosts\": [\"tcp://0.0.0.0:2375\",\"unix:///var/run/docker.sock\"]ï¼Œ ç›‘å¬ç›¸å…³ç«¯å£\n\"cluster-store\":\"consul://192.168.1.150:8500\",\t\t   é›†ç¾¤çš„ä¸»æœºåœ°å€\n\"cluster-advertise\":\"192.168.1.150:2375â€\t\tå®£å‘Šè‡ªå·±çš„åœ°å€ \n}\n\né‡å¯ docker æœåŠ¡\n\nåˆ›å»º overlay ç½‘ç»œï¼ˆå…¨å±€ç½‘ç»œï¼‰ï¼šä¸€å°ä¸»æœºä¸Šåˆ›å»ºè‡ªåŠ¨åŒæ­¥\n\n\tdocker network create -d overlay overlay-1\n\nå¯åŠ¨å®¹å™¨æµ‹è¯•ï¼š\n\n\tdocker run -it --name docker-1 --network=overlay-1 centos /bin/bash\n\t\n\tdocker run -it --name docker-2 --network=overlay-1 centos /bin/bash\n\t\néªŒè¯ï¼šping docker-1\n```\n\n### å¸¸è§æ•…éšœ\n\nå¦‚å‘ç°å„å®¹å™¨å†…åˆ†é…çš„ipä¹‹é—´ç›¸äº’pingä¸é€š\n\n```\nåŸå› ï¼šå¯èƒ½ç”±äºé˜²ç«å¢™é—®é¢˜å¼•èµ·çš„,é»˜è®¤forwardé“¾æ˜¯dropçŠ¶æ€ï¼Œéœ€è¦æ‰“å¼€æ‰å¯ä»¥\n\n\nè§£å†³æ–¹æ¡ˆ:\næ‰§è¡Œä¸‹é¢æ“ä½œï¼Œä¿è¯INPUT  FORWARDé“¾éƒ½æ˜¯ACCEPTçŠ¶æ€\næ¸…é™¤å…¶ä»–è§„åˆ™\n[root@docker_node1 ~]# iptables -P INPUT ACCEPT\n[root@docker_node1 ~]# iptables -P FORWARD ACCEPT\n[root@docker_node1 ~]# iptables -F\n[root@docker_node1 ~]# iptables -L -n\n\n\n[root@docker_node2 ~]# iptables -P INPUT ACCEPT\n[root@docker_node2 ~]# iptables -P FORWARD ACCEPT\n[root@docker_node2 ~]# iptables -F\n[root@docker_node2 ~]# iptables -L -n\n```\n\n## Dockerç§æœ‰ä»“åº“\n\nåœ¨Dockerä¸­ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ docker pull xxx çš„æ—¶å€™ ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä» hub.docker.com è¿™ä¸ªåœ°å€å»æŸ¥æ‰¾ï¼Œè¿™å°±æ˜¯ Docker å…¬å¸ä¸ºæˆ‘ä»¬æä¾›çš„å…¬å…±ä»“åº“ã€‚åœ¨å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æŠŠä¼ä¸šé¡¹ç›® push åˆ°å…¬æœ‰ä»“åº“è¿›è¡Œç®¡ç†ã€‚æ‰€ä»¥ä¸ºäº†æ›´å¥½çš„ç®¡ç†é•œåƒï¼ŒDocker ä¸ä»…æä¾›äº†ä¸€ä¸ªä¸­å¤®ä»“åº“ï¼ŒåŒæ—¶ä¹Ÿå…è®¸æˆ‘ä»¬æ­å»ºæœ¬åœ°ç§æœ‰ä»“åº“ã€‚\n\ndockerå®¹å™¨é•œåƒä»“åº“åˆ†ç±»ï¼š\n\n- å…¬ç½‘ä»“åº“ï¼šdocker hub\n- ç§ç½‘ä»“åº“: registryã€harbor\n\n### éƒ¨ç½²æ­¥éª¤\n\næ‹‰å–registryé•œåƒ\n\n```\ndocker pull registry \n```\n\nåˆ›å»ºregistryä»“åº“å®¹å™¨\n\n```\n1ã€åˆ›å»ºæŒä¹…åŒ–å­˜å‚¨ï¼Œå°†å®¹å™¨é•œåƒå­˜å‚¨ç›®å½•/var/lib/registry\næŒ‚è½½åˆ°æœ¬åœ°/opt/qyckä¸‹ï¼š\n\nmkdir /opt/qyck\n\n2ã€åˆ›å»º registry å®¹å™¨ï¼š\n\ndocker run -itd -p 5000:5000 \\\n-v /opt/qyck:/var/lib/registry  \\\n--restart=always registry:latest\n\n3ã€æŸ¥çœ‹å®¹å™¨æ˜¯å¦è¿è¡Œ\n[root@qyck ~]# docker ps\nCONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS         PORTS                                       NAMES\nd1ea79cc023f   registry:latest   \"/entrypoint.sh /etcâ€¦\"   10 seconds ago   Up 9 seconds   0.0.0.0:5000->5000/tcp, :::5000->5000/tcp   trusting_gates\n\n```\n\næµ‹è¯•å®¹å™¨åº”ç”¨\n\n```\n[root@zutuanxue_manage01 ~]# curl 192.168.48.128:5000/v2/_catalog\n{\"repositories\":[]}\n\næ˜¾ç¤ºä»“åº“ä¸­æ²¡æœ‰ä»»ä½•é•œåƒ\n```\n\n### ä¸Šä¼ é•œåƒ\n\næµ‹è¯•ï¼šæ‹‰å–nginxé•œåƒ\n\n```\ndocker pull nginx\n[root@qyck ~]# docker images\nREPOSITORY   TAG       IMAGE ID       CREATED       SIZE\nregistry     latest    65f3b3441f04   9 days ago    24MB\nnginx        latest    448a08f1d2f9   2 weeks ago   142MB\n\n```\n\nè®¾ç½®dockerä»“åº“ä¸ºregistryæœ¬åœ°ä»“åº“\n\n```\n#1ã€ä¿®æ”¹dockerè¿›ç¨‹å¯åŠ¨æ–‡ä»¶ï¼Œä¿®æ”¹å…¶å¯åŠ¨æ–¹å¼ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©é€šè¿‡dockeré…ç½®æ–‡ä»¶å¯åŠ¨\n[root@qyck ~]# sed -i.bak '/^ExecStart=/c\\ExecStart=\\/usr\\/bin\\/dockerd' /usr/lib/systemd/system/docker.service\n\n#2ã€è®¾ç½®docker å®ˆæŠ¤è¿›ç¨‹çš„é…ç½®æ–‡ä»¶ /etc/docker/daemon.json,é»˜è®¤æ²¡æœ‰è¯¥æ–‡ä»¶\n[root@qyck ~]# cat /etc/docker/daemon.json \n{\n \"insecure-registries\": [\"http://192.168.48.128:5000\"]\n}\n\ninsecure-registries æŒ‡å®šéå®‰å…¨çš„ä»“åº“åœ°å€ï¼Œå¤šä¸ªç”¨é€—å·éš”å¼€\n\n#3ã€é‡å¯dockerç”Ÿæ•ˆé…ç½®æ–‡ä»¶\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\nå°†é•œåƒæ‰“tag\n\n```\n[root@qyck ~]# docker tag nginx:latest 192.168.48.128:5000/nginx:v1\n[root@qyck ~]# docker images\nREPOSITORY                  TAG       IMAGE ID       CREATED       SIZE\n192.168.48.128:5000/nginx   v1        448a08f1d2f9   2 weeks ago   142MB\n```\n\næ¨é€é•œåƒåˆ°ä»“åº“\n\n```\n[root@qyck ~]# docker push 192.168.48.128:5000/nginx:v1\nThe push refers to repository [192.168.48.128:5000/nginx]\n1040838fe30e: Pushed\n93ee76f39c97: Pushed\n5684be535bf1: Pushed\n6bc8ae8fb3cf: Pushed\na29cc9587af6: Pushed\n8553b91047da: Pushed\nv1: digest: sha256:3f01b0094e21f7d55b9eb7179d01c49fdf9c3e1e3419d315b81a9e0bae1b6a90 size: 1570\n\n\n#2ã€æŸ¥çœ‹ä¸Šä¼ \n[root@qyck ~]# curl http://192.168.48.128:5000/v2/_catalog\n{\"repositories\":[\"nginx\"]}\n\n#æŸ¥çœ‹å­˜å‚¨æ–‡ä»¶å¤¹\n[root@qyck ~]# ls /opt/qyck/docker/registry/v2/repositories/\nnginx\n\n```\n\n### æ‹‰å–é•œåƒ\n\nåœ¨å¦å¤–ä¸€å°æœºæ‹‰å–nginxé•œåƒ\n\n```\n#1ã€è®¾ç½®dockerå¯åŠ¨æ–‡ä»¶\n[root@zutuanxue_node1 ~]# sed -i.bak '/^ExecStart=/c\\ExecStart=\\/usr\\/bin\\/dockerd' /usr/lib/systemd/system/docker.service\n\n#2ã€è®¾ç½®dockeré…ç½®æ–‡ä»¶\n[root@zutuanxue_node1 ~]# cat  /etc/docker/daemon.json \n{\n \"insecure-registries\": [\"http://192.168.48.128:5000\"]\n}\n\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\næ‹‰å–é•œåƒ\n\n```\n[root@qyck ~]# docker pull 192.168.48.128:5000/nginx:v1\nv1: Pulling from nginx\n9e3ea8720c6d: Pull complete\nbf36b6466679: Pull complete\n15a97cf85bb8: Pull complete\n9c2d6be5a61d: Pull complete\n6b7e4a5c7c7a: Pull complete\n8db4caa19df8: Pull complete\nDigest: sha256:3f01b0094e21f7d55b9eb7179d01c49fdf9c3e1e3419d315b81a9e0bae1b6a90\nStatus: Downloaded newer image for 192.168.48.128:5000/nginx:v1\n192.168.48.128:5000/nginx:v1\n[root@qyck ~]# docker images\nREPOSITORY                  TAG       IMAGE ID       CREATED       SIZE\nregistry                    latest    65f3b3441f04   9 days ago    24MB\n192.168.48.128:5000/nginx   v1        448a08f1d2f9   2 weeks ago   142MB\n\n\n```\n\n\n\n## Dockerå­¦ä¹ æ€»ç»“\n\n![1](../img/Docker node/f8242ed25c3cc4a0f16a604d1d53b5f885684b49.png)\n\n## docker run å‚æ•°è§£æ\n\n```\n-d: åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›\n\n-i: ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›\n\n-P: éšæœºç«¯å£æ˜ å°„ï¼Œå®¹å™¨å†…éƒ¨ç«¯å£éšæœºæ˜ å°„åˆ°ä¸»æœºçš„ç«¯å£\n\n-p: æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£\n\n-t: ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›\n\n--name=\"nginx-lb\": ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›\n\n--dns 8.8.8.8: æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›\n\n--dns-search example.com: æŒ‡å®šå®¹å™¨DNSæœç´¢åŸŸåï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›\n\n-h \"mars\": æŒ‡å®šå®¹å™¨çš„hostnameï¼›\n\n-e username=\"ritchie\": è®¾ç½®ç¯å¢ƒå˜é‡ï¼›\n\n--env-file=[]: ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ç¯å¢ƒå˜é‡ï¼›\n\n--cpuset=\"0-2\" or --cpuset=\"0,1,2\": ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šCPUè¿è¡Œï¼›\n\n-m :è®¾ç½®å®¹å™¨ä½¿ç”¨å†…å­˜æœ€å¤§å€¼ï¼›\n\n--net=\"bridge\": æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridge/host/none/container: å››ç§ç±»å‹ï¼›\n\n--link=[]: æ·»åŠ é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼›\n\n--expose=[]: å¼€æ”¾ä¸€ä¸ªç«¯å£æˆ–ä¸€ç»„ç«¯å£ï¼›\n\n--volume , -v: ç»‘å®šä¸€ä¸ªå·\n```\n\n\n\næ­¤ç¬”è®°å‚è€ƒ [å¼€æ‘†å·¥ä½œå®¤](https://blog.kbai.cc/)/[DockeråŸºç¡€](https://blog.kbai.cc/2022/04/25/Docker%20%E5%9F%BA%E7%A1%80/#%F0%9F%9A%80Docker%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93)ç²¾å¿ƒæ•´ç†\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Docker"],"categories":["ç¬”è®°"]},{"title":"Hadoopéƒ¨ç½²","url":"/posts/32436/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Hadoopéƒ¨ç½²\n\næœ¬ç¬”è®°åˆ†ä¼ªåˆ†å¸ƒå’Œåˆ†å¸ƒå¼ä¸¤å¤§å—ï¼Œä½†å»ºè®®ä»å¤´å¼€å§‹è§‚çœ‹\n\næ–‡ç« æ‰€éœ€èµ„æºå¯[ç‚¹å‡»è¿™é‡Œ](https://pan.quark.cn/s/a2886f170a7f)ä¸‹è½½\n\n## ä¼ªåˆ†å¸ƒ\n\nå•èŠ‚ç‚¹ masteryjx48 ï¼ˆCentos 7.9ï¼‰\n\n| åç§°        | ip1ï¼ˆNATï¼‰    | å†…å­˜ | ç¡¬ç›˜ |\n| ----------- | ------------- | ---- | ---- |\n| masteryjx48 | 192.168.48.11 | 5G   | 100G |\n\n### åŸºæœ¬é…ç½®\n\næœ¬åœ°yumé…ç½®ï¼Œè‡ªè¡ŒæŒ‚è½½æœ¬åœ°Centos7.9é•œåƒ\n\n```\nmkdir repo.bak\nmv /etc/yum.repos.d/* repo.bak/\nmount /dev/cdrom /mnt\ncat >>/etc/yum.repos.d/local.repo<<EOF\n[local]\nname=local\nbaseurl=file:///mnt\ngpgcheck=0\nenabled=1\nEOF\nyum clean all && yum makecache\nsystemctl disable firewalld --now\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux\n```\n\n### æ›´æ”¹hosts\n\n```\necho \"192.168.48.11 masteryjx48\" >> /etc/hosts\n```\n\n### é…ç½®ä¸»æœºå\n\n```\nhostnamectl set-hostname masteryjx48 && bash\n```\n\n### é…ç½®sshå…å¯†ç™»å…¥\n\n```\nssh-keygen -t rsa\ncat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys\nssh-copy-id masteryjx48\nssh masteryjx48\nexit\n```\n\n### å®‰è£…JAVAç¯å¢ƒ\n\n```\nmkdir /usr/lib/jvm\ntar -xf /root/jdk-8u162-linux-x64.tar.gz -C /usr/lib/jvm\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162\" >> /etc/profile\necho \"export PATH=\\$JAVA_HOME/bin:\\$PATH\" >> /etc/profile\nsource /etc/profile\njava -version\n```\n\n### å®‰è£…Hadoop\n\n```\ntar -zxf hadoop-3.1.3.tar.gz -C /usr/local\nmv /usr/local/hadoop-3.1.3/ /usr/local/hadoop\necho \"export HADOOP_HOME=/usr/local/hadoop\" >> /etc/profile\necho \"export PATH=\\$HADOOP_HOME/bin/:\\$HADOOP_HOME/sbin/:\\$PATH\" >> /etc/profile\nsource /etc/profile\nhadoop version\n```\n\næ‰“ä¸ªå¿«ç…§ï¼Œæ–¹ä¾¿åšåˆ†å¸ƒå¼éƒ¨ç½²,åšåˆ†å¸ƒå¼çš„ç›´æ¥è·³åˆ°2.åˆ†å¸ƒå¼\n\n### ç¼–å†™é…ç½®æ–‡ä»¶\n\n#### ç¼–å†™cort-site.yamlæ–‡ä»¶\n\n```\n[root@masteryjx48 ~]# cat /usr/local/hadoop/etc/hadoop/core-site.xml\n<configuration>\n    <property>\n        <name>hadoop.tmp.dir</name>\n        <value>file:/usr/local/hadoop/tmp</value>\n        <description>Abase for other temporary directories.</description>\n    </property>\n    <property>\n        <name>fs.defaultFS</name>\n        <value>hdfs://masteryjx48:9000</value>\n    </property>\n</configuration>\n```\n\n#### ç¼–å†™hdfs-site.xml\n\n```\n[root@masteryjx48 ~]# cat /usr/local/hadoop/etc/hadoop/hdfs-site.xml\n<configuration>\n    <property>\n        <name>dfs.replication</name>\n        <value>1</value>\n    </property>\n    <property>\n        <name>dfs.namenode.name.dir</name>\n        <value>file:/usr/local/hadoop/tmp/dfs/name</value>\n    </property>\n    <property>\n        <name>dfs.datanode.data.dir</name>\n        <value>file:/usr/local/hadoop/tmp/dfs/data</value>\n    </property>\n</configuration>\n```\n\n### å¯åŠ¨hdfsæœåŠ¡\n\n```\nhdfs namenode -format\n```\n\n### æ·»åŠ ç¯å¢ƒå˜é‡\n\n```\necho \"export HDFS_NAMENODE_USER=root\" >> /etc/profile\necho \"export HDFS_DATANODE_USER=root\" >> /etc/profile\necho \"export HDFS_SECONDARYNAMENODE_USER=root\" >> /etc/profile\necho \"export YARN_RESOURCEMANAGER_USER=root\" >> /etc/profile\necho \"export YARN_NODEMANAGER_USER=root\" >> /etc/profile\nsource /etc/profile\n```\n\n### ä¿®æ”¹hadoopé…ç½®æ–‡ä»¶\n\n```\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162\" >> /usr/local/hadoop/etc/hadoop/hadoop-env.sh\n```\n\n### å¯åŠ¨hadoopæœåŠ¡\n\n```\n[root@masteryjx48 ~]# start-all.sh\nStarting namenodes on [masteryjx48]\nLast login: Thu Mar  9 07:12:02 CST 2023 on pts/0\nStarting datanodes\nLast login: Thu Mar  9 07:14:08 CST 2023 on pts/0\nStarting secondary namenodes [masteryjx48]\nLast login: Thu Mar  9 07:14:11 CST 2023 on pts/0\nStarting resourcemanager\nLast login: Thu Mar  9 07:14:15 CST 2023 on pts/0\nStarting nodemanagers\nLast login: Thu Mar  9 07:14:20 CST 2023 on pts/0\n\n```\n\nå…³é—­hadoopæœåŠ¡  stop-dfs.sh \n\n### å¯åŠ¨historyserveræœåŠ¡\n\n```\nmr-jobhistory-daemon.sh start historyserver\n```\n\n### æŸ¥çœ‹javaè¿›ç¨‹\n\n```\n[root@masteryjx48 ~]# jps\n9280 ResourceManager\n8785 DataNode\n9443 NodeManager\n9014 SecondaryNameNode\n8599 NameNode\n11127 Jps\n11034 JobHistoryServer\n```\n\n### è®¿é—®ç½‘é¡µip:9870æŸ¥çœ‹hdfs\n\n![image-20230308231858685](../img/Hadoop/cb7e7cebcd11b82c8393eb37e88631c1087202ed.png)\n\n### è®¿é—®ç½‘é¡µip:8088æŸ¥çœ‹hadoop\n\n![image-20230308232003637](../img/Hadoop/afb72b93d2cbcea5b9201e4809dc3b738bcf4a88.png)\n\n## åˆ†å¸ƒå¼\n\nâ—â—â—â—è¿™é‡Œå°±å…‹éš†å‰é¢åˆ›å»ºå¥½çš„å¿«ç…§ï¼ˆ1.6æ­¥éª¤ï¼‰ï¼Œä¿®æ”¹å¥½ip\n\n| ä¸»æœº   | ip            | ç³»ç»Ÿå’Œè½¯ä»¶        | å†…å­˜ |\n| ------ | ------------- | ----------------- | ---- |\n| master | 192.168.48.11 | Centos7.9ã€Hadoop | 5G   |\n| slave1 | 192.168.48.12 | Centos7.9ã€Hadoop | 5G   |\n\n### ç¯å¢ƒé…ç½®\n\nä¿®æ”¹hosts æŠŠä¹‹å‰æ·»åŠ çš„åˆ æ‰\n\nmaster\n\n```\nhostnamectl set-hostname master\nbash\n```\n\nslave1\n\n```\nhostnamectl set-hostname slave1\nbash\necho \"192.168.48.11 master\" >> /etc/hosts\necho \"192.168.48.12 slave1\" >> /etc/hosts\nscp /etc/hosts root@master:/etc/hosts\n```\n\n### SSHå…å¯†ç™»å…¥è®¾ç½®\n\nmaster\n\n```\nssh-keygen -t rsa\ncat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys\nssh master\nexit\nssh-copy-id -i root@slave1\nssh slave1\nll\nexit\n```\n\nslave1\n\n```\nssh-keygen -t rsa\ncat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys\nssh slave1\nexit\nssh-copy-id -i root@master\nssh master\nll\nexit\n```\n\n### æ£€æŸ¥javaå’Œhadoopç¯å¢ƒ\n\n```\nmaster\n[root@master ~]# java -version\njava version \"1.8.0_162\"\nJava(TM) SE Runtime Environment (build 1.8.0_162-b12)\nJava HotSpot(TM) 64-Bit Server VM (build 25.162-b12, mixed mode)\n[root@master ~]# hadoop version\nHadoop 3.1.3\nSource code repository https://gitbox.apache.org/repos/asf/hadoop.git -r ba631c436b806728f8ec2f54ab1e289526c90579\nCompiled by ztang on 2019-09-12T02:47Z\nCompiled with protoc 2.5.0\nFrom source with checksum ec785077c385118ac91aadde5ec9799\nThis command was run using /usr/local/hadoop/share/hadoop/common/hadoop-common-3.1.3.jar\n\nslave1\n\n[root@slave1 ~]# java -version\njava version \"1.8.0_162\"\nJava(TM) SE Runtime Environment (build 1.8.0_162-b12)\nJava HotSpot(TM) 64-Bit Server VM (build 25.162-b12, mixed mode)\n\n[root@slave1 ~]# hadoop version\nHadoop 3.1.3\nSource code repository https://gitbox.apache.org/repos/asf/hadoop.git -r ba631c436b806728f8ec2f54ab1e289526c90579\nCompiled by ztang on 2019-09-12T02:47Z\nCompiled with protoc 2.5.0\nFrom source with checksum ec785077c385118ac91aadde5ec9799\nThis command was run using /usr/local/hadoop/share/hadoop/common/hadoop-common-3.1.3.jar\n```\n\n### ä¿®æ”¹é…ç½®æ–‡ä»¶\n\nä¿®æ”¹workersé…ç½®æ–‡ä»¶\n\n```\n[root@master hadoop]# cd /usr/local/hadoop/etc/hadoop\n[root@master hadoop]# cat workers\nslave1\n```\n\nä¿®æ”¹core-site.xml\n\n```\n[root@master hadoop]# cat core-site.xml\n<configuration>\n        <property>\n                <name>fs.defaultFS</name>\n                <value>hdfs://master:9000</value>\n        </property>\n        <property>\n                <name>hadoop.tmp.dir</name>\n                <value>file:/usr/local/hadoop/tmp</value>\n                <description>Abase for other temporary directories.</description>\n        </property>\n</configuration>\n```\n\nä¿®æ”¹hdfs-site.xml\n\n```\n[root@master hadoop]# cat hdfs-site.xml\n<configuration>\n        <property>\n                <name>dfs.namenode.secondary.http-address</name>\n                <value>master:50090</value>\n        </property>\n        <property>\n                <name>dfs.replication</name>\n                <value>1</value>\n        </property>\n        <property>\n                <name>dfs.namenode.name.dir</name>\n                <value>file:/usr/local/hadoop/tmp/dfs/name</value>\n        </property>\n        <property>\n                <name>dfs.datanode.data.dir</name>\n                <value>file:/usr/local/hadoop/tmp/dfs/data</value>\n        </property>\n</configuration>\n```\n\nä¿®æ”¹mapred-site.xmlé…ç½®æ–‡ä»¶\n\n```\n[root@master hadoop]# cat mapred-site.xml\n<configuration>\n        <property>\n                <name>mapreduce.framework.name</name>\n                <value>yarn</value>\n        </property>\n        <property>\n                <name>mapreduce.jobhistory.address</name>\n                <value>master:10020</value>\n        </property>\n        <property>\n                <name>mapreduce.jobhistory.webapp.address</name>\n                <value>master:19888</value>\n        </property>\n        <property>\n<name>yarn.app.mapreduce.am.env</name>\n<value>HADOOP_MAPRED_HOME=/usr/local/hadoop</value>\n</property>\n<property>\n<name>mapreduce.map.env</name>\n<value>HADOOP_MAPRED_HOME=/usr/local/hadoop</value>\n</property>\n<property>\n<name>mapreduce.reduce.env</name>\n<value>HADOOP_MAPRED_HOME=/usr/local/hadoop</value>\n</property>\n</configuration>\n```\n\nä¿®æ”¹yarn-site.xmlæ–‡ä»¶\n\n```\n[root@master hadoop]# cat yarn-site.xml\n<configuration>\n        <property>\n                <name>yarn.resourcemanager.hostname</name>\n                <value>master</value>\n        </property>\n        <property>\n                <name>yarn.nodemanager.aux-services</name>\n                <value>mapreduce_shuffle</value>\n        </property>\n</configuration>\n```\n\n### å°†ä¸Šè¿°é…ç½®æ‹·è´åˆ°slave1ä¸Š\n\nmaster\n\n```\ncd /usr/local/hadoop/etc/hadoop/\nscp core-site.xml slave1:/usr/local/hadoop/etc/hadoop/\nscp hdfs-site.xml slave1:/usr/local/hadoop/etc/hadoop/\nscp mapred-site.xml slave1:/usr/local/hadoop/etc/hadoop/\nscp workers slave1:/usr/local/hadoop/etc/hadoop/\nscp yarn-site.xml slave1:/usr/local/hadoop/etc/hadoop/\n```\n\n### ä¿®æ”¹ç¯å¢ƒå˜é‡æ‹·è´åˆ°slave1\n\nmaster\n\n```\necho \"export HDFS_NAMENODE_USER=root\" >> /etc/profile\necho \"export HDFS_DATANODE_USER=root\" >> /etc/profile\necho \"export HDFS_SECONDARYNAMENODE_USER=root\" >> /etc/profile\necho \"export YARN_RESOURCEMANAGER_USER=root\" >> /etc/profile\necho \"export YARN_NODEMANAGER_USER=root\" >> /etc/profile\nsource /etc/profile\nscp /etc/profile slave1:/etc/profile\nsource /etc/profile\n```\n\n### ä¿®æ”¹**hadoop**ç¯å¢ƒé…ç½®æ–‡ä»¶å¹¶å°†é…ç½®æ–‡ä»¶æ‹·è´åˆ°slave1\n\n```\necho \"export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162\" >> /usr/local/hadoop/etc/hadoop/hadoop-env.sh\n\nscp /usr/local/hadoop/etc/hadoop/hadoop-env.sh slave1:/usr/local/hadoop/etc/hadoop/hadoop-env.sh\n```\n\n### é›†ç¾¤é…ç½®å¯åŠ¨\n\nmasteråˆå§‹åŒ–\n\n```\nhdfs namenode -format\n```\n\n### å¯åŠ¨hadoop\n\n```\nstart-all.sh\n```\n\n### å¯åŠ¨historyserver\n\n```\nmr-jobhistory-daemon.sh start historyserver\n```\n\n### æŸ¥çœ‹javaè¿›ç¨‹\n\n```\n[root@master hadoop]# jps\n35863 ResourceManager\n2841 JobHistoryServer\n39065 NameNode\n39771 Jps\n35597 SecondaryNameNode\n```\n\n```\n[root@slave1 ~]# jps\n5587 NodeManager\n5492 DataNode\n6215 Jps\n```\n\n\n\n![image-20230309000335285](../img/Hadoop/a4c2ec34465b36c3404a54688306cca6070cba87.png)\n\n![image-20230309002207394](../img/Hadoop/a8202fe3fd3b0a107d68473e2086601457d6aac4.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Centos 7","Hadoop"],"categories":["è¿ç»´"]},{"title":"Shell","url":"/posts/24229/","content":"\n<meta name=\"referrer\" content=\"no-referrer\"/>\n\n# Shell\n\n## æ¦‚è¿°\n\nShellæ˜¯ä¸€ä¸ª<span style=\"color:red;\">å‘½ä»¤è¡Œè§£é‡Šå™¨</span>ï¼Œä»–æ¥æ”¶åº”ç”¨ç¨‹åº/ç”¨æˆ·å‘½ä»¤ï¼Œç„¶åè°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸\n\n![image-20230125165047995](../img/Shell/b8682c9a5af9d2af835aa15626c8789178af345a.png)\n\nShellè¿˜æ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å½“å¼ºå¤§çš„ç¼–è¾‘è¯­è¨€ï¼Œæ˜“ç¼–å†™ï¼Œæ˜“è°ƒè¯•ï¼Œçµæ´»æ€§å¼ºã€‚\n\n## Shellè§£æå™¨\n\n### Linuxæä¾›çš„Shellè§£æå™¨æœ‰6ç§ï¼š\n\n```\n[root@Shell ~]# cat /etc/Shells\n/bin/sh\n/bin/bash\n/usr/bin/sh\n/usr/bin/bash\n/bin/tcsh\n/bin/csh\n```\n\n### bashå’Œshçš„å…³ç³»æ˜¯\n\n```\n[root@Shell ~]# ll /bin/ | grep bash\n-rwxr-xr-x. 1 root root     964536 4æœˆ   1 2020 bash\nlrwxrwxrwx. 1 root root          4 9æœˆ  28 07:56 sh -> bash\nè½¯è¿æ¥\n```\n\n### Centosé»˜è®¤çš„è§£æå™¨æ˜¯bash\n\n```\n[root@Shell ~]# echo $Shell\n/bin/bash\n```\n\n## Shellè„šæœ¬å…¥é—¨\n\n### è„šæœ¬æ ¼å¼\n\nè„šæœ¬ä»¥<span style=\"color:red;\">#!/bin/bash</span>å¼€å¤´ï¼ˆæŒ‡å‘è§£æå™¨ï¼‰\n\n### ç¬¬ä¸€ä¸ªShellè„šæœ¬ï¼šhelloworld\n\néœ€æ±‚ï¼šåˆ›å»ºä¸€ä¸ªShellè„šæœ¬ï¼Œè¾“å‡ºhelloworld\n\nå®ä¾‹æ“ä½œï¼š\n\n```\n[root@Shell ~]# mkdir datas          ---åˆ›å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶å¤¹\n[root@Shell ~]# cd datas/            ---ä»¥åæ‰€æœ‰è„šæœ¬æ”¾åœ¨è¿™\n[root@Shell datas]# touch helloworld.sh\n[root@Shell datas]# vi helloworld.sh\n#!/bin/bash\necho \"helloworld  ä¸¥åƒå±¹\"\n~\n[root@Shell datas]# sh helloworld.sh        ---ç›¸å¯¹è·¯å¾„\nhelloworld  ä¸¥åƒå±¹\n[root@Shell ~]# bash datas/helloworld.sh    ---ç»å¯¹è·¯å¾„\nhelloworld  ä¸¥åƒå±¹\n#ä¸Šé¢éƒ½æ˜¯bashå’Œshå¸®ä½ æ‰§è¡Œè„šæœ¬ï¼Œè„šæœ¬æœ¬èº«ä¸éœ€è¦æ‰§è¡Œæƒé™ã€‚\n#ä¸‹é¢æœ¬è´¨æ˜¯è„šæœ¬éœ€è¦è‡ªå·±æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡Œæƒé™\n[root@Shell datas]# ./helloworld.sh\n-bash: ./helloworld.sh: æƒé™ä¸å¤Ÿ\n[root@shell datas]# chmod 777 helloworld.sh   ---ç»™äºˆæƒé™\n[root@shell datas]# ./helloworld.sh\nhelloworld  ä¸¥åƒå±¹\n```\n\n### ç¬¬äºŒä¸ªShellè„šæœ¬ï¼šå¤šå‘½ä»¤å¤„ç†\n\néœ€æ±‚ï¼š\n\nåœ¨/root/datas/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªqianyi.txt,åœ¨ qianyi.txt æ–‡ä»¶ä¸­å¢åŠ â€œqianyiosâ€\n\n```\n[root@shell datas]# touch qy.sh\n[root@shell datas]# vi qy.sh\n#!/bin/bash\ncd /root/datas/\ntouch qianyi.txt\necho \"qianyios\" >> qianyi.txt\n[root@shell datas]# bash qy.sh\n#æ‰§è¡Œå®Œæˆåä¼šå‡ºç°qianyi.txt\n[root@shell datas]# ll\næ€»ç”¨é‡ 12\n-rwxrwxrwx 1 root root 43 1æœˆ  25 17:06 helloworld.sh\n-rw-r--r-- 1 root root  9 1æœˆ  25 17:22 qianyi.txt\n-rw-r--r-- 1 root root 76 1æœˆ  25 17:22 qy.sh\n[root@shell datas]# cat qianyi.txt\nqianyios\n```\n\n## Shellä¸­çš„å˜é‡\n\n### å¸¸ç”¨çš„ç³»ç»Ÿå˜é‡\n\nâ€‹\t$HOME   $PWD   $SHELL  $USERç­‰\n\n### å®ä¾‹æ“ä½œ\n\næŸ¥çœ‹ç³»ç»Ÿå˜é‡çš„å€¼\n\n```\n[root@shell datas]# echo $HOME\n/root\næ˜¾ç¤ºå®¶ç›®å½•\n```\n\næ˜¾ç¤ºå½“å‰Shellä¸­æ‰€æœ‰çš„å˜é‡ï¼šset\n\n```\n[root@shell datas]# set\nABRT_DEBUG_LOG=/dev/null\nBASH=/usr/bin/bash\nBASH_ALIASES=()\nBASH_ARGC=()\nBASH_ARGV=()\nBASH_CMDS=()\n......\n```\n\n### è‡ªå®šä¹‰å˜é‡\n\n#### åŸºæœ¬è¯­æ³•\n\n1. å®šä¹‰å˜é‡ï¼šå˜é‡=å€¼\n2. æ’¤é”€å˜é‡ï¼šunset å˜é‡\n3. å£°æ˜é™æ€å˜é‡ï¼šreadonly å˜é‡   æ³¨æ„ä¸èƒ½unset\n\n#### å˜é‡å®šä¹‰è§„åˆ™\n\n1. å˜é‡åç§°å¯ä»¥æœ‰å­—æ¯ï¼Œæ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä½†æ˜¯ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œ<span style=\"color:red;\">ç¯å¢ƒå˜é‡åå»ºè®®å…¨éƒ¨å¤§å†™</span>\n2. <span style=\"color:red;\">ç­‰å·ä¸¤ä¾§ä¸èƒ½æœ‰ç©ºæ ¼</span>\n3. åœ¨bashä¸­ï¼Œå˜é‡é»˜è®¤ç±»å‹éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ— æ³•ç›´æ¥è¿›è¡Œæ•°å€¼è¿ç®—\n4. å˜é‡çš„å€¼å¦‚æœæœ‰<span style=\"color:red;\">ç©ºæ ¼</span>ï¼Œéœ€è¦ä½¿ç”¨åŒå¼•å·æˆ–å•å¼•å·æ‹¬èµ·æ¥\n\n#### å®ä¾‹æ“ä½œ\n\n```\n#è‡ªå®šä¹‰å˜é‡\n[root@shell ~]# QY=qianyi\n[root@shell ~]# echo $QY\nqianyi\n[root@shell ~]# QY=\"qian yi\"\n[root@shell ~]# echo $QY\nqian yi\n\nå˜é‡ä¸ºç©ºå’Œæœªå®šä¹‰å˜é‡æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µ\n[root@shell ~]# echo $age      ---æœªå®šä¹‰\n\n[root@shell ~]# age=\"\"\n[root@shell ~]# echo $age      ---å·²å®šä¹‰\n\n#ä¸¤ä¸ªæ²¡åŠæ³•è¾¨è®¤\n[root@shell ~]# set -u        ---è°ƒç”¨ä¸ºå£°æ˜å˜é‡ä¼šæŠ¥é”™\n[root@shell ~]# echo $add\n-bash: add: unbound variable\n[root@shell ~]# add=123\n[root@shell ~]# echo $add\n123\n#åˆ é™¤å˜é‡  ä¸éœ€è¦åŠ $add\n[root@shell ~]# echo $add\n123\n[root@shell ~]# unset add\n[root@shell ~]# echo $add\n-bash: add: unbound variable\n```\n\n### ç¯å¢ƒå˜é‡\n\n1. ç¯å¢ƒå˜é‡è®¾ç½®\n\n```\n[root@shell ~]# export qyage=\"18\"\n#ä½¿ç”¨exportå£°æ˜çš„å˜é‡å³æ˜¯ç¯å¢ƒå˜é‡\n```\n\n2. ç¯å¢ƒå˜é‡æŸ¥è¯¢  setå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å˜é‡ï¼Œenvåªèƒ½æŸ¥çœ‹ç¯å¢ƒå˜é‡\n\n```\n[root@shell ~]# env | grep qyage\nqyage=18\n```\n\n3. ç³»ç»Ÿé»˜è®¤ç¯å¢ƒå˜é‡\n\n```\n[root@shell ~]# env\nXDG_SESSION_ID=10\nHOSTNAME=shell\nTERM=xterm\nSHELL=/bin/bash\nHISTSIZE=1000\nqyage=18\n```\n\n4. PATHå˜é‡ï¼šç³»ç»ŸæŸ¥æ‰¾å‘½ä»¤çš„è·¯å¾„\n\nå…ˆæŸ¥è¯¢ä¸‹PATHç¯å¢ƒå˜é‡çš„å€¼ï¼š\n\n```\n[root@shell ~]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n\n```\n\n  PATH å˜é‡çš„å€¼æ˜¯ç”¨â€œ:â€åˆ†å‰²çš„è·¯å¾„ï¼Œè¿™äº›è·¯å¾„å°±æ˜¯ç³»ç»ŸæŸ¥æ‰¾å‘½ä»¤çš„è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬è¾“å…¥äº†ä¸€ä¸ªç¨‹åºåï¼Œå¦‚æœæ²¡æœ‰å†™å…¥è·¯å¾„ï¼Œç³»ç»Ÿå°±ä¼šåˆ° PATH å˜é‡å®šä¹‰çš„è·¯å¾„ä¸­å»å¯»æ‰¾ï¼Œæ˜¯å¦æœ‰å¯ä»¥æ‰§è¡Œçš„ç¨‹åºã€‚å¦‚æœæ‰¾åˆ°åˆ™æ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ¥â€œå‘½ä»¤æ²¡æœ‰å‘ç°â€çš„é”™è¯¯ã€‚\n\n  é‚£ä¹ˆæ˜¯ä¸æ˜¯æˆ‘ä»¬æŠŠè‡ªå·±çš„è„šæœ¬æ‹·è´åˆ° PATH å˜é‡å®šä¹‰çš„è·¯å¾„ä¸­ï¼Œæˆ‘ä»¬è‡ªå·±å†™çš„è„šæœ¬ä¹Ÿå¯ä»¥ä¸è¾“å…¥è·¯å¾„è€Œç›´æ¥è¿è¡Œå‘¢?\n\n```\n[root@shell ~]# cp datas/helloworld.sh /usr/bin/\n[root@shell ~]# helloworld.sh\nhelloworld  ä¸¥åƒå±¹\n[root@shell ~]# rm -rf /usr/bin/helloworld.sh\n[root@shell ~]# helloworld.sh\n-bash: /usr/bin/helloworld.sh: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•\n```\n\né‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä¿®æ”¹ PATHå˜é‡çš„å€¼ï¼Œè€Œä¸æ˜¯æŠŠç¨‹åºè„šæœ¬å¤åˆ¶åˆ°/bin/ç›®å½•ä¸­ã€‚å½“ç„¶æ˜¯å¯ä»¥çš„,æˆ‘ä»¬é€šè¿‡å˜é‡çš„å åŠ å°±å¯ä»¥å®ç°äº†:\n\n```\n[root@shell ~]# PATH=\"$PATH\":/root/datas\n[root@shell ~]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/datas\n[root@shell ~]# helloworld.sh\nhelloworld  ä¸¥åƒå±¹\n```\n\n### PS1å˜é‡ï¼šå‘½ä»¤æç¤ºç¬¦è®¾ç½®\n\nPS1æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„å˜é‡ï¼Œæ˜¯ç”¨æ¥å®šä¹‰å‘½ä»¤è¡Œçš„æç¤ºç¬¦ï¼Œå¯ä»¥å®‰è£…æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚æ¥å®šä¹‰è‡ªå·±å–œæ¬¢çš„æç¤ºç¬¦ã€‚PS1å¯ä»¥æ”¯æŒä»¥ä¸‹è¿™äº›é€‰é¡¹ï¼š\n\n```\n\\d ï¼š#ä»£è¡¨æ—¥æœŸï¼Œæ ¼å¼ä¸ºweekday month dateï¼Œä¾‹å¦‚ï¼š\"Mon Aug 1\"   \n\\H ï¼š#å®Œæ•´çš„ä¸»æœºåç§°ã€‚   \n\\h ï¼š#ä»…å–ä¸»æœºçš„ç¬¬ä¸€ä¸ªåå­—ã€‚ \n\\t ï¼š#æ˜¾ç¤ºæ—¶é—´ä¸º24å°æ—¶æ ¼å¼ï¼Œå¦‚ï¼šHHï¼šMMï¼šSS   \n\\T ï¼š#æ˜¾ç¤ºæ—¶é—´ä¸º12å°æ—¶æ ¼å¼   \n\\A ï¼š#æ˜¾ç¤ºæ—¶é—´ä¸º24å°æ—¶æ ¼å¼ï¼šHHï¼šMM   \n\\u ï¼š#å½“å‰ç”¨æˆ·çš„è´¦å·åç§°   \n\\v ï¼š#BASHçš„ç‰ˆæœ¬ä¿¡æ¯   \n\\w ï¼š#å®Œæ•´çš„å·¥ä½œç›®å½•åç§°ã€‚å®¶ç›®å½•ä¼šä»¥ ~ä»£æ›¿   \n\\W ï¼š#åˆ©ç”¨basenameå–å¾—å·¥ä½œç›®å½•åç§°ï¼Œæ‰€ä»¥åªä¼šåˆ—å‡ºæœ€åä¸€ä¸ªç›®å½• \n\\# ï¼š#ä¸‹è¾¾çš„ç¬¬å‡ ä¸ªå‘½ä»¤   \n\\$ ï¼š#æç¤ºå­—ç¬¦ï¼Œå¦‚æœæ˜¯rootæ—¶ï¼Œæç¤ºç¬¦ä¸ºï¼š# ï¼Œæ™®é€šç”¨æˆ·åˆ™ä¸ºï¼š$  \n```\n\n```\næ ¼å¼ PS1='[ ]\\$ '     \\$ç©ºæ ¼'  æœ‰ä¸ªç©ºæ ¼  ä¸€å®šè¦å•å¼•å·\n```\n\n```\n[root@shell ~]# echo $PS1\n[\\u@\\h \\W]\\$\n[root@shell ~]# PS1='[\\u@\\t \\w]\\$ '\n[root@20:14:51 ~]# cd datas/\n[root@20:14:54 ~/datas]#\n```\n\n### ä½ç½®å‚æ•°å˜é‡\n\n| ä½ç½®å‚æ•°å˜é‡ | ä½œç”¨                                                         |\n| ------------ | ------------------------------------------------------------ |\n| $n           | è¡¨ç¤ºç¬¬nä¸ªå‚æ•°ï¼Œ$1åˆ™è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ$2è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°â€¦â€¦å¦‚æœæœ‰10ä»¥ä¸Šçš„å‚æ•°ç”¨${10} |\n| $0           | å½“å‰ç¨‹åºçš„åç§°ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤æœ¬èº«ã€‚                             |\n| $*           | ä¼ é€’ç»™ç¨‹åºçš„æ‰€æœ‰å‚æ•°ç»„æˆçš„å­—ç¬¦ä¸²ï¼ˆå‚æ•°ï¼‰ã€‚                   |\n| $@           | ä»¥â€œå‚æ•°1â€ã€â€œå‚æ•°2â€â€¦â€¦ä¿å­˜æ‰€æœ‰çš„å‚æ•°ã€‚                         |\n| $#           | ä»£è¡¨å‘½ä»¤è¡Œä¸­æ‰€æœ‰å‚æ•°ä¸ªæ•°                                     |\n| $?           | ä¸Šä¸€ä¸ªä»£ç æˆ–è€…Shellç¨‹åºåœ¨Shellä¸­é€€å‡ºçš„æƒ…å†µï¼Œå¦‚æœæ­£å¸¸é€€å‡ºåˆ™è¿”å›0ï¼Œå¦åˆ™è¿”å›é0å€¼ã€‚ |\n| $$           | æœ¬ç¨‹åºçš„ï¼ˆè¿›ç¨‹IDï¼‰PIDã€‚                                      |\n| $!           | ä¸Šä¸€ä¸ªå‘½ä»¤çš„PIDã€‚                                            |\n\n#### å®ä¾‹æ“ä½œ\n\n```\n[root@shell datas]# vi count.sh\n#!/bin/bash\na=$1\nb=$2\nsum=$(($a+$b))\n#$((  ))åŒå°æ‹¬å·æ‰èƒ½è¿›è¡Œæ•°å­—è¿ç®—ï¼Œ$( )è¿è¡Œå‘½ä»¤\necho $sum\necho $0\n[root@shell datas]# chmod 755 count.sh\n[root@shell datas]# ./count.sh 22 33\n55\n./count.sh       #$0è¾“å‡ºå‘½ä»¤æœ¬èº«\n```\n\n```\n[root@shell datas]# vi para.sh\n#!/bin/bash\necho \"\\$* is $*\"\necho \"\\$@ is $@\"\necho \"\\$# is $#\"\n[root@shell datas]# chmod 777 para.sh\n[root@shell datas]# ./para.sh 11 22 33 44\n$* is 11 22 33 44   #{11 22 33 44}çœ‹æˆä¸€ä¸ªæ•´ä½“ \n$@ is 11 22 33 44   #{11},{22},{33},{44}\n$# is 4             #ä¸ªæ•°\néªŒè¯è¿‡ç¨‹\n[root@shell datas]# vi para2.sh\n#!/bin/bash\n#forå¾ªç¯ï¼Œæœ‰å¤šå°‘æ¬¡å‡ºç°å¤šå°‘æ¬¡\nfor i in  \"$*\"\n      do\n        echo $i\n      done\necho \"------------------\"\nfor y in  \"$@\"\n        do\n         echo $y\n      done\n[root@shell datas]# ./para2.sh 11 22 33 44\n11 22 33 44             #æ•´ä½“ï¼Œå¾ªç¯1æ¬¡\n------------------\n11                      #4ä¸ªï¼Œå¾ªç¯4æ¬¡\n22\n33\n44\n```\n\n### é¢„å®šä¹‰å˜é‡\n\n| $?   | æœ€åä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤çš„è¿”å›çŠ¶æ€ã€‚å¦‚æœè¿™ä¸ªå˜é‡çš„å€¼ä¸º 0ï¼Œè¯æ˜ä¸Šä¸€ä¸ªå‘½ä»¤æ­£ç¡®æ‰§è¡Œ:å¦‚æœè¿™ä¸ªå˜é‡çš„å€¼ä¸ºé 0(å…·ä½“æ˜¯å“ªä¸ªæ•°ï¼Œç”±å‘½ä»¤è‡ªå·±æ¥å†³å®š)ï¼Œåˆ™è¯æ˜ä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œä¸æ­£ç¡®äº†ã€‚ |\n| ---- | ------------------------------------------------------------ |\n| $$   | å½“å‰è¿›ç¨‹çš„è¿›ç¨‹å·(PID)                                        |\n| $!   | åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·(PID)                          |\n\n```\n[root@shell ~]# ls\nanaconda-ks.cfg  bin  datas  repo.bak\n[root@shell ~]# echo $?\n0\n[root@shell ~]# sjkdhasjkd\n-bash: sjkdhasjkd: æœªæ‰¾åˆ°å‘½ä»¤\n[root@shell ~]# echo $?\n127\n```\n\n## readé”®ç›˜æ¥æ”¶\n\n### å®šä¹‰\n\n[root@shell datas]# read --help\n-bash: read: --: æ— æ•ˆé€‰é¡¹\nread: ç”¨æ³•:   read [é€‰é¡¹] [å˜é‡å]\n\nread [-ers]\n\n[-a æ•°ç»„] \n\n[-d åˆ†éš”ç¬¦] \n\n[-i ç¼“å†²åŒºæ–‡å­—] \n\n[-n è¯»å–å­—ç¬¦æ•°] \n\n[-N è¯»å–å­—ç¬¦æ•°] \n\n[-p æç¤ºç¬¦] \n\n[-t è¶…æ—¶] \n\n[-u æ–‡ä»¶æè¿°ç¬¦] \n\n[åç§° ...]åç§°æŒ‡çš„æ˜¯å˜é‡å\n\n```\n[root@shell datas]# vi count2.sh\n#!/bin/bash\nread -t 30 -p \"è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—ï¼š\" num1\nread -t 30 -p \"è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—ï¼š\" num2\nsum=$(($num1+$num2))\necho $sum\n[root@shell datas]# chmod 777 count2.sh\n[root@shell datas]# ./count2.sh\nè¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—ï¼š1\nè¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—ï¼š1\n2\n\n\n#########å‰è€…éœ€è¦å›è½¦ï¼Œä¸‹é¢çš„ä¸éœ€è¦å›è½¦\n[root@shell datas]# vi count2.sh\n#!/bin/bash\nread -n 1 -t 30 -p \"è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—ï¼š\" num1   #-n 1 é™åˆ¶è¾“å…¥1ä¸ªå­—ç¬¦æ•°\necho -e \"\\n\"\nread -s -t 30 -p \"è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—ï¼š\" num2     #-s æ˜¯éšè—\necho -e \"\\n\"\nsum=$(($num1+$num2))\necho $sum\n[root@shell datas]# ./count2.sh\nè¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—ï¼š1\n\nè¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—ï¼š         #æˆ‘è¿™é‡Œè¾“å…¥çš„æ˜¯12\n\n13\n```\n\n## declareå£°æ˜å˜é‡ç±»å‹\n\n### å®šä¹‰\n\næ—¢ç„¶æ‰€æœ‰å˜é‡çš„é»˜è®¤ç±»å‹æ˜¯å­—ç¬¦ä¸²å‹ï¼Œé‚£ä¹ˆåªè¦æˆ‘ä»¬æŠŠå˜é‡å£°æ˜ä¸ºæ•´æ•°å‹ä¸å°±å¯ä»¥è¿ç®—äº†å—ï¼Ÿ\n\n> -:ç»™å˜é‡è®¾å®šç±»å‹å±æ€§\n>\n> +:å–æ¶ˆå˜é‡çš„ç±»å‹å±æ€§\n>\n> -a:å°†å˜é‡å£°æ˜ä¸ºæ•°ç»„å‹\n>\n> -i:å°†å˜é‡å£°æ˜ä¸ºæ•´æ•°å‹(integer)\n>\n> -x:å°†å˜é‡å£°æ˜ä¸ºç¯å¢ƒå˜é‡\n>\n> -r:å°†å˜é‡å£°æ˜ä¸ºåªè¯»å˜é‡ï¼Œæ³¨æ„ï¼Œä¸€æ—¦è®¾ç½®ä¸ºåªè¯»å˜é‡ï¼Œæ—¢ä¸èƒ½ä¿®æ”¹å˜é‡çš„å€¼ï¼Œä¹Ÿä¸èƒ½åˆ é™¤å˜é‡ï¼Œç”šè‡³ä¸èƒ½é€šè¿‡+rå–æ¶ˆåªè¯»å±æ€§\n>\n> -p:æ˜¾ç¤ºæŒ‡å®šå˜é‡çš„è¢«å£°æ˜çš„ç±»å‹ã€\n\n### å£°æ˜æ•°å€¼è¿›è¡Œè¿ç®—\n\n```\n[root@shell datas]# a=1\n[root@shell datas]# b=2\n[root@shell datas]# c=$a+$b\n[root@shell datas]# echo $c\n1+2\n[root@shell datas]# declare -i c=$a+$b      #å£°æ˜æ•´æ•°ç±»å‹æ‰å¯ä»¥è¿›è¡Œæ•°å€¼è¿è¡Œ\n[root@shell datas]# echo $c\n3\n```\n\n### æ•°ç»„\n\n```\n[root@shell datas]# declare -a name[0]=\"qy\"  #å£°æ˜æ•°ç»„\n[root@shell datas]# name[1]=\"qy1\"   #ä¹Ÿå¯ä»¥ä¸ç”¨declareï¼Œå°±çŸ¥é“ä½ åœ¨å£°æ˜æ•°ç»„\n[root@shell datas]# name[2]=\"qy2\"\n[root@shell datas]# echo ${name[*]}\nqy qy1 qy2\n```\n\n### ç¯å¢ƒå˜é‡\n\n```\nä¸¤ä¸ªå£°æ˜å˜é‡ä½œç”¨ä¸€æ ·\n[root@shell datas]# export test\n[root@shell datas]# declare -x test=\"123\"\n```\n\n### åªè¯»å±æ€§\n\næ³¨æ„ï¼Œä¸€æ—¦è®¾ç½®ä¸ºåªè¯»å˜é‡ï¼Œæ—¢ä¸èƒ½ä¿®æ”¹å˜é‡çš„å€¼ï¼Œä¹Ÿä¸èƒ½åˆ é™¤å˜é‡ï¼Œç”šè‡³ä¸èƒ½é€šè¿‡+rå–æ¶ˆåªè¯»å±æ€§\n\n```\n[root@shell datas]# declare -r test        #æ·»åŠ åªè¯»å±æ€§\n[root@shell datas]# declare -p\n......\ndeclare -rx test=\"123\"\n[root@shell datas]# echo $test\n123\n[root@shell datas]# test=1           #æ— æ³•æ”¹å€¼\n-bash: test: åªè¯»å˜é‡\n[root@shell datas]# unset test        #æ— æ³•åˆ é™¤å˜é‡\n-bash: unset: test: æ— æ³•åè®¾å®š: åªè¯» variable\n[root@shell datas]# declare +r test      #æ— æ³•åˆ é™¤å±æ€§\n-bash: declare: test: åªè¯»å˜é‡\n```\n\nä¸è¿‡å¥½åœ¨è¿™ä¸ªå˜é‡æ˜¯å‘½ä»¤è¡Œå£°æ˜çš„ï¼Œæ‰€ä»¥é‡å¯æˆ–é‡æ–°ç™»å…¥ï¼Œè¿™ä¸ªå˜é‡å°±ä¼šæ¶ˆå¤±\n\n## æ•°å€¼è¿ç®—\n\n### ä½¿ç”¨expræˆ–letæ•°å€¼è¿ç®—å·¥å…·\n\n```\n[root@shell ~]# aa=11\n[root@shell ~]# bb=22\n[root@shell ~]# dd=$(expr $aa + $bb)\n[root@shell ~]# echo $dd\n33\n#ddçš„å€¼æ˜¯aaå’Œbbçš„å’Œã€‚æ³¨æ„â€œ+â€å·ä¸¤ä¾§æ¯”æœ‰ç©ºæ ¼\n#å¦‚æœæ˜¯letå‘¢\n[root@shell ~]# let e=$aa+$bb\n[root@shell ~]# echo $e\n33\n```\n\n### ä½¿ç”¨åŒå°æ‹¬å· $((è¿ç®—å¼å­))  æˆ–$[è¿ç®—å¼å­] çš„æ–¹å¼è¿ç®— ï¼ˆçœ‹ä¸ªäººä¹ æƒ¯ï¼Œçœ‹ä½ å–œæ¬¢ç”¨å“ªç§ï¼‰\n\n> åŒºåˆ†å•å°æ‹¬å·$(  )è°ƒç”¨çš„æ˜¯ç³»ç»Ÿå‘½ä»¤  åŒå°æ‹¬å·æ˜¯è®¡ç®—æ•°å­¦è¿ç®—çš„\n\n```\n[root@shell ~]# aa=11\n[root@shell ~]# bb=22\n[root@shell ~]# ff=$(($aa+$bb))\n[root@shell ~]# echo $ff\n33\n[root@shell ~]# gg=$[$aa+$bb]\n[root@shell ~]# echo $gg\n33\n```\n\n### Shellå¸¸ç”¨è¿ç®—ç¬¦\n\n| ä¼˜å…ˆçº§ | è¿ç®—ç¬¦                             | è¯´æ˜                               |\n| ------ | ---------------------------------- | ---------------------------------- |\n| 13     | -ï¼Œ+                               | å•ç›®è´Ÿï¼Œå•ç›®æ­£                     |\n| 12     | !,~                                | é€»è¾‘éï¼ŒæŒ‰ä½å–åæˆ–è¡¥ç              |\n| 11     | *,/,%                              | ä¹˜ã€é™¤ã€å–æ¨¡                       |\n| 10     | +,-                                | åŠ ã€å‡                             |\n| 9      | <<,>>                              | æŒ‰ä½å·¦ç§»ï¼ŒæŒ‰ä½å³ç§»                 |\n| 8      | < = ,> = ,< , >                    | å°äºæˆ–ç­‰äºã€å¤§äºæˆ–ç­‰äºã€å°äºã€å¤§äº |\n| 7      | ==, !=                             | ç­‰äº                               |\n| 6      | &                                  | æŒ‰ä½ä¸                             |\n| 5      | ^                                  | æŒ‰ä½å¼‚æˆ–                           |\n| 4      | \\|                                 | æŒ‰ä½æˆ–                             |\n| 3      | &&                                 | é€»è¾‘ä¸                             |\n| 2      | \\|\\|                               | é€»è¾‘æˆ–                             |\n| 1      | =,*=,-=,*=,/=,%=,&=,^=,\\|=,<<=,>>= | èµ‹å€¼ï¼Œè¿ç®—ä¸”èµ‹å€¼                   |\n\n### å–æ¨¡è¿ç®—\n\n```\n[root@shell ~]# bb=$((14%5))\n[root@shell ~]# echo $bb\n4\n#14ä¸èƒ½è¢«5æ•´é™¤ï¼Œä½™æ•°æ˜¯4\n```\n\n### é€»è¾‘ä¸\n\n```\n[root@shell ~]# cc=$((1&&0))\n[root@shell ~]# echo $cc\n0\né€»è¾‘ä¸è¿ç®—åªæœ‰æƒ³ä¸çš„ä¸¤è¾¹éƒ½æ˜¯1ï¼Œä¸çš„ç»“æœæ‰æ˜¯1ï¼Œå¦åˆ™ä¸çš„ç»“æœæ˜¯0\n```\n\n### å››åˆ™è¿ç®—ç»ƒä¹ \n\n```\n[root@shell ~]# vi count3.sh\n#!/bin/bash\nvaule=$(($1 $2 $3))\necho $vaule\n[root@shell ~]# ./count3.sh 11 + 11\n22\n[root@shell ~]# ./count3.sh 11 / 11\n1\n```\n\nä½†æ˜¯ä¸Šé¢ä¼šæœ‰bugä¸èƒ½ç”¨\n\n```\n[root@shell datas]# vi count4.sh\n#!/bin/bash\nread -t 30 -p \"please input num1:\" num1\nread -t 30 -p \"please input num2:\" num2\nread -n 1 -t 30 -p \"please inpute operato[+-*/]:\" oper\necho -e â€œ\\nâ€\n[ \"$oper\" == \"+\" ] && echo \"$(($num1 + $num2))\" && exit\n[ \"$oper\" == \"-\" ] && echo \"$(($num1 - $num2))\" && exit\n[ \"$oper\" == \"*\" ] && echo \"$(($num1 * $num2))\" && exit\n[ \"$oper\" == \"/\" ] && echo \"$(($num1 / $num2))\" && exit\n\necho \"please input right oper\"\n[ç©ºæ ¼\"$oper\"ç©ºæ ¼==ç©ºæ ¼\"+\"ç©ºæ ¼]\n```\n\n## å˜é‡çš„æµ‹è¯•ä¸å†…å®¹ç½®æ¢\n\n| å˜é‡ç½®æ¢æ–¹å¼ | å˜é‡yæ²¡æœ‰è®¾ç½®                  | å˜é‡yä¸ºç©ºå€¼            | å˜é‡yè®¾ç½®å€¼ |\n| ------------ | ------------------------------ | ---------------------- | ----------- |\n| x=${y-æ–°å€¼}  | x= æ–°å€¼                        | x ä¸ºç©º                 | x=$y        |\n| x=${y:-æ–°å€¼} | x= æ–°å€¼                        | x= æ–°å€¼                | x=$y        |\n| x=${y+æ–°å€¼}  | x ä¸ºç©º                         | x= æ–°å€¼                | x=æ–°å€¼      |\n| x=${y:+æ–°å€¼} | x ä¸ºç©º                         | x ä¸ºç©º                 | x=æ–°å€¼      |\n| x=${y=æ–°å€¼}  | x= æ–°å€¼                        | x ä¸ºç©º                 | x=$y        |\n| åŒä¸Š         | y= æ–°å€¼                        | y å€¼ä¸å˜               | yå€¼ä¸å˜     |\n| x=${y:=æ–°å€¼} | x= æ–°å€¼                        | X= æ–°å€¼                | x=$y        |\n| åŒä¸Š         | y= æ–°å€¼                        | y= æ–°å€¼                | yå€¼ä¸å˜     |\n| x=${y?æ–°å€¼}  | æ–°å€¼è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆå±å¹•ï¼‰ | x ä¸ºç©º                 | x=$y        |\n| x=${y:?æ–°å€¼} | æ–°å€¼è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡º         | æ–°å€¼è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡º | x=$y        |\n\nå‡è®¾æˆ‘ä»¬è¦æµ‹bå˜é‡ï¼Œç°åœ¨bå˜é‡æˆ‘ä»¬ä»æ¥æ²¡æœ‰è®¾ç½®è¿‡\n\n```\nä»¥ä¸‹å¯ä»¥åˆ¤æ–­å˜bä¸å­˜åœ¨\n[root@shell ~]# x=${b-new}\n[root@shell ~]# echo $x\nnew\nä»¥ä¸‹å¯ä»¥åˆ¤æ–­æ˜¯å¦ä¸ºç©º\n[root@shell ~]# b=\"\"\n[root@shell ~]# x=${b-new}\n[root@shell ~]# echo $x\nä»¥ä¸‹å¯ä»¥åˆ¤æ–­æ˜¯å¦æœ‰å€¼\n[root@shell ~]# b=123\n[root@shell ~]# x=${b-new}\n[root@shell ~]# echo $x\n123\n```\n\n## ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶\n\n1ã€è®©ç¯å¢ƒå˜é‡ç”Ÿæ•ˆçš„å‘½ä»¤  source é…ç½®æ–‡ä»¶  æˆ–  . é…ç½®æ–‡ä»¶\n\n2ã€ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶\n\nç™»å½•æ—¶ç”Ÿæ•ˆçš„ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶\n\nåœ¨ Linux ç³»ç»Ÿç™»å½•æ—¶ä¸»è¦ç”Ÿæ•ˆçš„ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶æœ‰ä»¥ä¸‹äº”ä¸ª:\n\n/etc/profile\n\n/etc/profile.d/*.sh\n\n/etc/bashrc\n\n~/.bash_profile\n\n~/.bashrc\n\nå†™åœ¨å‰ä¸‰ä¸ªçš„é…ç½®æ–‡ä»¶å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œå†™åœ¨æœ€åä¸¤ä¸ªå¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆ\n\n## åŸºç¡€æ­£åˆ™\n\nåŸºç¡€æ­£åˆ™è¡¨è¾¾å¼\n\n| å…ƒå­—ç¬¦  | ä½œ\tç”¨                                                     |\n| ------- | :----------------------------------------------------------- |\n| *       | å‰ä¸€ä¸ªå­—ç¬¦åŒ¹é… 0 æ¬¡æˆ–ä»»æ„å¤šæ¬¡ã€‚                              |\n| .       | åŒ¹é…é™¤äº†æ¢è¡Œç¬¦å¤–ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚                               |\n| ^       | åŒ¹é…è¡Œé¦–ã€‚ä¾‹å¦‚ï¼š^hello ä¼šåŒ¹é…ä»¥ hello å¼€å¤´çš„è¡Œã€‚             |\n| $       | åŒ¹é…è¡Œå°¾ã€‚ä¾‹å¦‚ï¼šhello&ä¼šåŒ¹é…ä»¥ hello ç»“å°¾çš„è¡Œã€‚              |\n| []      | åŒ¹é…ä¸­æ‹¬å·ä¸­æŒ‡å®šçš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼ŒåªåŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼š[aoeiu] åŒ¹é…ä»»æ„ä¸€ä¸ªå…ƒéŸ³å­—æ¯ï¼Œ[0-9] åŒ¹é…ä»»æ„ä¸€ä½æ•°å­—ï¼Œ[a-z][0-9]åŒ¹é…å°å†™å­—å’Œä¸€ä½æ•°å­—æ„æˆçš„ä¸¤ä½å­—ç¬¦ã€‚ |\n| [^]     | åŒ¹é…é™¤ä¸­æ‹¬å·çš„å­—ç¬¦ä»¥å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼š[^0-9] åŒ¹é…ä»»æ„ä¸€ä½éæ•°å­—å­—ç¬¦ï¼Œ[^a-z] è¡¨ç¤ºä»»æ„ä¸€ä½éå°å†™å­—æ¯ã€‚ |\n| \\       | è½¬ä¹‰ç¬¦ã€‚ç”¨äºå–æ¶ˆè®²ç‰¹æ®Šç¬¦å·çš„å«ä¹‰å–æ¶ˆã€‚                       |\n| \\{n\\}   | è¡¨ç¤ºå…¶å‰é¢çš„å­—ç¬¦æ°å¥½å‡ºç° n æ¬¡ã€‚ä¾‹å¦‚ï¼š[0-9]\\{4\\} åŒ¹é… 4 ä½æ•°å­—ï¼Œ[1][3-8][0-9]\\{9\\} åŒ¹é…æ‰‹æœºå·ç ã€‚ |\n| \\{n,\\}  | è¡¨ç¤ºå…¶å‰é¢çš„å­—ç¬¦å‡ºç°ä¸å°äº n æ¬¡ã€‚ä¾‹å¦‚ï¼š [0-9]\\{2,\\} è¡¨ç¤ºä¸¤ä½åŠä»¥ä¸Šçš„æ•°å­—ã€‚ |\n| \\{n,m\\} | è¡¨ç¤ºå…¶å‰é¢çš„å­—ç¬¦è‡³å°‘å‡ºç°n æ¬¡ï¼Œæœ€å¤šå‡ºç°m æ¬¡ã€‚ä¾‹å¦‚ï¼š[a-z]\\{6,8\\}åŒ¹é… 6 åˆ° 8 ä½çš„å°å†™å­—æ¯ã€‚ |\n\n### ~/.bashrc æ–‡ä»¶ä¸­å»ºç«‹è¿™ä¸ªåˆ«åï¼š\n\nå®ç°grepèƒ½æ˜¾ç¤ºé¢œè‰²\n\n```\necho \"alias grep=\\'grep --color=auto\\'\" >> /root/.bashrc \n```\n\nå»ºç«‹ç»ƒä¹ æ–‡æ¡£\n\n```\n[root@shell datas]# vi test.txt\nMr. Li Ming said:\nhe was the most honest man.\n123despise him.\ngoogle\ngooooogle\nggle\ngogle\nsoooooid\nBut since Mr. shen Chao came, he never saaaid those words. 5555nice!\nbecause,actuaaaally,\nMr. Shen Chao is the most honest man\nLater,Mr. Li ming soid his hot body.\nhello is\nhello was\n```\n\n\n\nç»ƒä¹ *å·\n\n```\n# a*æ„æ€æ˜¯æœ€å°‘åŒ…å«0ä¸ªaæˆ–æ— æ•°ä¸ªa\n[root@shell datas]# grep \"a*\" test.txt\nMr. Li Ming said:\nhe was the most honest man.\n123despise him.\nBut since Mr. shen Chao came, he never saaaid those words. 5555nice!\nbecause,actuaaaally,\nMr. Shen Chao is the most honest man\nLater,Mr. Li ming soid his hot body.\n\n# aa*æ„æ€æ˜¯æœ€å°‘åŒ…å«1ä¸ªaæˆ–æ— æ•°ä¸ªa\n[root@shell datas]# grep \"aa*\" test.txt\nMr. Li Ming said:\nhe was the most honest man.\nBut since Mr. shen Chao came, he never saaaid those words. 5555nice!\nbecause,actuaaaally,\nMr. Shen Chao is the most honest man\nLater,Mr. Li ming soid his hot body.\n\n# aaa*æ„æ€æ˜¯æœ€å°‘åŒ…å«2ä¸ªaæˆ–æ— æ•°ä¸ªa\n[root@shell datas]# grep \"aaa*\" test.txt\nBut since Mr. shen Chao came, he never saaaid those words. 5555nice!\nbecause,actuaaaally,\n\ngrep \"a\" count4.sh   ä¹Ÿè¡Œ\n\n```\n\nç»ƒä¹  . å·   æ­£åˆ™è¡¨è¾¾å¼â€œ.â€åªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªå­—ç¬¦å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦\n\n```\n[root@shell datas]# grep \"s..d\" test.txt\nMr. Li Ming said:\nLater,Mr. Li ming soid his hot body.\n```\n\n[root@shell datas]# grep \"s.*d\" test.txt\nMr. Li Ming **said**:\nBut **since Mr. shen Chao came, he never saaaid those word**s. 5555nice!\nLater,Mr. Li ming **soid his hot bod**y.\n\n\n\nâ€œ[]â€ä¼šåŒ¹é…ä¸­æ‹¬å·ä¸­æŒ‡å®šä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œæ³¨æ„åªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚[ao]è¦ä¸ä¼šåŒ¹é…ä¸€ä¸ª a\n\nå­—ç¬¦ï¼Œè¦ä¸ä¼šåŒ¹é…ä¸€ä¸ª o å­—ç¬¦ï¼š\n\n```\n[root@shell datas]# grep \"s[ao]id\" test.txt\nMr. Li Ming said:\nLater,Mr. Li ming soid his hot body.\n[root@shell datas]# grep \"[0-9]\" test.txt\n123despise him.\nBut since Mr. shen Chao came, he never saaaid those words. 5555nice!\n```\n\n## æ‰©å±•æ­£åˆ™\n\n| æ‰©å±•å…ƒå­—ç¬¦ | ä½œ\tç”¨                                                     |\n| ---------- | ------------------------------------------------------------ |\n| +          | å‰ä¸€ä¸ªå­—ç¬¦åŒ¹é… 1 æ¬¡æˆ–ä»»æ„å¤šæ¬¡ã€‚å¦‚â€œgo+gleâ€ä¼šåŒ¹é…â€œgogleâ€ã€â€œgoogleâ€æˆ–â€œgooogleâ€ï¼Œå½“ç„¶å¦‚æœâ€œoâ€æœ‰æ›´å¤šä¸ªï¼Œä¹Ÿèƒ½åŒ¹é…ã€‚ |\n| ï¼Ÿ         | å‰ä¸€ä¸ªå­—ç¬¦åŒ¹é… 0 æ¬¡æˆ– 1 æ¬¡ã€‚å¦‚â€œcolou?râ€å¯ä»¥åŒ¹é…â€œcolourâ€æˆ–â€œcolorâ€ã€‚ |\n| \\|         | åŒ¹é…ä¸¤ä¸ªæˆ–å¤šä¸ªåˆ†æ”¯é€‰æ‹©ã€‚å¦‚â€œwas\\|hisâ€ä¼šåŒ¹é…æ—¢åŒ…å«â€œwasâ€çš„è¡Œï¼Œä¹ŸåŒ¹é…åŒ…å«â€œhisâ€çš„è¡Œã€‚ |\n| ï¼ˆï¼‰       | åŒ¹é…å…¶æ•´ä½“ä¸ºä¸€ä¸ªå­—ç¬¦ï¼Œå³æ¨¡å¼å•å…ƒã€‚å¯ä»¥ç†è§£ä¸ºç”±å¤šä¸ªå•ä¸ªå­—ç¬¦ç»„æˆçš„å¤§å­—ç¬¦ã€‚<br />å¦‚â€œ(dog)+â€ä¼šåŒ¹é…â€œdogâ€ã€â€œdogdogâ€ã€â€œdogdogdogâ€ç­‰ï¼Œå› ä¸ºè¢«ï¼ˆï¼‰åŒ…å«çš„å­—ç¬¦ä¼šå½“æˆä¸€ä¸ªæ•´ä½“ã€‚ä½†â€œhello ï¼ˆworld\\|earthï¼‰â€ä¼šåŒ¹é…â€œhello worldâ€åŠâ€œhello earthâ€ã€‚ |\n\n## grep å‚æ•°åˆ—è¡¨\n\n1. `-i` : å¿½ç•¥å¤§å°å†™\n2. `-v` : æŸ¥æ‰¾ä¸åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„æ‰€æœ‰è¡Œï¼ˆå–åï¼‰\n3. `-r` : é€’å½’æŸ¥æ‰¾æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶\n4. `-n` : æ˜¾ç¤ºåŒ¹é…è¡Œæ‰€åœ¨ä½ç½®ï¼ˆè¡Œå·ï¼‰\n5. `-l` : åªæ˜¾ç¤ºåŒ…å«æœç´¢å­—ç¬¦ä¸²çš„æ–‡ä»¶åï¼Œè€Œéæ¯ä¸ªåŒ¹é…è¡Œ\n6. `-c` : ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„è¡Œæ•°\n7. `-e pattern` : æŒ‡å®šè¦æŸ¥æ‰¾çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼\n8. `-w` : åŒ¹é…æ•´ä¸ªå•è¯ï¼Œå³åªåŒ¹é…ç‹¬ç«‹çš„å•è¯è€Œéå•è¯å†…çš„å­—ç¬¦\n9. `-A num` : è¾“å‡ºåŒ¹é…è¡Œå N è¡Œå†…å®¹\n10. `-B num` : è¾“å‡ºåŒ¹é…è¡Œå‰ N è¡Œå†…å®¹\n11. `-C[num]` æˆ–è€… `--context[=num]`: è¾“å‡ºåŒ¹é…è¡Œå‰åæ€»å…± N è¡Œå†…å®¹ã€‚\n12. `--exclude` : æ’é™¤æŒ‡å®šæ–‡ä»¶ç±»å‹ï¼Œå¤šä¸ªæ–‡ä»¶ç±»å‹ç”¨ \",\" éš”å¼€\n\n```\n[root@localhost sh]# grep -E \"go*gle\" test.txt\ngoogle\ngooooogle\nggle\ngogle\n[root@localhost sh]# grep -E \"go+gle\" test.txt\ngoogle\ngooooogle\ngogle\n[root@localhost sh]# grep -E \"go?gle\" test.txt\nggle\ngogle\n[root@localhost sh]# grep -E \"go+\" test.txt\ngoogle\ngooooogle\ngogle\n[root@localhost sh]# grep -E \"g(oo)+\" test.txt\ngoogle\ngooooogle\n[root@localhost sh]# grep -E \"g(ooo)+\" test.txt\ngooooogle\n[root@localhost sh]# grep -E \"hello (was|is)\" test.txt\nhello is\nhello was\n\n```\n\nåŒ¹é…é‚®ç®±\n\n```\ngrep -E \"[0-9a-zA-Z_]+@[0-9a-zA-Z_]+(\\.[0-9a-zA-Z_]+){1,3}\" test.txt\n```\n\n## å­—ç¬¦æˆªå–å’Œæ›¿æ¢å‘½ä»¤\n\n```\n[root@localhost ~]# cut [é€‰é¡¹] æ–‡ä»¶åé€‰é¡¹ï¼š\n-f åˆ—å·ï¼š          æå–ç¬¬å‡ åˆ—\n-d åˆ†éš”ç¬¦ï¼š\t     æŒ‰ç…§æŒ‡å®šåˆ†éš”ç¬¦åˆ†å‰²åˆ—\n-c å­—ç¬¦èŒƒå›´ï¼š    ä¸ä¾èµ–åˆ†éš”ç¬¦æ¥åŒºåˆ†åˆ—ï¼Œè€Œæ˜¯é€šè¿‡å­—ç¬¦èŒƒå›´ï¼ˆè¡Œé¦–ä¸º 0ï¼‰æ¥è¿›è¡Œå­—æ®µæå–ã€‚â€œn-â€è¡¨ç¤ºä»ç¬¬ n ä¸ªå­—ç¬¦åˆ°è¡Œå°¾ï¼›â€œn-mâ€ä»ç¬¬ n ä¸ªå­—ç¬¦åˆ°ç¬¬ mä¸ªå­—ç¬¦ï¼›â€œ-mâ€è¡¨ç¤ºä»ç¬¬ 1 ä¸ªå­—ç¬¦åˆ°ç¬¬ m ä¸ªå­—ç¬¦ã€‚\n```\n\næµ‹è¯•æ–‡ä»¶\n\n```\n[root@localhost ~]# cat student.txt\nID      Name    gender  Mark\n1       Liming  M       86\n2       Sc      M       90\n3       Tg      M       83\nç”¨tabé”®éš”å¼€æ‰€æœ‰åˆ—ï¼Œä¸è¦ç©ºæ ¼\n```\n\næµ‹è¯•\n\n```\n[root@localhost ~]# cut -f 2 student.txt\nName\nLiming\nSc\nTg\n#æå–å¤šåˆ—\n[root@localhost ~]# cut -f 2,3 student.txt\nName    gender\nLiming  M\nSc        M\nTg       M\n##cut å¯ä»¥æŒ‰ç…§å­—ç¬¦è¿›è¡Œæå–ï¼Œéœ€è¦æ³¨æ„â€œ8-â€ä»£è¡¨çš„æ˜¯æå–æ‰€æœ‰è¡Œçš„ç¬¬å…«ä¸ªå­—ç¬¦å¼€å§‹åˆ°è¡Œå°¾ï¼Œè€Œ â€œ10-20â€ä»£è¡¨æå–æ‰€æœ‰è¡Œçš„ç¬¬åä¸ªå­—ç¬¦åˆ°ç¬¬äºŒåä¸ªå­—ç¬¦ï¼Œè€Œâ€œ-8â€ä»£è¡¨æå–æ‰€æœ‰è¡Œä»è¡Œé¦–åˆ°ç¬¬å…«ä¸ª\nå­—ç¬¦ï¼š\n[root@localhost ~]# cut -c 9- student.txt\ngender Mark\n M 86\n0\n3\n[root@localhost ~]# cut -c -9 student.txt\nID Name g\n1 Liming\n2 Sc M 90\n3 Tg M 83\n\n```\n\n## awkç¼–ç¨‹\n\n### printf æ ¼å¼åŒ–è¾“å‡º\n\n```\n[root@localhost ~]# printf â€˜è¾“å‡ºç±»å‹è¾“å‡ºæ ¼å¼â€™ è¾“å‡ºå†…å®¹è¾“å‡ºç±»å‹ï¼š\n%nsï¼š\tè¾“å‡ºå­—ç¬¦ä¸²ã€‚n æ˜¯æ•°å­—æŒ‡ä»£è¾“å‡ºå‡ ä¸ªå­—ç¬¦\n%niï¼š\tè¾“å‡ºæ•´æ•°ã€‚n æ˜¯æ•°å­—æŒ‡ä»£è¾“å‡ºå‡ ä¸ªæ•°å­—\n%m.nfï¼š\tè¾“å‡ºæµ®ç‚¹æ•°ã€‚m å’Œ n æ˜¯æ•°å­—ï¼ŒæŒ‡ä»£è¾“å‡ºçš„æ•´æ•°ä½æ•°å’Œå°æ•°ä½æ•°ã€‚å¦‚%8.2fä»£è¡¨  å…±è¾“å‡º 8 ä½æ•°ï¼Œå…¶ä¸­ 2 ä½æ˜¯å°æ•°ï¼Œ6 ä½æ˜¯æ•´æ•°ã€‚\nè¾“å‡ºæ ¼å¼ï¼š\n\\a:\tè¾“å‡ºè­¦å‘Šå£°éŸ³\n\\b:\tè¾“å‡ºé€€æ ¼é”®ï¼Œä¹Ÿå°±æ˜¯ Backspace é”®\n\\f:\tæ¸…é™¤å±å¹•\n\\n:\tæ¢è¡Œ\n\\r:\tå›è½¦ï¼Œä¹Ÿå°±æ˜¯ Enter é”®\n\\t:\tæ°´å¹³è¾“å‡ºé€€æ ¼é”®ï¼Œä¹Ÿå°±æ˜¯ Tab é”®\n\\v:\tå‚ç›´è¾“å‡ºé€€æ ¼é”®ï¼Œä¹Ÿå°±æ˜¯ Tab é”®\n```\n\nå»ºç«‹æµ‹è¯•æ–‡ä»¶\n\n```\nvi student.txt\nID       Name    PHP     Linux   MySQL   Average\n1        Liming   82      95      86      87.66\n2        Sc        74      96      87      85.66\n3        Tg        99      83      93      91.66\n```\n\nä¸æŒ‡å®šæ ¼å¼è¾“å‡º\n\n```\n[root@localhost ~]# printf '%s' $(cat student.txt)\nIDNamePHPLinuxMySQLAverage1Liming82958687.662Sc74968785.663Tg99839391.66\n#ä¹±ä½œä¸€é”…ç²¥\n```\n\næŒ‡å®šæ ¼å¼è¾“å‡º\n\n```\n[root@localhost ~]# printf '%s\\t %s\\t %s\\t %s\\t %s\\t %s\\t \\n' $(cat student.txt)\nID       Name    PHP     Linux   MySQL   Average\n1        Liming  82      95      86      87.66\n2        Sc      74      96      87      85.66\n3        Tg      99      83      93      91.66\n\n```\n\n### awkæ¡ä»¶\n\n```\n[root@localhost ~]# awk 'æ¡ä»¶ 1{åŠ¨ä½œ 1} æ¡ä»¶ 2{åŠ¨ä½œ 2}â€¦' æ–‡ä»¶å\n```\n\nawkæ¡ä»¶ï¼ˆPatternï¼‰\n\nä¸€èˆ¬ä½¿ç”¨å…³ç³»è¡¨è¾¾å¼ä½œä¸ºæ¡ä»¶ã€‚è¿™äº›å…³ç³»è¡¨è¾¾å¼éå¸¸å¤šï¼Œå…·ä½“å‚è€ƒè¡¨ 12-3 æ‰€ç¤ºï¼Œä¾‹å¦‚ï¼š\n\nx > 10 åˆ¤æ–­å˜é‡ x æ˜¯å¦å¤§äº 10\n\nx == y åˆ¤æ–­å˜é‡ x æ˜¯å¦ç­‰äºå˜é‡ y\n\nA ~ B\tåˆ¤æ–­å­—ç¬¦ä¸² A ä¸­æ˜¯å¦åŒ…å«èƒ½åŒ¹é… B è¡¨è¾¾å¼çš„å­å­—ç¬¦ä¸²\n\nA !~ B åˆ¤æ–­å­—ç¬¦ä¸² A ä¸­æ˜¯å¦ä¸åŒ…å«èƒ½åŒ¹é… B è¡¨è¾¾å¼çš„å­å­—ç¬¦ä¸²\n\nåŠ¨ä½œï¼ˆActionï¼‰ï¼š\n\næ ¼å¼åŒ–è¾“å‡º æµç¨‹æ§åˆ¶è¯­å¥\n\n![image-20230421143849290](../img/Shell/205fa6cf17277f79e65555cc1c7a9afe7819b814.png)\n\nawkå†…ç½®å˜é‡\n\n![image-20230421190306772](../img/Shell/2e8746e3feacb88db27cc8f033f27d3b5b52f28a.png)\n\nä¾‹å­ï¼š\n\n```\n[root@localhost ~]# awk '{printf $2 \"\\t\" $6 \"\\n\"}' student.txt\n#è¾“å‡ºç¬¬äºŒåˆ—å’Œç¬¬å…­åˆ—\n```\n\n```\nå‡è®¾æˆ‘è¦æå–æ ¹åˆ†åŒº/dev/sda1 ç¬¬äº”åˆ—çš„ä½¿ç”¨ç‡\n[root@localhost ~]# df -h\nFilesystem               Size  Used Avail Use% Mounted on\ndevtmpfs                 475M     0  475M   0% /dev\ntmpfs                    487M     0  487M   0% /dev/shm\ntmpfs                    487M  7.7M  479M   2% /run\ntmpfs                    487M     0  487M   0% /sys/fs/cgroup\n/dev/mapper/centos-root   50G  1.5G   49G   3% /\n/dev/mapper/centos-home   47G   33M   47G   1% /home\n/dev/sda1               1014M  141M  874M  14% /boot\ntmpfs                     98M     0   98M   0% /run/user/0\n[root@localhost ~]# df -h | grep \"/dev/sda1\"| awk '{print $5}'| cut -d \"%\" -f 1\n14\n```\n\nBegin\n\n```\n[root@localhost ~]# awk 'BEGIN{printf \"11111111\\n\" } {printf $2 \"\\t\" $6 \"\\n\"}' student.txt\n11111111\nName    Average\nLiming  87.66\nSc      85.66\nTg      91.66\n```\n\nEnd\n\n```\n[root@localhost ~]# awk 'END{printf \"111111111\\n\" } {printf $2 \"\\t\" $6 \"\\n\"}' student.txt\nName    Average\nLiming  87.66\nSc      85.66\nTg      91.66\n111111111\n```\n\nå‡è®¾æˆ‘æƒ³çœ‹çœ‹å¹³å‡æˆç»©å¤§äºç­‰äº 87 åˆ†çš„å­¦å‘˜æ˜¯è°\n\n```\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1       Liming  82      95      86      87.66\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n[root@localhost ~]# cat student.txt | grep -v \"Name\" | awk '$6 >= 87{print $2}'\nLiming\nTg\n\n```\n\n> åŠ å…¥äº†æ¡ä»¶ä¹‹åï¼Œåªæœ‰æ¡ä»¶æˆç«‹åŠ¨ä½œæ‰ä¼šæ‰§è¡Œï¼Œå¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™åŠ¨ä½œåˆ™ä¸è¿è¡Œã€‚é€šè¿‡è¿™ä¸ªå®éªŒï¼Œå¤§å®¶å¯ä»¥å‘ç°ï¼Œè™½ç„¶ awk æ˜¯åˆ—æå–å‘½ä»¤ï¼Œä½†æ˜¯ä¹Ÿè¦æŒ‰è¡Œæ¥è¯»å…¥çš„ã€‚è¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\n>\n> 1ï¼‰ å¦‚æœæœ‰ BEGIN æ¡ä»¶ï¼Œåˆ™å…ˆæ‰§è¡Œ BEGIN å®šä¹‰çš„åŠ¨ä½œ\n>\n> 2ï¼‰ å¦‚æœæ²¡æœ‰ BEGIN æ¡ä»¶ï¼Œåˆ™è¯»å…¥ç¬¬ä¸€è¡Œï¼ŒæŠŠç¬¬ä¸€è¡Œçš„æ•°æ®ä¾æ¬¡èµ‹äºˆ$0ã€$1ã€$2 ç­‰å˜é‡ã€‚å…¶ä¸­$0ä»£è¡¨æ­¤è¡Œçš„æ•´ä½“æ•°æ®ï¼Œ$1 ä»£è¡¨ç¬¬ä¸€å­—æ®µï¼Œ$2 ä»£è¡¨ç¬¬äºŒå­—æ®µã€‚\n>\n> 3ï¼‰ ä¾æ®æ¡ä»¶ç±»å‹åˆ¤æ–­åŠ¨ä½œæ˜¯å¦æ‰§è¡Œã€‚å¦‚æœæ¡ä»¶ç¬¦åˆï¼Œåˆ™æ‰§è¡ŒåŠ¨ä½œï¼Œå¦åˆ™è¯»å…¥ä¸‹ä¸€è¡Œæ•°æ®ã€‚å¦‚æœæ²¡æœ‰æ¡ä»¶ï¼Œåˆ™æ¯è¡Œéƒ½æ‰§è¡ŒåŠ¨ä½œã€‚\n>\n> 4ï¼‰ è¯»å…¥ä¸‹ä¸€è¡Œæ•°æ®ï¼Œé‡å¤æ‰§è¡Œä»¥ä¸Šæ­¥éª¤ã€‚\n\n```\nä¾‹å­ 2ï¼š\n[root@localhost ~]# awk '$2 ~ /Sc/ {printf $6 \"\\n\"}' student.txt\n#å¦‚æœç¬¬äºŒå­—æ®µä¸­è¾“å…¥åŒ…å«æœ‰â€œScâ€å­—ç¬¦ï¼Œåˆ™æ‰“å°ç¬¬å…­å­—æ®µæ•°æ®\n85.66\n```\n\nè¿™é‡Œè¦æ³¨æ„åœ¨ awk ä¸­ï¼Œä½¿ç”¨â€œ//â€åŒ…å«çš„å­—ç¬¦ä¸²ï¼Œawk å‘½ä»¤æ‰ä¼šæŸ¥æ‰¾ã€‚ä¹Ÿå°±æ˜¯è¯´å­—ç¬¦ä¸²å¿…é¡»ç”¨â€œ//â€åŒ…å«ï¼Œawk å‘½ä»¤æ‰èƒ½æ­£ç¡®è¯†åˆ«ã€‚\nå¦‚æœè¦æƒ³è®© awk è¯†åˆ«å­—ç¬¦ä¸²ï¼Œå¿…é¡»ä½¿ç”¨â€œ//â€åŒ…å«ï¼Œä¾‹å¦‚ï¼š\n\n```\n[root@localhost ~]# awk '/Liming/ {print}' student.txt\n1       Liming  82      95      86      87.66\n#æ‰“å° Liming çš„æˆç»©\n```\n\nå½“ä½¿ç”¨ df å‘½ä»¤æŸ¥çœ‹åˆ†åŒºä½¿ç”¨æƒ…å†µæ˜¯ï¼Œå¦‚æœæˆ‘åªæƒ³æŸ¥çœ‹çœŸæ­£çš„ç³»ç»Ÿåˆ†åŒºçš„ä½¿ç”¨çŠ¶å†µï¼Œè€Œä¸æƒ³æŸ¥çœ‹å…‰ç›˜å’Œä¸´æ—¶åˆ†åŒºçš„ä½¿ç”¨çŠ¶å†µï¼Œåˆ™å¯ä»¥ï¼š\n\n```\n[root@localhost ~]# df -h | awk '/sda[0-9]/ {printf $1 \"\\t\" $5 \"\\n\"} '\n/dev/sda1       14%\n#æŸ¥è¯¢åŒ…å«æœ‰ sda æ•°å­—çš„è¡Œï¼Œå¹¶æ‰“å°ç¬¬ä¸€å­—æ®µå’Œç¬¬äº”å­—æ®µ\n```\n\n\n\næŸ¥çœ‹/etc/passwdæ–‡ä»¶\n\n```\n[root@localhost ~]# useradd user1\n[root@localhost ~]# useradd user2\n[root@localhost ~]# cat /etc/passwd | grep \"/bin/bash\"\nroot:x:0:0:root:/root:/bin/bash\nuser1:x:1000:1000::/home/user1:/bin/bash\nuser2:x:1001:1001::/home/user2:/bin/bash\n[root@localhost ~]# cat /etc/passwd | grep \"/bin/bash\" |  awk '{FS=\":\"} {print $1}'\nroot:x:0:0:root:/root:/bin/bash\nuser1\nuser2\n#ç¬¬ä¸€è¡Œrootå¥½åƒæ²¡æœ‰ä»¥å†’å·ä¸ºåˆ†å‰²è¯»å–ç¬¬ä¸€åˆ—\næ˜¯å› ä¸ºawk å…ˆæŠŠç¬¬ä¸€è¡Œæ•°æ®è¯»å–äº†\næ‰è¿›è¡Œ{FS=\":\"}\nç›´åˆ°ä¸Šä¸€æ­¥ä¹‹åï¼Œæ‰å‘ç°è¦ä»¥å†’å·ä½œä¸ºåˆ†éš”ç¬¦\nåé¢çš„user1 user2 æ‰æ­£å¸¸\n###æ‰€ä»¥æ­£ç¡®å†™æ³•æ˜¯BEGIN {FS=\":\"}  åœ¨è¯»å–æ•°æ®ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ{FS=\":\"}\n[root@localhost ~]# cat /etc/passwd | grep \"/bin/bash\" |  awk 'BEGIN {FS=\":\"} {print $1}'\nroot\nuser1\nuser2\n```\n\n```\n[root@localhost ~]# cat /etc/passwd | grep \"/bin/bash\" | awk 'BEGIN{FS=\":\"} $3==\"1000\" {print $1}'\nuser1\nåˆ¤æ–­æ˜¯å¦ç›¸ç­‰ è¦ç”¨åŒï¼å·\n```\n\n```\n[root@localhost ~]# cat /etc/passwd | grep \"/bin/bash\" | \\\n> awk 'BEGIN {FS=\":\"} {printf $1 \"\\t\" $3 \"\\t è¡Œå·ï¼š\" NR \"\\t å­—æ®µæ•°ï¼š\" NF \"\\n\"}'\nroot    0        è¡Œå·ï¼š1         å­—æ®µæ•°ï¼š7\nuser1   1000     è¡Œå·ï¼š2         å­—æ®µæ•°ï¼š7\nuser2   1001     è¡Œå·ï¼š3         å­—æ®µæ•°ï¼š7\n\n#å¦‚æœæˆ‘åªæƒ³çœ‹sshd\n[root@localhost ~]# cat /etc/passwd | awk 'BEGIN {FS=\":\"} $1==\"sshd\" {printf $1 \"\\t\" $3 \"\\t è¡Œå·ï¼š\"NR \"\\t å­—æ®µæ•°ï¼š\"NF \"\\n\"}'\nsshd    74       è¡Œå·ï¼š20        å­—æ®µæ•°ï¼š7\n```\n\n## Sed\n\nsedå‘½ä»¤\n\n```\n[root@localhost ~]# sed [é€‰é¡¹] â€˜[åŠ¨ä½œ]â€™ æ–‡ä»¶å\né€‰é¡¹ï¼š\n-nï¼š  ä¸€èˆ¬ sed å‘½ä»¤ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½è¾“å‡ºåˆ°å±å¹•ï¼Œå¦‚æœåŠ å…¥æ­¤é€‰æ‹©ï¼Œåˆ™åªä¼šæŠŠç»è¿‡ sed å‘½ä»¤å¤„ç†\t\tçš„è¡Œè¾“å‡ºåˆ°å±å¹•ã€‚\n-eï¼š\tå…è®¸å¯¹è¾“å…¥æ•°æ®åº”ç”¨å¤šæ¡ sed å‘½ä»¤ç¼–è¾‘ã€‚\n-f     è„šæœ¬æ–‡ä»¶åï¼š ä» sed è„šæœ¬ä¸­è¯»å…¥ sed æ“ä½œã€‚å’Œ awk å‘½ä»¤çš„-f éå¸¸ç±»ä¼¼ã€‚\n-rï¼š\tåœ¨ sed ä¸­æ”¯æŒæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ã€‚\n-iï¼š\tç”¨ sed çš„ä¿®æ”¹ç»“æœç›´æ¥ä¿®æ”¹è¯»å–æ•°æ®çš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç”±å±å¹•è¾“å‡ºåŠ¨ä½œï¼š\na \\ï¼š è¿½åŠ ï¼Œåœ¨å½“å‰è¡Œåæ·»åŠ ä¸€è¡Œæˆ–å¤šè¡Œã€‚æ·»åŠ å¤šè¡Œæ—¶ï¼Œé™¤æœ€å ä¸€è¡Œå¤–ï¼Œ\næ¯è¡Œæœ«å°¾éœ€è¦ç”¨â€œ\\â€ä»£è¡¨æ•°æ®æœªå®Œç»“ã€‚\nc \\ï¼š è¡Œæ›¿æ¢ï¼Œç”¨ c åé¢çš„å­—ç¬¦ä¸²æ›¿æ¢åŸæ•°æ®è¡Œï¼Œæ›¿æ¢å¤šè¡Œæ—¶ï¼Œé™¤æœ€åä¸€è¡Œå¤–ï¼Œæ¯è¡Œæœ«å°¾éœ€ç”¨â€œ\\â€ä»£è¡¨æ•°æ®æœªå®Œç»“ã€‚\ni \\ï¼šæ’å…¥ï¼Œåœ¨å½“æœŸè¡Œå‰æ’å…¥ä¸€è¡Œæˆ–å¤šè¡Œã€‚æ’å…¥å¤šè¡Œæ—¶ï¼Œé™¤æœ€å ä¸€è¡Œå¤–ï¼Œæ¯è¡Œæœ«å°¾éœ€è¦ç”¨â€œ\\â€ä»£è¡¨æ•°æ®æœªå®Œç»“ã€‚\ndï¼šåˆ é™¤ï¼Œåˆ é™¤æŒ‡å®šçš„è¡Œã€‚\n```\n\næ‰“å°p\n\n```\n[root@localhost ~]# sed 2p student.txt\nID      Name    PHP     Linux   MySQL   Average\n1       Liming  82      95      86      87.66\n1       Liming  82      95      86      87.66\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n#ä½ ä¼šå‘ç°ç¬¬äºŒè¡Œå¤šæ‰“å°äº†ä¸€éï¼Œåªæœ‰åŠ -næ‰ä¸ä¼š\n[root@localhost ~]# sed -n '2p' student.txt\n1       Liming  82      95      86      87.66\n```\n\nåˆ é™¤dï¼ˆåˆ é™¤2åˆ°4è¡Œï¼‰\n\næ­¤æ“ä½œå¹¶ä¸ä¼šå†™å…¥æ–‡ä»¶ä¸­ï¼Œåªæ˜¯è¾“å‡ºçš„æ—¶å€™åˆ é™¤äº†\n\n```\n[root@localhost ~]# sed '2,4d' student.txt\nID      Name    PHP     Linux   MySQL   Average\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1       Liming  82      95      86      87.66\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\nè‹¥æƒ³ç›´æ¥ä¿®æ”¹è¯»å–æ•°æ®åˆ°æ–‡ä»¶çš„è¯åŠ å…¥ -i\n[root@localhost ~]# sed -i '2,4d' student.txt\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n\n```\n\nå‰è¿½åŠ i\n\n```\n#åœ¨ç¬¬äºŒè¡Œå‰é¢æ’å…¥å†…å®¹\n[root@localhost ~]# sed '2i å‰é¢æ–°å†…å®¹1  \\\n> å‰é¢æ–°å†…å®¹ï¼ˆå¤§é‡ï¼‰ 2222222222222222222 ' student.txt\nID      Name    PHP     Linux   MySQL   Average\nå‰é¢æ–°å†…å®¹1\nå‰é¢æ–°å†…å®¹ï¼ˆå¤§é‡ï¼‰ 2222222222222222222\n1       Liming  82      95      86      87.66\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n```\n\nåè¿½åŠ a\n\n```\nåœ¨ç¬¬äºŒè¡Œåè¿½åŠ å†…å®¹\n[root@localhost ~]# sed -i '2a æ–°å†…å®¹' student.txt\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1       Liming  82      95      86      87.66\næ–°å†…å®¹\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n```\n\næ›¿æ¢c\n\n```\n#æŠŠ2è¡Œæ–°å†…å®¹æ›¿æ¢ä¸ºå…¶ä»–æ•°æ®\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1       Liming  82      95      86      87.66\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n[root@localhost ~]# sed '2c 0 xiaoshan 83 55 11 44.2' student.txt\nID      Name    PHP     Linux   MySQL   Average\n0 xiaoshan 83 55 11 44.2\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n#æˆ‘å‰é¢æ˜¯ç©ºæ ¼ï¼Œè‹¥å¯¹é½ç”¨\\tä¸”\\tåæ²¡æœ‰ç©ºæ ¼\n[root@localhost ~]# sed '2c 0 \\txiaos\\t83 \\t55 \\t11 \\t44.2' student.txt\nID      Name    PHP     Linux   MySQL   Average\n0       xiaos   83      55      11      44.2\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n```\n\nå¤šå‘½ä»¤æ‰§è¡Œe\n\n```\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\nå‰é¢æ–°å†…å®¹1\nå‰é¢æ–°å†…å®¹1\n1       Liming  82      95      86      87.66\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n##åŒæ—¶åˆ é™¤ç¬¬äºŒå’Œç¬¬ä¸‰è¡Œ\n[root@localhost ~]# sed  -i -e '2d;3d' student.txt\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1       Liming  82      95      86      87.66\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n```\n\næ›¿æ¢å­—ç¬¦ä¸² s/æ—§å†…å®¹/æ–°å†…å®¹/g\n\n```\n#æ›¿æ¢Limingä¸ºLm\n[root@localhost ~]# sed -i 's/Liming/Lm/g' student.txt\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1       Lm      82      95      86      87.66\n2       Sc      74      96      87      85.66\n3       Tg      99      83      93      91.66\n#å¤šå‘½ä»¤æ‰§è¡Œï¼Œåˆ†å·éš”å¼€\n[root@localhost ~]# sed -i 's/Sc/sc1/g; s/Tg/Eg/g' student.txt\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1       Lm      82      95      86      87.66\n2       sc1     74      96      87      85.66\n3       Eg      99      83      93      91.66\n#ä¹Ÿå¯ä»¥å¤šè¡Œæ‰§è¡Œ\n[root@localhost ~]# sed -i 's/Sc/sc1/g\ns/Tg/Eg/g' student.txt\n#æ›¿æ¢å­—ç¬¦ä¸²ä¸ºç©ºå€¼\n[root@localhost ~]# sed -i 's/Lm//g' student.txt\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1                 82      95      86      87.66\n2       sc1     74      96      87      85.66\n3       Eg      99      83      93      91.66\n\n```\n\n## å­—ç¬¦ä¸²å¤„ç†å‘½ä»¤\n\nsortæ’åºå‘½ä»¤\n\n```\n[root@localhost ~]# sort [é€‰é¡¹] æ–‡ä»¶åé€‰é¡¹ï¼š\n-fï¼š\tå¿½ç•¥å¤§å°å†™\n-bï¼š\tå¿½ç•¥æ¯è¡Œå‰é¢çš„ç©ºç™½éƒ¨åˆ†\n-nï¼š\tä»¥æ•°å€¼å‹è¿›è¡Œæ’åºï¼Œé»˜è®¤ä½¿ç”¨å­—ç¬¦ä¸²å‹æ’åº\n-rï¼š\tåå‘æ’åº\n-uï¼š\tåˆ é™¤é‡å¤è¡Œã€‚å°±æ˜¯ uniq å‘½ä»¤\n-tï¼š\tæŒ‡å®šåˆ†éš”ç¬¦ï¼Œé»˜è®¤æ˜¯åˆ†éš”ç¬¦æ˜¯åˆ¶è¡¨ç¬¦\n-k n[,m]ï¼š æŒ‰ç…§æŒ‡å®šçš„å­—æ®µèŒƒå›´æ’åºã€‚ä»ç¬¬ n å­—æ®µå¼€å§‹ï¼Œm å­—æ®µç»“æŸï¼ˆé»˜è®¤åˆ°è¡Œå°¾ï¼‰\n```\n\n```\n#é»˜è®¤æŒ‰å¼€å¤´å­—ç¬¦æ’åº\n[root@localhost ~]# sort /etc/passwd\nabrt:x:173:173::/etc/abrt:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nbin:x:1:1:bin:/bin:/sbin/nologin\nchrony:x:997:995::/var/lib/chrony:/sbin/nologin\n#åå‘æ’åº\n[root@localhost ~]# sort -r /etc/passwd\nuser2:x:1001:1001::/home/user2:/bin/bash\nuser1:x:1000:1000::/home/user1:/bin/bash\ntcpdump:x:72:72::/:/sbin/nologin\nsystemd-network:x:192:192:systemd Network Management:/:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\n```\n\næŒ‡å®šå­—æ®µæ’åº\n\n```\n#å¦‚UID\n[root@localhost ~]# sort -t \":\" -k 3,3 /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\nuser1:x:1000:1000::/home/user1:/bin/bash\nuser2:x:1001:1001::/home/user2:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\nftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\nabrt:x:173:173::/etc/abrt:/sbin/nologin\nsystemd-network:x:192:192:systemd Network Management:/:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\n#ä½ ä¼šå‘ç°ä»–å…ˆæ’ç¬¬ä¸€ä½æ•°å­—1ï¼Œå†æ’2ã€‚ã€\n#å°±æ˜¯1  12  13  åˆ°  2  22 23 å¹¶æ²¡æœ‰123456æ’ä¸‹å»\n#æ‰€ä»¥è¦åŠ ä¸Š -n    -nï¼šä»¥æ•°å€¼å‹è¿›è¡Œæ’åºï¼Œé»˜è®¤ä½¿ç”¨å­—ç¬¦ä¸²å‹æ’åº\n[root@localhost ~]# sort -nt \":\" -k 3,3 /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\nhalt:x:7:0:halt:/sbin:/sbin/halt\nmail:x:8:12:mail:/var/spool/mail:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\n```\n\nuniqå–æ¶ˆé‡å¤è¡Œ\n\nuniq å‘½ä»¤æ˜¯ç”¨æ¥å–æ¶ˆé‡å¤è¡Œçš„å‘½ä»¤ï¼Œå…¶å®å’Œâ€œsort -uâ€é€‰é¡¹æ˜¯ä¸€æ ·çš„ã€‚å‘½ä»¤æ ¼å¼å¦‚ä¸‹\n\n```\n[root@localhost ~]# uniq [é€‰é¡¹] æ–‡ä»¶åé€‰é¡¹ï¼š\n-iï¼š\tå¿½ç•¥å¤§å°å†™\n```\n\n```\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1               82      95      86      87.66\n1               82      95      86      87.66\n2       sc1     74      96      87      85.66\n3       Eg      99      83      93      91.66\n[root@localhost ~]# uniq student.txt\nID      Name    PHP     Linux   MySQL   Average\n1               82      95      86      87.66\n2       sc1     74      96      87      85.66\n3       Eg      99      83      93      91.66\n```\n\nwcç»Ÿè®¡å‘½ä»¤\n\n```\n[root@localhost ~]# wc [é€‰é¡¹] æ–‡ä»¶åé€‰é¡¹ï¼š\n-lï¼š\tåªç»Ÿè®¡è¡Œæ•°\n-wï¼š\tåªç»Ÿè®¡å•è¯æ•°\n-mï¼š\tåªç»Ÿè®¡å­—ç¬¦æ•°\n```\n\n```\n[root@localhost ~]# cat student.txt\nID      Name    PHP     Linux   MySQL   Average\n1               82      95      86      87.66\n1               82      95      86      87.66\n2       sc1     74      96      87      85.66\n3       Eg      99      83      93      91.66\n[root@localhost ~]# wc -l student.txt\n5 student.txt\n[root@localhost ~]# wc -w student.txt\n28 student.txt\n[root@localhost ~]# wc -m student.txt\n109 student.txt\n\n```\n\n## æ¡ä»¶åˆ¤æ–­ï¼ˆtestå‘½ä»¤ï¼‰\n\n1. æŒ‰ç…§æ–‡ä»¶ç±»å‹è¿›è¡Œåˆ¤æ–­(test)\n\n| æµ‹è¯•é€‰é¡¹ | ä½œ\tç”¨                                                     |\n| -------- | ------------------------------------------------------------ |\n| -b æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºå—è®¾å¤‡æ–‡ä»¶ï¼ˆæ˜¯å—è®¾å¤‡æ–‡ä»¶ä¸ºçœŸï¼‰ |\n| -c æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºå­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼ˆæ˜¯å­—ç¬¦è®¾å¤‡æ–‡ä»¶ä¸ºçœŸï¼‰ |\n| -d æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºç›®å½•æ–‡ä»¶ï¼ˆæ˜¯ç›®å½•ä¸ºçœŸï¼‰         |\n| -e æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆå­˜åœ¨ä¸ºçœŸï¼‰                               |\n| -f æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶ï¼ˆæ˜¯æ™®é€šæ–‡ä»¶ä¸ºçœŸï¼‰     |\n| -L æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥æ–‡ä»¶ï¼ˆæ˜¯ç¬¦å·é“¾æ¥æ–‡ä»¶ä¸ºçœŸï¼‰ |\n| -p æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºç®¡é“æ–‡ä»¶ï¼ˆæ˜¯ç®¡é“æ–‡ä»¶ä¸ºçœŸï¼‰     |\n| -s æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºéç©ºï¼ˆéç©ºä¸ºçœŸï¼‰               |\n| -S æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºå¥—æ¥å­—æ–‡ä»¶ï¼ˆæ˜¯å¥—æ¥å­—æ–‡ä»¶ä¸ºçœŸï¼‰ |\n\n```\n[root@localhost ~]# ls\nanaconda-ks.cfg  file.txt  file.txtn  netstart.bak  student.txt\nç¬¬ä¸€ç§æ ¼å¼ï¼š#-e åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆå­˜åœ¨ä¸ºçœŸï¼‰\n[root@localhost ~]# test -e file.txt\n#è¾“å‡ºä¸º0å³ä¸ºçœŸ\n[root@localhost ~]# echo $?\n0\nç¬¬ä¸€ç§æ ¼å¼ï¼š#-e åˆ¤æ–­ä¸å­˜åœ¨çš„æ–‡ä»¶\n[root@localhost ~]# [ -e abc ]\n[root@localhost ~]# echo $?\n1\n#è¾“å‡ºä¸ºé0å³ä¸ºå‡\n```\n\n```\n###åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºç›®å½•æ–‡ä»¶\n[root@localhost ~]# [ -d student.txt ] && echo yes || echo no\nno\n###åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶\n[root@localhost ~]# [ -f student.txt ] && echo yes || echo no\nyes\n\n```\n\n```\n###åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰æ•°æ®\n[root@localhost ~]# [ -s abc ] && echo yes || echo no\nno\n[root@localhost ~]# echo 111 >> abc\n[root@localhost ~]# [ -s abc ] && echo yes || echo no\nyes\n```\n\n2. æŒ‰ç…§æ–‡ä»¶æƒé™åˆ¤æ–­\n\n| æµ‹è¯•é€‰é¡¹ | ä½œ    ç”¨                                                     |\n| -------- | ------------------------------------------------------------ |\n| -r æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦è¯¥æ–‡ä»¶æ‹¥æœ‰è¯»æƒé™ï¼ˆæœ‰è¯»æƒé™ä¸ºçœŸï¼‰ |\n| -w æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦è¯¥æ–‡ä»¶æ‹¥æœ‰å†™æƒé™ï¼ˆæœ‰å†™æƒé™ä¸ºçœŸï¼‰ |\n| -x æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦è¯¥æ–‡ä»¶æ‹¥æœ‰æ‰§è¡Œæƒé™ï¼ˆæœ‰æ‰§è¡Œæƒé™ä¸ºçœŸï¼‰ |\n| -u æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦è¯¥æ–‡ä»¶æ‹¥æœ‰  SUID æƒé™ï¼ˆæœ‰ SUID æƒé™ä¸ºçœŸï¼‰ |\n| -g æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦è¯¥æ–‡ä»¶æ‹¥æœ‰  SGID æƒé™ï¼ˆæœ‰ SGID æƒé™ä¸ºçœŸï¼‰ |\n| -k æ–‡ä»¶  | åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯å¦è¯¥æ–‡ä»¶æ‹¥æœ‰  SBit æƒé™ï¼ˆæœ‰ SBit æƒé™ä¸ºçœŸï¼‰ |\n\n```\n##åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰å†™çš„æƒé™\n[root@localhost ~]# [ -w abc ] && echo yes || echo no\nyes\n[root@localhost ~]# [ -u abc ] && echo yes || echo no\nno\n##åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰SUIDçš„æƒé™\n[root@localhost ~]# chmod u+s abc\n[root@localhost ~]# [ -u abc ] && echo yes || echo no\nyes\n[root@localhost ~]# ll\ntotal 24\n-rwSr--r--  1 root root    4 May  2 03:02 abc\n\n```\n\n3. ä¸¤ä¸ªæ–‡ä»¶ä¹‹é—´è¿›è¡Œæ¯”è¾ƒ\n\n| æµ‹è¯•é€‰é¡¹          | ä½œ    ç”¨                                                     |\n| :---------------- | ------------------------------------------------------------ |\n| æ–‡ä»¶ 1 -nt æ–‡ä»¶ 2 | åˆ¤æ–­æ–‡ä»¶ 1 çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ¯”æ–‡ä»¶ 2 çš„æ–°ï¼ˆå¦‚æœæ–°åˆ™ä¸ºçœŸï¼‰       |\n| æ–‡ä»¶ 1 -ot æ–‡ä»¶ 2 | åˆ¤æ–­æ–‡ä»¶ 1 çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ¯”æ–‡ä»¶ 2 çš„æ—§ï¼ˆå¦‚æœæ—§åˆ™ä¸ºçœŸï¼‰       |\n| æ–‡ä»¶ 1 -ef æ–‡ä»¶ 2 | åˆ¤æ–­æ–‡ä»¶ 1 æ˜¯å¦å’Œæ–‡ä»¶ 2 çš„ Inode å·ä¸€è‡´ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦  ä¸ºåŒä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªåˆ¤æ–­ç”¨äºåˆ¤æ–­ç¡¬é“¾æ¥æ˜¯å¾ˆå¥½çš„æ–¹æ³• |\n\n```\n##åˆ¤æ–­ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦æ˜¯ç¡¬é“¾æ¥\n[root@localhost ~]# ln /root/abc /tmp/abc\n[root@localhost ~]# ll /tmp/abc\n-rw-r--r-- 2 root root 4 May  2 03:02 /tmp/abc\n\n[root@localhost ~]# [ /root/abc -ef /tmp/abc ] && echo yes || echo no\nyes\n\n```\n\n4. ä¸¤ä¸ªæ•´æ•°ä¹‹é—´æ¯”è¾ƒ\n\n| æµ‹è¯•é€‰é¡¹          | ä½œ    ç”¨                                      |\n| ----------------- | --------------------------------------------- |\n| æ•´æ•° 1 -eq æ•´æ•° 2 | åˆ¤æ–­æ•´æ•° 1 æ˜¯å¦å’Œæ•´æ•° 2 ç›¸ç­‰ï¼ˆç›¸ç­‰ä¸ºçœŸï¼‰      |\n| æ•´æ•° 1 -ne æ•´æ•° 2 | åˆ¤æ–­æ•´æ•° 1 æ˜¯å¦å’Œæ•´æ•° 2 ä¸ç›¸ç­‰ï¼ˆä¸ç›¸ç­‰ä½ç½®ï¼‰  |\n| æ•´æ•° 1 -gt æ•´æ•° 2 | åˆ¤æ–­æ•´æ•° 1 æ˜¯å¦å¤§äºæ•´æ•° 2ï¼ˆå¤§äºä¸ºçœŸï¼‰         |\n| æ•´æ•° 1 -lt æ•´æ•° 2 | åˆ¤æ–­æ•´æ•° 1 æ˜¯å¦å°äºæ•´æ•° 2ï¼ˆå°äºä½ç½®ï¼‰         |\n| æ•´æ•° 1 -ge æ•´æ•° 2 | åˆ¤æ–­æ•´æ•° 1 æ˜¯å¦å¤§äºç­‰äºæ•´æ•° 2ï¼ˆå¤§äºç­‰äºä¸ºçœŸï¼‰ |\n| æ•´æ•° 1 -le æ•´æ•° 2 | åˆ¤æ–­æ•´æ•° 1 æ˜¯å¦å°äºç­‰äºæ•´æ•° 2ï¼ˆå°äºç­‰äºä¸ºçœŸï¼‰ |\n\n-eq: equal : ç›¸ç­‰               -ne: not equal : ä¸ç›¸ç­‰\n\n-gt: greater than : å¤§äº       -lt: less than : å°äº\n\n```\n##åˆ¤æ–­æ•´æ•°1æ˜¯å¦ç­‰äºæ•´æ•°2\n[root@localhost ~]# [ 22 -eq 22 ] && echo yes || echo no\nyes\n##åˆ¤æ–­æ•´æ•°1æ˜¯å¦å°äºæ•´æ•°2\n[root@localhost ~]# [ 22 -lt 22 ] && echo yes || echo no\nno\n[root@localhost ~]# [ 21 -lt 22 ] && echo yes || echo no\nyes\n\n```\n\n5. å­—ç¬¦ä¸²åˆ¤æ–­\n\n| æµ‹è¯•é€‰é¡¹         | ä½œ    ç”¨                                            |\n| ---------------- | --------------------------------------------------- |\n| -z å­—ç¬¦ä¸²        | åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼ˆä¸ºç©ºè¿”å›çœŸï¼‰                    |\n| -n å­—ç¬¦ä¸²        | åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºéç©ºï¼ˆéç©ºè¿”å›çœŸï¼‰                  |\n| å­—ä¸² 1 ==å­—ä¸² 2  | åˆ¤æ–­å­—ç¬¦ä¸²  1 æ˜¯å¦å’Œå­—ç¬¦ä¸² 2 ç›¸ç­‰ï¼ˆç›¸ç­‰è¿”å›çœŸï¼‰     |\n| å­—ä¸² 1 != å­—ä¸² 2 | åˆ¤æ–­å­—ç¬¦ä¸²  1 æ˜¯å¦å’Œå­—ç¬¦ä¸² 2 ä¸ç›¸ç­‰ï¼ˆä¸ç›¸ç­‰è¿”å›çœŸï¼‰ |\n\n```\n##åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰\n[root@localhost ~]# aa=11\n[root@localhost ~]# bb=22\n[root@localhost ~]# [ \"$aa\" == 8 ] && echo yes || echo no\nno\n[root@localhost ~]# [ $aa == $bb ] && echo yes || echo no\nno\n[root@localhost ~]# [ \"$aa\" == 11 ] && echo yes || echo no\nyes\n##åˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºç©º\n[root@localhost ~]# name=xx\n[root@localhost ~]# [ -z $name ] && echo yes || echo no\nno\n```\n\n6. å¤šé‡æ¡ä»¶åˆ¤æ–­\n\n| æµ‹è¯•é€‰é¡¹         | ä½œ    ç”¨                                              |\n| ---------------- | ----------------------------------------------------- |\n| åˆ¤æ–­ 1 -a åˆ¤æ–­ 2 | é€»è¾‘ä¸ï¼Œåˆ¤æ–­  1 å’Œåˆ¤æ–­ 2 éƒ½æˆç«‹ï¼Œæœ€ç»ˆçš„ç»“æœæ‰ä¸ºçœŸ     |\n| åˆ¤æ–­ 1 -o åˆ¤æ–­ 2 | é€»è¾‘æˆ–ï¼Œåˆ¤æ–­  1 å’Œåˆ¤æ–­ 2 æœ‰ä¸€ä¸ªæˆç«‹ï¼Œæœ€ç»ˆçš„ç»“æœå°±ä¸ºçœŸ |\n| ï¼åˆ¤æ–­           | é€»è¾‘éï¼Œä½¿åŸå§‹çš„åˆ¤æ–­å¼å–å                            |\n\n```\n#å…ˆç»™aaèµ‹å€¼\n[root@localhost ~]# aa=24\n#-nå…ˆåˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œæ˜æ˜¾ä¸ä¸ºç©ºåˆ™ä¸ºçœŸï¼ŒçœŸå°±ç»§ç»­åˆ¤æ–­æ˜¯å¦å¤§äº23\n[root@localhost ~]# [ -n \"$aa\" -a \"$aa\" -gt 23 ] && echo yes || echo no\nyes\n```\n\n```\n##é€»è¾‘é\n[root@localhost ~]# [ ! -n \"$aa\" ] && echo \"yes\" || echo \"no\"\nno\n#æœ¬æ¥â€œ-nâ€é€‰é¡¹æ˜¯å˜é‡ aa ä¸ä¸ºç©ºï¼Œè¿”å›å€¼å°±æ˜¯çœŸã€‚\n#åŠ å…¥ï¼ä¹‹åï¼Œåˆ¤æ–­å€¼å°±ä¼šå–åï¼Œæ‰€ä»¥å½“å˜é‡ aa æœ‰å€¼æ—¶ï¼Œè¿”å›å€¼æ˜¯å‡\n\n```\n\n## æµç¨‹æ§åˆ¶\n\n### ifæ¡ä»¶åˆ¤æ–­\n\n1. å•åˆ†æ”¯ if æ¡ä»¶è¯­å¥\n\nå•åˆ†æ”¯æ¡ä»¶è¯­å¥æœ€ä¸ºç®€å•ï¼Œå°±æ˜¯åªæœ‰ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœç¬¦åˆæ¡ä»¶åˆ™æ‰§è¡ŒæŸä¸ªç¨‹åºï¼Œå¦åˆ™ä»€ä¹ˆäº‹æƒ…éƒ½ä¸åšã€‚è¯­æ³•å¦‚ä¸‹ï¼š\n\n```\nif [ æ¡ä»¶åˆ¤æ–­å¼ ];then\n     ç¨‹åº\nfi\n```\n\nå•åˆ†æ”¯æ¡ä»¶è¯­å¥éœ€è¦æ³¨æ„å‡ ä¸ªç‚¹ï¼š\n\nÂ·if è¯­å¥ä½¿ç”¨ fi ç»“å°¾ï¼Œå’Œä¸€èˆ¬è¯­è¨€ä½¿ç”¨å¤§æ‹¬å·ç»“å°¾ä¸åŒ\n\nÂ· [ æ¡ä»¶åˆ¤æ–­å¼ ]å°±æ˜¯ä½¿ç”¨ test å‘½ä»¤åˆ¤æ–­ï¼Œæ‰€ä»¥ä¸­æ‹¬å·å’Œæ¡ä»¶åˆ¤æ–­å¼ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼\n\nÂ· then åé¢è·Ÿç¬¦åˆæ¡ä»¶ä¹‹åæ‰§è¡Œçš„ç¨‹åºï¼Œå¯ä»¥æ”¾åœ¨[]ä¹‹åï¼Œç”¨â€œï¼›â€åˆ†å‰²ã€‚ä¹Ÿå¯ä»¥æ¢è¡Œå†™å…¥ï¼Œå°±ä¸éœ€è¦â€œï¼›â€äº†ï¼Œæ¯”å¦‚å•åˆ†æ”¯ if è¯­å¥è¿˜å¯ä»¥è¿™æ ·å†™ï¼š\n\n```\nif [ æ¡ä»¶åˆ¤æ–­å¼ ]\n   then\n     ç¨‹åº\nfi\n```\n\nä¾‹å­ï¼šåˆ¤æ–­sda1å¹¶è®¾ç½®è­¦å‘Šä¿¡æ¯\n\n```\n[root@localhost ~]# df -h\nFilesystem               Size  Used Avail Use% Mounted on\n/dev/sda1               1014M  141M  874M  14% /boot\n[root@localhost ~]# df -h | grep \"/dev/sda1\" | awk '{print $5}' | cut -d \"%\" -f 1\n14\n\n\n[root@localhost ~]# vi if1.sh\n#!/bin/bash\n#ç»Ÿè®¡åˆ†åŒºä½¿ç”¨ç‡\nrate=$(df -h | grep \"/dev/sda1\" | awk '{print $5}'| cut -d \"%\" -f 1)\n\n#æŠŠæ ¹åˆ†åŒºä½¿ç”¨ç‡ä½œä¸ºå˜é‡å€¼èµ‹äºˆå˜é‡rate\nif [ $rate -ge 14 ]\n#åˆ¤æ–­ rate çš„å€¼å¦‚æœå¤§äºç­‰äº 14ï¼Œåˆ™æ‰§è¡Œthen ç¨‹åº\nthen\necho \"Warning! /dev/sda1 å¿«æ»¡äº†!\"\n#æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚åœ¨å®é™…å·¥ä½œä¸­ï¼Œä¹Ÿå¯ä»¥å‘ç®¡ç†å‘˜å‘é€é‚®ä»¶ã€‚\nfi\n[root@localhost ~]# sh if1.sh\nWarning! /dev/sda1 å¿«æ»¡äº†!\n```\n\n2. åŒåˆ†æ”¯ifè¯­å¥\n\n```\nif [ æ¡ä»¶åˆ¤æ–­å¼ ]\n       then\n\t\tæ¡ä»¶æˆç«‹æ—¶ï¼Œæ‰§è¡Œçš„ç¨‹åº\n\telse\n\t\tæ¡ä»¶ä¸æˆç«‹æ—¶ï¼Œæ‰§è¡Œçš„å¦ä¸€ä¸ªç¨‹åº\nfi\n```\n\næ•°æ®å¤‡ä»½çš„ä¾‹å­\n\n```\n#å¤‡ä»½mysqlæ•°æ®åº“ï¼ˆå¹¶ä¸å®Œå–„ï¼Œä½†å¯ä»¥ä½¿ç”¨ï¼‰\n[root@localhost ~]# vi sh/bakmysql.sh \n#!/bin/bash\n#å¤‡ä»½ mysql æ•°æ®åº“ã€‚\n#åŒæ­¥ç³»ç»Ÿæ—¶é—´\nntpdate asia.pool.ntp.org &>/dev/null\n#æŠŠå½“å‰ç³»ç»Ÿæ—¶é—´æŒ‰ç…§â€œå¹´æœˆæ—¥â€æ ¼å¼èµ‹äºˆå˜é‡date\ndate=$(date +%y%m%d)\n#ç»Ÿè®¡ mysql æ•°æ®åº“çš„å¤§å°ï¼Œå¹¶æŠŠå¤§å°èµ‹äºˆsize å˜é‡\nsize=$(du -sh /var/lib/mysql)\n\nif [ -d /tmp/dbbak ]\n    #åˆ¤æ–­å¤‡ä»½ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œæ˜¯å¦ä¸ºç›®å½•\n  then\n    #å¦‚æœåˆ¤æ–­ä¸ºçœŸï¼Œæ‰§è¡Œä»¥ä¸‹è„šæœ¬\n\techo \"Date : $date!\" > /tmp/dbbak/dbinfo.txt\n\t#æŠŠå½“å‰æ—¥æœŸå†™å…¥ä¸´æ—¶æ–‡ä»¶\n\techo \"Data size : $size\" >> /tmp/dbbak/dbinfo.txt\n\t#æŠŠæ•°æ®åº“å¤§å°å†™å…¥ä¸´æ—¶æ–‡ä»¶\n\tcd /tmp/dbbak\n\t#è¿›å…¥å¤‡ä»½ç›®å½•\n\ttar -zcf mysql-lib-$date.tar.gz /var/lib/mysql dbinfo.txt &>/dev/null\n\t#æ‰“åŒ…å‹ç¼©æ•°æ®åº“ä¸ä¸´æ—¶æ–‡ä»¶ï¼ŒæŠŠæ‰€æœ‰è¾“å‡ºä¸¢å…¥åƒåœ¾ç®±ï¼ˆä¸æƒ³çœ‹åˆ°ä»»ä½•è¾“å‡ºï¼‰\n\trm -rf /tmp/dbbak/dbinfo.txt\n\t#åˆ é™¤ä¸´æ—¶æ–‡ä»¶\n  else\n\tmkdir /tmp/dbbak\n\t#å¦‚æœåˆ¤æ–­ä¸ºå‡ï¼Œåˆ™å»ºç«‹å¤‡ä»½ç›®å½•\n\techo \"Date : $date!\" > /tmp/dbbak/dbinfo.txt echo \"Data size : $size\" >> /tmp/dbbak/dbinfo.txt #æŠŠæ—¥æœŸå’Œæ•°æ®åº“å¤§å°ä¿å­˜å¦‚ä¸´æ—¶æ–‡ä»¶\n\tcd /tmp/dbbak\n\ttar -zcf mysql-lib-$date.tar.gz dbinfo.txt /var/lib/mysql &>/dev/null\n\t#å‹ç¼©å¤‡ä»½æ•°æ®åº“ä¸ä¸´æ—¶æ–‡ä»¶\n\trm -rf /tmp/dbbak/dbinfo.txt\n\t#åˆ é™¤ä¸´æ—¶æ–‡ä»¶\nfi\n\n```\n\n\n\n\n\n## å¸¸ç”¨å­—ç¬¦è¡¨\n\n### echo\n\nåœ¨ echo å‘½ä»¤ä¸­å¦‚æœä½¿ç”¨äº†â€œ-eâ€é€‰é¡¹ï¼Œåˆ™å¯ä»¥æ”¯æŒæ§åˆ¶å­—ç¬¦ï¼Œå¦‚è¡¨ 11-2 æ‰€ç¤ºï¼š\n\n| æ§åˆ¶å­—ç¬¦ | ä½œ\tç”¨                                                     |\n| -------- | ------------------------------------------------------------ |\n| \\\\       | è¾“å‡º\\æœ¬èº«                                                    |\n| \\a       | è¾“å‡ºè­¦å‘ŠéŸ³                                                   |\n| \\b       | é€€æ ¼é”®ï¼Œä¹Ÿå°±æ˜¯å‘å·¦åˆ é™¤é”®                                     |\n| \\c       | å–æ¶ˆè¾“å‡ºè¡Œæœ«çš„æ¢è¡Œç¬¦ã€‚å’Œâ€œ-nâ€é€‰é¡¹ä¸€è‡´                         |\n| \\e       | ESCAPE é”®                                                    |\n| \\f       | æ¢é¡µç¬¦                                                       |\n| \\n       | æ¢è¡Œç¬¦                                                       |\n| \\r       | å›è½¦é”®                                                       |\n| \\t       | åˆ¶è¡¨ç¬¦ï¼Œä¹Ÿå°±æ˜¯ Tab é”®                                        |\n| \\v       | å‚ç›´åˆ¶è¡¨ç¬¦                                                   |\n| \\0nnn    | æŒ‰ç…§å…«è¿›åˆ¶ ASCII ç è¡¨è¾“å‡ºå­—ç¬¦ã€‚å…¶ä¸­ 0 ä¸ºæ•°å­—é›¶ï¼Œnnn æ˜¯ä¸‰ä½å…«è¿›åˆ¶æ•° |\n| \\xhh     | æŒ‰ç…§åå…­è¿›åˆ¶ ASCII ç è¡¨è¾“å‡ºå­—ç¬¦ã€‚å…¶ä¸­ hh æ˜¯ä¸¤ä½åå…­è¿›åˆ¶æ•°    |\n\n### Bashå¸¸ç”¨å¿«æ·é”®\n\n| å¿«æ·é”®     | ä½œ\tç”¨                                                     |\n| ---------- | ------------------------------------------------------------ |\n| ctrl+A     | æŠŠå…‰æ ‡ç§»åŠ¨åˆ°å‘½ä»¤è¡Œå¼€å¤´ã€‚å¦‚æœæˆ‘ä»¬è¾“å…¥çš„å‘½ä»¤è¿‡é•¿ï¼Œæƒ³è¦æŠŠå…‰æ ‡ç§»åŠ¨åˆ°å‘½ä»¤è¡Œå¼€å¤´æ—¶ä½¿ç”¨ã€‚ |\n| ctrl+E     | æŠŠå…‰æ ‡ç§»åŠ¨åˆ°å‘½ä»¤è¡Œç»“å°¾ã€‚                                     |\n| **ctrl+C** | å¼ºåˆ¶ç»ˆæ­¢å½“å‰çš„å‘½ä»¤ã€‚                                         |\n| **ctrl+L** | æ¸…å±ï¼Œç›¸å½“äº clear å‘½ä»¤ã€‚                                    |\n| **ctrl+U** | åˆ é™¤æˆ–å‰ªåˆ‡å…‰æ ‡ä¹‹å‰çš„å‘½ä»¤ã€‚æˆ‘è¾“å…¥äº†ä¸€è¡Œå¾ˆé•¿çš„å‘½ä»¤ï¼Œä¸ç”¨ä½¿ç”¨é€€æ ¼é”®ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çš„åˆ é™¤ï¼Œä½¿ç”¨è¿™ä¸ªå¿«æ·é”®ä¼šæ›´åŠ æ–¹ä¾¿ |\n| ctrl+K     | åˆ é™¤æˆ–å‰ªåˆ‡å…‰æ ‡ä¹‹åçš„å†…å®¹ã€‚                                   |\n| **ctrl+Y** | ç²˜è´´ ctrl+U æˆ– ctrl+K å‰ªåˆ‡çš„å†…å®¹ã€‚                           |\n| **ctrl+R** | åœ¨å†å²å‘½ä»¤ä¸­æœç´¢ï¼ŒæŒ‰ä¸‹ctrl+R ä¹‹åï¼Œå°±ä¼šå‡ºç°æœç´¢ç•Œé¢ï¼Œåªè¦è¾“å…¥æœç´¢å†…å®¹ï¼Œå°±ä¼šä»å†å²å‘½ä»¤ä¸­æœç´¢ã€‚ |\n\n| **ctrl+D** | é€€å‡ºå½“å‰ç»ˆç«¯ã€‚                                               |\n| ---------- | ------------------------------------------------------------ |\n| ctrl+Z     | æš‚åœï¼Œå¹¶æ”¾å…¥åå°ã€‚è¿™ä¸ªå¿«æ·é”®ç‰µæ‰¯å·¥ä½œç®¡ç†çš„å†…å®¹ï¼Œæˆ‘ä»¬åœ¨ç³»ç»Ÿç®¡ç†ç« èŠ‚è¯¦ç»†ä»‹ç»ã€‚ |\n| ctrl+S     | æš‚åœå±å¹•è¾“å‡ºã€‚                                               |\n| ctrl+Q     | æ¢å¤å±å¹•è¾“å‡ºã€‚                                               |\n\n### åŸºç¡€æ­£åˆ™è¡¨è¾¾å¼\n\n| å…ƒå­—ç¬¦  | ä½œ\tç”¨                                                     |\n| ------- | :----------------------------------------------------------- |\n| *       | å‰ä¸€ä¸ªå­—ç¬¦åŒ¹é… 0 æ¬¡æˆ–ä»»æ„å¤šæ¬¡ã€‚                              |\n| .       | åŒ¹é…é™¤äº†æ¢è¡Œç¬¦å¤–ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚                               |\n| ^       | åŒ¹é…è¡Œé¦–ã€‚ä¾‹å¦‚ï¼š^hello ä¼šåŒ¹é…ä»¥ hello å¼€å¤´çš„è¡Œã€‚             |\n| $       | åŒ¹é…è¡Œå°¾ã€‚ä¾‹å¦‚ï¼šhello&ä¼šåŒ¹é…ä»¥ hello ç»“å°¾çš„è¡Œã€‚              |\n| []      | åŒ¹é…ä¸­æ‹¬å·ä¸­æŒ‡å®šçš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼ŒåªåŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼š[aoeiu] åŒ¹é…ä»»æ„ä¸€ä¸ªå…ƒéŸ³å­—æ¯ï¼Œ[0-9] åŒ¹é…ä»»æ„ä¸€ä½æ•°å­—ï¼Œ[a-z][0-9]åŒ¹é…å°å†™å­—å’Œä¸€ä½æ•°å­—æ„æˆçš„ä¸¤ä½å­—ç¬¦ã€‚ |\n| [^]     | åŒ¹é…é™¤ä¸­æ‹¬å·çš„å­—ç¬¦ä»¥å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼š[^0-9] åŒ¹é…ä»»æ„ä¸€ä½éæ•°å­—å­—ç¬¦ï¼Œ[^a-z] è¡¨ç¤ºä»»æ„ä¸€ä½éå°å†™å­—æ¯ã€‚ |\n| \\       | è½¬ä¹‰ç¬¦ã€‚ç”¨äºå–æ¶ˆè®²ç‰¹æ®Šç¬¦å·çš„å«ä¹‰å–æ¶ˆã€‚                       |\n| \\{n\\}   | è¡¨ç¤ºå…¶å‰é¢çš„å­—ç¬¦æ°å¥½å‡ºç° n æ¬¡ã€‚ä¾‹å¦‚ï¼š[0-9]\\{4\\} åŒ¹é… 4 ä½æ•°å­—ï¼Œ[1][3-8][0-9]\\{9\\} åŒ¹é…æ‰‹æœºå·ç ã€‚ |\n| \\{n,\\}  | è¡¨ç¤ºå…¶å‰é¢çš„å­—ç¬¦å‡ºç°ä¸å°äº n æ¬¡ã€‚ä¾‹å¦‚ï¼š [0-9]\\{2,\\} è¡¨ç¤ºä¸¤ä½åŠä»¥ä¸Šçš„æ•°å­—ã€‚ |\n| \\{n,m\\} | è¡¨ç¤ºå…¶å‰é¢çš„å­—ç¬¦è‡³å°‘å‡ºç°n æ¬¡ï¼Œæœ€å¤šå‡ºç°m æ¬¡ã€‚ä¾‹å¦‚ï¼š[a-z]\\{6,8\\}åŒ¹é… 6 åˆ° 8 ä½çš„å°å†™å­—æ¯ã€‚ |\n\n### æ‰©å±•æ­£åˆ™\n\n| æ‰©å±•å…ƒå­—ç¬¦ | ä½œ\tç”¨                                                     |\n| ---------- | ------------------------------------------------------------ |\n| +          | å‰ä¸€ä¸ªå­—ç¬¦åŒ¹é… 1 æ¬¡æˆ–ä»»æ„å¤šæ¬¡ã€‚å¦‚â€œgo+gleâ€ä¼šåŒ¹é…â€œgogleâ€ã€â€œgoogleâ€æˆ–â€œgooogleâ€ï¼Œå½“ç„¶å¦‚æœâ€œoâ€æœ‰æ›´å¤šä¸ªï¼Œä¹Ÿèƒ½åŒ¹é…ã€‚ |\n| ï¼Ÿ         | å‰ä¸€ä¸ªå­—ç¬¦åŒ¹é… 0 æ¬¡æˆ– 1 æ¬¡ã€‚å¦‚â€œcolou?râ€å¯ä»¥åŒ¹é…â€œcolourâ€æˆ–â€œcolorâ€ã€‚ |\n| \\|         | åŒ¹é…ä¸¤ä¸ªæˆ–å¤šä¸ªåˆ†æ”¯é€‰æ‹©ã€‚å¦‚â€œwas\\|hisâ€ä¼šåŒ¹é…æ—¢åŒ…å«â€œwasâ€çš„è¡Œï¼Œä¹ŸåŒ¹é…åŒ…å«â€œhisâ€çš„è¡Œã€‚ |\n| ï¼ˆï¼‰       | åŒ¹é…å…¶æ•´ä½“ä¸ºä¸€ä¸ªå­—ç¬¦ï¼Œå³æ¨¡å¼å•å…ƒã€‚å¯ä»¥ç†è§£ä¸ºç”±å¤šä¸ªå•ä¸ªå­—ç¬¦ç»„æˆçš„å¤§å­—ç¬¦ã€‚<br />å¦‚â€œ(dog)+â€ä¼šåŒ¹é…â€œdogâ€ã€â€œdogdogâ€ã€â€œdogdogdogâ€ç­‰ï¼Œå› ä¸ºè¢«ï¼ˆï¼‰åŒ…å«çš„å­—ç¬¦ä¼šå½“æˆä¸€ä¸ªæ•´ä½“ã€‚ä½†â€œhello ï¼ˆworld\\|earthï¼‰â€ä¼šåŒ¹é…â€œhello worldâ€åŠâ€œhello earthâ€ã€‚ |\n\n### grep å‚æ•°åˆ—è¡¨\n\n1. `-i` : å¿½ç•¥å¤§å°å†™\n2. `-v` : æŸ¥æ‰¾ä¸åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„æ‰€æœ‰è¡Œï¼ˆå–åï¼‰\n3. `-r` : é€’å½’æŸ¥æ‰¾æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶\n4. `-n` : æ˜¾ç¤ºåŒ¹é…è¡Œæ‰€åœ¨ä½ç½®ï¼ˆè¡Œå·ï¼‰\n5. `-l` : åªæ˜¾ç¤ºåŒ…å«æœç´¢å­—ç¬¦ä¸²çš„æ–‡ä»¶åï¼Œè€Œéæ¯ä¸ªåŒ¹é…è¡Œ\n6. `-c` : ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„è¡Œæ•°\n7. `-e pattern` : æŒ‡å®šè¦æŸ¥æ‰¾çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼\n8. `-w` : åŒ¹é…æ•´ä¸ªå•è¯ï¼Œå³åªåŒ¹é…ç‹¬ç«‹çš„å•è¯è€Œéå•è¯å†…çš„å­—ç¬¦\n9. `-A num` : è¾“å‡ºåŒ¹é…è¡Œå N è¡Œå†…å®¹\n10. `-B num` : è¾“å‡ºåŒ¹é…è¡Œå‰ N è¡Œå†…å®¹\n11. `-C[num]` æˆ–è€… `--context[=num]`: è¾“å‡ºåŒ¹é…è¡Œå‰åæ€»å…± N è¡Œå†…å®¹ã€‚\n12. `--exclude` : æ’é™¤æŒ‡å®šæ–‡ä»¶ç±»å‹ï¼Œå¤šä¸ªæ–‡ä»¶ç±»å‹ç”¨ \",\" éš”å¼€\n\n### cut\n\n```\n[root@localhost ~]# cut [é€‰é¡¹] æ–‡ä»¶åé€‰é¡¹ï¼š\n-f åˆ—å·ï¼š          æå–ç¬¬å‡ åˆ—\n-d åˆ†éš”ç¬¦ï¼š\t     æŒ‰ç…§æŒ‡å®šåˆ†éš”ç¬¦åˆ†å‰²åˆ—\n-c å­—ç¬¦èŒƒå›´ï¼š    ä¸ä¾èµ–åˆ†éš”ç¬¦æ¥åŒºåˆ†åˆ—ï¼Œè€Œæ˜¯é€šè¿‡å­—ç¬¦èŒƒå›´ï¼ˆè¡Œé¦–ä¸º 0ï¼‰æ¥è¿›è¡Œå­—æ®µæå–ã€‚â€œn-â€è¡¨ç¤ºä»ç¬¬ n ä¸ªå­—ç¬¦åˆ°è¡Œå°¾ï¼›â€œn-mâ€ä»ç¬¬ n ä¸ªå­—ç¬¦åˆ°ç¬¬ mä¸ªå­—ç¬¦ï¼›â€œ-mâ€è¡¨ç¤ºä»ç¬¬ 1 ä¸ªå­—ç¬¦åˆ°ç¬¬ m ä¸ªå­—ç¬¦ã€‚\n```\n\n### awkæ¡ä»¶ï¼ˆPatternï¼‰\n\n![image-20230421143849290](../img/Shell/205fa6cf17277f79e65555cc1c7a9afe7819b814.png)\n\n### awkå†…ç½®å˜é‡\n\n![image-20230421190306772](../img/Shell/2e8746e3feacb88db27cc8f033f27d3b5b52f28a.png)\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Shell"],"categories":["ç¬”è®°"]},{"title":"åŸºäºDockeréƒ¨ç½²Hexoæ¡†æ¶","url":"/posts/25850/","content":"\n# åŸºäºDockeréƒ¨ç½²Hexoæ¡†æ¶\n\n## åˆ›å»ºdockerfileæ–‡ä»¶å¤¹\n\n```\nmkdir dockerfile\n```\n\n## ä½¿ç”¨vimåˆ›å»ºå’Œç¼–è¾‘Dockerfile\n\nvim dockerfile/Dockerfile\n\n```\n# ä½¿ç”¨æœ€æ–°çš„nodeé•œåƒä½œä¸ºåŸºç¡€ç¯å¢ƒ  \nFROM node:latest  \n# è®¾ç½®ä¸´æ—¶å·¥ä½œç›®å½•  \nWORKDIR /usr/blog\n# é…ç½® npm é•œåƒç«™ç‚¹  \nRUN npm config set registry https://registry.npm.taobao.org  \n# å®‰è£… hexo-cli  \nRUN npm install hexo-cli -g  \n# åˆå§‹åŒ– hexo blog  \nRUN hexo init  \n# hexo é»˜è®¤ç«¯å£å· 4000  \nEXPOSE 4000\n```\n\n## æ„å»ºé•œåƒ\n\n```\ndocker build -t hexo-image /root/dockerfile/\n```\n\n## åˆ›å»ºå®¹å™¨\n\n```\ndocker run -itd -v /root/blog:/usr/blog -p 4000:4000 --name hexo-blog hexo-image\n```\n\n-v /root/blog:/usr/blog  å¯ä»¥å®ç°æŠŠå®¹å™¨ä¸­çš„/usr/blogæŒ‚è½½åˆ°å®¿ä¸»æœºçš„/root/blogï¼Œéå¸¸æ–¹ä¾¿\n\n```\ndocker update hexo-blog --restart=always \n#å¢åŠ å¼€æœºè‡ªå¯åŠ¨å±æ€§\n```\n\n## æŸ¥çœ‹å®¹å™¨id\n\n```\ndocker ps -a\n```\n\n## åŠ å…¥å®¹å™¨\n\n```\ndocker exec -it å®¹å™¨id /bin/bash\n#ä¹Ÿå¯ä»¥æ˜¯åå­—\ndocker exec -it hexo-blog /bin/bash\n```\n\n## å¼€å¯æœåŠ¡\n\n```\nhexo s\n```\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Centos 8","Hexo"],"categories":["Hexo"]},{"title":"Mysqlç¬”è®°","url":"/posts/43761/","content":"\n# Mysqlç¬”è®°\n\n## æ•°æ®åº“çš„åˆ›å»ºå’Œç®¡ç†\n\n### åˆ›å»ºæ•°æ®åº“ \n\n```\ncreate database æ•°æ®åº“åå­—\ndefault character set å­—ç¬¦é›†åå­—\nDefault collate æ’åºè§„åˆ™å ;\nä¾‹å­ï¼š\ncreate database webinfo\ndefault character set utf8mb4\nDefault collate utf8mb4_general_ci;\n```\n\n### æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„æ•°æ®åº“åˆ—è¡¨ \n\n```\nShow databases;\n```\n\n### æŒ‡å®šé»˜è®¤çš„æ•°æ®åº“åˆ—è¡¨ \n\nUse æ•°æ®åº“åå­—;\n\n```\nuse stuinfo;\n```\n\n### ä½¿ç”¨alter database è¯­å¥ä¿®æ”¹æ•°æ®åº“ \n\n```\nAlter database æ•°æ®åº“åå­—\nDefault character set å­—ç¬¦é›†å\nDefault collate æ’åºè§„åˆ™åå­—;\nä¾‹å­ï¼š\nAlter database stuinfo\nDefault character set utf8\nDefault collate utf8_general_ci;\n```\n\n### åˆ é™¤æ•°æ®åº“\n\n```\nDrop database æ•°æ®åº“åå­—;\n```\n\n## æ•°æ®è¡¨çš„åˆ›å»ºå’Œç®¡ç†\n\n### ä½¿ç”¨create table è¯­å¥åˆ›å»ºæ•°æ®è¡¨ \n\n```\nCreate table è¡¨å (\nå­—æ®µå1 æ•°æ®ç±»å‹ \\[å±æ€§\\] \\[ç´¢å¼•\\] ,\nå­—æ®µå1 æ•°æ®ç±»å‹ \\[å±æ€§\\] \\[ç´¢å¼•\\],\n.......\nå­—æ®µå1 æ•°æ®ç±»å‹ \\[å±æ€§\\] \\[ç´¢å¼•\\]\n);\nä¾‹å­ï¼š\n\nCreate table student (\nId int unsigned not null auto_increment comment 'å­¦ç”ŸID',\nsNo char(10) not null comment 'å­¦å·',\nsName varchar(20) not null comment 'å§“å',\nsex char(1) not null default 'ç”·' comment 'æ€§åˆ«',\nbirthday Date not null comment 'å‡ºç”Ÿæ—¥æœŸ',\ndepyName varchar(30) not null comment 'ç­çº§åç§°',\nremark Varchar(80) comment 'å¤‡æ³¨',\nprimary key (id), /    \\*è®¾ç½®idä¸ºä¸»é”®\\*/\nunique (sNo), /        \\*è®¾ç½®sNoä¸ºå”¯ä¸€æ€§ç´¢å¼•\\*/\nindex (sName) /         \\*è®¾ç½®sNameä¸ºæ™®é€šç´¢å¼•\\*/\n); ENGINE=InnoDB;\n```\n\nNot null ä¸ä¸ºç©º unsignedæ— ç¬¦å· auto_incrementè‡ªåŠ¨å¢åŠ \n\n### æŸ¥çœ‹æ•°æ®è¡¨ \n\n```\nShow tables;\n```\n\n### å¤åˆ¶æ•°æ®è¡¨ \n\n```\nCreate table æ–°è¡¨å like æ—§è¡¨å;\n```\n\n### åˆ›å»ºä¸´æ—¶è¡¨ \n\næ–°å»ºä¹‹åï¼Œå½“mysqlå…³é—­åä¼šè‡ªåŠ¨åˆ é™¤\n\n```\nCreate temporary table student (\nId int unsigned not null auto_increment comment 'å­¦ç”ŸID',\nsNo char(10) not null comment 'å­¦å·',\nsName varchar(20) not null comment 'å§“å',\nsex char(1) not null default 'ç”·' comment 'æ€§åˆ«',\nbirthday Date not null comment 'å‡ºç”Ÿæ—¥æœŸ',\ndepyName varchar(30) not null comment 'ç­çº§åç§°',\nremark Varchar(80) comment 'å¤‡æ³¨',\nprimary key (id), /            \\*è®¾ç½®idä¸ºä¸»é”®\\*/\nunique (sNo), /                \\*è®¾ç½®sNoä¸ºå”¯ä¸€æ€§ç´¢å¼•\\*/\nindex (sName) /                \\*è®¾ç½®sNameä¸ºæ™®é€šç´¢å¼•\\*/\n); ENGINE=InnoDB;\n```\n\nNot null ä¸ä¸ºç©º unsignedæ— ç¬¦å· auto_incrementè‡ªåŠ¨å¢åŠ \n\n### æŸ¥çœ‹è¡¨ç»“æ„ \n\nDescribe \\| desc è¡¨å;\n\nä¾‹å­ï¼š\n\n```\ndesc è¡¨å;\n```\n\n### æŸ¥çœ‹è¡¨çš„ç»“æ„  sqlè¯­å¥\n\n```\nShow create table è¡¨å;\n```\n\n## ä¿®æ”¹è¡¨ç»“æ„\n\n### ä½¿ç”¨alter table ä¿®æ”¹è¡¨ç»“æ„ \n\nAlter table è¡¨å\n\nAddå­—æ®µå æ•°æ®ç±»å‹ \\[å±æ€§\\] \\[ç´¢å¼•\\] \\[First \\| after å­—æ®µå\\] --æ·»åŠ æ–°å­—æ®µ\n\nModify å­—æ®µå æ•°æ®ç±»å‹ \\[å±æ€§\\] \\[ç´¢å¼•\\] \\-\\--æ›´æ”¹æŒ‡å®šæ•°æ®ç±»å‹\n\nChange å­—æ®µå æ–°å­—æ®µå æ•°æ®ç±»å‹ \\[å±æ€§\\] \\[ç´¢å¼•\\] \\-\\--æ›´æ”¹æŒ‡å®šæ•°æ®ç±»å‹åŒæ—¶æ›´æ”¹åå­—\n\nDrop å­—æ®µå \\-\\-\\--åˆ é™¤æŒ‡å®šå­—æ®µ\n\nRename as æ–°è¡¨å \\-\\--ç”¨æ¥ç»™æ•°æ®è¡¨é‡æ–°å‘½å\n\nä¾‹å­ï¼š\n\n![](../img/mysql/8b6f5da2799c869593bdbc5522d2685dd2381ca7.png)\n\n### ä½¿ç”¨insertæ“ä½œè¡¨ä¸­æ•°æ®\n\nInsert into è¡¨å (å­—æ®µå1ï¼Œå­—æ®µå2ï¼Œå­—æ®µå3)\n\nValues (å€¼1, å€¼2, å€¼3 ), (å€¼1, å€¼2, å€¼3 ), (å€¼1, å€¼2, å€¼3 )\n\nä¾‹å­ï¼š\n\n![](../img/mysql/870d7fcb430882fa05e29c2babcf653dbf65ba4c.png)\n\n\n\n![](../img/mysql/03291da3b57489d326e70ed42cccd7b74fe47ff0.png)\n\n![](../img/mysql/8d5d3502faf255bf0994763b7e5265d08fdb4ea0.png)\n\n### ä½¿ç”¨updateä¿®æ”¹è¡¨ä¸­æ•°æ® \n\nUpdate è¡¨å\n\nSet å­—æ®µå1=å€¼1 , å­—æ®µå2=å€¼2\\[,...\\]\n\n\\[where æ¡ä»¶\\]\n\n![](../img/mysql/829ab7cd4862fa144d806ef85ec5bcb1355c0294.png)\n\n### ä½¿ç”¨deleteåˆ é™¤è¡¨ä¸­æ•°æ®\n\nDelete from è¡¨å\n\n\\[where æ¡ä»¶\\]\n\nä¾‹å­ï¼š\n\n```\nDelete from student where sNo='1308013105';\n```\n\n> ä¼šåˆ é™¤æ‰€åœ¨å­—æ®µï¼ˆsNoï¼‰çš„é‚£ä¸€è¡Œçš„æ•°æ®ï¼Œä¸æ˜¯åªå•å•åˆ é™¤sNo\n>\n\n### ä½¿ç”¨truncateè¯­å¥æ¸…ç©ºè¡¨ä¸­æ•°æ® \n\nTruncate \\[table\\] è¡¨å\n\n### åˆ é™¤è¡¨ \n\n```\nUse æ•°æ®åº“åå­—;\nDrop table è¡¨å;\n```\n\n## åˆ›å»ºç´¢å¼•\n\n### å®šä¹‰\n\nMySQL çš„ç´¢å¼•ç±»å‹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ã€‚\n\nâ€¢ æ™®é€šç´¢å¼•ï¼ˆNDEXï¼‰ï¼šæœ€åŸºæœ¬çš„ç´¢å¼•ï¼Œå®ƒæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ˜¯ç”¨æ¥æå‡æ•°æ®åº“æ€§èƒ½ã€æé«˜\n\næ•°æ®æŸ¥è¯¢æ•ˆç‡çš„ä¸€é¡¹é‡è¦çš„æŠ€æœ¯ã€‚\n\nâ€¢ å”¯ä¸€æ€§ç´¢å¼•ï¼ˆUNIQUE)ï¼‰ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚ä¸€å¼ è¡¨ä¸­å¯ä»¥æœ‰å¤šä¸ª\n\nå”¯ä¸€æ€§ç´¢å¼•ã€‚å¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œåˆ™åˆ—å€¼çš„ç»„åˆå¿…é¡»å”¯ä¸€ã€‚\n\nâ€¢ ä¸»é”®ç´¢å¼•ï¼ˆPRIMARY KEY)ï¼šä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€æ€§ç´¢å¼•ï¼Œä½†ä¸å…è®¸æœ‰ç©ºå€¼ã€‚ä¸€å¼ è¡¨ä¸­åªèƒ½\n\næœ‰ä¸€ä¸ªä¸»é”®ã€‚ä¸ºäº†æœ‰æ•ˆå®ç°æ•°æ®çš„ç®¡ç†ï¼Œæ¯å¼ è¡¨éƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸»é”®ï¼Œä¸€èˆ¬æ˜¯åœ¨å»ºè¡¨çš„\n\nåŒæ—¶åˆ›å»ºä¸»é”®ç´¢å¼•ã€‚\n\nâ€¢ å…¨æ–‡ç´¢å¼•ï¼ˆFULLITEXT)ï¼šä¸»è¦ç”¨æ¥æŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®å­—ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸ç´¢å¼•ä¸­çš„å€¼ç›¸\n\næ¯”è¾ƒã€‚å…¨æ–‡ç´¢å¼•è·Ÿå…¶ä»–ç´¢å¼•å¤§ä¸ç›¸åŒï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªæœç´¢å¼•æ“ï¼Œè€Œä¸æ˜¯ç®€å•çš„ WHERE\n\nè¯­å¥çš„å‚æ•°åŒ¹é…ã€‚å…¨æ–‡ç´¢å¼•é…åˆ MATCH AGAINST æ“ä½œä½¿ç”¨ï¼Œè€Œä¸æ˜¯ä¸€èˆ¬çš„ WHERE\n\nè¯­å¥åŠ  LIKEã€‚ç›®å‰åªæœ‰ CHARã€VARCHARã€TEXT åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚\n\n### åœ¨create tableåˆ›å»ºç´¢å¼• \n\nCreate table è¡¨å (\n\nå­—æ®µå1 \\| ç´¢å¼•é¡¹...,\n\n)\n\nç´¢å¼•é¡¹çš„è¯­æ³•ï¼š\n\nPrimary key ç´¢å¼•å (å­—æ®µå)\n\nUnique ç´¢å¼•å (å­—æ®µå)\n\nIndex \\| key ç´¢å¼•å (å­—æ®µå)\n\nFulltext ç´¢å¼•å (å­—æ®µå)\n\nä¾‹å­\n\n```\nCreate table student (\nId int unsigned not null auto_increment comment 'å­¦ç”ŸID',\nsNo char(10) not null comment 'å­¦å·',\nsName varchar(20) not null comment 'å§“å',\nsex char(1) not null default 'ç”·' comment 'æ€§åˆ«',\nbirthday Date not null comment 'å‡ºç”Ÿæ—¥æœŸ',\ndepyName varchar(30) not null comment 'ç­çº§åç§°',\nremark Varchar(80) comment 'å¤‡æ³¨',\nprimary key (id), /         \\*è®¾ç½®idä¸ºä¸»é”®\\*/\nunique (sNo), /             \\*è®¾ç½®sNoä¸ºå”¯ä¸€æ€§ç´¢å¼•\\*/\nindex (sName) /             \\*è®¾ç½®sNameä¸ºæ™®é€šç´¢å¼•\\*/\n); ENGINE=InnoDB;\n```\n\nNot null ä¸ä¸ºç©º unsignedæ— ç¬¦å· auto_incrementè‡ªåŠ¨å¢åŠ \n\n### ä½¿ç”¨alter table è¯­å¥åˆ›å»ºç´¢å¼• \n\nAlter table è¡¨å\n\nâ€‹\tAdd ç´¢å¼•é¡¹;\n\nä¾‹å­:\n\n```\nAlter table course \n   Add unique ux_cNo(cNo),\n   Add index ix_cName(cName);\n```\n\n### ä½¿ç”¨create indexè¯­å¥åˆ›å»ºç´¢å¼• \n\nCreate \\[unique\\] \\| \\[fulltext\\] index ç´¢å¼•å\n\nOn è¡¨å (å­—æ®µå)\n\nä¾‹å­ï¼š\n\nåœ¨æˆç»©è¡¨ä¸Šåˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼ˆç»„åˆç´¢å¼•ï¼‰\n\n```\nCreate unique index ux_sId_cId\n  ON score (sId,cId);\n```\n\n### ä½¿ç”¨Show index è¯­å¥æŸ¥çœ‹ç´¢å¼• \n\nShow index from \\<è¡¨å\\> \\[from \\<æ•°æ®åº“åå­—\\>\\]\n\nä¾‹å­ï¼š\n\n```\nShow index from student;\n```\n\næŸ¥çœ‹å­¦ç”Ÿè¡¨ä¸­çš„ç´¢å¼•\n\n## SelectæŸ¥è¯¢\n\nåº”è¯¥æ˜¯åˆ°è¿™ä¼šç”¨åˆ°sqlè¯­å¥ï¼Œ[[ç‚¹æ­¤ä¸‹è½½]](https://blog.qianyios.top/img/mysql/mysql.sql)\n\n### é€‰æ‹©å­—æ®µè¿›è¡ŒæŸ¥è¯¢ \n\nSelect å­—æ®µ1 \\[,å­—æ®µ2,å­—æ®µ3\\] from è¡¨å;\n\nä¾‹å­ï¼š\n\n```\nSelect deptname,name,sNo,sex from student;\n```\n\n### å®šä¹‰å­—æ®µåˆ«å \n\n```\nSelect sNo AS 'å­¦å·' , sName AS 'å§“å' from student;\n```\n\n### æ¡ä»¶æŸ¥è¯¢\n\n![](../img/mysql/02b82bb8513212355e8b349a521dd61352fa83ab.png)\n\n![](../img/mysql/0869742823f759f5ef48ea5f6a8f212372a07306.png)\n\n![](../img/mysql/dc7ea9e3a84db07ccd8c1d472ef16f831fad3426.png)\n\n### ä½¿ç”¨likeæ¨¡ç³ŠæŸ¥è¯¢ \n\n![](../img/mysql/6bbc28deea707327f633a79a9ac2ea993492b6f5.png)\n\n### ä½¿ç”¨in è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ \n\n![](../img/mysql/4b38a89d27f92c66b4f55b09b22571b41b2ff6c3.png)\n\n### ä½¿ç”¨order by å­å¥å¯¹æŸ¥è¯¢ç»“æœ \n\né™åº\n\n![](../img/mysql/c4e74778d15b3e25dcb87ad2ec9b04c019c599b6.png)\n\nä¸­æ–‡åæ‹¼éŸ³æ’åº\n\n![](../img/mysql/48dc17ccb73d158d933bf667457f976eabe78571.png)\n\nå…ˆæŒ‰ç­çº§å‡åºæ’åˆ—ï¼ŒåŒä¸€ä¸ªç­çº§å†…å‡ºç”Ÿæ—¥æœŸé™åºæ’åˆ—\n\n![](../img/mysql/4129c38cb1145c4c31a10e67a4bdbf53ab912a02.png)\n\n### ä½¿ç”¨limitå­å¥é™åˆ¶è¿”å›è®°å½•çš„è¡Œæ•° \n\n![](../img/mysql/6ef0e0ae9356a9bd35a73381331280a84b5f36e8.png)\n\n### ä½¿ç”¨distinctå…³é”®å­—è¿‡æ»¤é‡å¤è®°å½• \n\n![](../img/mysql/3da439822e837155ff79dd886f279e0e092a401c.png)\n\n### å†…è¿æ¥ \n\n![](../img/mysql/74f1484406a0109e04a42774390fc77908378d87.png)\n\n### ä½¿ç”¨ç»Ÿè®¡å‡½æ•°å¯¹æ•°æ®è¿›è¡Œç»Ÿè®¡æ±‡æ€»\n\n![](../img/mysql/edbb900f843983091f50c8678b3fa4f25f54a9c0.png)\n\n![](../img/mysql/1936d5b3fc30d96fd6504fad3971c68a7a68ff62.png)\n\n### ä½¿ç”¨group byè¿›è¡Œåˆ†ç»„æŸ¥è¯¢\n\n![](../img/mysql/54660d6d3fde2a35c69acba916a16fa91ed11f36.png)\n\n### ä½¿ç”¨havingå­å¥å¯¹åˆ†ç»„æ±‡æ€»ç»“æœè¿›è¡Œç­›é€‰\n\n![](../img/mysql/3db2b7135bda4f3f009cc75b3c23b318902d822f.png)\n\n### ä½¿ç”¨existså…³é”®å­—åˆ›å»ºå­æŸ¥è¯¢\n\næŸ¥è¯¢é€‰ä¿®è¯¾ç¨‹çš„å¥³ç”Ÿåå•\n\n![](../img/mysql/0a0f67652b270bf9a6c44bf15441c4d79703f59d.png)\n\n## è–„å¼±ç›²åŒº\n\n### å¤åˆ¶è¡¨åˆ°æ–°è¡¨\n\n![](../img/mysql/94311847f82a568ae2d73e53970b45e5af4a22b5.png)\n\n### å‘è¡¨ä¸­æ’å…¥å­æŸ¥è¯¢ç»“æœ \n\n![](../img/mysql/92a788abdb0eb28c8a3e5f874ea5f55f6d16e5cf.png)\n\n### å¸¦å­æŸ¥è¯¢çš„ä¿®æ”¹è¯­å¥\n\n![](../img/mysql/e479bfcdbf3598eb81b216d7dc9dde78ba16a96b.png)\n\n### å¸¦å­æŸ¥è¯¢çš„åˆ é™¤è¯­å¥\n\n![](../img/mysql/a4b432f0b05697044d85067e2da30284ed5e1f2d.png)\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Mysql"],"categories":["ç¬”è®°"]},{"title":"Centos 8éƒ¨ç½²Docker","url":"/posts/51253/","content":"\n# Centos 8éƒ¨ç½²Docker\n\n## åŸºç¡€ä¿¡æ¯\n\n| ç³»ç»Ÿ       | ip  (NAT)     | å†…å­˜ | ç¡¬ç›˜ |\n| ---------- | ------------- | ---- | ---- |\n| Centos 8.5 | 192.168.48.10 | 2G   | 40G  |\n\nåŸºæœ¬é…ç½®å¥½å¯ä»¥è®¿é—®äº’è”ç½‘å³å¯\n\n### åˆ‡æ¢é˜¿é‡Œyum\n\n```\nmkdir repo.bak\ncp /etc/yum.repos.d/* repo.bak/\nrename '.repo' '.repo.bak' /etc/yum.repos.d/*.repo\nwget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo\nyum clean all && yum makecache\nsystemctl disable --now firewalld\nsed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config\n```\n\n## å®‰è£…Docker\n\n### åˆ é™¤æ—§ç‰ˆdocker\n\n```\nsudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine -y\n```\n\n### å®‰è£…ä¾èµ–\n\n```\nyum install -y yum-utils device-mapper-persistent-data lvm2\n```\n\n### æ·»åŠ é˜¿é‡Œdockerå­˜å‚¨åº“\n\n```\ndnf config-manager --add-repo=https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nyum clean all && yum makecache \n```\n\n### å®‰è£…dockerè½¯ä»¶\n\n```\nyum install -y --allowerasing docker-ce docker-ce-cli\n```\n\n### å¯åŠ¨dockeræœåŠ¡\n\n```\nsystemctl enable docker --now\n```\n\n### éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ\n\n```\n[root@Docker ~]# docker run hello-world\n#æœªæ£€æµ‹åˆ°hello-worldé•œåƒ\nUnable to find image 'hello-world:latest' locally\n#ä»è¿œç¨‹çš„DockerHubä»“åº“æ‹‰å–é•œåƒ\nlatest: Pulling from library/hello-world\n2db29710123e: Pull complete\nDigest: sha256:aa0cc8055b82dc2509bed2e19b275c8f463506616377219d9642221ab53cf9fe\nStatus: Downloaded newer image for hello-world:latest\n#å‡ºç°ä¸‹é¢è¯´æ˜dockerè¿è¡ŒæˆåŠŸ\nHello from Docker!  -------\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n 1. The Docker client contacted the Docker daemon.\n 2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub.\n    (amd64)\n 3. The Docker daemon created a new container from that image which runs the\n    executable that produces the output you are currently reading.\n 4. The Docker daemon streamed that output to the Docker client, which sent it\n    to your terminal.\nTo try something more ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu bash\nShare images, automate workflows, and more with a free Docker ID:\n https://hub.docker.com/\nFor more examples and ideas, visit:\n https://docs.docker.com/get-started/\n\n```\n\n## å®‰è£…docker compose\n\n```\n# è®¾ç½® Docker é•œåƒåŠ é€Ÿå™¨\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://registry.docker-cn.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n\n# å®‰è£… Docker Compose\nsudo curl -L \"https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\nsudo systemctl enable docker --now\nsudo systemctl restart docker\n\nsudo usermod -aG docker $USER\n```\n\n## ä½¿ç”¨Dockeråˆ›å»ºæ–°çš„é•œåƒ\n\n### æ£€ç´¢Dockerä»“åº“ä¸­çš„Ubuntué•œåƒ\n\n```\n[root@Docker ~]# docker search ubuntu\nNAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nubuntu                           Ubuntu is a Debian-based Linux operating sysâ€¦   15464     [OK]     \n......\n```\n\n### è·å–Ubuntué•œåƒ\n\n```\n[root@Docker ~]# docker pull ubuntu\nUsing default tag: latest\nlatest: Pulling from library/ubuntu\n6e3729cf69e0: Pull complete\nDigest: sha256:27cb6e6ccef575a4698b66f5de06c7ecd61589132d5a91d098f7f3f9285415a9\nStatus: Downloaded newer image for ubuntu:latest\ndocker.io/library/ubuntu:latest\n```\n\n### æŸ¥çœ‹æœ¬åœ°Dockeré•œåƒ\n\n```\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED         SIZE\nubuntu        latest    6b7dfa7e8fdb   5 weeks ago     77.8MB\nhello-world   latest    feb5d9fea6a5   16 months ago   13.3kB\n```\n\n> ```\n> Dockeré•œåƒåˆ—è¡¨é€‰é¡¹å­—æ®µè¯´æ˜å¦‚ä¸‹ã€‚\n> REPOSITORY  é•œåƒçš„åç§°\n> TAG   \t\t    é•œåƒçš„æ ‡ç­¾\n> IMAGE ID      é•œåƒçš„ID\n> CREATED       é•œåƒåˆ›å»ºæ—¶é—´\n> SIZE             é•œåƒå¤§å°\n> ```\n\n### å¯åŠ¨dockerå®¹å™¨\n\n> ```\n> ä½¿ç”¨docker run å‘½ä»¤å¯å¯åŠ¨å®¹å™¨ï¼ŒDocker å¯åŠ¨æ—¶å…¶æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ã€‚\n> Â· æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„Docker é•œåƒï¼Œå¦‚æœä¸å­˜åœ¨å°†ä»Dockerä»“åº“ä¸‹è½½ã€‚\n> Â· ä½¿ç”¨Docker é•œåƒåˆ›å»ºå¹¶å¯åŠ¨Docker å®¹å™¨ã€‚\n> Â· ä¸ºDockerå®¹å™¨åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚ã€‚\n> Â· ä»Dockerå®¿ä¸»æœºä¸­é…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ã€‚\n> Â· ä»Docker ç½‘ç»œçš„åœ°å€æ± ä¸­åˆ†é…ä¸€ä¸ªIPåœ°å€ç»™å½“å‰å®¹å™¨ã€‚\n> Â· æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„ç¨‹åºã€‚\n> ` æ‰§è¡Œå®Œæ¯•åç»ˆæ­¢å®¹å™¨ã€‚\n> ```\n\n```\nåˆ›å»ºåŸºäºæœ¬åœ°ubuntué•œåƒçš„dockerå®¹å™¨\n[root@Docker ~]# docker run -it ubuntu /bin/bash\nroot@136156e4c448:/#\nroot@136156e4c448:/# exit\nexit\n[root@Docker ~]#\n```\n\n### æ›´æ–°å¹¶åˆ›å»ºDockeré•œåƒ\n\n#### æ›´æ–°ubuntué•œåƒæ·»åŠ ping\n\n```\nå½“æœ¬åœ°çš„é•œåƒä¸èƒ½æ»¡è¶³æ—¥å¸¸éœ€æ±‚ï¼Œå¯ä»å·²åˆ›å»ºçš„å®¹å™¨ä¸­æ›´æ–°å¹¶æäº¤é•œåƒã€‚æœ€æ–°ç‰ˆçš„ubuntuæ²¡æœ‰å®‰è£…pingï¼Œæœ¬æ­¥éª¤å°†åœ¨ubuntuå®‰è£…pingï¼Œå¹¶å»ºç«‹æ–°çš„é•œåƒ\n#å¯åŠ¨ ubuntuå®¹å™¨ï¼Œæ¯æ¬¡åˆ›å»ºå®¹å™¨ä¼šäº§ç”Ÿæ–°çš„idï¼ˆ9eac21a09449ï¼‰è¦è®°å½•å¥½\n[root@Docker ~]# docker run -t -i  ubuntu:latest /bin/bash\nroot@9eac21a09449:/# apt update\nGet:1 http://security.ubuntu.com/ubuntu jammy-security InRelease [110 kB]\n......\nroot@9eac21a09449:/# ping jd.com\nbash: ping: command not found\n#å®‰è£…ping\nroot@9eac21a09449:/# apt-get install -y iputils-ping\nReading package lists... Done\nroot@9eac21a09449:/# ping -c 2 jd.com\nPING jd.com (111.13.149.108) 56(84) bytes of data.\n64 bytes from 111.13.149.108 (111.13.149.108): icmp_seq=1 ttl=127 time=43.7 ms\n64 bytes from 111.13.149.108: icmp_seq=2 ttl=127 time=44.6 ms\n#é€€å‡º\nroot@9eac21a09449:/# exit\nexit\n#æ“ä½œå®Œæˆåå¯åŸºäºè¯¥dockerå®¹å™¨åˆ›å»ºæ–°çš„dockeré•œåƒ\n#åˆ›å»ºæ–°çš„dockeré•œåƒ\n[root@Docker ~]# docker commit -m 'ubuntuå¢åŠ pingå‘½ä»¤' -a 'docker' 9eac21a09449 ping/ubuntu:v2\nsha256:7655d7758bcfa635dde3cf8064602a32ac625100a1b7763e7856ff6052c8abee\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\nping/ubuntu   v2        7655d7758bcf   10 seconds ago   120MB\nubuntu        latest    6b7dfa7e8fdb   5 weeks ago      77.8MB\nhello-world   latest    feb5d9fea6a5   16 months ago    13.3kB\n#è¿è¡Œæ–°åˆ›å»ºçš„å®¹å™¨ï¼Œæµ‹è¯•ping\n[root@Docker ~]# docker run -it ping/ubuntu:v2 /bin/bash\nroot@7015378380d7:/# ping jd.com -c 3\nPING jd.com (111.13.149.108) 56(84) bytes of data.\n64 bytes from 111.13.149.108 (111.13.149.108): icmp_seq=1 ttl=127 time=44.1 ms\n64 bytes from 111.13.149.108 (111.13.149.108): icmp_seq=2 ttl=127 time=44.9 ms\n64 bytes from 111.13.149.108: icmp_seq=3 ttl=127 time=45.1 ms\n\n```\n\n#### ä½¿ç”¨dockerfileåˆ›å»ºé•œåƒ\n\n```\nDockerfileæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°è„šæœ¬æ„æˆçš„è„šæœ¬ï¼Œè¿™äº›å‘½ä»¤å¯åœ¨åŸºç¡€é•œåƒä¸Šä¸€æ¬¡æ‰§è¡Œï¼Œæœ€ç»ˆåˆ›å»ºä¸€ä¸ªæ–°çš„Dockeré•œåƒ\n```\n\nç¼–è¾‘dockerfile\n\n```\n[root@Docker ~]# vi /root/Dockerfile\n#åŸºç¡€é•œåƒä¿¡æ¯\nFROM ubuntu\n#ç»´æŠ¤è€…ä¿¡æ¯\nMAINTAINER book_user book@123.com\n#é•œåƒæ“ä½œæŒ‡ä»¤\nRUN apt update\nRUN apt-get install -y iputils-ping\n#å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤\nCMD cd /opt\nCMD echo 'new docker' > readme.txt\n```\n\n> Dockerfileä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåœ¨é•œåƒä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œæ¯ä¸€ä¸ªæŒ‡ä»¤çš„å‰ç¼€éƒ½å¿…é¡»æ˜¯å¤§å†™çš„ï¼Œå…¶åˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹\n\nä½¿ç”¨docker build å‘½ä»¤ä»dockerfileæ–‡ä»¶åˆ›å»ºé•œåƒ\n\n```\n[root@Docker ~]# docker build -t \"book/ubuntu:v3\" .\n#æœ«å°¾å°æ•°ç‚¹åˆ«å¿˜äº†ï¼Œæ¥ä¸‹æ¥ï¼Œä»–å°±ä¼šæŒ‰ç…§dockerfileæ–‡ä»¶ä¸­çš„å‘½ä»¤ä¸€ä¸€æ‰§è¡Œ\n\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\nbook/ubuntu   v3        90bbd384b2a3   59 seconds ago   120MB\nping/ubuntu   v2        7655d7758bcf   17 minutes ago   120MB\nubuntu        latest    6b7dfa7e8fdb   5 weeks ago      77.8MB\nhello-world   latest    feb5d9fea6a5   16 months ago    13.3kB\n\n#åˆ é™¤æœ¬åœ°çš„dockeré•œåƒ\n[root@Docker ~]# docker rmi hello-world\nError response from daemon: conflict: unable to remove repository reference \"hello-world\" (must force) - container 5542ae3caafa is using its referenced image feb5d9fea6a5\nå‡ºç°æŠ¥é”™è¯´æ˜containerä½¿ç”¨åˆ°äº†è¿™ä¸ªimagesï¼Œåˆ é™¤é•œåƒå‰éœ€è¦åˆ é™¤åŸºäºæ­¤é•œåƒåˆ›å»ºçš„å®¹å™¨\n\n#æŸ¥è¯¢å®¹å™¨åˆ—è¡¨\n[root@Docker ~]# docker ps -a\nCONTAINER ID   IMAGE            COMMAND       CREATED          STATUS                        PORTS     NAMES\n7015378380d7   ping/ubuntu:v2   \"/bin/bash\"   19 minutes ago   Exited (127) 15 minutes ago             nervous_lamarr\n37ac7bf75dbc   ping/ubuntu:v2   \"/bin/bash\"   19 minutes ago   Exited (0) 19 minutes ago               peaceful_galois\n9eac21a09449   ubuntu:latest    \"/bin/bash\"   32 minutes ago   Exited (130) 26 minutes ago             angry_golick\n136156e4c448   ubuntu           \"/bin/bash\"   34 minutes ago   Exited (130) 33 minutes ago             intelligent_proskuriakova\n5542ae3caafa   hello-world      \"/hello\"      46 minutes ago   Exited (0) 46 minutes ago               pensive_newton\n#åˆ é™¤å®¹å™¨\n[root@Docker ~]# docker rm 5542ae3caafa\n5542ae3caafa\nåˆ é™¤é•œåƒ\n[root@Docker ~]# docker rmi hello-world\nUntagged: hello-world:latest\nUntagged: hello-world@sha256:aa0cc8055b82dc2509bed2e19b275c8f463506616377219d9642221ab53cf9fe\nDeleted: sha256:feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412\nDeleted: sha256:e07ee1baac5fae6a26f30cabfe54a36d3402f96afda318fe0a96cec4ca393359\n\n```\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Centos 8","Docker"],"categories":["è¿ç»´"]},{"title":"Centos 8 stream éƒ¨ç½² kvm","url":"/posts/17511/","content":"\n# Centos 8 stream éƒ¨ç½² kvm\n\n## ç¯å¢ƒéƒ¨ç½²\n\n| ç½‘å¡æ¨¡å¼ | NATæ¨¡å¼       |\n| -------- | :------------ |\n| ip       | 192.168.48.10 |\n| å†…å­˜     | 4G            |\n| æ ¸å¿ƒ     | 4             |\n| ç¡¬ç›˜     | 100G          |\n| åŠŸèƒ½     | AMD-V         |\n\n### è®¾ç½®ä¸»æœºå\n\n```\n[root@localhost ~]# hostnamectl set-hostname KVM && bash\n[root@KVM ~]#\n```\n\n### è®¾ç½®ç½‘ç»œ\n\n#### è®¾ç½®è™šæ‹Ÿæœºç½‘ç»œï¼ˆens160æ˜¯NATæ¨¡å¼ï¼‰\n\n```\n[root@KVM ~]# vi /etc/sysconfig/network-scripts/ifcfg-ens160\nBOOTPROTO=static\nONBOOT=yes\nIPADDR=192.168.48.10\nPREFIX=24\nGATEWAY=192.168.48.2\nDNS1=192.168.48.2\nDOMAIN=114.114.114.114\n[root@KVM ~]# nmcli c reload\n[root@KVM ~]# nmcli c up ens160\nConnection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)\n[root@KVM ~]# ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n2: ens160: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether 00:0c:29:ce:a9:48 brd ff:ff:ff:ff:ff:ff\n    altname enp3s0\n    inet 192.168.48.10/24 brd 192.168.48.255 scope global noprefixroute ens160\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fece:a948/64 scope link noprefixroute\n       valid_lft forever preferred_lft forever\n[root@KVM ~]# ping -c 4 jd.com\nPING jd.com (111.13.149.108) 56(84) bytes of data.\n64 bytes from 111.13.149.108 (111.13.149.108): icmp_seq=1 ttl=48 time=47.8 ms\n64 bytes from 111.13.149.108 (111.13.149.108): icmp_seq=2 ttl=48 time=48.2 ms\n64 bytes from 111.13.149.108 (111.13.149.108): icmp_seq=3 ttl=48 time=48.2 ms\n64 bytes from 111.13.149.108 (111.13.149.108): icmp_seq=4 ttl=48 time=48.3 ms\n\n--- jd.com ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 6077ms\nrtt min/avg/max/mdev = 47.845/48.146/48.297/0.235 ms\n```\n\n### æ£€æŸ¥è™šæ‹Ÿæœºæ˜¯å¦æ”¯æŒè™šæ‹ŸåŒ–\n\n#### å‹¾é€‰cpuè™šæ‹ŸåŒ–ï¼ˆå®¿ä¸»æœºæ˜¯amdèŠ¯ç‰‡ï¼‰\n\n![image-20230209225201606](../img/KVM/fbd0cd3b97a357db355dd55a12499b7aa272a7bd.png)\n\n#### æŸ¥çœ‹è™šæ‹ŸåŒ–æ˜¯å¦æ”¯æŒ\n\n```\n[root@KVM ~]# lscpu\nVirtualization:      AMD-V\nè¯´æ˜å·²æ”¯æŒè™šæ‹ŸåŒ–\n```\n\n### è®¾ç½®é˜¿é‡Œyumæº\n\n```\n[root@KVM ~]# cp /etc/yum.repos.d/CentOS-Stream-BaseOS.repo /etc/yum.repos.d/CentOS-Stream-BaseOS.repo.bak\n[root@KVM ~]# sed -i 's/mirrorlist/#mirrorlist/' /etc/yum.repos.d/CentOS-Stream-BaseOS.repo\n[root@KVM ~]# sed -i 's/#baseurl=http:\\/\\/mirror.centos.org/baseurl=http:\\/\\/mirrors.aliyun.com/g' /etc/yum.repos.d/CentOS-Stream-BaseOS.repo\n[root@KVM ~]# yum clean all && yum makecache\n0 files removed\nCentOS Stream 8 - AppStream                                        14 MB/s |  27 MB     00:01\nCentOS Stream 8 - BaseOS                                          4.0 MB/s |  26 MB     00:06\nCentOS Stream 8 - Extras                                           28 kB/s |  18 kB     00:00\nCentOS Stream 8 - Extras common packages                          8.2 kB/s | 5.2 kB     00:00\nMetadata cache created.\n[root@KVM ~]#\n```\n\n## å®‰è£…kvm\n\n### å®‰è£…kvmåŠå…¶å·¥å…·\n\n```\n[root@KVM ~]# yum install qemu-kvm qemu-img  virt-manager libvirt virt-manager libvirt-client virt-install virt-viewer -y\nWaiting for process with pid 8674 to finish.\nLast metadata expiration check: 0:00:05 ago on Sun 08 Jan 2023 06:03:34 AM EST.\nPackage qemu-kvm-15:6.2.0-20.module_el8.7.0+1218+f626c2ff.1.x86_64 is already installed.\nPackage qemu-img-15:6.2.0-20.module_el8.7.0+1218+f626c2ff.1.x86_64 is already installed.\nPackage virt-manager-3.2.0-4.el8.noarch is already installed.\nPackage libvirt-8.0.0-10.module_el8.7.0+1218+f626c2ff.x86_64 is already installed.\nPackage libvirt-client-8.0.0-10.module_el8.7.0+1218+f626c2ff.x86_64 is already installed.\nPackage virt-install-3.2.0-4.el8.noarch is already installed.\nPackage virt-viewer-9.0-11.el8.x86_64 is already installed.\nDependencies resolved.\nNothing to do.\nComplete!\n```\n\n### å¯åŠ¨libvirtdæœåŠ¡\n\nå¯åŠ¨æœåŠ¡å¹¶è®¾ç½®éŸ¦å¼€æœºè‡ªå¯åŠ¨ï¼ŒæŸ¥çœ‹çŠ¶æ€\n\n```\n[root@KVM ~]# systemctl enable --now libvirtd\n[root@KVM ~]# systemctl status libvirtd\nâ— libvirtd.service - Virtualization daemon\n   Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; vendor preset: enabled)\n   Active: active (running) since Sun 2023-01-08 06:05:12 EST; 12s ago\n     Docs: man:libvirtd(8)\n           https://libvirt.org\n```\n\n### éªŒè¯æ˜¯å¦å·²åŠ è½½kvmæ¨¡å—\n\n```\n[root@KVM ~]# lsmod | grep kvm\nkvm_amd               143360  0\nccp                   106496  1 kvm_amd\nkvm                   942080  1 kvm_amd\nirqbypass              16384  1 kvm\n```\n\n```\n[root@KVM ~]# virsh list\n Id   Name   State\n--------------------\nè¯´æ˜kvmå®‰è£…æˆåŠŸ\n```\n\n##  è®¾ç½®å®¿ä¸»æœºç½‘ç»œï¼ˆkvmè¿™ä¸ªæœºå­ï¼‰\n\n### æŸ¥çœ‹ç½‘ç»œæƒ…å†µ\n\nKVNè½¯ä»¶å®‰è£…åé»˜è®¤ä»¥NATæ–¹å¼å®ç°ç½‘ç»œé€šä¿¡ã€‚ä¸ºäº†è®©KVMè™šæ‹Ÿæœºèƒ½å¤Ÿä¸å®¿ä¸»æœºã€æœ¬åœ°ä¸»æœºã€äº’è”ç½‘ç›¸äº’é€šä¿¡ï¼Œéœ€å°†å®¿ä¸»æœºï¼ˆKVMè¿™ä¸ªæœºå­ï¼‰ç½‘ç»œè®¾ç½®ä¸ºbridgeæ–¹å¼ã€‚\n\n```\nip a\n```\n\nloä¸ºå›ç¯æ¥å£ï¼Œè¯¥æ¥å£ä¸ä»å¤–ç•Œæ¥æ”¶å’Œå‘é€æ•°æ®åŒ…ï¼Œä»…åœ¨æ“ä½œç³»ç»Ÿå†…éƒ¨æ¥æ”¶å’Œå‘é€æ•°æ®åŒ…\n\nens160æ˜¯ä»¥å¤ªç½‘æ¥å£ï¼Œä¸ç½‘å¡å¯¹åº”ï¼Œæ¯ä¸ªç¡¬ä»¶ç½‘å¡å¯¹åº”ä¸€ä¸ªä»¥å¤ªç½‘æ¥å£\n\nvirbr0ä¸ºè™šæ‹Ÿç½‘ç»œæ¥å£ï¼Œç”±kvmåˆ›å»ºï¼Œä¸ºè¿æ¥å…¶ä¸Šçš„kvmè™šæ‹Ÿæœºç½‘ç»œæä¾›è®¿é—®å¤–éƒ¨ç½‘ç»œçš„åŠŸèƒ½\n\n### åˆ›å»ºbridge\n\nåˆ›å»º bridge æ—¶éœ€ä½¿ç”¨nmcliå‘½ä»¤åˆ›å»º br0ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°å¯ä»¥æ­£å¸¸å·¥ä½œçš„ç½‘ç»œæ¥å£ä¸Šï¼ŒåŒæ—¶è®©br0æˆä¸ºè¿æ¥å®¿ä¸»æœºä¸äº’è”ç½‘çš„æ¥å£ã€‚\n\n```\n[root@KVM ~]# nmcli connection add type bridge con-name br0 ifname br0 autoconnect yes\n\nConnection 'br0' (ac3429bc-907c-4ad1-bd54-bbf39d853a53) successfully added.\næŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ\n[root@KVM ~]# nmcli c\nNAME    UUID                                  TYPE      DEVICE\nbr0     ac3429bc-907c-4ad1-bd54-bbf39d853a53  bridge    br0\nens160  0d45e631-b256-4e08-b8d8-2c42b9481594  ethernet  ens160\nvirbr0  7075d19e-a20c-43da-b161-e7c7519febdb  bridge    virbr0\nç½‘æ¡¥åˆ›å»ºæˆåŠŸåä¼šè‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶\n[root@KVM ~]# ls -l /etc/sysconfig/network-scripts/\n-rw-r--r--. 1 root root 312 Jan  8 06:20 ifcfg-br0\n-rw-r--r--. 1 root root 365 Jan  8 05:40 ifcfg-ens160\n```\n\n### è®¾ç½®br0å’Œens160ç½‘å¡\n\nå°†br0æ¡¥æ¥åˆ°ens160\n\n```\n[root@KVM ~]# vi /etc/sysconfig/network-scripts/ifcfg-br0\nBOOTPROTO=static\nIPADDR=192.168.48.10\nGATEWAY=192.168.48.2\nPREFIX=24\nDNS=114.114.114.114\n[root@KVM ~]# vi /etc/sysconfig/network-scripts/ifcfg-ens160\nBOOTPROTO=none\nBRIDGE=br0\n[root@KVM ~]# nmcli c reload\n[root@KVM ~]# nmcli c drow br0r\næ­¤æ—¶å¦‚æœä½ æ˜¯ç”¨sshå·¥å…·è¿ç€çš„ï¼Œä½ ä¼šæ–­å¼€ï¼Œæ­¤æ—¶ä½ è¦å»vmé‚£é‡Œè¾“å…¥\n[root@KVM ~]# nmcli c up br0\n[root@KVM ~]# nmcli c up ens160\nç„¶åç­‰1åˆ†é’Ÿå·¦å³ï¼Œå°±å¯ä»¥è¿ä¸Šsshå·¥å…·äº†\n```\n\n\n\n```\næµ‹è¯•ç½‘ç»œè¿é€šæ€§\n[root@KVM ~]# ping -c 2 jd.com\nPING jd.com (211.144.24.218) 56(84) bytes of data.\n64 bytes from 211.144.24.218 (211.144.24.218): icmp_seq=1 ttl=128 time=50.7 ms\n64 bytes from 211.144.24.218 (211.144.24.218): icmp_seq=2 ttl=128 time=51.9 ms\n\n--- jd.com ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 50.683/51.286/51.890/0.644 ms\n[root@KVM ~]#\n```\n\n## åˆ›å»ºkvmè™šæ‹Ÿæœº\n\n| å­˜å‚¨æ±   | å­˜æ”¾ç›®å½•  | å†…å®¹è§„åˆ’            |\n| ------- | --------- | ------------------- |\n| disk    | /opt/disk | å­˜æ”¾KVMç£ç›˜æ–‡ä»¶     |\n| å­˜æ”¾iso | /opt/iso  | å­˜æ”¾å¾…å®‰è£…çš„ISOæ–‡ä»¶ |\n\n### åˆ›å»ºisoå­˜å‚¨æ± \n\n```\n[root@KVM ~]# mkdir -p /opt/iso\n[root@KVM ~]# chown root:root /opt/iso/\n[root@KVM ~]# chmod 777 /opt/iso/\n[root@KVM ~]# virsh pool-define-as iso --type dir --target /opt/iso/ \nPool iso--type defined\n#åç§°ä¸ºisoçš„å­˜å‚¨æ± å®šä¹‰æˆåŠŸ\nå¦‚æœåå­—æ‰“é”™ ç”¨\nvirsh pool-destroy [åå­—]\nvirsh pool-undefine [åå­—] åˆ é™¤\n[root@KVM ~]# virsh pool-list --all\n Name   State      Autostart\n------------------------------\n iso    inactive   no\n\n[root@KVM ~]# virsh pool-build iso\nPool iso built\n#åˆ›å»ºåä¸ºisoçš„å­˜å‚¨æ± \n[root@KVM ~]# virsh pool-start iso\nPool iso started\n#å¯åŠ¨isoå­˜å‚¨æ± \n[root@KVM ~]# virsh pool-autostart iso\nPool iso marked as autostarted\n#è®¾ç½®isoå­˜å‚¨æ± è‡ªå¯åŠ¨\næŸ¥çœ‹isoä¿¡æ¯\n[root@KVM ~]# virsh pool-info iso\nName:           iso\nUUID:           a966995e-2722-4a3f-a318-e158a642439e\nState:          running\nPersistent:     yes\nAutostart:      yes\nCapacity:       63.84 GiB\nAllocation:     2.75 GiB\nAvailable:      61.09 GiB\n```\n\n### åˆ›å»ºdiskå­˜å‚¨æ± \n\n```\n[root@KVM ~]# mkdir -p /opt/disk\n[root@KVM ~]# chown root:root /opt/disk/\n[root@KVM ~]# chmod 777 /opt/disk/\n[root@KVM ~]# virsh pool-define-as disk --type dir --target /opt/disk/ \nPool disk defined\n\n[root@KVM ~]# virsh pool-build disk\nPool disk built\n\n[root@KVM ~]# virsh pool-start disk\nPool disk started\n\n[root@KVM ~]# virsh pool-autostart disk\nPool disk marked as autostarted\n\n[root@KVM ~]# virsh pool-info disk\nName:           disk\nUUID:           30d784dc-386b-46e6-a22b-79a3b3447354\nState:          running\nPersistent:     yes\nAutostart:      yes\nCapacity:       63.84 GiB\nAllocation:     2.75 GiB\nAvailable:      61.09 GiB\n```\n\n### è·å–Centos7\n\n#### ä¸‹è½½Centos7æœ€å°åŒ–ç‰ˆæœ¬åˆ°ISOç›®å½•ä¸‹ï¼ˆç½‘ç»œæ–¹å¼ï¼‰\n\n```\n[root@KVM ~]# yum install -y wget\n[root@KVM ~]# wget -O /opt/iso/Centos7.iso https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso\n--2023-01-08 08:09:00--  https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso\nResolving mirrors.aliyun.com (mirrors.aliyun.com)... 120.241.238.243, 120.241.238.242, 120.241.238.241, ...\nConnecting to mirrors.aliyun.com (mirrors.aliyun.com)|120.241.238.243|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 1020264448 (973M) [application/x-cd-image]\nSaving to: â€˜/opt/iso/Centos7.isoâ€™\n\n/opt/iso/Centos7.iso     100%[================================>] 973.00M  1.53MB/s    in 10m 54s\n\n2023-01-08 08:19:54 (1.49 MB/s) - â€˜/opt/iso/Centos7.isoâ€™ saved [1020264448/1020264448]\n[root@KVM ~]# ll /opt/iso\ntotal 996352\n-rw-r--r--. 1 root root 1020264448 Nov  3  2020 Centos7.iso\n```\n\n#### ä¹Ÿå¯ä»¥æœ¬åœ°ä¸‹è½½å¥½åï¼Œä¸Šä¼ è‡³isoç›®å½•ï¼ˆæœ¬åœ°æ–¹å¼ï¼‰\n\nä¸‹è½½è¿æ¥ï¼šhttps://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso\n\n```\n[root@KVM ~]# ll /opt/iso\ntotal 996352\n-rw-r--r--. 1 root root 1020264448 Nov  3  2020 Centos7.iso\n```\n\n### å®‰è£…Centos7\n\n#### æ— ç•Œé¢å®‰è£…Centos7\n\n```\n[root@KVM ~]# virt-install --virt-type=kvm --name=Centos7 --vcpus=1 --memory=2048 --network bridge=br0,model=virtio --os-type=linux --os-variant=rhel7.7 --location=/opt/iso/Centos7.iso --disk /opt/disk/Centos7.qcow2,format=qcow2,size=10 --console=pty,target_type=serial --graphics=none --extra-args=\"console=tty0 console=ttyS0\"\n\nStarting install...\nRetrieving file vmlinuz...                                                 | 6.5 MB  00:00:00\nRetrieving file initrd.img...                                              |  53 MB  00:00:00\nAllocating 'Centos7.qcow2'                                                 |  10 GB  00:00:00\nRunning text console command: virsh --connect qemu:///system console Centos7\nConnected to domain 'Centos7'\n......\nè¿›å…¥å®‰è£…ç•Œé¢\n\nConnected to domain 'Centos7'\n  Please make your choice from above ['q' to quit | 'b' to begin installation |\n  'r' to refresh]:   Please make your choice from above ['q' to quit | 'b' to begin installation |\n================================================================================\n================================================================================\nInstallation\n\n 1) [x] Language settings                 2) [!] Time settings\n        (English (United States))                (Timezone is not set.)\n 3) [x] Installation source               4) [x] Software selection\n        (Local media)                            (Minimal Install)\n 5) [!] Installation Destination          6) [x] Kdump\n        (No disks selected)                      (Kdump is enabled)\n 7) [ ] Network configuration             8) [!] Root password\n        (Not connected)                          (Password is not set.)\n 9) [!] User creation\n        (No user will be created)\n  Please make your choice from above ['q' to quit | 'b' to begin installation |\n  'r' to refresh]:   Please make your choice from above ['q' to quit | 'b' to begin installation |\n\n```\n\n#### è¾“å…¥2è®¾ç½®æ—¶åŒº\n\n```\n================================================================================\n================================================================================\nTime settings\n\nTimezone: not set\n\nNTP servers:not configured\n\n 1)  Set timezone\n 2)  Configure NTP servers\n  Please make your choice from above ['q' to quit | 'c' to continue |\n  'r' to refresh]:\n================================================================================\n================================================================================\næŒ‰1æ ¹æ®æç¤ºé€‰æ‹©Asia/shanghai   ç„¶åæŒ‰c\n```\n\n#### è¾“å…¥5è®¾ç½®ç£ç›˜ï¼ˆInstallation Destination ï¼‰\n\n```\nProbing storage...\nInstallation Destination\n\n[x] 1) : 10 GiB (vda)\n\n1 disk selected; 10 GiB capacity; 10 GiB free ...\n\n  Please make your choice from above ['q' to quit | 'c' to continue |\n  'r' to refresh]:\nAutopartitioning Options\nå†æŒ‰c\n================================================================================\n[ ] 1) Replace Existing Linux system(s)\n\n[x] 2) Use All Space\n\n[ ] 3) Use Free Space\n\nInstallation requires partitioning of your hard drive. Select what space to use\nfor the install target.\n\n  Please make your choice from above ['q' to quit | 'c' to continue |\n  å†æŒ‰c\n================================================================================\nPartition Scheme Options\n\n[ ] 1) Standard Partition\n\n[ ] 2) Btrfs\n\n[x] 3) LVM\n\n[ ] 4) LVM Thin Provisioning\n\nSelect a partition scheme configuration.\n\n  Please make your choice from above ['q' to quit | 'c' to continue |\n  'r' to refresh]: c\nGenerating updated storage configuration\nChecking storage configuration...\n```\n\n#### æŒ‰8è®¾ç½®rootå¯†ç \n\n```\n  'r' to refresh]: 8\n================================================================================\n        (Not connected)\n 9) [!] User creation\n================================================================================\nPlease select new root password. You will have to type it twice.\n\nPassword:\nPassword (confirm):\n================================================================================\n================================================================================\nQuestion\n\nThe password you have provided is weak: The password fails the dictionary check\n- it is too simplistic/systematic.\nWould you like to use it anyway?\n\nPlease respond 'yes' or 'no': yes\n```\n\n#### å…¨éƒ¨è®¾ç½®å®ŒæˆåæŒ‰bç¡®è®¤\n\n```\n  'r' to refresh]: b\n================================================================================\n================================================================================\nProgress\nSetting up the installation environment\n.\nCreating disklabel on /dev/vda\n.\nCreating xfs on /dev/vda1\n.\nCreating lvmpv on /dev/vda2\n.\nCreating swap on /dev/mapper/centos-swap\n.\nCreating xfs on /dev/mapper/centos-root\n.\nRunning pre-installation scripts\n.\nStarting package installation process\nå°±ä¼šå¼€å§‹å®‰è£…\n```\n\n#### è¿›å…¥ç™»å…¥ç•Œé¢\n\n```\nCentOS Linux 7 (Core)\nKernel 3.10.0-1160.el7.x86_64 on an x86_64\n\nlocalhost login:\n\n```\n\n## ç®¡ç†kvmè™šæ‹Ÿæœº\n\n### è¿æ¥KVMè™šæ‹Ÿæœº\n\n> ```\n> [root@KVM ~]# virsh console Centos7\n> Connected to domain 'Centos7'\n> Escape character is ^] (Ctrl + ]\n> error: operation failed: Active console session exists for this domain\n> å¦‚æœä½ ä¹‹å‰è¿æ¥è¿‡ï¼Œæ²¡æœ‰é€€å‡ºï¼Œä½†æ˜¯ä½ ä¸å®¿ä¸»æœºçš„sshæ–­äº†ï¼Œå°±ä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä½ ä¹‹å‰çš„è¿æ¥æ§åˆ¶å°çš„è¿æ¥è¿˜å­˜åœ¨ï¼›\n> æ¯æ¬¡è¿æ¥kvmä¹‹åè¦é€€å‡º ctrl+] å°±å¯ä»¥é€€å‡º\n> è§£å†³åŠæ³•ï¼š\n> [root@KVM ~]# ps  -ef  |grep virsh\n> root       65402   61750  0 02:26 pts/0    00:00:00 virsh --connect qemu:///system console Centos7\n> root       68540   66569  0 02:35 pts/2    00:00:00 grep --color=auto virsh\n> [root@KVM ~]# kill -9 61750\n> [root@KVM ~]# kill -9 65402\n> ```\n\n#### æŸ¥çœ‹KVMè™šæ‹ŸæœºçŠ¶æ€\n\n```\n[root@KVM ~]# virsh list\n Id   Name      State\n-------------------------\n 2    Centos7   running\n```\n\n#### è¿æ¥è™šæ‹Ÿæœº\n\n```\n[root@KVM ~]# virsh console Centos7\nConnected to domain 'Centos7'\nEscape character is ^] (Ctrl + ]\n\n[root@localhost ~]#\n```\n\n### åˆå§‹åŒ–KVMè™šæ‹Ÿæœº\n\n#### è®¾ç½®åå­—\n\n```\n[root@localhost ~]# hostnamectl set-hostname Centos7 && bash\n[root@centos7 ~]#\n```\n\n#### è®¾ç½®ç½‘ç»œ\n\n##### æŸ¥çœ‹çŠ¶æ€\n\n```\n[root@centos7 ~]# ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:b2:b9:d1 brd ff:ff:ff:ff:ff:ff\n```\n\n##### ç¼–è¾‘é…ç½®æ–‡ä»¶\n\n```\n[root@centos7 ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static         ---\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nIPV6_ADDR_GEN_MODE=stable-privacy\nNAME=eth0\nUUID=b7053508-5183-4ee4-8af5-8d5241f57116\nDEVICE=eth0\nONBOOT=yes                  ---\nIPADDR=192.168.48.11        ---\nPREFIX=24                   ---\nGATEWAY=192.168.48.2        ---\nDNS1=114.114.114.114        ---\n```\n\n##### æŸ¥çœ‹KVMç½‘ç»œä¿¡æ¯\n\n```\n[root@centos7 ~]# systemctl restart network\n[root@centos7 ~]# ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 52:54:00:b2:b9:d1 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.48.11/24 brd 192.168.48.255 scope global noprefixroute eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::85d6:dde0:25ad:9c43/64 scope link noprefixroute\n       valid_lft forever preferred_lft forever\n[root@centos7 ~]#\n```\n\næµ‹è¯•ä¸€ä¸‹sshå·¥å…·æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è¿ï¼ˆcmdã€MobaXtermï¼‰\n\n##### æµ‹è¯•è¿é€šæ€§\n\n```\nping KVMæœºå­\n[root@centos7 ~]# ping 192.168.48.10 -c 2\nPING 192.168.48.10 (192.168.48.10) 56(84) bytes of data.\n64 bytes from 192.168.48.10: icmp_seq=1 ttl=64 time=0.481 ms\n64 bytes from 192.168.48.10: icmp_seq=2 ttl=64 time=0.254 ms\n\n--- 192.168.48.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1000ms\nrtt min/avg/max/mdev = 0.254/0.367/0.481/0.115 ms\nping ç™¾åº¦\n[root@centos7 ~]# ping baidu.com -c 2\nPING baidu.com (39.156.66.10) 56(84) bytes of data.\n64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq=1 ttl=128 time=43.5 ms\n64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq=2 ttl=128 time=44.9 ms\n\n--- baidu.com ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 43.599/44.258/44.917/0.659 ms\n[root@centos7 ~]#\n```\n\n#### è®¾ç½®Centos7è™šæ‹ŸæœºéšKVMå®¿ä¸»æœºå¼€æœºè‡ªå¯åŠ¨\n\n```\n[root@KVM ~]# virsh autostart Centos7\nDomain 'Centos7' marked as autostarted\n\nå¼€æœºè‡ªå¯åŠ¨é…ç½®åï¼Œä¼šåœ¨/etc/libvirt/qemu/autostart/ç›®å½•ä¸­å¢åŠ XMLæ ¼å¼\n[root@KVM ~]# ls /etc/libvirt/qemu/autostart/\nCentos7.xml\n```\n\n```\nvirsh autostart --disable å…³é—­å¼€æœºè‡ªå¯åŠ¨\n[root@KVM ~]# virsh autostart --disable Centos7\nDomain 'Centos7' unmarked as autostarted\n```\n\n### ä¸ºKVMè™šæ‹Ÿæœºå¢åŠ CPU\n\n#### æŸ¥çœ‹Centos7é…ç½®ä¿¡æ¯\n\n```\n[root@KVM ~]# virsh dominfo Centos7\nId:             1\nName:           Centos7\nUUID:           735f1ca1-c82a-4734-81ec-ea3e82e98bae\nOS Type:        hvm\nState:          running\nCPU(s):         1\nCPU time:       17.3s\nMax memory:     2097152 KiB\nUsed memory:    2097152 KiB\nPersistent:     yes\nAutostart:      enable\nManaged save:   no\nSecurity model: selinux\nSecurity DOI:   0\nSecurity label: system_u:system_r:svirt_t:s0:c202,c740 (enforcing)\n```\n\n#### å…³é—­è™šæ‹Ÿæœº\n\n```\n[root@KVM ~]# virsh shutdown Centos7\nDomain 'Centos7' is being shutdown\n[root@KVM ~]# virsh list --all\n Id   Name      State\n--------------------------\n -    Centos7   shut off\n```\n\n#### ä¿®æ”¹Centos7 CPUæ ¸å¿ƒæ•°é‡\n\n```\n[root@KVM ~]# vi /etc/libvirt/qemu/Centos7.xml\n<domain type='kvm'>\n  <name>Centos7</name>\n  <uuid>735f1ca1-c82a-4734-81ec-ea3e82e98bae</uuid>\n  <metadata>\n    <libosinfo:libosinfo xmlns:libosinfo=\"http://libosinfo.org/xmlns/libvirt/domain/1.0\">\n      <libosinfo:os id=\"http://redhat.com/rhel/7.7\"/>\n    </libosinfo:libosinfo>\n  </metadata>\n  <memory unit='KiB'>2097152</memory>\n  <currentMemory unit='KiB'>2097152</currentMemory>\n  <vcpu placement='static'>2</vcpu>    ä¿®æ”¹ä¸º2\n  <os>\n    <type arch='x86_64' machine='pc-q35-rhel8.6.0'>hvm</type>\n\n```\n\n#### å¯åŠ¨è™šæ‹Ÿæœºå¹¶æŸ¥çœ‹é…ç½®æ–‡ä»¶\n\n```\n[root@KVM ~]# virsh start Centos7\nDomain 'Centos7' started\n\n[root@KVM ~]# virsh dominfo Centos7\nId:             1\nName:           Centos7\nUUID:           735f1ca1-c82a-4734-81ec-ea3e82e98bae\nOS Type:        hvm\nState:          running\nCPU(s):         2\nCPU time:       13.4s\nMax memory:     2097152 KiB\nUsed memory:    2097152 KiB\nPersistent:     yes\nAutostart:      enable\nManaged save:   no\nSecurity model: selinux\nSecurity DOI:   0\nSecurity label: system_u:system_r:svirt_t:s0:c414,c924 (enforcing)\n\n[root@KVM ~]#\n```\n\n## ç»´æŠ¤è™šæ‹Ÿæœº\n\n### æŒ‚èµ·/æ¢å¤è™šæ‹Ÿæœº\n\n```\n[root@KVM ~]# virsh suspend Centos7\nDomain 'Centos7' suspended\n[root@KVM ~]# virsh list --all\n Id   Name      State\n------------------------\n 1    Centos7   paused\n[root@KVM ~]# virsh resume Centos7\nDomain 'Centos7' resumed\n\n[root@KVM ~]# virsh list --all\n Id   Name      State\n-------------------------\n 1    Centos7   running\n```\n\n### å…‹éš†KVMè™šæ‹Ÿæœº\n\n#### å…³é—­Centos7 å¹¶ä¸”å…‹éš†Centos7ä¸ºC7\n\n```\n[root@KVM ~]# virsh shutdown Centos7\nDomain 'Centos7' is being shutdown\n\n[root@KVM ~]# virsh list --all\n Id   Name      State\n--------------------------\n -    Centos7   shut off\n\n[root@KVM ~]# virt-clone -o Centos7 -n C7 -f /opt/disk/C7.qcow2\nAllocating 'C7.qcow2'                                                      |  10 GB  00:00:37\n\nClone 'C7' created successfully.\nå…‹éš†æˆåŠŸ\n[root@KVM ~]# virsh list --all\n Id   Name      State\n--------------------------\n -    C7        shut off\n -    Centos7   shut off\n```\n\n#### å¼€å¯C7ï¼Œç™»å…¥å¹¶ä¸”ä¿®æ”¹ä¸»æœºåä¸ºC7\n\n```\n[root@KVM ~]# virsh start C7\nDomain 'C7' started\n\n[root@KVM ~]# virsh console C7\nConnected to domain 'C7'\nEscape character is ^] (Ctrl + ]\nCentOS Linux 7 (Core)\nKernel 3.10.0-1160.el7.x86_64 on an x86_64\n\ncentos7 login: root\nPassword:\nLast login: Mon Jan  9 15:56:16 from 192.168.48.250\n[root@centos7 ~]# hostnamectl set-hostname C7 && bash\n[root@c7 ~]#\nå…‹éš†åipå›åˆCentos7ä¸€æ ·ï¼Œè®°å¾—åæœŸä¿®æ”¹\n```\n\n### è®¾ç½®Kvmè™šæ‹Ÿæœºå¿«ç…§\n\n#### ç™»å…¥C7 åˆ›å»º/opt/dev ï¼Œå…³é—­è™šæ‹Ÿæœºï¼Œåˆ›å»ºå¿«ç…§\n\n```\n[root@c7 ~]# mkdir /opt/dev\n[root@c7 ~]# ls /opt\ndev\næŒ‰ctrl + ] é€€å›åˆ°KVMå®¿ä¸»æœº\n[root@KVM ~]# virsh shutdown C7\nDomain 'C7' is being shutdown\nåˆ›å»ºå¿«ç…§\n[root@KVM ~]# virsh snapshot-create C7\nDomain snapshot 1673252946 created\næŸ¥çœ‹C7çš„å¿«ç…§åˆ—è¡¨\n[root@KVM ~]# virsh snapshot-list C7\n Name         Creation Time               State\n---------------------------------------------------\n 1673252946   2023-01-09 03:29:06 -0500   shutoff\n```\n\n#### å¼€å¯C7 åˆ é™¤/opt/dev ï¼Œæ¢å¤å¿«ç…§\n\n```\n[root@KVM ~]# virsh start C7\nDomain 'C7' started\n\n[root@KVM ~]# virsh console C7\nConnected to domain 'C7'\n\n[root@c7 ~]# rm -rf /opt/dev\n[root@c7 ~]# ll /opt\ntotal 0\næŒ‰ctrl + ] é€€å›åˆ°KVMå®¿ä¸»æœº\n[root@KVM ~]# virsh snapshot-list C7\n Name         Creation Time               State\n---------------------------------------------------\n 1673252946   2023-01-09 03:29:06 -0500   shutoff\n\n[root@KVM ~]# virsh snapshot-revert C7 1673252946\nvirsh snapshot-revert è™šæ‹Ÿæœºåå­— å¿«ç…§åå­— \n```\n\n#### å¼€å¯C7,æŸ¥çœ‹æ˜¯å¦æ¢å¤æˆåŠŸ\n\n```\n[root@KVM ~]# virsh start C7\nDomain 'C7' started\n\n[root@KVM ~]# virsh console C7\nConnected to domain 'C7'\nEscape character is ^] (Ctrl + ]\n\nCentOS Linux 7 (Core)\nKernel 3.10.0-1160.el7.x86_64 on an x86_64\n\nc7 login: root\nPassword:\nLast login: Mon Jan  9 16:27:07 on ttyS0\n[root@c7 ~]# ls /opt\ndev\n```\n\n## virsh å‘½ä»¤\n\n```\nvirsh shutdown å…³é—­KVMè™šæ‹Ÿæœº \nvirsh destroy å¼ºåˆ¶å…³é—­KVMè™šæ‹Ÿæœºï¼Œä¸åˆ é™¤è™šæ‹Ÿæœºç£ç›˜ï¼Œvirsh liståˆ—è¡¨é‡Œé¢çœ‹ä¸è§ï¼Œä½†æ˜¯ç£ç›˜è¿˜åœ¨ï¼Œè¿˜æ˜¯å¯ä»¥å¯åŠ¨ï¼Œé€šè¿‡virsh list --allå¯ä»¥æŸ¥çœ‹\nvirsh undefine å½»åº•åˆ é™¤è™šæ‹Ÿæœºï¼ŒåŒ…æ‹¬è™šæ‹Ÿæœºå­˜å‚¨æ‰€åœ¨çš„ä½ç½®\nvirsh start å¼€å¯KVMè™šæ‹Ÿæœº\nvirsh suspend è™šæ‹Ÿæœºåç§° #æŒ‚èµ·\nvirsh resume è™šæ‹Ÿæœºåç§° #æ¢å¤è¢«æŒ‚èµ·çš„\n```\n\n\n\n<div class=\"tbsm\" style=\"margin-top:54px;\">\n<div class=\"tbsm-top\"><span><svg t=\"1674654360507\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"987\" data-spm-anchor-id=\"a313x.7781069.0.i0\" width=\"35\" height=\"35\"><path d=\"M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#66EEFF\" p-id=\"988\"></path><path d=\"M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z\" fill=\"#C2F8FF\" p-id=\"989\"></path></svg></span><span style=\"font-size:30px;\"> ç‰¹åˆ«å£°æ˜</span></div>\n<div class=\"tbsm-wz\">åƒå±¹åšå®¢æ——ä¸‹çš„æ‰€æœ‰æ–‡ç« ï¼Œæ˜¯é€šè¿‡æœ¬äººè¯¾å ‚å­¦ä¹ å’Œè¯¾å¤–è‡ªå­¦æ‰€ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†å·¨è‘—<br/>éš¾å…ä¼šæœ‰å‡ºé”™çš„åœ°æ–¹<br/>å¦‚æœç»†å¿ƒçš„ä½ å‘ç°äº†å°å¤±è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ–è€…ç§ä¿¡æˆ‘ï¼<br />éå¸¸æ„Ÿè°¢å¤§å®¶çš„çƒ­çƒˆæ”¯æŒï¼</div>\n</div>","tags":["Centos 8 stream","KVM"],"categories":["è¿ç»´"]}]